"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../lib");
describe('Capture', () => {
    test('uncaptured', () => {
        const capture = new lib_1.Capture();
        expect(() => capture.asString()).toThrow(/No value captured/);
    });
    test('nullish', () => {
        const capture = new lib_1.Capture();
        const matcher = lib_1.Match.objectEquals({ foo: capture });
        const result = matcher.test({ foo: null });
        expect(result.failCount).toEqual(1);
        expect(result.toHumanStrings()[0]).toMatch(/Can only capture non-nullish values/);
    });
    test('no captures if not finished', () => {
        const capture = new lib_1.Capture();
        const matcher = lib_1.Match.objectEquals({ foo: capture });
        matcher.test({ foo: 'bar' }); // Not calling finished()
        expect(() => capture.asString()).toThrow(/No value captured/);
    });
    test('asString()', () => {
        const capture = new lib_1.Capture();
        const matcher = lib_1.Match.objectEquals({ foo: capture });
        matcher.test({ foo: 'bar' }).finished();
        matcher.test({ foo: 3 }).finished();
        expect(capture.asString()).toEqual('bar');
        expect(capture.next()).toEqual(true);
        expect(() => capture.asString()).toThrow(/expected to be string but found number/);
    });
    test('asNumber()', () => {
        const capture = new lib_1.Capture();
        const matcher = lib_1.Match.objectEquals({ foo: capture });
        matcher.test({ foo: 3 }).finished();
        matcher.test({ foo: 'bar' }).finished();
        expect(capture.asNumber()).toEqual(3);
        expect(capture.next()).toEqual(true);
        expect(() => capture.asNumber()).toThrow(/expected to be number but found string/);
    });
    test('asArray()', () => {
        const capture = new lib_1.Capture();
        const matcher = lib_1.Match.objectEquals({ foo: capture });
        matcher.test({ foo: ['bar'] }).finished();
        matcher.test({ foo: 'bar' }).finished();
        expect(capture.asArray()).toEqual(['bar']);
        expect(capture.next()).toEqual(true);
        expect(() => capture.asArray()).toThrow(/expected to be array but found string/);
    });
    test('asObject()', () => {
        const capture = new lib_1.Capture();
        const matcher = lib_1.Match.objectEquals({ foo: capture });
        matcher.test({ foo: { fred: 'waldo' } }).finished();
        matcher.test({ foo: 'bar' }).finished();
        expect(capture.asObject()).toEqual({ fred: 'waldo' });
        expect(capture.next()).toEqual(true);
        expect(() => capture.asObject()).toThrow(/expected to be object but found string/);
    });
    test('nested within an array', () => {
        const capture = new lib_1.Capture();
        const matcher = lib_1.Match.objectEquals({ foo: ['bar', capture] });
        matcher.test({ foo: ['bar', 'baz'] }).finished();
        expect(capture.asString()).toEqual('baz');
    });
    test('multiple captures', () => {
        const capture = new lib_1.Capture();
        const matcher = lib_1.Match.objectEquals({ foo: capture, real: true });
        matcher.test({ foo: 3, real: true }).finished();
        matcher.test({ foo: 5, real: true }).finished();
        matcher.test({ foo: 7, real: false }).finished();
        expect(capture.asNumber()).toEqual(3);
        expect(capture.next()).toEqual(true);
        expect(capture.asNumber()).toEqual(5);
        expect(capture.next()).toEqual(false);
    });
    test('nested pattern match', () => {
        const capture = new lib_1.Capture(lib_1.Match.objectLike({ bar: 'baz' }));
        const matcher = lib_1.Match.objectLike({ foo: capture });
        matcher.test({
            foo: {
                bar: 'baz',
                fred: 'waldo',
            },
        }).finished();
        expect(capture.asObject()).toEqual({ bar: 'baz', fred: 'waldo' });
        expect(capture.next()).toEqual(false);
    });
    test('nested pattern does not match', () => {
        const capture = new lib_1.Capture(lib_1.Match.objectLike({ bar: 'baz' }));
        const matcher = lib_1.Match.objectLike({ foo: capture });
        matcher.test({
            foo: {
                fred: 'waldo',
            },
        }).finished();
        expect(() => capture.asObject()).toThrow(/No value captured/);
    });
    test('capture in arraywith and objectlike', () => {
        const capture = new lib_1.Capture();
        const matcher = lib_1.Match.objectLike({
            People: lib_1.Match.arrayWith([{
                    Name: 'Alice',
                    Attributes: [
                        lib_1.Match.objectLike({
                            Name: 'HairColor',
                            Value: capture,
                        }),
                    ],
                }]),
        });
        const result = matcher.test({
            People: [
                {
                    Name: 'Alice',
                    Attributes: [
                        { Name: 'HairColor', Value: 'Black' },
                    ],
                },
            ],
        });
        expect(result.isSuccess).toEqual(true);
        result.finished();
        expect(capture.asString()).toEqual('Black');
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FwdHVyZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2FwdHVyZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsZ0NBQXdDO0FBRXhDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO0lBQ3ZCLElBQUksQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO1FBQ3RCLE1BQU0sT0FBTyxHQUFHLElBQUksYUFBTyxFQUFFLENBQUM7UUFDOUIsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0lBQ2hFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7UUFDbkIsTUFBTSxPQUFPLEdBQUcsSUFBSSxhQUFPLEVBQUUsQ0FBQztRQUM5QixNQUFNLE9BQU8sR0FBRyxXQUFLLENBQUMsWUFBWSxDQUFDLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFFckQsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQzNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMscUNBQXFDLENBQUMsQ0FBQztJQUNwRixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUU7UUFDdkMsTUFBTSxPQUFPLEdBQUcsSUFBSSxhQUFPLEVBQUUsQ0FBQztRQUM5QixNQUFNLE9BQU8sR0FBRyxXQUFLLENBQUMsWUFBWSxDQUFDLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7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bUIsQ0FBQyxDQUFDO0lBQ2hFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRTtRQUMvQyxNQUFNLE9BQU8sR0FBRyxJQUFJLGFBQU8sRUFBRSxDQUFDO1FBQzlCLE1BQU0sT0FBTyxHQUFHLFdBQUssQ0FBQyxVQUFVLENBQUM7WUFDL0IsTUFBTSxFQUFFLFdBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztvQkFDdkIsSUFBSSxFQUFFLE9BQU87b0JBQ2IsVUFBVSxFQUFFO3dCQUNWLFdBQUssQ0FBQyxVQUFVLENBQUM7NEJBQ2YsSUFBSSxFQUFFLFdBQVc7NEJBQ2pCLEtBQUssRUFBRSxPQUFPO3lCQUNmLENBQUM7cUJBQ0g7aUJBQ0YsQ0FBQyxDQUFDO1NBQ0osQ0FBQyxDQUFDO1FBRUgsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztZQUMxQixNQUFNLEVBQUU7Z0JBQ047b0JBQ0UsSUFBSSxFQUFFLE9BQU87b0JBQ2IsVUFBVSxFQUFFO3dCQUNWLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFO3FCQUN0QztpQkFDRjthQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2xCLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDOUMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENhcHR1cmUsIE1hdGNoIH0gZnJvbSAnLi4vbGliJztcblxuZGVzY3JpYmUoJ0NhcHR1cmUnLCAoKSA9PiB7XG4gIHRlc3QoJ3VuY2FwdHVyZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgY2FwdHVyZSA9IG5ldyBDYXB0dXJlKCk7XG4gICAgZXhwZWN0KCgpID0+IGNhcHR1cmUuYXNTdHJpbmcoKSkudG9UaHJvdygvTm8gdmFsdWUgY2FwdHVyZWQvKTtcbiAgfSk7XG5cbiAgdGVzdCgnbnVsbGlzaCcsICgpID0+IHtcbiAgICBjb25zdCBjYXB0dXJlID0gbmV3IENhcHR1cmUoKTtcbiAgICBjb25zdCBtYXRjaGVyID0gTWF0Y2gub2JqZWN0RXF1YWxzKHsgZm9vOiBjYXB0dXJlIH0pO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gbWF0Y2hlci50ZXN0KHsgZm9vOiBudWxsIH0pO1xuICAgIGV4cGVjdChyZXN1bHQuZmFpbENvdW50KS50b0VxdWFsKDEpO1xuICAgIGV4cGVjdChyZXN1bHQudG9IdW1hblN0cmluZ3MoKVswXSkudG9NYXRjaCgvQ2FuIG9ubHkgY2FwdHVyZSBub24tbnVsbGlzaCB2YWx1ZXMvKTtcbiAgfSk7XG5cbiAgdGVzdCgnbm8gY2FwdHVyZXMgaWYgbm90IGZpbmlzaGVkJywgKCkgPT4ge1xuICAgIGNvbnN0IGNhcHR1cmUgPSBuZXcgQ2FwdHVyZSgpO1xuICAgIGNvbnN0IG1hdGNoZXIgPSBNYXRjaC5vYmplY3RFcXVhbHMoeyBmb286IGNhcHR1cmUgfSk7XG5cbiAgICBtYXRjaGVyLnRlc3QoeyBmb286ICdiYXInIH0pOyAvLyBOb3QgY2FsbGluZyBmaW5pc2hlZCgpXG4gICAgZXhwZWN0KCgpID0+IGNhcHR1cmUuYXNTdHJpbmcoKSkudG9UaHJvdygvTm8gdmFsdWUgY2FwdHVyZWQvKTtcbiAgfSk7XG5cbiAgdGVzdCgnYXNTdHJpbmcoKScsICgpID0+IHtcbiAgICBjb25zdCBjYXB0dXJlID0gbmV3IENhcHR1cmUoKTtcbiAgICBjb25zdCBtYXRjaGVyID0gTWF0Y2gub2JqZWN0RXF1YWxzKHsgZm9vOiBjYXB0dXJlIH0pO1xuXG4gICAgbWF0Y2hlci50ZXN0KHsgZm9vOiAnYmFyJyB9KS5maW5pc2hlZCgpO1xuICAgIG1hdGNoZXIudGVzdCh7IGZvbzogMyB9KS5maW5pc2hlZCgpO1xuXG4gICAgZXhwZWN0KGNhcHR1cmUuYXNTdHJpbmcoKSkudG9FcXVhbCgnYmFyJyk7XG4gICAgZXhwZWN0KGNhcHR1cmUubmV4dCgpKS50b0VxdWFsKHRydWUpO1xuICAgIGV4cGVjdCgoKSA9PiBjYXB0dXJlLmFzU3RyaW5nKCkpLnRvVGhyb3coL2V4cGVjdGVkIHRvIGJlIHN0cmluZyBidXQgZm91bmQgbnVtYmVyLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FzTnVtYmVyKCknLCAoKSA9PiB7XG4gICAgY29uc3QgY2FwdHVyZSA9IG5ldyBDYXB0dXJlKCk7XG4gICAgY29uc3QgbWF0Y2hlciA9IE1hdGNoLm9iamVjdEVxdWFscyh7IGZvbzogY2FwdHVyZSB9KTtcblxuICAgIG1hdGNoZXIudGVzdCh7IGZvbzogMyB9KS5maW5pc2hlZCgpO1xuICAgIG1hdGNoZXIudGVzdCh7IGZvbzogJ2JhcicgfSkuZmluaXNoZWQoKTtcblxuICAgIGV4cGVjdChjYXB0dXJlLmFzTnVtYmVyKCkpLnRvRXF1YWwoMyk7XG4gICAgZXhwZWN0KGNhcHR1cmUubmV4dCgpKS50b0VxdWFsKHRydWUpO1xuICAgIGV4cGVjdCgoKSA9PiBjYXB0dXJlLmFzTnVtYmVyKCkpLnRvVGhyb3coL2V4cGVjdGVkIHRvIGJlIG51bWJlciBidXQgZm91bmQgc3RyaW5nLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FzQXJyYXkoKScsICgpID0+IHtcbiAgICBjb25zdCBjYXB0dXJlID0gbmV3IENhcHR1cmUoKTtcbiAgICBjb25zdCBtYXRjaGVyID0gTWF0Y2gub2JqZWN0RXF1YWxzKHsgZm9vOiBjYXB0dXJlIH0pO1xuXG4gICAgbWF0Y2hlci50ZXN0KHsgZm9vOiBbJ2JhciddIH0pLmZpbmlzaGVkKCk7XG4gICAgbWF0Y2hlci50ZXN0KHsgZm9vOiAnYmFyJyB9KS5maW5pc2hlZCgpO1xuXG4gICAgZXhwZWN0KGNhcHR1cmUuYXNBcnJheSgpKS50b0VxdWFsKFsnYmFyJ10pO1xuICAgIGV4cGVjdChjYXB0dXJlLm5leHQoKSkudG9FcXVhbCh0cnVlKTtcbiAgICBleHBlY3QoKCkgPT4gY2FwdHVyZS5hc0FycmF5KCkpLnRvVGhyb3coL2V4cGVjdGVkIHRvIGJlIGFycmF5IGJ1dCBmb3VuZCBzdHJpbmcvKTtcbiAgfSk7XG5cbiAgdGVzdCgnYXNPYmplY3QoKScsICgpID0+IHtcbiAgICBjb25zdCBjYXB0dXJlID0gbmV3IENhcHR1cmUoKTtcbiAgICBjb25zdCBtYXRjaGVyID0gTWF0Y2gub2JqZWN0RXF1YWxzKHsgZm9vOiBjYXB0dXJlIH0pO1xuXG4gICAgbWF0Y2hlci50ZXN0KHsgZm9vOiB7IGZyZWQ6ICd3YWxkbycgfSB9KS5maW5pc2hlZCgpO1xuICAgIG1hdGNoZXIudGVzdCh7IGZvbzogJ2JhcicgfSkuZmluaXNoZWQoKTtcblxuICAgIGV4cGVjdChjYXB0dXJlLmFzT2JqZWN0KCkpLnRvRXF1YWwoeyBmcmVkOiAnd2FsZG8nIH0pO1xuICAgIGV4cGVjdChjYXB0dXJlLm5leHQoKSkudG9FcXVhbCh0cnVlKTtcbiAgICBleHBlY3QoKCkgPT4gY2FwdHVyZS5hc09iamVjdCgpKS50b1Rocm93KC9leHBlY3RlZCB0byBiZSBvYmplY3QgYnV0IGZvdW5kIHN0cmluZy8pO1xuICB9KTtcblxuICB0ZXN0KCduZXN0ZWQgd2l0aGluIGFuIGFycmF5JywgKCkgPT4ge1xuICAgIGNvbnN0IGNhcHR1cmUgPSBuZXcgQ2FwdHVyZSgpO1xuICAgIGNvbnN0IG1hdGNoZXIgPSBNYXRjaC5vYmplY3RFcXVhbHMoeyBmb286IFsnYmFyJywgY2FwdHVyZV0gfSk7XG5cbiAgICBtYXRjaGVyLnRlc3QoeyBmb286IFsnYmFyJywgJ2JheiddIH0pLmZpbmlzaGVkKCk7XG4gICAgZXhwZWN0KGNhcHR1cmUuYXNTdHJpbmcoKSkudG9FcXVhbCgnYmF6Jyk7XG4gIH0pO1xuXG4gIHRlc3QoJ211bHRpcGxlIGNhcHR1cmVzJywgKCkgPT4ge1xuICAgIGNvbnN0IGNhcHR1cmUgPSBuZXcgQ2FwdHVyZSgpO1xuICAgIGNvbnN0IG1hdGNoZXIgPSBNYXRjaC5vYmplY3RFcXVhbHMoeyBmb286IGNhcHR1cmUsIHJlYWw6IHRydWUgfSk7XG5cbiAgICBtYXRjaGVyLnRlc3QoeyBmb286IDMsIHJlYWw6IHRydWUgfSkuZmluaXNoZWQoKTtcbiAgICBtYXRjaGVyLnRlc3QoeyBmb286IDUsIHJlYWw6IHRydWUgfSkuZmluaXNoZWQoKTtcbiAgICBtYXRjaGVyLnRlc3QoeyBmb286IDcsIHJlYWw6IGZhbHNlIH0pLmZpbmlzaGVkKCk7XG5cbiAgICBleHBlY3QoY2FwdHVyZS5hc051bWJlcigpKS50b0VxdWFsKDMpO1xuICAgIGV4cGVjdChjYXB0dXJlLm5leHQoKSkudG9FcXVhbCh0cnVlKTtcbiAgICBleHBlY3QoY2FwdHVyZS5hc051bWJlcigpKS50b0VxdWFsKDUpO1xuICAgIGV4cGVjdChjYXB0dXJlLm5leHQoKSkudG9FcXVhbChmYWxzZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ25lc3RlZCBwYXR0ZXJuIG1hdGNoJywgKCkgPT4ge1xuICAgIGNvbnN0IGNhcHR1cmUgPSBuZXcgQ2FwdHVyZShNYXRjaC5vYmplY3RMaWtlKHsgYmFyOiAnYmF6JyB9KSk7XG4gICAgY29uc3QgbWF0Y2hlciA9IE1hdGNoLm9iamVjdExpa2UoeyBmb286IGNhcHR1cmUgfSk7XG5cbiAgICBtYXRjaGVyLnRlc3Qoe1xuICAgICAgZm9vOiB7XG4gICAgICAgIGJhcjogJ2JheicsXG4gICAgICAgIGZyZWQ6ICd3YWxkbycsXG4gICAgICB9LFxuICAgIH0pLmZpbmlzaGVkKCk7XG5cbiAgICBleHBlY3QoY2FwdHVyZS5hc09iamVjdCgpKS50b0VxdWFsKHsgYmFyOiAnYmF6JywgZnJlZDogJ3dhbGRvJyB9KTtcbiAgICBleHBlY3QoY2FwdHVyZS5uZXh0KCkpLnRvRXF1YWwoZmFsc2UpO1xuICB9KTtcblxuICB0ZXN0KCduZXN0ZWQgcGF0dGVybiBkb2VzIG5vdCBtYXRjaCcsICgpID0+IHtcbiAgICBjb25zdCBjYXB0dXJlID0gbmV3IENhcHR1cmUoTWF0Y2gub2JqZWN0TGlrZSh7IGJhcjogJ2JheicgfSkpO1xuICAgIGNvbnN0IG1hdGNoZXIgPSBNYXRjaC5vYmplY3RMaWtlKHsgZm9vOiBjYXB0dXJlIH0pO1xuXG4gICAgbWF0Y2hlci50ZXN0KHtcbiAgICAgIGZvbzoge1xuICAgICAgICBmcmVkOiAnd2FsZG8nLFxuICAgICAgfSxcbiAgICB9KS5maW5pc2hlZCgpO1xuXG4gICAgZXhwZWN0KCgpID0+IGNhcHR1cmUuYXNPYmplY3QoKSkudG9UaHJvdygvTm8gdmFsdWUgY2FwdHVyZWQvKTtcbiAgfSk7XG5cbiAgdGVzdCgnY2FwdHVyZSBpbiBhcnJheXdpdGggYW5kIG9iamVjdGxpa2UnLCAoKSA9PiB7XG4gICAgY29uc3QgY2FwdHVyZSA9IG5ldyBDYXB0dXJlKCk7XG4gICAgY29uc3QgbWF0Y2hlciA9IE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgUGVvcGxlOiBNYXRjaC5hcnJheVdpdGgoW3tcbiAgICAgICAgTmFtZTogJ0FsaWNlJyxcbiAgICAgICAgQXR0cmlidXRlczogW1xuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgTmFtZTogJ0hhaXJDb2xvcicsXG4gICAgICAgICAgICBWYWx1ZTogY2FwdHVyZSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgXSxcbiAgICAgIH1dKSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IG1hdGNoZXIudGVzdCh7XG4gICAgICBQZW9wbGU6IFtcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICdBbGljZScsXG4gICAgICAgICAgQXR0cmlidXRlczogW1xuICAgICAgICAgICAgeyBOYW1lOiAnSGFpckNvbG9yJywgVmFsdWU6ICdCbGFjaycgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGV4cGVjdChyZXN1bHQuaXNTdWNjZXNzKS50b0VxdWFsKHRydWUpO1xuICAgIHJlc3VsdC5maW5pc2hlZCgpO1xuICAgIGV4cGVjdChjYXB0dXJlLmFzU3RyaW5nKCkpLnRvRXF1YWwoJ0JsYWNrJyk7XG4gIH0pO1xufSk7XG4iXX0=