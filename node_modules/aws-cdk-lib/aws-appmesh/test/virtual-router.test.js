"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const cdk = require("../../core");
const appmesh = require("../lib");
describe('virtual router', () => {
    describe('When creating a VirtualRouter', () => {
        test('should have appropriate defaults', () => {
            // GIVEN
            const stack = new cdk.Stack();
            const mesh = new appmesh.Mesh(stack, 'mesh', {
                meshName: 'test-mesh',
            });
            // WHEN
            mesh.addVirtualRouter('http-router-listener');
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::AppMesh::VirtualRouter', {
                VirtualRouterName: 'meshhttprouterlistenerF57BCB2F',
                Spec: {
                    Listeners: [
                        {
                            PortMapping: {
                                Port: 8080,
                                Protocol: appmesh.Protocol.HTTP,
                            },
                        },
                    ],
                },
            });
        });
        test('should have protocol variant listeners', () => {
            // GIVEN
            const stack = new cdk.Stack();
            const mesh = new appmesh.Mesh(stack, 'mesh', {
                meshName: 'test-mesh',
            });
            // WHEN
            mesh.addVirtualRouter('http-router-listener', {
                listeners: [
                    appmesh.VirtualRouterListener.http(),
                ],
                virtualRouterName: 'http-router-listener',
            });
            mesh.addVirtualRouter('http2-router-listener', {
                listeners: [
                    appmesh.VirtualRouterListener.http2(),
                ],
                virtualRouterName: 'http2-router-listener',
            });
            mesh.addVirtualRouter('grpc-router-listener', {
                listeners: [
                    appmesh.VirtualRouterListener.grpc(),
                ],
                virtualRouterName: 'grpc-router-listener',
            });
            mesh.addVirtualRouter('tcp-router-listener', {
                listeners: [
                    appmesh.VirtualRouterListener.tcp(),
                ],
                virtualRouterName: 'tcp-router-listener',
            });
            // THEN
            const expectedPorts = [appmesh.Protocol.HTTP, appmesh.Protocol.HTTP2, appmesh.Protocol.GRPC, appmesh.Protocol.TCP];
            expectedPorts.forEach(protocol => {
                assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::AppMesh::VirtualRouter', {
                    VirtualRouterName: `${protocol}-router-listener`,
                    Spec: {
                        Listeners: [
                            {
                                PortMapping: {
                                    Port: 8080,
                                    Protocol: protocol,
                                },
                            },
                        ],
                    },
                    MeshOwner: assertions_1.Match.absent(),
                });
            });
        });
        describe('with shared service mesh', () => {
            test('Mesh Owner is the AWS account ID of the account that shared the mesh with your account', () => {
                // GIVEN
                const app = new cdk.App();
                const meshEnv = { account: '1234567899', region: 'us-west-2' };
                const virtualRouterEnv = { account: '9987654321', region: 'us-west-2' };
                // Creating stack in Account B
                const stack = new cdk.Stack(app, 'mySharedStack', { env: virtualRouterEnv });
                // Mesh is in Account A
                const sharedMesh = appmesh.Mesh.fromMeshArn(stack, 'shared-mesh', `arn:aws:appmesh:${meshEnv.region}:${meshEnv.account}:mesh/shared-mesh`);
                // WHEN
                new appmesh.VirtualRouter(stack, 'test-node', {
                    mesh: sharedMesh,
                });
                // THEN
                assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::AppMesh::VirtualRouter', {
                    MeshOwner: meshEnv.account,
                });
            });
        });
    });
    describe('When adding route to existing VirtualRouter', () => {
        test('should create route resource', () => {
            // GIVEN
            const stack = new cdk.Stack();
            // WHEN
            const mesh = new appmesh.Mesh(stack, 'mesh', {
                meshName: 'test-mesh',
            });
            const router = mesh.addVirtualRouter('router');
            const service1 = new appmesh.VirtualService(stack, 'service-1', {
                virtualServiceName: 'service1.domain.local',
                virtualServiceProvider: appmesh.VirtualServiceProvider.none(mesh),
            });
            const node = mesh.addVirtualNode('test-node', {
                serviceDiscovery: appmesh.ServiceDiscovery.dns('test'),
                listeners: [appmesh.VirtualNodeListener.http({
                        port: 8080,
                    })],
                backends: [appmesh.Backend.virtualService(service1)],
            });
            router.addRoute('route-1', {
                routeSpec: appmesh.RouteSpec.http({
                    weightedTargets: [
                        {
                            virtualNode: node,
                            weight: 50,
                        },
                    ],
                    match: {
                        path: appmesh.HttpRoutePathMatch.startsWith('/'),
                    },
                }),
            });
            // THEN
            assertions_1.Template.fromStack(stack).
                hasResourceProperties('AWS::AppMesh::Route', {
                RouteName: 'route-1',
                Spec: {
                    HttpRoute: {
                        Action: {
                            WeightedTargets: [
                                {
                                    VirtualNode: {
                                        'Fn::GetAtt': ['meshtestnodeF93946D4', 'VirtualNodeName'],
                                    },
                                    Weight: 50,
                                },
                            ],
                        },
                        Match: {
                            Prefix: '/',
                        },
                    },
                },
                VirtualRouterName: {
                    'Fn::GetAtt': ['meshrouter81B8087E', 'VirtualRouterName'],
                },
            });
        });
    });
    describe('When adding routes to a VirtualRouter with existing routes', () => {
        test('should add routes and not overwrite', () => {
            // GIVEN
            const stack = new cdk.Stack();
            // WHEN
            const mesh = new appmesh.Mesh(stack, 'mesh', {
                meshName: 'test-mesh',
            });
            const router = mesh.addVirtualRouter('router');
            const service1 = new appmesh.VirtualService(stack, 'service-1', {
                virtualServiceName: 'service1.domain.local',
                virtualServiceProvider: appmesh.VirtualServiceProvider.none(mesh),
            });
            const service2 = new appmesh.VirtualService(stack, 'service-2', {
                virtualServiceName: 'service2.domain.local',
                virtualServiceProvider: appmesh.VirtualServiceProvider.none(mesh),
            });
            const node = mesh.addVirtualNode('test-node', {
                serviceDiscovery: appmesh.ServiceDiscovery.dns('test'),
                listeners: [appmesh.VirtualNodeListener.http({
                        port: 8080,
                    })],
                backends: [appmesh.Backend.virtualService(service1)],
            });
            const node2 = mesh.addVirtualNode('test-node2', {
                serviceDiscovery: appmesh.ServiceDiscovery.dns('test'),
                listeners: [appmesh.VirtualNodeListener.http({
                        port: 8080,
                    })],
                backends: [appmesh.Backend.virtualService(service2)],
            });
            const node3 = mesh.addVirtualNode('test-node3', {
                serviceDiscovery: appmesh.ServiceDiscovery.dns('test'),
                listeners: [appmesh.VirtualNodeListener.http({
                        port: 8080,
                    })],
                backends: [appmesh.Backend.virtualService(service1)],
            });
            router.addRoute('route-1', {
                routeSpec: appmesh.RouteSpec.http({
                    weightedTargets: [
                        {
                            virtualNode: node,
                            weight: 50,
                        },
                    ],
                    match: {
                        path: appmesh.HttpRoutePathMatch.startsWith('/'),
                    },
                }),
            });
            router.addRoute('route-2', {
                routeSpec: appmesh.RouteSpec.http({
                    weightedTargets: [
                        {
                            virtualNode: node2,
                            weight: 30,
                        },
                    ],
                    match: {
                        path: appmesh.HttpRoutePathMatch.startsWith('/path2'),
                    },
                }),
            });
            router.addRoute('route-3', {
                routeSpec: appmesh.RouteSpec.http({
                    weightedTargets: [
                        {
                            virtualNode: node3,
                            weight: 20,
                        },
                    ],
                    match: {
                        path: appmesh.HttpRoutePathMatch.startsWith('/path3'),
                    },
                }),
            });
            // THEN
            assertions_1.Template.fromStack(stack).
                hasResourceProperties('AWS::AppMesh::Route', {
                RouteName: 'route-1',
                Spec: {
                    HttpRoute: {
                        Action: {
                            WeightedTargets: [
                                {
                                    VirtualNode: {
                                        'Fn::GetAtt': ['meshtestnodeF93946D4', 'VirtualNodeName'],
                                    },
                                    Weight: 50,
                                },
                            ],
                        },
                        Match: {
                            Prefix: '/',
                        },
                    },
                },
            });
            assertions_1.Template.fromStack(stack).
                hasResourceProperties('AWS::AppMesh::Route', {
                RouteName: 'route-2',
                Spec: {
                    HttpRoute: {
                        Action: {
                            WeightedTargets: [
                                {
                                    VirtualNode: {
                                        'Fn::GetAtt': ['meshtestnode20C58B1B2', 'VirtualNodeName'],
                                    },
                                    Weight: 30,
                                },
                            ],
                        },
                        Match: {
                            Prefix: '/path2',
                        },
                    },
                },
            });
            assertions_1.Template.fromStack(stack).
                hasResourceProperties('AWS::AppMesh::Route', {
                RouteName: 'route-3',
                Spec: {
                    HttpRoute: {
                        Action: {
                            WeightedTargets: [
                                {
                                    VirtualNode: {
                                        'Fn::GetAtt': ['meshtestnode316EEA2D7', 'VirtualNodeName'],
                                    },
                                    Weight: 20,
                                },
                            ],
                        },
                        Match: {
                            Prefix: '/path3',
                        },
                    },
                },
            });
        });
    });
    describe('When adding a TCP route to existing VirtualRouter', () => {
        test('should create route resource', () => {
            // GIVEN
            const stack = new cdk.Stack();
            // WHEN
            const mesh = new appmesh.Mesh(stack, 'mesh', {
                meshName: 'test-mesh',
            });
            const router = mesh.addVirtualRouter('router');
            const service1 = new appmesh.VirtualService(stack, 'service-1', {
                virtualServiceName: 'service1.domain.local',
                virtualServiceProvider: appmesh.VirtualServiceProvider.none(mesh),
            });
            const node = mesh.addVirtualNode('test-node', {
                serviceDiscovery: appmesh.ServiceDiscovery.dns('test'),
                listeners: [appmesh.VirtualNodeListener.http({
                        port: 8080,
                    })],
                backends: [appmesh.Backend.virtualService(service1)],
            });
            router.addRoute('route-tcp-1', {
                routeSpec: appmesh.RouteSpec.tcp({
                    weightedTargets: [
                        {
                            virtualNode: node,
                            weight: 50,
                        },
                    ],
                }),
            });
            // THEN
            assertions_1.Template.fromStack(stack).
                hasResourceProperties('AWS::AppMesh::Route', {
                RouteName: 'route-tcp-1',
                Spec: {
                    TcpRoute: {
                        Action: {
                            WeightedTargets: [
                                {
                                    VirtualNode: {
                                        'Fn::GetAtt': ['meshtestnodeF93946D4', 'VirtualNodeName'],
                                    },
                                    Weight: 50,
                                },
                            ],
                        },
                    },
                },
                VirtualRouterName: {
                    'Fn::GetAtt': ['meshrouter81B8087E', 'VirtualRouterName'],
                },
            });
        });
    });
    test('Can import Virtual Routers using an ARN', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const meshName = 'testMesh';
        const virtualRouterName = 'virtual-router';
        const arn = `arn:aws:appmesh:us-east-1:123456789012:mesh/${meshName}/virtualRouter/${virtualRouterName}`;
        // WHEN
        const virtualRouter = appmesh.VirtualRouter.fromVirtualRouterArn(stack, 'importedVirtualRouter', arn);
        // THEN
        expect(virtualRouter.mesh.meshName).toEqual(meshName);
        expect(virtualRouter.virtualRouterName).toEqual(virtualRouterName);
    });
    test('Can import Virtual Routers using attributes', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const meshName = 'testMesh';
        const virtualRouterName = 'virtual-router';
        // WHEN
        const virtualRouter1 = appmesh.VirtualRouter.fromVirtualRouterAttributes(stack, 'importVirtualRouter', {
            mesh: appmesh.Mesh.fromMeshName(stack, 'Mesh', meshName),
            virtualRouterName: virtualRouterName,
        });
        // THEN
        expect(virtualRouter1.mesh.meshName).toEqual(meshName);
        expect(virtualRouter1.virtualRouterName).toEqual(virtualRouterName);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlydHVhbC1yb3V0ZXIudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInZpcnR1YWwtcm91dGVyLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBbUQ7QUFDbkQsa0NBQWtDO0FBQ2xDLGtDQUFrQztBQUVsQyxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO0lBQzlCLFFBQVEsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7UUFDN0MsSUFBSSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtZQUM1QyxRQUFRO1lBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDOUIsTUFBTSxJQUFJLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUU7Z0JBQzNDLFFBQVEsRUFBRSxXQUFXO2FBQ3RCLENBQUMsQ0FBQztZQUVILE9BQU87WUFDUCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsc0JBQXNCLENBQUMsQ0FBQztZQUU5QyxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyw2QkFBNkIsRUFBRTtnQkFDN0UsaUJBQWlCLEVBQUUsZ0NBQWdDO2dCQUNuRCxJQUFJLEVBQUU7b0JBQ0osU0FBUyxFQUFFO3dCQUNUOzRCQUNFLFdBQVcsRUFBRTtnQ0FDWCxJQUFJLEVBQUUsSUFBSTtnQ0FDVixRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJOzZCQUNoQzt5QkFDRjtxQkFDRjtpQkFDRjthQUNGLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLHdDQUF3QyxFQUFFLEdBQUcsRUFBRTtZQUNsRCxRQUFRO1lBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDOUIsTUFBTSxJQUFJLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFB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QUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsUUFBUSxDQUFDO1lBQ3hELGlCQUFpQixFQUFFLGlCQUFpQjtTQUNyQyxDQUFDLENBQUM7UUFFSCxPQUFPO1FBQ1AsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZELE1BQU0sQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUN0RSxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWF0Y2gsIFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgKiBhcyBhcHBtZXNoIGZyb20gJy4uL2xpYic7XG5cbmRlc2NyaWJlKCd2aXJ0dWFsIHJvdXRlcicsICgpID0+IHtcbiAgZGVzY3JpYmUoJ1doZW4gY3JlYXRpbmcgYSBWaXJ0dWFsUm91dGVyJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIGFwcHJvcHJpYXRlIGRlZmF1bHRzJywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgICAgY29uc3QgbWVzaCA9IG5ldyBhcHBtZXNoLk1lc2goc3RhY2ssICdtZXNoJywge1xuICAgICAgICBtZXNoTmFtZTogJ3Rlc3QtbWVzaCcsXG4gICAgICB9KTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgbWVzaC5hZGRWaXJ0dWFsUm91dGVyKCdodHRwLXJvdXRlci1saXN0ZW5lcicpO1xuXG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpBcHBNZXNoOjpWaXJ0dWFsUm91dGVyJywge1xuICAgICAgICBWaXJ0dWFsUm91dGVyTmFtZTogJ21lc2hodHRwcm91dGVybGlzdGVuZXJGNTdCQ0IyRicsXG4gICAgICAgIFNwZWM6IHtcbiAgICAgICAgICBMaXN0ZW5lcnM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgUG9ydE1hcHBpbmc6IHtcbiAgICAgICAgICAgICAgICBQb3J0OiA4MDgwLFxuICAgICAgICAgICAgICAgIFByb3RvY29sOiBhcHBtZXNoLlByb3RvY29sLkhUVFAsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYXZlIHByb3RvY29sIHZhcmlhbnQgbGlzdGVuZXJzJywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgICAgY29uc3QgbWVzaCA9IG5ldyBhcHBtZXNoLk1lc2goc3RhY2ssICdtZXNoJywge1xuICAgICAgICBtZXNoTmFtZTogJ3Rlc3QtbWVzaCcsXG4gICAgICB9KTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgbWVzaC5hZGRWaXJ0dWFsUm91dGVyKCdodHRwLXJvdXRlci1saXN0ZW5lcicsIHtcbiAgICAgICAgbGlzdGVuZXJzOiBbXG4gICAgICAgICAgYXBwbWVzaC5WaXJ0dWFsUm91dGVyTGlzdGVuZXIuaHR0cCgpLFxuICAgICAgICBdLFxuICAgICAgICB2aXJ0dWFsUm91dGVyTmFtZTogJ2h0dHAtcm91dGVyLWxpc3RlbmVyJyxcbiAgICAgIH0pO1xuXG4gICAgICBtZXNoLmFkZFZpcnR1YWxSb3V0ZXIoJ2h0dHAyLXJvdXRlci1saXN0ZW5lcicsIHtcbiAgICAgICAgbGlzdGVuZXJzOiBbXG4gICAgICAgICAgYXBwbWVzaC5WaXJ0dWFsUm91dGVyTGlzdGVuZXIuaHR0cDIoKSxcbiAgICAgICAgXSxcbiAgICAgICAgdmlydHVhbFJvdXRlck5hbWU6ICdodHRwMi1yb3V0ZXItbGlzdGVuZXInLFxuICAgICAgfSk7XG5cbiAgICAgIG1lc2guYWRkVmlydHVhbFJvdXRlcignZ3JwYy1yb3V0ZXItbGlzdGVuZXInLCB7XG4gICAgICAgIGxpc3RlbmVyczogW1xuICAgICAgICAgIGFwcG1lc2guVmlydHVhbFJvdXRlckxpc3RlbmVyLmdycGMoKSxcbiAgICAgICAgXSxcbiAgICAgICAgdmlydHVhbFJvdXRlck5hbWU6ICdncnBjLXJvdXRlci1saXN0ZW5lcicsXG4gICAgICB9KTtcblxuICAgICAgbWVzaC5hZGRWaXJ0dWFsUm91dGVyKCd0Y3Atcm91dGVyLWxpc3RlbmVyJywge1xuICAgICAgICBsaXN0ZW5lcnM6IFtcbiAgICAgICAgICBhcHBtZXNoLlZpcnR1YWxSb3V0ZXJMaXN0ZW5lci50Y3AoKSxcbiAgICAgICAgXSxcbiAgICAgICAgdmlydHVhbFJvdXRlck5hbWU6ICd0Y3Atcm91dGVyLWxpc3RlbmVyJyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBjb25zdCBleHBlY3RlZFBvcnRzID0gW2FwcG1lc2guUHJvdG9jb2wuSFRUUCwgYXBwbWVzaC5Qcm90b2NvbC5IVFRQMiwgYXBwbWVzaC5Qcm90b2NvbC5HUlBDLCBhcHBtZXNoLlByb3RvY29sLlRDUF07XG4gICAgICBleHBlY3RlZFBvcnRzLmZvckVhY2gocHJvdG9jb2wgPT4ge1xuICAgICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpBcHBNZXNoOjpWaXJ0dWFsUm91dGVyJywge1xuICAgICAgICAgIFZpcnR1YWxSb3V0ZXJOYW1lOiBgJHtwcm90b2NvbH0tcm91dGVyLWxpc3RlbmVyYCxcbiAgICAgICAgICBTcGVjOiB7XG4gICAgICAgICAgICBMaXN0ZW5lcnM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFBvcnRNYXBwaW5nOiB7XG4gICAgICAgICAgICAgICAgICBQb3J0OiA4MDgwLFxuICAgICAgICAgICAgICAgICAgUHJvdG9jb2w6IHByb3RvY29sLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgTWVzaE93bmVyOiBNYXRjaC5hYnNlbnQoKSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCd3aXRoIHNoYXJlZCBzZXJ2aWNlIG1lc2gnLCAoKSA9PiB7XG4gICAgICB0ZXN0KCdNZXNoIE93bmVyIGlzIHRoZSBBV1MgYWNjb3VudCBJRCBvZiB0aGUgYWNjb3VudCB0aGF0IHNoYXJlZCB0aGUgbWVzaCB3aXRoIHlvdXIgYWNjb3VudCcsICgpID0+IHtcbiAgICAgICAgLy8gR0lWRU5cbiAgICAgICAgY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTtcbiAgICAgICAgY29uc3QgbWVzaEVudiA9IHsgYWNjb3VudDogJzEyMzQ1Njc4OTknLCByZWdpb246ICd1cy13ZXN0LTInIH07XG4gICAgICAgIGNvbnN0IHZpcnR1YWxSb3V0ZXJFbnYgPSB7IGFjY291bnQ6ICc5OTg3NjU0MzIxJywgcmVnaW9uOiAndXMtd2VzdC0yJyB9O1xuXG4gICAgICAgIC8vIENyZWF0aW5nIHN0YWNrIGluIEFjY291bnQgQlxuICAgICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soYXBwLCAnbXlTaGFyZWRTdGFjaycsIHsgZW52OiB2aXJ0dWFsUm91dGVyRW52IH0pO1xuICAgICAgICAvLyBNZXNoIGlzIGluIEFjY291bnQgQVxuICAgICAgICBjb25zdCBzaGFyZWRNZXNoID0gYXBwbWVzaC5NZXNoLmZyb21NZXNoQXJuKHN0YWNrLCAnc2hhcmVkLW1lc2gnLFxuICAgICAgICAgIGBhcm46YXdzOmFwcG1lc2g6JHttZXNoRW52LnJlZ2lvbn06JHttZXNoRW52LmFjY291bnR9Om1lc2gvc2hhcmVkLW1lc2hgKTtcblxuICAgICAgICAvLyBXSEVOXG4gICAgICAgIG5ldyBhcHBtZXNoLlZpcnR1YWxSb3V0ZXIoc3RhY2ssICd0ZXN0LW5vZGUnLCB7XG4gICAgICAgICAgbWVzaDogc2hhcmVkTWVzaCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVEhFTlxuICAgICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpBcHBNZXNoOjpWaXJ0dWFsUm91dGVyJywge1xuICAgICAgICAgIE1lc2hPd25lcjogbWVzaEVudi5hY2NvdW50LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnV2hlbiBhZGRpbmcgcm91dGUgdG8gZXhpc3RpbmcgVmlydHVhbFJvdXRlcicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgY3JlYXRlIHJvdXRlIHJlc291cmNlJywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBtZXNoID0gbmV3IGFwcG1lc2guTWVzaChzdGFjaywgJ21lc2gnLCB7XG4gICAgICAgIG1lc2hOYW1lOiAndGVzdC1tZXNoJyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByb3V0ZXIgPSBtZXNoLmFkZFZpcnR1YWxSb3V0ZXIoJ3JvdXRlcicpO1xuXG4gICAgICBjb25zdCBzZXJ2aWNlMSA9IG5ldyBhcHBtZXNoLlZpcnR1YWxTZXJ2aWNlKHN0YWNrLCAnc2VydmljZS0xJywge1xuICAgICAgICB2aXJ0dWFsU2VydmljZU5hbWU6ICdzZXJ2aWNlMS5kb21haW4ubG9jYWwnLFxuICAgICAgICB2aXJ0dWFsU2VydmljZVByb3ZpZGVyOiBhcHBtZXNoLlZpcnR1YWxTZXJ2aWNlUHJvdmlkZXIubm9uZShtZXNoKSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBub2RlID0gbWVzaC5hZGRWaXJ0dWFsTm9kZSgndGVzdC1ub2RlJywge1xuICAgICAgICBzZXJ2aWNlRGlzY292ZXJ5OiBhcHBtZXNoLlNlcnZpY2VEaXNjb3ZlcnkuZG5zKCd0ZXN0JyksXG4gICAgICAgIGxpc3RlbmVyczogW2FwcG1lc2guVmlydHVhbE5vZGVMaXN0ZW5lci5odHRwKHtcbiAgICAgICAgICBwb3J0OiA4MDgwLFxuICAgICAgICB9KV0sXG4gICAgICAgIGJhY2tlbmRzOiBbYXBwbWVzaC5CYWNrZW5kLnZpcnR1YWxTZXJ2aWNlKHNlcnZpY2UxKV0sXG4gICAgICB9KTtcblxuICAgICAgcm91dGVyLmFkZFJvdXRlKCdyb3V0ZS0xJywge1xuICAgICAgICByb3V0ZVNwZWM6IGFwcG1lc2guUm91dGVTcGVjLmh0dHAoe1xuICAgICAgICAgIHdlaWdodGVkVGFyZ2V0czogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB2aXJ0dWFsTm9kZTogbm9kZSxcbiAgICAgICAgICAgICAgd2VpZ2h0OiA1MCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICBtYXRjaDoge1xuICAgICAgICAgICAgcGF0aDogYXBwbWVzaC5IdHRwUm91dGVQYXRoTWF0Y2guc3RhcnRzV2l0aCgnLycpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuXG4gICAgICAgIGhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpBcHBNZXNoOjpSb3V0ZScsIHtcbiAgICAgICAgICBSb3V0ZU5hbWU6ICdyb3V0ZS0xJyxcbiAgICAgICAgICBTcGVjOiB7XG4gICAgICAgICAgICBIdHRwUm91dGU6IHtcbiAgICAgICAgICAgICAgQWN0aW9uOiB7XG4gICAgICAgICAgICAgICAgV2VpZ2h0ZWRUYXJnZXRzOiBbXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIFZpcnR1YWxOb2RlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbJ21lc2h0ZXN0bm9kZUY5Mzk0NkQ0JywgJ1ZpcnR1YWxOb2RlTmFtZSddLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBXZWlnaHQ6IDUwLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBNYXRjaDoge1xuICAgICAgICAgICAgICAgIFByZWZpeDogJy8nLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIFZpcnR1YWxSb3V0ZXJOYW1lOiB7XG4gICAgICAgICAgICAnRm46OkdldEF0dCc6IFsnbWVzaHJvdXRlcjgxQjgwODdFJywgJ1ZpcnR1YWxSb3V0ZXJOYW1lJ10sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnV2hlbiBhZGRpbmcgcm91dGVzIHRvIGEgVmlydHVhbFJvdXRlciB3aXRoIGV4aXN0aW5nIHJvdXRlcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgYWRkIHJvdXRlcyBhbmQgbm90IG92ZXJ3cml0ZScsICgpID0+IHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgbWVzaCA9IG5ldyBhcHBtZXNoLk1lc2goc3RhY2ssICdtZXNoJywge1xuICAgICAgICBtZXNoTmFtZTogJ3Rlc3QtbWVzaCcsXG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgcm91dGVyID0gbWVzaC5hZGRWaXJ0dWFsUm91dGVyKCdyb3V0ZXInKTtcblxuICAgICAgY29uc3Qgc2VydmljZTEgPSBuZXcgYXBwbWVzaC5WaXJ0dWFsU2VydmljZShzdGFjaywgJ3NlcnZpY2UtMScsIHtcbiAgICAgICAgdmlydHVhbFNlcnZpY2VOYW1lOiAnc2VydmljZTEuZG9tYWluLmxvY2FsJyxcbiAgICAgICAgdmlydHVhbFNlcnZpY2VQcm92aWRlcjogYXBwbWVzaC5WaXJ0dWFsU2VydmljZVByb3ZpZGVyLm5vbmUobWVzaCksXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHNlcnZpY2UyID0gbmV3IGFwcG1lc2guVmlydHVhbFNlcnZpY2Uoc3RhY2ssICdzZXJ2aWNlLTInLCB7XG4gICAgICAgIHZpcnR1YWxTZXJ2aWNlTmFtZTogJ3NlcnZpY2UyLmRvbWFpbi5sb2NhbCcsXG4gICAgICAgIHZpcnR1YWxTZXJ2aWNlUHJvdmlkZXI6IGFwcG1lc2guVmlydHVhbFNlcnZpY2VQcm92aWRlci5ub25lKG1lc2gpLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IG5vZGUgPSBtZXNoLmFkZFZpcnR1YWxOb2RlKCd0ZXN0LW5vZGUnLCB7XG4gICAgICAgIHNlcnZpY2VEaXNjb3Zlcnk6IGFwcG1lc2guU2VydmljZURpc2NvdmVyeS5kbnMoJ3Rlc3QnKSxcbiAgICAgICAgbGlzdGVuZXJzOiBbYXBwbWVzaC5WaXJ0dWFsTm9kZUxpc3RlbmVyLmh0dHAoe1xuICAgICAgICAgIHBvcnQ6IDgwODAsXG4gICAgICAgIH0pXSxcbiAgICAgICAgYmFja2VuZHM6IFthcHBtZXNoLkJhY2tlbmQudmlydHVhbFNlcnZpY2Uoc2VydmljZTEpXSxcbiAgICAgIH0pO1xuICAgICAgY29uc3Qgbm9kZTIgPSBtZXNoLmFkZFZpcnR1YWxOb2RlKCd0ZXN0LW5vZGUyJywge1xuICAgICAgICBzZXJ2aWNlRGlzY292ZXJ5OiBhcHBtZXNoLlNlcnZpY2VEaXNjb3ZlcnkuZG5zKCd0ZXN0JyksXG4gICAgICAgIGxpc3RlbmVyczogW2FwcG1lc2guVmlydHVhbE5vZGVMaXN0ZW5lci5odHRwKHtcbiAgICAgICAgICBwb3J0OiA4MDgwLFxuICAgICAgICB9KV0sXG4gICAgICAgIGJhY2tlbmRzOiBbYXBwbWVzaC5CYWNrZW5kLnZpcnR1YWxTZXJ2aWNlKHNlcnZpY2UyKV0sXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IG5vZGUzID0gbWVzaC5hZGRWaXJ0dWFsTm9kZSgndGVzdC1ub2RlMycsIHtcbiAgICAgICAgc2VydmljZURpc2NvdmVyeTogYXBwbWVzaC5TZXJ2aWNlRGlzY292ZXJ5LmRucygndGVzdCcpLFxuICAgICAgICBsaXN0ZW5lcnM6IFthcHBtZXNoLlZpcnR1YWxOb2RlTGlzdGVuZXIuaHR0cCh7XG4gICAgICAgICAgcG9ydDogODA4MCxcbiAgICAgICAgfSldLFxuICAgICAgICBiYWNrZW5kczogW2FwcG1lc2guQmFja2VuZC52aXJ0dWFsU2VydmljZShzZXJ2aWNlMSldLFxuICAgICAgfSk7XG5cbiAgICAgIHJvdXRlci5hZGRSb3V0ZSgncm91dGUtMScsIHtcbiAgICAgICAgcm91dGVTcGVjOiBhcHBtZXNoLlJvdXRlU3BlYy5odHRwKHtcbiAgICAgICAgICB3ZWlnaHRlZFRhcmdldHM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdmlydHVhbE5vZGU6IG5vZGUsXG4gICAgICAgICAgICAgIHdlaWdodDogNTAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgbWF0Y2g6IHtcbiAgICAgICAgICAgIHBhdGg6IGFwcG1lc2guSHR0cFJvdXRlUGF0aE1hdGNoLnN0YXJ0c1dpdGgoJy8nKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuXG4gICAgICByb3V0ZXIuYWRkUm91dGUoJ3JvdXRlLTInLCB7XG4gICAgICAgIHJvdXRlU3BlYzogYXBwbWVzaC5Sb3V0ZVNwZWMuaHR0cCh7XG4gICAgICAgICAgd2VpZ2h0ZWRUYXJnZXRzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHZpcnR1YWxOb2RlOiBub2RlMixcbiAgICAgICAgICAgICAgd2VpZ2h0OiAzMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICBtYXRjaDoge1xuICAgICAgICAgICAgcGF0aDogYXBwbWVzaC5IdHRwUm91dGVQYXRoTWF0Y2guc3RhcnRzV2l0aCgnL3BhdGgyJyksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICB9KTtcblxuICAgICAgcm91dGVyLmFkZFJvdXRlKCdyb3V0ZS0zJywge1xuICAgICAgICByb3V0ZVNwZWM6IGFwcG1lc2guUm91dGVTcGVjLmh0dHAoe1xuICAgICAgICAgIHdlaWdodGVkVGFyZ2V0czogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB2aXJ0dWFsTm9kZTogbm9kZTMsXG4gICAgICAgICAgICAgIHdlaWdodDogMjAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgbWF0Y2g6IHtcbiAgICAgICAgICAgIHBhdGg6IGFwcG1lc2guSHR0cFJvdXRlUGF0aE1hdGNoLnN0YXJ0c1dpdGgoJy9wYXRoMycpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuXG4gICAgICAgIGhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpBcHBNZXNoOjpSb3V0ZScsIHtcbiAgICAgICAgICBSb3V0ZU5hbWU6ICdyb3V0ZS0xJyxcbiAgICAgICAgICBTcGVjOiB7XG4gICAgICAgICAgICBIdHRwUm91dGU6IHtcbiAgICAgICAgICAgICAgQWN0aW9uOiB7XG4gICAgICAgICAgICAgICAgV2VpZ2h0ZWRUYXJnZXRzOiBbXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIFZpcnR1YWxOb2RlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbJ21lc2h0ZXN0bm9kZUY5Mzk0NkQ0JywgJ1ZpcnR1YWxOb2RlTmFtZSddLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBXZWlnaHQ6IDUwLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBNYXRjaDoge1xuICAgICAgICAgICAgICAgIFByZWZpeDogJy8nLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5cbiAgICAgICAgaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkFwcE1lc2g6OlJvdXRlJywge1xuICAgICAgICAgIFJvdXRlTmFtZTogJ3JvdXRlLTInLFxuICAgICAgICAgIFNwZWM6IHtcbiAgICAgICAgICAgIEh0dHBSb3V0ZToge1xuICAgICAgICAgICAgICBBY3Rpb246IHtcbiAgICAgICAgICAgICAgICBXZWlnaHRlZFRhcmdldHM6IFtcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgVmlydHVhbE5vZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAnRm46OkdldEF0dCc6IFsnbWVzaHRlc3Rub2RlMjBDNThCMUIyJywgJ1ZpcnR1YWxOb2RlTmFtZSddLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBXZWlnaHQ6IDMwLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBNYXRjaDoge1xuICAgICAgICAgICAgICAgIFByZWZpeDogJy9wYXRoMicsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLlxuICAgICAgICBoYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6QXBwTWVzaDo6Um91dGUnLCB7XG4gICAgICAgICAgUm91dGVOYW1lOiAncm91dGUtMycsXG4gICAgICAgICAgU3BlYzoge1xuICAgICAgICAgICAgSHR0cFJvdXRlOiB7XG4gICAgICAgICAgICAgIEFjdGlvbjoge1xuICAgICAgICAgICAgICAgIFdlaWdodGVkVGFyZ2V0czogW1xuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsTm9kZToge1xuICAgICAgICAgICAgICAgICAgICAgICdGbjo6R2V0QXR0JzogWydtZXNodGVzdG5vZGUzMTZFRUEyRDcnLCAnVmlydHVhbE5vZGVOYW1lJ10sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFdlaWdodDogMjAsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIE1hdGNoOiB7XG4gICAgICAgICAgICAgICAgUHJlZml4OiAnL3BhdGgzJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnV2hlbiBhZGRpbmcgYSBUQ1Agcm91dGUgdG8gZXhpc3RpbmcgVmlydHVhbFJvdXRlcicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgY3JlYXRlIHJvdXRlIHJlc291cmNlJywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBtZXNoID0gbmV3IGFwcG1lc2guTWVzaChzdGFjaywgJ21lc2gnLCB7XG4gICAgICAgIG1lc2hOYW1lOiAndGVzdC1tZXNoJyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByb3V0ZXIgPSBtZXNoLmFkZFZpcnR1YWxSb3V0ZXIoJ3JvdXRlcicpO1xuXG4gICAgICBjb25zdCBzZXJ2aWNlMSA9IG5ldyBhcHBtZXNoLlZpcnR1YWxTZXJ2aWNlKHN0YWNrLCAnc2VydmljZS0xJywge1xuICAgICAgICB2aXJ0dWFsU2VydmljZU5hbWU6ICdzZXJ2aWNlMS5kb21haW4ubG9jYWwnLFxuICAgICAgICB2aXJ0dWFsU2VydmljZVByb3ZpZGVyOiBhcHBtZXNoLlZpcnR1YWxTZXJ2aWNlUHJvdmlkZXIubm9uZShtZXNoKSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBub2RlID0gbWVzaC5hZGRWaXJ0dWFsTm9kZSgndGVzdC1ub2RlJywge1xuICAgICAgICBzZXJ2aWNlRGlzY292ZXJ5OiBhcHBtZXNoLlNlcnZpY2VEaXNjb3ZlcnkuZG5zKCd0ZXN0JyksXG4gICAgICAgIGxpc3RlbmVyczogW2FwcG1lc2guVmlydHVhbE5vZGVMaXN0ZW5lci5odHRwKHtcbiAgICAgICAgICBwb3J0OiA4MDgwLFxuICAgICAgICB9KV0sXG4gICAgICAgIGJhY2tlbmRzOiBbYXBwbWVzaC5CYWNrZW5kLnZpcnR1YWxTZXJ2aWNlKHNlcnZpY2UxKV0sXG4gICAgICB9KTtcblxuICAgICAgcm91dGVyLmFkZFJvdXRlKCdyb3V0ZS10Y3AtMScsIHtcbiAgICAgICAgcm91dGVTcGVjOiBhcHBtZXNoLlJvdXRlU3BlYy50Y3Aoe1xuICAgICAgICAgIHdlaWdodGVkVGFyZ2V0czogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB2aXJ0dWFsTm9kZTogbm9kZSxcbiAgICAgICAgICAgICAgd2VpZ2h0OiA1MCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSksXG4gICAgICB9KTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5cbiAgICAgICAgaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkFwcE1lc2g6OlJvdXRlJywge1xuICAgICAgICAgIFJvdXRlTmFtZTogJ3JvdXRlLXRjcC0xJyxcbiAgICAgICAgICBTcGVjOiB7XG4gICAgICAgICAgICBUY3BSb3V0ZToge1xuICAgICAgICAgICAgICBBY3Rpb246IHtcbiAgICAgICAgICAgICAgICBXZWlnaHRlZFRhcmdldHM6IFtcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgVmlydHVhbE5vZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAnRm46OkdldEF0dCc6IFsnbWVzaHRlc3Rub2RlRjkzOTQ2RDQnLCAnVmlydHVhbE5vZGVOYW1lJ10sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFdlaWdodDogNTAsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgVmlydHVhbFJvdXRlck5hbWU6IHtcbiAgICAgICAgICAgICdGbjo6R2V0QXR0JzogWydtZXNocm91dGVyODFCODA4N0UnLCAnVmlydHVhbFJvdXRlck5hbWUnXSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnQ2FuIGltcG9ydCBWaXJ0dWFsIFJvdXRlcnMgdXNpbmcgYW4gQVJOJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgICBjb25zdCBtZXNoTmFtZSA9ICd0ZXN0TWVzaCc7XG4gICAgY29uc3QgdmlydHVhbFJvdXRlck5hbWUgPSAndmlydHVhbC1yb3V0ZXInO1xuICAgIGNvbnN0IGFybiA9IGBhcm46YXdzOmFwcG1lc2g6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjptZXNoLyR7bWVzaE5hbWV9L3ZpcnR1YWxSb3V0ZXIvJHt2aXJ0dWFsUm91dGVyTmFtZX1gO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHZpcnR1YWxSb3V0ZXIgPSBhcHBtZXNoLlZpcnR1YWxSb3V0ZXIuZnJvbVZpcnR1YWxSb3V0ZXJBcm4oXG4gICAgICBzdGFjaywgJ2ltcG9ydGVkVmlydHVhbFJvdXRlcicsIGFybik7XG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCh2aXJ0dWFsUm91dGVyLm1lc2gubWVzaE5hbWUpLnRvRXF1YWwobWVzaE5hbWUpO1xuICAgIGV4cGVjdCh2aXJ0dWFsUm91dGVyLnZpcnR1YWxSb3V0ZXJOYW1lKS50b0VxdWFsKHZpcnR1YWxSb3V0ZXJOYW1lKTtcbiAgfSk7XG4gIHRlc3QoJ0NhbiBpbXBvcnQgVmlydHVhbCBSb3V0ZXJzIHVzaW5nIGF0dHJpYnV0ZXMnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgIGNvbnN0IG1lc2hOYW1lID0gJ3Rlc3RNZXNoJztcbiAgICBjb25zdCB2aXJ0dWFsUm91dGVyTmFtZSA9ICd2aXJ0dWFsLXJvdXRlcic7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3QgdmlydHVhbFJvdXRlcjEgPSBhcHBtZXNoLlZpcnR1YWxSb3V0ZXIuZnJvbVZpcnR1YWxSb3V0ZXJBdHRyaWJ1dGVzKHN0YWNrLCAnaW1wb3J0VmlydHVhbFJvdXRlcicsIHtcbiAgICAgIG1lc2g6IGFwcG1lc2guTWVzaC5mcm9tTWVzaE5hbWUoc3RhY2ssICdNZXNoJywgbWVzaE5hbWUpLFxuICAgICAgdmlydHVhbFJvdXRlck5hbWU6IHZpcnR1YWxSb3V0ZXJOYW1lLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCh2aXJ0dWFsUm91dGVyMS5tZXNoLm1lc2hOYW1lKS50b0VxdWFsKG1lc2hOYW1lKTtcbiAgICBleHBlY3QodmlydHVhbFJvdXRlcjEudmlydHVhbFJvdXRlck5hbWUpLnRvRXF1YWwodmlydHVhbFJvdXRlck5hbWUpO1xuICB9KTtcbn0pO1xuIl19