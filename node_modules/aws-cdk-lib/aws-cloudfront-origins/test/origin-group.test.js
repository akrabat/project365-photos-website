"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const cloudfront = require("../../aws-cloudfront");
const s3 = require("../../aws-s3");
const core_1 = require("../../core");
const origins = require("../lib");
let stack;
let bucket;
let primaryOrigin;
beforeEach(() => {
    stack = new core_1.Stack();
    bucket = new s3.Bucket(stack, 'Bucket');
    primaryOrigin = new origins.S3Origin(bucket);
});
describe('Origin Groups', () => {
    test('correctly render the OriginGroups property of DistributionConfig', () => {
        const failoverOrigin = new origins.S3Origin(s3.Bucket.fromBucketName(stack, 'ImportedBucket', 'imported-bucket'));
        const originGroup = new origins.OriginGroup({
            primaryOrigin,
            fallbackOrigin: failoverOrigin,
            fallbackStatusCodes: [500],
        });
        new cloudfront.Distribution(stack, 'Distribution', {
            defaultBehavior: { origin: originGroup },
        });
        const primaryOriginId = 'DistributionOrigin13547B94F';
        const failoverOriginId = 'DistributionOrigin2C85CC43B';
        const originGroupId = 'DistributionOriginGroup1A1A31B49';
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                DefaultCacheBehavior: {
                    TargetOriginId: originGroupId,
                },
                Origins: [
                    {
                        Id: primaryOriginId,
                        DomainName: {
                            'Fn::GetAtt': ['Bucket83908E77', 'RegionalDomainName'],
                        },
                        S3OriginConfig: {
                            OriginAccessIdentity: {
                                'Fn::Join': ['', [
                                        'origin-access-identity/cloudfront/',
                                        { Ref: 'DistributionOrigin1S3Origin5F5C0696' },
                                    ]],
                            },
                        },
                    },
                    {
                        Id: failoverOriginId,
                        DomainName: {
                            'Fn::Join': ['', [
                                    'imported-bucket.s3.',
                                    { Ref: 'AWS::Region' },
                                    '.',
                                    { Ref: 'AWS::URLSuffix' },
                                ]],
                        },
                        S3OriginConfig: {
                            OriginAccessIdentity: {
                                'Fn::Join': ['', [
                                        'origin-access-identity/cloudfront/',
                                        { Ref: 'DistributionOrigin2S3OriginE484D4BF' },
                                    ]],
                            },
                        },
                    },
                ],
                OriginGroups: {
                    Items: [
                        {
                            FailoverCriteria: {
                                StatusCodes: {
                                    Items: [500],
                                    Quantity: 1,
                                },
                            },
                            Id: 'DistributionOriginGroup1A1A31B49',
                            Members: {
                                Items: [
                                    { OriginId: primaryOriginId },
                                    { OriginId: failoverOriginId },
                                ],
                                Quantity: 2,
                            },
                        },
                    ],
                    Quantity: 1,
                },
            },
        });
    });
    test('correctly render the OriginGroups property of DistributionConfig with originId set', () => {
        const failoverOrigin = new origins.S3Origin(s3.Bucket.fromBucketName(stack, 'ImportedBucket', 'imported-bucket'), { originId: 'MyCustomOrigin1' });
        const originGroup = new origins.OriginGroup({
            primaryOrigin,
            fallbackOrigin: failoverOrigin,
            fallbackStatusCodes: [500],
        });
        new cloudfront.Distribution(stack, 'Distribution', {
            defaultBehavior: { origin: originGroup },
        });
        const primaryOriginId = 'DistributionOrigin13547B94F';
        const originGroupId = 'DistributionOriginGroup1A1A31B49';
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                DefaultCacheBehavior: {
                    TargetOriginId: originGroupId,
                },
                Origins: [
                    {
                        Id: primaryOriginId,
                        DomainName: {
                            'Fn::GetAtt': ['Bucket83908E77', 'RegionalDomainName'],
                        },
                        S3OriginConfig: {
                            OriginAccessIdentity: {
                                'Fn::Join': ['', [
                                        'origin-access-identity/cloudfront/',
                                        { Ref: 'DistributionOrigin1S3Origin5F5C0696' },
                                    ]],
                            },
                        },
                    },
                    {
                        Id: 'MyCustomOrigin1',
                        DomainName: {
                            'Fn::Join': ['', [
                                    'imported-bucket.s3.',
                                    { Ref: 'AWS::Region' },
                                    '.',
                                    { Ref: 'AWS::URLSuffix' },
                                ]],
                        },
                        S3OriginConfig: {
                            OriginAccessIdentity: {
                                'Fn::Join': ['', [
                                        'origin-access-identity/cloudfront/',
                                        { Ref: 'DistributionOrigin2S3OriginE484D4BF' },
                                    ]],
                            },
                        },
                    },
                ],
                OriginGroups: {
                    Items: [
                        {
                            FailoverCriteria: {
                                StatusCodes: {
                                    Items: [500],
                                    Quantity: 1,
                                },
                            },
                            Id: 'DistributionOriginGroup1A1A31B49',
                            Members: {
                                Items: [
                                    { OriginId: primaryOriginId },
                                    { OriginId: 'MyCustomOrigin1' },
                                ],
                                Quantity: 2,
                            },
                        },
                    ],
                    Quantity: 1,
                },
            },
        });
    });
    test('cannot have an Origin with their own failover configuration as the primary Origin', () => {
        const failoverOrigin = new origins.S3Origin(s3.Bucket.fromBucketName(stack, 'ImportedBucket', 'imported-bucket'));
        const originGroup = new origins.OriginGroup({
            primaryOrigin,
            fallbackOrigin: failoverOrigin,
        });
        const groupOfGroups = new origins.OriginGroup({
            primaryOrigin: originGroup,
            fallbackOrigin: failoverOrigin,
        });
        expect(() => {
            new cloudfront.Distribution(stack, 'Distribution', {
                defaultBehavior: { origin: groupOfGroups },
            });
        }).toThrow(/An OriginGroup cannot use an Origin with its own failover configuration as its primary origin!/);
    });
    test('cannot have an Origin with their own failover configuration as the fallback Origin', () => {
        const originGroup = new origins.OriginGroup({
            primaryOrigin,
            fallbackOrigin: new origins.S3Origin(s3.Bucket.fromBucketName(stack, 'ImportedBucket', 'imported-bucket')),
        });
        const groupOfGroups = new origins.OriginGroup({
            primaryOrigin,
            fallbackOrigin: originGroup,
        });
        expect(() => {
            new cloudfront.Distribution(stack, 'Distribution', {
                defaultBehavior: { origin: groupOfGroups },
            });
        }).toThrow(/An Origin cannot use an Origin with its own failover configuration as its fallback origin!/);
    });
    test('cannot have an empty array of fallbackStatusCodes', () => {
        const failoverOrigin = new origins.S3Origin(s3.Bucket.fromBucketName(stack, 'ImportedBucket', 'imported-bucket'));
        const originGroup = new origins.OriginGroup({
            primaryOrigin,
            fallbackOrigin: failoverOrigin,
            fallbackStatusCodes: [],
        });
        expect(() => {
            new cloudfront.Distribution(stack, 'Distribution', {
                defaultBehavior: { origin: originGroup },
            });
        }).toThrow(/fallbackStatusCodes cannot be empty/);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JpZ2luLWdyb3VwLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJvcmlnaW4tZ3JvdXAudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUE0QztBQUM1QyxtREFBbUQ7QUFDbkQsbUNBQW1DO0FBQ25DLHFDQUFtQztBQUNuQyxrQ0FBa0M7QUFFbEMsSUFBSSxLQUFZLENBQUM7QUFDakIsSUFBSSxNQUFrQixDQUFDO0FBQ3ZCLElBQUksYUFBaUMsQ0FBQztBQUN0QyxVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2QsS0FBSyxHQUFHLElBQUksWUFBSyxFQUFFLENBQUM7SUFDcEIsTUFBTSxHQUFHLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDeEMsYUFBYSxHQUFHLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMvQyxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLElBQUksQ0FBQyxrRUFBa0UsRUFBRSxHQUFHLEVBQUU7UUFDNUUsTUFBTSxjQUFjLEdBQUcsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDLENBQUM7UUFDbEgsTUFBTSxXQUFXLEdBQUcsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUFDO1lBQzFDLGFBQWE7WUFDYixjQUFjLEVBQUUsY0FBYztZQUM5QixtQkFBbUIsRUFBRSxDQUFDLEdBQUcsQ0FBQztTQUMzQixDQUFDLENBQUM7UUFFSCxJQUFJLFVBQVUsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLGNBQWMsRUFBRTtZQUNqRCxlQUFlLEVBQUUsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFO1NBQ3pDLENBQUMsQ0FBQztRQUVILE1BQU0sZUFBZSxHQUFHLDZC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QzVCLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixJQUFJLFVBQVUsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLGNBQWMsRUFBRTtnQkFDakQsZUFBZSxFQUFFLEVBQUUsTUFBTSxFQUFFLGFBQWEsRUFBRTthQUMzQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsNEZBQTRGLENBQUMsQ0FBQztJQUMzRyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxtREFBbUQsRUFBRSxHQUFHLEVBQUU7UUFDN0QsTUFBTSxjQUFjLEdBQUcsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDLENBQUM7UUFDbEgsTUFBTSxXQUFXLEdBQUcsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUFDO1lBQzFDLGFBQWE7WUFDYixjQUFjLEVBQUUsY0FBYztZQUM5QixtQkFBbUIsRUFBRSxFQUFFO1NBQ3hCLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixJQUFJLFVBQVUsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLGNBQWMsRUFBRTtnQkFDakQsZUFBZSxFQUFFLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRTthQUN6QyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMscUNBQXFDLENBQUMsQ0FBQztJQUNwRCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVtcGxhdGUgfSBmcm9tICcuLi8uLi9hc3NlcnRpb25zJztcbmltcG9ydCAqIGFzIGNsb3VkZnJvbnQgZnJvbSAnLi4vLi4vYXdzLWNsb3VkZnJvbnQnO1xuaW1wb3J0ICogYXMgczMgZnJvbSAnLi4vLi4vYXdzLXMzJztcbmltcG9ydCB7IFN0YWNrIH0gZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgKiBhcyBvcmlnaW5zIGZyb20gJy4uL2xpYic7XG5cbmxldCBzdGFjazogU3RhY2s7XG5sZXQgYnVja2V0OiBzMy5JQnVja2V0O1xubGV0IHByaW1hcnlPcmlnaW46IGNsb3VkZnJvbnQuSU9yaWdpbjtcbmJlZm9yZUVhY2goKCkgPT4ge1xuICBzdGFjayA9IG5ldyBTdGFjaygpO1xuICBidWNrZXQgPSBuZXcgczMuQnVja2V0KHN0YWNrLCAnQnVja2V0Jyk7XG4gIHByaW1hcnlPcmlnaW4gPSBuZXcgb3JpZ2lucy5TM09yaWdpbihidWNrZXQpO1xufSk7XG5cbmRlc2NyaWJlKCdPcmlnaW4gR3JvdXBzJywgKCkgPT4ge1xuICB0ZXN0KCdjb3JyZWN0bHkgcmVuZGVyIHRoZSBPcmlnaW5Hcm91cHMgcHJvcGVydHkgb2YgRGlzdHJpYnV0aW9uQ29uZmlnJywgKCkgPT4ge1xuICAgIGNvbnN0IGZhaWxvdmVyT3JpZ2luID0gbmV3IG9yaWdpbnMuUzNPcmlnaW4oczMuQnVja2V0LmZyb21CdWNrZXROYW1lKHN0YWNrLCAnSW1wb3J0ZWRCdWNrZXQnLCAnaW1wb3J0ZWQtYnVja2V0JykpO1xuICAgIGNvbnN0IG9yaWdpbkdyb3VwID0gbmV3IG9yaWdpbnMuT3JpZ2luR3JvdXAoe1xuICAgICAgcHJpbWFyeU9yaWdpbixcbiAgICAgIGZhbGxiYWNrT3JpZ2luOiBmYWlsb3Zlck9yaWdpbixcbiAgICAgIGZhbGxiYWNrU3RhdHVzQ29kZXM6IFs1MDBdLFxuICAgIH0pO1xuXG4gICAgbmV3IGNsb3VkZnJvbnQuRGlzdHJpYnV0aW9uKHN0YWNrLCAnRGlzdHJpYnV0aW9uJywge1xuICAgICAgZGVmYXVsdEJlaGF2aW9yOiB7IG9yaWdpbjogb3JpZ2luR3JvdXAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHByaW1hcnlPcmlnaW5JZCA9ICdEaXN0cmlidXRpb25PcmlnaW4xMzU0N0I5NEYnO1xuICAgIGNvbnN0IGZhaWxvdmVyT3JpZ2luSWQgPSAnRGlzdHJpYnV0aW9uT3JpZ2luMkM4NUNDNDNCJztcbiAgICBjb25zdCBvcmlnaW5Hcm91cElkID0gJ0Rpc3RyaWJ1dGlvbk9yaWdpbkdyb3VwMUExQTMxQjQ5JztcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZEZyb250OjpEaXN0cmlidXRpb24nLCB7XG4gICAgICBEaXN0cmlidXRpb25Db25maWc6IHtcbiAgICAgICAgRGVmYXVsdENhY2hlQmVoYXZpb3I6IHtcbiAgICAgICAgICBUYXJnZXRPcmlnaW5JZDogb3JpZ2luR3JvdXBJZCxcbiAgICAgICAgfSxcbiAgICAgICAgT3JpZ2luczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIElkOiBwcmltYXJ5T3JpZ2luSWQsXG4gICAgICAgICAgICBEb21haW5OYW1lOiB7XG4gICAgICAgICAgICAgICdGbjo6R2V0QXR0JzogWydCdWNrZXQ4MzkwOEU3NycsICdSZWdpb25hbERvbWFpbk5hbWUnXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBTM09yaWdpbkNvbmZpZzoge1xuICAgICAgICAgICAgICBPcmlnaW5BY2Nlc3NJZGVudGl0eToge1xuICAgICAgICAgICAgICAgICdGbjo6Sm9pbic6IFsnJywgW1xuICAgICAgICAgICAgICAgICAgJ29yaWdpbi1hY2Nlc3MtaWRlbnRpdHkvY2xvdWRmcm9udC8nLFxuICAgICAgICAgICAgICAgICAgeyBSZWY6ICdEaXN0cmlidXRpb25PcmlnaW4xUzNPcmlnaW41RjVDMDY5NicgfSxcbiAgICAgICAgICAgICAgICBdXSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBJZDogZmFpbG92ZXJPcmlnaW5JZCxcbiAgICAgICAgICAgIERvbWFpbk5hbWU6IHtcbiAgICAgICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgICAgICAgJ2ltcG9ydGVkLWJ1Y2tldC5zMy4nLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpSZWdpb24nIH0sXG4gICAgICAgICAgICAgICAgJy4nLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpVUkxTdWZmaXgnIH0sXG4gICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFMzT3JpZ2luQ29uZmlnOiB7XG4gICAgICAgICAgICAgIE9yaWdpbkFjY2Vzc0lkZW50aXR5OiB7XG4gICAgICAgICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgICAgICAgICAnb3JpZ2luLWFjY2Vzcy1pZGVudGl0eS9jbG91ZGZyb250LycsXG4gICAgICAgICAgICAgICAgICB7IFJlZjogJ0Rpc3RyaWJ1dGlvbk9yaWdpbjJTM09yaWdpbkU0ODRENEJGJyB9LFxuICAgICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBPcmlnaW5Hcm91cHM6IHtcbiAgICAgICAgICBJdGVtczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBGYWlsb3ZlckNyaXRlcmlhOiB7XG4gICAgICAgICAgICAgICAgU3RhdHVzQ29kZXM6IHtcbiAgICAgICAgICAgICAgICAgIEl0ZW1zOiBbNTAwXSxcbiAgICAgICAgICAgICAgICAgIFF1YW50aXR5OiAxLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIElkOiAnRGlzdHJpYnV0aW9uT3JpZ2luR3JvdXAxQTFBMzFCNDknLFxuICAgICAgICAgICAgICBNZW1iZXJzOiB7XG4gICAgICAgICAgICAgICAgSXRlbXM6IFtcbiAgICAgICAgICAgICAgICAgIHsgT3JpZ2luSWQ6IHByaW1hcnlPcmlnaW5JZCB9LFxuICAgICAgICAgICAgICAgICAgeyBPcmlnaW5JZDogZmFpbG92ZXJPcmlnaW5JZCB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgUXVhbnRpdHk6IDIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgUXVhbnRpdHk6IDEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjb3JyZWN0bHkgcmVuZGVyIHRoZSBPcmlnaW5Hcm91cHMgcHJvcGVydHkgb2YgRGlzdHJpYnV0aW9uQ29uZmlnIHdpdGggb3JpZ2luSWQgc2V0JywgKCkgPT4ge1xuICAgIGNvbnN0IGZhaWxvdmVyT3JpZ2luID0gbmV3IG9yaWdpbnMuUzNPcmlnaW4oczMuQnVja2V0LmZyb21CdWNrZXROYW1lKHN0YWNrLCAnSW1wb3J0ZWRCdWNrZXQnLCAnaW1wb3J0ZWQtYnVja2V0JyksIHsgb3JpZ2luSWQ6ICdNeUN1c3RvbU9yaWdpbjEnIH0pO1xuICAgIGNvbnN0IG9yaWdpbkdyb3VwID0gbmV3IG9yaWdpbnMuT3JpZ2luR3JvdXAoe1xuICAgICAgcHJpbWFyeU9yaWdpbixcbiAgICAgIGZhbGxiYWNrT3JpZ2luOiBmYWlsb3Zlck9yaWdpbixcbiAgICAgIGZhbGxiYWNrU3RhdHVzQ29kZXM6IFs1MDBdLFxuICAgIH0pO1xuXG4gICAgbmV3IGNsb3VkZnJvbnQuRGlzdHJpYnV0aW9uKHN0YWNrLCAnRGlzdHJpYnV0aW9uJywge1xuICAgICAgZGVmYXVsdEJlaGF2aW9yOiB7IG9yaWdpbjogb3JpZ2luR3JvdXAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHByaW1hcnlPcmlnaW5JZCA9ICdEaXN0cmlidXRpb25PcmlnaW4xMzU0N0I5NEYnO1xuICAgIGNvbnN0IG9yaWdpbkdyb3VwSWQgPSAnRGlzdHJpYnV0aW9uT3JpZ2luR3JvdXAxQTFBMzFCNDknO1xuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkRpc3RyaWJ1dGlvbicsIHtcbiAgICAgIERpc3RyaWJ1dGlvbkNvbmZpZzoge1xuICAgICAgICBEZWZhdWx0Q2FjaGVCZWhhdmlvcjoge1xuICAgICAgICAgIFRhcmdldE9yaWdpbklkOiBvcmlnaW5Hcm91cElkLFxuICAgICAgICB9LFxuICAgICAgICBPcmlnaW5zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgSWQ6IHByaW1hcnlPcmlnaW5JZCxcbiAgICAgICAgICAgIERvbWFpbk5hbWU6IHtcbiAgICAgICAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbJ0J1Y2tldDgzOTA4RTc3JywgJ1JlZ2lvbmFsRG9tYWluTmFtZSddLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFMzT3JpZ2luQ29uZmlnOiB7XG4gICAgICAgICAgICAgIE9yaWdpbkFjY2Vzc0lkZW50aXR5OiB7XG4gICAgICAgICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgICAgICAgICAnb3JpZ2luLWFjY2Vzcy1pZGVudGl0eS9jbG91ZGZyb250LycsXG4gICAgICAgICAgICAgICAgICB7IFJlZjogJ0Rpc3RyaWJ1dGlvbk9yaWdpbjFTM09yaWdpbjVGNUMwNjk2JyB9LFxuICAgICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIElkOiAnTXlDdXN0b21PcmlnaW4xJyxcbiAgICAgICAgICAgIERvbWFpbk5hbWU6IHtcbiAgICAgICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgICAgICAgJ2ltcG9ydGVkLWJ1Y2tldC5zMy4nLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpSZWdpb24nIH0sXG4gICAgICAgICAgICAgICAgJy4nLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpVUkxTdWZmaXgnIH0sXG4gICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFMzT3JpZ2luQ29uZmlnOiB7XG4gICAgICAgICAgICAgIE9yaWdpbkFjY2Vzc0lkZW50aXR5OiB7XG4gICAgICAgICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgICAgICAgICAnb3JpZ2luLWFjY2Vzcy1pZGVudGl0eS9jbG91ZGZyb250LycsXG4gICAgICAgICAgICAgICAgICB7IFJlZjogJ0Rpc3RyaWJ1dGlvbk9yaWdpbjJTM09yaWdpbkU0ODRENEJGJyB9LFxuICAgICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBPcmlnaW5Hcm91cHM6IHtcbiAgICAgICAgICBJdGVtczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBGYWlsb3ZlckNyaXRlcmlhOiB7XG4gICAgICAgICAgICAgICAgU3RhdHVzQ29kZXM6IHtcbiAgICAgICAgICAgICAgICAgIEl0ZW1zOiBbNTAwXSxcbiAgICAgICAgICAgICAgICAgIFF1YW50aXR5OiAxLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIElkOiAnRGlzdHJpYnV0aW9uT3JpZ2luR3JvdXAxQTFBMzFCNDknLFxuICAgICAgICAgICAgICBNZW1iZXJzOiB7XG4gICAgICAgICAgICAgICAgSXRlbXM6IFtcbiAgICAgICAgICAgICAgICAgIHsgT3JpZ2luSWQ6IHByaW1hcnlPcmlnaW5JZCB9LFxuICAgICAgICAgICAgICAgICAgeyBPcmlnaW5JZDogJ015Q3VzdG9tT3JpZ2luMScgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIFF1YW50aXR5OiAyLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIFF1YW50aXR5OiAxLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnY2Fubm90IGhhdmUgYW4gT3JpZ2luIHdpdGggdGhlaXIgb3duIGZhaWxvdmVyIGNvbmZpZ3VyYXRpb24gYXMgdGhlIHByaW1hcnkgT3JpZ2luJywgKCkgPT4ge1xuICAgIGNvbnN0IGZhaWxvdmVyT3JpZ2luID0gbmV3IG9yaWdpbnMuUzNPcmlnaW4oczMuQnVja2V0LmZyb21CdWNrZXROYW1lKHN0YWNrLCAnSW1wb3J0ZWRCdWNrZXQnLCAnaW1wb3J0ZWQtYnVja2V0JykpO1xuICAgIGNvbnN0IG9yaWdpbkdyb3VwID0gbmV3IG9yaWdpbnMuT3JpZ2luR3JvdXAoe1xuICAgICAgcHJpbWFyeU9yaWdpbixcbiAgICAgIGZhbGxiYWNrT3JpZ2luOiBmYWlsb3Zlck9yaWdpbixcbiAgICB9KTtcbiAgICBjb25zdCBncm91cE9mR3JvdXBzID0gbmV3IG9yaWdpbnMuT3JpZ2luR3JvdXAoe1xuICAgICAgcHJpbWFyeU9yaWdpbjogb3JpZ2luR3JvdXAsXG4gICAgICBmYWxsYmFja09yaWdpbjogZmFpbG92ZXJPcmlnaW4sXG4gICAgfSk7XG5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgbmV3IGNsb3VkZnJvbnQuRGlzdHJpYnV0aW9uKHN0YWNrLCAnRGlzdHJpYnV0aW9uJywge1xuICAgICAgICBkZWZhdWx0QmVoYXZpb3I6IHsgb3JpZ2luOiBncm91cE9mR3JvdXBzIH0sXG4gICAgICB9KTtcbiAgICB9KS50b1Rocm93KC9BbiBPcmlnaW5Hcm91cCBjYW5ub3QgdXNlIGFuIE9yaWdpbiB3aXRoIGl0cyBvd24gZmFpbG92ZXIgY29uZmlndXJhdGlvbiBhcyBpdHMgcHJpbWFyeSBvcmlnaW4hLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2Nhbm5vdCBoYXZlIGFuIE9yaWdpbiB3aXRoIHRoZWlyIG93biBmYWlsb3ZlciBjb25maWd1cmF0aW9uIGFzIHRoZSBmYWxsYmFjayBPcmlnaW4nLCAoKSA9PiB7XG4gICAgY29uc3Qgb3JpZ2luR3JvdXAgPSBuZXcgb3JpZ2lucy5PcmlnaW5Hcm91cCh7XG4gICAgICBwcmltYXJ5T3JpZ2luLFxuICAgICAgZmFsbGJhY2tPcmlnaW46IG5ldyBvcmlnaW5zLlMzT3JpZ2luKHMzLkJ1Y2tldC5mcm9tQnVja2V0TmFtZShzdGFjaywgJ0ltcG9ydGVkQnVja2V0JywgJ2ltcG9ydGVkLWJ1Y2tldCcpKSxcbiAgICB9KTtcbiAgICBjb25zdCBncm91cE9mR3JvdXBzID0gbmV3IG9yaWdpbnMuT3JpZ2luR3JvdXAoe1xuICAgICAgcHJpbWFyeU9yaWdpbixcbiAgICAgIGZhbGxiYWNrT3JpZ2luOiBvcmlnaW5Hcm91cCxcbiAgICB9KTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBuZXcgY2xvdWRmcm9udC5EaXN0cmlidXRpb24oc3RhY2ssICdEaXN0cmlidXRpb24nLCB7XG4gICAgICAgIGRlZmF1bHRCZWhhdmlvcjogeyBvcmlnaW46IGdyb3VwT2ZHcm91cHMgfSxcbiAgICAgIH0pO1xuICAgIH0pLnRvVGhyb3coL0FuIE9yaWdpbiBjYW5ub3QgdXNlIGFuIE9yaWdpbiB3aXRoIGl0cyBvd24gZmFpbG92ZXIgY29uZmlndXJhdGlvbiBhcyBpdHMgZmFsbGJhY2sgb3JpZ2luIS8pO1xuICB9KTtcblxuICB0ZXN0KCdjYW5ub3QgaGF2ZSBhbiBlbXB0eSBhcnJheSBvZiBmYWxsYmFja1N0YXR1c0NvZGVzJywgKCkgPT4ge1xuICAgIGNvbnN0IGZhaWxvdmVyT3JpZ2luID0gbmV3IG9yaWdpbnMuUzNPcmlnaW4oczMuQnVja2V0LmZyb21CdWNrZXROYW1lKHN0YWNrLCAnSW1wb3J0ZWRCdWNrZXQnLCAnaW1wb3J0ZWQtYnVja2V0JykpO1xuICAgIGNvbnN0IG9yaWdpbkdyb3VwID0gbmV3IG9yaWdpbnMuT3JpZ2luR3JvdXAoe1xuICAgICAgcHJpbWFyeU9yaWdpbixcbiAgICAgIGZhbGxiYWNrT3JpZ2luOiBmYWlsb3Zlck9yaWdpbixcbiAgICAgIGZhbGxiYWNrU3RhdHVzQ29kZXM6IFtdLFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIG5ldyBjbG91ZGZyb250LkRpc3RyaWJ1dGlvbihzdGFjaywgJ0Rpc3RyaWJ1dGlvbicsIHtcbiAgICAgICAgZGVmYXVsdEJlaGF2aW9yOiB7IG9yaWdpbjogb3JpZ2luR3JvdXAgfSxcbiAgICAgIH0pO1xuICAgIH0pLnRvVGhyb3coL2ZhbGxiYWNrU3RhdHVzQ29kZXMgY2Fubm90IGJlIGVtcHR5Lyk7XG4gIH0pO1xufSk7XG4iXX0=