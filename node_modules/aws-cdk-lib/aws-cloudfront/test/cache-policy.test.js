"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const core_1 = require("../../core");
const lib_1 = require("../lib");
describe('CachePolicy', () => {
    let app;
    let stack;
    beforeEach(() => {
        app = new core_1.App();
        stack = new core_1.Stack(app, 'Stack', {
            env: { account: '123456789012', region: 'testregion' },
        });
    });
    test('import existing policy by id', () => {
        const cachePolicyId = '344f6fe5-7ce5-4df0-a470-3f14177c549c';
        const cachePolicy = lib_1.CachePolicy.fromCachePolicyId(stack, 'MyPolicy', cachePolicyId);
        expect(cachePolicy.cachePolicyId).toEqual(cachePolicyId);
    });
    test('minimal example', () => {
        new lib_1.CachePolicy(stack, 'CachePolicy');
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::CachePolicy', {
            CachePolicyConfig: {
                Name: 'StackCachePolicy0D6FCBC0-testregion',
                MinTTL: 0,
                DefaultTTL: 86400,
                MaxTTL: 31536000,
                ParametersInCacheKeyAndForwardedToOrigin: {
                    CookiesConfig: {
                        CookieBehavior: 'none',
                    },
                    EnableAcceptEncodingGzip: false,
                    EnableAcceptEncodingBrotli: false,
                    HeadersConfig: {
                        HeaderBehavior: 'none',
                    },
                    QueryStringsConfig: {
                        QueryStringBehavior: 'none',
                    },
                },
            },
        });
    });
    test('maximum example', () => {
        new lib_1.CachePolicy(stack, 'CachePolicy', {
            cachePolicyName: 'MyPolicy',
            comment: 'A default policy',
            defaultTtl: core_1.Duration.days(2),
            minTtl: core_1.Duration.minutes(1),
            maxTtl: core_1.Duration.days(10),
            cookieBehavior: lib_1.CacheCookieBehavior.all(),
            headerBehavior: lib_1.CacheHeaderBehavior.allowList('X-CustomHeader'),
            queryStringBehavior: lib_1.CacheQueryStringBehavior.denyList('username'),
            enableAcceptEncodingGzip: true,
            enableAcceptEncodingBrotli: true,
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::CachePolicy', {
            CachePolicyConfig: {
                Name: 'MyPolicy',
                Comment: 'A default policy',
                MinTTL: 60,
                DefaultTTL: 172800,
                MaxTTL: 864000,
                ParametersInCacheKeyAndForwardedToOrigin: {
                    CookiesConfig: {
                        CookieBehavior: 'all',
                    },
                    HeadersConfig: {
                        HeaderBehavior: 'whitelist',
                        Headers: ['X-CustomHeader'],
                    },
                    QueryStringsConfig: {
                        QueryStringBehavior: 'allExcept',
                        QueryStrings: ['username'],
                    },
                    EnableAcceptEncodingGzip: true,
                    EnableAcceptEncodingBrotli: true,
                },
            },
        });
    });
    test('throws on long policy names over 128 characters', () => {
        const errorMessage = /'cachePolicyName' cannot be longer than 128 characters/;
        expect(() => new lib_1.CachePolicy(stack, 'CachePolicy1', { cachePolicyName: 'FooBarBaz'.repeat(15) })).toThrow(errorMessage);
    });
    test('throws if cachePolicyName contains invalid characters', () => {
        const errorMessage = /'cachePolicyName' can only include '-', '_', and alphanumeric characters/;
        expect(() => new lib_1.CachePolicy(stack, 'CachePolicy1', { cachePolicyName: 'My Policy' })).toThrow(errorMessage);
        expect(() => new lib_1.CachePolicy(stack, 'CachePolicy2', { cachePolicyName: 'MyPolicy!' })).toThrow(errorMessage);
        expect(() => new lib_1.CachePolicy(stack, 'CachePolicy3', { cachePolicyName: 'MyPolicy,New' })).toThrow(errorMessage);
        expect(() => new lib_1.CachePolicy(stack, 'CachePolicy4', { cachePolicyName: 'MyPolicy' })).not.toThrow();
        expect(() => new lib_1.CachePolicy(stack, 'CachePolicy5', { cachePolicyName: 'My-Policy' })).not.toThrow();
        expect(() => new lib_1.CachePolicy(stack, 'CachePolicy6', { cachePolicyName: 'My_Policy' })).not.toThrow();
    });
    test('does not throw if cachePolicyName is a token', () => {
        expect(() => new lib_1.CachePolicy(stack, 'CachePolicy', {
            cachePolicyName: core_1.Aws.STACK_NAME,
        })).not.toThrow();
    });
    describe('TTLs', () => {
        test('default TTLs', () => {
            new lib_1.CachePolicy(stack, 'CachePolicy', { cachePolicyName: 'MyPolicy' });
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::CachePolicy', {
                CachePolicyConfig: {
                    MinTTL: 0,
                    DefaultTTL: 86400,
                    MaxTTL: 31536000,
                },
            });
        });
        test('defaultTTL defaults to minTTL if minTTL is more than 1 day', () => {
            new lib_1.CachePolicy(stack, 'CachePolicy', {
                cachePolicyName: 'MyPolicy',
                minTtl: core_1.Duration.days(2),
            });
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::CachePolicy', {
                CachePolicyConfig: {
                    MinTTL: 172800,
                    DefaultTTL: 172800,
                    MaxTTL: 31536000,
                },
            });
        });
        test('maxTTL defaults to defaultTTL if defaultTTL is more than 1 year', () => {
            new lib_1.CachePolicy(stack, 'CachePolicy', {
                cachePolicyName: 'MyPolicy',
                defaultTtl: core_1.Duration.days(400),
            });
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::CachePolicy', {
                CachePolicyConfig: {
                    MinTTL: 0,
                    DefaultTTL: 34560000,
                    MaxTTL: 34560000,
                },
            });
        });
    });
});
test('managed policies are provided', () => {
    expect(lib_1.CachePolicy.CACHING_OPTIMIZED.cachePolicyId).toEqual('658327ea-f89d-4fab-a63d-7e88639e58f6');
    expect(lib_1.CachePolicy.CACHING_OPTIMIZED_FOR_UNCOMPRESSED_OBJECTS.cachePolicyId).toEqual('b2884449-e4de-46a7-ac36-70bc7f1ddd6d');
    expect(lib_1.CachePolicy.CACHING_DISABLED.cachePolicyId).toEqual('4135ea2d-6df8-44a3-9df3-4b5a84be39ad');
    expect(lib_1.CachePolicy.ELEMENTAL_MEDIA_PACKAGE.cachePolicyId).toEqual('08627262-05a9-4f76-9ded-b50ca2e3a84f');
});
// CookieBehavior and QueryStringBehavior have identical behavior
describe.each([
    ['CookieBehavior', lib_1.CacheCookieBehavior, 'cookie', (c) => c.cookies],
    ['QueryStringBehavior', lib_1.CacheQueryStringBehavior, 'query string', (qs) => qs.queryStrings],
])('%s', (_className, clazz, type, items) => {
    test('none()', () => {
        const behavior = clazz.none();
        expect(behavior.behavior).toEqual('none');
        expect(items(behavior)).toBeUndefined();
    });
    test('all()', () => {
        const behavior = clazz.all();
        expect(behavior.behavior).toEqual('all');
        expect(items(behavior)).toBeUndefined();
    });
    test('allowList()', () => {
        const behavior = clazz.allowList('SESSION_ID', 'secrets');
        expect(behavior.behavior).toEqual('whitelist');
        expect(items(behavior)).toEqual(['SESSION_ID', 'secrets']);
    });
    test('allowList() throws if list is empty', () => {
        expect(() => clazz.allowList()).toThrow(new RegExp(`At least one ${type} to allow must be provided`));
    });
    test('denyList()', () => {
        const behavior = clazz.denyList('SESSION_ID', 'secrets');
        expect(behavior.behavior).toEqual('allExcept');
        expect(items(behavior)).toEqual(['SESSION_ID', 'secrets']);
    });
    test('denyList() throws if list is empty', () => {
        expect(() => clazz.denyList()).toThrow(new RegExp(`At least one ${type} to deny must be provided`));
    });
});
describe('HeaderBehavior', () => {
    test('none()', () => {
        const headers = lib_1.CacheHeaderBehavior.none();
        expect(headers.behavior).toEqual('none');
        expect(headers.headers).toBeUndefined();
    });
    test('allowList()', () => {
        const headers = lib_1.CacheHeaderBehavior.allowList('X-CustomHeader', 'X-AnotherHeader');
        expect(headers.behavior).toEqual('whitelist');
        expect(headers.headers).toEqual(['X-CustomHeader', 'X-AnotherHeader']);
    });
    test('allowList() throws if list is empty', () => {
        expect(() => lib_1.CacheHeaderBehavior.allowList()).toThrow(/At least one header to allow must be provided/);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FjaGUtcG9saWN5LnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjYWNoZS1wb2xpY3kudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUE0QztBQUM1QyxxQ0FBdUQ7QUFDdkQsZ0NBQXlHO0FBRXpHLFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO0lBQzNCLElBQUksR0FBUSxDQUFDO0lBQ2IsSUFBSSxLQUFZLENBQUM7SUFFakIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLEdBQUcsR0FBRyxJQUFJLFVBQUcsRUFBRSxDQUFDO1FBQ2hCLEtBQUssR0FBRyxJQUFJLFlBQUssQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFO1lBQzlCLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRTtTQUN2RCxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7UUFDeEMsTUFBTSxhQUFhLEdBQUcsc0NBQXNDLENBQUM7UUFDN0QsTUFBTSxXQUFXLEdBQUcsaUJBQVcsQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsVUFBVSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1FBQ3BGLE1BQU0sQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQzNELENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUMzQixJQUFJLGlCQUFXLENBQUMsS0FBSyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1FBRXRDLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLDhCQUE4QixFQUFFO1lBQzlFLGlCQUFpQixFQUFFO2dCQUNqQixJQUFJLEVBQUUscUNBQXFDO2dCQUMzQyxNQUFNLEVBQUUsQ0FBQztnQkFDVCxV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QUVILElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7UUFDL0MsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLHlCQUFtQixDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLCtDQUErQyxDQUFDLENBQUM7SUFDekcsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgeyBBcHAsIEF3cywgRHVyYXRpb24sIFN0YWNrIH0gZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgeyBDYWNoZVBvbGljeSwgQ2FjaGVDb29raWVCZWhhdmlvciwgQ2FjaGVIZWFkZXJCZWhhdmlvciwgQ2FjaGVRdWVyeVN0cmluZ0JlaGF2aW9yIH0gZnJvbSAnLi4vbGliJztcblxuZGVzY3JpYmUoJ0NhY2hlUG9saWN5JywgKCkgPT4ge1xuICBsZXQgYXBwOiBBcHA7XG4gIGxldCBzdGFjazogU3RhY2s7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgYXBwID0gbmV3IEFwcCgpO1xuICAgIHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ1N0YWNrJywge1xuICAgICAgZW52OiB7IGFjY291bnQ6ICcxMjM0NTY3ODkwMTInLCByZWdpb246ICd0ZXN0cmVnaW9uJyB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdpbXBvcnQgZXhpc3RpbmcgcG9saWN5IGJ5IGlkJywgKCkgPT4ge1xuICAgIGNvbnN0IGNhY2hlUG9saWN5SWQgPSAnMzQ0ZjZmZTUtN2NlNS00ZGYwLWE0NzAtM2YxNDE3N2M1NDljJztcbiAgICBjb25zdCBjYWNoZVBvbGljeSA9IENhY2hlUG9saWN5LmZyb21DYWNoZVBvbGljeUlkKHN0YWNrLCAnTXlQb2xpY3knLCBjYWNoZVBvbGljeUlkKTtcbiAgICBleHBlY3QoY2FjaGVQb2xpY3kuY2FjaGVQb2xpY3lJZCkudG9FcXVhbChjYWNoZVBvbGljeUlkKTtcbiAgfSk7XG5cbiAgdGVzdCgnbWluaW1hbCBleGFtcGxlJywgKCkgPT4ge1xuICAgIG5ldyBDYWNoZVBvbGljeShzdGFjaywgJ0NhY2hlUG9saWN5Jyk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZEZyb250OjpDYWNoZVBvbGljeScsIHtcbiAgICAgIENhY2hlUG9saWN5Q29uZmlnOiB7XG4gICAgICAgIE5hbWU6ICdTdGFja0NhY2hlUG9saWN5MEQ2RkNCQzAtdGVzdHJlZ2lvbicsXG4gICAgICAgIE1pblRUTDogMCxcbiAgICAgICAgRGVmYXVsdFRUTDogODY0MDAsXG4gICAgICAgIE1heFRUTDogMzE1MzYwMDAsXG4gICAgICAgIFBhcmFtZXRlcnNJbkNhY2hlS2V5QW5kRm9yd2FyZGVkVG9PcmlnaW46IHtcbiAgICAgICAgICBDb29raWVzQ29uZmlnOiB7XG4gICAgICAgICAgICBDb29raWVCZWhhdmlvcjogJ25vbmUnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgRW5hYmxlQWNjZXB0RW5jb2RpbmdHemlwOiBmYWxzZSxcbiAgICAgICAgICBFbmFibGVBY2NlcHRFbmNvZGluZ0Jyb3RsaTogZmFsc2UsXG4gICAgICAgICAgSGVhZGVyc0NvbmZpZzoge1xuICAgICAgICAgICAgSGVhZGVyQmVoYXZpb3I6ICdub25lJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIFF1ZXJ5U3RyaW5nc0NvbmZpZzoge1xuICAgICAgICAgICAgUXVlcnlTdHJpbmdCZWhhdmlvcjogJ25vbmUnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdtYXhpbXVtIGV4YW1wbGUnLCAoKSA9PiB7XG4gICAgbmV3IENhY2hlUG9saWN5KHN0YWNrLCAnQ2FjaGVQb2xpY3knLCB7XG4gICAgICBjYWNoZVBvbGljeU5hbWU6ICdNeVBvbGljeScsXG4gICAgICBjb21tZW50OiAnQSBkZWZhdWx0IHBvbGljeScsXG4gICAgICBkZWZhdWx0VHRsOiBEdXJhdGlvbi5kYXlzKDIpLFxuICAgICAgbWluVHRsOiBEdXJhdGlvbi5taW51dGVzKDEpLFxuICAgICAgbWF4VHRsOiBEdXJhdGlvbi5kYXlzKDEwKSxcbiAgICAgIGNvb2tpZUJlaGF2aW9yOiBDYWNoZUNvb2tpZUJlaGF2aW9yLmFsbCgpLFxuICAgICAgaGVhZGVyQmVoYXZpb3I6IENhY2hlSGVhZGVyQmVoYXZpb3IuYWxsb3dMaXN0KCdYLUN1c3RvbUhlYWRlcicpLFxuICAgICAgcXVlcnlTdHJpbmdCZWhhdmlvcjogQ2FjaGVRdWVyeVN0cmluZ0JlaGF2aW9yLmRlbnlMaXN0KCd1c2VybmFtZScpLFxuICAgICAgZW5hYmxlQWNjZXB0RW5jb2RpbmdHemlwOiB0cnVlLFxuICAgICAgZW5hYmxlQWNjZXB0RW5jb2RpbmdCcm90bGk6IHRydWUsXG4gICAgfSk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZEZyb250OjpDYWNoZVBvbGljeScsIHtcbiAgICAgIENhY2hlUG9saWN5Q29uZmlnOiB7XG4gICAgICAgIE5hbWU6ICdNeVBvbGljeScsXG4gICAgICAgIENvbW1lbnQ6ICdBIGRlZmF1bHQgcG9saWN5JyxcbiAgICAgICAgTWluVFRMOiA2MCxcbiAgICAgICAgRGVmYXVsdFRUTDogMTcyODAwLFxuICAgICAgICBNYXhUVEw6IDg2NDAwMCxcbiAgICAgICAgUGFyYW1ldGVyc0luQ2FjaGVLZXlBbmRGb3J3YXJkZWRUb09yaWdpbjoge1xuICAgICAgICAgIENvb2tpZXNDb25maWc6IHtcbiAgICAgICAgICAgIENvb2tpZUJlaGF2aW9yOiAnYWxsJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIEhlYWRlcnNDb25maWc6IHtcbiAgICAgICAgICAgIEhlYWRlckJlaGF2aW9yOiAnd2hpdGVsaXN0JyxcbiAgICAgICAgICAgIEhlYWRlcnM6IFsnWC1DdXN0b21IZWFkZXInXSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIFF1ZXJ5U3RyaW5nc0NvbmZpZzoge1xuICAgICAgICAgICAgUXVlcnlTdHJpbmdCZWhhdmlvcjogJ2FsbEV4Y2VwdCcsXG4gICAgICAgICAgICBRdWVyeVN0cmluZ3M6IFsndXNlcm5hbWUnXSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIEVuYWJsZUFjY2VwdEVuY29kaW5nR3ppcDogdHJ1ZSxcbiAgICAgICAgICBFbmFibGVBY2NlcHRFbmNvZGluZ0Jyb3RsaTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Rocm93cyBvbiBsb25nIHBvbGljeSBuYW1lcyBvdmVyIDEyOCBjaGFyYWN0ZXJzJywgKCkgPT4ge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IC8nY2FjaGVQb2xpY3lOYW1lJyBjYW5ub3QgYmUgbG9uZ2VyIHRoYW4gMTI4IGNoYXJhY3RlcnMvO1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgQ2FjaGVQb2xpY3koc3RhY2ssICdDYWNoZVBvbGljeTEnLCB7IGNhY2hlUG9saWN5TmFtZTogJ0Zvb0JhckJheicucmVwZWF0KDE1KSB9KSkudG9UaHJvdyhlcnJvck1lc3NhZ2UpO1xuICB9KTtcblxuICB0ZXN0KCd0aHJvd3MgaWYgY2FjaGVQb2xpY3lOYW1lIGNvbnRhaW5zIGludmFsaWQgY2hhcmFjdGVycycsICgpID0+IHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSAvJ2NhY2hlUG9saWN5TmFtZScgY2FuIG9ubHkgaW5jbHVkZSAnLScsICdfJywgYW5kIGFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzLztcbiAgICBleHBlY3QoKCkgPT4gbmV3IENhY2hlUG9saWN5KHN0YWNrLCAnQ2FjaGVQb2xpY3kxJywgeyBjYWNoZVBvbGljeU5hbWU6ICdNeSBQb2xpY3knIH0pKS50b1Rocm93KGVycm9yTWVzc2FnZSk7XG4gICAgZXhwZWN0KCgpID0+IG5ldyBDYWNoZVBvbGljeShzdGFjaywgJ0NhY2hlUG9saWN5MicsIHsgY2FjaGVQb2xpY3lOYW1lOiAnTXlQb2xpY3khJyB9KSkudG9UaHJvdyhlcnJvck1lc3NhZ2UpO1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgQ2FjaGVQb2xpY3koc3RhY2ssICdDYWNoZVBvbGljeTMnLCB7IGNhY2hlUG9saWN5TmFtZTogJ015UG9saWN5LE5ldycgfSkpLnRvVGhyb3coZXJyb3JNZXNzYWdlKTtcblxuICAgIGV4cGVjdCgoKSA9PiBuZXcgQ2FjaGVQb2xpY3koc3RhY2ssICdDYWNoZVBvbGljeTQnLCB7IGNhY2hlUG9saWN5TmFtZTogJ015UG9saWN5JyB9KSkubm90LnRvVGhyb3coKTtcbiAgICBleHBlY3QoKCkgPT4gbmV3IENhY2hlUG9saWN5KHN0YWNrLCAnQ2FjaGVQb2xpY3k1JywgeyBjYWNoZVBvbGljeU5hbWU6ICdNeS1Qb2xpY3knIH0pKS5ub3QudG9UaHJvdygpO1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgQ2FjaGVQb2xpY3koc3RhY2ssICdDYWNoZVBvbGljeTYnLCB7IGNhY2hlUG9saWN5TmFtZTogJ015X1BvbGljeScgfSkpLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2RvZXMgbm90IHRocm93IGlmIGNhY2hlUG9saWN5TmFtZSBpcyBhIHRva2VuJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgQ2FjaGVQb2xpY3koc3RhY2ssICdDYWNoZVBvbGljeScsIHtcbiAgICAgIGNhY2hlUG9saWN5TmFtZTogQXdzLlNUQUNLX05BTUUsXG4gICAgfSkpLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdUVExzJywgKCkgPT4ge1xuICAgIHRlc3QoJ2RlZmF1bHQgVFRMcycsICgpID0+IHtcbiAgICAgIG5ldyBDYWNoZVBvbGljeShzdGFjaywgJ0NhY2hlUG9saWN5JywgeyBjYWNoZVBvbGljeU5hbWU6ICdNeVBvbGljeScgfSk7XG5cbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkNhY2hlUG9saWN5Jywge1xuICAgICAgICBDYWNoZVBvbGljeUNvbmZpZzoge1xuICAgICAgICAgIE1pblRUTDogMCxcbiAgICAgICAgICBEZWZhdWx0VFRMOiA4NjQwMCxcbiAgICAgICAgICBNYXhUVEw6IDMxNTM2MDAwLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdkZWZhdWx0VFRMIGRlZmF1bHRzIHRvIG1pblRUTCBpZiBtaW5UVEwgaXMgbW9yZSB0aGFuIDEgZGF5JywgKCkgPT4ge1xuICAgICAgbmV3IENhY2hlUG9saWN5KHN0YWNrLCAnQ2FjaGVQb2xpY3knLCB7XG4gICAgICAgIGNhY2hlUG9saWN5TmFtZTogJ015UG9saWN5JyxcbiAgICAgICAgbWluVHRsOiBEdXJhdGlvbi5kYXlzKDIpLFxuICAgICAgfSk7XG5cbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkNhY2hlUG9saWN5Jywge1xuICAgICAgICBDYWNoZVBvbGljeUNvbmZpZzoge1xuICAgICAgICAgIE1pblRUTDogMTcyODAwLFxuICAgICAgICAgIERlZmF1bHRUVEw6IDE3MjgwMCxcbiAgICAgICAgICBNYXhUVEw6IDMxNTM2MDAwLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdtYXhUVEwgZGVmYXVsdHMgdG8gZGVmYXVsdFRUTCBpZiBkZWZhdWx0VFRMIGlzIG1vcmUgdGhhbiAxIHllYXInLCAoKSA9PiB7XG4gICAgICBuZXcgQ2FjaGVQb2xpY3koc3RhY2ssICdDYWNoZVBvbGljeScsIHtcbiAgICAgICAgY2FjaGVQb2xpY3lOYW1lOiAnTXlQb2xpY3knLFxuICAgICAgICBkZWZhdWx0VHRsOiBEdXJhdGlvbi5kYXlzKDQwMCksXG4gICAgICB9KTtcblxuICAgICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q2xvdWRGcm9udDo6Q2FjaGVQb2xpY3knLCB7XG4gICAgICAgIENhY2hlUG9saWN5Q29uZmlnOiB7XG4gICAgICAgICAgTWluVFRMOiAwLFxuICAgICAgICAgIERlZmF1bHRUVEw6IDM0NTYwMDAwLFxuICAgICAgICAgIE1heFRUTDogMzQ1NjAwMDAsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxudGVzdCgnbWFuYWdlZCBwb2xpY2llcyBhcmUgcHJvdmlkZWQnLCAoKSA9PiB7XG4gIGV4cGVjdChDYWNoZVBvbGljeS5DQUNISU5HX09QVElNSVpFRC5jYWNoZVBvbGljeUlkKS50b0VxdWFsKCc2NTgzMjdlYS1mODlkLTRmYWItYTYzZC03ZTg4NjM5ZTU4ZjYnKTtcbiAgZXhwZWN0KENhY2hlUG9saWN5LkNBQ0hJTkdfT1BUSU1JWkVEX0ZPUl9VTkNPTVBSRVNTRURfT0JKRUNUUy5jYWNoZVBvbGljeUlkKS50b0VxdWFsKCdiMjg4NDQ0OS1lNGRlLTQ2YTctYWMzNi03MGJjN2YxZGRkNmQnKTtcbiAgZXhwZWN0KENhY2hlUG9saWN5LkNBQ0hJTkdfRElTQUJMRUQuY2FjaGVQb2xpY3lJZCkudG9FcXVhbCgnNDEzNWVhMmQtNmRmOC00NGEzLTlkZjMtNGI1YTg0YmUzOWFkJyk7XG4gIGV4cGVjdChDYWNoZVBvbGljeS5FTEVNRU5UQUxfTUVESUFfUEFDS0FHRS5jYWNoZVBvbGljeUlkKS50b0VxdWFsKCcwODYyNzI2Mi0wNWE5LTRmNzYtOWRlZC1iNTBjYTJlM2E4NGYnKTtcbn0pO1xuXG4vLyBDb29raWVCZWhhdmlvciBhbmQgUXVlcnlTdHJpbmdCZWhhdmlvciBoYXZlIGlkZW50aWNhbCBiZWhhdmlvclxuZGVzY3JpYmUuZWFjaChbXG4gIFsnQ29va2llQmVoYXZpb3InLCBDYWNoZUNvb2tpZUJlaGF2aW9yLCAnY29va2llJywgKGM6IENhY2hlQ29va2llQmVoYXZpb3IpID0+IGMuY29va2llc10sXG4gIFsnUXVlcnlTdHJpbmdCZWhhdmlvcicsIENhY2hlUXVlcnlTdHJpbmdCZWhhdmlvciwgJ3F1ZXJ5IHN0cmluZycsIChxczogQ2FjaGVRdWVyeVN0cmluZ0JlaGF2aW9yKSA9PiBxcy5xdWVyeVN0cmluZ3NdLFxuXSkoJyVzJywgKF9jbGFzc05hbWUsIGNsYXp6LCB0eXBlLCBpdGVtcykgPT4ge1xuICB0ZXN0KCdub25lKCknLCAoKSA9PiB7XG4gICAgY29uc3QgYmVoYXZpb3IgPSBjbGF6ei5ub25lKCk7XG5cbiAgICBleHBlY3QoYmVoYXZpb3IuYmVoYXZpb3IpLnRvRXF1YWwoJ25vbmUnKTtcbiAgICBleHBlY3QoaXRlbXMoYmVoYXZpb3IpKS50b0JlVW5kZWZpbmVkKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FsbCgpJywgKCkgPT4ge1xuICAgIGNvbnN0IGJlaGF2aW9yID0gY2xhenouYWxsKCk7XG5cbiAgICBleHBlY3QoYmVoYXZpb3IuYmVoYXZpb3IpLnRvRXF1YWwoJ2FsbCcpO1xuICAgIGV4cGVjdChpdGVtcyhiZWhhdmlvcikpLnRvQmVVbmRlZmluZWQoKTtcbiAgfSk7XG5cbiAgdGVzdCgnYWxsb3dMaXN0KCknLCAoKSA9PiB7XG4gICAgY29uc3QgYmVoYXZpb3IgPSBjbGF6ei5hbGxvd0xpc3QoJ1NFU1NJT05fSUQnLCAnc2VjcmV0cycpO1xuXG4gICAgZXhwZWN0KGJlaGF2aW9yLmJlaGF2aW9yKS50b0VxdWFsKCd3aGl0ZWxpc3QnKTtcbiAgICBleHBlY3QoaXRlbXMoYmVoYXZpb3IpKS50b0VxdWFsKFsnU0VTU0lPTl9JRCcsICdzZWNyZXRzJ10pO1xuICB9KTtcblxuICB0ZXN0KCdhbGxvd0xpc3QoKSB0aHJvd3MgaWYgbGlzdCBpcyBlbXB0eScsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4gY2xhenouYWxsb3dMaXN0KCkpLnRvVGhyb3cobmV3IFJlZ0V4cChgQXQgbGVhc3Qgb25lICR7dHlwZX0gdG8gYWxsb3cgbXVzdCBiZSBwcm92aWRlZGApKTtcbiAgfSk7XG5cbiAgdGVzdCgnZGVueUxpc3QoKScsICgpID0+IHtcbiAgICBjb25zdCBiZWhhdmlvciA9IGNsYXp6LmRlbnlMaXN0KCdTRVNTSU9OX0lEJywgJ3NlY3JldHMnKTtcblxuICAgIGV4cGVjdChiZWhhdmlvci5iZWhhdmlvcikudG9FcXVhbCgnYWxsRXhjZXB0Jyk7XG4gICAgZXhwZWN0KGl0ZW1zKGJlaGF2aW9yKSkudG9FcXVhbChbJ1NFU1NJT05fSUQnLCAnc2VjcmV0cyddKTtcbiAgfSk7XG5cbiAgdGVzdCgnZGVueUxpc3QoKSB0aHJvd3MgaWYgbGlzdCBpcyBlbXB0eScsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4gY2xhenouZGVueUxpc3QoKSkudG9UaHJvdyhuZXcgUmVnRXhwKGBBdCBsZWFzdCBvbmUgJHt0eXBlfSB0byBkZW55IG11c3QgYmUgcHJvdmlkZWRgKSk7XG4gIH0pO1xuXG59KTtcblxuZGVzY3JpYmUoJ0hlYWRlckJlaGF2aW9yJywgKCkgPT4ge1xuICB0ZXN0KCdub25lKCknLCAoKSA9PiB7XG4gICAgY29uc3QgaGVhZGVycyA9IENhY2hlSGVhZGVyQmVoYXZpb3Iubm9uZSgpO1xuXG4gICAgZXhwZWN0KGhlYWRlcnMuYmVoYXZpb3IpLnRvRXF1YWwoJ25vbmUnKTtcbiAgICBleHBlY3QoaGVhZGVycy5oZWFkZXJzKS50b0JlVW5kZWZpbmVkKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FsbG93TGlzdCgpJywgKCkgPT4ge1xuICAgIGNvbnN0IGhlYWRlcnMgPSBDYWNoZUhlYWRlckJlaGF2aW9yLmFsbG93TGlzdCgnWC1DdXN0b21IZWFkZXInLCAnWC1Bbm90aGVySGVhZGVyJyk7XG5cbiAgICBleHBlY3QoaGVhZGVycy5iZWhhdmlvcikudG9FcXVhbCgnd2hpdGVsaXN0Jyk7XG4gICAgZXhwZWN0KGhlYWRlcnMuaGVhZGVycykudG9FcXVhbChbJ1gtQ3VzdG9tSGVhZGVyJywgJ1gtQW5vdGhlckhlYWRlciddKTtcbiAgfSk7XG5cbiAgdGVzdCgnYWxsb3dMaXN0KCkgdGhyb3dzIGlmIGxpc3QgaXMgZW1wdHknLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IENhY2hlSGVhZGVyQmVoYXZpb3IuYWxsb3dMaXN0KCkpLnRvVGhyb3coL0F0IGxlYXN0IG9uZSBoZWFkZXIgdG8gYWxsb3cgbXVzdCBiZSBwcm92aWRlZC8pO1xuICB9KTtcbn0pO1xuIl19