"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const s3 = require("../../aws-s3");
const cdk_build_tools_1 = require("@aws-cdk/cdk-build-tools");
const cdk = require("../../core");
const lib_1 = require("../lib");
describe('origin group', () => {
    (0, cdk_build_tools_1.testDeprecated)('Distribution with custom origin failover', () => {
        const stack = new cdk.Stack();
        new lib_1.CloudFrontWebDistribution(stack, 'ADistribution', {
            originConfigs: [
                {
                    originHeaders: {
                        'X-Custom-Header': 'somevalue',
                    },
                    customOriginSource: {
                        domainName: 'myorigin.com',
                    },
                    failoverCustomOriginSource: {
                        domainName: 'myoriginfallback.com',
                    },
                    behaviors: [
                        {
                            isDefaultBehavior: true,
                        },
                    ],
                },
            ],
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                OriginGroups: {
                    Items: [
                        {
                            FailoverCriteria: {
                                StatusCodes: {
                                    Items: [
                                        500,
                                        502,
                                        503,
                                        504,
                                    ],
                                    Quantity: 4,
                                },
                            },
                            Id: 'OriginGroup1',
                            Members: {
                                Items: [
                                    {
                                        OriginId: 'origin1',
                                    },
                                    {
                                        OriginId: 'originSecondary1',
                                    },
                                ],
                                Quantity: 2,
                            },
                        },
                    ],
                    Quantity: 1,
                },
                Origins: [
                    assertions_1.Match.objectLike({
                        CustomOriginConfig: {
                            HTTPPort: 80,
                            HTTPSPort: 443,
                            OriginKeepaliveTimeout: 5,
                            OriginProtocolPolicy: 'https-only',
                            OriginReadTimeout: 30,
                            OriginSSLProtocols: [
                                'TLSv1.2',
                            ],
                        },
                        DomainName: 'myoriginfallback.com',
                        Id: 'originSecondary1',
                        OriginCustomHeaders: [
                            {
                                HeaderName: 'X-Custom-Header',
                                HeaderValue: 'somevalue',
                            },
                        ],
                    }),
                    assertions_1.Match.objectLike({
                        CustomOriginConfig: {
                            HTTPPort: 80,
                            HTTPSPort: 443,
                            OriginKeepaliveTimeout: 5,
                            OriginProtocolPolicy: 'https-only',
                            OriginReadTimeout: 30,
                            OriginSSLProtocols: [
                                'TLSv1.2',
                            ],
                        },
                        DomainName: 'myorigin.com',
                        Id: 'origin1',
                        OriginCustomHeaders: [
                            {
                                HeaderName: 'X-Custom-Header',
                                HeaderValue: 'somevalue',
                            },
                        ],
                    }),
                ],
            },
        });
    });
    test('Distribution with s3 origin failover', () => {
        const stack = new cdk.Stack();
        new lib_1.CloudFrontWebDistribution(stack, 'ADistribution', {
            originConfigs: [
                {
                    s3OriginSource: {
                        s3BucketSource: s3.Bucket.fromBucketName(stack, 'aBucket', 'myoriginbucket'),
                        originPath: '/',
                        originHeaders: {
                            myHeader: '42',
                        },
                    },
                    failoverS3OriginSource: {
                        s3BucketSource: s3.Bucket.fromBucketName(stack, 'aBucketFallback', 'myoriginbucketfallback'),
                        originPath: '/somwhere',
                        originHeaders: {
                            myHeader2: '21',
                        },
                    },
                    failoverCriteriaStatusCodes: [lib_1.FailoverStatusCode.INTERNAL_SERVER_ERROR],
                    behaviors: [
                        {
                            isDefaultBehavior: true,
                        },
                    ],
                },
            ],
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                OriginGroups: {
                    Items: [
                        {
                            FailoverCriteria: {
                                StatusCodes: {
                                    Items: [
                                        500,
                                    ],
                                    Quantity: 1,
                                },
                            },
                            Id: 'OriginGroup1',
                            Members: {
                                Items: [
                                    {
                                        OriginId: 'origin1',
                                    },
                                    {
                                        OriginId: 'originSecondary1',
                                    },
                                ],
                                Quantity: 2,
                            },
                        },
                    ],
                    Quantity: 1,
                },
                Origins: [
                    assertions_1.Match.objectLike({
                        DomainName: {
                            'Fn::Join': [
                                '',
                                [
                                    'myoriginbucketfallback.s3.',
                                    {
                                        Ref: 'AWS::Region',
                                    },
                                    '.',
                                    {
                                        Ref: 'AWS::URLSuffix',
                                    },
                                ],
                            ],
                        },
                        Id: 'originSecondary1',
                        OriginCustomHeaders: [
                            {
                                HeaderName: 'myHeader2',
                                HeaderValue: '21',
                            },
                        ],
                        OriginPath: '/somwhere',
                        S3OriginConfig: {},
                    }),
                    assertions_1.Match.objectLike({
                        DomainName: {
                            'Fn::Join': [
                                '',
                                [
                                    'myoriginbucket.s3.',
                                    {
                                        Ref: 'AWS::Region',
                                    },
                                    '.',
                                    {
                                        Ref: 'AWS::URLSuffix',
                                    },
                                ],
                            ],
                        },
                        Id: 'origin1',
                        OriginCustomHeaders: [
                            {
                                HeaderName: 'myHeader',
                                HeaderValue: '42',
                            },
                        ],
                        OriginPath: '/',
                        S3OriginConfig: {},
                    }),
                ],
            },
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JpZ2luLWdyb3Vwcy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsib3JpZ2luLWdyb3Vwcy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaURBQW1EO0FBQ25ELG1DQUFtQztBQUNuQyw4REFBMEQ7QUFDMUQsa0NBQWtDO0FBQ2xDLGdDQUF1RTtBQUV2RSxRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtJQUM1QixJQUFBLGdDQUFjLEVBQUMsMENBQTBDLEVBQUUsR0FBRyxFQUFFO1FBQzlELE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBRTlCLElBQUksK0JBQXlCLENBQUMsS0FBSyxFQUFFLGVBQWUsRUFBRTtZQUNwRCxhQUFhLEVBQUU7Z0JBQ2I7b0JBQ0UsYUFBYSxFQUFFO3dCQUNiLGlCQUFpQixFQUFFLFdBQVc7cUJBQy9CO29CQUNELGtCQUFrQixFQUFFO3dCQUNsQixVQUFVLEVBQUUsY0FBYztxQkFDM0I7b0JBQ0QsMEJBQTBCLEVBQUU7d0JBQzFCLFVBQVUsRUFBRSxzQkFBc0I7cUJBQ25DO29CQUNELFNBQVMsRUFBRTt3QkFDVDs0QkFDRSxpQkFBaUIsRUFBRSxJQUFJO3lCQUN4QjtxQkFDRjtpQkFDRjthQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMsK0JBQStCLEVBQUU7WUFDL0Usa0JBQWtCLEVBQUU7Z0JBQ2xCLFlBQVksRUFBRTtvQkFDWixLQUFLLEVBQUU7d0JBQ0w7NEJBQ0UsZ0JBQWdCLEVBQUU7Z0NBQ2hCLFdBQVcsRUFBRTtvQ0FDWCxLQUFLLEVBQUU7d0NBQ0wsR0FBRzt3Q0FDSCxHQUFHO3dDQUNILEdBQUc7d0NBQ0gsR0FBRztxQ0FDSjtvQ0FDRCxRQUFRLEVBQUUsQ0FBQztpQ0FDWjs2QkFDRjs0QkFDRCxFQUFFLEVBQUUsY0FBYzs0QkFDbEIsT0FBTyxFQUFF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O0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNYXRjaCwgVGVtcGxhdGUgfSBmcm9tICcuLi8uLi9hc3NlcnRpb25zJztcbmltcG9ydCAqIGFzIHMzIGZyb20gJy4uLy4uL2F3cy1zMyc7XG5pbXBvcnQgeyB0ZXN0RGVwcmVjYXRlZCB9IGZyb20gJ0Bhd3MtY2RrL2Nkay1idWlsZC10b29scyc7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgeyBDbG91ZEZyb250V2ViRGlzdHJpYnV0aW9uLCBGYWlsb3ZlclN0YXR1c0NvZGUgfSBmcm9tICcuLi9saWInO1xuXG5kZXNjcmliZSgnb3JpZ2luIGdyb3VwJywgKCkgPT4ge1xuICB0ZXN0RGVwcmVjYXRlZCgnRGlzdHJpYnV0aW9uIHdpdGggY3VzdG9tIG9yaWdpbiBmYWlsb3ZlcicsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgIG5ldyBDbG91ZEZyb250V2ViRGlzdHJpYnV0aW9uKHN0YWNrLCAnQURpc3RyaWJ1dGlvbicsIHtcbiAgICAgIG9yaWdpbkNvbmZpZ3M6IFtcbiAgICAgICAge1xuICAgICAgICAgIG9yaWdpbkhlYWRlcnM6IHtcbiAgICAgICAgICAgICdYLUN1c3RvbS1IZWFkZXInOiAnc29tZXZhbHVlJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGN1c3RvbU9yaWdpblNvdXJjZToge1xuICAgICAgICAgICAgZG9tYWluTmFtZTogJ215b3JpZ2luLmNvbScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBmYWlsb3ZlckN1c3RvbU9yaWdpblNvdXJjZToge1xuICAgICAgICAgICAgZG9tYWluTmFtZTogJ215b3JpZ2luZmFsbGJhY2suY29tJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJlaGF2aW9yczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBpc0RlZmF1bHRCZWhhdmlvcjogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZEZyb250OjpEaXN0cmlidXRpb24nLCB7XG4gICAgICBEaXN0cmlidXRpb25Db25maWc6IHtcbiAgICAgICAgT3JpZ2luR3JvdXBzOiB7XG4gICAgICAgICAgSXRlbXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgRmFpbG92ZXJDcml0ZXJpYToge1xuICAgICAgICAgICAgICAgIFN0YXR1c0NvZGVzOiB7XG4gICAgICAgICAgICAgICAgICBJdGVtczogW1xuICAgICAgICAgICAgICAgICAgICA1MDAsXG4gICAgICAgICAgICAgICAgICAgIDUwMixcbiAgICAgICAgICAgICAgICAgICAgNTAzLFxuICAgICAgICAgICAgICAgICAgICA1MDQsXG4gICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgUXVhbnRpdHk6IDQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgSWQ6ICdPcmlnaW5Hcm91cDEnLFxuICAgICAgICAgICAgICBNZW1iZXJzOiB7XG4gICAgICAgICAgICAgICAgSXRlbXM6IFtcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgT3JpZ2luSWQ6ICdvcmlnaW4xJyxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIE9yaWdpbklkOiAnb3JpZ2luU2Vjb25kYXJ5MScsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgUXVhbnRpdHk6IDIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgUXVhbnRpdHk6IDEsXG4gICAgICAgIH0sXG4gICAgICAgIE9yaWdpbnM6IFtcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgIEN1c3RvbU9yaWdpbkNvbmZpZzoge1xuICAgICAgICAgICAgICBIVFRQUG9ydDogODAsXG4gICAgICAgICAgICAgIEhUVFBTUG9ydDogNDQzLFxuICAgICAgICAgICAgICBPcmlnaW5LZWVwYWxpdmVUaW1lb3V0OiA1LFxuICAgICAgICAgICAgICBPcmlnaW5Qcm90b2NvbFBvbGljeTogJ2h0dHBzLW9ubHknLFxuICAgICAgICAgICAgICBPcmlnaW5SZWFkVGltZW91dDogMzAsXG4gICAgICAgICAgICAgIE9yaWdpblNTTFByb3RvY29sczogW1xuICAgICAgICAgICAgICAgICdUTFN2MS4yJyxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBEb21haW5OYW1lOiAnbXlvcmlnaW5mYWxsYmFjay5jb20nLFxuICAgICAgICAgICAgSWQ6ICdvcmlnaW5TZWNvbmRhcnkxJyxcbiAgICAgICAgICAgIE9yaWdpbkN1c3RvbUhlYWRlcnM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIEhlYWRlck5hbWU6ICdYLUN1c3RvbS1IZWFkZXInLFxuICAgICAgICAgICAgICAgIEhlYWRlclZhbHVlOiAnc29tZXZhbHVlJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSksXG4gICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgICBDdXN0b21PcmlnaW5Db25maWc6IHtcbiAgICAgICAgICAgICAgSFRUUFBvcnQ6IDgwLFxuICAgICAgICAgICAgICBIVFRQU1BvcnQ6IDQ0MyxcbiAgICAgICAgICAgICAgT3JpZ2luS2VlcGFsaXZlVGltZW91dDogNSxcbiAgICAgICAgICAgICAgT3JpZ2luUHJvdG9jb2xQb2xpY3k6ICdodHRwcy1vbmx5JyxcbiAgICAgICAgICAgICAgT3JpZ2luUmVhZFRpbWVvdXQ6IDMwLFxuICAgICAgICAgICAgICBPcmlnaW5TU0xQcm90b2NvbHM6IFtcbiAgICAgICAgICAgICAgICAnVExTdjEuMicsXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgRG9tYWluTmFtZTogJ215b3JpZ2luLmNvbScsXG4gICAgICAgICAgICBJZDogJ29yaWdpbjEnLFxuICAgICAgICAgICAgT3JpZ2luQ3VzdG9tSGVhZGVyczogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgSGVhZGVyTmFtZTogJ1gtQ3VzdG9tLUhlYWRlcicsXG4gICAgICAgICAgICAgICAgSGVhZGVyVmFsdWU6ICdzb21ldmFsdWUnLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ0Rpc3RyaWJ1dGlvbiB3aXRoIHMzIG9yaWdpbiBmYWlsb3ZlcicsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgIG5ldyBDbG91ZEZyb250V2ViRGlzdHJpYnV0aW9uKHN0YWNrLCAnQURpc3RyaWJ1dGlvbicsIHtcbiAgICAgIG9yaWdpbkNvbmZpZ3M6IFtcbiAgICAgICAge1xuICAgICAgICAgIHMzT3JpZ2luU291cmNlOiB7XG4gICAgICAgICAgICBzM0J1Y2tldFNvdXJjZTogczMuQnVja2V0LmZyb21CdWNrZXROYW1lKHN0YWNrLCAnYUJ1Y2tldCcsICdteW9yaWdpbmJ1Y2tldCcpLFxuICAgICAgICAgICAgb3JpZ2luUGF0aDogJy8nLFxuICAgICAgICAgICAgb3JpZ2luSGVhZGVyczoge1xuICAgICAgICAgICAgICBteUhlYWRlcjogJzQyJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBmYWlsb3ZlclMzT3JpZ2luU291cmNlOiB7XG4gICAgICAgICAgICBzM0J1Y2tldFNvdXJjZTogczMuQnVja2V0LmZyb21CdWNrZXROYW1lKHN0YWNrLCAnYUJ1Y2tldEZhbGxiYWNrJywgJ215b3JpZ2luYnVja2V0ZmFsbGJhY2snKSxcbiAgICAgICAgICAgIG9yaWdpblBhdGg6ICcvc29td2hlcmUnLFxuICAgICAgICAgICAgb3JpZ2luSGVhZGVyczoge1xuICAgICAgICAgICAgICBteUhlYWRlcjI6ICcyMScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZmFpbG92ZXJDcml0ZXJpYVN0YXR1c0NvZGVzOiBbRmFpbG92ZXJTdGF0dXNDb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUl0sXG4gICAgICAgICAgYmVoYXZpb3JzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlzRGVmYXVsdEJlaGF2aW9yOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkRpc3RyaWJ1dGlvbicsIHtcbiAgICAgIERpc3RyaWJ1dGlvbkNvbmZpZzoge1xuICAgICAgICBPcmlnaW5Hcm91cHM6IHtcbiAgICAgICAgICBJdGVtczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBGYWlsb3ZlckNyaXRlcmlhOiB7XG4gICAgICAgICAgICAgICAgU3RhdHVzQ29kZXM6IHtcbiAgICAgICAgICAgICAgICAgIEl0ZW1zOiBbXG4gICAgICAgICAgICAgICAgICAgIDUwMCxcbiAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICBRdWFudGl0eTogMSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBJZDogJ09yaWdpbkdyb3VwMScsXG4gICAgICAgICAgICAgIE1lbWJlcnM6IHtcbiAgICAgICAgICAgICAgICBJdGVtczogW1xuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBPcmlnaW5JZDogJ29yaWdpbjEnLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgT3JpZ2luSWQ6ICdvcmlnaW5TZWNvbmRhcnkxJyxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBRdWFudGl0eTogMixcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICBRdWFudGl0eTogMSxcbiAgICAgICAgfSxcbiAgICAgICAgT3JpZ2luczogW1xuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgRG9tYWluTmFtZToge1xuICAgICAgICAgICAgICAnRm46OkpvaW4nOiBbXG4gICAgICAgICAgICAgICAgJycsXG4gICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgJ215b3JpZ2luYnVja2V0ZmFsbGJhY2suczMuJyxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgUmVmOiAnQVdTOjpSZWdpb24nLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICcuJyxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgUmVmOiAnQVdTOjpVUkxTdWZmaXgnLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIElkOiAnb3JpZ2luU2Vjb25kYXJ5MScsXG4gICAgICAgICAgICBPcmlnaW5DdXN0b21IZWFkZXJzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBIZWFkZXJOYW1lOiAnbXlIZWFkZXIyJyxcbiAgICAgICAgICAgICAgICBIZWFkZXJWYWx1ZTogJzIxJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBPcmlnaW5QYXRoOiAnL3NvbXdoZXJlJyxcbiAgICAgICAgICAgIFMzT3JpZ2luQ29uZmlnOiB7fSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgIERvbWFpbk5hbWU6IHtcbiAgICAgICAgICAgICAgJ0ZuOjpKb2luJzogW1xuICAgICAgICAgICAgICAgICcnLFxuICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICdteW9yaWdpbmJ1Y2tldC5zMy4nLFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBSZWY6ICdBV1M6OlJlZ2lvbicsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgJy4nLFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBSZWY6ICdBV1M6OlVSTFN1ZmZpeCcsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgSWQ6ICdvcmlnaW4xJyxcbiAgICAgICAgICAgIE9yaWdpbkN1c3RvbUhlYWRlcnM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIEhlYWRlck5hbWU6ICdteUhlYWRlcicsXG4gICAgICAgICAgICAgICAgSGVhZGVyVmFsdWU6ICc0MicsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgT3JpZ2luUGF0aDogJy8nLFxuICAgICAgICAgICAgUzNPcmlnaW5Db25maWc6IHt9LFxuICAgICAgICAgIH0pLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICB9KTtcblxuXG4gIH0pO1xufSk7XG4iXX0=