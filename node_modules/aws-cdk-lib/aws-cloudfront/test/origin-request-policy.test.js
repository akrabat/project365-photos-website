"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const core_1 = require("../../core");
const lib_1 = require("../lib");
describe('OriginRequestPolicy', () => {
    let app;
    let stack;
    beforeEach(() => {
        app = new core_1.App();
        stack = new core_1.Stack(app, 'Stack', {
            env: { account: '123456789012', region: 'testregion' },
        });
    });
    test('import existing policy by id', () => {
        const originRequestPolicyId = '344f6fe5-7ce5-4df0-a470-3f14177c549c';
        const originRequestPolicy = lib_1.OriginRequestPolicy.fromOriginRequestPolicyId(stack, 'MyPolicy', originRequestPolicyId);
        expect(originRequestPolicy.originRequestPolicyId).toEqual(originRequestPolicyId);
    });
    test('minimal example', () => {
        new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy');
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::OriginRequestPolicy', {
            OriginRequestPolicyConfig: {
                Name: 'StackOriginRequestPolicy6B17D9ED',
                CookiesConfig: {
                    CookieBehavior: 'none',
                },
                HeadersConfig: {
                    HeaderBehavior: 'none',
                },
                QueryStringsConfig: {
                    QueryStringBehavior: 'none',
                },
            },
        });
    });
    test('maximum example', () => {
        new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy', {
            originRequestPolicyName: 'MyPolicy',
            comment: 'A default policy',
            cookieBehavior: lib_1.OriginRequestCookieBehavior.none(),
            headerBehavior: lib_1.OriginRequestHeaderBehavior.all('CloudFront-Is-Android-Viewer'),
            queryStringBehavior: lib_1.OriginRequestQueryStringBehavior.allowList('username'),
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::OriginRequestPolicy', {
            OriginRequestPolicyConfig: {
                Name: 'MyPolicy',
                Comment: 'A default policy',
                CookiesConfig: {
                    CookieBehavior: 'none',
                },
                HeadersConfig: {
                    HeaderBehavior: 'allViewerAndWhitelistCloudFront',
                    Headers: ['CloudFront-Is-Android-Viewer'],
                },
                QueryStringsConfig: {
                    QueryStringBehavior: 'whitelist',
                    QueryStrings: ['username'],
                },
            },
        });
    });
    test('throws if given a originRequestPolicyName with invalid characters', () => {
        const errorMessage = /'originRequestPolicyName' can only include '-', '_', and alphanumeric characters/;
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy1', { originRequestPolicyName: 'My Policy' })).toThrow(errorMessage);
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy2', { originRequestPolicyName: 'MyPolicy!' })).toThrow(errorMessage);
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy3', { originRequestPolicyName: 'MyPolicy,New' })).toThrow(errorMessage);
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy4', { originRequestPolicyName: 'MyPolicy' })).not.toThrow();
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy5', { originRequestPolicyName: 'My-Policy' })).not.toThrow();
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy6', { originRequestPolicyName: 'My_Policy' })).not.toThrow();
    });
    test('throws if prohibited headers are being passed', () => {
        const errorMessage = /you cannot pass `Authorization` or `Accept-Encoding` as header values/;
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy1', { headerBehavior: lib_1.OriginRequestHeaderBehavior.allowList('Authorization') })).toThrow(errorMessage);
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy2', { headerBehavior: lib_1.OriginRequestHeaderBehavior.allowList('Accept-Encoding') })).toThrow(errorMessage);
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy3', { headerBehavior: lib_1.OriginRequestHeaderBehavior.allowList('authorization') })).toThrow(errorMessage);
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy4', { headerBehavior: lib_1.OriginRequestHeaderBehavior.allowList('accept-encoding') })).toThrow(errorMessage);
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy5', { headerBehavior: lib_1.OriginRequestHeaderBehavior.allowList('Foo', 'Authorization', 'Bar') })).toThrow(errorMessage);
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy6', { headerBehavior: lib_1.OriginRequestHeaderBehavior.allowList('Foo', 'Accept-Encoding', 'Bar') })).toThrow(errorMessage);
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy7', { headerBehavior: lib_1.OriginRequestHeaderBehavior.allowList('Foo', 'Bar') })).not.toThrow();
    });
    test('accepts headers with disallowed keywords as part of the header', () => {
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy1', { headerBehavior: lib_1.OriginRequestHeaderBehavior.allowList('x-wp-access-authorization') })).not.toThrow();
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy2', { headerBehavior: lib_1.OriginRequestHeaderBehavior.allowList('do-not-accept-encoding') })).not.toThrow();
        expect(() => new lib_1.OriginRequestPolicy(stack, 'OriginRequestPolicy3', { headerBehavior: lib_1.OriginRequestHeaderBehavior.allowList('authorization-Header') })).not.toThrow();
    });
    test('does not throw if originRequestPolicyName is a token', () => {
        expect(() => new lib_1.OriginRequestPolicy(stack, 'CachePolicy', {
            originRequestPolicyName: core_1.Aws.STACK_NAME,
        })).not.toThrow();
    });
});
test('managed policies are provided', () => {
    expect(lib_1.OriginRequestPolicy.USER_AGENT_REFERER_HEADERS.originRequestPolicyId).toEqual('acba4595-bd28-49b8-b9fe-13317c0390fa');
    expect(lib_1.OriginRequestPolicy.CORS_CUSTOM_ORIGIN.originRequestPolicyId).toEqual('59781a5b-3903-41f3-afcb-af62929ccde1');
    expect(lib_1.OriginRequestPolicy.CORS_S3_ORIGIN.originRequestPolicyId).toEqual('88a5eaf4-2fd4-4709-b370-b4c650ea3fcf');
    expect(lib_1.OriginRequestPolicy.ALL_VIEWER.originRequestPolicyId).toEqual('216adef6-5c7f-47e4-b989-5492eafa07d3');
    expect(lib_1.OriginRequestPolicy.ELEMENTAL_MEDIA_TAILOR.originRequestPolicyId).toEqual('775133bc-15f2-49f9-abea-afb2e0bf67d2');
    expect(lib_1.OriginRequestPolicy.ALL_VIEWER_AND_CLOUDFRONT_2022.originRequestPolicyId).toEqual('33f36d7e-f396-46d9-90e0-52428a34d9dc');
    expect(lib_1.OriginRequestPolicy.ALL_VIEWER_EXCEPT_HOST_HEADER.originRequestPolicyId).toEqual('b689b0a8-53d0-40ab-baf2-68738e2966ac');
});
// OriginRequestCookieBehavior and OriginRequestQueryStringBehavior have identical behavior
describe.each([
    ['CookieBehavior', lib_1.OriginRequestCookieBehavior, 'cookie', (c) => c.cookies],
    ['QueryStringBehavior', lib_1.OriginRequestQueryStringBehavior, 'query string', (qs) => qs.queryStrings],
])('%s', (_className, clazz, type, items) => {
    test('none()', () => {
        const behavior = clazz.none();
        expect(behavior.behavior).toEqual('none');
        expect(items(behavior)).toBeUndefined();
    });
    test('all()', () => {
        const behavior = clazz.all();
        expect(behavior.behavior).toEqual('all');
        expect(items(behavior)).toBeUndefined();
    });
    test('allowList()', () => {
        const behavior = clazz.allowList('SESSION_ID', 'secrets');
        expect(behavior.behavior).toEqual('whitelist');
        expect(items(behavior)).toEqual(['SESSION_ID', 'secrets']);
    });
    test('allowList() throws if list is empty', () => {
        expect(() => clazz.allowList()).toThrow(new RegExp(`At least one ${type} to allow must be provided`));
    });
});
describe('HeaderBehavior', () => {
    test('none()', () => {
        const headers = lib_1.OriginRequestHeaderBehavior.none();
        expect(headers.behavior).toEqual('none');
        expect(headers.headers).toBeUndefined();
    });
    test('allowList()', () => {
        const headers = lib_1.OriginRequestHeaderBehavior.allowList('X-CustomHeader', 'X-AnotherHeader');
        expect(headers.behavior).toEqual('whitelist');
        expect(headers.headers).toEqual(['X-CustomHeader', 'X-AnotherHeader']);
    });
    test('allowList() throws if list is empty', () => {
        expect(() => lib_1.OriginRequestHeaderBehavior.allowList()).toThrow(/At least one header to allow must be provided/);
    });
    describe('all()', () => {
        test('defaults to allViewer', () => {
            const headers = lib_1.OriginRequestHeaderBehavior.all();
            expect(headers.behavior).toEqual('allViewer');
            expect(headers.headers).toBeUndefined();
        });
        test('accepts additional CloudFront headers', () => {
            const headers = lib_1.OriginRequestHeaderBehavior.all('CloudFront-Is-Android-Viewer', 'CloudFront-Viewer-Country');
            expect(headers.behavior).toEqual('allViewerAndWhitelistCloudFront');
            expect(headers.headers).toEqual(['CloudFront-Is-Android-Viewer', 'CloudFront-Viewer-Country']);
        });
        test('throws if provided a header that is not a CloudFront- header', () => {
            const errorMessage = 'additional CloudFront headers passed to `OriginRequestHeaderBehavior.all()` must begin with \'CloudFront-\'';
            expect(() => { lib_1.OriginRequestHeaderBehavior.all('X-MyCustomHeader'); }).toThrow(errorMessage);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JpZ2luLXJlcXVlc3QtcG9saWN5LnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJvcmlnaW4tcmVxdWVzdC1wb2xpY3kudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUE0QztBQUM1QyxxQ0FBNkM7QUFDN0MsZ0NBQXlJO0FBRXpJLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsSUFBSSxHQUFRLENBQUM7SUFDYixJQUFJLEtBQVksQ0FBQztJQUVqQixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsR0FBRyxHQUFHLElBQUksVUFBRyxFQUFFLENBQUM7UUFDaEIsS0FBSyxHQUFHLElBQUksWUFBSyxDQUFDLEdBQUcsRUFBRSxPQUFPLEVBQUU7WUFDOUIsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFO1NBQ3ZELENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtRQUN4QyxNQUFNLHFCQUFxQixHQUFHLHNDQUFzQyxDQUFDO1FBQ3JFLE1BQU0sbUJBQW1CLEdBQUcseUJBQW1CLENBQUMseUJBQXlCLENBQUMsS0FBSyxFQUFFLFVBQVUsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO1FBQ3BILE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQ25GLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUMzQixJQUFJLHlCQUFtQixDQUFDLEtBQUssRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO1FBRXRELHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHNDQUFzQyxFQUFFO1lBQ3RGLHlCQUF5QixFQUFFO2dCQUN6QixJQUFJLEVBQUUsa0NBQWtDO2dCQUN4QyxhQUFhLEVBQUU7b0JBQ2IsY0FBYyxFQUFFLE1BQU07aUJBQ3ZCO2dCQUNELGFBQWEsRUFBRTtvQkFDYixjQUFjLEVBQUUsTUFBTTtpQkFDdkI7Z0JBQ0Qsa0JBQWtCLEVBQUU7b0JBQ2xCLG1CQUFtQixFQUFFLE1BQU07aUJBQzVCO2FBQ0Y7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7UUFDM0IsSUFBSSx5QkFBbUIsQ0FBQyxLQUFLLEVBQUUscUJBQXFCLEVBQUU7WUFDcEQsdUJBQXVCLEVBQUUsVUFBVTtZQUNuQyxPQUFPLEVBQUUsa0JBQWtCO1lBQzNCLGNBQWMsRUFBRSxpQ0FBMkIsQ0FBQyxJQUFJLEVBQUU7WUFDbEQsY0FBYyxFQUFFLGlDQUEyQixDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsQ0FBQztZQUMvRSxtQkFBbUIsRUFBRSxzQ0FBZ0MsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDO1NBQzVFLENBQUMsQ0FBQztRQUVILHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHNDQUFzQyxFQUFFO1lBQ3RGLHlCQUF5QixFQUFFO2dCQUN6QixJQUFJLEVBQUUsVUFBVTtnQkFDaEIsT0FBTyxFQUFFLGtCQUFrQjtnQkFDM0IsYUFBYSxFQUFFO29CQUNiLGNBQWMsRUFBRSxNQUFNO2lCQUN2QjtnQkFDRCxhQUFhLEVBQUU7b0JBQ2IsY0FBYyxFQUFFLGlDQUFpQztvQkFDakQsT0FBTyxFQUFFLENBQUMsOEJBQThCLENBQUM7aUJBQzFDO2dCQUNELGtCQUFrQixFQUFFO29CQUNsQixtQkFBbUIsRUFBRSxXQUFXO29CQUNoQyxZQUFZLEVBQUUsQ0FBQyxVQUFVLENBQUM7aUJBQzNCO2FBQ0Y7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxtRUFBbUUsRUFBRSxHQUFHLEVBQUU7UUFDN0UsTUFBTSxZQUFZLEdBQUcsa0ZBQWtGLENBQUM7UUFDeEcsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUkseUJBQW1CLENBQUMsS0FBSyxFQUFFLHNCQUFzQixFQUFFLEVBQUUsdUJBQXVCLEVBQUUsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNySSxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSx5QkFBbUIsQ0FBQyxLQUFLLEVBQUUsc0JBQXNCLEVBQUUsRUFBRSx1QkFBdUIsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3JJLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLHlCQUFtQixDQUFDLEtBQUssRUFBRSxzQkFBc0IsRUFBRSxFQUFFLHVCQUF1QixFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7UUFFeEksTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUkseUJBQW1CLENBQUMsS0FBSyxFQUFFLHNCQUFzQixFQUFFLEVBQUUsdUJBQXVCLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUM1SCxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSx5QkFBbUIsQ0FBQyxLQUFLLEVBQUUsc0JBQXNCLEVBQUUsRUFBRSx1QkFBdUIsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQzdILE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLHlCQUFtQixDQUFDLEtBQUssRUFBRSxzQkFBc0IsRUFBRSxFQUFFLHVCQUF1QixFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDL0gsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsK0NBQStDLEVBQUUsR0FBRyxFQUFFO1FBQ3pELE1BQU0sWUFBWSxHQUFHLHVFQUF1RSxDQUFDO1FBQzdGLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLHlCQUFtQixDQUFDLEtBQUssRUFBRSxzQkFBc0IsRUFBRSxFQUFFLGNBQWMsRUFBRSxpQ0FBMkIsQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3ZLLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLHlCQUFtQixDQUFDLEtBQUssRUFBRSxzQkFBc0IsRUFBRSxFQUFFLGNBQWMsRUFBRSxpQ0FBMkIsQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDekssTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUkseUJBQW1CLENBQUMsS0FBSyxFQUFFLHNCQUFzQixFQUFFLEVBQUUsY0FBYyxFQUFFLGlDQUEyQixDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdkssTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUkseUJBQW1CLENBQUMsS0FBSyxFQUFFLHNCQUFzQixFQUFFLEVBQUUsY0FBYyxFQUFFLGlDQUEyQixDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUN6SyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSx5QkFBbUIsQ0FBQyxLQUFLLEVBQUUsc0JBQXNCLEVBQUUsRUFBRSxjQUFjLEVBQUUsaUNBQTJCLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxlQUFlLEVBQUUsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3JMLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLHlCQUFtQixDQUFDLEtBQUssRUFBRSxzQkFBc0IsRUFBRSxFQUFFLGNBQWMsRUFBRSxpQ0FBMkIsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUV2TCxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSx5QkFBbUIsQ0FBQyxLQUFLLEVBQUUsc0JBQXNCLEVBQUUsRUFBRSxjQUFjLEVBQUUsaUNBQTJCLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDOUosQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsZ0VBQWdFLEVBQUUsR0FBRyxFQUFFO1FBQzFFLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLHlCQUFtQixDQUFDLEtBQUssRUFBRSxzQkFBc0IsRUFBRSxFQUFFLGNBQWMsRUFBRSxpQ0FBMkIsQ0FBQyxTQUFTLENBQUMsMkJBQTJCLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDM0ssTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUkseUJBQW1CLENBQUMsS0FBSyxFQUFFLHNCQUFzQixFQUFFLEVBQUUsY0FBYyxFQUFFLGlDQUEyQixDQUFDLFNBQVMsQ0FBQyx3QkFBd0IsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUN4SyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSx5QkFBbUIsQ0FBQyxLQUFLLEVBQUUsc0JBQXNCLEVBQUUsRUFBRSxjQUFjLEVBQUUsaUNBQTJCLENBQUMsU0FBUyxDQUFDLHNCQUFzQixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ3hLLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHNEQUFzRCxFQUFFLEdBQUcsRUFBRTtRQUNoRSxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSx5QkFBbUIsQ0FBQyxLQUFLLEVBQUUsYUFBYSxFQUFFO1lBQ3pELHVCQUF1QixFQUFFLFVBQUcsQ0FBQyxVQUFVO1NBQ3hDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNwQixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLCtCQUErQixFQUFFLEdBQUcsRUFBRTtJQUN6QyxNQUFNLENBQUMseUJBQW1CLENBQUMsMEJBQTBCLENBQUMscUJBQXFCLENBQUMsQ0FBQyxPQUFPLENBQUMsc0NBQXNDLENBQUMsQ0FBQztJQUM3SCxNQUFNLENBQUMseUJBQW1CLENBQUMsa0JBQWtCLENBQUMscUJBQXFCLENBQUMsQ0FBQyxPQUFPLENBQUMsc0NBQXNDLENBQUMsQ0FBQztJQUNySCxNQUFNLENBQUMseUJBQW1CLENBQUMsY0FBYyxDQUFDLHFCQUFxQixDQUFDLENBQUMsT0FBTyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7SUFDakgsTUFBTSxDQUFDLHlCQUFtQixDQUFDLFVBQVUsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO0lBQzdHLE1BQU0sQ0FBQyx5QkFBbUIsQ0FBQyxzQkFBc0IsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO0lBQ3pILE1BQU0sQ0FBQyx5QkFBbUIsQ0FBQyw4QkFBOEIsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO0lBQ2pJLE1BQU0sQ0FBQyx5QkFBbUIsQ0FBQyw2QkFBNkIsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO0FBQ2xJLENBQUMsQ0FBQyxDQUFDO0FBRUgsMkZBQTJGO0FBQzNGLFFBQVEsQ0FBQyxJQUFJLENBQUM7SUFDWixDQUFDLGdCQUFnQixFQUFFLGlDQUEyQixFQUFFLFFBQVEsRUFBRSxDQUFDLENBQThCLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7SUFDeEcsQ0FBQyxxQkFBcUIsRUFBRSxzQ0FBZ0MsRUFBRSxjQUFjLEVBQUUsQ0FBQyxFQUFvQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDO0NBQ3JJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRTtJQUMxQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRTtRQUNsQixNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFOUIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQzFDLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUU7UUFDakIsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRTdCLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUMxQyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQ3ZCLE1BQU0sUUFBUSxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBRTFELE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQy9DLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFZLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUM3RCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7UUFDL0MsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxnQkFBZ0IsSUFBSSw0QkFBNEIsQ0FBQyxDQUFDLENBQUM7SUFDeEcsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7SUFDOUIsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDbEIsTUFBTSxPQUFPLEdBQUcsaUNBQTJCLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFbkQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUMxQyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQ3ZCLE1BQU0sT0FBTyxHQUFHLGlDQUEyQixDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1FBRTNGLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzlDLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO0lBQ3pFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRTtRQUMvQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsaUNBQTJCLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsK0NBQStDLENBQUMsQ0FBQztJQUNqSCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFO1FBQ3JCLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7WUFDakMsTUFBTSxPQUFPLEdBQUcsaUNBQTJCLENBQUMsR0FBRyxFQUFFLENBQUM7WUFFbEQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDOUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUMxQyxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7WUFDakQsTUFBTSxPQUFPLEdBQUcsaUNBQTJCLENBQUMsR0FBRyxDQUFDLDhCQUE4QixFQUFFLDJCQUEyQixDQUFDLENBQUM7WUFFN0csTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsaUNBQWlDLENBQUMsQ0FBQztZQUNwRSxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLDhCQUE4QixFQUFFLDJCQUEyQixDQUFDLENBQUMsQ0FBQztRQUNqRyxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyw4REFBOEQsRUFBRSxHQUFHLEVBQUU7WUFDeEUsTUFBTSxZQUFZLEdBQUcsNkdBQTZHLENBQUM7WUFDbkksTUFBTSxDQUFDLEdBQUcsRUFBRSxHQUFHLGlDQUEyQixDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQy9GLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgeyBBcHAsIEF3cywgU3RhY2sgfSBmcm9tICcuLi8uLi9jb3JlJztcbmltcG9ydCB7IE9yaWdpblJlcXVlc3RQb2xpY3ksIE9yaWdpblJlcXVlc3RDb29raWVCZWhhdmlvciwgT3JpZ2luUmVxdWVzdEhlYWRlckJlaGF2aW9yLCBPcmlnaW5SZXF1ZXN0UXVlcnlTdHJpbmdCZWhhdmlvciB9IGZyb20gJy4uL2xpYic7XG5cbmRlc2NyaWJlKCdPcmlnaW5SZXF1ZXN0UG9saWN5JywgKCkgPT4ge1xuICBsZXQgYXBwOiBBcHA7XG4gIGxldCBzdGFjazogU3RhY2s7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgYXBwID0gbmV3IEFwcCgpO1xuICAgIHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ1N0YWNrJywge1xuICAgICAgZW52OiB7IGFjY291bnQ6ICcxMjM0NTY3ODkwMTInLCByZWdpb246ICd0ZXN0cmVnaW9uJyB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdpbXBvcnQgZXhpc3RpbmcgcG9saWN5IGJ5IGlkJywgKCkgPT4ge1xuICAgIGNvbnN0IG9yaWdpblJlcXVlc3RQb2xpY3lJZCA9ICczNDRmNmZlNS03Y2U1LTRkZjAtYTQ3MC0zZjE0MTc3YzU0OWMnO1xuICAgIGNvbnN0IG9yaWdpblJlcXVlc3RQb2xpY3kgPSBPcmlnaW5SZXF1ZXN0UG9saWN5LmZyb21PcmlnaW5SZXF1ZXN0UG9saWN5SWQoc3RhY2ssICdNeVBvbGljeScsIG9yaWdpblJlcXVlc3RQb2xpY3lJZCk7XG4gICAgZXhwZWN0KG9yaWdpblJlcXVlc3RQb2xpY3kub3JpZ2luUmVxdWVzdFBvbGljeUlkKS50b0VxdWFsKG9yaWdpblJlcXVlc3RQb2xpY3lJZCk7XG4gIH0pO1xuXG4gIHRlc3QoJ21pbmltYWwgZXhhbXBsZScsICgpID0+IHtcbiAgICBuZXcgT3JpZ2luUmVxdWVzdFBvbGljeShzdGFjaywgJ09yaWdpblJlcXVlc3RQb2xpY3knKTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6Ok9yaWdpblJlcXVlc3RQb2xpY3knLCB7XG4gICAgICBPcmlnaW5SZXF1ZXN0UG9saWN5Q29uZmlnOiB7XG4gICAgICAgIE5hbWU6ICdTdGFja09yaWdpblJlcXVlc3RQb2xpY3k2QjE3RDlFRCcsXG4gICAgICAgIENvb2tpZXNDb25maWc6IHtcbiAgICAgICAgICBDb29raWVCZWhhdmlvcjogJ25vbmUnLFxuICAgICAgICB9LFxuICAgICAgICBIZWFkZXJzQ29uZmlnOiB7XG4gICAgICAgICAgSGVhZGVyQmVoYXZpb3I6ICdub25lJyxcbiAgICAgICAgfSxcbiAgICAgICAgUXVlcnlTdHJpbmdzQ29uZmlnOiB7XG4gICAgICAgICAgUXVlcnlTdHJpbmdCZWhhdmlvcjogJ25vbmUnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnbWF4aW11bSBleGFtcGxlJywgKCkgPT4ge1xuICAgIG5ldyBPcmlnaW5SZXF1ZXN0UG9saWN5KHN0YWNrLCAnT3JpZ2luUmVxdWVzdFBvbGljeScsIHtcbiAgICAgIG9yaWdpblJlcXVlc3RQb2xpY3lOYW1lOiAnTXlQb2xpY3knLFxuICAgICAgY29tbWVudDogJ0EgZGVmYXVsdCBwb2xpY3knLFxuICAgICAgY29va2llQmVoYXZpb3I6IE9yaWdpblJlcXVlc3RDb29raWVCZWhhdmlvci5ub25lKCksXG4gICAgICBoZWFkZXJCZWhhdmlvcjogT3JpZ2luUmVxdWVzdEhlYWRlckJlaGF2aW9yLmFsbCgnQ2xvdWRGcm9udC1Jcy1BbmRyb2lkLVZpZXdlcicpLFxuICAgICAgcXVlcnlTdHJpbmdCZWhhdmlvcjogT3JpZ2luUmVxdWVzdFF1ZXJ5U3RyaW5nQmVoYXZpb3IuYWxsb3dMaXN0KCd1c2VybmFtZScpLFxuICAgIH0pO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q2xvdWRGcm9udDo6T3JpZ2luUmVxdWVzdFBvbGljeScsIHtcbiAgICAgIE9yaWdpblJlcXVlc3RQb2xpY3lDb25maWc6IHtcbiAgICAgICAgTmFtZTogJ015UG9saWN5JyxcbiAgICAgICAgQ29tbWVudDogJ0EgZGVmYXVsdCBwb2xpY3knLFxuICAgICAgICBDb29raWVzQ29uZmlnOiB7XG4gICAgICAgICAgQ29va2llQmVoYXZpb3I6ICdub25lJyxcbiAgICAgICAgfSxcbiAgICAgICAgSGVhZGVyc0NvbmZpZzoge1xuICAgICAgICAgIEhlYWRlckJlaGF2aW9yOiAnYWxsVmlld2VyQW5kV2hpdGVsaXN0Q2xvdWRGcm9udCcsXG4gICAgICAgICAgSGVhZGVyczogWydDbG91ZEZyb250LUlzLUFuZHJvaWQtVmlld2VyJ10sXG4gICAgICAgIH0sXG4gICAgICAgIFF1ZXJ5U3RyaW5nc0NvbmZpZzoge1xuICAgICAgICAgIFF1ZXJ5U3RyaW5nQmVoYXZpb3I6ICd3aGl0ZWxpc3QnLFxuICAgICAgICAgIFF1ZXJ5U3RyaW5nczogWyd1c2VybmFtZSddLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgndGhyb3dzIGlmIGdpdmVuIGEgb3JpZ2luUmVxdWVzdFBvbGljeU5hbWUgd2l0aCBpbnZhbGlkIGNoYXJhY3RlcnMnLCAoKSA9PiB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gLydvcmlnaW5SZXF1ZXN0UG9saWN5TmFtZScgY2FuIG9ubHkgaW5jbHVkZSAnLScsICdfJywgYW5kIGFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzLztcbiAgICBleHBlY3QoKCkgPT4gbmV3IE9yaWdpblJlcXVlc3RQb2xpY3koc3RhY2ssICdPcmlnaW5SZXF1ZXN0UG9saWN5MScsIHsgb3JpZ2luUmVxdWVzdFBvbGljeU5hbWU6ICdNeSBQb2xpY3knIH0pKS50b1Rocm93KGVycm9yTWVzc2FnZSk7XG4gICAgZXhwZWN0KCgpID0+IG5ldyBPcmlnaW5SZXF1ZXN0UG9saWN5KHN0YWNrLCAnT3JpZ2luUmVxdWVzdFBvbGljeTInLCB7IG9yaWdpblJlcXVlc3RQb2xpY3lOYW1lOiAnTXlQb2xpY3khJyB9KSkudG9UaHJvdyhlcnJvck1lc3NhZ2UpO1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgT3JpZ2luUmVxdWVzdFBvbGljeShzdGFjaywgJ09yaWdpblJlcXVlc3RQb2xpY3kzJywgeyBvcmlnaW5SZXF1ZXN0UG9saWN5TmFtZTogJ015UG9saWN5LE5ldycgfSkpLnRvVGhyb3coZXJyb3JNZXNzYWdlKTtcblxuICAgIGV4cGVjdCgoKSA9PiBuZXcgT3JpZ2luUmVxdWVzdFBvbGljeShzdGFjaywgJ09yaWdpblJlcXVlc3RQb2xpY3k0JywgeyBvcmlnaW5SZXF1ZXN0UG9saWN5TmFtZTogJ015UG9saWN5JyB9KSkubm90LnRvVGhyb3coKTtcbiAgICBleHBlY3QoKCkgPT4gbmV3IE9yaWdpblJlcXVlc3RQb2xpY3koc3RhY2ssICdPcmlnaW5SZXF1ZXN0UG9saWN5NScsIHsgb3JpZ2luUmVxdWVzdFBvbGljeU5hbWU6ICdNeS1Qb2xpY3knIH0pKS5ub3QudG9UaHJvdygpO1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgT3JpZ2luUmVxdWVzdFBvbGljeShzdGFjaywgJ09yaWdpblJlcXVlc3RQb2xpY3k2JywgeyBvcmlnaW5SZXF1ZXN0UG9saWN5TmFtZTogJ015X1BvbGljeScgfSkpLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Rocm93cyBpZiBwcm9oaWJpdGVkIGhlYWRlcnMgYXJlIGJlaW5nIHBhc3NlZCcsICgpID0+IHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSAveW91IGNhbm5vdCBwYXNzIGBBdXRob3JpemF0aW9uYCBvciBgQWNjZXB0LUVuY29kaW5nYCBhcyBoZWFkZXIgdmFsdWVzLztcbiAgICBleHBlY3QoKCkgPT4gbmV3IE9yaWdpblJlcXVlc3RQb2xpY3koc3RhY2ssICdPcmlnaW5SZXF1ZXN0UG9saWN5MScsIHsgaGVhZGVyQmVoYXZpb3I6IE9yaWdpblJlcXVlc3RIZWFkZXJCZWhhdmlvci5hbGxvd0xpc3QoJ0F1dGhvcml6YXRpb24nKSB9KSkudG9UaHJvdyhlcnJvck1lc3NhZ2UpO1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgT3JpZ2luUmVxdWVzdFBvbGljeShzdGFjaywgJ09yaWdpblJlcXVlc3RQb2xpY3kyJywgeyBoZWFkZXJCZWhhdmlvcjogT3JpZ2luUmVxdWVzdEhlYWRlckJlaGF2aW9yLmFsbG93TGlzdCgnQWNjZXB0LUVuY29kaW5nJykgfSkpLnRvVGhyb3coZXJyb3JNZXNzYWdlKTtcbiAgICBleHBlY3QoKCkgPT4gbmV3IE9yaWdpblJlcXVlc3RQb2xpY3koc3RhY2ssICdPcmlnaW5SZXF1ZXN0UG9saWN5MycsIHsgaGVhZGVyQmVoYXZpb3I6IE9yaWdpblJlcXVlc3RIZWFkZXJCZWhhdmlvci5hbGxvd0xpc3QoJ2F1dGhvcml6YXRpb24nKSB9KSkudG9UaHJvdyhlcnJvck1lc3NhZ2UpO1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgT3JpZ2luUmVxdWVzdFBvbGljeShzdGFjaywgJ09yaWdpblJlcXVlc3RQb2xpY3k0JywgeyBoZWFkZXJCZWhhdmlvcjogT3JpZ2luUmVxdWVzdEhlYWRlckJlaGF2aW9yLmFsbG93TGlzdCgnYWNjZXB0LWVuY29kaW5nJykgfSkpLnRvVGhyb3coZXJyb3JNZXNzYWdlKTtcbiAgICBleHBlY3QoKCkgPT4gbmV3IE9yaWdpblJlcXVlc3RQb2xpY3koc3RhY2ssICdPcmlnaW5SZXF1ZXN0UG9saWN5NScsIHsgaGVhZGVyQmVoYXZpb3I6IE9yaWdpblJlcXVlc3RIZWFkZXJCZWhhdmlvci5hbGxvd0xpc3QoJ0ZvbycsICdBdXRob3JpemF0aW9uJywgJ0JhcicpIH0pKS50b1Rocm93KGVycm9yTWVzc2FnZSk7XG4gICAgZXhwZWN0KCgpID0+IG5ldyBPcmlnaW5SZXF1ZXN0UG9saWN5KHN0YWNrLCAnT3JpZ2luUmVxdWVzdFBvbGljeTYnLCB7IGhlYWRlckJlaGF2aW9yOiBPcmlnaW5SZXF1ZXN0SGVhZGVyQmVoYXZpb3IuYWxsb3dMaXN0KCdGb28nLCAnQWNjZXB0LUVuY29kaW5nJywgJ0JhcicpIH0pKS50b1Rocm93KGVycm9yTWVzc2FnZSk7XG5cbiAgICBleHBlY3QoKCkgPT4gbmV3IE9yaWdpblJlcXVlc3RQb2xpY3koc3RhY2ssICdPcmlnaW5SZXF1ZXN0UG9saWN5NycsIHsgaGVhZGVyQmVoYXZpb3I6IE9yaWdpblJlcXVlc3RIZWFkZXJCZWhhdmlvci5hbGxvd0xpc3QoJ0ZvbycsICdCYXInKSB9KSkubm90LnRvVGhyb3coKTtcbiAgfSk7XG5cbiAgdGVzdCgnYWNjZXB0cyBoZWFkZXJzIHdpdGggZGlzYWxsb3dlZCBrZXl3b3JkcyBhcyBwYXJ0IG9mIHRoZSBoZWFkZXInLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IG5ldyBPcmlnaW5SZXF1ZXN0UG9saWN5KHN0YWNrLCAnT3JpZ2luUmVxdWVzdFBvbGljeTEnLCB7IGhlYWRlckJlaGF2aW9yOiBPcmlnaW5SZXF1ZXN0SGVhZGVyQmVoYXZpb3IuYWxsb3dMaXN0KCd4LXdwLWFjY2Vzcy1hdXRob3JpemF0aW9uJykgfSkpLm5vdC50b1Rocm93KCk7XG4gICAgZXhwZWN0KCgpID0+IG5ldyBPcmlnaW5SZXF1ZXN0UG9saWN5KHN0YWNrLCAnT3JpZ2luUmVxdWVzdFBvbGljeTInLCB7IGhlYWRlckJlaGF2aW9yOiBPcmlnaW5SZXF1ZXN0SGVhZGVyQmVoYXZpb3IuYWxsb3dMaXN0KCdkby1ub3QtYWNjZXB0LWVuY29kaW5nJykgfSkpLm5vdC50b1Rocm93KCk7XG4gICAgZXhwZWN0KCgpID0+IG5ldyBPcmlnaW5SZXF1ZXN0UG9saWN5KHN0YWNrLCAnT3JpZ2luUmVxdWVzdFBvbGljeTMnLCB7IGhlYWRlckJlaGF2aW9yOiBPcmlnaW5SZXF1ZXN0SGVhZGVyQmVoYXZpb3IuYWxsb3dMaXN0KCdhdXRob3JpemF0aW9uLUhlYWRlcicpIH0pKS5ub3QudG9UaHJvdygpO1xuICB9KTtcblxuICB0ZXN0KCdkb2VzIG5vdCB0aHJvdyBpZiBvcmlnaW5SZXF1ZXN0UG9saWN5TmFtZSBpcyBhIHRva2VuJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgT3JpZ2luUmVxdWVzdFBvbGljeShzdGFjaywgJ0NhY2hlUG9saWN5Jywge1xuICAgICAgb3JpZ2luUmVxdWVzdFBvbGljeU5hbWU6IEF3cy5TVEFDS19OQU1FLFxuICAgIH0pKS5ub3QudG9UaHJvdygpO1xuICB9KTtcbn0pO1xuXG50ZXN0KCdtYW5hZ2VkIHBvbGljaWVzIGFyZSBwcm92aWRlZCcsICgpID0+IHtcbiAgZXhwZWN0KE9yaWdpblJlcXVlc3RQb2xpY3kuVVNFUl9BR0VOVF9SRUZFUkVSX0hFQURFUlMub3JpZ2luUmVxdWVzdFBvbGljeUlkKS50b0VxdWFsKCdhY2JhNDU5NS1iZDI4LTQ5YjgtYjlmZS0xMzMxN2MwMzkwZmEnKTtcbiAgZXhwZWN0KE9yaWdpblJlcXVlc3RQb2xpY3kuQ09SU19DVVNUT01fT1JJR0lOLm9yaWdpblJlcXVlc3RQb2xpY3lJZCkudG9FcXVhbCgnNTk3ODFhNWItMzkwMy00MWYzLWFmY2ItYWY2MjkyOWNjZGUxJyk7XG4gIGV4cGVjdChPcmlnaW5SZXF1ZXN0UG9saWN5LkNPUlNfUzNfT1JJR0lOLm9yaWdpblJlcXVlc3RQb2xpY3lJZCkudG9FcXVhbCgnODhhNWVhZjQtMmZkNC00NzA5LWIzNzAtYjRjNjUwZWEzZmNmJyk7XG4gIGV4cGVjdChPcmlnaW5SZXF1ZXN0UG9saWN5LkFMTF9WSUVXRVIub3JpZ2luUmVxdWVzdFBvbGljeUlkKS50b0VxdWFsKCcyMTZhZGVmNi01YzdmLTQ3ZTQtYjk4OS01NDkyZWFmYTA3ZDMnKTtcbiAgZXhwZWN0KE9yaWdpblJlcXVlc3RQb2xpY3kuRUxFTUVOVEFMX01FRElBX1RBSUxPUi5vcmlnaW5SZXF1ZXN0UG9saWN5SWQpLnRvRXF1YWwoJzc3NTEzM2JjLTE1ZjItNDlmOS1hYmVhLWFmYjJlMGJmNjdkMicpO1xuICBleHBlY3QoT3JpZ2luUmVxdWVzdFBvbGljeS5BTExfVklFV0VSX0FORF9DTE9VREZST05UXzIwMjIub3JpZ2luUmVxdWVzdFBvbGljeUlkKS50b0VxdWFsKCczM2YzNmQ3ZS1mMzk2LTQ2ZDktOTBlMC01MjQyOGEzNGQ5ZGMnKTtcbiAgZXhwZWN0KE9yaWdpblJlcXVlc3RQb2xpY3kuQUxMX1ZJRVdFUl9FWENFUFRfSE9TVF9IRUFERVIub3JpZ2luUmVxdWVzdFBvbGljeUlkKS50b0VxdWFsKCdiNjg5YjBhOC01M2QwLTQwYWItYmFmMi02ODczOGUyOTY2YWMnKTtcbn0pO1xuXG4vLyBPcmlnaW5SZXF1ZXN0Q29va2llQmVoYXZpb3IgYW5kIE9yaWdpblJlcXVlc3RRdWVyeVN0cmluZ0JlaGF2aW9yIGhhdmUgaWRlbnRpY2FsIGJlaGF2aW9yXG5kZXNjcmliZS5lYWNoKFtcbiAgWydDb29raWVCZWhhdmlvcicsIE9yaWdpblJlcXVlc3RDb29raWVCZWhhdmlvciwgJ2Nvb2tpZScsIChjOiBPcmlnaW5SZXF1ZXN0Q29va2llQmVoYXZpb3IpID0+IGMuY29va2llc10sXG4gIFsnUXVlcnlTdHJpbmdCZWhhdmlvcicsIE9yaWdpblJlcXVlc3RRdWVyeVN0cmluZ0JlaGF2aW9yLCAncXVlcnkgc3RyaW5nJywgKHFzOiBPcmlnaW5SZXF1ZXN0UXVlcnlTdHJpbmdCZWhhdmlvcikgPT4gcXMucXVlcnlTdHJpbmdzXSxcbl0pKCclcycsIChfY2xhc3NOYW1lLCBjbGF6eiwgdHlwZSwgaXRlbXMpID0+IHtcbiAgdGVzdCgnbm9uZSgpJywgKCkgPT4ge1xuICAgIGNvbnN0IGJlaGF2aW9yID0gY2xhenoubm9uZSgpO1xuXG4gICAgZXhwZWN0KGJlaGF2aW9yLmJlaGF2aW9yKS50b0VxdWFsKCdub25lJyk7XG4gICAgZXhwZWN0KGl0ZW1zKGJlaGF2aW9yKSkudG9CZVVuZGVmaW5lZCgpO1xuICB9KTtcblxuICB0ZXN0KCdhbGwoKScsICgpID0+IHtcbiAgICBjb25zdCBiZWhhdmlvciA9IGNsYXp6LmFsbCgpO1xuXG4gICAgZXhwZWN0KGJlaGF2aW9yLmJlaGF2aW9yKS50b0VxdWFsKCdhbGwnKTtcbiAgICBleHBlY3QoaXRlbXMoYmVoYXZpb3IpKS50b0JlVW5kZWZpbmVkKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FsbG93TGlzdCgpJywgKCkgPT4ge1xuICAgIGNvbnN0IGJlaGF2aW9yID0gY2xhenouYWxsb3dMaXN0KCdTRVNTSU9OX0lEJywgJ3NlY3JldHMnKTtcblxuICAgIGV4cGVjdChiZWhhdmlvci5iZWhhdmlvcikudG9FcXVhbCgnd2hpdGVsaXN0Jyk7XG4gICAgZXhwZWN0KGl0ZW1zKGJlaGF2aW9yKSkudG9FcXVhbChbJ1NFU1NJT05fSUQnLCAnc2VjcmV0cyddKTtcbiAgfSk7XG5cbiAgdGVzdCgnYWxsb3dMaXN0KCkgdGhyb3dzIGlmIGxpc3QgaXMgZW1wdHknLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IGNsYXp6LmFsbG93TGlzdCgpKS50b1Rocm93KG5ldyBSZWdFeHAoYEF0IGxlYXN0IG9uZSAke3R5cGV9IHRvIGFsbG93IG11c3QgYmUgcHJvdmlkZWRgKSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdIZWFkZXJCZWhhdmlvcicsICgpID0+IHtcbiAgdGVzdCgnbm9uZSgpJywgKCkgPT4ge1xuICAgIGNvbnN0IGhlYWRlcnMgPSBPcmlnaW5SZXF1ZXN0SGVhZGVyQmVoYXZpb3Iubm9uZSgpO1xuXG4gICAgZXhwZWN0KGhlYWRlcnMuYmVoYXZpb3IpLnRvRXF1YWwoJ25vbmUnKTtcbiAgICBleHBlY3QoaGVhZGVycy5oZWFkZXJzKS50b0JlVW5kZWZpbmVkKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FsbG93TGlzdCgpJywgKCkgPT4ge1xuICAgIGNvbnN0IGhlYWRlcnMgPSBPcmlnaW5SZXF1ZXN0SGVhZGVyQmVoYXZpb3IuYWxsb3dMaXN0KCdYLUN1c3RvbUhlYWRlcicsICdYLUFub3RoZXJIZWFkZXInKTtcblxuICAgIGV4cGVjdChoZWFkZXJzLmJlaGF2aW9yKS50b0VxdWFsKCd3aGl0ZWxpc3QnKTtcbiAgICBleHBlY3QoaGVhZGVycy5oZWFkZXJzKS50b0VxdWFsKFsnWC1DdXN0b21IZWFkZXInLCAnWC1Bbm90aGVySGVhZGVyJ10pO1xuICB9KTtcblxuICB0ZXN0KCdhbGxvd0xpc3QoKSB0aHJvd3MgaWYgbGlzdCBpcyBlbXB0eScsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4gT3JpZ2luUmVxdWVzdEhlYWRlckJlaGF2aW9yLmFsbG93TGlzdCgpKS50b1Rocm93KC9BdCBsZWFzdCBvbmUgaGVhZGVyIHRvIGFsbG93IG11c3QgYmUgcHJvdmlkZWQvKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FsbCgpJywgKCkgPT4ge1xuICAgIHRlc3QoJ2RlZmF1bHRzIHRvIGFsbFZpZXdlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IGhlYWRlcnMgPSBPcmlnaW5SZXF1ZXN0SGVhZGVyQmVoYXZpb3IuYWxsKCk7XG5cbiAgICAgIGV4cGVjdChoZWFkZXJzLmJlaGF2aW9yKS50b0VxdWFsKCdhbGxWaWV3ZXInKTtcbiAgICAgIGV4cGVjdChoZWFkZXJzLmhlYWRlcnMpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2FjY2VwdHMgYWRkaXRpb25hbCBDbG91ZEZyb250IGhlYWRlcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBoZWFkZXJzID0gT3JpZ2luUmVxdWVzdEhlYWRlckJlaGF2aW9yLmFsbCgnQ2xvdWRGcm9udC1Jcy1BbmRyb2lkLVZpZXdlcicsICdDbG91ZEZyb250LVZpZXdlci1Db3VudHJ5Jyk7XG5cbiAgICAgIGV4cGVjdChoZWFkZXJzLmJlaGF2aW9yKS50b0VxdWFsKCdhbGxWaWV3ZXJBbmRXaGl0ZWxpc3RDbG91ZEZyb250Jyk7XG4gICAgICBleHBlY3QoaGVhZGVycy5oZWFkZXJzKS50b0VxdWFsKFsnQ2xvdWRGcm9udC1Jcy1BbmRyb2lkLVZpZXdlcicsICdDbG91ZEZyb250LVZpZXdlci1Db3VudHJ5J10pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgndGhyb3dzIGlmIHByb3ZpZGVkIGEgaGVhZGVyIHRoYXQgaXMgbm90IGEgQ2xvdWRGcm9udC0gaGVhZGVyJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gJ2FkZGl0aW9uYWwgQ2xvdWRGcm9udCBoZWFkZXJzIHBhc3NlZCB0byBgT3JpZ2luUmVxdWVzdEhlYWRlckJlaGF2aW9yLmFsbCgpYCBtdXN0IGJlZ2luIHdpdGggXFwnQ2xvdWRGcm9udC1cXCcnO1xuICAgICAgZXhwZWN0KCgpID0+IHsgT3JpZ2luUmVxdWVzdEhlYWRlckJlaGF2aW9yLmFsbCgnWC1NeUN1c3RvbUhlYWRlcicpOyB9KS50b1Rocm93KGVycm9yTWVzc2FnZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=