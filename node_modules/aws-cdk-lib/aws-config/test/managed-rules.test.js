"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const sns = require("../../aws-sns");
const cdk = require("../../core");
const config = require("../lib");
describe('access keys', () => {
    test('rotated', () => {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        new config.AccessKeysRotated(stack, 'AccessKeys');
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Config::ConfigRule', {
            Source: {
                Owner: 'AWS',
                SourceIdentifier: 'ACCESS_KEYS_ROTATED',
            },
        });
    });
    test('rotated with max age', () => {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        new config.AccessKeysRotated(stack, 'AccessKeys', {
            maxAge: cdk.Duration.days(1),
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Config::ConfigRule', {
            Source: {
                Owner: 'AWS',
                SourceIdentifier: 'ACCESS_KEYS_ROTATED',
            },
            InputParameters: {
                maxAccessKeyAge: 1,
            },
        });
    });
});
describe('cloudformation stack', () => {
    test('drift detection check', () => {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        new config.CloudFormationStackDriftDetectionCheck(stack, 'Drift');
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Config::ConfigRule', {
            Source: {
                Owner: 'AWS',
                SourceIdentifier: 'CLOUDFORMATION_STACK_DRIFT_DETECTION_CHECK',
            },
            InputParameters: {
                cloudformationRoleArn: {
                    'Fn::GetAtt': [
                        'DriftRole8A5FB833',
                        'Arn',
                    ],
                },
            },
            Scope: {
                ComplianceResourceTypes: [
                    'AWS::CloudFormation::Stack',
                ],
            },
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Role', {
            AssumeRolePolicyDocument: {
                Statement: [
                    {
                        Action: 'sts:AssumeRole',
                        Effect: 'Allow',
                        Principal: {
                            Service: 'config.amazonaws.com',
                        },
                    },
                ],
                Version: '2012-10-17',
            },
            ManagedPolicyArns: [
                {
                    'Fn::Join': [
                        '',
                        [
                            'arn:',
                            {
                                Ref: 'AWS::Partition',
                            },
                            ':iam::aws:policy/ReadOnlyAccess',
                        ],
                    ],
                },
            ],
        });
    });
    test('notification check', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const topic1 = new sns.Topic(stack, 'AllowedTopic1');
        const topic2 = new sns.Topic(stack, 'AllowedTopic2');
        // WHEN
        new config.CloudFormationStackNotificationCheck(stack, 'Notification', {
            topics: [topic1, topic2],
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Config::ConfigRule', {
            Source: {
                Owner: 'AWS',
                SourceIdentifier: 'CLOUDFORMATION_STACK_NOTIFICATION_CHECK',
            },
            InputParameters: {
                snsTopic1: {
                    Ref: 'AllowedTopic10C9144F9',
                },
                snsTopic2: {
                    Ref: 'AllowedTopic24ECF6C0D',
                },
            },
            Scope: {
                ComplianceResourceTypes: [
                    'AWS::CloudFormation::Stack',
                ],
            },
        });
    });
    test('notification check throws with more than 5 topics', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const topic = new sns.Topic(stack, 'AllowedTopic1');
        // THEN
        expect(() => new config.CloudFormationStackNotificationCheck(stack, 'Notification', {
            topics: [topic, topic, topic, topic, topic, topic],
        })).toThrow(/5 topics/);
    });
});
describe('ec2 instance', () => {
    test('profile attached check', () => {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        new config.ManagedRule(stack, 'Ec2InstanceProfileAttached', {
            identifier: config.ManagedRuleIdentifiers.EC2_INSTANCE_PROFILE_ATTACHED,
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Config::ConfigRule', {
            Source: {
                Owner: 'AWS',
                SourceIdentifier: config.ManagedRuleIdentifiers.EC2_INSTANCE_PROFILE_ATTACHED,
            },
        });
    });
});
describe('s3 bucket level', () => {
    test('public access prohibited', () => {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        new config.ManagedRule(stack, 'S3BucketLevelPublicAccessProhibited', {
            identifier: config.ManagedRuleIdentifiers.S3_BUCKET_LEVEL_PUBLIC_ACCESS_PROHIBITED,
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Config::ConfigRule', {
            Source: {
                Owner: 'AWS',
                SourceIdentifier: config.ManagedRuleIdentifiers.S3_BUCKET_LEVEL_PUBLIC_ACCESS_PROHIBITED,
            },
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFuYWdlZC1ydWxlcy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFuYWdlZC1ydWxlcy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaURBQTRDO0FBQzVDLHFDQUFxQztBQUNyQyxrQ0FBa0M7QUFDbEMsaUNBQWlDO0FBRWpDLFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO0lBQzNCLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO1FBQ25CLFFBQVE7UUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUU5QixPQUFPO1FBQ1AsSUFBSSxNQUFNLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBRWxELE9BQU87UUFDUCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyx5QkFBeUIsRUFBRTtZQUN6RSxNQUFNLEVBQUU7Z0JBQ04sS0FBSyxFQUFFLEtBQUs7Z0JBQ1osZ0JBQWdCLEVBQUUscUJBQXFCO2FBQ3hDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLFFBQVE7UUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUU5QixPQUFPO1FBQ1AsSUFBSSxNQUFNLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLFlBQVksRUFBRTtZQUNoRCxNQUFNLEVBQUUsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQzdCLENBQUMsQ0FBQztRQUVILE9BQU87UUFDUCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyx5QkFBeUIsRUFBRTtZQUN6RSxNQUFNLEVBQUU7Z0JBQ04sS0FBSyxFQUFFLEtBQUs7Z0JB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SUFDL0IsSUFBSSxDQUFDLDBCQUEwQixFQUFFLEdBQUcsRUFBRTtRQUNwQyxRQUFRO1FBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFOUIsT0FBTztRQUNQLElBQUksTUFBTSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUscUNBQXFDLEVBQUU7WUFDbkUsVUFBVSxFQUFFLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyx3Q0FBd0M7U0FDbkYsQ0FBQyxDQUFDO1FBRUgsT0FBTztRQUNQLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHlCQUF5QixFQUFFO1lBQ3pFLE1BQU0sRUFBRTtnQkFDTixLQUFLLEVBQUUsS0FBSztnQkFDWixnQkFBZ0IsRUFBRSxNQUFNLENBQUMsc0JBQXNCLENBQUMsd0NBQXdDO2FBQ3pGO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgKiBhcyBzbnMgZnJvbSAnLi4vLi4vYXdzLXNucyc7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgKiBhcyBjb25maWcgZnJvbSAnLi4vbGliJztcblxuZGVzY3JpYmUoJ2FjY2VzcyBrZXlzJywgKCkgPT4ge1xuICB0ZXN0KCdyb3RhdGVkJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IGNvbmZpZy5BY2Nlc3NLZXlzUm90YXRlZChzdGFjaywgJ0FjY2Vzc0tleXMnKTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb25maWc6OkNvbmZpZ1J1bGUnLCB7XG4gICAgICBTb3VyY2U6IHtcbiAgICAgICAgT3duZXI6ICdBV1MnLFxuICAgICAgICBTb3VyY2VJZGVudGlmaWVyOiAnQUNDRVNTX0tFWVNfUk9UQVRFRCcsXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdyb3RhdGVkIHdpdGggbWF4IGFnZScsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBjb25maWcuQWNjZXNzS2V5c1JvdGF0ZWQoc3RhY2ssICdBY2Nlc3NLZXlzJywge1xuICAgICAgbWF4QWdlOiBjZGsuRHVyYXRpb24uZGF5cygxKSxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb25maWc6OkNvbmZpZ1J1bGUnLCB7XG4gICAgICBTb3VyY2U6IHtcbiAgICAgICAgT3duZXI6ICdBV1MnLFxuICAgICAgICBTb3VyY2VJZGVudGlmaWVyOiAnQUNDRVNTX0tFWVNfUk9UQVRFRCcsXG4gICAgICB9LFxuICAgICAgSW5wdXRQYXJhbWV0ZXJzOiB7XG4gICAgICAgIG1heEFjY2Vzc0tleUFnZTogMSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdjbG91ZGZvcm1hdGlvbiBzdGFjaycsICgpID0+IHtcbiAgdGVzdCgnZHJpZnQgZGV0ZWN0aW9uIGNoZWNrJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IGNvbmZpZy5DbG91ZEZvcm1hdGlvblN0YWNrRHJpZnREZXRlY3Rpb25DaGVjayhzdGFjaywgJ0RyaWZ0Jyk7XG5cbiAgICAvLyBUSEVOXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q29uZmlnOjpDb25maWdSdWxlJywge1xuICAgICAgU291cmNlOiB7XG4gICAgICAgIE93bmVyOiAnQVdTJyxcbiAgICAgICAgU291cmNlSWRlbnRpZmllcjogJ0NMT1VERk9STUFUSU9OX1NUQUNLX0RSSUZUX0RFVEVDVElPTl9DSEVDSycsXG4gICAgICB9LFxuICAgICAgSW5wdXRQYXJhbWV0ZXJzOiB7XG4gICAgICAgIGNsb3VkZm9ybWF0aW9uUm9sZUFybjoge1xuICAgICAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAgICAgJ0RyaWZ0Um9sZThBNUZCODMzJyxcbiAgICAgICAgICAgICdBcm4nLFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgU2NvcGU6IHtcbiAgICAgICAgQ29tcGxpYW5jZVJlc291cmNlVHlwZXM6IFtcbiAgICAgICAgICAnQVdTOjpDbG91ZEZvcm1hdGlvbjo6U3RhY2snLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6Um9sZScsIHtcbiAgICAgIEFzc3VtZVJvbGVQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICBTdGF0ZW1lbnQ6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBBY3Rpb246ICdzdHM6QXNzdW1lUm9sZScsXG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICBQcmluY2lwYWw6IHtcbiAgICAgICAgICAgICAgU2VydmljZTogJ2NvbmZpZy5hbWF6b25hd3MuY29tJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgVmVyc2lvbjogJzIwMTItMTAtMTcnLFxuICAgICAgfSxcbiAgICAgIE1hbmFnZWRQb2xpY3lBcm5zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAnRm46OkpvaW4nOiBbXG4gICAgICAgICAgICAnJyxcbiAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgUmVmOiAnQVdTOjpQYXJ0aXRpb24nLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAnOmlhbTo6YXdzOnBvbGljeS9SZWFkT25seUFjY2VzcycsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdub3RpZmljYXRpb24gY2hlY2snLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgICBjb25zdCB0b3BpYzEgPSBuZXcgc25zLlRvcGljKHN0YWNrLCAnQWxsb3dlZFRvcGljMScpO1xuICAgIGNvbnN0IHRvcGljMiA9IG5ldyBzbnMuVG9waWMoc3RhY2ssICdBbGxvd2VkVG9waWMyJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IGNvbmZpZy5DbG91ZEZvcm1hdGlvblN0YWNrTm90aWZpY2F0aW9uQ2hlY2soc3RhY2ssICdOb3RpZmljYXRpb24nLCB7XG4gICAgICB0b3BpY3M6IFt0b3BpYzEsIHRvcGljMl0sXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q29uZmlnOjpDb25maWdSdWxlJywge1xuICAgICAgU291cmNlOiB7XG4gICAgICAgIE93bmVyOiAnQVdTJyxcbiAgICAgICAgU291cmNlSWRlbnRpZmllcjogJ0NMT1VERk9STUFUSU9OX1NUQUNLX05PVElGSUNBVElPTl9DSEVDSycsXG4gICAgICB9LFxuICAgICAgSW5wdXRQYXJhbWV0ZXJzOiB7XG4gICAgICAgIHNuc1RvcGljMToge1xuICAgICAgICAgIFJlZjogJ0FsbG93ZWRUb3BpYzEwQzkxNDRGOScsXG4gICAgICAgIH0sXG4gICAgICAgIHNuc1RvcGljMjoge1xuICAgICAgICAgIFJlZjogJ0FsbG93ZWRUb3BpYzI0RUNGNkMwRCcsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgU2NvcGU6IHtcbiAgICAgICAgQ29tcGxpYW5jZVJlc291cmNlVHlwZXM6IFtcbiAgICAgICAgICAnQVdTOjpDbG91ZEZvcm1hdGlvbjo6U3RhY2snLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnbm90aWZpY2F0aW9uIGNoZWNrIHRocm93cyB3aXRoIG1vcmUgdGhhbiA1IHRvcGljcycsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgIGNvbnN0IHRvcGljID0gbmV3IHNucy5Ub3BpYyhzdGFjaywgJ0FsbG93ZWRUb3BpYzEnKTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoKCkgPT4gbmV3IGNvbmZpZy5DbG91ZEZvcm1hdGlvblN0YWNrTm90aWZpY2F0aW9uQ2hlY2soc3RhY2ssICdOb3RpZmljYXRpb24nLCB7XG4gICAgICB0b3BpY3M6IFt0b3BpYywgdG9waWMsIHRvcGljLCB0b3BpYywgdG9waWMsIHRvcGljXSxcbiAgICB9KSkudG9UaHJvdygvNSB0b3BpY3MvKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ2VjMiBpbnN0YW5jZScsICgpID0+IHtcbiAgdGVzdCgncHJvZmlsZSBhdHRhY2hlZCBjaGVjaycsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBjb25maWcuTWFuYWdlZFJ1bGUoc3RhY2ssICdFYzJJbnN0YW5jZVByb2ZpbGVBdHRhY2hlZCcsIHtcbiAgICAgIGlkZW50aWZpZXI6IGNvbmZpZy5NYW5hZ2VkUnVsZUlkZW50aWZpZXJzLkVDMl9JTlNUQU5DRV9QUk9GSUxFX0FUVEFDSEVELFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNvbmZpZzo6Q29uZmlnUnVsZScsIHtcbiAgICAgIFNvdXJjZToge1xuICAgICAgICBPd25lcjogJ0FXUycsXG4gICAgICAgIFNvdXJjZUlkZW50aWZpZXI6IGNvbmZpZy5NYW5hZ2VkUnVsZUlkZW50aWZpZXJzLkVDMl9JTlNUQU5DRV9QUk9GSUxFX0FUVEFDSEVELFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3MzIGJ1Y2tldCBsZXZlbCcsICgpID0+IHtcbiAgdGVzdCgncHVibGljIGFjY2VzcyBwcm9oaWJpdGVkJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IGNvbmZpZy5NYW5hZ2VkUnVsZShzdGFjaywgJ1MzQnVja2V0TGV2ZWxQdWJsaWNBY2Nlc3NQcm9oaWJpdGVkJywge1xuICAgICAgaWRlbnRpZmllcjogY29uZmlnLk1hbmFnZWRSdWxlSWRlbnRpZmllcnMuUzNfQlVDS0VUX0xFVkVMX1BVQkxJQ19BQ0NFU1NfUFJPSElCSVRFRCxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb25maWc6OkNvbmZpZ1J1bGUnLCB7XG4gICAgICBTb3VyY2U6IHtcbiAgICAgICAgT3duZXI6ICdBV1MnLFxuICAgICAgICBTb3VyY2VJZGVudGlmaWVyOiBjb25maWcuTWFuYWdlZFJ1bGVJZGVudGlmaWVycy5TM19CVUNLRVRfTEVWRUxfUFVCTElDX0FDQ0VTU19QUk9ISUJJVEVELFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==