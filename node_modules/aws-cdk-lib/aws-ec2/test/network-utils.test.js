"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const network_util_1 = require("../lib/network-util");
describe('network utils', () => {
    describe('IP', () => {
        test('should convert a valid IP Address to an integer', () => {
            expect(network_util_1.NetworkUtils.ipToNum('174.66.173.168')).toEqual(2923605416);
        });
        test('should throw on invalid IP Address', () => {
            expect(() => {
                network_util_1.NetworkUtils.ipToNum('174.266.173.168');
            }).toThrow('is not valid');
        });
        test('should convert a valid IP integer to a staring', () => {
            expect(network_util_1.NetworkUtils.numToIp(2923605416)).toEqual('174.66.173.168');
        });
        test('should throw an error for invalid IP', () => {
            expect(() => {
                network_util_1.NetworkUtils.numToIp(2923605416 * 5);
            }).toThrow(/is not a valid/);
            expect(() => {
                network_util_1.NetworkUtils.numToIp(-1);
            }).toThrow(/is not a valid/);
        });
        test('validIp returns true if octect is in 0-255', () => {
            const invalidIps = ['255.255.0.0', '0.0.0.0', '1.2.3.4', '10.0.0.0', '255.01.01.255'];
            for (const ip of invalidIps) {
                expect(true).toEqual(network_util_1.NetworkUtils.validIp(ip));
            }
        });
        test('validIp returns false if octect is not in 0-255', () => {
            const invalidIps = ['1.2.3.4.689', '-1.55.22.22', '', ' ', '255.264.1.01'];
            for (const ip of invalidIps) {
                expect(false).toEqual(network_util_1.NetworkUtils.validIp(ip));
            }
        });
    });
    describe('CidrBlock', () => {
        test('should return the next valid subnet from offset IP', () => {
            const num = network_util_1.NetworkUtils.ipToNum('10.0.1.255');
            const newBlock = new network_util_1.CidrBlock(num, 24);
            expect(newBlock.cidr).toEqual('10.0.2.0/24');
        });
        test('nextBlock() returns the next higher CIDR space', () => {
            const testValues = [
                ['192.168.0.0/24', '192.168.1.0/24'],
                ['10.85.7.0/28', '10.85.7.16/28'],
            ];
            for (const value of testValues) {
                const block = new network_util_1.CidrBlock(value[0]);
                expect(block.nextBlock().cidr).toEqual(value[1]);
            }
        });
        test('maxIp() should return the last usable IP from the CidrBlock', () => {
            const testValues = [
                ['10.0.3.0/28', '10.0.3.15'],
                ['10.0.3.1/28', '10.0.3.31'],
                ['10.0.2.254/28', '10.0.3.15'],
            ];
            for (const value of testValues) {
                const block = new network_util_1.CidrBlock(value[0]);
                expect(block.maxIp()).toEqual(value[1]);
            }
        });
        test('minIp() should return the first usable IP from the CidrBlock', () => {
            const testValues = [
                ['192.168.0.0/18', '192.168.0.0'],
                ['10.0.3.0/24', '10.0.3.0'],
            ];
            for (const answer of testValues) {
                const block = new network_util_1.CidrBlock(answer[0]);
                expect(block.minIp()).toEqual(answer[1]);
            }
        });
        test('containsCidr returns true if fully contained', () => {
            const block = new network_util_1.CidrBlock('10.0.3.0/24');
            const contained = new network_util_1.CidrBlock('10.0.3.0/26');
            expect(block.containsCidr(contained)).toEqual(true);
        });
        test('containsCidr returns false if not fully contained', () => {
            const block = new network_util_1.CidrBlock('10.0.3.0/26');
            const notContained = new network_util_1.CidrBlock('10.0.3.0/25');
            expect(block.containsCidr(notContained)).toEqual(false);
        });
        test('calculateNetmask returns the ip string mask', () => {
            const netmask = network_util_1.CidrBlock.calculateNetmask(27);
            expect(netmask).toEqual('255.255.255.224');
        });
    });
    describe('NetworkBuilder', () => {
        test('allows you to carve subnets our of CIDR network', () => {
            const answers = [
                [
                    '192.168.0.0/28',
                    '192.168.0.16/28',
                    '192.168.0.32/28',
                    '192.168.0.128/25',
                    '192.168.1.0/25',
                    '192.168.4.0/22',
                ],
                [
                    '192.168.0.0/24',
                    '192.168.1.0/24',
                    '192.168.2.0/24',
                    '192.168.3.0/25',
                    '192.168.3.128/25',
                    '192.168.4.0/25',
                    '192.168.4.128/28',
                    '192.168.4.144/28',
                    '192.168.4.160/28',
                ],
            ];
            const wasteful = new network_util_1.NetworkBuilder('192.168.0.0/18');
            const efficient = new network_util_1.NetworkBuilder('192.168.0.0/18');
            wasteful.addSubnets(28, 3);
            wasteful.addSubnets(25, 2);
            wasteful.addSubnets(22, 1);
            efficient.addSubnets(24, 3);
            efficient.addSubnets(25, 3);
            efficient.addSubnets(28, 3);
            const expected = [
                wasteful.cidrStrings.sort(),
                efficient.cidrStrings.sort(),
            ];
            for (let i = 0; i < answers.length; i++) {
                expect(answers[i].sort()).toEqual(expected[i]);
            }
        });
        test('throws on subnets < 16 or > 28', () => {
            const builder = new network_util_1.NetworkBuilder('192.168.0.0/18');
            expect(() => {
                builder.addSubnet(15);
            }).toThrow(network_util_1.InvalidCidrRangeError);
            expect(() => {
                builder.addSubnet(29);
            }).toThrow(network_util_1.InvalidCidrRangeError);
        });
        test('throws if you add a subnet outside of the cidr', () => {
            const builder = new network_util_1.NetworkBuilder('192.168.0.0/18');
            const builder2 = new network_util_1.NetworkBuilder('10.0.0.0/21');
            builder.addSubnets(19, 1);
            builder2.addSubnets(24, 8);
            expect(() => {
                builder.addSubnet(19);
                builder.addSubnet(28);
            }).toThrow(/exceeds remaining space/);
            expect(() => {
                builder2.addSubnet(28);
            }).toThrow(/exceeds remaining space/);
        });
        test('maskForRemainingSubnets calcs mask for even split of remaining', () => {
            const builder = new network_util_1.NetworkBuilder('10.0.0.0/24');
            builder.addSubnet(25);
            expect(27).toEqual(builder.maskForRemainingSubnets(3));
            const builder2 = new network_util_1.NetworkBuilder('192.168.176.0/20');
            builder2.addSubnets(22, 2);
            expect(22).toEqual(builder2.maskForRemainingSubnets(2));
            const builder3 = new network_util_1.NetworkBuilder('192.168.0.0/16');
            expect(17).toEqual(builder3.maskForRemainingSubnets(2));
            const builder4 = new network_util_1.NetworkBuilder('10.0.0.0/16');
            expect(18).toEqual(builder4.maskForRemainingSubnets(4));
            const builder5 = new network_util_1.NetworkBuilder('10.0.0.0/16');
            builder5.addSubnets(26, 3);
            builder5.addSubnets(27, 3);
            expect(18).toEqual(builder5.maskForRemainingSubnets(3));
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmV0d29yay11dGlscy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibmV0d29yay11dGlscy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0RBSzZCO0FBRTdCLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFO1FBQ2xCLElBQUksQ0FBQyxpREFBaUQsRUFBRSxHQUFHLEVBQUU7WUFDM0QsTUFBTSxDQUFDLDJCQUFZLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFckUsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO1lBQzlDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7Z0JBQ1YsMkJBQVksQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUMxQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFN0IsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsZ0RBQWdELEVBQUUsR0FBRyxFQUFFO1lBQzFELE1BQU0sQ0FBQywyQkFBWSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBRXJFLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLHNDQUFzQyxFQUFFLEdBQUcsRUFBRTtZQUNoRCxNQUFNLENBQUMsR0FBRyxFQUFFO2dCQUNWLDJCQUFZLENBQUMsT0FBTyxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN2QyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUM3QixNQUFNLENBQUMsR0FBRyxFQUFFO2dCQUNWLDJCQUFZLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7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QVEsQ0FBQyxVQUFVLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzNCLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLHVCQUF1QixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2lkckJsb2NrLFxuICBJbnZhbGlkQ2lkclJhbmdlRXJyb3IsXG4gIE5ldHdvcmtCdWlsZGVyLFxuICBOZXR3b3JrVXRpbHMsXG59IGZyb20gJy4uL2xpYi9uZXR3b3JrLXV0aWwnO1xuXG5kZXNjcmliZSgnbmV0d29yayB1dGlscycsICgpID0+IHtcbiAgZGVzY3JpYmUoJ0lQJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBjb252ZXJ0IGEgdmFsaWQgSVAgQWRkcmVzcyB0byBhbiBpbnRlZ2VyJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KE5ldHdvcmtVdGlscy5pcFRvTnVtKCcxNzQuNjYuMTczLjE2OCcpKS50b0VxdWFsKDI5MjM2MDU0MTYpO1xuXG4gICAgfSk7XG4gICAgdGVzdCgnc2hvdWxkIHRocm93IG9uIGludmFsaWQgSVAgQWRkcmVzcycsICgpID0+IHtcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIE5ldHdvcmtVdGlscy5pcFRvTnVtKCcxNzQuMjY2LjE3My4xNjgnKTtcbiAgICAgIH0pLnRvVGhyb3coJ2lzIG5vdCB2YWxpZCcpO1xuXG4gICAgfSk7XG4gICAgdGVzdCgnc2hvdWxkIGNvbnZlcnQgYSB2YWxpZCBJUCBpbnRlZ2VyIHRvIGEgc3RhcmluZycsICgpID0+IHtcbiAgICAgIGV4cGVjdChOZXR3b3JrVXRpbHMubnVtVG9JcCgyOTIzNjA1NDE2KSkudG9FcXVhbCgnMTc0LjY2LjE3My4xNjgnKTtcblxuICAgIH0pO1xuICAgIHRlc3QoJ3Nob3VsZCB0aHJvdyBhbiBlcnJvciBmb3IgaW52YWxpZCBJUCcsICgpID0+IHtcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIE5ldHdvcmtVdGlscy5udW1Ub0lwKDI5MjM2MDU0MTYgKiA1KTtcbiAgICAgIH0pLnRvVGhyb3coL2lzIG5vdCBhIHZhbGlkLyk7XG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBOZXR3b3JrVXRpbHMubnVtVG9JcCgtMSk7XG4gICAgICB9KS50b1Rocm93KC9pcyBub3QgYSB2YWxpZC8pO1xuXG4gICAgfSk7XG4gICAgdGVzdCgndmFsaWRJcCByZXR1cm5zIHRydWUgaWYgb2N0ZWN0IGlzIGluIDAtMjU1JywgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZElwcyA9IFsnMjU1LjI1NS4wLjAnLCAnMC4wLjAuMCcsICcxLjIuMy40JywgJzEwLjAuMC4wJywgJzI1NS4wMS4wMS4yNTUnXTtcbiAgICAgIGZvciAoY29uc3QgaXAgb2YgaW52YWxpZElwcykge1xuICAgICAgICBleHBlY3QodHJ1ZSkudG9FcXVhbChOZXR3b3JrVXRpbHMudmFsaWRJcChpcCkpO1xuICAgICAgfVxuXG4gICAgfSk7XG4gICAgdGVzdCgndmFsaWRJcCByZXR1cm5zIGZhbHNlIGlmIG9jdGVjdCBpcyBub3QgaW4gMC0yNTUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkSXBzID0gWycxLjIuMy40LjY4OScsICctMS41NS4yMi4yMicsICcnLCAnICcsICcyNTUuMjY0LjEuMDEnXTtcbiAgICAgIGZvciAoY29uc3QgaXAgb2YgaW52YWxpZElwcykge1xuICAgICAgICBleHBlY3QoZmFsc2UpLnRvRXF1YWwoTmV0d29ya1V0aWxzLnZhbGlkSXAoaXApKTtcbiAgICAgIH1cblxuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ0NpZHJCbG9jaycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIHRoZSBuZXh0IHZhbGlkIHN1Ym5ldCBmcm9tIG9mZnNldCBJUCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG51bSA9IE5ldHdvcmtVdGlscy5pcFRvTnVtKCcxMC4wLjEuMjU1Jyk7XG4gICAgICBjb25zdCBuZXdCbG9jayA9IG5ldyBDaWRyQmxvY2sobnVtLCAyNCk7XG4gICAgICBleHBlY3QobmV3QmxvY2suY2lkcikudG9FcXVhbCgnMTAuMC4yLjAvMjQnKTtcblxuICAgIH0pO1xuICAgIHRlc3QoJ25leHRCbG9jaygpIHJldHVybnMgdGhlIG5leHQgaGlnaGVyIENJRFIgc3BhY2UnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VmFsdWVzID0gW1xuICAgICAgICBbJzE5Mi4xNjguMC4wLzI0JywgJzE5Mi4xNjguMS4wLzI0J10sXG4gICAgICAgIFsnMTAuODUuNy4wLzI4JywgJzEwLjg1LjcuMTYvMjgnXSxcbiAgICAgIF07XG4gICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHRlc3RWYWx1ZXMpIHtcbiAgICAgICAgY29uc3QgYmxvY2sgPSBuZXcgQ2lkckJsb2NrKHZhbHVlWzBdKTtcbiAgICAgICAgZXhwZWN0KGJsb2NrLm5leHRCbG9jaygpLmNpZHIpLnRvRXF1YWwodmFsdWVbMV0pO1xuICAgICAgfVxuXG4gICAgfSk7XG4gICAgdGVzdCgnbWF4SXAoKSBzaG91bGQgcmV0dXJuIHRoZSBsYXN0IHVzYWJsZSBJUCBmcm9tIHRoZSBDaWRyQmxvY2snLCAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0VmFsdWVzID0gW1xuICAgICAgICBbJzEwLjAuMy4wLzI4JywgJzEwLjAuMy4xNSddLFxuICAgICAgICBbJzEwLjAuMy4xLzI4JywgJzEwLjAuMy4zMSddLFxuICAgICAgICBbJzEwLjAuMi4yNTQvMjgnLCAnMTAuMC4zLjE1J10sXG4gICAgICBdO1xuICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiB0ZXN0VmFsdWVzKSB7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gbmV3IENpZHJCbG9jayh2YWx1ZVswXSk7XG4gICAgICAgIGV4cGVjdChibG9jay5tYXhJcCgpKS50b0VxdWFsKHZhbHVlWzFdKTtcbiAgICAgIH1cblxuICAgIH0pO1xuICAgIHRlc3QoJ21pbklwKCkgc2hvdWxkIHJldHVybiB0aGUgZmlyc3QgdXNhYmxlIElQIGZyb20gdGhlIENpZHJCbG9jaycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RWYWx1ZXMgPSBbXG4gICAgICAgIFsnMTkyLjE2OC4wLjAvMTgnLCAnMTkyLjE2OC4wLjAnXSxcbiAgICAgICAgWycxMC4wLjMuMC8yNCcsICcxMC4wLjMuMCddLFxuICAgICAgXTtcbiAgICAgIGZvciAoY29uc3QgYW5zd2VyIG9mIHRlc3RWYWx1ZXMpIHtcbiAgICAgICAgY29uc3QgYmxvY2sgPSBuZXcgQ2lkckJsb2NrKGFuc3dlclswXSk7XG4gICAgICAgIGV4cGVjdChibG9jay5taW5JcCgpKS50b0VxdWFsKGFuc3dlclsxXSk7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgICB0ZXN0KCdjb250YWluc0NpZHIgcmV0dXJucyB0cnVlIGlmIGZ1bGx5IGNvbnRhaW5lZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGJsb2NrID0gbmV3IENpZHJCbG9jaygnMTAuMC4zLjAvMjQnKTtcbiAgICAgIGNvbnN0IGNvbnRhaW5lZCA9IG5ldyBDaWRyQmxvY2soJzEwLjAuMy4wLzI2Jyk7XG4gICAgICBleHBlY3QoYmxvY2suY29udGFpbnNDaWRyKGNvbnRhaW5lZCkpLnRvRXF1YWwodHJ1ZSk7XG5cbiAgICB9KTtcbiAgICB0ZXN0KCdjb250YWluc0NpZHIgcmV0dXJucyBmYWxzZSBpZiBub3QgZnVsbHkgY29udGFpbmVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgYmxvY2sgPSBuZXcgQ2lkckJsb2NrKCcxMC4wLjMuMC8yNicpO1xuICAgICAgY29uc3Qgbm90Q29udGFpbmVkID0gbmV3IENpZHJCbG9jaygnMTAuMC4zLjAvMjUnKTtcbiAgICAgIGV4cGVjdChibG9jay5jb250YWluc0NpZHIobm90Q29udGFpbmVkKSkudG9FcXVhbChmYWxzZSk7XG5cbiAgICB9KTtcbiAgICB0ZXN0KCdjYWxjdWxhdGVOZXRtYXNrIHJldHVybnMgdGhlIGlwIHN0cmluZyBtYXNrJywgKCkgPT4ge1xuICAgICAgY29uc3QgbmV0bWFzayA9IENpZHJCbG9jay5jYWxjdWxhdGVOZXRtYXNrKDI3KTtcbiAgICAgIGV4cGVjdChuZXRtYXNrKS50b0VxdWFsKCcyNTUuMjU1LjI1NS4yMjQnKTtcblxuICAgIH0pO1xuXG4gIH0pO1xuICBkZXNjcmliZSgnTmV0d29ya0J1aWxkZXInLCAoKSA9PiB7XG4gICAgdGVzdCgnYWxsb3dzIHlvdSB0byBjYXJ2ZSBzdWJuZXRzIG91ciBvZiBDSURSIG5ldHdvcmsnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhbnN3ZXJzID0gW1xuICAgICAgICBbXG4gICAgICAgICAgJzE5Mi4xNjguMC4wLzI4JyxcbiAgICAgICAgICAnMTkyLjE2OC4wLjE2LzI4JyxcbiAgICAgICAgICAnMTkyLjE2OC4wLjMyLzI4JyxcbiAgICAgICAgICAnMTkyLjE2OC4wLjEyOC8yNScsXG4gICAgICAgICAgJzE5Mi4xNjguMS4wLzI1JyxcbiAgICAgICAgICAnMTkyLjE2OC40LjAvMjInLFxuICAgICAgICBdLFxuICAgICAgICBbXG4gICAgICAgICAgJzE5Mi4xNjguMC4wLzI0JyxcbiAgICAgICAgICAnMTkyLjE2OC4xLjAvMjQnLFxuICAgICAgICAgICcxOTIuMTY4LjIuMC8yNCcsXG4gICAgICAgICAgJzE5Mi4xNjguMy4wLzI1JyxcbiAgICAgICAgICAnMTkyLjE2OC4zLjEyOC8yNScsXG4gICAgICAgICAgJzE5Mi4xNjguNC4wLzI1JyxcbiAgICAgICAgICAnMTkyLjE2OC40LjEyOC8yOCcsXG4gICAgICAgICAgJzE5Mi4xNjguNC4xNDQvMjgnLFxuICAgICAgICAgICcxOTIuMTY4LjQuMTYwLzI4JyxcbiAgICAgICAgXSxcbiAgICAgIF07XG4gICAgICBjb25zdCB3YXN0ZWZ1bCA9IG5ldyBOZXR3b3JrQnVpbGRlcignMTkyLjE2OC4wLjAvMTgnKTtcbiAgICAgIGNvbnN0IGVmZmljaWVudCA9IG5ldyBOZXR3b3JrQnVpbGRlcignMTkyLjE2OC4wLjAvMTgnKTtcbiAgICAgIHdhc3RlZnVsLmFkZFN1Ym5ldHMoMjgsIDMpO1xuICAgICAgd2FzdGVmdWwuYWRkU3VibmV0cygyNSwgMik7XG4gICAgICB3YXN0ZWZ1bC5hZGRTdWJuZXRzKDIyLCAxKTtcbiAgICAgIGVmZmljaWVudC5hZGRTdWJuZXRzKDI0LCAzKTtcbiAgICAgIGVmZmljaWVudC5hZGRTdWJuZXRzKDI1LCAzKTtcbiAgICAgIGVmZmljaWVudC5hZGRTdWJuZXRzKDI4LCAzKTtcbiAgICAgIGNvbnN0IGV4cGVjdGVkID0gW1xuICAgICAgICB3YXN0ZWZ1bC5jaWRyU3RyaW5ncy5zb3J0KCksXG4gICAgICAgIGVmZmljaWVudC5jaWRyU3RyaW5ncy5zb3J0KCksXG4gICAgICBdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhbnN3ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGV4cGVjdChhbnN3ZXJzW2ldLnNvcnQoKSkudG9FcXVhbChleHBlY3RlZFtpXSk7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgICB0ZXN0KCd0aHJvd3Mgb24gc3VibmV0cyA8IDE2IG9yID4gMjgnLCAoKSA9PiB7XG4gICAgICBjb25zdCBidWlsZGVyID0gbmV3IE5ldHdvcmtCdWlsZGVyKCcxOTIuMTY4LjAuMC8xOCcpO1xuICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgYnVpbGRlci5hZGRTdWJuZXQoMTUpO1xuICAgICAgfSkudG9UaHJvdyhJbnZhbGlkQ2lkclJhbmdlRXJyb3IpO1xuICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgYnVpbGRlci5hZGRTdWJuZXQoMjkpO1xuICAgICAgfSkudG9UaHJvdyhJbnZhbGlkQ2lkclJhbmdlRXJyb3IpO1xuXG4gICAgfSk7XG4gICAgdGVzdCgndGhyb3dzIGlmIHlvdSBhZGQgYSBzdWJuZXQgb3V0c2lkZSBvZiB0aGUgY2lkcicsICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1aWxkZXIgPSBuZXcgTmV0d29ya0J1aWxkZXIoJzE5Mi4xNjguMC4wLzE4Jyk7XG4gICAgICBjb25zdCBidWlsZGVyMiA9IG5ldyBOZXR3b3JrQnVpbGRlcignMTAuMC4wLjAvMjEnKTtcbiAgICAgIGJ1aWxkZXIuYWRkU3VibmV0cygxOSwgMSk7XG4gICAgICBidWlsZGVyMi5hZGRTdWJuZXRzKDI0LCA4KTtcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIGJ1aWxkZXIuYWRkU3VibmV0KDE5KTtcbiAgICAgICAgYnVpbGRlci5hZGRTdWJuZXQoMjgpO1xuICAgICAgfSkudG9UaHJvdygvZXhjZWVkcyByZW1haW5pbmcgc3BhY2UvKTtcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIGJ1aWxkZXIyLmFkZFN1Ym5ldCgyOCk7XG4gICAgICB9KS50b1Rocm93KC9leGNlZWRzIHJlbWFpbmluZyBzcGFjZS8pO1xuXG4gICAgfSk7XG4gICAgdGVzdCgnbWFza0ZvclJlbWFpbmluZ1N1Ym5ldHMgY2FsY3MgbWFzayBmb3IgZXZlbiBzcGxpdCBvZiByZW1haW5pbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBidWlsZGVyID0gbmV3IE5ldHdvcmtCdWlsZGVyKCcxMC4wLjAuMC8yNCcpO1xuICAgICAgYnVpbGRlci5hZGRTdWJuZXQoMjUpO1xuICAgICAgZXhwZWN0KDI3KS50b0VxdWFsKGJ1aWxkZXIubWFza0ZvclJlbWFpbmluZ1N1Ym5ldHMoMykpO1xuICAgICAgY29uc3QgYnVpbGRlcjIgPSBuZXcgTmV0d29ya0J1aWxkZXIoJzE5Mi4xNjguMTc2LjAvMjAnKTtcbiAgICAgIGJ1aWxkZXIyLmFkZFN1Ym5ldHMoMjIsIDIpO1xuICAgICAgZXhwZWN0KDIyKS50b0VxdWFsKGJ1aWxkZXIyLm1hc2tGb3JSZW1haW5pbmdTdWJuZXRzKDIpKTtcbiAgICAgIGNvbnN0IGJ1aWxkZXIzID0gbmV3IE5ldHdvcmtCdWlsZGVyKCcxOTIuMTY4LjAuMC8xNicpO1xuICAgICAgZXhwZWN0KDE3KS50b0VxdWFsKGJ1aWxkZXIzLm1hc2tGb3JSZW1haW5pbmdTdWJuZXRzKDIpKTtcbiAgICAgIGNvbnN0IGJ1aWxkZXI0ID0gbmV3IE5ldHdvcmtCdWlsZGVyKCcxMC4wLjAuMC8xNicpO1xuICAgICAgZXhwZWN0KDE4KS50b0VxdWFsKGJ1aWxkZXI0Lm1hc2tGb3JSZW1haW5pbmdTdWJuZXRzKDQpKTtcbiAgICAgIGNvbnN0IGJ1aWxkZXI1ID0gbmV3IE5ldHdvcmtCdWlsZGVyKCcxMC4wLjAuMC8xNicpO1xuICAgICAgYnVpbGRlcjUuYWRkU3VibmV0cygyNiwgMyk7XG4gICAgICBidWlsZGVyNS5hZGRTdWJuZXRzKDI3LCAzKTtcbiAgICAgIGV4cGVjdCgxOCkudG9FcXVhbChidWlsZGVyNS5tYXNrRm9yUmVtYWluaW5nU3VibmV0cygzKSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=