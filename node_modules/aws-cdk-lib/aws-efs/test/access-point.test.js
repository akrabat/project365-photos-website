"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const ec2 = require("../../aws-ec2");
const core_1 = require("../../core");
const lib_1 = require("../lib");
let stack;
let vpc;
let fileSystem;
beforeEach(() => {
    stack = new core_1.Stack();
    vpc = new ec2.Vpc(stack, 'VPC');
    fileSystem = new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
    });
});
test('addAccessPoint correctly', () => {
    // WHEN
    fileSystem.addAccessPoint('MyAccessPoint');
    // THEN
    assertions_1.Template.fromStack(stack).resourceCountIs('AWS::EFS::AccessPoint', 1);
});
test('new AccessPoint correctly', () => {
    // WHEN
    new lib_1.AccessPoint(stack, 'MyAccessPoint', {
        fileSystem,
    });
    // THEN
    assertions_1.Template.fromStack(stack).resourceCountIs('AWS::EFS::AccessPoint', 1);
});
test('support tags for AccessPoint', () => {
    // WHEN
    const accessPoint = new lib_1.AccessPoint(stack, 'MyAccessPoint', {
        fileSystem,
    });
    core_1.Tags.of(accessPoint).add('key1', 'value1');
    core_1.Tags.of(accessPoint).add('key2', 'value2');
    core_1.Tags.of(accessPoint).add('Name', 'MyAccessPointName');
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::EFS::AccessPoint', {
        AccessPointTags: [
            { Key: 'key1', Value: 'value1' },
            { Key: 'key2', Value: 'value2' },
            { Key: 'Name', Value: 'MyAccessPointName' },
        ],
    });
});
test('import an AccessPoint using fromAccessPointId', () => {
    // WHEN
    const ap = new lib_1.AccessPoint(stack, 'MyAccessPoint', {
        fileSystem,
    });
    const imported = lib_1.AccessPoint.fromAccessPointId(stack, 'ImportedAccessPoint', ap.accessPointId);
    // THEN
    expect(imported.accessPointId).toEqual(ap.accessPointId);
});
test('import an AccessPoint using fromAccessPointId throws when accessing fileSystem', () => {
    // WHEN
    const ap = new lib_1.AccessPoint(stack, 'MyAccessPoint', {
        fileSystem,
    });
    const imported = lib_1.AccessPoint.fromAccessPointId(stack, 'ImportedAccessPoint', ap.accessPointId);
    // THEN
    expect(() => imported.fileSystem).toThrow(/fileSystem is only available if 'fromAccessPointAttributes\(\)' is used and a fileSystem is passed in as an attribute./);
});
test('import an AccessPoint using fromAccessPointAttributes and the accessPointId', () => {
    // WHEN
    const ap = new lib_1.AccessPoint(stack, 'MyAccessPoint', {
        fileSystem,
    });
    const imported = lib_1.AccessPoint.fromAccessPointAttributes(stack, 'ImportedAccessPoint', {
        accessPointId: ap.accessPointId,
        fileSystem: fileSystem,
    });
    // THEN
    expect(imported.accessPointId).toEqual(ap.accessPointId);
    expect(imported.accessPointArn).toEqual(ap.accessPointArn);
    expect(imported.fileSystem).toEqual(ap.fileSystem);
});
test('import an AccessPoint using fromAccessPointAttributes and the accessPointArn', () => {
    // WHEN
    const ap = new lib_1.AccessPoint(stack, 'MyAccessPoint', {
        fileSystem,
    });
    const imported = lib_1.AccessPoint.fromAccessPointAttributes(stack, 'ImportedAccessPoint', {
        accessPointArn: ap.accessPointArn,
        fileSystem: fileSystem,
    });
    // THEN
    expect(imported.accessPointId).toEqual(ap.accessPointId);
    expect(imported.accessPointArn).toEqual(ap.accessPointArn);
    expect(imported.fileSystem).toEqual(ap.fileSystem);
});
test('import using accessPointArn', () => {
    // WHEN
    const ap = new lib_1.AccessPoint(stack, 'MyAccessPoint', {
        fileSystem,
    });
    const imported = lib_1.AccessPoint.fromAccessPointAttributes(stack, 'ImportedAccessPoint', {
        accessPointArn: ap.accessPointArn,
        fileSystem: fileSystem,
    });
    // THEN
    expect(imported.accessPointId).toEqual(ap.accessPointId);
    expect(imported.accessPointArn).toEqual(ap.accessPointArn);
    expect(imported.fileSystem).toEqual(ap.fileSystem);
});
test('throw when import using accessPointArn and accessPointId', () => {
    // WHEN
    const ap = new lib_1.AccessPoint(stack, 'MyAccessPoint', {
        fileSystem,
    });
    // THEN
    expect(() => lib_1.AccessPoint.fromAccessPointAttributes(stack, 'ImportedAccessPoint', {
        accessPointArn: ap.accessPointArn,
        accessPointId: ap.accessPointId,
        fileSystem: fileSystem,
    })).toThrow(/Only one of accessPointId or AccessPointArn can be provided!/);
});
test('throw when import without accessPointArn or accessPointId', () => {
    // WHEN
    new lib_1.AccessPoint(stack, 'MyAccessPoint', {
        fileSystem,
    });
    // THEN
    expect(() => lib_1.AccessPoint.fromAccessPointAttributes(stack, 'ImportedAccessPoint', {
        fileSystem: fileSystem,
    })).toThrow(/One of accessPointId or AccessPointArn is required!/);
});
test('custom access point is created correctly', () => {
    // WHEN
    new lib_1.AccessPoint(stack, 'MyAccessPoint', {
        fileSystem,
        createAcl: {
            ownerGid: '1000',
            ownerUid: '1000',
            permissions: '755',
        },
        path: '/export/share',
        posixUser: {
            gid: '1000',
            uid: '1000',
            secondaryGids: [
                '1001',
                '1002',
            ],
        },
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::EFS::AccessPoint', {
        FileSystemId: {
            Ref: 'EfsFileSystem37910666',
        },
        PosixUser: {
            Gid: '1000',
            SecondaryGids: [
                '1001',
                '1002',
            ],
            Uid: '1000',
        },
        RootDirectory: {
            CreationInfo: {
                OwnerGid: '1000',
                OwnerUid: '1000',
                Permissions: '755',
            },
            Path: '/export/share',
        },
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjZXNzLXBvaW50LnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhY2Nlc3MtcG9pbnQudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUE0QztBQUM1QyxxQ0FBcUM7QUFDckMscUNBQXlDO0FBQ3pDLGdDQUFpRDtBQUVqRCxJQUFJLEtBQVksQ0FBQztBQUNqQixJQUFJLEdBQVksQ0FBQztBQUNqQixJQUFJLFVBQXNCLENBQUM7QUFFM0IsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLEtBQUssR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO0lBQ3BCLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ2hDLFVBQVUsR0FBRyxJQUFJLGdCQUFVLENBQUMsS0FBSyxFQUFFLGVBQWUsRUFBRTtRQUNsRCxHQUFHO0tBQ0osQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFO0lBQ3BDLE9BQU87SUFDUCxVQUFVLENBQUMsY0FBYyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQzNDLE9BQU87SUFDUCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxlQUFlLENBQUMsdUJBQXVCLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDeEUsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO0lBQ3JDLE9BQU87SUFDUCxJQUFJLGlCQUFXLENBQUMsS0FBSyxFQUFFLGVBQWUsRUFBRTtRQUN0QyxVQUFVO0tBQ1gsQ0FBQyxDQUFDO0lBQ0gsT0FBTztJQUNQLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLGVBQWUsQ0FBQyx1QkFBdUIsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUN4RSxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyw4QkFB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dEMsVUFBVTtRQUNWLFNBQVMsRUFBRTtZQUNULFFBQVEsRUFBRSxNQUFNO1lBQ2hCLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLFdBQVcsRUFBRSxLQUFLO1NBQ25CO1FBQ0QsSUFBSSxFQUFFLGVBQWU7UUFDckIsU0FBUyxFQUFFO1lBQ1QsR0FBRyxFQUFFLE1BQU07WUFDWCxHQUFHLEVBQUUsTUFBTTtZQUNYLGFBQWEsRUFBRTtnQkFDYixNQUFNO2dCQUNOLE1BQU07YUFDUDtTQUNGO0tBRUYsQ0FBQyxDQUFDO0lBQ0gsT0FBTztJQUNQLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHVCQUF1QixFQUFFO1FBQ3ZFLFlBQVksRUFBRTtZQUNaLEdBQUcsRUFBRSx1QkFBdUI7U0FDN0I7UUFDRCxTQUFTLEVBQUU7WUFDVCxHQUFHLEVBQUUsTUFBTTtZQUNYLGFBQWEsRUFBRTtnQkFDYixNQUFNO2dCQUNOLE1BQU07YUFDUDtZQUNELEdBQUcsRUFBRSxNQUFNO1NBQ1o7UUFDRCxhQUFhLEVBQUU7WUFDYixZQUFZLEVBQUU7Z0JBQ1osUUFBUSxFQUFFLE1BQU07Z0JBQ2hCLFFBQVEsRUFBRSxNQUFNO2dCQUNoQixXQUFXLEVBQUUsS0FBSzthQUNuQjtZQUNELElBQUksRUFBRSxlQUFlO1NBQ3RCO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gJy4uLy4uL2Fzc2VydGlvbnMnO1xuaW1wb3J0ICogYXMgZWMyIGZyb20gJy4uLy4uL2F3cy1lYzInO1xuaW1wb3J0IHsgU3RhY2ssIFRhZ3MgfSBmcm9tICcuLi8uLi9jb3JlJztcbmltcG9ydCB7IEFjY2Vzc1BvaW50LCBGaWxlU3lzdGVtIH0gZnJvbSAnLi4vbGliJztcblxubGV0IHN0YWNrOiBTdGFjaztcbmxldCB2cGM6IGVjMi5WcGM7XG5sZXQgZmlsZVN5c3RlbTogRmlsZVN5c3RlbTtcblxuYmVmb3JlRWFjaCgoKSA9PiB7XG4gIHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gIHZwYyA9IG5ldyBlYzIuVnBjKHN0YWNrLCAnVlBDJyk7XG4gIGZpbGVTeXN0ZW0gPSBuZXcgRmlsZVN5c3RlbShzdGFjaywgJ0Vmc0ZpbGVTeXN0ZW0nLCB7XG4gICAgdnBjLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdhZGRBY2Nlc3NQb2ludCBjb3JyZWN0bHknLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgZmlsZVN5c3RlbS5hZGRBY2Nlc3NQb2ludCgnTXlBY2Nlc3NQb2ludCcpO1xuICAvLyBUSEVOXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykucmVzb3VyY2VDb3VudElzKCdBV1M6OkVGUzo6QWNjZXNzUG9pbnQnLCAxKTtcbn0pO1xuXG50ZXN0KCduZXcgQWNjZXNzUG9pbnQgY29ycmVjdGx5JywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIG5ldyBBY2Nlc3NQb2ludChzdGFjaywgJ015QWNjZXNzUG9pbnQnLCB7XG4gICAgZmlsZVN5c3RlbSxcbiAgfSk7XG4gIC8vIFRIRU5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5yZXNvdXJjZUNvdW50SXMoJ0FXUzo6RUZTOjpBY2Nlc3NQb2ludCcsIDEpO1xufSk7XG5cbnRlc3QoJ3N1cHBvcnQgdGFncyBmb3IgQWNjZXNzUG9pbnQnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgYWNjZXNzUG9pbnQgPSBuZXcgQWNjZXNzUG9pbnQoc3RhY2ssICdNeUFjY2Vzc1BvaW50Jywge1xuICAgIGZpbGVTeXN0ZW0sXG4gIH0pO1xuICBUYWdzLm9mKGFjY2Vzc1BvaW50KS5hZGQoJ2tleTEnLCAndmFsdWUxJyk7XG4gIFRhZ3Mub2YoYWNjZXNzUG9pbnQpLmFkZCgna2V5MicsICd2YWx1ZTInKTtcbiAgVGFncy5vZihhY2Nlc3NQb2ludCkuYWRkKCdOYW1lJywgJ015QWNjZXNzUG9pbnROYW1lJyk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpFRlM6OkFjY2Vzc1BvaW50Jywge1xuICAgIEFjY2Vzc1BvaW50VGFnczogW1xuICAgICAgeyBLZXk6ICdrZXkxJywgVmFsdWU6ICd2YWx1ZTEnIH0sXG4gICAgICB7IEtleTogJ2tleTInLCBWYWx1ZTogJ3ZhbHVlMicgfSxcbiAgICAgIHsgS2V5OiAnTmFtZScsIFZhbHVlOiAnTXlBY2Nlc3NQb2ludE5hbWUnIH0sXG4gICAgXSxcbiAgfSk7XG59KTtcblxudGVzdCgnaW1wb3J0IGFuIEFjY2Vzc1BvaW50IHVzaW5nIGZyb21BY2Nlc3NQb2ludElkJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGFwID0gbmV3IEFjY2Vzc1BvaW50KHN0YWNrLCAnTXlBY2Nlc3NQb2ludCcsIHtcbiAgICBmaWxlU3lzdGVtLFxuICB9KTtcbiAgY29uc3QgaW1wb3J0ZWQgPSBBY2Nlc3NQb2ludC5mcm9tQWNjZXNzUG9pbnRJZChzdGFjaywgJ0ltcG9ydGVkQWNjZXNzUG9pbnQnLCBhcC5hY2Nlc3NQb2ludElkKTtcbiAgLy8gVEhFTlxuICBleHBlY3QoaW1wb3J0ZWQuYWNjZXNzUG9pbnRJZCkudG9FcXVhbChhcC5hY2Nlc3NQb2ludElkKTtcbn0pO1xuXG50ZXN0KCdpbXBvcnQgYW4gQWNjZXNzUG9pbnQgdXNpbmcgZnJvbUFjY2Vzc1BvaW50SWQgdGhyb3dzIHdoZW4gYWNjZXNzaW5nIGZpbGVTeXN0ZW0nLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgYXAgPSBuZXcgQWNjZXNzUG9pbnQoc3RhY2ssICdNeUFjY2Vzc1BvaW50Jywge1xuICAgIGZpbGVTeXN0ZW0sXG4gIH0pO1xuICBjb25zdCBpbXBvcnRlZCA9IEFjY2Vzc1BvaW50LmZyb21BY2Nlc3NQb2ludElkKHN0YWNrLCAnSW1wb3J0ZWRBY2Nlc3NQb2ludCcsIGFwLmFjY2Vzc1BvaW50SWQpO1xuICAvLyBUSEVOXG4gIGV4cGVjdCgoKSA9PiBpbXBvcnRlZC5maWxlU3lzdGVtKS50b1Rocm93KC9maWxlU3lzdGVtIGlzIG9ubHkgYXZhaWxhYmxlIGlmICdmcm9tQWNjZXNzUG9pbnRBdHRyaWJ1dGVzXFwoXFwpJyBpcyB1c2VkIGFuZCBhIGZpbGVTeXN0ZW0gaXMgcGFzc2VkIGluIGFzIGFuIGF0dHJpYnV0ZS4vKTtcbn0pO1xuXG50ZXN0KCdpbXBvcnQgYW4gQWNjZXNzUG9pbnQgdXNpbmcgZnJvbUFjY2Vzc1BvaW50QXR0cmlidXRlcyBhbmQgdGhlIGFjY2Vzc1BvaW50SWQnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgYXAgPSBuZXcgQWNjZXNzUG9pbnQoc3RhY2ssICdNeUFjY2Vzc1BvaW50Jywge1xuICAgIGZpbGVTeXN0ZW0sXG4gIH0pO1xuICBjb25zdCBpbXBvcnRlZCA9IEFjY2Vzc1BvaW50LmZyb21BY2Nlc3NQb2ludEF0dHJpYnV0ZXMoc3RhY2ssICdJbXBvcnRlZEFjY2Vzc1BvaW50Jywge1xuICAgIGFjY2Vzc1BvaW50SWQ6IGFwLmFjY2Vzc1BvaW50SWQsXG4gICAgZmlsZVN5c3RlbTogZmlsZVN5c3RlbSxcbiAgfSk7XG4gIC8vIFRIRU5cbiAgZXhwZWN0KGltcG9ydGVkLmFjY2Vzc1BvaW50SWQpLnRvRXF1YWwoYXAuYWNjZXNzUG9pbnRJZCk7XG4gIGV4cGVjdChpbXBvcnRlZC5hY2Nlc3NQb2ludEFybikudG9FcXVhbChhcC5hY2Nlc3NQb2ludEFybik7XG4gIGV4cGVjdChpbXBvcnRlZC5maWxlU3lzdGVtKS50b0VxdWFsKGFwLmZpbGVTeXN0ZW0pO1xufSk7XG5cbnRlc3QoJ2ltcG9ydCBhbiBBY2Nlc3NQb2ludCB1c2luZyBmcm9tQWNjZXNzUG9pbnRBdHRyaWJ1dGVzIGFuZCB0aGUgYWNjZXNzUG9pbnRBcm4nLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgYXAgPSBuZXcgQWNjZXNzUG9pbnQoc3RhY2ssICdNeUFjY2Vzc1BvaW50Jywge1xuICAgIGZpbGVTeXN0ZW0sXG4gIH0pO1xuICBjb25zdCBpbXBvcnRlZCA9IEFjY2Vzc1BvaW50LmZyb21BY2Nlc3NQb2ludEF0dHJpYnV0ZXMoc3RhY2ssICdJbXBvcnRlZEFjY2Vzc1BvaW50Jywge1xuICAgIGFjY2Vzc1BvaW50QXJuOiBhcC5hY2Nlc3NQb2ludEFybixcbiAgICBmaWxlU3lzdGVtOiBmaWxlU3lzdGVtLFxuICB9KTtcbiAgLy8gVEhFTlxuICBleHBlY3QoaW1wb3J0ZWQuYWNjZXNzUG9pbnRJZCkudG9FcXVhbChhcC5hY2Nlc3NQb2ludElkKTtcbiAgZXhwZWN0KGltcG9ydGVkLmFjY2Vzc1BvaW50QXJuKS50b0VxdWFsKGFwLmFjY2Vzc1BvaW50QXJuKTtcbiAgZXhwZWN0KGltcG9ydGVkLmZpbGVTeXN0ZW0pLnRvRXF1YWwoYXAuZmlsZVN5c3RlbSk7XG59KTtcblxudGVzdCgnaW1wb3J0IHVzaW5nIGFjY2Vzc1BvaW50QXJuJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGFwID0gbmV3IEFjY2Vzc1BvaW50KHN0YWNrLCAnTXlBY2Nlc3NQb2ludCcsIHtcbiAgICBmaWxlU3lzdGVtLFxuICB9KTtcbiAgY29uc3QgaW1wb3J0ZWQgPSBBY2Nlc3NQb2ludC5mcm9tQWNjZXNzUG9pbnRBdHRyaWJ1dGVzKHN0YWNrLCAnSW1wb3J0ZWRBY2Nlc3NQb2ludCcsIHtcbiAgICBhY2Nlc3NQb2ludEFybjogYXAuYWNjZXNzUG9pbnRBcm4sXG4gICAgZmlsZVN5c3RlbTogZmlsZVN5c3RlbSxcbiAgfSk7XG4gIC8vIFRIRU5cbiAgZXhwZWN0KGltcG9ydGVkLmFjY2Vzc1BvaW50SWQpLnRvRXF1YWwoYXAuYWNjZXNzUG9pbnRJZCk7XG4gIGV4cGVjdChpbXBvcnRlZC5hY2Nlc3NQb2ludEFybikudG9FcXVhbChhcC5hY2Nlc3NQb2ludEFybik7XG4gIGV4cGVjdChpbXBvcnRlZC5maWxlU3lzdGVtKS50b0VxdWFsKGFwLmZpbGVTeXN0ZW0pO1xufSk7XG5cbnRlc3QoJ3Rocm93IHdoZW4gaW1wb3J0IHVzaW5nIGFjY2Vzc1BvaW50QXJuIGFuZCBhY2Nlc3NQb2ludElkJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGFwID0gbmV3IEFjY2Vzc1BvaW50KHN0YWNrLCAnTXlBY2Nlc3NQb2ludCcsIHtcbiAgICBmaWxlU3lzdGVtLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdCgoKSA9PiBBY2Nlc3NQb2ludC5mcm9tQWNjZXNzUG9pbnRBdHRyaWJ1dGVzKHN0YWNrLCAnSW1wb3J0ZWRBY2Nlc3NQb2ludCcsIHtcbiAgICBhY2Nlc3NQb2ludEFybjogYXAuYWNjZXNzUG9pbnRBcm4sXG4gICAgYWNjZXNzUG9pbnRJZDogYXAuYWNjZXNzUG9pbnRJZCxcbiAgICBmaWxlU3lzdGVtOiBmaWxlU3lzdGVtLFxuICB9KSkudG9UaHJvdygvT25seSBvbmUgb2YgYWNjZXNzUG9pbnRJZCBvciBBY2Nlc3NQb2ludEFybiBjYW4gYmUgcHJvdmlkZWQhLyk7XG59KTtcblxudGVzdCgndGhyb3cgd2hlbiBpbXBvcnQgd2l0aG91dCBhY2Nlc3NQb2ludEFybiBvciBhY2Nlc3NQb2ludElkJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIG5ldyBBY2Nlc3NQb2ludChzdGFjaywgJ015QWNjZXNzUG9pbnQnLCB7XG4gICAgZmlsZVN5c3RlbSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QoKCkgPT4gQWNjZXNzUG9pbnQuZnJvbUFjY2Vzc1BvaW50QXR0cmlidXRlcyhzdGFjaywgJ0ltcG9ydGVkQWNjZXNzUG9pbnQnLCB7XG4gICAgZmlsZVN5c3RlbTogZmlsZVN5c3RlbSxcbiAgfSkpLnRvVGhyb3coL09uZSBvZiBhY2Nlc3NQb2ludElkIG9yIEFjY2Vzc1BvaW50QXJuIGlzIHJlcXVpcmVkIS8pO1xufSk7XG5cbnRlc3QoJ2N1c3RvbSBhY2Nlc3MgcG9pbnQgaXMgY3JlYXRlZCBjb3JyZWN0bHknLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgbmV3IEFjY2Vzc1BvaW50KHN0YWNrLCAnTXlBY2Nlc3NQb2ludCcsIHtcbiAgICBmaWxlU3lzdGVtLFxuICAgIGNyZWF0ZUFjbDoge1xuICAgICAgb3duZXJHaWQ6ICcxMDAwJyxcbiAgICAgIG93bmVyVWlkOiAnMTAwMCcsXG4gICAgICBwZXJtaXNzaW9uczogJzc1NScsXG4gICAgfSxcbiAgICBwYXRoOiAnL2V4cG9ydC9zaGFyZScsXG4gICAgcG9zaXhVc2VyOiB7XG4gICAgICBnaWQ6ICcxMDAwJyxcbiAgICAgIHVpZDogJzEwMDAnLFxuICAgICAgc2Vjb25kYXJ5R2lkczogW1xuICAgICAgICAnMTAwMScsXG4gICAgICAgICcxMDAyJyxcbiAgICAgIF0sXG4gICAgfSxcblxuICB9KTtcbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpFRlM6OkFjY2Vzc1BvaW50Jywge1xuICAgIEZpbGVTeXN0ZW1JZDoge1xuICAgICAgUmVmOiAnRWZzRmlsZVN5c3RlbTM3OTEwNjY2JyxcbiAgICB9LFxuICAgIFBvc2l4VXNlcjoge1xuICAgICAgR2lkOiAnMTAwMCcsXG4gICAgICBTZWNvbmRhcnlHaWRzOiBbXG4gICAgICAgICcxMDAxJyxcbiAgICAgICAgJzEwMDInLFxuICAgICAgXSxcbiAgICAgIFVpZDogJzEwMDAnLFxuICAgIH0sXG4gICAgUm9vdERpcmVjdG9yeToge1xuICAgICAgQ3JlYXRpb25JbmZvOiB7XG4gICAgICAgIE93bmVyR2lkOiAnMTAwMCcsXG4gICAgICAgIE93bmVyVWlkOiAnMTAwMCcsXG4gICAgICAgIFBlcm1pc3Npb25zOiAnNzU1JyxcbiAgICAgIH0sXG4gICAgICBQYXRoOiAnL2V4cG9ydC9zaGFyZScsXG4gICAgfSxcbiAgfSk7XG59KTtcbiJdfQ==