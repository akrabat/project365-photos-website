"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("../../core");
const lib_1 = require("../lib");
describe(lib_1.Match, () => {
    const app = new core_1.App();
    const stack = new core_1.Stack(app, 'stack');
    test('anythingBut', () => {
        expect(stack.resolve(lib_1.Match.anythingBut(1, 2, 3))).toEqual([
            { 'anything-but': [1, 2, 3] },
        ]);
        expect(stack.resolve(lib_1.Match.anythingBut('foo', 'bar'))).toEqual([
            { 'anything-but': ['foo', 'bar'] },
        ]);
        expect(() => stack.resolve(lib_1.Match.anythingBut(1, 'foo'))).toThrowError(/only strings or only numbers/);
        expect(() => stack.resolve(lib_1.Match.anythingBut({ foo: 42 }))).toThrowError(/only strings or only numbers/);
        expect(() => stack.resolve(lib_1.Match.anythingBut())).toThrowError(/must be non-empty lists/);
    });
    test('anythingButPrefix', () => {
        expect(stack.resolve(lib_1.Match.anythingButPrefix('foo'))).toEqual([
            { 'anything-but': { prefix: 'foo' } },
        ]);
    });
    test('numeric', () => {
        expect(stack.resolve(lib_1.Match.allOf(lib_1.Match.greaterThan(-100), lib_1.Match.lessThanOrEqual(200)))).toEqual([
            { numeric: ['>', -100, '<=', 200] },
        ]);
        expect(() => stack.resolve(lib_1.Match.allOf())).toThrowError(/A list of matchers must contain at least one element/);
    });
    test('interval', () => {
        expect(stack.resolve(lib_1.Match.interval(0, 100))).toEqual([
            { numeric: ['>=', 0, '<=', 100] },
        ]);
        expect(() => stack.resolve(lib_1.Match.interval(1, 0))).toThrowError('Invalid interval: [1, 0]');
    });
    test('cidr', () => {
        // IPv4
        expect(stack.resolve(lib_1.Match.cidr('198.51.100.14/24'))).toEqual([
            { cidr: '198.51.100.14/24' },
        ]);
        // IPv6
        expect(stack.resolve(lib_1.Match.cidr('2001:db8::/48'))).toEqual([
            { cidr: '2001:db8::/48' },
        ]);
        // Invalid
        expect(() => stack.resolve(lib_1.Match.cidr('a.b.c/31'))).toThrow(/Invalid IP address range/);
    });
    test('anyOf', () => {
        expect(stack.resolve(lib_1.Match.anyOf(lib_1.Match.equal(0), lib_1.Match.equal(1)))).toEqual([
            { numeric: ['=', 0] },
            { numeric: ['=', 1] },
        ]);
        expect(() => stack.resolve(lib_1.Match.anyOf())).toThrow(/A list of matchers must contain at least one element/);
    });
    test('prefix', () => {
        expect(stack.resolve(lib_1.Match.prefix('foo'))).toEqual([
            { prefix: 'foo' },
        ]);
    });
    test('suffix', () => {
        expect(stack.resolve(lib_1.Match.suffix('foo'))).toEqual([
            { suffix: 'foo' },
        ]);
    });
    test('equalsIgnoreCase', () => {
        expect(stack.resolve(lib_1.Match.equalsIgnoreCase('foo'))).toEqual([
            { 'equals-ignore-case': 'foo' },
        ]);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWF0Y2hlcnMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1hdGNoZXJzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxxQ0FBd0M7QUFDeEMsZ0NBQStCO0FBRS9CLFFBQVEsQ0FBQyxXQUFLLEVBQUUsR0FBRyxFQUFFO0lBQ25CLE1BQU0sR0FBRyxHQUFHLElBQUksVUFBRyxFQUFFLENBQUM7SUFDdEIsTUFBTSxLQUFLLEdBQUcsSUFBSSxZQUFLLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBRXRDLElBQUksQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQ3ZCLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFdBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ3hELEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtTQUM5QixDQUFDLENBQUM7UUFFSCxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxXQUFLLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQzdELEVBQUUsY0FBYyxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxFQUFFO1NBQ25DLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFdBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsOEJBQThCLENBQUMsQ0FBQztRQUN0RyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxXQUFLLENBQUMsV0FBVyxDQUFDLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxDQUFDLENB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QyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHAsIFN0YWNrIH0gZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgeyBNYXRjaCB9IGZyb20gJy4uL2xpYic7XG5cbmRlc2NyaWJlKE1hdGNoLCAoKSA9PiB7XG4gIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnc3RhY2snKTtcblxuICB0ZXN0KCdhbnl0aGluZ0J1dCcsICgpID0+IHtcbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShNYXRjaC5hbnl0aGluZ0J1dCgxLCAyLCAzKSkpLnRvRXF1YWwoW1xuICAgICAgeyAnYW55dGhpbmctYnV0JzogWzEsIDIsIDNdIH0sXG4gICAgXSk7XG5cbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShNYXRjaC5hbnl0aGluZ0J1dCgnZm9vJywgJ2JhcicpKSkudG9FcXVhbChbXG4gICAgICB7ICdhbnl0aGluZy1idXQnOiBbJ2ZvbycsICdiYXInXSB9LFxuICAgIF0pO1xuXG4gICAgZXhwZWN0KCgpID0+IHN0YWNrLnJlc29sdmUoTWF0Y2guYW55dGhpbmdCdXQoMSwgJ2ZvbycpKSkudG9UaHJvd0Vycm9yKC9vbmx5IHN0cmluZ3Mgb3Igb25seSBudW1iZXJzLyk7XG4gICAgZXhwZWN0KCgpID0+IHN0YWNrLnJlc29sdmUoTWF0Y2guYW55dGhpbmdCdXQoeyBmb286IDQyIH0pKSkudG9UaHJvd0Vycm9yKC9vbmx5IHN0cmluZ3Mgb3Igb25seSBudW1iZXJzLyk7XG4gICAgZXhwZWN0KCgpID0+IHN0YWNrLnJlc29sdmUoTWF0Y2guYW55dGhpbmdCdXQoKSkpLnRvVGhyb3dFcnJvcigvbXVzdCBiZSBub24tZW1wdHkgbGlzdHMvKTtcbiAgfSk7XG5cbiAgdGVzdCgnYW55dGhpbmdCdXRQcmVmaXgnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoTWF0Y2guYW55dGhpbmdCdXRQcmVmaXgoJ2ZvbycpKSkudG9FcXVhbChbXG4gICAgICB7ICdhbnl0aGluZy1idXQnOiB7IHByZWZpeDogJ2ZvbycgfSB9LFxuICAgIF0pO1xuICB9KTtcblxuICB0ZXN0KCdudW1lcmljJywgKCkgPT4ge1xuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKE1hdGNoLmFsbE9mKE1hdGNoLmdyZWF0ZXJUaGFuKC0xMDApLCBNYXRjaC5sZXNzVGhhbk9yRXF1YWwoMjAwKSkpKS50b0VxdWFsKFtcbiAgICAgIHsgbnVtZXJpYzogWyc+JywgLTEwMCwgJzw9JywgMjAwXSB9LFxuICAgIF0pO1xuXG4gICAgZXhwZWN0KCgpID0+IHN0YWNrLnJlc29sdmUoTWF0Y2guYWxsT2YoKSkpLnRvVGhyb3dFcnJvcigvQSBsaXN0IG9mIG1hdGNoZXJzIG11c3QgY29udGFpbiBhdCBsZWFzdCBvbmUgZWxlbWVudC8pO1xuICB9KTtcblxuICB0ZXN0KCdpbnRlcnZhbCcsICgpID0+IHtcbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShNYXRjaC5pbnRlcnZhbCgwLCAxMDApKSkudG9FcXVhbChbXG4gICAgICB7IG51bWVyaWM6IFsnPj0nLCAwLCAnPD0nLCAxMDBdIH0sXG4gICAgXSk7XG5cbiAgICBleHBlY3QoKCkgPT4gc3RhY2sucmVzb2x2ZShNYXRjaC5pbnRlcnZhbCgxLCAwKSkpLnRvVGhyb3dFcnJvcignSW52YWxpZCBpbnRlcnZhbDogWzEsIDBdJyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NpZHInLCAoKSA9PiB7XG4gICAgLy8gSVB2NFxuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKE1hdGNoLmNpZHIoJzE5OC41MS4xMDAuMTQvMjQnKSkpLnRvRXF1YWwoW1xuICAgICAgeyBjaWRyOiAnMTk4LjUxLjEwMC4xNC8yNCcgfSxcbiAgICBdKTtcblxuICAgIC8vIElQdjZcbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShNYXRjaC5jaWRyKCcyMDAxOmRiODo6LzQ4JykpKS50b0VxdWFsKFtcbiAgICAgIHsgY2lkcjogJzIwMDE6ZGI4OjovNDgnIH0sXG4gICAgXSk7XG5cbiAgICAvLyBJbnZhbGlkXG4gICAgZXhwZWN0KCgpID0+IHN0YWNrLnJlc29sdmUoTWF0Y2guY2lkcignYS5iLmMvMzEnKSkpLnRvVGhyb3coL0ludmFsaWQgSVAgYWRkcmVzcyByYW5nZS8pO1xuICB9KTtcblxuICB0ZXN0KCdhbnlPZicsICgpID0+IHtcbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShNYXRjaC5hbnlPZihNYXRjaC5lcXVhbCgwKSwgTWF0Y2guZXF1YWwoMSkpKSkudG9FcXVhbChbXG4gICAgICB7IG51bWVyaWM6IFsnPScsIDBdIH0sXG4gICAgICB7IG51bWVyaWM6IFsnPScsIDFdIH0sXG4gICAgXSk7XG5cbiAgICBleHBlY3QoKCkgPT4gc3RhY2sucmVzb2x2ZShNYXRjaC5hbnlPZigpKSkudG9UaHJvdygvQSBsaXN0IG9mIG1hdGNoZXJzIG11c3QgY29udGFpbiBhdCBsZWFzdCBvbmUgZWxlbWVudC8pO1xuICB9KTtcblxuICB0ZXN0KCdwcmVmaXgnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoTWF0Y2gucHJlZml4KCdmb28nKSkpLnRvRXF1YWwoW1xuICAgICAgeyBwcmVmaXg6ICdmb28nIH0sXG4gICAgXSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3N1ZmZpeCcsICgpID0+IHtcbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShNYXRjaC5zdWZmaXgoJ2ZvbycpKSkudG9FcXVhbChbXG4gICAgICB7IHN1ZmZpeDogJ2ZvbycgfSxcbiAgICBdKTtcbiAgfSk7XG5cbiAgdGVzdCgnZXF1YWxzSWdub3JlQ2FzZScsICgpID0+IHtcbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShNYXRjaC5lcXVhbHNJZ25vcmVDYXNlKCdmb28nKSkpLnRvRXF1YWwoW1xuICAgICAgeyAnZXF1YWxzLWlnbm9yZS1jYXNlJzogJ2ZvbycgfSxcbiAgICBdKTtcbiAgfSk7XG59KTtcbiJdfQ==