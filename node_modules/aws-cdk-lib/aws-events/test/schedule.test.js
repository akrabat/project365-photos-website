"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("../../core");
const events = require("../lib");
describe('schedule', () => {
    test('cron expressions day and dow are mutex: given weekday', () => {
        // Run every 10 minutes Monday through Friday
        expect('cron(0/10 * ? * MON-FRI *)').toEqual(events.Schedule.cron({
            minute: '0/10',
            weekDay: 'MON-FRI',
        }).expressionString);
    });
    test('cron expressions day and dow are mutex: given month day', () => {
        // Run at 8:00 am (UTC) every 1st day of the month
        expect('cron(0 8 1 * ? *)').toEqual(events.Schedule.cron({
            minute: '0',
            hour: '8',
            day: '1',
        }).expressionString);
    });
    test('cron expressions day and dow are mutex: given neither', () => {
        // Run at 10:00 am (UTC) every day
        expect('cron(0 10 * * ? *)').toEqual(events.Schedule.cron({
            minute: '0',
            hour: '10',
        }).expressionString);
    });
    test('rate cannot be 0', () => {
        expect(() => {
            events.Schedule.rate(core_1.Duration.days(0));
        }).toThrow(/Duration cannot be 0/);
    });
    test('rate cannot be negative', () => {
        expect(() => {
            events.Schedule.rate(core_1.Duration.minutes(-2));
        }).toThrow(/Duration amounts cannot be negative/);
    });
    test('rate can be from a token', () => {
        const stack = new core_1.Stack();
        const lazyDuration = core_1.Duration.minutes(core_1.Lazy.number({ produce: () => 5 }));
        const rate = events.Schedule.rate(lazyDuration);
        expect('rate(5 minutes)').toEqual(stack.resolve(rate).expressionString);
    });
    test('rate can be in minutes', () => {
        expect('rate(10 minutes)').toEqual(events.Schedule.rate(core_1.Duration.minutes(10))
            .expressionString);
    });
    test('rate can be in days', () => {
        expect('rate(10 days)').toEqual(events.Schedule.rate(core_1.Duration.days(10))
            .expressionString);
    });
    test('rate can be in hours', () => {
        expect('rate(10 hours)').toEqual(events.Schedule.rate(core_1.Duration.hours(10))
            .expressionString);
    });
    test('rate can be in seconds', () => {
        expect('rate(2 minutes)').toEqual(events.Schedule.rate(core_1.Duration.seconds(120))
            .expressionString);
    });
    test('rate must not be in seconds when specified as a token', () => {
        expect(() => {
            events.Schedule.rate(core_1.Duration.seconds(core_1.Lazy.number({ produce: () => 5 })));
        }).toThrow(/Allowed units for scheduling/);
    });
});
describe('fractional minutes checks', () => {
    test('rate cannot be a fractional amount of minutes (defined with seconds)', () => {
        expect(() => {
            events.Schedule.rate(core_1.Duration.seconds(150));
        }).toThrow(/cannot be converted into a whole number of/);
    });
    test('rate cannot be a fractional amount of minutes (defined with minutes)', () => {
        expect(() => {
            events.Schedule.rate(core_1.Duration.minutes(5 / 3));
        }).toThrow(/must be a whole number of/);
    });
    test('rate cannot be a fractional amount of minutes (defined with hours)', () => {
        expect(() => {
            events.Schedule.rate(core_1.Duration.hours(1.03));
        }).toThrow(/cannot be converted into a whole number of/);
    });
    test('rate cannot be less than 1 minute (defined with seconds)', () => {
        expect(() => {
            events.Schedule.rate(core_1.Duration.seconds(30));
        }).toThrow(/'30 seconds' cannot be converted into a whole number of minutes./);
    });
    test('rate cannot be less than 1 minute (defined with minutes as fractions)', () => {
        expect(() => {
            events.Schedule.rate(core_1.Duration.minutes(1 / 2));
        }).toThrow(/must be a whole number of/);
    });
    test('rate cannot be less than 1 minute (defined with minutes as decimals)', () => {
        expect(() => {
            events.Schedule.rate(core_1.Duration.minutes(0.25));
        }).toThrow(/must be a whole number of/);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZWR1bGUudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNjaGVkdWxlLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxxQ0FBbUQ7QUFDbkQsaUNBQWlDO0FBRWpDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFO0lBQ3hCLElBQUksQ0FBQyx1REFBdUQsRUFBRSxHQUFHLEVBQUU7UUFDakUsNkNBQTZDO1FBQzdDLE1BQU0sQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztZQUNoRSxNQUFNLEVBQUUsTUFBTTtZQUNkLE9BQU8sRUFBRSxTQUFTO1NBQ25CLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHlEQUF5RCxFQUFFLEdBQUcsRUFBRTtRQUNuRSxrREFBa0Q7UUFDbEQsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO1lBQ3ZELE1BQU0sRUFBRSxHQUFHO1lBQ1gsSUFBSSxFQUFFLEdBQUc7WUFDVCxHQUFHLEVBQUUsR0FBRztTQUNULENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHVEQUF1RCxFQUFFLEdBQUcsRUFBRTtRQUNqRSxrQ0FBa0M7UUFDbEMsTUFBTSxDQUFDLG9CQUFvQixDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO1lBQ3hELE1BQU0sRUFBRSxHQUFHO1lBQ1gsSUFBSSxFQUFFLElBQUk7U0FDWCxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDNUIsTUFBTSxDQUFDLEdB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Q2pGLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxlQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0lBQzFDLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHNFQUFzRSxFQUFFLEdBQUcsRUFBRTtRQUNoRixNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsZUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0lBQzFDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEdXJhdGlvbiwgU3RhY2ssIExhenkgfSBmcm9tICcuLi8uLi9jb3JlJztcbmltcG9ydCAqIGFzIGV2ZW50cyBmcm9tICcuLi9saWInO1xuXG5kZXNjcmliZSgnc2NoZWR1bGUnLCAoKSA9PiB7XG4gIHRlc3QoJ2Nyb24gZXhwcmVzc2lvbnMgZGF5IGFuZCBkb3cgYXJlIG11dGV4OiBnaXZlbiB3ZWVrZGF5JywgKCkgPT4ge1xuICAgIC8vIFJ1biBldmVyeSAxMCBtaW51dGVzIE1vbmRheSB0aHJvdWdoIEZyaWRheVxuICAgIGV4cGVjdCgnY3JvbigwLzEwICogPyAqIE1PTi1GUkkgKiknKS50b0VxdWFsKGV2ZW50cy5TY2hlZHVsZS5jcm9uKHtcbiAgICAgIG1pbnV0ZTogJzAvMTAnLFxuICAgICAgd2Vla0RheTogJ01PTi1GUkknLFxuICAgIH0pLmV4cHJlc3Npb25TdHJpbmcpO1xuICB9KTtcblxuICB0ZXN0KCdjcm9uIGV4cHJlc3Npb25zIGRheSBhbmQgZG93IGFyZSBtdXRleDogZ2l2ZW4gbW9udGggZGF5JywgKCkgPT4ge1xuICAgIC8vIFJ1biBhdCA4OjAwIGFtIChVVEMpIGV2ZXJ5IDFzdCBkYXkgb2YgdGhlIG1vbnRoXG4gICAgZXhwZWN0KCdjcm9uKDAgOCAxICogPyAqKScpLnRvRXF1YWwoZXZlbnRzLlNjaGVkdWxlLmNyb24oe1xuICAgICAgbWludXRlOiAnMCcsXG4gICAgICBob3VyOiAnOCcsXG4gICAgICBkYXk6ICcxJyxcbiAgICB9KS5leHByZXNzaW9uU3RyaW5nKTtcbiAgfSk7XG5cbiAgdGVzdCgnY3JvbiBleHByZXNzaW9ucyBkYXkgYW5kIGRvdyBhcmUgbXV0ZXg6IGdpdmVuIG5laXRoZXInLCAoKSA9PiB7XG4gICAgLy8gUnVuIGF0IDEwOjAwIGFtIChVVEMpIGV2ZXJ5IGRheVxuICAgIGV4cGVjdCgnY3JvbigwIDEwICogKiA/ICopJykudG9FcXVhbChldmVudHMuU2NoZWR1bGUuY3Jvbih7XG4gICAgICBtaW51dGU6ICcwJyxcbiAgICAgIGhvdXI6ICcxMCcsXG4gICAgfSkuZXhwcmVzc2lvblN0cmluZyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JhdGUgY2Fubm90IGJlIDAnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGV2ZW50cy5TY2hlZHVsZS5yYXRlKER1cmF0aW9uLmRheXMoMCkpO1xuICAgIH0pLnRvVGhyb3coL0R1cmF0aW9uIGNhbm5vdCBiZSAwLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JhdGUgY2Fubm90IGJlIG5lZ2F0aXZlJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBldmVudHMuU2NoZWR1bGUucmF0ZShEdXJhdGlvbi5taW51dGVzKC0yKSk7XG4gICAgfSkudG9UaHJvdygvRHVyYXRpb24gYW1vdW50cyBjYW5ub3QgYmUgbmVnYXRpdmUvKTtcbiAgfSk7XG5cbiAgdGVzdCgncmF0ZSBjYW4gYmUgZnJvbSBhIHRva2VuJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgY29uc3QgbGF6eUR1cmF0aW9uID0gRHVyYXRpb24ubWludXRlcyhMYXp5Lm51bWJlcih7IHByb2R1Y2U6ICgpID0+IDUgfSkpO1xuICAgIGNvbnN0IHJhdGUgPSBldmVudHMuU2NoZWR1bGUucmF0ZShsYXp5RHVyYXRpb24pO1xuICAgIGV4cGVjdCgncmF0ZSg1IG1pbnV0ZXMpJykudG9FcXVhbChzdGFjay5yZXNvbHZlKHJhdGUpLmV4cHJlc3Npb25TdHJpbmcpO1xuICB9KTtcblxuICB0ZXN0KCdyYXRlIGNhbiBiZSBpbiBtaW51dGVzJywgKCkgPT4ge1xuICAgIGV4cGVjdCgncmF0ZSgxMCBtaW51dGVzKScpLnRvRXF1YWwoXG4gICAgICBldmVudHMuU2NoZWR1bGUucmF0ZShEdXJhdGlvbi5taW51dGVzKDEwKSlcbiAgICAgICAgLmV4cHJlc3Npb25TdHJpbmcpO1xuICB9KTtcblxuICB0ZXN0KCdyYXRlIGNhbiBiZSBpbiBkYXlzJywgKCkgPT4ge1xuICAgIGV4cGVjdCgncmF0ZSgxMCBkYXlzKScpLnRvRXF1YWwoXG4gICAgICBldmVudHMuU2NoZWR1bGUucmF0ZShEdXJhdGlvbi5kYXlzKDEwKSlcbiAgICAgICAgLmV4cHJlc3Npb25TdHJpbmcpO1xuICB9KTtcblxuICB0ZXN0KCdyYXRlIGNhbiBiZSBpbiBob3VycycsICgpID0+IHtcbiAgICBleHBlY3QoJ3JhdGUoMTAgaG91cnMpJykudG9FcXVhbChcbiAgICAgIGV2ZW50cy5TY2hlZHVsZS5yYXRlKER1cmF0aW9uLmhvdXJzKDEwKSlcbiAgICAgICAgLmV4cHJlc3Npb25TdHJpbmcpO1xuICB9KTtcblxuICB0ZXN0KCdyYXRlIGNhbiBiZSBpbiBzZWNvbmRzJywgKCkgPT4ge1xuICAgIGV4cGVjdCgncmF0ZSgyIG1pbnV0ZXMpJykudG9FcXVhbChcbiAgICAgIGV2ZW50cy5TY2hlZHVsZS5yYXRlKER1cmF0aW9uLnNlY29uZHMoMTIwKSlcbiAgICAgICAgLmV4cHJlc3Npb25TdHJpbmcpO1xuICB9KTtcblxuICB0ZXN0KCdyYXRlIG11c3Qgbm90IGJlIGluIHNlY29uZHMgd2hlbiBzcGVjaWZpZWQgYXMgYSB0b2tlbicsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgZXZlbnRzLlNjaGVkdWxlLnJhdGUoRHVyYXRpb24uc2Vjb25kcyhMYXp5Lm51bWJlcih7IHByb2R1Y2U6ICgpID0+IDUgfSkpKTtcbiAgICB9KS50b1Rocm93KC9BbGxvd2VkIHVuaXRzIGZvciBzY2hlZHVsaW5nLyk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdmcmFjdGlvbmFsIG1pbnV0ZXMgY2hlY2tzJywgKCkgPT4ge1xuICB0ZXN0KCdyYXRlIGNhbm5vdCBiZSBhIGZyYWN0aW9uYWwgYW1vdW50IG9mIG1pbnV0ZXMgKGRlZmluZWQgd2l0aCBzZWNvbmRzKScsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgZXZlbnRzLlNjaGVkdWxlLnJhdGUoRHVyYXRpb24uc2Vjb25kcygxNTApKTtcbiAgICB9KS50b1Rocm93KC9jYW5ub3QgYmUgY29udmVydGVkIGludG8gYSB3aG9sZSBudW1iZXIgb2YvKTtcbiAgfSk7XG5cbiAgdGVzdCgncmF0ZSBjYW5ub3QgYmUgYSBmcmFjdGlvbmFsIGFtb3VudCBvZiBtaW51dGVzIChkZWZpbmVkIHdpdGggbWludXRlcyknLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpPT4ge1xuICAgICAgZXZlbnRzLlNjaGVkdWxlLnJhdGUoRHVyYXRpb24ubWludXRlcyg1LzMpKTtcbiAgICB9KS50b1Rocm93KC9tdXN0IGJlIGEgd2hvbGUgbnVtYmVyIG9mLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JhdGUgY2Fubm90IGJlIGEgZnJhY3Rpb25hbCBhbW91bnQgb2YgbWludXRlcyAoZGVmaW5lZCB3aXRoIGhvdXJzKScsICgpID0+IHtcbiAgICBleHBlY3QoKCk9PiB7XG4gICAgICBldmVudHMuU2NoZWR1bGUucmF0ZShEdXJhdGlvbi5ob3VycygxLjAzKSk7XG4gICAgfSkudG9UaHJvdygvY2Fubm90IGJlIGNvbnZlcnRlZCBpbnRvIGEgd2hvbGUgbnVtYmVyIG9mLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JhdGUgY2Fubm90IGJlIGxlc3MgdGhhbiAxIG1pbnV0ZSAoZGVmaW5lZCB3aXRoIHNlY29uZHMpJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBldmVudHMuU2NoZWR1bGUucmF0ZShEdXJhdGlvbi5zZWNvbmRzKDMwKSk7XG4gICAgfSkudG9UaHJvdygvJzMwIHNlY29uZHMnIGNhbm5vdCBiZSBjb252ZXJ0ZWQgaW50byBhIHdob2xlIG51bWJlciBvZiBtaW51dGVzLi8pO1xuICB9KTtcblxuICB0ZXN0KCdyYXRlIGNhbm5vdCBiZSBsZXNzIHRoYW4gMSBtaW51dGUgKGRlZmluZWQgd2l0aCBtaW51dGVzIGFzIGZyYWN0aW9ucyknLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGV2ZW50cy5TY2hlZHVsZS5yYXRlKER1cmF0aW9uLm1pbnV0ZXMoMS8yKSk7XG4gICAgfSkudG9UaHJvdygvbXVzdCBiZSBhIHdob2xlIG51bWJlciBvZi8pO1xuICB9KTtcblxuICB0ZXN0KCdyYXRlIGNhbm5vdCBiZSBsZXNzIHRoYW4gMSBtaW51dGUgKGRlZmluZWQgd2l0aCBtaW51dGVzIGFzIGRlY2ltYWxzKScsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgZXZlbnRzLlNjaGVkdWxlLnJhdGUoRHVyYXRpb24ubWludXRlcygwLjI1KSk7XG4gICAgfSkudG9UaHJvdygvbXVzdCBiZSBhIHdob2xlIG51bWJlciBvZi8pO1xuICB9KTtcbn0pOyJdfQ==