"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const ec2 = require("../../aws-ec2");
const elbv2 = require("../../aws-elasticloadbalancingv2");
const ga = require("../../aws-globalaccelerator");
const core_1 = require("../../core");
const endpoints = require("../lib");
let stack;
let vpc;
let accelerator;
let listener;
beforeEach(() => {
    stack = new core_1.Stack();
    vpc = new ec2.Vpc(stack, 'Vpc');
    accelerator = new ga.Accelerator(stack, 'Accelerator');
    listener = accelerator.addListener('Listener', {
        portRanges: [{ fromPort: 80 }],
    });
});
test('Application Load Balancer with all properties', () => {
    // WHEN
    const alb = new elbv2.ApplicationLoadBalancer(stack, 'ALB', { vpc, internetFacing: true });
    listener.addEndpointGroup('Group', {
        endpoints: [
            new endpoints.ApplicationLoadBalancerEndpoint(alb, {
                weight: 50,
                preserveClientIp: true,
            }),
        ],
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::EndpointGroup', {
        EndpointConfigurations: [
            {
                EndpointId: { Ref: 'ALBAEE750D2' },
                Weight: 50,
                ClientIPPreservationEnabled: true,
            },
        ],
    });
});
// Doesn't work yet because 'fromApplicationLoadBalancerAttributes' doesn't set the imported resource env
test('Get region from imported ALB', () => {
    // WHEN
    const alb = elbv2.ApplicationLoadBalancer.fromApplicationLoadBalancerAttributes(stack, 'ALB', {
        loadBalancerArn: 'arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/app/my-load-balancer/50dc6c495c0c9188',
        securityGroupId: 'sg-1234',
    });
    listener.addEndpointGroup('Group', {
        endpoints: [
            new endpoints.ApplicationLoadBalancerEndpoint(alb),
        ],
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::EndpointGroup', {
        EndpointGroupRegion: 'us-west-2',
        EndpointConfigurations: [
            {
                EndpointId: 'arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/app/my-load-balancer/50dc6c495c0c9188',
            },
        ],
    });
});
test('Network Load Balancer with all properties', () => {
    // WHEN
    const nlb = new elbv2.NetworkLoadBalancer(stack, 'NLB', { vpc, internetFacing: true });
    listener.addEndpointGroup('Group', {
        endpoints: [
            new endpoints.NetworkLoadBalancerEndpoint(nlb, {
                weight: 50,
            }),
        ],
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::EndpointGroup', {
        EndpointConfigurations: [
            {
                EndpointId: { Ref: 'NLB55158F82' },
                Weight: 50,
            },
        ],
    });
});
// Doesn't work yet because 'fromNetworkLoadBalancerAttributes' doesn't set the imported resource env
test('Get region from imported NLB', () => {
    // WHEN
    const nlb = elbv2.NetworkLoadBalancer.fromNetworkLoadBalancerAttributes(stack, 'NLB', {
        loadBalancerArn: 'arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/app/my-load-balancer/50dc6c495c0c9188',
    });
    listener.addEndpointGroup('Group', {
        endpoints: [
            new endpoints.NetworkLoadBalancerEndpoint(nlb),
        ],
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::EndpointGroup', {
        EndpointGroupRegion: 'us-west-2',
        EndpointConfigurations: [
            {
                EndpointId: 'arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/app/my-load-balancer/50dc6c495c0c9188',
            },
        ],
    });
});
test('CFN EIP with all properties', () => {
    // WHEN
    const eip = new ec2.CfnEIP(stack, 'ElasticIpAddress');
    listener.addEndpointGroup('Group', {
        endpoints: [
            new endpoints.CfnEipEndpoint(eip, {
                weight: 50,
            }),
        ],
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::EndpointGroup', {
        EndpointConfigurations: [
            {
                EndpointId: { 'Fn::GetAtt': ['ElasticIpAddress', 'AllocationId'] },
                Weight: 50,
            },
        ],
    });
});
test('EC2 Instance with all properties', () => {
    // WHEN
    const instance = new ec2.Instance(stack, 'Instance', {
        vpc,
        machineImage: new ec2.AmazonLinuxImage(),
        instanceType: new ec2.InstanceType('t3.small'),
    });
    listener.addEndpointGroup('Group', {
        endpoints: [
            new endpoints.InstanceEndpoint(instance, {
                weight: 50,
                preserveClientIp: true,
            }),
        ],
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::EndpointGroup', {
        EndpointConfigurations: [
            {
                EndpointId: { Ref: 'InstanceC1063A87' },
                Weight: 50,
                ClientIPPreservationEnabled: true,
            },
        ],
    });
});
test('throws if weight is not in range', () => {
    // WHEN
    const instance = new ec2.Instance(stack, 'Instance', {
        vpc,
        machineImage: new ec2.AmazonLinuxImage(),
        instanceType: new ec2.InstanceType('t3.small'),
    });
    expect(() => {
        listener.addEndpointGroup('Group', {
            endpoints: [
                new endpoints.InstanceEndpoint(instance, {
                    weight: 300,
                    preserveClientIp: true,
                }),
            ],
        });
    }).toThrow(/'weight' must be between 0 and 255/);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5kcG9pbnRzLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJlbmRwb2ludHMudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUE0QztBQUM1QyxxQ0FBcUM7QUFDckMsMERBQTBEO0FBQzFELGtEQUFrRDtBQUNsRCxxQ0FBbUM7QUFDbkMsb0NBQW9DO0FBRXBDLElBQUksS0FBWSxDQUFDO0FBQ2pCLElBQUksR0FBWSxDQUFDO0FBQ2pCLElBQUksV0FBMkIsQ0FBQztBQUNoQyxJQUFJLFFBQXFCLENBQUM7QUFDMUIsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLEtBQUssR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO0lBQ3BCLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBRWhDLFdBQVcsR0FBRyxJQUFJLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ3ZELFFBQVEsR0FBRyxXQUFXLENBQUMsV0FBVyxDQUFDLFVBQVUsRUFBRTtRQUM3QyxVQUFVLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsQ0FBQztLQUMvQixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQywrQ0FBK0MsRUFBRSxHQUFHLEVBQUU7SUFDekQsT0FBTztJQUNQLE1BQU0sR0FBRyxHQUFHLElBQUksS0FBSyxDQUFDLHVCQUF1QixDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsRUFBRSxHQUFHLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFDM0YsUUFBUSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRTtRQUNqQyxTQUFTLEVBQUU7WUFDVCxJQUFJLFNBQVMsQ0FBQywrQkFBK0IsQ0FBQyxHQUFHLEVBQUU7Z0JBQ2pELE1BQU0sRUFBRSxFQUFFO2dCQUNWLGdCQUFnQixFQUFFLElB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QUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHVDQUF1QyxFQUFFO1FBQ3ZGLHNCQUFzQixFQUFFO1lBQ3RCO2dCQUNFLFVBQVUsRUFBRSxFQUFFLEdBQUcsRUFBRSxrQkFBa0IsRUFBRTtnQkFDdkMsTUFBTSxFQUFFLEVBQUU7Z0JBQ1YsMkJBQTJCLEVBQUUsSUFBSTthQUNsQztTQUNGO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsa0NBQWtDLEVBQUUsR0FBRyxFQUFFO0lBQzVDLE9BQU87SUFDUCxNQUFNLFFBQVEsR0FBRyxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLFVBQVUsRUFBRTtRQUNuRCxHQUFHO1FBQ0gsWUFBWSxFQUFFLElBQUksR0FBRyxDQUFDLGdCQUFnQixFQUFFO1FBQ3hDLFlBQVksRUFBRSxJQUFJLEdBQUcsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDO0tBQy9DLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFDVixRQUFRLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFO1lBQ2pDLFNBQVMsRUFBRTtnQkFDVCxJQUFJLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUU7b0JBQ3ZDLE1BQU0sRUFBRSxHQUFHO29CQUNYLGdCQUFnQixFQUFFLElBQUk7aUJBQ3ZCLENBQUM7YUFDSDtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO0FBQ25ELENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVtcGxhdGUgfSBmcm9tICcuLi8uLi9hc3NlcnRpb25zJztcbmltcG9ydCAqIGFzIGVjMiBmcm9tICcuLi8uLi9hd3MtZWMyJztcbmltcG9ydCAqIGFzIGVsYnYyIGZyb20gJy4uLy4uL2F3cy1lbGFzdGljbG9hZGJhbGFuY2luZ3YyJztcbmltcG9ydCAqIGFzIGdhIGZyb20gJy4uLy4uL2F3cy1nbG9iYWxhY2NlbGVyYXRvcic7XG5pbXBvcnQgeyBTdGFjayB9IGZyb20gJy4uLy4uL2NvcmUnO1xuaW1wb3J0ICogYXMgZW5kcG9pbnRzIGZyb20gJy4uL2xpYic7XG5cbmxldCBzdGFjazogU3RhY2s7XG5sZXQgdnBjOiBlYzIuVnBjO1xubGV0IGFjY2VsZXJhdG9yOiBnYS5BY2NlbGVyYXRvcjtcbmxldCBsaXN0ZW5lcjogZ2EuTGlzdGVuZXI7XG5iZWZvcmVFYWNoKCgpID0+IHtcbiAgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgdnBjID0gbmV3IGVjMi5WcGMoc3RhY2ssICdWcGMnKTtcblxuICBhY2NlbGVyYXRvciA9IG5ldyBnYS5BY2NlbGVyYXRvcihzdGFjaywgJ0FjY2VsZXJhdG9yJyk7XG4gIGxpc3RlbmVyID0gYWNjZWxlcmF0b3IuYWRkTGlzdGVuZXIoJ0xpc3RlbmVyJywge1xuICAgIHBvcnRSYW5nZXM6IFt7IGZyb21Qb3J0OiA4MCB9XSxcbiAgfSk7XG59KTtcblxudGVzdCgnQXBwbGljYXRpb24gTG9hZCBCYWxhbmNlciB3aXRoIGFsbCBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGFsYiA9IG5ldyBlbGJ2Mi5BcHBsaWNhdGlvbkxvYWRCYWxhbmNlcihzdGFjaywgJ0FMQicsIHsgdnBjLCBpbnRlcm5ldEZhY2luZzogdHJ1ZSB9KTtcbiAgbGlzdGVuZXIuYWRkRW5kcG9pbnRHcm91cCgnR3JvdXAnLCB7XG4gICAgZW5kcG9pbnRzOiBbXG4gICAgICBuZXcgZW5kcG9pbnRzLkFwcGxpY2F0aW9uTG9hZEJhbGFuY2VyRW5kcG9pbnQoYWxiLCB7XG4gICAgICAgIHdlaWdodDogNTAsXG4gICAgICAgIHByZXNlcnZlQ2xpZW50SXA6IHRydWUsXG4gICAgICB9KSxcbiAgICBdLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6Okdsb2JhbEFjY2VsZXJhdG9yOjpFbmRwb2ludEdyb3VwJywge1xuICAgIEVuZHBvaW50Q29uZmlndXJhdGlvbnM6IFtcbiAgICAgIHtcbiAgICAgICAgRW5kcG9pbnRJZDogeyBSZWY6ICdBTEJBRUU3NTBEMicgfSxcbiAgICAgICAgV2VpZ2h0OiA1MCxcbiAgICAgICAgQ2xpZW50SVBQcmVzZXJ2YXRpb25FbmFibGVkOiB0cnVlLFxuICAgICAgfSxcbiAgICBdLFxuICB9KTtcbn0pO1xuXG4vLyBEb2Vzbid0IHdvcmsgeWV0IGJlY2F1c2UgJ2Zyb21BcHBsaWNhdGlvbkxvYWRCYWxhbmNlckF0dHJpYnV0ZXMnIGRvZXNuJ3Qgc2V0IHRoZSBpbXBvcnRlZCByZXNvdXJjZSBlbnZcbnRlc3QoJ0dldCByZWdpb24gZnJvbSBpbXBvcnRlZCBBTEInLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgYWxiID0gZWxidjIuQXBwbGljYXRpb25Mb2FkQmFsYW5jZXIuZnJvbUFwcGxpY2F0aW9uTG9hZEJhbGFuY2VyQXR0cmlidXRlcyhzdGFjaywgJ0FMQicsIHtcbiAgICBsb2FkQmFsYW5jZXJBcm46ICdhcm46YXdzOmVsYXN0aWNsb2FkYmFsYW5jaW5nOnVzLXdlc3QtMjoxMjM0NTY3ODkwMTI6bG9hZGJhbGFuY2VyL2FwcC9teS1sb2FkLWJhbGFuY2VyLzUwZGM2YzQ5NWMwYzkxODgnLFxuICAgIHNlY3VyaXR5R3JvdXBJZDogJ3NnLTEyMzQnLFxuICB9KTtcbiAgbGlzdGVuZXIuYWRkRW5kcG9pbnRHcm91cCgnR3JvdXAnLCB7XG4gICAgZW5kcG9pbnRzOiBbXG4gICAgICBuZXcgZW5kcG9pbnRzLkFwcGxpY2F0aW9uTG9hZEJhbGFuY2VyRW5kcG9pbnQoYWxiKSxcbiAgICBdLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6Okdsb2JhbEFjY2VsZXJhdG9yOjpFbmRwb2ludEdyb3VwJywge1xuICAgIEVuZHBvaW50R3JvdXBSZWdpb246ICd1cy13ZXN0LTInLFxuICAgIEVuZHBvaW50Q29uZmlndXJhdGlvbnM6IFtcbiAgICAgIHtcbiAgICAgICAgRW5kcG9pbnRJZDogJ2Fybjphd3M6ZWxhc3RpY2xvYWRiYWxhbmNpbmc6dXMtd2VzdC0yOjEyMzQ1Njc4OTAxMjpsb2FkYmFsYW5jZXIvYXBwL215LWxvYWQtYmFsYW5jZXIvNTBkYzZjNDk1YzBjOTE4OCcsXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ05ldHdvcmsgTG9hZCBCYWxhbmNlciB3aXRoIGFsbCBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IG5sYiA9IG5ldyBlbGJ2Mi5OZXR3b3JrTG9hZEJhbGFuY2VyKHN0YWNrLCAnTkxCJywgeyB2cGMsIGludGVybmV0RmFjaW5nOiB0cnVlIH0pO1xuICBsaXN0ZW5lci5hZGRFbmRwb2ludEdyb3VwKCdHcm91cCcsIHtcbiAgICBlbmRwb2ludHM6IFtcbiAgICAgIG5ldyBlbmRwb2ludHMuTmV0d29ya0xvYWRCYWxhbmNlckVuZHBvaW50KG5sYiwge1xuICAgICAgICB3ZWlnaHQ6IDUwLFxuICAgICAgfSksXG4gICAgXSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpHbG9iYWxBY2NlbGVyYXRvcjo6RW5kcG9pbnRHcm91cCcsIHtcbiAgICBFbmRwb2ludENvbmZpZ3VyYXRpb25zOiBbXG4gICAgICB7XG4gICAgICAgIEVuZHBvaW50SWQ6IHsgUmVmOiAnTkxCNTUxNThGODInIH0sXG4gICAgICAgIFdlaWdodDogNTAsXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbi8vIERvZXNuJ3Qgd29yayB5ZXQgYmVjYXVzZSAnZnJvbU5ldHdvcmtMb2FkQmFsYW5jZXJBdHRyaWJ1dGVzJyBkb2Vzbid0IHNldCB0aGUgaW1wb3J0ZWQgcmVzb3VyY2UgZW52XG50ZXN0KCdHZXQgcmVnaW9uIGZyb20gaW1wb3J0ZWQgTkxCJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IG5sYiA9IGVsYnYyLk5ldHdvcmtMb2FkQmFsYW5jZXIuZnJvbU5ldHdvcmtMb2FkQmFsYW5jZXJBdHRyaWJ1dGVzKHN0YWNrLCAnTkxCJywge1xuICAgIGxvYWRCYWxhbmNlckFybjogJ2Fybjphd3M6ZWxhc3RpY2xvYWRiYWxhbmNpbmc6dXMtd2VzdC0yOjEyMzQ1Njc4OTAxMjpsb2FkYmFsYW5jZXIvYXBwL215LWxvYWQtYmFsYW5jZXIvNTBkYzZjNDk1YzBjOTE4OCcsXG4gIH0pO1xuICBsaXN0ZW5lci5hZGRFbmRwb2ludEdyb3VwKCdHcm91cCcsIHtcbiAgICBlbmRwb2ludHM6IFtcbiAgICAgIG5ldyBlbmRwb2ludHMuTmV0d29ya0xvYWRCYWxhbmNlckVuZHBvaW50KG5sYiksXG4gICAgXSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpHbG9iYWxBY2NlbGVyYXRvcjo6RW5kcG9pbnRHcm91cCcsIHtcbiAgICBFbmRwb2ludEdyb3VwUmVnaW9uOiAndXMtd2VzdC0yJyxcbiAgICBFbmRwb2ludENvbmZpZ3VyYXRpb25zOiBbXG4gICAgICB7XG4gICAgICAgIEVuZHBvaW50SWQ6ICdhcm46YXdzOmVsYXN0aWNsb2FkYmFsYW5jaW5nOnVzLXdlc3QtMjoxMjM0NTY3ODkwMTI6bG9hZGJhbGFuY2VyL2FwcC9teS1sb2FkLWJhbGFuY2VyLzUwZGM2YzQ5NWMwYzkxODgnLFxuICAgICAgfSxcbiAgICBdLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdDRk4gRUlQIHdpdGggYWxsIHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgZWlwID0gbmV3IGVjMi5DZm5FSVAoc3RhY2ssICdFbGFzdGljSXBBZGRyZXNzJyk7XG4gIGxpc3RlbmVyLmFkZEVuZHBvaW50R3JvdXAoJ0dyb3VwJywge1xuICAgIGVuZHBvaW50czogW1xuICAgICAgbmV3IGVuZHBvaW50cy5DZm5FaXBFbmRwb2ludChlaXAsIHtcbiAgICAgICAgd2VpZ2h0OiA1MCxcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6R2xvYmFsQWNjZWxlcmF0b3I6OkVuZHBvaW50R3JvdXAnLCB7XG4gICAgRW5kcG9pbnRDb25maWd1cmF0aW9uczogW1xuICAgICAge1xuICAgICAgICBFbmRwb2ludElkOiB7ICdGbjo6R2V0QXR0JzogWydFbGFzdGljSXBBZGRyZXNzJywgJ0FsbG9jYXRpb25JZCddIH0sXG4gICAgICAgIFdlaWdodDogNTAsXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ0VDMiBJbnN0YW5jZSB3aXRoIGFsbCBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGluc3RhbmNlID0gbmV3IGVjMi5JbnN0YW5jZShzdGFjaywgJ0luc3RhbmNlJywge1xuICAgIHZwYyxcbiAgICBtYWNoaW5lSW1hZ2U6IG5ldyBlYzIuQW1hem9uTGludXhJbWFnZSgpLFxuICAgIGluc3RhbmNlVHlwZTogbmV3IGVjMi5JbnN0YW5jZVR5cGUoJ3QzLnNtYWxsJyksXG4gIH0pO1xuICBsaXN0ZW5lci5hZGRFbmRwb2ludEdyb3VwKCdHcm91cCcsIHtcbiAgICBlbmRwb2ludHM6IFtcbiAgICAgIG5ldyBlbmRwb2ludHMuSW5zdGFuY2VFbmRwb2ludChpbnN0YW5jZSwge1xuICAgICAgICB3ZWlnaHQ6IDUwLFxuICAgICAgICBwcmVzZXJ2ZUNsaWVudElwOiB0cnVlLFxuICAgICAgfSksXG4gICAgXSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpHbG9iYWxBY2NlbGVyYXRvcjo6RW5kcG9pbnRHcm91cCcsIHtcbiAgICBFbmRwb2ludENvbmZpZ3VyYXRpb25zOiBbXG4gICAgICB7XG4gICAgICAgIEVuZHBvaW50SWQ6IHsgUmVmOiAnSW5zdGFuY2VDMTA2M0E4NycgfSxcbiAgICAgICAgV2VpZ2h0OiA1MCxcbiAgICAgICAgQ2xpZW50SVBQcmVzZXJ2YXRpb25FbmFibGVkOiB0cnVlLFxuICAgICAgfSxcbiAgICBdLFxuICB9KTtcbn0pO1xuXG50ZXN0KCd0aHJvd3MgaWYgd2VpZ2h0IGlzIG5vdCBpbiByYW5nZScsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBpbnN0YW5jZSA9IG5ldyBlYzIuSW5zdGFuY2Uoc3RhY2ssICdJbnN0YW5jZScsIHtcbiAgICB2cGMsXG4gICAgbWFjaGluZUltYWdlOiBuZXcgZWMyLkFtYXpvbkxpbnV4SW1hZ2UoKSxcbiAgICBpbnN0YW5jZVR5cGU6IG5ldyBlYzIuSW5zdGFuY2VUeXBlKCd0My5zbWFsbCcpLFxuICB9KTtcblxuICBleHBlY3QoKCkgPT4ge1xuICAgIGxpc3RlbmVyLmFkZEVuZHBvaW50R3JvdXAoJ0dyb3VwJywge1xuICAgICAgZW5kcG9pbnRzOiBbXG4gICAgICAgIG5ldyBlbmRwb2ludHMuSW5zdGFuY2VFbmRwb2ludChpbnN0YW5jZSwge1xuICAgICAgICAgIHdlaWdodDogMzAwLFxuICAgICAgICAgIHByZXNlcnZlQ2xpZW50SXA6IHRydWUsXG4gICAgICAgIH0pLFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSkudG9UaHJvdygvJ3dlaWdodCcgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDI1NS8pO1xufSk7XG4iXX0=