"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const core_1 = require("../../core");
const util_1 = require("./util");
const ga = require("../lib");
test('create accelerator', () => {
    // GIVEN
    const { stack } = (0, util_1.testFixture)();
    // WHEN
    new ga.Accelerator(stack, 'Accelerator');
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::Accelerator', {
        Enabled: true,
    });
});
test('create listener', () => {
    // GIVEN
    const { stack } = (0, util_1.testFixture)();
    // WHEN
    const accelerator = new ga.Accelerator(stack, 'Accelerator');
    new ga.Listener(stack, 'Listener', {
        accelerator,
        portRanges: [
            {
                fromPort: 80,
                toPort: 80,
            },
        ],
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::Listener', {
        AcceleratorArn: {
            'Fn::GetAtt': [
                'Accelerator8EB0B6B1',
                'AcceleratorArn',
            ],
        },
        PortRanges: [
            {
                FromPort: 80,
                ToPort: 80,
            },
        ],
        Protocol: 'TCP',
        ClientAffinity: 'NONE',
    });
});
test('toPort defaults to fromPort if left out', () => {
    // GIVEN
    const { stack } = (0, util_1.testFixture)();
    // WHEN
    const accelerator = new ga.Accelerator(stack, 'Accelerator');
    accelerator.addListener('Listener', {
        portRanges: [
            { fromPort: 123 },
        ],
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::Listener', {
        PortRanges: [
            {
                FromPort: 123,
                ToPort: 123,
            },
        ],
    });
});
test('create endpointgroup', () => {
    // GIVEN
    const { stack } = (0, util_1.testFixture)();
    // WHEN
    const accelerator = new ga.Accelerator(stack, 'Accelerator');
    const listener = new ga.Listener(stack, 'Listener', {
        accelerator,
        portRanges: [
            {
                fromPort: 80,
                toPort: 80,
            },
        ],
    });
    new ga.EndpointGroup(stack, 'Group', { listener });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::EndpointGroup', {
        EndpointGroupRegion: {
            Ref: 'AWS::Region',
        },
        ListenerArn: {
            'Fn::GetAtt': [
                'Listener828B0E81',
                'ListenerArn',
            ],
        },
    });
});
test('endpointgroup region is the first endpoint\'s region', () => {
    // GIVEN
    const { stack } = (0, util_1.testFixture)();
    // WHEN
    const accelerator = new ga.Accelerator(stack, 'Accelerator');
    const listener = new ga.Listener(stack, 'Listener', {
        accelerator,
        portRanges: [{ fromPort: 80 }],
    });
    listener.addEndpointGroup('Group', {
        endpoints: [
            new ga.RawEndpoint({
                endpointId: 'x-123',
                region: 'us-bla-5',
            }),
        ],
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::EndpointGroup', {
        EndpointGroupRegion: 'us-bla-5',
    });
});
test('endpointgroup with all parameters', () => {
    // GIVEN
    const { stack } = (0, util_1.testFixture)();
    // WHEN
    const accelerator = new ga.Accelerator(stack, 'Accelerator');
    const listener = accelerator.addListener('Listener', {
        portRanges: [{ fromPort: 80 }],
    });
    listener.addEndpointGroup('Group', {
        region: 'us-bla-5',
        healthCheckInterval: core_1.Duration.seconds(10),
        healthCheckPath: '/ping',
        healthCheckPort: 123,
        healthCheckProtocol: ga.HealthCheckProtocol.HTTPS,
        healthCheckThreshold: 23,
        trafficDialPercentage: 86,
        portOverrides: [
            {
                listenerPort: 80,
                endpointPort: 8080,
            },
        ],
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::EndpointGroup', {
        EndpointGroupRegion: 'us-bla-5',
        HealthCheckIntervalSeconds: 10,
        HealthCheckPath: '/ping',
        HealthCheckPort: 123,
        HealthCheckProtocol: 'HTTPS',
        PortOverrides: [
            {
                EndpointPort: 8080,
                ListenerPort: 80,
            },
        ],
        ThresholdCount: 23,
        TrafficDialPercentage: 86,
    });
});
test('addEndpoint', () => {
    // GIVEN
    const { stack } = (0, util_1.testFixture)();
    // WHEN
    const accelerator = new ga.Accelerator(stack, 'Accelerator');
    const listener = new ga.Listener(stack, 'Listener', {
        accelerator,
        portRanges: [
            {
                fromPort: 80,
                toPort: 80,
            },
        ],
    });
    listener.addEndpointGroup('Group', {
        endpoints: [
            new ga.RawEndpoint({
                endpointId: 'i-123',
                preserveClientIp: true,
                weight: 30,
            }),
        ],
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::EndpointGroup', {
        EndpointConfigurations: [
            {
                EndpointId: 'i-123',
                ClientIPPreservationEnabled: true,
                Weight: 30,
            },
        ],
    });
});
test('create accelerator with uniqueResourceName if acceleratorName is not specified', () => {
    // GIVEN
    const { stack } = (0, util_1.testFixture)();
    // WHEN
    new ga.Accelerator(stack, 'Accelerator');
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::GlobalAccelerator::Accelerator', {
        Enabled: true,
        Name: 'StackAccelerator472129D8',
    });
});
test('should validate acceleratorName minimum and maximum length', () => {
    const { stack } = (0, util_1.testFixture)();
    expect(() => {
        new ga.Accelerator(stack, 'AcceleratorShort', {
            acceleratorName: '',
        });
    }).toThrowError(/must have length between 1 and 64/);
    expect(() => {
        new ga.Accelerator(stack, 'AcceleratorLong', {
            acceleratorName: 'a'.repeat(100),
        });
    }).toThrowError(/must have length between 1 and 64/);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsYWNjZWxlcmF0b3IudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdsb2JhbGFjY2VsZXJhdG9yLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBNEM7QUFDNUMscUNBQXNDO0FBQ3RDLGlDQUFxQztBQUNyQyw2QkFBNkI7QUFFN0IsSUFBSSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUM5QixRQUFRO0lBQ1IsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLElBQUEsa0JBQVcsR0FBRSxDQUFDO0lBRWhDLE9BQU87SUFDUCxJQUFJLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBRXpDLE9BQU87SUFDUCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxxQ0FBcUMsRUFBRTtRQUNyRixPQUFPLEVBQUUsSUFBSTtLQUNkLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMzQixRQUFRO0lBQ1IsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLElBQUEsa0JBQVcsR0FBRSxDQUFDO0lBRWhDLE9BQU87SUFDUCxNQUFNLFdBQVcsR0FBRyxJQUFJLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQzdELElBQUksRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsVUFBVSxFQUFFO1FBQ2pDLFdBQVc7UUFDWCxVQUFVLEVBQUU7WUFDVjtnQkFDRSxRQUFRLEVBQUUsRUFBRTtnQkFDWixNQUFNLEVBQUUsRUFBRTthQUNYO1NBQ0Y7S0FDRixDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMsa0NBQWtDLEVBQUU7UUFDbEYsY0FBYyxFQUFFO1lB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O0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsZ0ZBQWdGLEVBQUUsR0FBRyxFQUFFO0lBQzFGLFFBQVE7SUFDUixNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsSUFBQSxrQkFBVyxHQUFFLENBQUM7SUFFaEMsT0FBTztJQUNQLElBQUksRUFBRSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUM7SUFFekMsT0FBTztJQUNQLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHFDQUFxQyxFQUFFO1FBQ3JGLE9BQU8sRUFBRSxJQUFJO1FBQ2IsSUFBSSxFQUFFLDBCQUEwQjtLQUNqQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyw0REFBNEQsRUFBRSxHQUFHLEVBQUU7SUFDdEUsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLElBQUEsa0JBQVcsR0FBRSxDQUFDO0lBRWhDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFDVixJQUFJLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLGtCQUFrQixFQUFFO1lBQzVDLGVBQWUsRUFBRSxFQUFFO1NBQ3BCLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO0lBQ3JELE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFDVixJQUFJLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLGlCQUFpQixFQUFFO1lBQzNDLGVBQWUsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQztTQUNqQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsbUNBQW1DLENBQUMsQ0FBQztBQUN2RCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgeyBEdXJhdGlvbiB9IGZyb20gJy4uLy4uL2NvcmUnO1xuaW1wb3J0IHsgdGVzdEZpeHR1cmUgfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0ICogYXMgZ2EgZnJvbSAnLi4vbGliJztcblxudGVzdCgnY3JlYXRlIGFjY2VsZXJhdG9yJywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCB7IHN0YWNrIH0gPSB0ZXN0Rml4dHVyZSgpO1xuXG4gIC8vIFdIRU5cbiAgbmV3IGdhLkFjY2VsZXJhdG9yKHN0YWNrLCAnQWNjZWxlcmF0b3InKTtcblxuICAvLyBUSEVOXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6Okdsb2JhbEFjY2VsZXJhdG9yOjpBY2NlbGVyYXRvcicsIHtcbiAgICBFbmFibGVkOiB0cnVlLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdjcmVhdGUgbGlzdGVuZXInLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHsgc3RhY2sgfSA9IHRlc3RGaXh0dXJlKCk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCBhY2NlbGVyYXRvciA9IG5ldyBnYS5BY2NlbGVyYXRvcihzdGFjaywgJ0FjY2VsZXJhdG9yJyk7XG4gIG5ldyBnYS5MaXN0ZW5lcihzdGFjaywgJ0xpc3RlbmVyJywge1xuICAgIGFjY2VsZXJhdG9yLFxuICAgIHBvcnRSYW5nZXM6IFtcbiAgICAgIHtcbiAgICAgICAgZnJvbVBvcnQ6IDgwLFxuICAgICAgICB0b1BvcnQ6IDgwLFxuICAgICAgfSxcbiAgICBdLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6Okdsb2JhbEFjY2VsZXJhdG9yOjpMaXN0ZW5lcicsIHtcbiAgICBBY2NlbGVyYXRvckFybjoge1xuICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICdBY2NlbGVyYXRvcjhFQjBCNkIxJyxcbiAgICAgICAgJ0FjY2VsZXJhdG9yQXJuJyxcbiAgICAgIF0sXG4gICAgfSxcbiAgICBQb3J0UmFuZ2VzOiBbXG4gICAgICB7XG4gICAgICAgIEZyb21Qb3J0OiA4MCxcbiAgICAgICAgVG9Qb3J0OiA4MCxcbiAgICAgIH0sXG4gICAgXSxcbiAgICBQcm90b2NvbDogJ1RDUCcsXG4gICAgQ2xpZW50QWZmaW5pdHk6ICdOT05FJyxcbiAgfSk7XG59KTtcblxudGVzdCgndG9Qb3J0IGRlZmF1bHRzIHRvIGZyb21Qb3J0IGlmIGxlZnQgb3V0JywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCB7IHN0YWNrIH0gPSB0ZXN0Rml4dHVyZSgpO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgYWNjZWxlcmF0b3IgPSBuZXcgZ2EuQWNjZWxlcmF0b3Ioc3RhY2ssICdBY2NlbGVyYXRvcicpO1xuICBhY2NlbGVyYXRvci5hZGRMaXN0ZW5lcignTGlzdGVuZXInLCB7XG4gICAgcG9ydFJhbmdlczogW1xuICAgICAgeyBmcm9tUG9ydDogMTIzIH0sXG4gICAgXSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpHbG9iYWxBY2NlbGVyYXRvcjo6TGlzdGVuZXInLCB7XG4gICAgUG9ydFJhbmdlczogW1xuICAgICAge1xuICAgICAgICBGcm9tUG9ydDogMTIzLFxuICAgICAgICBUb1BvcnQ6IDEyMyxcbiAgICAgIH0sXG4gICAgXSxcbiAgfSk7XG59KTtcblxudGVzdCgnY3JlYXRlIGVuZHBvaW50Z3JvdXAnLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHsgc3RhY2sgfSA9IHRlc3RGaXh0dXJlKCk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCBhY2NlbGVyYXRvciA9IG5ldyBnYS5BY2NlbGVyYXRvcihzdGFjaywgJ0FjY2VsZXJhdG9yJyk7XG4gIGNvbnN0IGxpc3RlbmVyID0gbmV3IGdhLkxpc3RlbmVyKHN0YWNrLCAnTGlzdGVuZXInLCB7XG4gICAgYWNjZWxlcmF0b3IsXG4gICAgcG9ydFJhbmdlczogW1xuICAgICAge1xuICAgICAgICBmcm9tUG9ydDogODAsXG4gICAgICAgIHRvUG9ydDogODAsXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xuICBuZXcgZ2EuRW5kcG9pbnRHcm91cChzdGFjaywgJ0dyb3VwJywgeyBsaXN0ZW5lciB9KTtcblxuICAvLyBUSEVOXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6Okdsb2JhbEFjY2VsZXJhdG9yOjpFbmRwb2ludEdyb3VwJywge1xuICAgIEVuZHBvaW50R3JvdXBSZWdpb246IHtcbiAgICAgIFJlZjogJ0FXUzo6UmVnaW9uJyxcbiAgICB9LFxuICAgIExpc3RlbmVyQXJuOiB7XG4gICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgJ0xpc3RlbmVyODI4QjBFODEnLFxuICAgICAgICAnTGlzdGVuZXJBcm4nLFxuICAgICAgXSxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCdlbmRwb2ludGdyb3VwIHJlZ2lvbiBpcyB0aGUgZmlyc3QgZW5kcG9pbnRcXCdzIHJlZ2lvbicsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgeyBzdGFjayB9ID0gdGVzdEZpeHR1cmUoKTtcblxuICAvLyBXSEVOXG4gIGNvbnN0IGFjY2VsZXJhdG9yID0gbmV3IGdhLkFjY2VsZXJhdG9yKHN0YWNrLCAnQWNjZWxlcmF0b3InKTtcbiAgY29uc3QgbGlzdGVuZXIgPSBuZXcgZ2EuTGlzdGVuZXIoc3RhY2ssICdMaXN0ZW5lcicsIHtcbiAgICBhY2NlbGVyYXRvcixcbiAgICBwb3J0UmFuZ2VzOiBbeyBmcm9tUG9ydDogODAgfV0sXG4gIH0pO1xuICBsaXN0ZW5lci5hZGRFbmRwb2ludEdyb3VwKCdHcm91cCcsIHtcbiAgICBlbmRwb2ludHM6IFtcbiAgICAgIG5ldyBnYS5SYXdFbmRwb2ludCh7XG4gICAgICAgIGVuZHBvaW50SWQ6ICd4LTEyMycsXG4gICAgICAgIHJlZ2lvbjogJ3VzLWJsYS01JyxcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6R2xvYmFsQWNjZWxlcmF0b3I6OkVuZHBvaW50R3JvdXAnLCB7XG4gICAgRW5kcG9pbnRHcm91cFJlZ2lvbjogJ3VzLWJsYS01JyxcbiAgfSk7XG59KTtcblxudGVzdCgnZW5kcG9pbnRncm91cCB3aXRoIGFsbCBwYXJhbWV0ZXJzJywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCB7IHN0YWNrIH0gPSB0ZXN0Rml4dHVyZSgpO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgYWNjZWxlcmF0b3IgPSBuZXcgZ2EuQWNjZWxlcmF0b3Ioc3RhY2ssICdBY2NlbGVyYXRvcicpO1xuICBjb25zdCBsaXN0ZW5lciA9IGFjY2VsZXJhdG9yLmFkZExpc3RlbmVyKCdMaXN0ZW5lcicsIHtcbiAgICBwb3J0UmFuZ2VzOiBbeyBmcm9tUG9ydDogODAgfV0sXG4gIH0pO1xuICBsaXN0ZW5lci5hZGRFbmRwb2ludEdyb3VwKCdHcm91cCcsIHtcbiAgICByZWdpb246ICd1cy1ibGEtNScsXG4gICAgaGVhbHRoQ2hlY2tJbnRlcnZhbDogRHVyYXRpb24uc2Vjb25kcygxMCksXG4gICAgaGVhbHRoQ2hlY2tQYXRoOiAnL3BpbmcnLFxuICAgIGhlYWx0aENoZWNrUG9ydDogMTIzLFxuICAgIGhlYWx0aENoZWNrUHJvdG9jb2w6IGdhLkhlYWx0aENoZWNrUHJvdG9jb2wuSFRUUFMsXG4gICAgaGVhbHRoQ2hlY2tUaHJlc2hvbGQ6IDIzLFxuICAgIHRyYWZmaWNEaWFsUGVyY2VudGFnZTogODYsXG4gICAgcG9ydE92ZXJyaWRlczogW1xuICAgICAge1xuICAgICAgICBsaXN0ZW5lclBvcnQ6IDgwLFxuICAgICAgICBlbmRwb2ludFBvcnQ6IDgwODAsXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6R2xvYmFsQWNjZWxlcmF0b3I6OkVuZHBvaW50R3JvdXAnLCB7XG4gICAgRW5kcG9pbnRHcm91cFJlZ2lvbjogJ3VzLWJsYS01JyxcbiAgICBIZWFsdGhDaGVja0ludGVydmFsU2Vjb25kczogMTAsXG4gICAgSGVhbHRoQ2hlY2tQYXRoOiAnL3BpbmcnLFxuICAgIEhlYWx0aENoZWNrUG9ydDogMTIzLFxuICAgIEhlYWx0aENoZWNrUHJvdG9jb2w6ICdIVFRQUycsXG4gICAgUG9ydE92ZXJyaWRlczogW1xuICAgICAge1xuICAgICAgICBFbmRwb2ludFBvcnQ6IDgwODAsXG4gICAgICAgIExpc3RlbmVyUG9ydDogODAsXG4gICAgICB9LFxuICAgIF0sXG4gICAgVGhyZXNob2xkQ291bnQ6IDIzLFxuICAgIFRyYWZmaWNEaWFsUGVyY2VudGFnZTogODYsXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2FkZEVuZHBvaW50JywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCB7IHN0YWNrIH0gPSB0ZXN0Rml4dHVyZSgpO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgYWNjZWxlcmF0b3IgPSBuZXcgZ2EuQWNjZWxlcmF0b3Ioc3RhY2ssICdBY2NlbGVyYXRvcicpO1xuICBjb25zdCBsaXN0ZW5lciA9IG5ldyBnYS5MaXN0ZW5lcihzdGFjaywgJ0xpc3RlbmVyJywge1xuICAgIGFjY2VsZXJhdG9yLFxuICAgIHBvcnRSYW5nZXM6IFtcbiAgICAgIHtcbiAgICAgICAgZnJvbVBvcnQ6IDgwLFxuICAgICAgICB0b1BvcnQ6IDgwLFxuICAgICAgfSxcbiAgICBdLFxuICB9KTtcblxuXG4gIGxpc3RlbmVyLmFkZEVuZHBvaW50R3JvdXAoJ0dyb3VwJywge1xuICAgIGVuZHBvaW50czogW1xuICAgICAgbmV3IGdhLlJhd0VuZHBvaW50KHtcbiAgICAgICAgZW5kcG9pbnRJZDogJ2ktMTIzJyxcbiAgICAgICAgcHJlc2VydmVDbGllbnRJcDogdHJ1ZSxcbiAgICAgICAgd2VpZ2h0OiAzMCxcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6R2xvYmFsQWNjZWxlcmF0b3I6OkVuZHBvaW50R3JvdXAnLCB7XG4gICAgRW5kcG9pbnRDb25maWd1cmF0aW9uczogW1xuICAgICAge1xuICAgICAgICBFbmRwb2ludElkOiAnaS0xMjMnLFxuICAgICAgICBDbGllbnRJUFByZXNlcnZhdGlvbkVuYWJsZWQ6IHRydWUsXG4gICAgICAgIFdlaWdodDogMzAsXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2NyZWF0ZSBhY2NlbGVyYXRvciB3aXRoIHVuaXF1ZVJlc291cmNlTmFtZSBpZiBhY2NlbGVyYXRvck5hbWUgaXMgbm90IHNwZWNpZmllZCcsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgeyBzdGFjayB9ID0gdGVzdEZpeHR1cmUoKTtcblxuICAvLyBXSEVOXG4gIG5ldyBnYS5BY2NlbGVyYXRvcihzdGFjaywgJ0FjY2VsZXJhdG9yJyk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpHbG9iYWxBY2NlbGVyYXRvcjo6QWNjZWxlcmF0b3InLCB7XG4gICAgRW5hYmxlZDogdHJ1ZSxcbiAgICBOYW1lOiAnU3RhY2tBY2NlbGVyYXRvcjQ3MjEyOUQ4JyxcbiAgfSk7XG59KTtcblxudGVzdCgnc2hvdWxkIHZhbGlkYXRlIGFjY2VsZXJhdG9yTmFtZSBtaW5pbXVtIGFuZCBtYXhpbXVtIGxlbmd0aCcsICgpID0+IHtcbiAgY29uc3QgeyBzdGFjayB9ID0gdGVzdEZpeHR1cmUoKTtcblxuICBleHBlY3QoKCkgPT4ge1xuICAgIG5ldyBnYS5BY2NlbGVyYXRvcihzdGFjaywgJ0FjY2VsZXJhdG9yU2hvcnQnLCB7XG4gICAgICBhY2NlbGVyYXRvck5hbWU6ICcnLFxuICAgIH0pO1xuICB9KS50b1Rocm93RXJyb3IoL211c3QgaGF2ZSBsZW5ndGggYmV0d2VlbiAxIGFuZCA2NC8pO1xuICBleHBlY3QoKCkgPT4ge1xuICAgIG5ldyBnYS5BY2NlbGVyYXRvcihzdGFjaywgJ0FjY2VsZXJhdG9yTG9uZycsIHtcbiAgICAgIGFjY2VsZXJhdG9yTmFtZTogJ2EnLnJlcGVhdCgxMDApLFxuICAgIH0pO1xuICB9KS50b1Rocm93RXJyb3IoL211c3QgaGF2ZSBsZW5ndGggYmV0d2VlbiAxIGFuZCA2NC8pO1xufSk7XG4iXX0=