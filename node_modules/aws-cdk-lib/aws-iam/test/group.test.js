"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const core_1 = require("../../core");
const lib_1 = require("../lib");
describe('IAM groups', () => {
    test('default group', () => {
        const app = new core_1.App();
        const stack = new core_1.Stack(app, 'MyStack');
        new lib_1.Group(stack, 'MyGroup');
        assertions_1.Template.fromStack(stack).templateMatches({
            Resources: { MyGroupCBA54B1B: { Type: 'AWS::IAM::Group' } },
        });
    });
    test('users can be added to the group either via `user.addToGroup` or `group.addUser`', () => {
        const app = new core_1.App();
        const stack = new core_1.Stack(app, 'MyStack');
        const group = new lib_1.Group(stack, 'MyGroup');
        const user1 = new lib_1.User(stack, 'User1');
        const user2 = new lib_1.User(stack, 'User2');
        user1.addToGroup(group);
        group.addUser(user2);
        assertions_1.Template.fromStack(stack).templateMatches({
            Resources: {
                MyGroupCBA54B1B: { Type: 'AWS::IAM::Group' },
                User1E278A736: {
                    Type: 'AWS::IAM::User',
                    Properties: { Groups: [{ Ref: 'MyGroupCBA54B1B' }] },
                },
                User21F1486D1: {
                    Type: 'AWS::IAM::User',
                    Properties: { Groups: [{ Ref: 'MyGroupCBA54B1B' }] },
                },
            },
        });
    });
    test('create with managed policy', () => {
        // GIVEN
        const stack = new core_1.Stack();
        // WHEN
        new lib_1.Group(stack, 'MyGroup', {
            managedPolicies: [lib_1.ManagedPolicy.fromAwsManagedPolicyName('asdf')],
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Group', {
            ManagedPolicyArns: [
                { 'Fn::Join': ['', ['arn:', { Ref: 'AWS::Partition' }, ':iam::aws:policy/asdf']] },
            ],
        });
    });
    test('groups imported by group name have valid arn', () => {
        // GIVEN
        const stack = new core_1.Stack();
        // WHEN
        const group1 = lib_1.Group.fromGroupName(stack, 'imported-group1', 'MyGroupName1');
        const group2 = lib_1.Group.fromGroupName(stack, 'imported-group2', 'division/MyGroupName2');
        // THEN
        expect(stack.resolve(group1.groupArn)).toStrictEqual({
            'Fn::Join': ['', ['arn:', { Ref: 'AWS::Partition' }, ':iam::', { Ref: 'AWS::AccountId' }, ':group/MyGroupName1']],
        });
        expect(stack.resolve(group2.groupArn)).toStrictEqual({
            'Fn::Join': ['', ['arn:', { Ref: 'AWS::Partition' }, ':iam::', { Ref: 'AWS::AccountId' }, ':group/division/MyGroupName2']],
        });
    });
});
test('cross-env group ARNs include path', () => {
    const app = new core_1.App();
    const groupStack = new core_1.Stack(app, 'group-stack', { env: { account: '123456789012', region: 'us-east-1' } });
    const referencerStack = new core_1.Stack(app, 'referencer-stack', { env: { region: 'us-east-2' } });
    const group = new lib_1.Group(groupStack, 'Group', {
        path: '/sample/path/',
        groupName: 'sample-name',
    });
    new core_1.CfnResource(referencerStack, 'Referencer', {
        type: 'Custom::GroupReferencer',
        properties: { GroupArn: group.groupArn },
    });
    assertions_1.Template.fromStack(referencerStack).hasResourceProperties('Custom::GroupReferencer', {
        GroupArn: {
            'Fn::Join': [
                '',
                [
                    'arn:',
                    {
                        Ref: 'AWS::Partition',
                    },
                    ':iam::123456789012:group/sample/path/sample-name',
                ],
            ],
        },
    });
});
test('throw warning if attached managed policies exceed 10 in constructor', () => {
    // GIVEN
    const stack = new core_1.Stack();
    // WHEN
    new lib_1.Group(stack, 'MyGroup', {
        groupName: 'MyGroup',
        managedPolicies: [
            lib_1.ManagedPolicy.fromAwsManagedPolicyName('0'),
            lib_1.ManagedPolicy.fromAwsManagedPolicyName('1'),
            lib_1.ManagedPolicy.fromAwsManagedPolicyName('2'),
            lib_1.ManagedPolicy.fromAwsManagedPolicyName('3'),
            lib_1.ManagedPolicy.fromAwsManagedPolicyName('4'),
            lib_1.ManagedPolicy.fromAwsManagedPolicyName('5'),
            lib_1.ManagedPolicy.fromAwsManagedPolicyName('6'),
            lib_1.ManagedPolicy.fromAwsManagedPolicyName('7'),
            lib_1.ManagedPolicy.fromAwsManagedPolicyName('8'),
            lib_1.ManagedPolicy.fromAwsManagedPolicyName('9'),
            lib_1.ManagedPolicy.fromAwsManagedPolicyName('10'),
        ],
    });
    assertions_1.Annotations.fromStack(stack).hasWarning('*', 'You added 11 to IAM Group MyGroup. The maximum number of managed policies attached to an IAM group is 10.');
});
test('throw warning if attached managed policies exceed 10 when calling `addManagedPolicy`', () => {
    // GIVEN
    const stack = new core_1.Stack();
    // WHEN
    const group = new lib_1.Group(stack, 'MyGroup', {
        groupName: 'MyGroup',
    });
    for (let i = 0; i <= 11; i++) {
        group.addManagedPolicy(lib_1.ManagedPolicy.fromAwsManagedPolicyName(i.toString()));
    }
    assertions_1.Annotations.fromStack(stack).hasWarning('/Default/MyGroup', 'You added 11 to IAM Group MyGroup. The maximum number of managed policies attached to an IAM group is 10.');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JvdXAudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdyb3VwLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBeUQ7QUFDekQscUNBQXFEO0FBQ3JELGdDQUFvRDtBQUVwRCxRQUFRLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtJQUMxQixJQUFJLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtRQUN6QixNQUFNLEdBQUcsR0FBRyxJQUFJLFVBQUcsRUFBRSxDQUFDO1FBQ3RCLE1BQU0sS0FBSyxHQUFHLElBQUksWUFBSyxDQUFDLEdBQUcsRUFBRSxTQUFTLENBQUMsQ0FBQztRQUN4QyxJQUFJLFdBQUssQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFFNUIscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsZUFBZSxDQUFDO1lBQ3hDLFNBQVMsRUFBRSxFQUFFLGVBQWUsRUFBRSxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxFQUFFO1NBQzVELENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLGlGQUFpRixFQUFFLEdBQUcsRUFBRTtRQUMzRixNQUFNLEdBQUcsR0FBRyxJQUFJLFVBQUcsRUFBRSxDQUFDO1FBQ3RCLE1BQU0sS0FBSyxHQUFHLElBQUksWUFBSyxDQUFDLEdBQUcsRUFBRSxTQUFTLENBQUMsQ0FBQztRQUN4QyxNQUFNLEtBQUssR0FBRyxJQUFJLFdBQUssQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDMUMsTUFBTSxLQUFLLEdBQUcsSUFBSSxVQUFJLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3ZDLE1BQU0sS0FBSyxHQUFHLElBQUksVUFBSSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN2QyxLQUFLLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hCLEtBQUssQ0FBQyxPQUFPLENB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b3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBbm5vdGF0aW9ucywgVGVtcGxhdGUgfSBmcm9tICcuLi8uLi9hc3NlcnRpb25zJztcbmltcG9ydCB7IEFwcCwgQ2ZuUmVzb3VyY2UsIFN0YWNrIH0gZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgeyBHcm91cCwgTWFuYWdlZFBvbGljeSwgVXNlciB9IGZyb20gJy4uL2xpYic7XG5cbmRlc2NyaWJlKCdJQU0gZ3JvdXBzJywgKCkgPT4ge1xuICB0ZXN0KCdkZWZhdWx0IGdyb3VwJywgKCkgPT4ge1xuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHAsICdNeVN0YWNrJyk7XG4gICAgbmV3IEdyb3VwKHN0YWNrLCAnTXlHcm91cCcpO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoe1xuICAgICAgUmVzb3VyY2VzOiB7IE15R3JvdXBDQkE1NEIxQjogeyBUeXBlOiAnQVdTOjpJQU06Okdyb3VwJyB9IH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VzZXJzIGNhbiBiZSBhZGRlZCB0byB0aGUgZ3JvdXAgZWl0aGVyIHZpYSBgdXNlci5hZGRUb0dyb3VwYCBvciBgZ3JvdXAuYWRkVXNlcmAnLCAoKSA9PiB7XG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ015U3RhY2snKTtcbiAgICBjb25zdCBncm91cCA9IG5ldyBHcm91cChzdGFjaywgJ015R3JvdXAnKTtcbiAgICBjb25zdCB1c2VyMSA9IG5ldyBVc2VyKHN0YWNrLCAnVXNlcjEnKTtcbiAgICBjb25zdCB1c2VyMiA9IG5ldyBVc2VyKHN0YWNrLCAnVXNlcjInKTtcbiAgICB1c2VyMS5hZGRUb0dyb3VwKGdyb3VwKTtcbiAgICBncm91cC5hZGRVc2VyKHVzZXIyKTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykudGVtcGxhdGVNYXRjaGVzKHtcbiAgICAgIFJlc291cmNlczpcbiAgICAgIHtcbiAgICAgICAgTXlHcm91cENCQTU0QjFCOiB7IFR5cGU6ICdBV1M6OklBTTo6R3JvdXAnIH0sXG4gICAgICAgIFVzZXIxRTI3OEE3MzY6XG4gICAgICAgIHtcbiAgICAgICAgICBUeXBlOiAnQVdTOjpJQU06OlVzZXInLFxuICAgICAgICAgIFByb3BlcnRpZXM6IHsgR3JvdXBzOiBbeyBSZWY6ICdNeUdyb3VwQ0JBNTRCMUInIH1dIH0sXG4gICAgICAgIH0sXG4gICAgICAgIFVzZXIyMUYxNDg2RDE6XG4gICAgICAgIHtcbiAgICAgICAgICBUeXBlOiAnQVdTOjpJQU06OlVzZXInLFxuICAgICAgICAgIFByb3BlcnRpZXM6IHsgR3JvdXBzOiBbeyBSZWY6ICdNeUdyb3VwQ0JBNTRCMUInIH1dIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjcmVhdGUgd2l0aCBtYW5hZ2VkIHBvbGljeScsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IEdyb3VwKHN0YWNrLCAnTXlHcm91cCcsIHtcbiAgICAgIG1hbmFnZWRQb2xpY2llczogW01hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKCdhc2RmJyldLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6R3JvdXAnLCB7XG4gICAgICBNYW5hZ2VkUG9saWN5QXJuczogW1xuICAgICAgICB7ICdGbjo6Sm9pbic6IFsnJywgWydhcm46JywgeyBSZWY6ICdBV1M6OlBhcnRpdGlvbicgfSwgJzppYW06OmF3czpwb2xpY3kvYXNkZiddXSB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnZ3JvdXBzIGltcG9ydGVkIGJ5IGdyb3VwIG5hbWUgaGF2ZSB2YWxpZCBhcm4nLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IGdyb3VwMSA9IEdyb3VwLmZyb21Hcm91cE5hbWUoc3RhY2ssICdpbXBvcnRlZC1ncm91cDEnLCAnTXlHcm91cE5hbWUxJyk7XG4gICAgY29uc3QgZ3JvdXAyID0gR3JvdXAuZnJvbUdyb3VwTmFtZShzdGFjaywgJ2ltcG9ydGVkLWdyb3VwMicsICdkaXZpc2lvbi9NeUdyb3VwTmFtZTInKTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShncm91cDEuZ3JvdXBBcm4pKS50b1N0cmljdEVxdWFsKHtcbiAgICAgICdGbjo6Sm9pbic6IFsnJywgWydhcm46JywgeyBSZWY6ICdBV1M6OlBhcnRpdGlvbicgfSwgJzppYW06OicsIHsgUmVmOiAnQVdTOjpBY2NvdW50SWQnIH0sICc6Z3JvdXAvTXlHcm91cE5hbWUxJ11dLFxuICAgIH0pO1xuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGdyb3VwMi5ncm91cEFybikpLnRvU3RyaWN0RXF1YWwoe1xuICAgICAgJ0ZuOjpKb2luJzogWycnLCBbJ2FybjonLCB7IFJlZjogJ0FXUzo6UGFydGl0aW9uJyB9LCAnOmlhbTo6JywgeyBSZWY6ICdBV1M6OkFjY291bnRJZCcgfSwgJzpncm91cC9kaXZpc2lvbi9NeUdyb3VwTmFtZTInXV0sXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbnRlc3QoJ2Nyb3NzLWVudiBncm91cCBBUk5zIGluY2x1ZGUgcGF0aCcsICgpID0+IHtcbiAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICBjb25zdCBncm91cFN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ2dyb3VwLXN0YWNrJywgeyBlbnY6IHsgYWNjb3VudDogJzEyMzQ1Njc4OTAxMicsIHJlZ2lvbjogJ3VzLWVhc3QtMScgfSB9KTtcbiAgY29uc3QgcmVmZXJlbmNlclN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ3JlZmVyZW5jZXItc3RhY2snLCB7IGVudjogeyByZWdpb246ICd1cy1lYXN0LTInIH0gfSk7XG4gIGNvbnN0IGdyb3VwID0gbmV3IEdyb3VwKGdyb3VwU3RhY2ssICdHcm91cCcsIHtcbiAgICBwYXRoOiAnL3NhbXBsZS9wYXRoLycsXG4gICAgZ3JvdXBOYW1lOiAnc2FtcGxlLW5hbWUnLFxuICB9KTtcbiAgbmV3IENmblJlc291cmNlKHJlZmVyZW5jZXJTdGFjaywgJ1JlZmVyZW5jZXInLCB7XG4gICAgdHlwZTogJ0N1c3RvbTo6R3JvdXBSZWZlcmVuY2VyJyxcbiAgICBwcm9wZXJ0aWVzOiB7IEdyb3VwQXJuOiBncm91cC5ncm91cEFybiB9LFxuICB9KTtcblxuICBUZW1wbGF0ZS5mcm9tU3RhY2socmVmZXJlbmNlclN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0N1c3RvbTo6R3JvdXBSZWZlcmVuY2VyJywge1xuICAgIEdyb3VwQXJuOiB7XG4gICAgICAnRm46OkpvaW4nOiBbXG4gICAgICAgICcnLFxuICAgICAgICBbXG4gICAgICAgICAgJ2FybjonLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIFJlZjogJ0FXUzo6UGFydGl0aW9uJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgICc6aWFtOjoxMjM0NTY3ODkwMTI6Z3JvdXAvc2FtcGxlL3BhdGgvc2FtcGxlLW5hbWUnLFxuICAgICAgICBdLFxuICAgICAgXSxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCd0aHJvdyB3YXJuaW5nIGlmIGF0dGFjaGVkIG1hbmFnZWQgcG9saWNpZXMgZXhjZWVkIDEwIGluIGNvbnN0cnVjdG9yJywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuXG4gIC8vIFdIRU5cbiAgbmV3IEdyb3VwKHN0YWNrLCAnTXlHcm91cCcsIHtcbiAgICBncm91cE5hbWU6ICdNeUdyb3VwJyxcbiAgICBtYW5hZ2VkUG9saWNpZXM6IFtcbiAgICAgIE1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKCcwJyksXG4gICAgICBNYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZSgnMScpLFxuICAgICAgTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoJzInKSxcbiAgICAgIE1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKCczJyksXG4gICAgICBNYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZSgnNCcpLFxuICAgICAgTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoJzUnKSxcbiAgICAgIE1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKCc2JyksXG4gICAgICBNYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZSgnNycpLFxuICAgICAgTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoJzgnKSxcbiAgICAgIE1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKCc5JyksXG4gICAgICBNYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZSgnMTAnKSxcbiAgICBdLFxuICB9KTtcblxuICBBbm5vdGF0aW9ucy5mcm9tU3RhY2soc3RhY2spLmhhc1dhcm5pbmcoJyonLCAnWW91IGFkZGVkIDExIHRvIElBTSBHcm91cCBNeUdyb3VwLiBUaGUgbWF4aW11bSBudW1iZXIgb2YgbWFuYWdlZCBwb2xpY2llcyBhdHRhY2hlZCB0byBhbiBJQU0gZ3JvdXAgaXMgMTAuJyk7XG59KTtcblxudGVzdCgndGhyb3cgd2FybmluZyBpZiBhdHRhY2hlZCBtYW5hZ2VkIHBvbGljaWVzIGV4Y2VlZCAxMCB3aGVuIGNhbGxpbmcgYGFkZE1hbmFnZWRQb2xpY3lgJywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgZ3JvdXAgPSBuZXcgR3JvdXAoc3RhY2ssICdNeUdyb3VwJywge1xuICAgIGdyb3VwTmFtZTogJ015R3JvdXAnLFxuICB9KTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8PSAxMTsgaSsrKSB7XG4gICAgZ3JvdXAuYWRkTWFuYWdlZFBvbGljeShNYW5hZ2VkUG9saWN5LmZyb21Bd3NNYW5hZ2VkUG9saWN5TmFtZShpLnRvU3RyaW5nKCkpKTtcbiAgfVxuXG4gIEFubm90YXRpb25zLmZyb21TdGFjayhzdGFjaykuaGFzV2FybmluZygnL0RlZmF1bHQvTXlHcm91cCcsICdZb3UgYWRkZWQgMTEgdG8gSUFNIEdyb3VwIE15R3JvdXAuIFRoZSBtYXhpbXVtIG51bWJlciBvZiBtYW5hZ2VkIHBvbGljaWVzIGF0dGFjaGVkIHRvIGFuIElBTSBncm91cCBpcyAxMC4nKTtcbn0pO1xuIl19