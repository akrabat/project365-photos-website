"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const core_1 = require("../../core");
const lib_1 = require("../lib");
describe('IAM user', () => {
    test('default user', () => {
        const app = new core_1.App();
        const stack = new core_1.Stack(app, 'MyStack');
        new lib_1.User(stack, 'MyUser');
        assertions_1.Template.fromStack(stack).templateMatches({
            Resources: { MyUserDC45028B: { Type: 'AWS::IAM::User' } },
        });
    });
    test('default user with password', () => {
        const app = new core_1.App();
        const stack = new core_1.Stack(app, 'MyStack');
        new lib_1.User(stack, 'MyUser', {
            password: core_1.SecretValue.unsafePlainText('1234'),
        });
        assertions_1.Template.fromStack(stack).templateMatches({
            Resources: {
                MyUserDC45028B: {
                    Type: 'AWS::IAM::User',
                    Properties: { LoginProfile: { Password: '1234' } },
                },
            },
        });
    });
    test('fails if reset password is required but no password is set', () => {
        const app = new core_1.App();
        const stack = new core_1.Stack(app, 'MyStack');
        expect(() => new lib_1.User(stack, 'MyUser', { passwordResetRequired: true })).toThrow();
    });
    test('create with managed policy', () => {
        // GIVEN
        const app = new core_1.App();
        const stack = new core_1.Stack(app, 'MyStack');
        // WHEN
        new lib_1.User(stack, 'MyUser', {
            managedPolicies: [lib_1.ManagedPolicy.fromAwsManagedPolicyName('asdf')],
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::User', {
            ManagedPolicyArns: [
                { 'Fn::Join': ['', ['arn:', { Ref: 'AWS::Partition' }, ':iam::aws:policy/asdf']] },
            ],
        });
    });
    test('can supply permissions boundary managed policy', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const permissionsBoundary = lib_1.ManagedPolicy.fromAwsManagedPolicyName('managed-policy');
        new lib_1.User(stack, 'MyUser', {
            permissionsBoundary,
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::User', {
            PermissionsBoundary: {
                'Fn::Join': [
                    '',
                    [
                        'arn:',
                        {
                            Ref: 'AWS::Partition',
                        },
                        ':iam::aws:policy/managed-policy',
                    ],
                ],
            },
        });
    });
    test('user imported by user name has an ARN', () => {
        // GIVEN
        const stack = new core_1.Stack();
        // WHEN
        const user = lib_1.User.fromUserName(stack, 'import', 'MyUserName');
        // THEN
        expect(stack.resolve(user.userArn)).toStrictEqual({
            'Fn::Join': ['', ['arn:', { Ref: 'AWS::Partition' }, ':iam::', { Ref: 'AWS::AccountId' }, ':user/MyUserName']],
        });
    });
    test('user imported by user ARN has a name', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const userName = 'MyUserName';
        // WHEN
        const user = lib_1.User.fromUserArn(stack, 'import', `arn:aws:iam::account-id:user/${userName}`);
        // THEN
        expect(stack.resolve(user.userName)).toStrictEqual(userName);
    });
    test('user imported by tokenized user ARN has a name', () => {
        // GIVEN
        const stack = new core_1.Stack();
        // WHEN
        const user = lib_1.User.fromUserArn(stack, 'import', core_1.Token.asString({ Ref: 'ARN' }));
        // THEN
        expect(stack.resolve(user.userName)).toStrictEqual({
            'Fn::Select': [1, { 'Fn::Split': [':user/', { Ref: 'ARN' }] }],
        });
    });
    test('user imported by user ARN with path', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const userName = 'MyUserName';
        // WHEN
        const user = lib_1.User.fromUserArn(stack, 'import', `arn:aws:iam::account-id:user/path/${userName}`);
        // THEN
        expect(stack.resolve(user.userName)).toStrictEqual(userName);
    });
    test('user imported by user ARN with path (multiple elements)', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const userName = 'MyUserName';
        // WHEN
        const user = lib_1.User.fromUserArn(stack, 'import', `arn:aws:iam::account-id:user/p/a/t/h/${userName}`);
        // THEN
        expect(stack.resolve(user.userName)).toStrictEqual(userName);
    });
    test('user imported by tokenized user attributes has a name', () => {
        // GIVEN
        const stack = new core_1.Stack();
        // WHEN
        const user = lib_1.User.fromUserAttributes(stack, 'import', {
            userArn: core_1.Token.asString({ Ref: 'ARN' }),
        });
        // THEN
        expect(stack.resolve(user.userName)).toStrictEqual({
            'Fn::Select': [1, { 'Fn::Split': [':user/', { Ref: 'ARN' }] }],
        });
    });
    test('user imported by user attributes has a name', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const userName = 'MyUserName';
        // WHEN
        const user = lib_1.User.fromUserAttributes(stack, 'import', {
            userArn: `arn:aws:iam::account-id:user/${userName}`,
        });
        // THEN
        expect(stack.resolve(user.userName)).toStrictEqual(userName);
    });
    test('user imported by user attributes with path has a name', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const userName = 'MyUserName';
        // WHEN
        const user = lib_1.User.fromUserAttributes(stack, 'import', {
            userArn: `arn:aws:iam::account-id:user/path/${userName}`,
        });
        // THEN
        expect(stack.resolve(user.userName)).toStrictEqual(userName);
    });
    test('user imported by user attributes with path (multiple elements) has a name', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const userName = 'MyUserName';
        // WHEN
        const user = lib_1.User.fromUserAttributes(stack, 'import', {
            userArn: `arn:aws:iam::account-id:user/p/a/t/h/${userName}`,
        });
        // THEN
        expect(stack.resolve(user.userName)).toStrictEqual(userName);
    });
    test('add to policy of imported user', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const user = lib_1.User.fromUserName(stack, 'ImportedUser', 'john');
        // WHEN
        user.addToPrincipalPolicy(new lib_1.PolicyStatement({
            actions: ['aws:Use'],
            resources: ['*'],
        }));
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
            Users: ['john'],
            PolicyDocument: {
                Statement: [
                    {
                        Action: 'aws:Use',
                        Effect: 'Allow',
                        Resource: '*',
                    },
                ],
                Version: '2012-10-17',
            },
        });
    });
    test('attach policy to imported user', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const user = lib_1.User.fromUserName(stack, 'ImportedUser', 'john');
        // WHEN
        user.attachInlinePolicy(new lib_1.Policy(stack, 'Policy', {
            statements: [
                new lib_1.PolicyStatement({
                    actions: ['aws:Use'],
                    resources: ['*'],
                }),
            ],
        }));
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
            Users: ['john'],
            PolicyDocument: {
                Statement: [
                    {
                        Action: 'aws:Use',
                        Effect: 'Allow',
                        Resource: '*',
                    },
                ],
                Version: '2012-10-17',
            },
        });
    });
    test('addToGroup for imported user', () => {
        // GIVEN
        const stack = new core_1.Stack();
        const user = lib_1.User.fromUserName(stack, 'ImportedUser', 'john');
        const group = new lib_1.Group(stack, 'Group');
        const otherGroup = new lib_1.Group(stack, 'OtherGroup');
        // WHEN
        user.addToGroup(group);
        otherGroup.addUser(user);
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::UserToGroupAddition', {
            GroupName: {
                Ref: 'GroupC77FDACD',
            },
            Users: [
                'john',
            ],
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::UserToGroupAddition', {
            GroupName: {
                Ref: 'OtherGroup85E5C653',
            },
            Users: [
                'john',
            ],
        });
    });
});
test('cross-env user ARNs include path', () => {
    const app = new core_1.App();
    const userStack = new core_1.Stack(app, 'user-stack', { env: { account: '123456789012', region: 'us-east-1' } });
    const referencerStack = new core_1.Stack(app, 'referencer-stack', { env: { region: 'us-east-2' } });
    const user = new lib_1.User(userStack, 'User', {
        path: '/sample/path/',
        userName: 'sample-name',
    });
    new core_1.CfnResource(referencerStack, 'Referencer', {
        type: 'Custom::UserReferencer',
        properties: { UserArn: user.userArn },
    });
    assertions_1.Template.fromStack(referencerStack).hasResourceProperties('Custom::UserReferencer', {
        UserArn: {
            'Fn::Join': [
                '',
                [
                    'arn:',
                    {
                        Ref: 'AWS::Partition',
                    },
                    ':iam::123456789012:user/sample/path/sample-name',
                ],
            ],
        },
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidXNlci50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaURBQTRDO0FBQzVDLHFDQUF5RTtBQUN6RSxnQ0FBNkU7QUFFN0UsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUU7SUFDeEIsSUFBSSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7UUFDeEIsTUFBTSxHQUFHLEdBQUcsSUFBSSxVQUFHLEVBQUUsQ0FBQztRQUN0QixNQUFNLEtBQUssR0FBRyxJQUFJLFlBQUssQ0FBQyxHQUFHLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDeEMsSUFBSSxVQUFJLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzFCLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLGVBQWUsQ0FBQztZQUN4QyxTQUFTLEVBQUUsRUFBRSxjQUFjLEVBQUUsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUUsRUFBRTtTQUMxRCxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUU7UUFDdEMsTUFBTSxHQUFHLEdBQUcsSUFBSSxVQUFHLEVBQUUsQ0FBQztRQUN0QixNQUFNLEtBQUssR0FBRyxJQUFJLFlBQUssQ0FBQyxHQUFHLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDeEMsSUFBSSxVQUFJLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRTtZQUN4QixRQUFRLEVBQUUsa0JBQVcsQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDO1NBQzlDLENBQUMsQ0FBQztRQUVILHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLGVBQWUsQ0FBQztZQUN4QyxTQUFTLEVBQ1Q7Z0JBQ0UsY0FBYyxFQUNkO29CQUNFLElBQUksRUFBRSxnQkFBZ0I7b0JBQ3RCLFVBQVUsRUFBRSxFQUFFLFlBQVksRUFBRSxFQUFFLFFB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ZSxFQUFFLFlBQVksRUFBRTtRQUM3QyxJQUFJLEVBQUUsd0JBQXdCO1FBQzlCLFVBQVUsRUFBRSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFO0tBQ3RDLENBQUMsQ0FBQztJQUVILHFCQUFRLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHdCQUF3QixFQUFFO1FBQ2xGLE9BQU8sRUFBRTtZQUNQLFVBQVUsRUFBRTtnQkFDVixFQUFFO2dCQUNGO29CQUNFLE1BQU07b0JBQ047d0JBQ0UsR0FBRyxFQUFFLGdCQUFnQjtxQkFDdEI7b0JBQ0QsaURBQWlEO2lCQUNsRDthQUNGO1NBQ0Y7S0FDRixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgeyBBcHAsIENmblJlc291cmNlLCBTZWNyZXRWYWx1ZSwgU3RhY2ssIFRva2VuIH0gZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgeyBHcm91cCwgTWFuYWdlZFBvbGljeSwgUG9saWN5LCBQb2xpY3lTdGF0ZW1lbnQsIFVzZXIgfSBmcm9tICcuLi9saWInO1xuXG5kZXNjcmliZSgnSUFNIHVzZXInLCAoKSA9PiB7XG4gIHRlc3QoJ2RlZmF1bHQgdXNlcicsICgpID0+IHtcbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnTXlTdGFjaycpO1xuICAgIG5ldyBVc2VyKHN0YWNrLCAnTXlVc2VyJyk7XG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoe1xuICAgICAgUmVzb3VyY2VzOiB7IE15VXNlckRDNDUwMjhCOiB7IFR5cGU6ICdBV1M6OklBTTo6VXNlcicgfSB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdkZWZhdWx0IHVzZXIgd2l0aCBwYXNzd29yZCcsICgpID0+IHtcbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnTXlTdGFjaycpO1xuICAgIG5ldyBVc2VyKHN0YWNrLCAnTXlVc2VyJywge1xuICAgICAgcGFzc3dvcmQ6IFNlY3JldFZhbHVlLnVuc2FmZVBsYWluVGV4dCgnMTIzNCcpLFxuICAgIH0pO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoe1xuICAgICAgUmVzb3VyY2VzOlxuICAgICAge1xuICAgICAgICBNeVVzZXJEQzQ1MDI4QjpcbiAgICAgICAge1xuICAgICAgICAgIFR5cGU6ICdBV1M6OklBTTo6VXNlcicsXG4gICAgICAgICAgUHJvcGVydGllczogeyBMb2dpblByb2ZpbGU6IHsgUGFzc3dvcmQ6ICcxMjM0JyB9IH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdmYWlscyBpZiByZXNldCBwYXNzd29yZCBpcyByZXF1aXJlZCBidXQgbm8gcGFzc3dvcmQgaXMgc2V0JywgKCkgPT4ge1xuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHAsICdNeVN0YWNrJyk7XG4gICAgZXhwZWN0KCgpID0+IG5ldyBVc2VyKHN0YWNrLCAnTXlVc2VyJywgeyBwYXNzd29yZFJlc2V0UmVxdWlyZWQ6IHRydWUgfSkpLnRvVGhyb3coKTtcbiAgfSk7XG5cbiAgdGVzdCgnY3JlYXRlIHdpdGggbWFuYWdlZCBwb2xpY3knLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnTXlTdGFjaycpO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBVc2VyKHN0YWNrLCAnTXlVc2VyJywge1xuICAgICAgbWFuYWdlZFBvbGljaWVzOiBbTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoJ2FzZGYnKV0sXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6SUFNOjpVc2VyJywge1xuICAgICAgTWFuYWdlZFBvbGljeUFybnM6IFtcbiAgICAgICAgeyAnRm46OkpvaW4nOiBbJycsIFsnYXJuOicsIHsgUmVmOiAnQVdTOjpQYXJ0aXRpb24nIH0sICc6aWFtOjphd3M6cG9saWN5L2FzZGYnXV0gfSxcbiAgICAgIF0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBzdXBwbHkgcGVybWlzc2lvbnMgYm91bmRhcnkgbWFuYWdlZCBwb2xpY3knLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuXG4gICAgY29uc3QgcGVybWlzc2lvbnNCb3VuZGFyeSA9IE1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKCdtYW5hZ2VkLXBvbGljeScpO1xuXG4gICAgbmV3IFVzZXIoc3RhY2ssICdNeVVzZXInLCB7XG4gICAgICBwZXJtaXNzaW9uc0JvdW5kYXJ5LFxuICAgIH0pO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6SUFNOjpVc2VyJywge1xuICAgICAgUGVybWlzc2lvbnNCb3VuZGFyeToge1xuICAgICAgICAnRm46OkpvaW4nOiBbXG4gICAgICAgICAgJycsXG4gICAgICAgICAgW1xuICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBSZWY6ICdBV1M6OlBhcnRpdGlvbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJzppYW06OmF3czpwb2xpY3kvbWFuYWdlZC1wb2xpY3knLFxuICAgICAgICAgIF0sXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCd1c2VyIGltcG9ydGVkIGJ5IHVzZXIgbmFtZSBoYXMgYW4gQVJOJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCB1c2VyID0gVXNlci5mcm9tVXNlck5hbWUoc3RhY2ssICdpbXBvcnQnLCAnTXlVc2VyTmFtZScpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKHVzZXIudXNlckFybikpLnRvU3RyaWN0RXF1YWwoe1xuICAgICAgJ0ZuOjpKb2luJzogWycnLCBbJ2FybjonLCB7IFJlZjogJ0FXUzo6UGFydGl0aW9uJyB9LCAnOmlhbTo6JywgeyBSZWY6ICdBV1M6OkFjY291bnRJZCcgfSwgJzp1c2VyL015VXNlck5hbWUnXV0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VzZXIgaW1wb3J0ZWQgYnkgdXNlciBBUk4gaGFzIGEgbmFtZScsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgY29uc3QgdXNlck5hbWUgPSAnTXlVc2VyTmFtZSc7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3QgdXNlciA9IFVzZXIuZnJvbVVzZXJBcm4oc3RhY2ssICdpbXBvcnQnLCBgYXJuOmF3czppYW06OmFjY291bnQtaWQ6dXNlci8ke3VzZXJOYW1lfWApO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKHVzZXIudXNlck5hbWUpKS50b1N0cmljdEVxdWFsKHVzZXJOYW1lKTtcbiAgfSk7XG5cbiAgdGVzdCgndXNlciBpbXBvcnRlZCBieSB0b2tlbml6ZWQgdXNlciBBUk4gaGFzIGEgbmFtZScsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3QgdXNlciA9IFVzZXIuZnJvbVVzZXJBcm4oc3RhY2ssICdpbXBvcnQnLCBUb2tlbi5hc1N0cmluZyh7IFJlZjogJ0FSTicgfSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKHVzZXIudXNlck5hbWUpKS50b1N0cmljdEVxdWFsKHtcbiAgICAgICdGbjo6U2VsZWN0JzogWzEsIHsgJ0ZuOjpTcGxpdCc6IFsnOnVzZXIvJywgeyBSZWY6ICdBUk4nIH1dIH1dLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCd1c2VyIGltcG9ydGVkIGJ5IHVzZXIgQVJOIHdpdGggcGF0aCcsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgY29uc3QgdXNlck5hbWUgPSAnTXlVc2VyTmFtZSc7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3QgdXNlciA9IFVzZXIuZnJvbVVzZXJBcm4oc3RhY2ssICdpbXBvcnQnLCBgYXJuOmF3czppYW06OmFjY291bnQtaWQ6dXNlci9wYXRoLyR7dXNlck5hbWV9YCk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHN0YWNrLnJlc29sdmUodXNlci51c2VyTmFtZSkpLnRvU3RyaWN0RXF1YWwodXNlck5hbWUpO1xuICB9KTtcblxuICB0ZXN0KCd1c2VyIGltcG9ydGVkIGJ5IHVzZXIgQVJOIHdpdGggcGF0aCAobXVsdGlwbGUgZWxlbWVudHMpJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICBjb25zdCB1c2VyTmFtZSA9ICdNeVVzZXJOYW1lJztcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCB1c2VyID0gVXNlci5mcm9tVXNlckFybihzdGFjaywgJ2ltcG9ydCcsIGBhcm46YXdzOmlhbTo6YWNjb3VudC1pZDp1c2VyL3AvYS90L2gvJHt1c2VyTmFtZX1gKTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZSh1c2VyLnVzZXJOYW1lKSkudG9TdHJpY3RFcXVhbCh1c2VyTmFtZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VzZXIgaW1wb3J0ZWQgYnkgdG9rZW5pemVkIHVzZXIgYXR0cmlidXRlcyBoYXMgYSBuYW1lJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCB1c2VyID0gVXNlci5mcm9tVXNlckF0dHJpYnV0ZXMoc3RhY2ssICdpbXBvcnQnLCB7XG4gICAgICB1c2VyQXJuOiBUb2tlbi5hc1N0cmluZyh7IFJlZjogJ0FSTicgfSksXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHN0YWNrLnJlc29sdmUodXNlci51c2VyTmFtZSkpLnRvU3RyaWN0RXF1YWwoe1xuICAgICAgJ0ZuOjpTZWxlY3QnOiBbMSwgeyAnRm46OlNwbGl0JzogWyc6dXNlci8nLCB7IFJlZjogJ0FSTicgfV0gfV0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VzZXIgaW1wb3J0ZWQgYnkgdXNlciBhdHRyaWJ1dGVzIGhhcyBhIG5hbWUnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICAgIGNvbnN0IHVzZXJOYW1lID0gJ015VXNlck5hbWUnO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHVzZXIgPSBVc2VyLmZyb21Vc2VyQXR0cmlidXRlcyhzdGFjaywgJ2ltcG9ydCcsIHtcbiAgICAgIHVzZXJBcm46IGBhcm46YXdzOmlhbTo6YWNjb3VudC1pZDp1c2VyLyR7dXNlck5hbWV9YCxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZSh1c2VyLnVzZXJOYW1lKSkudG9TdHJpY3RFcXVhbCh1c2VyTmFtZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VzZXIgaW1wb3J0ZWQgYnkgdXNlciBhdHRyaWJ1dGVzIHdpdGggcGF0aCBoYXMgYSBuYW1lJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICBjb25zdCB1c2VyTmFtZSA9ICdNeVVzZXJOYW1lJztcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCB1c2VyID0gVXNlci5mcm9tVXNlckF0dHJpYnV0ZXMoc3RhY2ssICdpbXBvcnQnLCB7XG4gICAgICB1c2VyQXJuOiBgYXJuOmF3czppYW06OmFjY291bnQtaWQ6dXNlci9wYXRoLyR7dXNlck5hbWV9YCxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZSh1c2VyLnVzZXJOYW1lKSkudG9TdHJpY3RFcXVhbCh1c2VyTmFtZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VzZXIgaW1wb3J0ZWQgYnkgdXNlciBhdHRyaWJ1dGVzIHdpdGggcGF0aCAobXVsdGlwbGUgZWxlbWVudHMpIGhhcyBhIG5hbWUnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICAgIGNvbnN0IHVzZXJOYW1lID0gJ015VXNlck5hbWUnO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHVzZXIgPSBVc2VyLmZyb21Vc2VyQXR0cmlidXRlcyhzdGFjaywgJ2ltcG9ydCcsIHtcbiAgICAgIHVzZXJBcm46IGBhcm46YXdzOmlhbTo6YWNjb3VudC1pZDp1c2VyL3AvYS90L2gvJHt1c2VyTmFtZX1gLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKHVzZXIudXNlck5hbWUpKS50b1N0cmljdEVxdWFsKHVzZXJOYW1lKTtcbiAgfSk7XG5cbiAgdGVzdCgnYWRkIHRvIHBvbGljeSBvZiBpbXBvcnRlZCB1c2VyJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICBjb25zdCB1c2VyID0gVXNlci5mcm9tVXNlck5hbWUoc3RhY2ssICdJbXBvcnRlZFVzZXInLCAnam9obicpO1xuXG4gICAgLy8gV0hFTlxuICAgIHVzZXIuYWRkVG9QcmluY2lwYWxQb2xpY3kobmV3IFBvbGljeVN0YXRlbWVudCh7XG4gICAgICBhY3Rpb25zOiBbJ2F3czpVc2UnXSxcbiAgICAgIHJlc291cmNlczogWycqJ10sXG4gICAgfSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgICAgVXNlcnM6IFsnam9obiddLFxuICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgU3RhdGVtZW50OiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgQWN0aW9uOiAnYXdzOlVzZScsXG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIFZlcnNpb246ICcyMDEyLTEwLTE3JyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2F0dGFjaCBwb2xpY3kgdG8gaW1wb3J0ZWQgdXNlcicsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgY29uc3QgdXNlciA9IFVzZXIuZnJvbVVzZXJOYW1lKHN0YWNrLCAnSW1wb3J0ZWRVc2VyJywgJ2pvaG4nKTtcblxuICAgIC8vIFdIRU5cbiAgICB1c2VyLmF0dGFjaElubGluZVBvbGljeShuZXcgUG9saWN5KHN0YWNrLCAnUG9saWN5Jywge1xuICAgICAgc3RhdGVtZW50czogW1xuICAgICAgICBuZXcgUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ2F3czpVc2UnXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFsnKiddLFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgICAgVXNlcnM6IFsnam9obiddLFxuICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgU3RhdGVtZW50OiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgQWN0aW9uOiAnYXdzOlVzZScsXG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIFZlcnNpb246ICcyMDEyLTEwLTE3JyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2FkZFRvR3JvdXAgZm9yIGltcG9ydGVkIHVzZXInLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICAgIGNvbnN0IHVzZXIgPSBVc2VyLmZyb21Vc2VyTmFtZShzdGFjaywgJ0ltcG9ydGVkVXNlcicsICdqb2huJyk7XG4gICAgY29uc3QgZ3JvdXAgPSBuZXcgR3JvdXAoc3RhY2ssICdHcm91cCcpO1xuICAgIGNvbnN0IG90aGVyR3JvdXAgPSBuZXcgR3JvdXAoc3RhY2ssICdPdGhlckdyb3VwJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgdXNlci5hZGRUb0dyb3VwKGdyb3VwKTtcbiAgICBvdGhlckdyb3VwLmFkZFVzZXIodXNlcik7XG5cbiAgICAvLyBUSEVOXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6SUFNOjpVc2VyVG9Hcm91cEFkZGl0aW9uJywge1xuICAgICAgR3JvdXBOYW1lOiB7XG4gICAgICAgIFJlZjogJ0dyb3VwQzc3RkRBQ0QnLFxuICAgICAgfSxcbiAgICAgIFVzZXJzOiBbXG4gICAgICAgICdqb2huJyxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpJQU06OlVzZXJUb0dyb3VwQWRkaXRpb24nLCB7XG4gICAgICBHcm91cE5hbWU6IHtcbiAgICAgICAgUmVmOiAnT3RoZXJHcm91cDg1RTVDNjUzJyxcbiAgICAgIH0sXG4gICAgICBVc2VyczogW1xuICAgICAgICAnam9obicsXG4gICAgICBdLFxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG50ZXN0KCdjcm9zcy1lbnYgdXNlciBBUk5zIGluY2x1ZGUgcGF0aCcsICgpID0+IHtcbiAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICBjb25zdCB1c2VyU3RhY2sgPSBuZXcgU3RhY2soYXBwLCAndXNlci1zdGFjaycsIHsgZW52OiB7IGFjY291bnQ6ICcxMjM0NTY3ODkwMTInLCByZWdpb246ICd1cy1lYXN0LTEnIH0gfSk7XG4gIGNvbnN0IHJlZmVyZW5jZXJTdGFjayA9IG5ldyBTdGFjayhhcHAsICdyZWZlcmVuY2VyLXN0YWNrJywgeyBlbnY6IHsgcmVnaW9uOiAndXMtZWFzdC0yJyB9IH0pO1xuICBjb25zdCB1c2VyID0gbmV3IFVzZXIodXNlclN0YWNrLCAnVXNlcicsIHtcbiAgICBwYXRoOiAnL3NhbXBsZS9wYXRoLycsXG4gICAgdXNlck5hbWU6ICdzYW1wbGUtbmFtZScsXG4gIH0pO1xuICBuZXcgQ2ZuUmVzb3VyY2UocmVmZXJlbmNlclN0YWNrLCAnUmVmZXJlbmNlcicsIHtcbiAgICB0eXBlOiAnQ3VzdG9tOjpVc2VyUmVmZXJlbmNlcicsXG4gICAgcHJvcGVydGllczogeyBVc2VyQXJuOiB1c2VyLnVzZXJBcm4gfSxcbiAgfSk7XG5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHJlZmVyZW5jZXJTdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdDdXN0b206OlVzZXJSZWZlcmVuY2VyJywge1xuICAgIFVzZXJBcm46IHtcbiAgICAgICdGbjo6Sm9pbic6IFtcbiAgICAgICAgJycsXG4gICAgICAgIFtcbiAgICAgICAgICAnYXJuOicsXG4gICAgICAgICAge1xuICAgICAgICAgICAgUmVmOiAnQVdTOjpQYXJ0aXRpb24nLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgJzppYW06OjEyMzQ1Njc4OTAxMjp1c2VyL3NhbXBsZS9wYXRoL3NhbXBsZS1uYW1lJyxcbiAgICAgICAgXSxcbiAgICAgIF0sXG4gICAgfSxcbiAgfSk7XG59KTtcbiJdfQ==