"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const os = require("os");
const lib_1 = require("../lib");
const package_manager_1 = require("../lib/package-manager");
test('from a package-lock.json', () => {
    const packageManager = package_manager_1.PackageManager.fromLockFile('/path/to/package-lock.json');
    expect(packageManager.lockFile).toEqual(package_manager_1.LockFile.NPM);
    expect(packageManager.argsSeparator).toBeUndefined();
    expect(packageManager.installCommand).toEqual(['npm', 'ci']);
    expect(packageManager.runCommand).toEqual(['npx', '--no-install']);
    expect(packageManager.runBinCommand('my-bin')).toBe('npx --no-install my-bin');
});
test('from a package-lock.json with LogLevel.ERROR', () => {
    const logLevel = lib_1.LogLevel.ERROR;
    const packageManager = package_manager_1.PackageManager.fromLockFile('/path/to/package-lock.json', logLevel);
    expect(packageManager.installCommand).toEqual(['npm', 'ci', '--loglevel', logLevel]);
});
test('from a yarn.lock', () => {
    const packageManager = package_manager_1.PackageManager.fromLockFile('/path/to/yarn.lock');
    expect(packageManager.lockFile).toEqual(package_manager_1.LockFile.YARN);
    expect(packageManager.argsSeparator).toBeUndefined();
    expect(packageManager.installCommand).toEqual(['yarn', 'install', '--no-immutable']);
    expect(packageManager.runCommand).toEqual(['yarn', 'run']);
    expect(packageManager.runBinCommand('my-bin')).toBe('yarn run my-bin');
});
test('from a yarn.lock with LogLevel.ERROR', () => {
    const packageManager = package_manager_1.PackageManager.fromLockFile('/path/to/yarn.lock', lib_1.LogLevel.ERROR);
    expect(packageManager.installCommand).toEqual(['yarn', 'install', '--no-immutable', '--silent']);
});
test('from a pnpm-lock.yaml', () => {
    const packageManager = package_manager_1.PackageManager.fromLockFile('/path/to/pnpm-lock.yaml');
    expect(packageManager.lockFile).toEqual(package_manager_1.LockFile.PNPM);
    expect(packageManager.argsSeparator).toEqual('--');
    expect(packageManager.installCommand).toEqual(['pnpm', 'install', '--config.node-linker=hoisted', '--config.package-import-method=clone-or-copy', '--no-prefer-frozen-lockfile']);
    expect(packageManager.runCommand).toEqual(['pnpm', 'exec']);
    expect(packageManager.runBinCommand('my-bin')).toBe('pnpm exec -- my-bin');
});
test('from a pnpm-lock.yaml with LogLevel.ERROR', () => {
    const packageManager = package_manager_1.PackageManager.fromLockFile('/path/to/pnpm-lock.yaml', lib_1.LogLevel.ERROR);
    expect(packageManager.installCommand).toEqual(['pnpm', 'install', '--reporter', 'silent', '--config.node-linker=hoisted', '--config.package-import-method=clone-or-copy', '--no-prefer-frozen-lockfile']);
});
test('defaults to NPM', () => {
    const packageManager = package_manager_1.PackageManager.fromLockFile('/path/to/other.lock');
    expect(packageManager.lockFile).toEqual(package_manager_1.LockFile.NPM);
});
test('Windows', () => {
    const osPlatformMock = jest.spyOn(os, 'platform').mockReturnValue('win32');
    const packageManager = package_manager_1.PackageManager.fromLockFile('/path/to/whatever');
    expect(packageManager.runBinCommand('my-bin')).toEqual('npx.cmd --no-install my-bin');
    osPlatformMock.mockRestore();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFja2FnZS1tYW5hZ2VyLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwYWNrYWdlLW1hbmFnZXIudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHlCQUF5QjtBQUN6QixnQ0FBa0M7QUFDbEMsNERBQWtFO0FBRWxFLElBQUksQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7SUFDcEMsTUFBTSxjQUFjLEdBQUcsZ0NBQWMsQ0FBQyxZQUFZLENBQUMsNEJBQTRCLENBQUMsQ0FBQztJQUNqRixNQUFNLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQywwQkFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3RELE1BQU0sQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDckQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUM3RCxNQUFNLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDO0lBRW5FLE1BQU0sQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUM7QUFDakYsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsOENBQThDLEVBQUUsR0FBRyxFQUFFO0lBQ3hELE1BQU0sUUFBUSxHQUFHLGNBQVEsQ0FBQyxLQUFLLENBQUM7SUFDaEMsTUFBTSxjQUFjLEdBQUcsZ0NBQWMsQ0FBQyxZQUFZLENBQUMsNEJBQTRCLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDM0YsTUFBTSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFB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QUMsQ0FBQztBQUN4RCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO0lBQ25CLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUUzRSxNQUFNLGNBQWMsR0FBRyxnQ0FBYyxDQUFDLFlBQVksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0lBQ3hFLE1BQU0sQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLDZCQUE2QixDQUFDLENBQUM7SUFFdEYsY0FBYyxDQUFDLFdBQVcsRUFBRSxDQUFDO0FBQy9CLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgb3MgZnJvbSAnb3MnO1xuaW1wb3J0IHsgTG9nTGV2ZWwgfSBmcm9tICcuLi9saWInO1xuaW1wb3J0IHsgTG9ja0ZpbGUsIFBhY2thZ2VNYW5hZ2VyIH0gZnJvbSAnLi4vbGliL3BhY2thZ2UtbWFuYWdlcic7XG5cbnRlc3QoJ2Zyb20gYSBwYWNrYWdlLWxvY2suanNvbicsICgpID0+IHtcbiAgY29uc3QgcGFja2FnZU1hbmFnZXIgPSBQYWNrYWdlTWFuYWdlci5mcm9tTG9ja0ZpbGUoJy9wYXRoL3RvL3BhY2thZ2UtbG9jay5qc29uJyk7XG4gIGV4cGVjdChwYWNrYWdlTWFuYWdlci5sb2NrRmlsZSkudG9FcXVhbChMb2NrRmlsZS5OUE0pO1xuICBleHBlY3QocGFja2FnZU1hbmFnZXIuYXJnc1NlcGFyYXRvcikudG9CZVVuZGVmaW5lZCgpO1xuICBleHBlY3QocGFja2FnZU1hbmFnZXIuaW5zdGFsbENvbW1hbmQpLnRvRXF1YWwoWyducG0nLCAnY2knXSk7XG4gIGV4cGVjdChwYWNrYWdlTWFuYWdlci5ydW5Db21tYW5kKS50b0VxdWFsKFsnbnB4JywgJy0tbm8taW5zdGFsbCddKTtcblxuICBleHBlY3QocGFja2FnZU1hbmFnZXIucnVuQmluQ29tbWFuZCgnbXktYmluJykpLnRvQmUoJ25weCAtLW5vLWluc3RhbGwgbXktYmluJyk7XG59KTtcblxudGVzdCgnZnJvbSBhIHBhY2thZ2UtbG9jay5qc29uIHdpdGggTG9nTGV2ZWwuRVJST1InLCAoKSA9PiB7XG4gIGNvbnN0IGxvZ0xldmVsID0gTG9nTGV2ZWwuRVJST1I7XG4gIGNvbnN0IHBhY2thZ2VNYW5hZ2VyID0gUGFja2FnZU1hbmFnZXIuZnJvbUxvY2tGaWxlKCcvcGF0aC90by9wYWNrYWdlLWxvY2suanNvbicsIGxvZ0xldmVsKTtcbiAgZXhwZWN0KHBhY2thZ2VNYW5hZ2VyLmluc3RhbGxDb21tYW5kKS50b0VxdWFsKFsnbnBtJywgJ2NpJywgJy0tbG9nbGV2ZWwnLCBsb2dMZXZlbF0pO1xufSk7XG5cbnRlc3QoJ2Zyb20gYSB5YXJuLmxvY2snLCAoKSA9PiB7XG4gIGNvbnN0IHBhY2thZ2VNYW5hZ2VyID0gUGFja2FnZU1hbmFnZXIuZnJvbUxvY2tGaWxlKCcvcGF0aC90by95YXJuLmxvY2snKTtcbiAgZXhwZWN0KHBhY2thZ2VNYW5hZ2VyLmxvY2tGaWxlKS50b0VxdWFsKExvY2tGaWxlLllBUk4pO1xuICBleHBlY3QocGFja2FnZU1hbmFnZXIuYXJnc1NlcGFyYXRvcikudG9CZVVuZGVmaW5lZCgpO1xuICBleHBlY3QocGFja2FnZU1hbmFnZXIuaW5zdGFsbENvbW1hbmQpLnRvRXF1YWwoWyd5YXJuJywgJ2luc3RhbGwnLCAnLS1uby1pbW11dGFibGUnXSk7XG4gIGV4cGVjdChwYWNrYWdlTWFuYWdlci5ydW5Db21tYW5kKS50b0VxdWFsKFsneWFybicsICdydW4nXSk7XG5cbiAgZXhwZWN0KHBhY2thZ2VNYW5hZ2VyLnJ1bkJpbkNvbW1hbmQoJ215LWJpbicpKS50b0JlKCd5YXJuIHJ1biBteS1iaW4nKTtcbn0pO1xuXG50ZXN0KCdmcm9tIGEgeWFybi5sb2NrIHdpdGggTG9nTGV2ZWwuRVJST1InLCAoKSA9PiB7XG4gIGNvbnN0IHBhY2thZ2VNYW5hZ2VyID0gUGFja2FnZU1hbmFnZXIuZnJvbUxvY2tGaWxlKCcvcGF0aC90by95YXJuLmxvY2snLCBMb2dMZXZlbC5FUlJPUik7XG4gIGV4cGVjdChwYWNrYWdlTWFuYWdlci5pbnN0YWxsQ29tbWFuZCkudG9FcXVhbChbJ3lhcm4nLCAnaW5zdGFsbCcsICctLW5vLWltbXV0YWJsZScsICctLXNpbGVudCddKTtcbn0pO1xuXG50ZXN0KCdmcm9tIGEgcG5wbS1sb2NrLnlhbWwnLCAoKSA9PiB7XG4gIGNvbnN0IHBhY2thZ2VNYW5hZ2VyID0gUGFja2FnZU1hbmFnZXIuZnJvbUxvY2tGaWxlKCcvcGF0aC90by9wbnBtLWxvY2sueWFtbCcpO1xuICBleHBlY3QocGFja2FnZU1hbmFnZXIubG9ja0ZpbGUpLnRvRXF1YWwoTG9ja0ZpbGUuUE5QTSk7XG4gIGV4cGVjdChwYWNrYWdlTWFuYWdlci5hcmdzU2VwYXJhdG9yKS50b0VxdWFsKCctLScpO1xuICBleHBlY3QocGFja2FnZU1hbmFnZXIuaW5zdGFsbENvbW1hbmQpLnRvRXF1YWwoWydwbnBtJywgJ2luc3RhbGwnLCAnLS1jb25maWcubm9kZS1saW5rZXI9aG9pc3RlZCcsICctLWNvbmZpZy5wYWNrYWdlLWltcG9ydC1tZXRob2Q9Y2xvbmUtb3ItY29weScsICctLW5vLXByZWZlci1mcm96ZW4tbG9ja2ZpbGUnXSk7XG4gIGV4cGVjdChwYWNrYWdlTWFuYWdlci5ydW5Db21tYW5kKS50b0VxdWFsKFsncG5wbScsICdleGVjJ10pO1xuXG4gIGV4cGVjdChwYWNrYWdlTWFuYWdlci5ydW5CaW5Db21tYW5kKCdteS1iaW4nKSkudG9CZSgncG5wbSBleGVjIC0tIG15LWJpbicpO1xufSk7XG5cbnRlc3QoJ2Zyb20gYSBwbnBtLWxvY2sueWFtbCB3aXRoIExvZ0xldmVsLkVSUk9SJywgKCkgPT4ge1xuICBjb25zdCBwYWNrYWdlTWFuYWdlciA9IFBhY2thZ2VNYW5hZ2VyLmZyb21Mb2NrRmlsZSgnL3BhdGgvdG8vcG5wbS1sb2NrLnlhbWwnLCBMb2dMZXZlbC5FUlJPUik7XG4gIGV4cGVjdChwYWNrYWdlTWFuYWdlci5pbnN0YWxsQ29tbWFuZCkudG9FcXVhbChbJ3BucG0nLCAnaW5zdGFsbCcsICctLXJlcG9ydGVyJywgJ3NpbGVudCcsICctLWNvbmZpZy5ub2RlLWxpbmtlcj1ob2lzdGVkJywgJy0tY29uZmlnLnBhY2thZ2UtaW1wb3J0LW1ldGhvZD1jbG9uZS1vci1jb3B5JywgJy0tbm8tcHJlZmVyLWZyb3plbi1sb2NrZmlsZSddKTtcbn0pO1xuXG50ZXN0KCdkZWZhdWx0cyB0byBOUE0nLCAoKSA9PiB7XG4gIGNvbnN0IHBhY2thZ2VNYW5hZ2VyID0gUGFja2FnZU1hbmFnZXIuZnJvbUxvY2tGaWxlKCcvcGF0aC90by9vdGhlci5sb2NrJyk7XG4gIGV4cGVjdChwYWNrYWdlTWFuYWdlci5sb2NrRmlsZSkudG9FcXVhbChMb2NrRmlsZS5OUE0pO1xufSk7XG5cbnRlc3QoJ1dpbmRvd3MnLCAoKSA9PiB7XG4gIGNvbnN0IG9zUGxhdGZvcm1Nb2NrID0gamVzdC5zcHlPbihvcywgJ3BsYXRmb3JtJykubW9ja1JldHVyblZhbHVlKCd3aW4zMicpO1xuXG4gIGNvbnN0IHBhY2thZ2VNYW5hZ2VyID0gUGFja2FnZU1hbmFnZXIuZnJvbUxvY2tGaWxlKCcvcGF0aC90by93aGF0ZXZlcicpO1xuICBleHBlY3QocGFja2FnZU1hbmFnZXIucnVuQmluQ29tbWFuZCgnbXktYmluJykpLnRvRXF1YWwoJ25weC5jbWQgLS1uby1pbnN0YWxsIG15LWJpbicpO1xuXG4gIG9zUGxhdGZvcm1Nb2NrLm1vY2tSZXN0b3JlKCk7XG59KTtcbiJdfQ==