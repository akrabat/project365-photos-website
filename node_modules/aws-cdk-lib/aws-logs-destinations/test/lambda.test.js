"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const lambda = require("../../aws-lambda");
const logs = require("../../aws-logs");
const cdk = require("../../core");
const dests = require("../lib");
let stack;
let fn;
let logGroup;
beforeEach(() => {
    // GIVEN
    stack = new cdk.Stack();
    fn = new lambda.Function(stack, 'MyLambda', {
        code: new lambda.InlineCode('foo'),
        handler: 'index.handler',
        runtime: lambda.Runtime.NODEJS_14_X,
    });
    logGroup = new logs.LogGroup(stack, 'LogGroup');
});
test('lambda can be used as metric subscription destination', () => {
    // WHEN
    new logs.SubscriptionFilter(stack, 'Subscription', {
        logGroup,
        destination: new dests.LambdaDestination(fn),
        filterPattern: logs.FilterPattern.allEvents(),
    });
    // THEN: subscription target is Lambda
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Logs::SubscriptionFilter', {
        DestinationArn: { 'Fn::GetAtt': ['MyLambdaCCE802FB', 'Arn'] },
    });
    // THEN: Lambda has permissions to be invoked by CWL
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Lambda::Permission', {
        Action: 'lambda:InvokeFunction',
        FunctionName: { 'Fn::GetAtt': ['MyLambdaCCE802FB', 'Arn'] },
        Principal: 'logs.amazonaws.com',
    });
});
test('can have multiple subscriptions use the same Lambda', () => {
    // WHEN
    new logs.SubscriptionFilter(stack, 'Subscription', {
        logGroup,
        destination: new dests.LambdaDestination(fn),
        filterPattern: logs.FilterPattern.allEvents(),
    });
    new logs.SubscriptionFilter(stack, 'Subscription2', {
        logGroup: new logs.LogGroup(stack, 'LG2'),
        destination: new dests.LambdaDestination(fn),
        filterPattern: logs.FilterPattern.allEvents(),
    });
    // THEN: Lambda has permissions to be invoked by CWL from both Source Arns
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Lambda::Permission', {
        Action: 'lambda:InvokeFunction',
        FunctionName: { 'Fn::GetAtt': ['MyLambdaCCE802FB', 'Arn'] },
        SourceArn: { 'Fn::GetAtt': ['LogGroupF5B46931', 'Arn'] },
        Principal: 'logs.amazonaws.com',
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Lambda::Permission', {
        Action: 'lambda:InvokeFunction',
        FunctionName: { 'Fn::GetAtt': ['MyLambdaCCE802FB', 'Arn'] },
        SourceArn: { 'Fn::GetAtt': ['LG224A94C8F', 'Arn'] },
        Principal: 'logs.amazonaws.com',
    });
});
test('lambda permissions are not added when addPermissions is false', () => {
    // WHEN
    new logs.SubscriptionFilter(stack, 'Subscription', {
        logGroup,
        destination: new dests.LambdaDestination(fn, { addPermissions: false }),
        filterPattern: logs.FilterPattern.allEvents(),
    });
    // THEN: subscription target is Lambda
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Logs::SubscriptionFilter', {
        DestinationArn: { 'Fn::GetAtt': ['MyLambdaCCE802FB', 'Arn'] },
    });
    // THEN: Lambda does not have permissions to be invoked by CWL
    expect(assertions_1.Template.fromStack(stack).findResources('AWS::Lambda::Permission', {
        Action: 'lambda:InvokeFunction',
        FunctionName: { 'Fn::GetAtt': ['MyLambdaCCE802FB', 'Arn'] },
        Principal: 'logs.amazonaws.com',
    })).toEqual({});
});
test('subscription depends on lambda\'s permission', () => {
    // WHEN
    new logs.SubscriptionFilter(stack, 'Subscription', {
        logGroup,
        destination: new dests.LambdaDestination(fn),
        filterPattern: logs.FilterPattern.allEvents(),
    });
    // THEN: Subscription filter depends on Lambda's Permission
    assertions_1.Template.fromStack(stack).hasResource('AWS::Logs::SubscriptionFilter', {
        DependsOn: ['SubscriptionCanInvokeLambdaD31DEAD2'],
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGFtYmRhLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJsYW1iZGEudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUE0QztBQUM1QywyQ0FBMkM7QUFDM0MsdUNBQXVDO0FBQ3ZDLGtDQUFrQztBQUNsQyxnQ0FBZ0M7QUFFaEMsSUFBSSxLQUFnQixDQUFDO0FBQ3JCLElBQUksRUFBbUIsQ0FBQztBQUN4QixJQUFJLFFBQXVCLENBQUM7QUFFNUIsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLFFBQVE7SUFDUixLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDeEIsRUFBRSxHQUFHLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsVUFBVSxFQUFFO1FBQzFDLElBQUksRUFBRSxJQUFJLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDO1FBQ2xDLE9BQU8sRUFBRSxlQUFlO1FBQ3hCLE9BQU8sRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVc7S0FDcEMsQ0FBQyxDQUFDO0lBQ0gsUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDLENBQUM7QUFDbEQsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsdURBQXVELEVBQUUsR0FBRyxFQUFFO0lBQ2pFLE9BQU87SUFDUCxJQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsY0FBYyxFQUFFO1FBQ2pELFFBQVE7UUFDUixXQUFXLEVBQUUsSUFBSSxLQUFLLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDO1FBQzVDLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRTtLQUM5QyxDQUFDLENBQUM7SUFFSCxzQ0FBc0M7SUFDdEMscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMsK0JBQStCLEVBQUU7UUFD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QUUsdUJBQXVCO1FBQy9CLFlBQVksRUFBRSxFQUFFLFlBQVksRUFBRSxDQUFDLGtCQUFrQixFQUFFLEtBQUssQ0FBQyxFQUFFO1FBQzNELFNBQVMsRUFBRSxvQkFBb0I7S0FDaEMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ2xCLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLDhDQUE4QyxFQUFFLEdBQUcsRUFBRTtJQUN4RCxPQUFPO0lBQ1AsSUFBSSxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLGNBQWMsRUFBRTtRQUNqRCxRQUFRO1FBQ1IsV0FBVyxFQUFFLElBQUksS0FBSyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQztRQUM1QyxhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUU7S0FDOUMsQ0FBQyxDQUFDO0lBRUgsMkRBQTJEO0lBQzNELHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLFdBQVcsQ0FBQywrQkFBK0IsRUFBRTtRQUNyRSxTQUFTLEVBQUUsQ0FBQyxxQ0FBcUMsQ0FBQztLQUNuRCxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgKiBhcyBsYW1iZGEgZnJvbSAnLi4vLi4vYXdzLWxhbWJkYSc7XG5pbXBvcnQgKiBhcyBsb2dzIGZyb20gJy4uLy4uL2F3cy1sb2dzJztcbmltcG9ydCAqIGFzIGNkayBmcm9tICcuLi8uLi9jb3JlJztcbmltcG9ydCAqIGFzIGRlc3RzIGZyb20gJy4uL2xpYic7XG5cbmxldCBzdGFjazogY2RrLlN0YWNrO1xubGV0IGZuOiBsYW1iZGEuRnVuY3Rpb247XG5sZXQgbG9nR3JvdXA6IGxvZ3MuTG9nR3JvdXA7XG5cbmJlZm9yZUVhY2goKCkgPT4ge1xuICAvLyBHSVZFTlxuICBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgZm4gPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHN0YWNrLCAnTXlMYW1iZGEnLCB7XG4gICAgY29kZTogbmV3IGxhbWJkYS5JbmxpbmVDb2RlKCdmb28nKSxcbiAgICBoYW5kbGVyOiAnaW5kZXguaGFuZGxlcicsXG4gICAgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzE0X1gsXG4gIH0pO1xuICBsb2dHcm91cCA9IG5ldyBsb2dzLkxvZ0dyb3VwKHN0YWNrLCAnTG9nR3JvdXAnKTtcbn0pO1xuXG50ZXN0KCdsYW1iZGEgY2FuIGJlIHVzZWQgYXMgbWV0cmljIHN1YnNjcmlwdGlvbiBkZXN0aW5hdGlvbicsICgpID0+IHtcbiAgLy8gV0hFTlxuICBuZXcgbG9ncy5TdWJzY3JpcHRpb25GaWx0ZXIoc3RhY2ssICdTdWJzY3JpcHRpb24nLCB7XG4gICAgbG9nR3JvdXAsXG4gICAgZGVzdGluYXRpb246IG5ldyBkZXN0cy5MYW1iZGFEZXN0aW5hdGlvbihmbiksXG4gICAgZmlsdGVyUGF0dGVybjogbG9ncy5GaWx0ZXJQYXR0ZXJuLmFsbEV2ZW50cygpLFxuICB9KTtcblxuICAvLyBUSEVOOiBzdWJzY3JpcHRpb24gdGFyZ2V0IGlzIExhbWJkYVxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpMb2dzOjpTdWJzY3JpcHRpb25GaWx0ZXInLCB7XG4gICAgRGVzdGluYXRpb25Bcm46IHsgJ0ZuOjpHZXRBdHQnOiBbJ015TGFtYmRhQ0NFODAyRkInLCAnQXJuJ10gfSxcbiAgfSk7XG5cbiAgLy8gVEhFTjogTGFtYmRhIGhhcyBwZXJtaXNzaW9ucyB0byBiZSBpbnZva2VkIGJ5IENXTFxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpMYW1iZGE6OlBlcm1pc3Npb24nLCB7XG4gICAgQWN0aW9uOiAnbGFtYmRhOkludm9rZUZ1bmN0aW9uJyxcbiAgICBGdW5jdGlvbk5hbWU6IHsgJ0ZuOjpHZXRBdHQnOiBbJ015TGFtYmRhQ0NFODAyRkInLCAnQXJuJ10gfSxcbiAgICBQcmluY2lwYWw6ICdsb2dzLmFtYXpvbmF3cy5jb20nLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdjYW4gaGF2ZSBtdWx0aXBsZSBzdWJzY3JpcHRpb25zIHVzZSB0aGUgc2FtZSBMYW1iZGEnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgbmV3IGxvZ3MuU3Vic2NyaXB0aW9uRmlsdGVyKHN0YWNrLCAnU3Vic2NyaXB0aW9uJywge1xuICAgIGxvZ0dyb3VwLFxuICAgIGRlc3RpbmF0aW9uOiBuZXcgZGVzdHMuTGFtYmRhRGVzdGluYXRpb24oZm4pLFxuICAgIGZpbHRlclBhdHRlcm46IGxvZ3MuRmlsdGVyUGF0dGVybi5hbGxFdmVudHMoKSxcbiAgfSk7XG5cbiAgbmV3IGxvZ3MuU3Vic2NyaXB0aW9uRmlsdGVyKHN0YWNrLCAnU3Vic2NyaXB0aW9uMicsIHtcbiAgICBsb2dHcm91cDogbmV3IGxvZ3MuTG9nR3JvdXAoc3RhY2ssICdMRzInKSxcbiAgICBkZXN0aW5hdGlvbjogbmV3IGRlc3RzLkxhbWJkYURlc3RpbmF0aW9uKGZuKSxcbiAgICBmaWx0ZXJQYXR0ZXJuOiBsb2dzLkZpbHRlclBhdHRlcm4uYWxsRXZlbnRzKCksXG4gIH0pO1xuXG4gIC8vIFRIRU46IExhbWJkYSBoYXMgcGVybWlzc2lvbnMgdG8gYmUgaW52b2tlZCBieSBDV0wgZnJvbSBib3RoIFNvdXJjZSBBcm5zXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkxhbWJkYTo6UGVybWlzc2lvbicsIHtcbiAgICBBY3Rpb246ICdsYW1iZGE6SW52b2tlRnVuY3Rpb24nLFxuICAgIEZ1bmN0aW9uTmFtZTogeyAnRm46OkdldEF0dCc6IFsnTXlMYW1iZGFDQ0U4MDJGQicsICdBcm4nXSB9LFxuICAgIFNvdXJjZUFybjogeyAnRm46OkdldEF0dCc6IFsnTG9nR3JvdXBGNUI0NjkzMScsICdBcm4nXSB9LFxuICAgIFByaW5jaXBhbDogJ2xvZ3MuYW1hem9uYXdzLmNvbScsXG4gIH0pO1xuXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkxhbWJkYTo6UGVybWlzc2lvbicsIHtcbiAgICBBY3Rpb246ICdsYW1iZGE6SW52b2tlRnVuY3Rpb24nLFxuICAgIEZ1bmN0aW9uTmFtZTogeyAnRm46OkdldEF0dCc6IFsnTXlMYW1iZGFDQ0U4MDJGQicsICdBcm4nXSB9LFxuICAgIFNvdXJjZUFybjogeyAnRm46OkdldEF0dCc6IFsnTEcyMjRBOTRDOEYnLCAnQXJuJ10gfSxcbiAgICBQcmluY2lwYWw6ICdsb2dzLmFtYXpvbmF3cy5jb20nLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdsYW1iZGEgcGVybWlzc2lvbnMgYXJlIG5vdCBhZGRlZCB3aGVuIGFkZFBlcm1pc3Npb25zIGlzIGZhbHNlJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIG5ldyBsb2dzLlN1YnNjcmlwdGlvbkZpbHRlcihzdGFjaywgJ1N1YnNjcmlwdGlvbicsIHtcbiAgICBsb2dHcm91cCxcbiAgICBkZXN0aW5hdGlvbjogbmV3IGRlc3RzLkxhbWJkYURlc3RpbmF0aW9uKGZuLCB7IGFkZFBlcm1pc3Npb25zOiBmYWxzZSB9KSxcbiAgICBmaWx0ZXJQYXR0ZXJuOiBsb2dzLkZpbHRlclBhdHRlcm4uYWxsRXZlbnRzKCksXG4gIH0pO1xuXG4gIC8vIFRIRU46IHN1YnNjcmlwdGlvbiB0YXJnZXQgaXMgTGFtYmRhXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkxvZ3M6OlN1YnNjcmlwdGlvbkZpbHRlcicsIHtcbiAgICBEZXN0aW5hdGlvbkFybjogeyAnRm46OkdldEF0dCc6IFsnTXlMYW1iZGFDQ0U4MDJGQicsICdBcm4nXSB9LFxuICB9KTtcblxuICAvLyBUSEVOOiBMYW1iZGEgZG9lcyBub3QgaGF2ZSBwZXJtaXNzaW9ucyB0byBiZSBpbnZva2VkIGJ5IENXTFxuICBleHBlY3QoVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5maW5kUmVzb3VyY2VzKCdBV1M6OkxhbWJkYTo6UGVybWlzc2lvbicsIHtcbiAgICBBY3Rpb246ICdsYW1iZGE6SW52b2tlRnVuY3Rpb24nLFxuICAgIEZ1bmN0aW9uTmFtZTogeyAnRm46OkdldEF0dCc6IFsnTXlMYW1iZGFDQ0U4MDJGQicsICdBcm4nXSB9LFxuICAgIFByaW5jaXBhbDogJ2xvZ3MuYW1hem9uYXdzLmNvbScsXG4gIH0pKS50b0VxdWFsKHt9KTtcbn0pO1xuXG50ZXN0KCdzdWJzY3JpcHRpb24gZGVwZW5kcyBvbiBsYW1iZGFcXCdzIHBlcm1pc3Npb24nLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgbmV3IGxvZ3MuU3Vic2NyaXB0aW9uRmlsdGVyKHN0YWNrLCAnU3Vic2NyaXB0aW9uJywge1xuICAgIGxvZ0dyb3VwLFxuICAgIGRlc3RpbmF0aW9uOiBuZXcgZGVzdHMuTGFtYmRhRGVzdGluYXRpb24oZm4pLFxuICAgIGZpbHRlclBhdHRlcm46IGxvZ3MuRmlsdGVyUGF0dGVybi5hbGxFdmVudHMoKSxcbiAgfSk7XG5cbiAgLy8gVEhFTjogU3Vic2NyaXB0aW9uIGZpbHRlciBkZXBlbmRzIG9uIExhbWJkYSdzIFBlcm1pc3Npb25cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZSgnQVdTOjpMb2dzOjpTdWJzY3JpcHRpb25GaWx0ZXInLCB7XG4gICAgRGVwZW5kc09uOiBbJ1N1YnNjcmlwdGlvbkNhbkludm9rZUxhbWJkYUQzMURFQUQyJ10sXG4gIH0pO1xufSk7XG4iXX0=