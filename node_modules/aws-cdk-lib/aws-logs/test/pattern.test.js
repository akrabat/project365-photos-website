"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../lib");
describe('pattern', () => {
    describe('text patterns', () => {
        test('simple text pattern', () => {
            const pattern = lib_1.FilterPattern.allTerms('foo', 'bar', 'baz');
            expect('"foo" "bar" "baz"').toEqual(pattern.logPatternString);
        });
        test('quoted terms', () => {
            const pattern = lib_1.FilterPattern.allTerms('"foo" he said');
            expect('"\\"foo\\" he said"').toEqual(pattern.logPatternString);
        });
        test('disjunction of conjunctions', () => {
            const pattern = lib_1.FilterPattern.anyTermGroup(['foo', 'bar'], ['baz']);
            expect('?"foo" "bar" ?"baz"').toEqual(pattern.logPatternString);
        });
        test('dont prefix with ? if only one disjunction', () => {
            const pattern = lib_1.FilterPattern.anyTermGroup(['foo', 'bar']);
            expect('"foo" "bar"').toEqual(pattern.logPatternString);
        });
        test('empty log pattern is empty string', () => {
            const pattern = lib_1.FilterPattern.anyTermGroup();
            expect('').toEqual(pattern.logPatternString);
        });
    });
    describe('json patterns', () => {
        test('string value', () => {
            const pattern = lib_1.FilterPattern.stringValue('$.field', '=', 'value');
            expect('{ $.field = "value" }').toEqual(pattern.logPatternString);
        });
        test('also recognize ==', () => {
            const pattern = lib_1.FilterPattern.stringValue('$.field', '==', 'value');
            expect('{ $.field = "value" }').toEqual(pattern.logPatternString);
        });
        test('number patterns', () => {
            const pattern = lib_1.FilterPattern.numberValue('$.field', '<=', 300);
            expect('{ $.field <= 300 }').toEqual(pattern.logPatternString);
        });
        test('combining with AND or OR', () => {
            const p1 = lib_1.FilterPattern.numberValue('$.field', '<=', 300);
            const p2 = lib_1.FilterPattern.stringValue('$.field', '=', 'value');
            const andPattern = lib_1.FilterPattern.all(p1, p2);
            expect('{ ($.field <= 300) && ($.field = "value") }').toEqual(andPattern.logPatternString);
            const orPattern = lib_1.FilterPattern.any(p1, p2);
            expect('{ ($.field <= 300) || ($.field = "value") }').toEqual(orPattern.logPatternString);
        });
        test('single AND is not wrapped with parens', () => {
            const p1 = lib_1.FilterPattern.stringValue('$.field', '=', 'value');
            const pattern = lib_1.FilterPattern.all(p1);
            expect('{ $.field = "value" }').toEqual(pattern.logPatternString);
        });
        test('empty AND is rejected', () => {
            expect(() => {
                lib_1.FilterPattern.all();
            }).toThrow();
        });
        test('invalid string operators are rejected', () => {
            expect(() => {
                lib_1.FilterPattern.stringValue('$.field', '<=', 'hello');
            }).toThrow();
        });
        test('can test boolean value', () => {
            const pattern = lib_1.FilterPattern.booleanValue('$.field', false);
            expect('{ $.field IS FALSE }').toEqual(pattern.logPatternString);
        });
    });
    describe('table patterns', () => {
        test('simple model', () => {
            const pattern = lib_1.FilterPattern.spaceDelimited('...', 'status_code', 'bytes');
            expect(pattern.logPatternString).toEqual('[..., status_code, bytes]');
        });
        test('add restrictions', () => {
            const pattern = lib_1.FilterPattern.spaceDelimited('...', 'status_code', 'bytes')
                .whereString('status_code', '=', '4*')
                .whereNumber('status_code', '!=', 403);
            expect(pattern.logPatternString).toEqual('[..., status_code = "4*" && status_code != 403, bytes]');
        });
        test('cant use more than one ellipsis', () => {
            expect(() => {
                lib_1.FilterPattern.spaceDelimited('...', 'status_code', '...');
            }).toThrow();
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0dGVybi50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGF0dGVybi50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsZ0NBQXVDO0FBRXZDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO0lBQ3ZCLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1FBQzdCLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7WUFDL0IsTUFBTSxPQUFPLEdBQUcsbUJBQWEsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztZQUU1RCxNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDaEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtZQUN4QixNQUFNLE9BQU8sR0FBRyxtQkFBYSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUV4RCxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDbEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO1lBQ3ZDLE1BQU0sT0FBTyxHQUFHLG1CQUFhLENBQUMsWUFBWSxDQUN4QyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsRUFDZCxDQUFDLEtBQUssQ0FBQyxDQUNSLENBQUM7WUFFRixNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDbEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsNENBQTRDLEVBQUUsR0FBRyxFQUFFO1lBQ3RELE1BQU0sT0FBTyxHQUFHLG1CQUFhLENBQUMsWUFBWSxDQUN4QyxDQUFDLEtBQUssRUFB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QyxNQUFNLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUMsT0FBTyxDQUFDLHdEQUF3RCxDQUFDLENBQUM7UUFDckcsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFO1lBQzNDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7Z0JBQ1YsbUJBQWEsQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUM1RCxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNmLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZpbHRlclBhdHRlcm4gfSBmcm9tICcuLi9saWInO1xuXG5kZXNjcmliZSgncGF0dGVybicsICgpID0+IHtcbiAgZGVzY3JpYmUoJ3RleHQgcGF0dGVybnMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2ltcGxlIHRleHQgcGF0dGVybicsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSBGaWx0ZXJQYXR0ZXJuLmFsbFRlcm1zKCdmb28nLCAnYmFyJywgJ2JheicpO1xuXG4gICAgICBleHBlY3QoJ1wiZm9vXCIgXCJiYXJcIiBcImJhelwiJykudG9FcXVhbChwYXR0ZXJuLmxvZ1BhdHRlcm5TdHJpbmcpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgncXVvdGVkIHRlcm1zJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF0dGVybiA9IEZpbHRlclBhdHRlcm4uYWxsVGVybXMoJ1wiZm9vXCIgaGUgc2FpZCcpO1xuXG4gICAgICBleHBlY3QoJ1wiXFxcXFwiZm9vXFxcXFwiIGhlIHNhaWRcIicpLnRvRXF1YWwocGF0dGVybi5sb2dQYXR0ZXJuU3RyaW5nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2Rpc2p1bmN0aW9uIG9mIGNvbmp1bmN0aW9ucycsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSBGaWx0ZXJQYXR0ZXJuLmFueVRlcm1Hcm91cChcbiAgICAgICAgWydmb28nLCAnYmFyJ10sXG4gICAgICAgIFsnYmF6J10sXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoJz9cImZvb1wiIFwiYmFyXCIgP1wiYmF6XCInKS50b0VxdWFsKHBhdHRlcm4ubG9nUGF0dGVyblN0cmluZyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdkb250IHByZWZpeCB3aXRoID8gaWYgb25seSBvbmUgZGlzanVuY3Rpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXR0ZXJuID0gRmlsdGVyUGF0dGVybi5hbnlUZXJtR3JvdXAoXG4gICAgICAgIFsnZm9vJywgJ2JhciddLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KCdcImZvb1wiIFwiYmFyXCInKS50b0VxdWFsKHBhdHRlcm4ubG9nUGF0dGVyblN0cmluZyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdlbXB0eSBsb2cgcGF0dGVybiBpcyBlbXB0eSBzdHJpbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXR0ZXJuID0gRmlsdGVyUGF0dGVybi5hbnlUZXJtR3JvdXAoKTtcblxuICAgICAgZXhwZWN0KCcnKS50b0VxdWFsKHBhdHRlcm4ubG9nUGF0dGVyblN0cmluZyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdqc29uIHBhdHRlcm5zJywgKCkgPT4ge1xuICAgIHRlc3QoJ3N0cmluZyB2YWx1ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSBGaWx0ZXJQYXR0ZXJuLnN0cmluZ1ZhbHVlKCckLmZpZWxkJywgJz0nLCAndmFsdWUnKTtcblxuICAgICAgZXhwZWN0KCd7ICQuZmllbGQgPSBcInZhbHVlXCIgfScpLnRvRXF1YWwocGF0dGVybi5sb2dQYXR0ZXJuU3RyaW5nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2Fsc28gcmVjb2duaXplID09JywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF0dGVybiA9IEZpbHRlclBhdHRlcm4uc3RyaW5nVmFsdWUoJyQuZmllbGQnLCAnPT0nLCAndmFsdWUnKTtcblxuICAgICAgZXhwZWN0KCd7ICQuZmllbGQgPSBcInZhbHVlXCIgfScpLnRvRXF1YWwocGF0dGVybi5sb2dQYXR0ZXJuU3RyaW5nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ251bWJlciBwYXR0ZXJucycsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSBGaWx0ZXJQYXR0ZXJuLm51bWJlclZhbHVlKCckLmZpZWxkJywgJzw9JywgMzAwKTtcblxuICAgICAgZXhwZWN0KCd7ICQuZmllbGQgPD0gMzAwIH0nKS50b0VxdWFsKHBhdHRlcm4ubG9nUGF0dGVyblN0cmluZyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdjb21iaW5pbmcgd2l0aCBBTkQgb3IgT1InLCAoKSA9PiB7XG4gICAgICBjb25zdCBwMSA9IEZpbHRlclBhdHRlcm4ubnVtYmVyVmFsdWUoJyQuZmllbGQnLCAnPD0nLCAzMDApO1xuICAgICAgY29uc3QgcDIgPSBGaWx0ZXJQYXR0ZXJuLnN0cmluZ1ZhbHVlKCckLmZpZWxkJywgJz0nLCAndmFsdWUnKTtcblxuICAgICAgY29uc3QgYW5kUGF0dGVybiA9IEZpbHRlclBhdHRlcm4uYWxsKHAxLCBwMik7XG4gICAgICBleHBlY3QoJ3sgKCQuZmllbGQgPD0gMzAwKSAmJiAoJC5maWVsZCA9IFwidmFsdWVcIikgfScpLnRvRXF1YWwoYW5kUGF0dGVybi5sb2dQYXR0ZXJuU3RyaW5nKTtcblxuICAgICAgY29uc3Qgb3JQYXR0ZXJuID0gRmlsdGVyUGF0dGVybi5hbnkocDEsIHAyKTtcbiAgICAgIGV4cGVjdCgneyAoJC5maWVsZCA8PSAzMDApIHx8ICgkLmZpZWxkID0gXCJ2YWx1ZVwiKSB9JykudG9FcXVhbChvclBhdHRlcm4ubG9nUGF0dGVyblN0cmluZyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaW5nbGUgQU5EIGlzIG5vdCB3cmFwcGVkIHdpdGggcGFyZW5zJywgKCkgPT4ge1xuICAgICAgY29uc3QgcDEgPSBGaWx0ZXJQYXR0ZXJuLnN0cmluZ1ZhbHVlKCckLmZpZWxkJywgJz0nLCAndmFsdWUnKTtcblxuICAgICAgY29uc3QgcGF0dGVybiA9IEZpbHRlclBhdHRlcm4uYWxsKHAxKTtcblxuICAgICAgZXhwZWN0KCd7ICQuZmllbGQgPSBcInZhbHVlXCIgfScpLnRvRXF1YWwocGF0dGVybi5sb2dQYXR0ZXJuU3RyaW5nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2VtcHR5IEFORCBpcyByZWplY3RlZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIEZpbHRlclBhdHRlcm4uYWxsKCk7XG4gICAgICB9KS50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdpbnZhbGlkIHN0cmluZyBvcGVyYXRvcnMgYXJlIHJlamVjdGVkJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgRmlsdGVyUGF0dGVybi5zdHJpbmdWYWx1ZSgnJC5maWVsZCcsICc8PScsICdoZWxsbycpO1xuICAgICAgfSkudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnY2FuIHRlc3QgYm9vbGVhbiB2YWx1ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSBGaWx0ZXJQYXR0ZXJuLmJvb2xlYW5WYWx1ZSgnJC5maWVsZCcsIGZhbHNlKTtcblxuICAgICAgZXhwZWN0KCd7ICQuZmllbGQgSVMgRkFMU0UgfScpLnRvRXF1YWwocGF0dGVybi5sb2dQYXR0ZXJuU3RyaW5nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3RhYmxlIHBhdHRlcm5zJywgKCkgPT4ge1xuICAgIHRlc3QoJ3NpbXBsZSBtb2RlbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSBGaWx0ZXJQYXR0ZXJuLnNwYWNlRGVsaW1pdGVkKCcuLi4nLCAnc3RhdHVzX2NvZGUnLCAnYnl0ZXMnKTtcblxuICAgICAgZXhwZWN0KHBhdHRlcm4ubG9nUGF0dGVyblN0cmluZykudG9FcXVhbCgnWy4uLiwgc3RhdHVzX2NvZGUsIGJ5dGVzXScpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnYWRkIHJlc3RyaWN0aW9ucycsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhdHRlcm4gPSBGaWx0ZXJQYXR0ZXJuLnNwYWNlRGVsaW1pdGVkKCcuLi4nLCAnc3RhdHVzX2NvZGUnLCAnYnl0ZXMnKVxuICAgICAgICAud2hlcmVTdHJpbmcoJ3N0YXR1c19jb2RlJywgJz0nLCAnNConKVxuICAgICAgICAud2hlcmVOdW1iZXIoJ3N0YXR1c19jb2RlJywgJyE9JywgNDAzKTtcblxuICAgICAgZXhwZWN0KHBhdHRlcm4ubG9nUGF0dGVyblN0cmluZykudG9FcXVhbCgnWy4uLiwgc3RhdHVzX2NvZGUgPSBcIjQqXCIgJiYgc3RhdHVzX2NvZGUgIT0gNDAzLCBieXRlc10nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2NhbnQgdXNlIG1vcmUgdGhhbiBvbmUgZWxsaXBzaXMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBGaWx0ZXJQYXR0ZXJuLnNwYWNlRGVsaW1pdGVkKCcuLi4nLCAnc3RhdHVzX2NvZGUnLCAnLi4uJyk7XG4gICAgICB9KS50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=