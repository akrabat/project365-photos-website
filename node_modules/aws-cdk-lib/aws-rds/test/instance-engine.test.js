"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const iam = require("../../aws-iam");
const cdk = require("../../core");
const rds = require("../lib");
describe('instance engine', () => {
    test('default parameterGroupFamily for versionless MariaDB instance engine is not defined', () => {
        const engine = rds.DatabaseInstanceEngine.MARIADB;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual(undefined);
    });
    test('default parameterGroupFamily for versionless MySQL instance engine is not defined', () => {
        const engine = rds.DatabaseInstanceEngine.MYSQL;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual(undefined);
    });
    test('default parameterGroupFamily for versionless PostgreSQL instance engine is not defined', () => {
        const engine = rds.DatabaseInstanceEngine.POSTGRES;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual(undefined);
    });
    test("default parameterGroupFamily for versionless Oracle SE instance engine is 'oracle-se-11.2'", () => {
        const engine = rds.DatabaseInstanceEngine.ORACLE_SE;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual('oracle-se-11.2');
    });
    test("default parameterGroupFamily for versionless Oracle SE 1 instance engine is 'oracle-se1-11.2'", () => {
        const engine = rds.DatabaseInstanceEngine.ORACLE_SE1;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual('oracle-se1-11.2');
    });
    test('default parameterGroupFamily for versionless Oracle SE 2 instance engine is not defined', () => {
        const engine = rds.DatabaseInstanceEngine.ORACLE_SE2;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual(undefined);
    });
    test('default parameterGroupFamily for versionless Oracle SE 2 (CDB) instance engine is not defined', () => {
        const engine = rds.DatabaseInstanceEngine.ORACLE_SE2_CDB;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual(undefined);
    });
    test('default parameterGroupFamily for versionless Oracle EE instance engine is not defined', () => {
        const engine = rds.DatabaseInstanceEngine.ORACLE_EE;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual(undefined);
    });
    test('default parameterGroupFamily for versionless Oracle EE (CDB) instance engine is not defined', () => {
        const engine = rds.DatabaseInstanceEngine.ORACLE_EE_CDB;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual(undefined);
    });
    test('default parameterGroupFamily for versionless SQL Server SE instance engine is not defined', () => {
        const engine = rds.DatabaseInstanceEngine.SQL_SERVER_SE;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual(undefined);
    });
    test('default parameterGroupFamily for versionless SQL Server EX instance engine is not defined', () => {
        const engine = rds.DatabaseInstanceEngine.SQL_SERVER_EX;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual(undefined);
    });
    test('default parameterGroupFamily for versionless SQL Server Web instance engine is not defined', () => {
        const engine = rds.DatabaseInstanceEngine.SQL_SERVER_WEB;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual(undefined);
    });
    test('default parameterGroupFamily for versionless SQL Server EE instance engine is not defined', () => {
        const engine = rds.DatabaseInstanceEngine.SQL_SERVER_EE;
        const family = engine.parameterGroupFamily;
        expect(family).toEqual(undefined);
    });
    describe('Oracle engine bindToInstance', () => {
        test('returns s3 integration feature', () => {
            const engine = rds.DatabaseInstanceEngine.oracleSe2({ version: rds.OracleEngineVersion.VER_19_0_0_0_2020_04_R1 });
            const engineConfig = engine.bindToInstance(new cdk.Stack(), {});
            expect(engineConfig.features?.s3Import).toEqual('S3_INTEGRATION');
            expect(engineConfig.features?.s3Export).toEqual('S3_INTEGRATION');
        });
        test('s3 import/export - creates an option group if needed', () => {
            const stack = new cdk.Stack();
            const engine = rds.DatabaseInstanceEngine.oracleSe2({ version: rds.OracleEngineVersion.VER_19_0_0_0_2020_04_R1 });
            const engineConfig = engine.bindToInstance(stack, {
                optionGroup: undefined,
                s3ImportRole: new iam.Role(stack, 'ImportRole', { assumedBy: new iam.AccountRootPrincipal() }),
            });
            expect(engineConfig.optionGroup).toBeDefined();
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::OptionGroup', {
                EngineName: 'oracle-se2',
                OptionConfigurations: [{
                        OptionName: 'S3_INTEGRATION',
                        OptionVersion: '1.0',
                    }],
            });
        });
        test('s3 import/export - appends to an existing option group if it exists', () => {
            const stack = new cdk.Stack();
            const engine = rds.DatabaseInstanceEngine.oracleSe2({ version: rds.OracleEngineVersion.VER_19_0_0_0_2020_04_R1 });
            const optionGroup = new rds.OptionGroup(stack, 'OptionGroup', {
                engine,
                configurations: [{
                        name: 'MY_OPTION_CONFIG',
                    }],
            });
            const engineConfig = engine.bindToInstance(stack, {
                optionGroup,
                s3ImportRole: new iam.Role(stack, 'ImportRole', { assumedBy: new iam.AccountRootPrincipal() }),
            });
            expect(engineConfig.optionGroup).toEqual(optionGroup);
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::OptionGroup', {
                EngineName: 'oracle-se2',
                OptionConfigurations: [{
                        OptionName: 'MY_OPTION_CONFIG',
                    },
                    {
                        OptionName: 'S3_INTEGRATION',
                        OptionVersion: '1.0',
                    }],
            });
        });
    });
    describe('SQL Server engine bindToInstance', () => {
        test('returns s3 integration feature', () => {
            const engine = rds.DatabaseInstanceEngine.sqlServerSe({ version: rds.SqlServerEngineVersion.VER_14_00_3192_2_V1 });
            const engineConfig = engine.bindToInstance(new cdk.Stack(), {});
            expect(engineConfig.features?.s3Import).toEqual('S3_INTEGRATION');
            expect(engineConfig.features?.s3Export).toEqual('S3_INTEGRATION');
        });
        test('s3 import/export - throws if roles are not equal', () => {
            const stack = new cdk.Stack();
            const engine = rds.DatabaseInstanceEngine.sqlServerSe({ version: rds.SqlServerEngineVersion.VER_14_00_3192_2_V1 });
            const s3ImportRole = new iam.Role(stack, 'ImportRole', { assumedBy: new iam.AccountRootPrincipal() });
            const s3ExportRole = new iam.Role(stack, 'ExportRole', { assumedBy: new iam.AccountRootPrincipal() });
            expect(() => engine.bindToInstance(new cdk.Stack(), { s3ImportRole, s3ExportRole })).toThrow(/S3 import and export roles must be the same/);
            expect(() => engine.bindToInstance(new cdk.Stack(), { s3ImportRole })).not.toThrow();
            expect(() => engine.bindToInstance(new cdk.Stack(), { s3ExportRole })).not.toThrow();
            expect(() => engine.bindToInstance(new cdk.Stack(), { s3ImportRole, s3ExportRole: s3ImportRole })).not.toThrow();
        });
        test('s3 import/export - creates an option group if needed', () => {
            const stack = new cdk.Stack();
            const engine = rds.DatabaseInstanceEngine.sqlServerSe({ version: rds.SqlServerEngineVersion.VER_14_00_3192_2_V1 });
            const engineConfig = engine.bindToInstance(stack, {
                optionGroup: undefined,
                s3ImportRole: new iam.Role(stack, 'ImportRole', { assumedBy: new iam.AccountRootPrincipal() }),
            });
            expect(engineConfig.optionGroup).toBeDefined();
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::OptionGroup', {
                EngineName: 'sqlserver-se',
                OptionConfigurations: [{
                        OptionName: 'SQLSERVER_BACKUP_RESTORE',
                        OptionSettings: [{
                                Name: 'IAM_ROLE_ARN',
                                Value: { 'Fn::GetAtt': ['ImportRole0C9E6F9A', 'Arn'] },
                            }],
                    }],
            });
        });
        test('s3 import/export - appends to an existing option group if it exists', () => {
            const stack = new cdk.Stack();
            const engine = rds.DatabaseInstanceEngine.sqlServerSe({ version: rds.SqlServerEngineVersion.VER_14_00_3192_2_V1 });
            const optionGroup = new rds.OptionGroup(stack, 'OptionGroup', {
                engine,
                configurations: [{
                        name: 'MY_OPTION_CONFIG',
                    }],
            });
            const engineConfig = engine.bindToInstance(stack, {
                optionGroup,
                s3ImportRole: new iam.Role(stack, 'ImportRole', { assumedBy: new iam.AccountRootPrincipal() }),
            });
            expect(engineConfig.optionGroup).toEqual(optionGroup);
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::OptionGroup', {
                EngineName: 'sqlserver-se',
                OptionConfigurations: [{
                        OptionName: 'MY_OPTION_CONFIG',
                    },
                    {
                        OptionName: 'SQLSERVER_BACKUP_RESTORE',
                        OptionSettings: [{
                                Name: 'IAM_ROLE_ARN',
                                Value: { 'Fn::GetAtt': ['ImportRole0C9E6F9A', 'Arn'] },
                            }],
                    }],
            });
        });
    });
    describe('PostgreSQL engine bindToInstance', () => {
        test('returns s3 import/export feature if the version supports it', () => {
            const engineNewerVersion = rds.DatabaseInstanceEngine.postgres({ version: rds.PostgresEngineVersion.VER_15_2 });
            const engineConfig = engineNewerVersion.bindToInstance(new cdk.Stack(), {});
            expect(engineConfig.features?.s3Import).toEqual('s3Import');
            expect(engineConfig.features?.s3Export).toEqual('s3Export');
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5zdGFuY2UtZW5naW5lLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbnN0YW5jZS1lbmdpbmUudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUE0QztBQUM1QyxxQ0FBcUM7QUFDckMsa0NBQWtDO0FBQ2xDLDhCQUE4QjtBQUU5QixRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO0lBQy9CLElBQUksQ0FBQyxxRkFBcUYsRUFBRSxHQUFHLEVBQUU7UUFDL0YsTUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQztRQUVsRCxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsb0JBQW9CLENBQUM7UUFFM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNwQyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxtRkFBbUYsRUFBRSxHQUFHLEVBQUU7UUFDN0YsTUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLHNCQUFzQixDQUFDLEtBQUssQ0FBQztRQUVoRCxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsb0JBQW9CLENBQUM7UUFFM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNwQyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyx3RkFBd0YsRUFBRSxHQUFHLEVBQUU7UUFDbEcsTUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLHNCQUFzQixDQUFDLFFBQVEsQ0FBQztRQUVuRCxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsb0JBQW9CLENBQUM7UUFFM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNwQyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyw0RkFBNEYsRUFBRSxHQUFHLEVBQUU7UUFDdEcsTUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLHNCQUFzQixDQUFDLFNBQVMsQ0FBQztRQUVwRCxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsb0JBQW9CLENBQUM7UUFFM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQzNDLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLCtGQUErRixFQUFFLEdBQUcsRUFBRTtRQUN6RyxNQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsc0JBQXNCLENBQUMsVUFBVSxDQUFDO1FBRXJELE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQztRQUUzQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDNUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMseUZBQXlGLEVBQUUsR0FBRyxFQUFFO1FBQ25HLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxVQUFVLENBQUM7UUFFckQsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixDQUFDO1FBRTNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsK0ZBQStGLEVBQUUsR0FBRyxFQUFFO1FBQ3pHLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxjQUFjLENBQUM7UUFFekQsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixDQUFDO1FBRTNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsdUZBQXVGLEVBQUUsR0FBRyxFQUFFO1FBQ2pHLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxTQUFTLENBQUM7UUFFcEQsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixDQUFDO1FBRTNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsNkZBQTZGLEVBQUUsR0FBRyxFQUFFO1FBQ3ZHLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxhQUFhLENBQUM7UUFFeEQsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixDQUFDO1FBRTNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsMkZBQTJGLEVBQUUsR0FBRyxFQUFFO1FBQ3JHLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxhQUFhLENBQUM7UUFFeEQsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixDQUFDO1FBRTNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsMkZBQTJGLEVBQUUsR0FBRyxFQUFFO1FBQ3JHLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxhQUFhLENBQUM7UUFFeEQsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixDQUFDO1FBRTNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsNEZBQTRGLEVBQUUsR0FBRyxFQUFFO1FBQ3RHLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQyxjQUFjLENBQUM7UUFFekQsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixDQUFDO1FBRTNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENB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QztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsa0NBQWtDLEVBQUUsR0FBRyxFQUFFO1FBQ2hELElBQUksQ0FBQyw2REFBNkQsRUFBRSxHQUFHLEVBQUU7WUFDdkUsTUFBTSxrQkFBa0IsR0FBRyxHQUFHLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBRWhILE1BQU0sWUFBWSxHQUFHLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUM1RSxNQUFNLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDNUQsTUFBTSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzlELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSAnLi4vLi4vYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgKiBhcyByZHMgZnJvbSAnLi4vbGliJztcblxuZGVzY3JpYmUoJ2luc3RhbmNlIGVuZ2luZScsICgpID0+IHtcbiAgdGVzdCgnZGVmYXVsdCBwYXJhbWV0ZXJHcm91cEZhbWlseSBmb3IgdmVyc2lvbmxlc3MgTWFyaWFEQiBpbnN0YW5jZSBlbmdpbmUgaXMgbm90IGRlZmluZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgZW5naW5lID0gcmRzLkRhdGFiYXNlSW5zdGFuY2VFbmdpbmUuTUFSSUFEQjtcblxuICAgIGNvbnN0IGZhbWlseSA9IGVuZ2luZS5wYXJhbWV0ZXJHcm91cEZhbWlseTtcblxuICAgIGV4cGVjdChmYW1pbHkpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgfSk7XG5cbiAgdGVzdCgnZGVmYXVsdCBwYXJhbWV0ZXJHcm91cEZhbWlseSBmb3IgdmVyc2lvbmxlc3MgTXlTUUwgaW5zdGFuY2UgZW5naW5lIGlzIG5vdCBkZWZpbmVkJywgKCkgPT4ge1xuICAgIGNvbnN0IGVuZ2luZSA9IHJkcy5EYXRhYmFzZUluc3RhbmNlRW5naW5lLk1ZU1FMO1xuXG4gICAgY29uc3QgZmFtaWx5ID0gZW5naW5lLnBhcmFtZXRlckdyb3VwRmFtaWx5O1xuXG4gICAgZXhwZWN0KGZhbWlseSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICB9KTtcblxuICB0ZXN0KCdkZWZhdWx0IHBhcmFtZXRlckdyb3VwRmFtaWx5IGZvciB2ZXJzaW9ubGVzcyBQb3N0Z3JlU1FMIGluc3RhbmNlIGVuZ2luZSBpcyBub3QgZGVmaW5lZCcsICgpID0+IHtcbiAgICBjb25zdCBlbmdpbmUgPSByZHMuRGF0YWJhc2VJbnN0YW5jZUVuZ2luZS5QT1NUR1JFUztcblxuICAgIGNvbnN0IGZhbWlseSA9IGVuZ2luZS5wYXJhbWV0ZXJHcm91cEZhbWlseTtcblxuICAgIGV4cGVjdChmYW1pbHkpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgfSk7XG5cbiAgdGVzdChcImRlZmF1bHQgcGFyYW1ldGVyR3JvdXBGYW1pbHkgZm9yIHZlcnNpb25sZXNzIE9yYWNsZSBTRSBpbnN0YW5jZSBlbmdpbmUgaXMgJ29yYWNsZS1zZS0xMS4yJ1wiLCAoKSA9PiB7XG4gICAgY29uc3QgZW5naW5lID0gcmRzLkRhdGFiYXNlSW5zdGFuY2VFbmdpbmUuT1JBQ0xFX1NFO1xuXG4gICAgY29uc3QgZmFtaWx5ID0gZW5naW5lLnBhcmFtZXRlckdyb3VwRmFtaWx5O1xuXG4gICAgZXhwZWN0KGZhbWlseSkudG9FcXVhbCgnb3JhY2xlLXNlLTExLjInKTtcbiAgfSk7XG5cbiAgdGVzdChcImRlZmF1bHQgcGFyYW1ldGVyR3JvdXBGYW1pbHkgZm9yIHZlcnNpb25sZXNzIE9yYWNsZSBTRSAxIGluc3RhbmNlIGVuZ2luZSBpcyAnb3JhY2xlLXNlMS0xMS4yJ1wiLCAoKSA9PiB7XG4gICAgY29uc3QgZW5naW5lID0gcmRzLkRhdGFiYXNlSW5zdGFuY2VFbmdpbmUuT1JBQ0xFX1NFMTtcblxuICAgIGNvbnN0IGZhbWlseSA9IGVuZ2luZS5wYXJhbWV0ZXJHcm91cEZhbWlseTtcblxuICAgIGV4cGVjdChmYW1pbHkpLnRvRXF1YWwoJ29yYWNsZS1zZTEtMTEuMicpO1xuICB9KTtcblxuICB0ZXN0KCdkZWZhdWx0IHBhcmFtZXRlckdyb3VwRmFtaWx5IGZvciB2ZXJzaW9ubGVzcyBPcmFjbGUgU0UgMiBpbnN0YW5jZSBlbmdpbmUgaXMgbm90IGRlZmluZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgZW5naW5lID0gcmRzLkRhdGFiYXNlSW5zdGFuY2VFbmdpbmUuT1JBQ0xFX1NFMjtcblxuICAgIGNvbnN0IGZhbWlseSA9IGVuZ2luZS5wYXJhbWV0ZXJHcm91cEZhbWlseTtcblxuICAgIGV4cGVjdChmYW1pbHkpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgfSk7XG5cbiAgdGVzdCgnZGVmYXVsdCBwYXJhbWV0ZXJHcm91cEZhbWlseSBmb3IgdmVyc2lvbmxlc3MgT3JhY2xlIFNFIDIgKENEQikgaW5zdGFuY2UgZW5naW5lIGlzIG5vdCBkZWZpbmVkJywgKCkgPT4ge1xuICAgIGNvbnN0IGVuZ2luZSA9IHJkcy5EYXRhYmFzZUluc3RhbmNlRW5naW5lLk9SQUNMRV9TRTJfQ0RCO1xuXG4gICAgY29uc3QgZmFtaWx5ID0gZW5naW5lLnBhcmFtZXRlckdyb3VwRmFtaWx5O1xuXG4gICAgZXhwZWN0KGZhbWlseSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICB9KTtcblxuICB0ZXN0KCdkZWZhdWx0IHBhcmFtZXRlckdyb3VwRmFtaWx5IGZvciB2ZXJzaW9ubGVzcyBPcmFjbGUgRUUgaW5zdGFuY2UgZW5naW5lIGlzIG5vdCBkZWZpbmVkJywgKCkgPT4ge1xuICAgIGNvbnN0IGVuZ2luZSA9IHJkcy5EYXRhYmFzZUluc3RhbmNlRW5naW5lLk9SQUNMRV9FRTtcblxuICAgIGNvbnN0IGZhbWlseSA9IGVuZ2luZS5wYXJhbWV0ZXJHcm91cEZhbWlseTtcblxuICAgIGV4cGVjdChmYW1pbHkpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgfSk7XG5cbiAgdGVzdCgnZGVmYXVsdCBwYXJhbWV0ZXJHcm91cEZhbWlseSBmb3IgdmVyc2lvbmxlc3MgT3JhY2xlIEVFIChDREIpIGluc3RhbmNlIGVuZ2luZSBpcyBub3QgZGVmaW5lZCcsICgpID0+IHtcbiAgICBjb25zdCBlbmdpbmUgPSByZHMuRGF0YWJhc2VJbnN0YW5jZUVuZ2luZS5PUkFDTEVfRUVfQ0RCO1xuXG4gICAgY29uc3QgZmFtaWx5ID0gZW5naW5lLnBhcmFtZXRlckdyb3VwRmFtaWx5O1xuXG4gICAgZXhwZWN0KGZhbWlseSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICB9KTtcblxuICB0ZXN0KCdkZWZhdWx0IHBhcmFtZXRlckdyb3VwRmFtaWx5IGZvciB2ZXJzaW9ubGVzcyBTUUwgU2VydmVyIFNFIGluc3RhbmNlIGVuZ2luZSBpcyBub3QgZGVmaW5lZCcsICgpID0+IHtcbiAgICBjb25zdCBlbmdpbmUgPSByZHMuRGF0YWJhc2VJbnN0YW5jZUVuZ2luZS5TUUxfU0VSVkVSX1NFO1xuXG4gICAgY29uc3QgZmFtaWx5ID0gZW5naW5lLnBhcmFtZXRlckdyb3VwRmFtaWx5O1xuXG4gICAgZXhwZWN0KGZhbWlseSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICB9KTtcblxuICB0ZXN0KCdkZWZhdWx0IHBhcmFtZXRlckdyb3VwRmFtaWx5IGZvciB2ZXJzaW9ubGVzcyBTUUwgU2VydmVyIEVYIGluc3RhbmNlIGVuZ2luZSBpcyBub3QgZGVmaW5lZCcsICgpID0+IHtcbiAgICBjb25zdCBlbmdpbmUgPSByZHMuRGF0YWJhc2VJbnN0YW5jZUVuZ2luZS5TUUxfU0VSVkVSX0VYO1xuXG4gICAgY29uc3QgZmFtaWx5ID0gZW5naW5lLnBhcmFtZXRlckdyb3VwRmFtaWx5O1xuXG4gICAgZXhwZWN0KGZhbWlseSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICB9KTtcblxuICB0ZXN0KCdkZWZhdWx0IHBhcmFtZXRlckdyb3VwRmFtaWx5IGZvciB2ZXJzaW9ubGVzcyBTUUwgU2VydmVyIFdlYiBpbnN0YW5jZSBlbmdpbmUgaXMgbm90IGRlZmluZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgZW5naW5lID0gcmRzLkRhdGFiYXNlSW5zdGFuY2VFbmdpbmUuU1FMX1NFUlZFUl9XRUI7XG5cbiAgICBjb25zdCBmYW1pbHkgPSBlbmdpbmUucGFyYW1ldGVyR3JvdXBGYW1pbHk7XG5cbiAgICBleHBlY3QoZmFtaWx5KS50b0VxdWFsKHVuZGVmaW5lZCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2RlZmF1bHQgcGFyYW1ldGVyR3JvdXBGYW1pbHkgZm9yIHZlcnNpb25sZXNzIFNRTCBTZXJ2ZXIgRUUgaW5zdGFuY2UgZW5naW5lIGlzIG5vdCBkZWZpbmVkJywgKCkgPT4ge1xuICAgIGNvbnN0IGVuZ2luZSA9IHJkcy5EYXRhYmFzZUluc3RhbmNlRW5naW5lLlNRTF9TRVJWRVJfRUU7XG5cbiAgICBjb25zdCBmYW1pbHkgPSBlbmdpbmUucGFyYW1ldGVyR3JvdXBGYW1pbHk7XG5cbiAgICBleHBlY3QoZmFtaWx5KS50b0VxdWFsKHVuZGVmaW5lZCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdPcmFjbGUgZW5naW5lIGJpbmRUb0luc3RhbmNlJywgKCkgPT4ge1xuXG4gICAgdGVzdCgncmV0dXJucyBzMyBpbnRlZ3JhdGlvbiBmZWF0dXJlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZW5naW5lID0gcmRzLkRhdGFiYXNlSW5zdGFuY2VFbmdpbmUub3JhY2xlU2UyKHsgdmVyc2lvbjogcmRzLk9yYWNsZUVuZ2luZVZlcnNpb24uVkVSXzE5XzBfMF8wXzIwMjBfMDRfUjEgfSk7XG5cbiAgICAgIGNvbnN0IGVuZ2luZUNvbmZpZyA9IGVuZ2luZS5iaW5kVG9JbnN0YW5jZShuZXcgY2RrLlN0YWNrKCksIHt9KTtcbiAgICAgIGV4cGVjdChlbmdpbmVDb25maWcuZmVhdHVyZXM/LnMzSW1wb3J0KS50b0VxdWFsKCdTM19JTlRFR1JBVElPTicpO1xuICAgICAgZXhwZWN0KGVuZ2luZUNvbmZpZy5mZWF0dXJlcz8uczNFeHBvcnQpLnRvRXF1YWwoJ1MzX0lOVEVHUkFUSU9OJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzMyBpbXBvcnQvZXhwb3J0IC0gY3JlYXRlcyBhbiBvcHRpb24gZ3JvdXAgaWYgbmVlZGVkJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgICBjb25zdCBlbmdpbmUgPSByZHMuRGF0YWJhc2VJbnN0YW5jZUVuZ2luZS5vcmFjbGVTZTIoeyB2ZXJzaW9uOiByZHMuT3JhY2xlRW5naW5lVmVyc2lvbi5WRVJfMTlfMF8wXzBfMjAyMF8wNF9SMSB9KTtcblxuICAgICAgY29uc3QgZW5naW5lQ29uZmlnID0gZW5naW5lLmJpbmRUb0luc3RhbmNlKHN0YWNrLCB7XG4gICAgICAgIG9wdGlvbkdyb3VwOiB1bmRlZmluZWQsXG4gICAgICAgIHMzSW1wb3J0Um9sZTogbmV3IGlhbS5Sb2xlKHN0YWNrLCAnSW1wb3J0Um9sZScsIHsgYXNzdW1lZEJ5OiBuZXcgaWFtLkFjY291bnRSb290UHJpbmNpcGFsKCkgfSksXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGVuZ2luZUNvbmZpZy5vcHRpb25Hcm91cCkudG9CZURlZmluZWQoKTtcbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJEUzo6T3B0aW9uR3JvdXAnLCB7XG4gICAgICAgIEVuZ2luZU5hbWU6ICdvcmFjbGUtc2UyJyxcbiAgICAgICAgT3B0aW9uQ29uZmlndXJhdGlvbnM6IFt7XG4gICAgICAgICAgT3B0aW9uTmFtZTogJ1MzX0lOVEVHUkFUSU9OJyxcbiAgICAgICAgICBPcHRpb25WZXJzaW9uOiAnMS4wJyxcbiAgICAgICAgfV0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3MzIGltcG9ydC9leHBvcnQgLSBhcHBlbmRzIHRvIGFuIGV4aXN0aW5nIG9wdGlvbiBncm91cCBpZiBpdCBleGlzdHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgICAgIGNvbnN0IGVuZ2luZSA9IHJkcy5EYXRhYmFzZUluc3RhbmNlRW5naW5lLm9yYWNsZVNlMih7IHZlcnNpb246IHJkcy5PcmFjbGVFbmdpbmVWZXJzaW9uLlZFUl8xOV8wXzBfMF8yMDIwXzA0X1IxIH0pO1xuICAgICAgY29uc3Qgb3B0aW9uR3JvdXAgPSBuZXcgcmRzLk9wdGlvbkdyb3VwKHN0YWNrLCAnT3B0aW9uR3JvdXAnLCB7XG4gICAgICAgIGVuZ2luZSxcbiAgICAgICAgY29uZmlndXJhdGlvbnM6IFt7XG4gICAgICAgICAgbmFtZTogJ01ZX09QVElPTl9DT05GSUcnLFxuICAgICAgICB9XSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBlbmdpbmVDb25maWcgPSBlbmdpbmUuYmluZFRvSW5zdGFuY2Uoc3RhY2ssIHtcbiAgICAgICAgb3B0aW9uR3JvdXAsXG4gICAgICAgIHMzSW1wb3J0Um9sZTogbmV3IGlhbS5Sb2xlKHN0YWNrLCAnSW1wb3J0Um9sZScsIHsgYXNzdW1lZEJ5OiBuZXcgaWFtLkFjY291bnRSb290UHJpbmNpcGFsKCkgfSksXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGVuZ2luZUNvbmZpZy5vcHRpb25Hcm91cCkudG9FcXVhbChvcHRpb25Hcm91cCk7XG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSRFM6Ok9wdGlvbkdyb3VwJywge1xuICAgICAgICBFbmdpbmVOYW1lOiAnb3JhY2xlLXNlMicsXG4gICAgICAgIE9wdGlvbkNvbmZpZ3VyYXRpb25zOiBbe1xuICAgICAgICAgIE9wdGlvbk5hbWU6ICdNWV9PUFRJT05fQ09ORklHJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIE9wdGlvbk5hbWU6ICdTM19JTlRFR1JBVElPTicsXG4gICAgICAgICAgT3B0aW9uVmVyc2lvbjogJzEuMCcsXG4gICAgICAgIH1dLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTUUwgU2VydmVyIGVuZ2luZSBiaW5kVG9JbnN0YW5jZScsICgpID0+IHtcbiAgICB0ZXN0KCdyZXR1cm5zIHMzIGludGVncmF0aW9uIGZlYXR1cmUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlbmdpbmUgPSByZHMuRGF0YWJhc2VJbnN0YW5jZUVuZ2luZS5zcWxTZXJ2ZXJTZSh7IHZlcnNpb246IHJkcy5TcWxTZXJ2ZXJFbmdpbmVWZXJzaW9uLlZFUl8xNF8wMF8zMTkyXzJfVjEgfSk7XG5cbiAgICAgIGNvbnN0IGVuZ2luZUNvbmZpZyA9IGVuZ2luZS5iaW5kVG9JbnN0YW5jZShuZXcgY2RrLlN0YWNrKCksIHt9KTtcbiAgICAgIGV4cGVjdChlbmdpbmVDb25maWcuZmVhdHVyZXM/LnMzSW1wb3J0KS50b0VxdWFsKCdTM19JTlRFR1JBVElPTicpO1xuICAgICAgZXhwZWN0KGVuZ2luZUNvbmZpZy5mZWF0dXJlcz8uczNFeHBvcnQpLnRvRXF1YWwoJ1MzX0lOVEVHUkFUSU9OJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzMyBpbXBvcnQvZXhwb3J0IC0gdGhyb3dzIGlmIHJvbGVzIGFyZSBub3QgZXF1YWwnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgICAgIGNvbnN0IGVuZ2luZSA9IHJkcy5EYXRhYmFzZUluc3RhbmNlRW5naW5lLnNxbFNlcnZlclNlKHsgdmVyc2lvbjogcmRzLlNxbFNlcnZlckVuZ2luZVZlcnNpb24uVkVSXzE0XzAwXzMxOTJfMl9WMSB9KTtcblxuICAgICAgY29uc3QgczNJbXBvcnRSb2xlID0gbmV3IGlhbS5Sb2xlKHN0YWNrLCAnSW1wb3J0Um9sZScsIHsgYXNzdW1lZEJ5OiBuZXcgaWFtLkFjY291bnRSb290UHJpbmNpcGFsKCkgfSk7XG4gICAgICBjb25zdCBzM0V4cG9ydFJvbGUgPSBuZXcgaWFtLlJvbGUoc3RhY2ssICdFeHBvcnRSb2xlJywgeyBhc3N1bWVkQnk6IG5ldyBpYW0uQWNjb3VudFJvb3RQcmluY2lwYWwoKSB9KTtcblxuICAgICAgZXhwZWN0KCgpID0+IGVuZ2luZS5iaW5kVG9JbnN0YW5jZShuZXcgY2RrLlN0YWNrKCksIHsgczNJbXBvcnRSb2xlLCBzM0V4cG9ydFJvbGUgfSkpLnRvVGhyb3coL1MzIGltcG9ydCBhbmQgZXhwb3J0IHJvbGVzIG11c3QgYmUgdGhlIHNhbWUvKTtcbiAgICAgIGV4cGVjdCgoKSA9PiBlbmdpbmUuYmluZFRvSW5zdGFuY2UobmV3IGNkay5TdGFjaygpLCB7IHMzSW1wb3J0Um9sZSB9KSkubm90LnRvVGhyb3coKTtcbiAgICAgIGV4cGVjdCgoKSA9PiBlbmdpbmUuYmluZFRvSW5zdGFuY2UobmV3IGNkay5TdGFjaygpLCB7IHMzRXhwb3J0Um9sZSB9KSkubm90LnRvVGhyb3coKTtcbiAgICAgIGV4cGVjdCgoKSA9PiBlbmdpbmUuYmluZFRvSW5zdGFuY2UobmV3IGNkay5TdGFjaygpLCB7IHMzSW1wb3J0Um9sZSwgczNFeHBvcnRSb2xlOiBzM0ltcG9ydFJvbGUgfSkpLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzMyBpbXBvcnQvZXhwb3J0IC0gY3JlYXRlcyBhbiBvcHRpb24gZ3JvdXAgaWYgbmVlZGVkJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgICBjb25zdCBlbmdpbmUgPSByZHMuRGF0YWJhc2VJbnN0YW5jZUVuZ2luZS5zcWxTZXJ2ZXJTZSh7IHZlcnNpb246IHJkcy5TcWxTZXJ2ZXJFbmdpbmVWZXJzaW9uLlZFUl8xNF8wMF8zMTkyXzJfVjEgfSk7XG5cbiAgICAgIGNvbnN0IGVuZ2luZUNvbmZpZyA9IGVuZ2luZS5iaW5kVG9JbnN0YW5jZShzdGFjaywge1xuICAgICAgICBvcHRpb25Hcm91cDogdW5kZWZpbmVkLFxuICAgICAgICBzM0ltcG9ydFJvbGU6IG5ldyBpYW0uUm9sZShzdGFjaywgJ0ltcG9ydFJvbGUnLCB7IGFzc3VtZWRCeTogbmV3IGlhbS5BY2NvdW50Um9vdFByaW5jaXBhbCgpIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChlbmdpbmVDb25maWcub3B0aW9uR3JvdXApLnRvQmVEZWZpbmVkKCk7XG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSRFM6Ok9wdGlvbkdyb3VwJywge1xuICAgICAgICBFbmdpbmVOYW1lOiAnc3Fsc2VydmVyLXNlJyxcbiAgICAgICAgT3B0aW9uQ29uZmlndXJhdGlvbnM6IFt7XG4gICAgICAgICAgT3B0aW9uTmFtZTogJ1NRTFNFUlZFUl9CQUNLVVBfUkVTVE9SRScsXG4gICAgICAgICAgT3B0aW9uU2V0dGluZ3M6IFt7XG4gICAgICAgICAgICBOYW1lOiAnSUFNX1JPTEVfQVJOJyxcbiAgICAgICAgICAgIFZhbHVlOiB7ICdGbjo6R2V0QXR0JzogWydJbXBvcnRSb2xlMEM5RTZGOUEnLCAnQXJuJ10gfSxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfV0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3MzIGltcG9ydC9leHBvcnQgLSBhcHBlbmRzIHRvIGFuIGV4aXN0aW5nIG9wdGlvbiBncm91cCBpZiBpdCBleGlzdHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgICAgIGNvbnN0IGVuZ2luZSA9IHJkcy5EYXRhYmFzZUluc3RhbmNlRW5naW5lLnNxbFNlcnZlclNlKHsgdmVyc2lvbjogcmRzLlNxbFNlcnZlckVuZ2luZVZlcnNpb24uVkVSXzE0XzAwXzMxOTJfMl9WMSB9KTtcbiAgICAgIGNvbnN0IG9wdGlvbkdyb3VwID0gbmV3IHJkcy5PcHRpb25Hcm91cChzdGFjaywgJ09wdGlvbkdyb3VwJywge1xuICAgICAgICBlbmdpbmUsXG4gICAgICAgIGNvbmZpZ3VyYXRpb25zOiBbe1xuICAgICAgICAgIG5hbWU6ICdNWV9PUFRJT05fQ09ORklHJyxcbiAgICAgICAgfV0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgZW5naW5lQ29uZmlnID0gZW5naW5lLmJpbmRUb0luc3RhbmNlKHN0YWNrLCB7XG4gICAgICAgIG9wdGlvbkdyb3VwLFxuICAgICAgICBzM0ltcG9ydFJvbGU6IG5ldyBpYW0uUm9sZShzdGFjaywgJ0ltcG9ydFJvbGUnLCB7IGFzc3VtZWRCeTogbmV3IGlhbS5BY2NvdW50Um9vdFByaW5jaXBhbCgpIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChlbmdpbmVDb25maWcub3B0aW9uR3JvdXApLnRvRXF1YWwob3B0aW9uR3JvdXApO1xuICAgICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6UkRTOjpPcHRpb25Hcm91cCcsIHtcbiAgICAgICAgRW5naW5lTmFtZTogJ3NxbHNlcnZlci1zZScsXG4gICAgICAgIE9wdGlvbkNvbmZpZ3VyYXRpb25zOiBbe1xuICAgICAgICAgIE9wdGlvbk5hbWU6ICdNWV9PUFRJT05fQ09ORklHJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIE9wdGlvbk5hbWU6ICdTUUxTRVJWRVJfQkFDS1VQX1JFU1RPUkUnLFxuICAgICAgICAgIE9wdGlvblNldHRpbmdzOiBbe1xuICAgICAgICAgICAgTmFtZTogJ0lBTV9ST0xFX0FSTicsXG4gICAgICAgICAgICBWYWx1ZTogeyAnRm46OkdldEF0dCc6IFsnSW1wb3J0Um9sZTBDOUU2RjlBJywgJ0FybiddIH0sXG4gICAgICAgICAgfV0sXG4gICAgICAgIH1dLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQb3N0Z3JlU1FMIGVuZ2luZSBiaW5kVG9JbnN0YW5jZScsICgpID0+IHtcbiAgICB0ZXN0KCdyZXR1cm5zIHMzIGltcG9ydC9leHBvcnQgZmVhdHVyZSBpZiB0aGUgdmVyc2lvbiBzdXBwb3J0cyBpdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGVuZ2luZU5ld2VyVmVyc2lvbiA9IHJkcy5EYXRhYmFzZUluc3RhbmNlRW5naW5lLnBvc3RncmVzKHsgdmVyc2lvbjogcmRzLlBvc3RncmVzRW5naW5lVmVyc2lvbi5WRVJfMTVfMiB9KTtcblxuICAgICAgY29uc3QgZW5naW5lQ29uZmlnID0gZW5naW5lTmV3ZXJWZXJzaW9uLmJpbmRUb0luc3RhbmNlKG5ldyBjZGsuU3RhY2soKSwge30pO1xuICAgICAgZXhwZWN0KGVuZ2luZUNvbmZpZy5mZWF0dXJlcz8uczNJbXBvcnQpLnRvRXF1YWwoJ3MzSW1wb3J0Jyk7XG4gICAgICBleHBlY3QoZW5naW5lQ29uZmlnLmZlYXR1cmVzPy5zM0V4cG9ydCkudG9FcXVhbCgnczNFeHBvcnQnKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==