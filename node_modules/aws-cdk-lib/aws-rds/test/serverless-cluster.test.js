"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const ec2 = require("../../aws-ec2");
const iam = require("../../aws-iam");
const kms = require("../../aws-kms");
const cdk = require("../../core");
const cxapi = require("../../cx-api");
const lib_1 = require("../lib");
describe('serverless cluster', () => {
    test('can create a Serverless Cluster with Aurora Postgres database engine', () => {
        // GIVEN
        const stack = testStack();
        const vpc = new ec2.Vpc(stack, 'VPC');
        // WHEN
        new lib_1.ServerlessCluster(stack, 'ServerlessDatabase', {
            engine: lib_1.DatabaseClusterEngine.AURORA_POSTGRESQL,
            vpc,
            credentials: {
                username: 'admin',
                password: cdk.SecretValue.unsafePlainText('tooshort'),
            },
            parameterGroup: lib_1.ParameterGroup.fromParameterGroupName(stack, 'ParameterGroup', 'default.aurora-postgresql10'),
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResource('AWS::RDS::DBCluster', {
            Properties: {
                Engine: 'aurora-postgresql',
                CopyTagsToSnapshot: true,
                DBClusterParameterGroupName: 'default.aurora-postgresql10',
                DBSubnetGroupName: {
                    Ref: 'ServerlessDatabaseSubnets5643CD76',
                },
                EngineMode: 'serverless',
                MasterUsername: 'admin',
                MasterUserPassword: 'tooshort',
                StorageEncrypted: true,
                VpcSecurityGroupIds: [
                    {
                        'Fn::GetAtt': [
                            'ServerlessDatabaseSecurityGroupB00D8C0F',
                            'GroupId',
                        ],
                    },
                ],
            },
            DeletionPolicy: 'Snapshot',
            UpdateReplacePolicy: 'Snapshot',
        });
    });
    test('can create a Serverless Cluster with Aurora Mysql database engine', () => {
        // GIVEN
        const stack = testStack();
        const vpc = new ec2.Vpc(stack, 'VPC');
        // WHEN
        new lib_1.ServerlessCluster(stack, 'ServerlessDatabase', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResource('AWS::RDS::DBCluster', {
            Properties: {
                Engine: 'aurora-mysql',
                CopyTagsToSnapshot: true,
                DBClusterParameterGroupName: 'default.aurora-mysql5.7',
                DBSubnetGroupName: {
                    Ref: 'ServerlessDatabaseSubnets5643CD76',
                },
                EngineMode: 'serverless',
                MasterUsername: {
                    'Fn::Join': ['', [
                            '{{resolve:secretsmanager:',
                            { Ref: 'ServerlessDatabaseSecret1C9BF4F1' },
                            ':SecretString:username::}}',
                        ]],
                },
                MasterUserPassword: {
                    'Fn::Join': ['', [
                            '{{resolve:secretsmanager:',
                            { Ref: 'ServerlessDatabaseSecret1C9BF4F1' },
                            ':SecretString:password::}}',
                        ]],
                },
                StorageEncrypted: true,
                VpcSecurityGroupIds: [
                    {
                        'Fn::GetAtt': [
                            'ServerlessDatabaseSecurityGroupB00D8C0F',
                            'GroupId',
                        ],
                    },
                ],
            },
            DeletionPolicy: 'Snapshot',
            UpdateReplacePolicy: 'Snapshot',
        });
    });
    test('can create a Serverless cluster with imported vpc and security group', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', {
            vpcId: 'VPC12345',
        });
        const sg = ec2.SecurityGroup.fromSecurityGroupId(stack, 'SG', 'SecurityGroupId12345');
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_POSTGRESQL,
            vpc,
            securityGroups: [sg],
            parameterGroup: lib_1.ParameterGroup.fromParameterGroupName(stack, 'ParameterGroup', 'default.aurora-postgresql10'),
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            Engine: 'aurora-postgresql',
            DBClusterParameterGroupName: 'default.aurora-postgresql10',
            EngineMode: 'serverless',
            DBSubnetGroupName: { Ref: 'DatabaseSubnets56F17B9A' },
            MasterUsername: {
                'Fn::Join': ['', [
                        '{{resolve:secretsmanager:',
                        { Ref: 'DatabaseSecret3B817195' },
                        ':SecretString:username::}}',
                    ]],
            },
            MasterUserPassword: {
                'Fn::Join': ['', [
                        '{{resolve:secretsmanager:',
                        { Ref: 'DatabaseSecret3B817195' },
                        ':SecretString:password::}}',
                    ]],
            },
            VpcSecurityGroupIds: ['SecurityGroupId12345'],
        });
    });
    test("sets the retention policy of the SubnetGroup to 'Retain' if the Serverless Cluster is created with 'Retain'", () => {
        const stack = new cdk.Stack();
        const vpc = new ec2.Vpc(stack, 'Vpc');
        new lib_1.ServerlessCluster(stack, 'Cluster', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            removalPolicy: cdk.RemovalPolicy.RETAIN,
        });
        assertions_1.Template.fromStack(stack).hasResource('AWS::RDS::DBSubnetGroup', {
            DeletionPolicy: 'Retain',
            UpdateReplacePolicy: 'Retain',
        });
    });
    test('creates a secret when master credentials are not specified', () => {
        // GIVEN
        const stack = testStack();
        const vpc = new ec2.Vpc(stack, 'VPC');
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            credentials: {
                username: 'myuser',
                excludeCharacters: '"@/\\',
            },
            vpc,
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            MasterUsername: {
                'Fn::Join': ['', [
                        '{{resolve:secretsmanager:',
                        { Ref: 'DatabaseSecret3B817195' },
                        ':SecretString:username::}}',
                    ]],
            },
            MasterUserPassword: {
                'Fn::Join': ['', [
                        '{{resolve:secretsmanager:',
                        { Ref: 'DatabaseSecret3B817195' },
                        ':SecretString:password::}}',
                    ]],
            },
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::SecretsManager::Secret', {
            GenerateSecretString: {
                ExcludeCharacters: '"@/\\',
                GenerateStringKey: 'password',
                PasswordLength: 30,
                SecretStringTemplate: '{"username":"myuser"}',
            },
        });
    });
    test('create an Serverless cluster with custom KMS key for storage', () => {
        // GIVEN
        const stack = testStack();
        const vpc = new ec2.Vpc(stack, 'VPC');
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            storageEncryptionKey: new kms.Key(stack, 'Key'),
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            KmsKeyId: {
                'Fn::GetAtt': [
                    'Key961B73FD',
                    'Arn',
                ],
            },
        });
    });
    test('create a cluster using a specific version of Postgresql', () => {
        // GIVEN
        const stack = testStack();
        const vpc = new ec2.Vpc(stack, 'VPC');
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.auroraPostgres({
                version: lib_1.AuroraPostgresEngineVersion.VER_10_7,
            }),
            vpc,
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            Engine: 'aurora-postgresql',
            EngineMode: 'serverless',
            EngineVersion: '10.7',
        });
    });
    test('cluster exposes different read and write endpoints', () => {
        // GIVEN
        const stack = testStack();
        const vpc = new ec2.Vpc(stack, 'VPC');
        // WHEN
        const cluster = new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA,
            credentials: {
                username: 'admin',
            },
            vpc,
        });
        // THEN
        expect(stack.resolve(cluster.clusterEndpoint)).not
            .toEqual(stack.resolve(cluster.clusterReadEndpoint));
    });
    test('imported cluster with imported security group honors allowAllOutbound', () => {
        // GIVEN
        const stack = testStack();
        const cluster = lib_1.ServerlessCluster.fromServerlessClusterAttributes(stack, 'Database', {
            clusterEndpointAddress: 'addr',
            clusterIdentifier: 'identifier',
            port: 3306,
            readerEndpointAddress: 'reader-address',
            securityGroups: [ec2.SecurityGroup.fromSecurityGroupId(stack, 'SG', 'sg-123456789', {
                    allowAllOutbound: false,
                })],
        });
        // WHEN
        cluster.connections.allowToAnyIpv4(ec2.Port.tcp(443));
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::EC2::SecurityGroupEgress', {
            GroupId: 'sg-123456789',
        });
    });
    test('can import a serverless cluster with minimal attributes', () => {
        const stack = testStack();
        const cluster = lib_1.ServerlessCluster.fromServerlessClusterAttributes(stack, 'Database', {
            clusterIdentifier: 'identifier',
        });
        expect(cluster.clusterIdentifier).toEqual('identifier');
    });
    test('minimal imported cluster throws on accessing attributes for missing parameters', () => {
        const stack = testStack();
        const cluster = lib_1.ServerlessCluster.fromServerlessClusterAttributes(stack, 'Database', {
            clusterIdentifier: 'identifier',
        });
        expect(() => cluster.clusterEndpoint).toThrow(/Cannot access `clusterEndpoint` of an imported cluster/);
        expect(() => cluster.clusterReadEndpoint).toThrow(/Cannot access `clusterReadEndpoint` of an imported cluster/);
    });
    test('imported cluster can access properties if attributes are provided', () => {
        const stack = testStack();
        const cluster = lib_1.ServerlessCluster.fromServerlessClusterAttributes(stack, 'Database', {
            clusterEndpointAddress: 'addr',
            clusterIdentifier: 'identifier',
            port: 3306,
            readerEndpointAddress: 'reader-address',
            securityGroups: [ec2.SecurityGroup.fromSecurityGroupId(stack, 'SG', 'sg-123456789', {
                    allowAllOutbound: false,
                })],
        });
        expect(cluster.clusterEndpoint.socketAddress).toEqual('addr:3306');
        expect(cluster.clusterReadEndpoint.socketAddress).toEqual('reader-address:3306');
    });
    test('throws when trying to add single-user rotation to a serverless cluster without secret', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const vpc = new ec2.Vpc(stack, 'VPC');
        // WHEN
        const cluster = new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            credentials: {
                username: 'admin',
                password: cdk.SecretValue.unsafePlainText('tooshort'),
            },
            vpc,
        });
        // THEN
        expect(() => cluster.addRotationSingleUser()).toThrow(/without secret/);
    });
    test('throws when trying to add single user rotation multiple times', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const vpc = new ec2.Vpc(stack, 'VPC');
        const cluster = new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            credentials: { username: 'admin' },
            vpc,
        });
        // WHEN
        cluster.addRotationSingleUser();
        // THEN
        expect(() => cluster.addRotationSingleUser()).toThrow(/A single user rotation was already added to this cluster/);
    });
    test('throws when trying to add single-user rotation to a serverless cluster without VPC', () => {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        const cluster = new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
        });
        // THEN
        expect(() => {
            cluster.addRotationSingleUser();
        }).toThrow(/Cannot add single user rotation for a cluster without VPC/);
    });
    test('throws when trying to add multi-user rotation to a serverless cluster without VPC', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const secret = new lib_1.DatabaseSecret(stack, 'Secret', {
            username: 'admin',
        });
        // WHEN
        const cluster = new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
        });
        // THEN
        expect(() => {
            cluster.addRotationMultiUser('someId', { secret });
        }).toThrow(/Cannot add multi user rotation for a cluster without VPC/);
    });
    test('can set deletion protection', () => {
        // GIVEN
        const stack = testStack();
        const vpc = new ec2.Vpc(stack, 'VPC');
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            deletionProtection: true,
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            DeletionProtection: true,
        });
    });
    test('can set backup retention', () => {
        // GIVEN
        const stack = testStack();
        const vpc = new ec2.Vpc(stack, 'VPC');
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            backupRetention: cdk.Duration.days(2),
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            BackupRetentionPeriod: 2,
        });
    });
    test('does not throw (but adds a node error) if a (dummy) VPC does not have sufficient subnets', () => {
        // GIVEN
        const app = new cdk.App();
        const stack = testStack(app, 'TestStack');
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            vpcSubnets: {
                subnetName: 'DefinitelyDoesNotExist',
            },
        });
        // THEN
        const art = app.synth().getStackArtifact('TestStack');
        const meta = art.findMetadataByType('aws:cdk:error');
        expect(meta[0].data).toEqual('Cluster requires at least 2 subnets, got 0');
    });
    test('can set scaling configuration', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            scaling: {
                minCapacity: lib_1.AuroraCapacityUnit.ACU_1,
                maxCapacity: lib_1.AuroraCapacityUnit.ACU_128,
                autoPause: cdk.Duration.minutes(10),
            },
        });
        //THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            ScalingConfiguration: {
                AutoPause: true,
                MaxCapacity: 128,
                MinCapacity: 1,
                SecondsUntilAutoPause: 600,
            },
        });
    });
    test('can enable Data API', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            enableDataApi: true,
        });
        //THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            EnableHttpEndpoint: true,
        });
    });
    test('default scaling options', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            scaling: {},
        });
        //THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            ScalingConfiguration: {
                AutoPause: true,
            },
        });
    });
    test('auto pause is disabled if a time of zero is specified', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            scaling: {
                autoPause: cdk.Duration.seconds(0),
            },
        });
        //THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            ScalingConfiguration: {
                AutoPause: false,
            },
        });
    });
    test('throws when invalid auto pause time is specified', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        // WHEN
        expect(() => new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            scaling: {
                autoPause: cdk.Duration.seconds(30),
            },
        })).toThrow(/auto pause time must be between 5 minutes and 1 day./);
        expect(() => new lib_1.ServerlessCluster(stack, 'Another Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            scaling: {
                autoPause: cdk.Duration.days(2),
            },
        })).toThrow(/auto pause time must be between 5 minutes and 1 day./);
    });
    test('throws when invalid backup retention period is specified', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        // WHEN
        expect(() => new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            backupRetention: cdk.Duration.days(0),
        })).toThrow(/backup retention period must be between 1 and 35 days. received: 0/);
        expect(() => new lib_1.ServerlessCluster(stack, 'Another Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            backupRetention: cdk.Duration.days(36),
        })).toThrow(/backup retention period must be between 1 and 35 days. received: 36/);
    });
    test('throws error when min capacity is greater than max capacity', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        // WHEN
        expect(() => new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            scaling: {
                minCapacity: lib_1.AuroraCapacityUnit.ACU_2,
                maxCapacity: lib_1.AuroraCapacityUnit.ACU_1,
            },
        })).toThrow(/maximum capacity must be greater than or equal to minimum capacity./);
    });
    test('check that clusterArn property works', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        const cluster = new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
        });
        const exportName = 'DbCluterArn';
        // WHEN
        new cdk.CfnOutput(stack, exportName, {
            exportName,
            value: cluster.clusterArn,
        });
        // THEN
        expect(stack.resolve(cluster.clusterArn)).toEqual({
            'Fn::Join': ['', [
                    'arn:',
                    { Ref: 'AWS::Partition' },
                    ':rds:us-test-1:12345:cluster:',
                    { Ref: 'DatabaseB269D8BB' },
                ]],
        });
    });
    test('can grant Data API access', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        const cluster = new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            enableDataApi: true,
        });
        const user = new iam.User(stack, 'User');
        // WHEN
        cluster.grantDataApiAccess(user);
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
            PolicyDocument: {
                Statement: [
                    {
                        Action: [
                            'rds-data:BatchExecuteStatement',
                            'rds-data:BeginTransaction',
                            'rds-data:CommitTransaction',
                            'rds-data:ExecuteStatement',
                            'rds-data:RollbackTransaction',
                        ],
                        Effect: 'Allow',
                        Resource: '*',
                    },
                    {
                        Action: [
                            'secretsmanager:GetSecretValue',
                            'secretsmanager:DescribeSecret',
                        ],
                        Effect: 'Allow',
                        Resource: {
                            Ref: 'DatabaseSecretAttachmentE5D1B020',
                        },
                    },
                ],
                Version: '2012-10-17',
            },
            PolicyName: 'UserDefaultPolicy1F97781E',
            Users: [
                {
                    Ref: 'User00B015A1',
                },
            ],
        });
    });
    test('can grant Data API access on imported cluster with given secret', () => {
        // GIVEN
        const stack = testStack();
        const secret = new lib_1.DatabaseSecret(stack, 'Secret', {
            username: 'admin',
        });
        const cluster = lib_1.ServerlessCluster.fromServerlessClusterAttributes(stack, 'Cluster', {
            clusterIdentifier: 'ImportedDatabase',
            secret,
        });
        const user = new iam.User(stack, 'User');
        // WHEN
        cluster.grantDataApiAccess(user);
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
            PolicyDocument: {
                Statement: [
                    {
                        Action: [
                            'rds-data:BatchExecuteStatement',
                            'rds-data:BeginTransaction',
                            'rds-data:CommitTransaction',
                            'rds-data:ExecuteStatement',
                            'rds-data:RollbackTransaction',
                        ],
                        Effect: 'Allow',
                        Resource: '*',
                    },
                    {
                        Action: [
                            'secretsmanager:GetSecretValue',
                            'secretsmanager:DescribeSecret',
                        ],
                        Effect: 'Allow',
                        Resource: {
                            Ref: 'SecretA720EF05',
                        },
                    },
                ],
                Version: '2012-10-17',
            },
            PolicyName: 'UserDefaultPolicy1F97781E',
            Users: [
                {
                    Ref: 'User00B015A1',
                },
            ],
        });
    });
    test('grant Data API access enables the Data API', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        const cluster = new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
        });
        const user = new iam.User(stack, 'User');
        // WHEN
        cluster.grantDataApiAccess(user);
        //THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            EnableHttpEndpoint: true,
        });
    });
    test('grant Data API access throws if the Data API is disabled', () => {
        // GIVEN
        const stack = testStack();
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        const cluster = new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            enableDataApi: false,
        });
        const user = new iam.User(stack, 'User');
        // WHEN
        expect(() => cluster.grantDataApiAccess(user)).toThrow(/Cannot grant Data API access when the Data API is disabled/);
    });
    test('changes the case of the cluster identifier if the lowercaseDbIdentifier feature flag is enabled', () => {
        // GIVEN
        const app = new cdk.App({
            context: { [cxapi.RDS_LOWERCASE_DB_IDENTIFIER]: true },
        });
        const stack = testStack(app);
        const clusterIdentifier = 'TestClusterIdentifier';
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            clusterIdentifier,
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            DBClusterIdentifier: clusterIdentifier.toLowerCase(),
        });
    });
    test('does not change the case of the cluster identifier if the lowercaseDbIdentifier feature flag is disabled', () => {
        // GIVEN
        const app = new cdk.App({ context: { '@aws-cdk/aws-rds:lowercaseDbIdentifier': false } });
        const stack = testStack(app);
        const clusterIdentifier = 'TestClusterIdentifier';
        const vpc = ec2.Vpc.fromLookup(stack, 'VPC', { isDefault: true });
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpc,
            clusterIdentifier,
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            DBClusterIdentifier: clusterIdentifier,
        });
    });
    test('can create a Serverless cluster without VPC', () => {
        // GIVEN
        const stack = testStack();
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            Engine: 'aurora-mysql',
            EngineMode: 'serverless',
            DbSubnetGroupName: assertions_1.Match.absent(),
            VpcSecurityGroupIds: [],
        });
    });
    test('cannot create a Serverless cluster without VPC but specifying a security group', () => {
        // GIVEN
        const stack = testStack();
        const sg = ec2.SecurityGroup.fromSecurityGroupId(stack, 'SG', 'SecurityGroupId12345');
        // THEN
        expect(() => new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            securityGroups: [sg],
        })).toThrow(/A VPC is required to use securityGroups in ServerlessCluster. Please add a VPC or remove securityGroups/);
    });
    test('cannot create a Serverless cluster without VPC but specifying a subnet group', () => {
        // GIVEN
        const stack = testStack();
        const SubnetGroupName = 'SubnetGroupId12345';
        const subnetGroup = lib_1.SubnetGroup.fromSubnetGroupName(stack, 'SubnetGroup12345', SubnetGroupName);
        // THEN
        expect(() => new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            subnetGroup,
        })).toThrow(/A VPC is required to use subnetGroup in ServerlessCluster. Please add a VPC or remove subnetGroup/);
    });
    test('cannot create a Serverless cluster without VPC but specifying VPC subnets', () => {
        // GIVEN
        const stack = testStack();
        // WHEN
        const vpcSubnets = {
            subnetName: 'AVpcSubnet',
        };
        // THEN
        expect(() => new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            vpcSubnets,
        })).toThrow(/A VPC is required to use vpcSubnets in ServerlessCluster. Please add a VPC or remove vpcSubnets/);
    });
    test('can call exportValue on endpoint.port', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const vpc = new ec2.Vpc(stack, 'VPC');
        const cluster = new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_MYSQL,
            credentials: { username: 'admin' },
            vpc,
        });
        // WHEN
        stack.exportValue(cluster.clusterEndpoint.port);
        // THEN
        const template = assertions_1.Template.fromStack(stack);
        template.hasOutput('ExportsOutputFnGetAttDatabaseB269D8BBEndpointPort3ACB3F51', {
            Value: { 'Fn::GetAtt': ['DatabaseB269D8BB', 'Endpoint.Port'] },
            Export: { Name: 'Default:ExportsOutputFnGetAttDatabaseB269D8BBEndpointPort3ACB3F51' },
        });
    });
    test('cluster with copyTagsToSnapshot default', () => {
        // GIVEN
        const stack = testStack();
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA,
            parameterGroup: lib_1.ParameterGroup.fromParameterGroupName(stack, 'ParameterGroup', 'default.aurora-postgresql10'),
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            CopyTagsToSnapshot: true,
        });
    });
    test('cluster with copyTagsToSnapshot disabled', () => {
        // GIVEN
        const stack = testStack();
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_POSTGRESQL,
            copyTagsToSnapshot: false,
            parameterGroup: lib_1.ParameterGroup.fromParameterGroupName(stack, 'ParameterGroup', 'default.aurora-postgresql10'),
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            CopyTagsToSnapshot: false,
        });
    });
    test('cluster with copyTagsToSnapshot enabled', () => {
        // GIVEN
        const stack = testStack();
        // WHEN
        new lib_1.ServerlessCluster(stack, 'Database', {
            engine: lib_1.DatabaseClusterEngine.AURORA_POSTGRESQL,
            copyTagsToSnapshot: true,
            parameterGroup: lib_1.ParameterGroup.fromParameterGroupName(stack, 'ParameterGroup', 'default.aurora-postgresql10'),
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::RDS::DBCluster', {
            CopyTagsToSnapshot: true,
        });
    });
});
function testStack(app, id) {
    const stack = new cdk.Stack(app, id, { env: { account: '12345', region: 'us-test-1' } });
    stack.node.setContext('availability-zones:12345:us-test-1', ['us-test-1a', 'us-test-1b']);
    return stack;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVybGVzcy1jbHVzdGVyLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzZXJ2ZXJsZXNzLWNsdXN0ZXIudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUFtRDtBQUNuRCxxQ0FBcUM7QUFDckMscUNBQXFDO0FBQ3JDLHFDQUFxQztBQUNyQyxrQ0FBa0M7QUFDbEMsc0NBQXNDO0FBQ3RDLGdDQUFnSztBQUVoSyxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO0lBQ2xDLElBQUksQ0FBQyxzRUFBc0UsRUFBRSxHQUFHLEVBQUU7UUFDaEYsUUFBUTtRQUNSLE1BQU0sS0FBSyxHQUFHLFNBQVMsRUFBRSxDQUFDO1FBQzFCLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFdEMsT0FBTztRQUNQLElBQUksdUJBQWlCLENBQUMsS0FBSyxFQUFFLG9CQUFvQixFQUFFO1lBQ2pELE1BQU0sRUFBRSwyQkFBcUIsQ0FBQyxpQkFBaUI7WUFDL0MsR0FBRztZQUNILFdBQVcsRUFBRTtnQkFDWCxRQUFRLEVBQUUsT0FBTztnQkFDakIsUUFBUSxFQUFFLEdBQUcsQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQzthQUN0RDtZQUNELGNBQWMsRUFBRSxvQkFBYyxDQUFDLHNCQUFzQixDQUFDLEtBQUssRUFBRSxnQkFBZ0IsRUFBRSw2QkFBNkIsQ0FBQztTQUM5RyxDQUFDLENBQUM7UUFFSCxPQUFPO1FBQ1AscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxDQUFDLHFCQUFxQixFQUFFO1lBQzNELFVBQVUsRUFBRTtnQkFDVixNQUFNLEVBQUUsbUJBQW1CO2dCQUMzQixrQkFBa0IsRUFBRSxJQUFJO2dCQUN4QiwyQkFBMkIsRUFBRSw2QkFBNkI7Z0JBQzFELGlCQUFpQixFQUFFO29CQUNqQixHQUFHLEVBQUUs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QUM7QUFFSCxTQUFTLFNBQVMsQ0FBQyxHQUFhLEVBQUUsRUFBVztJQUMzQyxNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN6RixLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxvQ0FBb0MsRUFBRSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFDO0lBQzFGLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlbXBsYXRlLCBNYXRjaCB9IGZyb20gJy4uLy4uL2Fzc2VydGlvbnMnO1xuaW1wb3J0ICogYXMgZWMyIGZyb20gJy4uLy4uL2F3cy1lYzInO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJy4uLy4uL2F3cy1pYW0nO1xuaW1wb3J0ICogYXMga21zIGZyb20gJy4uLy4uL2F3cy1rbXMnO1xuaW1wb3J0ICogYXMgY2RrIGZyb20gJy4uLy4uL2NvcmUnO1xuaW1wb3J0ICogYXMgY3hhcGkgZnJvbSAnLi4vLi4vY3gtYXBpJztcbmltcG9ydCB7IEF1cm9yYVBvc3RncmVzRW5naW5lVmVyc2lvbiwgU2VydmVybGVzc0NsdXN0ZXIsIERhdGFiYXNlQ2x1c3RlckVuZ2luZSwgUGFyYW1ldGVyR3JvdXAsIEF1cm9yYUNhcGFjaXR5VW5pdCwgRGF0YWJhc2VTZWNyZXQsIFN1Ym5ldEdyb3VwIH0gZnJvbSAnLi4vbGliJztcblxuZGVzY3JpYmUoJ3NlcnZlcmxlc3MgY2x1c3RlcicsICgpID0+IHtcbiAgdGVzdCgnY2FuIGNyZWF0ZSBhIFNlcnZlcmxlc3MgQ2x1c3RlciB3aXRoIEF1cm9yYSBQb3N0Z3JlcyBkYXRhYmFzZSBlbmdpbmUnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IG5ldyBlYzIuVnBjKHN0YWNrLCAnVlBDJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnU2VydmVybGVzc0RhdGFiYXNlJywge1xuICAgICAgZW5naW5lOiBEYXRhYmFzZUNsdXN0ZXJFbmdpbmUuQVVST1JBX1BPU1RHUkVTUUwsXG4gICAgICB2cGMsXG4gICAgICBjcmVkZW50aWFsczoge1xuICAgICAgICB1c2VybmFtZTogJ2FkbWluJyxcbiAgICAgICAgcGFzc3dvcmQ6IGNkay5TZWNyZXRWYWx1ZS51bnNhZmVQbGFpblRleHQoJ3Rvb3Nob3J0JyksXG4gICAgICB9LFxuICAgICAgcGFyYW1ldGVyR3JvdXA6IFBhcmFtZXRlckdyb3VwLmZyb21QYXJhbWV0ZXJHcm91cE5hbWUoc3RhY2ssICdQYXJhbWV0ZXJHcm91cCcsICdkZWZhdWx0LmF1cm9yYS1wb3N0Z3Jlc3FsMTAnKSxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlKCdBV1M6OlJEUzo6REJDbHVzdGVyJywge1xuICAgICAgUHJvcGVydGllczoge1xuICAgICAgICBFbmdpbmU6ICdhdXJvcmEtcG9zdGdyZXNxbCcsXG4gICAgICAgIENvcHlUYWdzVG9TbmFwc2hvdDogdHJ1ZSxcbiAgICAgICAgREJDbHVzdGVyUGFyYW1ldGVyR3JvdXBOYW1lOiAnZGVmYXVsdC5hdXJvcmEtcG9zdGdyZXNxbDEwJyxcbiAgICAgICAgREJTdWJuZXRHcm91cE5hbWU6IHtcbiAgICAgICAgICBSZWY6ICdTZXJ2ZXJsZXNzRGF0YWJhc2VTdWJuZXRzNTY0M0NENzYnLFxuICAgICAgICB9LFxuICAgICAgICBFbmdpbmVNb2RlOiAnc2VydmVybGVzcycsXG4gICAgICAgIE1hc3RlclVzZXJuYW1lOiAnYWRtaW4nLFxuICAgICAgICBNYXN0ZXJVc2VyUGFzc3dvcmQ6ICd0b29zaG9ydCcsXG4gICAgICAgIFN0b3JhZ2VFbmNyeXB0ZWQ6IHRydWUsXG4gICAgICAgIFZwY1NlY3VyaXR5R3JvdXBJZHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgICAgICAgJ1NlcnZlcmxlc3NEYXRhYmFzZVNlY3VyaXR5R3JvdXBCMDBEOEMwRicsXG4gICAgICAgICAgICAgICdHcm91cElkJyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgICBEZWxldGlvblBvbGljeTogJ1NuYXBzaG90JyxcbiAgICAgIFVwZGF0ZVJlcGxhY2VQb2xpY3k6ICdTbmFwc2hvdCcsXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBjcmVhdGUgYSBTZXJ2ZXJsZXNzIENsdXN0ZXIgd2l0aCBBdXJvcmEgTXlzcWwgZGF0YWJhc2UgZW5naW5lJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSB0ZXN0U3RhY2soKTtcbiAgICBjb25zdCB2cGMgPSBuZXcgZWMyLlZwYyhzdGFjaywgJ1ZQQycpO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBTZXJ2ZXJsZXNzQ2x1c3RlcihzdGFjaywgJ1NlcnZlcmxlc3NEYXRhYmFzZScsIHtcbiAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICAgIHZwYyxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlKCdBV1M6OlJEUzo6REJDbHVzdGVyJywge1xuICAgICAgUHJvcGVydGllczoge1xuICAgICAgICBFbmdpbmU6ICdhdXJvcmEtbXlzcWwnLFxuICAgICAgICBDb3B5VGFnc1RvU25hcHNob3Q6IHRydWUsXG4gICAgICAgIERCQ2x1c3RlclBhcmFtZXRlckdyb3VwTmFtZTogJ2RlZmF1bHQuYXVyb3JhLW15c3FsNS43JyxcbiAgICAgICAgREJTdWJuZXRHcm91cE5hbWU6IHtcbiAgICAgICAgICBSZWY6ICdTZXJ2ZXJsZXNzRGF0YWJhc2VTdWJuZXRzNTY0M0NENzYnLFxuICAgICAgICB9LFxuICAgICAgICBFbmdpbmVNb2RlOiAnc2VydmVybGVzcycsXG4gICAgICAgIE1hc3RlclVzZXJuYW1lOiB7XG4gICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgICAne3tyZXNvbHZlOnNlY3JldHNtYW5hZ2VyOicsXG4gICAgICAgICAgICB7IFJlZjogJ1NlcnZlcmxlc3NEYXRhYmFzZVNlY3JldDFDOUJGNEYxJyB9LFxuICAgICAgICAgICAgJzpTZWNyZXRTdHJpbmc6dXNlcm5hbWU6On19JyxcbiAgICAgICAgICBdXSxcbiAgICAgICAgfSxcbiAgICAgICAgTWFzdGVyVXNlclBhc3N3b3JkOiB7XG4gICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgICAne3tyZXNvbHZlOnNlY3JldHNtYW5hZ2VyOicsXG4gICAgICAgICAgICB7IFJlZjogJ1NlcnZlcmxlc3NEYXRhYmFzZVNlY3JldDFDOUJGNEYxJyB9LFxuICAgICAgICAgICAgJzpTZWNyZXRTdHJpbmc6cGFzc3dvcmQ6On19JyxcbiAgICAgICAgICBdXSxcbiAgICAgICAgfSxcbiAgICAgICAgU3RvcmFnZUVuY3J5cHRlZDogdHJ1ZSxcbiAgICAgICAgVnBjU2VjdXJpdHlHcm91cElkczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAgICAgICAnU2VydmVybGVzc0RhdGFiYXNlU2VjdXJpdHlHcm91cEIwMEQ4QzBGJyxcbiAgICAgICAgICAgICAgJ0dyb3VwSWQnLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICAgIERlbGV0aW9uUG9saWN5OiAnU25hcHNob3QnLFxuICAgICAgVXBkYXRlUmVwbGFjZVBvbGljeTogJ1NuYXBzaG90JyxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnY2FuIGNyZWF0ZSBhIFNlcnZlcmxlc3MgY2x1c3RlciB3aXRoIGltcG9ydGVkIHZwYyBhbmQgc2VjdXJpdHkgZ3JvdXAnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IGVjMi5WcGMuZnJvbUxvb2t1cChzdGFjaywgJ1ZQQycsIHtcbiAgICAgIHZwY0lkOiAnVlBDMTIzNDUnLFxuICAgIH0pO1xuICAgIGNvbnN0IHNnID0gZWMyLlNlY3VyaXR5R3JvdXAuZnJvbVNlY3VyaXR5R3JvdXBJZChzdGFjaywgJ1NHJywgJ1NlY3VyaXR5R3JvdXBJZDEyMzQ1Jyk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfUE9TVEdSRVNRTCxcbiAgICAgIHZwYyxcbiAgICAgIHNlY3VyaXR5R3JvdXBzOiBbc2ddLFxuICAgICAgcGFyYW1ldGVyR3JvdXA6IFBhcmFtZXRlckdyb3VwLmZyb21QYXJhbWV0ZXJHcm91cE5hbWUoc3RhY2ssICdQYXJhbWV0ZXJHcm91cCcsICdkZWZhdWx0LmF1cm9yYS1wb3N0Z3Jlc3FsMTAnKSxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSRFM6OkRCQ2x1c3RlcicsIHtcbiAgICAgIEVuZ2luZTogJ2F1cm9yYS1wb3N0Z3Jlc3FsJyxcbiAgICAgIERCQ2x1c3RlclBhcmFtZXRlckdyb3VwTmFtZTogJ2RlZmF1bHQuYXVyb3JhLXBvc3RncmVzcWwxMCcsXG4gICAgICBFbmdpbmVNb2RlOiAnc2VydmVybGVzcycsXG4gICAgICBEQlN1Ym5ldEdyb3VwTmFtZTogeyBSZWY6ICdEYXRhYmFzZVN1Ym5ldHM1NkYxN0I5QScgfSxcbiAgICAgIE1hc3RlclVzZXJuYW1lOiB7XG4gICAgICAgICdGbjo6Sm9pbic6IFsnJywgW1xuICAgICAgICAgICd7e3Jlc29sdmU6c2VjcmV0c21hbmFnZXI6JyxcbiAgICAgICAgICB7IFJlZjogJ0RhdGFiYXNlU2VjcmV0M0I4MTcxOTUnIH0sXG4gICAgICAgICAgJzpTZWNyZXRTdHJpbmc6dXNlcm5hbWU6On19JyxcbiAgICAgICAgXV0sXG4gICAgICB9LFxuICAgICAgTWFzdGVyVXNlclBhc3N3b3JkOiB7XG4gICAgICAgICdGbjo6Sm9pbic6IFsnJywgW1xuICAgICAgICAgICd7e3Jlc29sdmU6c2VjcmV0c21hbmFnZXI6JyxcbiAgICAgICAgICB7IFJlZjogJ0RhdGFiYXNlU2VjcmV0M0I4MTcxOTUnIH0sXG4gICAgICAgICAgJzpTZWNyZXRTdHJpbmc6cGFzc3dvcmQ6On19JyxcbiAgICAgICAgXV0sXG4gICAgICB9LFxuICAgICAgVnBjU2VjdXJpdHlHcm91cElkczogWydTZWN1cml0eUdyb3VwSWQxMjM0NSddLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KFwic2V0cyB0aGUgcmV0ZW50aW9uIHBvbGljeSBvZiB0aGUgU3VibmV0R3JvdXAgdG8gJ1JldGFpbicgaWYgdGhlIFNlcnZlcmxlc3MgQ2x1c3RlciBpcyBjcmVhdGVkIHdpdGggJ1JldGFpbidcIiwgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IG5ldyBlYzIuVnBjKHN0YWNrLCAnVnBjJyk7XG5cbiAgICBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdDbHVzdGVyJywge1xuICAgICAgZW5naW5lOiBEYXRhYmFzZUNsdXN0ZXJFbmdpbmUuQVVST1JBX01ZU1FMLFxuICAgICAgdnBjLFxuICAgICAgcmVtb3ZhbFBvbGljeTogY2RrLlJlbW92YWxQb2xpY3kuUkVUQUlOLFxuICAgIH0pO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZSgnQVdTOjpSRFM6OkRCU3VibmV0R3JvdXAnLCB7XG4gICAgICBEZWxldGlvblBvbGljeTogJ1JldGFpbicsXG4gICAgICBVcGRhdGVSZXBsYWNlUG9saWN5OiAnUmV0YWluJyxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnY3JlYXRlcyBhIHNlY3JldCB3aGVuIG1hc3RlciBjcmVkZW50aWFscyBhcmUgbm90IHNwZWNpZmllZCcsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gdGVzdFN0YWNrKCk7XG4gICAgY29uc3QgdnBjID0gbmV3IGVjMi5WcGMoc3RhY2ssICdWUEMnKTtcblxuICAgIC8vIFdIRU5cbiAgICBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICAgIGNyZWRlbnRpYWxzOiB7XG4gICAgICAgIHVzZXJuYW1lOiAnbXl1c2VyJyxcbiAgICAgICAgZXhjbHVkZUNoYXJhY3RlcnM6ICdcIkAvXFxcXCcsXG4gICAgICB9LFxuICAgICAgdnBjLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJEUzo6REJDbHVzdGVyJywge1xuICAgICAgTWFzdGVyVXNlcm5hbWU6IHtcbiAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgJ3t7cmVzb2x2ZTpzZWNyZXRzbWFuYWdlcjonLFxuICAgICAgICAgIHsgUmVmOiAnRGF0YWJhc2VTZWNyZXQzQjgxNzE5NScgfSxcbiAgICAgICAgICAnOlNlY3JldFN0cmluZzp1c2VybmFtZTo6fX0nLFxuICAgICAgICBdXSxcbiAgICAgIH0sXG4gICAgICBNYXN0ZXJVc2VyUGFzc3dvcmQ6IHtcbiAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgJ3t7cmVzb2x2ZTpzZWNyZXRzbWFuYWdlcjonLFxuICAgICAgICAgIHsgUmVmOiAnRGF0YWJhc2VTZWNyZXQzQjgxNzE5NScgfSxcbiAgICAgICAgICAnOlNlY3JldFN0cmluZzpwYXNzd29yZDo6fX0nLFxuICAgICAgICBdXSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpTZWNyZXRzTWFuYWdlcjo6U2VjcmV0Jywge1xuICAgICAgR2VuZXJhdGVTZWNyZXRTdHJpbmc6IHtcbiAgICAgICAgRXhjbHVkZUNoYXJhY3RlcnM6ICdcIkAvXFxcXCcsXG4gICAgICAgIEdlbmVyYXRlU3RyaW5nS2V5OiAncGFzc3dvcmQnLFxuICAgICAgICBQYXNzd29yZExlbmd0aDogMzAsXG4gICAgICAgIFNlY3JldFN0cmluZ1RlbXBsYXRlOiAne1widXNlcm5hbWVcIjpcIm15dXNlclwifScsXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjcmVhdGUgYW4gU2VydmVybGVzcyBjbHVzdGVyIHdpdGggY3VzdG9tIEtNUyBrZXkgZm9yIHN0b3JhZ2UnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IG5ldyBlYzIuVnBjKHN0YWNrLCAnVlBDJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgICB2cGMsXG4gICAgICBzdG9yYWdlRW5jcnlwdGlvbktleTogbmV3IGttcy5LZXkoc3RhY2ssICdLZXknKSxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSRFM6OkRCQ2x1c3RlcicsIHtcbiAgICAgIEttc0tleUlkOiB7XG4gICAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAgICdLZXk5NjFCNzNGRCcsXG4gICAgICAgICAgJ0FybicsXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjcmVhdGUgYSBjbHVzdGVyIHVzaW5nIGEgc3BlY2lmaWMgdmVyc2lvbiBvZiBQb3N0Z3Jlc3FsJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSB0ZXN0U3RhY2soKTtcbiAgICBjb25zdCB2cGMgPSBuZXcgZWMyLlZwYyhzdGFjaywgJ1ZQQycpO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBTZXJ2ZXJsZXNzQ2x1c3RlcihzdGFjaywgJ0RhdGFiYXNlJywge1xuICAgICAgZW5naW5lOiBEYXRhYmFzZUNsdXN0ZXJFbmdpbmUuYXVyb3JhUG9zdGdyZXMoe1xuICAgICAgICB2ZXJzaW9uOiBBdXJvcmFQb3N0Z3Jlc0VuZ2luZVZlcnNpb24uVkVSXzEwXzcsXG4gICAgICB9KSxcbiAgICAgIHZwYyxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSRFM6OkRCQ2x1c3RlcicsIHtcbiAgICAgIEVuZ2luZTogJ2F1cm9yYS1wb3N0Z3Jlc3FsJyxcbiAgICAgIEVuZ2luZU1vZGU6ICdzZXJ2ZXJsZXNzJyxcbiAgICAgIEVuZ2luZVZlcnNpb246ICcxMC43JyxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnY2x1c3RlciBleHBvc2VzIGRpZmZlcmVudCByZWFkIGFuZCB3cml0ZSBlbmRwb2ludHMnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IG5ldyBlYzIuVnBjKHN0YWNrLCAnVlBDJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3QgY2x1c3RlciA9IG5ldyBTZXJ2ZXJsZXNzQ2x1c3RlcihzdGFjaywgJ0RhdGFiYXNlJywge1xuICAgICAgZW5naW5lOiBEYXRhYmFzZUNsdXN0ZXJFbmdpbmUuQVVST1JBLFxuICAgICAgY3JlZGVudGlhbHM6IHtcbiAgICAgICAgdXNlcm5hbWU6ICdhZG1pbicsXG4gICAgICB9LFxuICAgICAgdnBjLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGNsdXN0ZXIuY2x1c3RlckVuZHBvaW50KSkubm90XG4gICAgICAudG9FcXVhbChzdGFjay5yZXNvbHZlKGNsdXN0ZXIuY2x1c3RlclJlYWRFbmRwb2ludCkpO1xuICB9KTtcblxuICB0ZXN0KCdpbXBvcnRlZCBjbHVzdGVyIHdpdGggaW1wb3J0ZWQgc2VjdXJpdHkgZ3JvdXAgaG9ub3JzIGFsbG93QWxsT3V0Ym91bmQnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuXG4gICAgY29uc3QgY2x1c3RlciA9IFNlcnZlcmxlc3NDbHVzdGVyLmZyb21TZXJ2ZXJsZXNzQ2x1c3RlckF0dHJpYnV0ZXMoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGNsdXN0ZXJFbmRwb2ludEFkZHJlc3M6ICdhZGRyJyxcbiAgICAgIGNsdXN0ZXJJZGVudGlmaWVyOiAnaWRlbnRpZmllcicsXG4gICAgICBwb3J0OiAzMzA2LFxuICAgICAgcmVhZGVyRW5kcG9pbnRBZGRyZXNzOiAncmVhZGVyLWFkZHJlc3MnLFxuICAgICAgc2VjdXJpdHlHcm91cHM6IFtlYzIuU2VjdXJpdHlHcm91cC5mcm9tU2VjdXJpdHlHcm91cElkKHN0YWNrLCAnU0cnLCAnc2ctMTIzNDU2Nzg5Jywge1xuICAgICAgICBhbGxvd0FsbE91dGJvdW5kOiBmYWxzZSxcbiAgICAgIH0pXSxcbiAgICB9KTtcblxuICAgIC8vIFdIRU5cbiAgICBjbHVzdGVyLmNvbm5lY3Rpb25zLmFsbG93VG9BbnlJcHY0KGVjMi5Qb3J0LnRjcCg0NDMpKTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpFQzI6OlNlY3VyaXR5R3JvdXBFZ3Jlc3MnLCB7XG4gICAgICBHcm91cElkOiAnc2ctMTIzNDU2Nzg5JyxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnY2FuIGltcG9ydCBhIHNlcnZlcmxlc3MgY2x1c3RlciB3aXRoIG1pbmltYWwgYXR0cmlidXRlcycsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuXG4gICAgY29uc3QgY2x1c3RlciA9IFNlcnZlcmxlc3NDbHVzdGVyLmZyb21TZXJ2ZXJsZXNzQ2x1c3RlckF0dHJpYnV0ZXMoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGNsdXN0ZXJJZGVudGlmaWVyOiAnaWRlbnRpZmllcicsXG4gICAgfSk7XG5cbiAgICBleHBlY3QoY2x1c3Rlci5jbHVzdGVySWRlbnRpZmllcikudG9FcXVhbCgnaWRlbnRpZmllcicpO1xuICB9KTtcblxuICB0ZXN0KCdtaW5pbWFsIGltcG9ydGVkIGNsdXN0ZXIgdGhyb3dzIG9uIGFjY2Vzc2luZyBhdHRyaWJ1dGVzIGZvciBtaXNzaW5nIHBhcmFtZXRlcnMnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3RhY2sgPSB0ZXN0U3RhY2soKTtcblxuICAgIGNvbnN0IGNsdXN0ZXIgPSBTZXJ2ZXJsZXNzQ2x1c3Rlci5mcm9tU2VydmVybGVzc0NsdXN0ZXJBdHRyaWJ1dGVzKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBjbHVzdGVySWRlbnRpZmllcjogJ2lkZW50aWZpZXInLFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KCgpID0+IGNsdXN0ZXIuY2x1c3RlckVuZHBvaW50KS50b1Rocm93KC9DYW5ub3QgYWNjZXNzIGBjbHVzdGVyRW5kcG9pbnRgIG9mIGFuIGltcG9ydGVkIGNsdXN0ZXIvKTtcbiAgICBleHBlY3QoKCkgPT4gY2x1c3Rlci5jbHVzdGVyUmVhZEVuZHBvaW50KS50b1Rocm93KC9DYW5ub3QgYWNjZXNzIGBjbHVzdGVyUmVhZEVuZHBvaW50YCBvZiBhbiBpbXBvcnRlZCBjbHVzdGVyLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2ltcG9ydGVkIGNsdXN0ZXIgY2FuIGFjY2VzcyBwcm9wZXJ0aWVzIGlmIGF0dHJpYnV0ZXMgYXJlIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gdGVzdFN0YWNrKCk7XG5cbiAgICBjb25zdCBjbHVzdGVyID0gU2VydmVybGVzc0NsdXN0ZXIuZnJvbVNlcnZlcmxlc3NDbHVzdGVyQXR0cmlidXRlcyhzdGFjaywgJ0RhdGFiYXNlJywge1xuICAgICAgY2x1c3RlckVuZHBvaW50QWRkcmVzczogJ2FkZHInLFxuICAgICAgY2x1c3RlcklkZW50aWZpZXI6ICdpZGVudGlmaWVyJyxcbiAgICAgIHBvcnQ6IDMzMDYsXG4gICAgICByZWFkZXJFbmRwb2ludEFkZHJlc3M6ICdyZWFkZXItYWRkcmVzcycsXG4gICAgICBzZWN1cml0eUdyb3VwczogW2VjMi5TZWN1cml0eUdyb3VwLmZyb21TZWN1cml0eUdyb3VwSWQoc3RhY2ssICdTRycsICdzZy0xMjM0NTY3ODknLCB7XG4gICAgICAgIGFsbG93QWxsT3V0Ym91bmQ6IGZhbHNlLFxuICAgICAgfSldLFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KGNsdXN0ZXIuY2x1c3RlckVuZHBvaW50LnNvY2tldEFkZHJlc3MpLnRvRXF1YWwoJ2FkZHI6MzMwNicpO1xuICAgIGV4cGVjdChjbHVzdGVyLmNsdXN0ZXJSZWFkRW5kcG9pbnQuc29ja2V0QWRkcmVzcykudG9FcXVhbCgncmVhZGVyLWFkZHJlc3M6MzMwNicpO1xuICB9KTtcblxuICB0ZXN0KCd0aHJvd3Mgd2hlbiB0cnlpbmcgdG8gYWRkIHNpbmdsZS11c2VyIHJvdGF0aW9uIHRvIGEgc2VydmVybGVzcyBjbHVzdGVyIHdpdGhvdXQgc2VjcmV0JywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgY29uc3QgdnBjID0gbmV3IGVjMi5WcGMoc3RhY2ssICdWUEMnKTtcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCBjbHVzdGVyID0gbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgICBjcmVkZW50aWFsczoge1xuICAgICAgICB1c2VybmFtZTogJ2FkbWluJyxcbiAgICAgICAgcGFzc3dvcmQ6IGNkay5TZWNyZXRWYWx1ZS51bnNhZmVQbGFpblRleHQoJ3Rvb3Nob3J0JyksXG4gICAgICB9LFxuICAgICAgdnBjLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCgoKSA9PiBjbHVzdGVyLmFkZFJvdGF0aW9uU2luZ2xlVXNlcigpKS50b1Rocm93KC93aXRob3V0IHNlY3JldC8pO1xuICB9KTtcblxuICB0ZXN0KCd0aHJvd3Mgd2hlbiB0cnlpbmcgdG8gYWRkIHNpbmdsZSB1c2VyIHJvdGF0aW9uIG11bHRpcGxlIHRpbWVzJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgY29uc3QgdnBjID0gbmV3IGVjMi5WcGMoc3RhY2ssICdWUEMnKTtcbiAgICBjb25zdCBjbHVzdGVyID0gbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgICBjcmVkZW50aWFsczogeyB1c2VybmFtZTogJ2FkbWluJyB9LFxuICAgICAgdnBjLFxuICAgIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIGNsdXN0ZXIuYWRkUm90YXRpb25TaW5nbGVVc2VyKCk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KCgpID0+IGNsdXN0ZXIuYWRkUm90YXRpb25TaW5nbGVVc2VyKCkpLnRvVGhyb3coL0Egc2luZ2xlIHVzZXIgcm90YXRpb24gd2FzIGFscmVhZHkgYWRkZWQgdG8gdGhpcyBjbHVzdGVyLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Rocm93cyB3aGVuIHRyeWluZyB0byBhZGQgc2luZ2xlLXVzZXIgcm90YXRpb24gdG8gYSBzZXJ2ZXJsZXNzIGNsdXN0ZXIgd2l0aG91dCBWUEMnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCBjbHVzdGVyID0gbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGNsdXN0ZXIuYWRkUm90YXRpb25TaW5nbGVVc2VyKCk7XG4gICAgfSkudG9UaHJvdygvQ2Fubm90IGFkZCBzaW5nbGUgdXNlciByb3RhdGlvbiBmb3IgYSBjbHVzdGVyIHdpdGhvdXQgVlBDLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Rocm93cyB3aGVuIHRyeWluZyB0byBhZGQgbXVsdGktdXNlciByb3RhdGlvbiB0byBhIHNlcnZlcmxlc3MgY2x1c3RlciB3aXRob3V0IFZQQycsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgIGNvbnN0IHNlY3JldCA9IG5ldyBEYXRhYmFzZVNlY3JldChzdGFjaywgJ1NlY3JldCcsIHtcbiAgICAgIHVzZXJuYW1lOiAnYWRtaW4nLFxuICAgIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IGNsdXN0ZXIgPSBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgY2x1c3Rlci5hZGRSb3RhdGlvbk11bHRpVXNlcignc29tZUlkJywgeyBzZWNyZXQgfSk7XG4gICAgfSkudG9UaHJvdygvQ2Fubm90IGFkZCBtdWx0aSB1c2VyIHJvdGF0aW9uIGZvciBhIGNsdXN0ZXIgd2l0aG91dCBWUEMvKTtcbiAgfSk7XG5cbiAgdGVzdCgnY2FuIHNldCBkZWxldGlvbiBwcm90ZWN0aW9uJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSB0ZXN0U3RhY2soKTtcbiAgICBjb25zdCB2cGMgPSBuZXcgZWMyLlZwYyhzdGFjaywgJ1ZQQycpO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBTZXJ2ZXJsZXNzQ2x1c3RlcihzdGFjaywgJ0RhdGFiYXNlJywge1xuICAgICAgZW5naW5lOiBEYXRhYmFzZUNsdXN0ZXJFbmdpbmUuQVVST1JBX01ZU1FMLFxuICAgICAgdnBjLFxuICAgICAgZGVsZXRpb25Qcm90ZWN0aW9uOiB0cnVlLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJEUzo6REJDbHVzdGVyJywge1xuICAgICAgRGVsZXRpb25Qcm90ZWN0aW9uOiB0cnVlLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gc2V0IGJhY2t1cCByZXRlbnRpb24nLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IG5ldyBlYzIuVnBjKHN0YWNrLCAnVlBDJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgICB2cGMsXG4gICAgICBiYWNrdXBSZXRlbnRpb246IGNkay5EdXJhdGlvbi5kYXlzKDIpLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJEUzo6REJDbHVzdGVyJywge1xuICAgICAgQmFja3VwUmV0ZW50aW9uUGVyaW9kOiAyLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdkb2VzIG5vdCB0aHJvdyAoYnV0IGFkZHMgYSBub2RlIGVycm9yKSBpZiBhIChkdW1teSkgVlBDIGRvZXMgbm90IGhhdmUgc3VmZmljaWVudCBzdWJuZXRzJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTtcbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjayhhcHAsICdUZXN0U3RhY2snKTtcbiAgICBjb25zdCB2cGMgPSBlYzIuVnBjLmZyb21Mb29rdXAoc3RhY2ssICdWUEMnLCB7IGlzRGVmYXVsdDogdHJ1ZSB9KTtcblxuICAgIC8vIFdIRU5cbiAgICBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICAgIHZwYyxcbiAgICAgIHZwY1N1Ym5ldHM6IHtcbiAgICAgICAgc3VibmV0TmFtZTogJ0RlZmluaXRlbHlEb2VzTm90RXhpc3QnLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBjb25zdCBhcnQgPSBhcHAuc3ludGgoKS5nZXRTdGFja0FydGlmYWN0KCdUZXN0U3RhY2snKTtcbiAgICBjb25zdCBtZXRhID0gYXJ0LmZpbmRNZXRhZGF0YUJ5VHlwZSgnYXdzOmNkazplcnJvcicpO1xuICAgIGV4cGVjdChtZXRhWzBdLmRhdGEpLnRvRXF1YWwoJ0NsdXN0ZXIgcmVxdWlyZXMgYXQgbGVhc3QgMiBzdWJuZXRzLCBnb3QgMCcpO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gc2V0IHNjYWxpbmcgY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gdGVzdFN0YWNrKCk7XG4gICAgY29uc3QgdnBjID0gZWMyLlZwYy5mcm9tTG9va3VwKHN0YWNrLCAnVlBDJywgeyBpc0RlZmF1bHQ6IHRydWUgfSk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgICB2cGMsXG4gICAgICBzY2FsaW5nOiB7XG4gICAgICAgIG1pbkNhcGFjaXR5OiBBdXJvcmFDYXBhY2l0eVVuaXQuQUNVXzEsXG4gICAgICAgIG1heENhcGFjaXR5OiBBdXJvcmFDYXBhY2l0eVVuaXQuQUNVXzEyOCxcbiAgICAgICAgYXV0b1BhdXNlOiBjZGsuRHVyYXRpb24ubWludXRlcygxMCksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy9USEVOXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6UkRTOjpEQkNsdXN0ZXInLCB7XG4gICAgICBTY2FsaW5nQ29uZmlndXJhdGlvbjoge1xuICAgICAgICBBdXRvUGF1c2U6IHRydWUsXG4gICAgICAgIE1heENhcGFjaXR5OiAxMjgsXG4gICAgICAgIE1pbkNhcGFjaXR5OiAxLFxuICAgICAgICBTZWNvbmRzVW50aWxBdXRvUGF1c2U6IDYwMCxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBlbmFibGUgRGF0YSBBUEknLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IGVjMi5WcGMuZnJvbUxvb2t1cChzdGFjaywgJ1ZQQycsIHsgaXNEZWZhdWx0OiB0cnVlIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBTZXJ2ZXJsZXNzQ2x1c3RlcihzdGFjaywgJ0RhdGFiYXNlJywge1xuICAgICAgZW5naW5lOiBEYXRhYmFzZUNsdXN0ZXJFbmdpbmUuQVVST1JBX01ZU1FMLFxuICAgICAgdnBjLFxuICAgICAgZW5hYmxlRGF0YUFwaTogdHJ1ZSxcbiAgICB9KTtcblxuICAgIC8vVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJEUzo6REJDbHVzdGVyJywge1xuICAgICAgRW5hYmxlSHR0cEVuZHBvaW50OiB0cnVlLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdkZWZhdWx0IHNjYWxpbmcgb3B0aW9ucycsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gdGVzdFN0YWNrKCk7XG4gICAgY29uc3QgdnBjID0gZWMyLlZwYy5mcm9tTG9va3VwKHN0YWNrLCAnVlBDJywgeyBpc0RlZmF1bHQ6IHRydWUgfSk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgICB2cGMsXG4gICAgICBzY2FsaW5nOiB7fSxcbiAgICB9KTtcblxuICAgIC8vVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJEUzo6REJDbHVzdGVyJywge1xuICAgICAgU2NhbGluZ0NvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgQXV0b1BhdXNlOiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnYXV0byBwYXVzZSBpcyBkaXNhYmxlZCBpZiBhIHRpbWUgb2YgemVybyBpcyBzcGVjaWZpZWQnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IGVjMi5WcGMuZnJvbUxvb2t1cChzdGFjaywgJ1ZQQycsIHsgaXNEZWZhdWx0OiB0cnVlIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBTZXJ2ZXJsZXNzQ2x1c3RlcihzdGFjaywgJ0RhdGFiYXNlJywge1xuICAgICAgZW5naW5lOiBEYXRhYmFzZUNsdXN0ZXJFbmdpbmUuQVVST1JBX01ZU1FMLFxuICAgICAgdnBjLFxuICAgICAgc2NhbGluZzoge1xuICAgICAgICBhdXRvUGF1c2U6IGNkay5EdXJhdGlvbi5zZWNvbmRzKDApLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJEUzo6REJDbHVzdGVyJywge1xuICAgICAgU2NhbGluZ0NvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgQXV0b1BhdXNlOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Rocm93cyB3aGVuIGludmFsaWQgYXV0byBwYXVzZSB0aW1lIGlzIHNwZWNpZmllZCcsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gdGVzdFN0YWNrKCk7XG4gICAgY29uc3QgdnBjID0gZWMyLlZwYy5mcm9tTG9va3VwKHN0YWNrLCAnVlBDJywgeyBpc0RlZmF1bHQ6IHRydWUgfSk7XG5cbiAgICAvLyBXSEVOXG4gICAgZXhwZWN0KCgpID0+XG4gICAgICBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgICAgZW5naW5lOiBEYXRhYmFzZUNsdXN0ZXJFbmdpbmUuQVVST1JBX01ZU1FMLFxuICAgICAgICB2cGMsXG4gICAgICAgIHNjYWxpbmc6IHtcbiAgICAgICAgICBhdXRvUGF1c2U6IGNkay5EdXJhdGlvbi5zZWNvbmRzKDMwKSxcbiAgICAgICAgfSxcbiAgICAgIH0pKS50b1Rocm93KC9hdXRvIHBhdXNlIHRpbWUgbXVzdCBiZSBiZXR3ZWVuIDUgbWludXRlcyBhbmQgMSBkYXkuLyk7XG5cbiAgICBleHBlY3QoKCkgPT5cbiAgICAgIG5ldyBTZXJ2ZXJsZXNzQ2x1c3RlcihzdGFjaywgJ0Fub3RoZXIgRGF0YWJhc2UnLCB7XG4gICAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICAgICAgdnBjLFxuICAgICAgICBzY2FsaW5nOiB7XG4gICAgICAgICAgYXV0b1BhdXNlOiBjZGsuRHVyYXRpb24uZGF5cygyKSxcbiAgICAgICAgfSxcbiAgICAgIH0pKS50b1Rocm93KC9hdXRvIHBhdXNlIHRpbWUgbXVzdCBiZSBiZXR3ZWVuIDUgbWludXRlcyBhbmQgMSBkYXkuLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Rocm93cyB3aGVuIGludmFsaWQgYmFja3VwIHJldGVudGlvbiBwZXJpb2QgaXMgc3BlY2lmaWVkJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSB0ZXN0U3RhY2soKTtcbiAgICBjb25zdCB2cGMgPSBlYzIuVnBjLmZyb21Mb29rdXAoc3RhY2ssICdWUEMnLCB7IGlzRGVmYXVsdDogdHJ1ZSB9KTtcblxuICAgIC8vIFdIRU5cbiAgICBleHBlY3QoKCkgPT5cbiAgICAgIG5ldyBTZXJ2ZXJsZXNzQ2x1c3RlcihzdGFjaywgJ0RhdGFiYXNlJywge1xuICAgICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgICAgIHZwYyxcbiAgICAgICAgYmFja3VwUmV0ZW50aW9uOiBjZGsuRHVyYXRpb24uZGF5cygwKSxcbiAgICAgIH0pKS50b1Rocm93KC9iYWNrdXAgcmV0ZW50aW9uIHBlcmlvZCBtdXN0IGJlIGJldHdlZW4gMSBhbmQgMzUgZGF5cy4gcmVjZWl2ZWQ6IDAvKTtcblxuICAgIGV4cGVjdCgoKSA9PlxuICAgICAgbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnQW5vdGhlciBEYXRhYmFzZScsIHtcbiAgICAgICAgZW5naW5lOiBEYXRhYmFzZUNsdXN0ZXJFbmdpbmUuQVVST1JBX01ZU1FMLFxuICAgICAgICB2cGMsXG4gICAgICAgIGJhY2t1cFJldGVudGlvbjogY2RrLkR1cmF0aW9uLmRheXMoMzYpLFxuICAgICAgfSkpLnRvVGhyb3coL2JhY2t1cCByZXRlbnRpb24gcGVyaW9kIG11c3QgYmUgYmV0d2VlbiAxIGFuZCAzNSBkYXlzLiByZWNlaXZlZDogMzYvKTtcbiAgfSk7XG5cbiAgdGVzdCgndGhyb3dzIGVycm9yIHdoZW4gbWluIGNhcGFjaXR5IGlzIGdyZWF0ZXIgdGhhbiBtYXggY2FwYWNpdHknLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IGVjMi5WcGMuZnJvbUxvb2t1cChzdGFjaywgJ1ZQQycsIHsgaXNEZWZhdWx0OiB0cnVlIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIGV4cGVjdCgoKSA9PlxuICAgICAgbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICAgICAgdnBjLFxuICAgICAgICBzY2FsaW5nOiB7XG4gICAgICAgICAgbWluQ2FwYWNpdHk6IEF1cm9yYUNhcGFjaXR5VW5pdC5BQ1VfMixcbiAgICAgICAgICBtYXhDYXBhY2l0eTogQXVyb3JhQ2FwYWNpdHlVbml0LkFDVV8xLFxuICAgICAgICB9LFxuICAgICAgfSkpLnRvVGhyb3coL21heGltdW0gY2FwYWNpdHkgbXVzdCBiZSBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gbWluaW11bSBjYXBhY2l0eS4vKTtcbiAgfSk7XG5cbiAgdGVzdCgnY2hlY2sgdGhhdCBjbHVzdGVyQXJuIHByb3BlcnR5IHdvcmtzJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSB0ZXN0U3RhY2soKTtcbiAgICBjb25zdCB2cGMgPSBlYzIuVnBjLmZyb21Mb29rdXAoc3RhY2ssICdWUEMnLCB7IGlzRGVmYXVsdDogdHJ1ZSB9KTtcbiAgICBjb25zdCBjbHVzdGVyID0gbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgICB2cGMsXG4gICAgfSk7XG4gICAgY29uc3QgZXhwb3J0TmFtZSA9ICdEYkNsdXRlckFybic7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IGNkay5DZm5PdXRwdXQoc3RhY2ssIGV4cG9ydE5hbWUsIHtcbiAgICAgIGV4cG9ydE5hbWUsXG4gICAgICB2YWx1ZTogY2x1c3Rlci5jbHVzdGVyQXJuLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGNsdXN0ZXIuY2x1c3RlckFybikpLnRvRXF1YWwoe1xuICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICdhcm46JyxcbiAgICAgICAgeyBSZWY6ICdBV1M6OlBhcnRpdGlvbicgfSxcbiAgICAgICAgJzpyZHM6dXMtdGVzdC0xOjEyMzQ1OmNsdXN0ZXI6JyxcbiAgICAgICAgeyBSZWY6ICdEYXRhYmFzZUIyNjlEOEJCJyB9LFxuICAgICAgXV0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBncmFudCBEYXRhIEFQSSBhY2Nlc3MnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IGVjMi5WcGMuZnJvbUxvb2t1cChzdGFjaywgJ1ZQQycsIHsgaXNEZWZhdWx0OiB0cnVlIH0pO1xuICAgIGNvbnN0IGNsdXN0ZXIgPSBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICAgIHZwYyxcbiAgICAgIGVuYWJsZURhdGFBcGk6IHRydWUsXG4gICAgfSk7XG4gICAgY29uc3QgdXNlciA9IG5ldyBpYW0uVXNlcihzdGFjaywgJ1VzZXInKTtcblxuICAgIC8vIFdIRU5cbiAgICBjbHVzdGVyLmdyYW50RGF0YUFwaUFjY2Vzcyh1c2VyKTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpJQU06OlBvbGljeScsIHtcbiAgICAgIFBvbGljeURvY3VtZW50OiB7XG4gICAgICAgIFN0YXRlbWVudDogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIEFjdGlvbjogW1xuICAgICAgICAgICAgICAncmRzLWRhdGE6QmF0Y2hFeGVjdXRlU3RhdGVtZW50JyxcbiAgICAgICAgICAgICAgJ3Jkcy1kYXRhOkJlZ2luVHJhbnNhY3Rpb24nLFxuICAgICAgICAgICAgICAncmRzLWRhdGE6Q29tbWl0VHJhbnNhY3Rpb24nLFxuICAgICAgICAgICAgICAncmRzLWRhdGE6RXhlY3V0ZVN0YXRlbWVudCcsXG4gICAgICAgICAgICAgICdyZHMtZGF0YTpSb2xsYmFja1RyYW5zYWN0aW9uJyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgQWN0aW9uOiBbXG4gICAgICAgICAgICAgICdzZWNyZXRzbWFuYWdlcjpHZXRTZWNyZXRWYWx1ZScsXG4gICAgICAgICAgICAgICdzZWNyZXRzbWFuYWdlcjpEZXNjcmliZVNlY3JldCcsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgUmVzb3VyY2U6IHtcbiAgICAgICAgICAgICAgUmVmOiAnRGF0YWJhc2VTZWNyZXRBdHRhY2htZW50RTVEMUIwMjAnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBWZXJzaW9uOiAnMjAxMi0xMC0xNycsXG4gICAgICB9LFxuICAgICAgUG9saWN5TmFtZTogJ1VzZXJEZWZhdWx0UG9saWN5MUY5Nzc4MUUnLFxuICAgICAgVXNlcnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIFJlZjogJ1VzZXIwMEIwMTVBMScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gZ3JhbnQgRGF0YSBBUEkgYWNjZXNzIG9uIGltcG9ydGVkIGNsdXN0ZXIgd2l0aCBnaXZlbiBzZWNyZXQnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IHNlY3JldCA9IG5ldyBEYXRhYmFzZVNlY3JldChzdGFjaywgJ1NlY3JldCcsIHtcbiAgICAgIHVzZXJuYW1lOiAnYWRtaW4nLFxuICAgIH0pO1xuICAgIGNvbnN0IGNsdXN0ZXIgPSBTZXJ2ZXJsZXNzQ2x1c3Rlci5mcm9tU2VydmVybGVzc0NsdXN0ZXJBdHRyaWJ1dGVzKHN0YWNrLCAnQ2x1c3RlcicsIHtcbiAgICAgIGNsdXN0ZXJJZGVudGlmaWVyOiAnSW1wb3J0ZWREYXRhYmFzZScsXG4gICAgICBzZWNyZXQsXG4gICAgfSk7XG4gICAgY29uc3QgdXNlciA9IG5ldyBpYW0uVXNlcihzdGFjaywgJ1VzZXInKTtcblxuXG4gICAgLy8gV0hFTlxuICAgIGNsdXN0ZXIuZ3JhbnREYXRhQXBpQWNjZXNzKHVzZXIpO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgU3RhdGVtZW50OiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgQWN0aW9uOiBbXG4gICAgICAgICAgICAgICdyZHMtZGF0YTpCYXRjaEV4ZWN1dGVTdGF0ZW1lbnQnLFxuICAgICAgICAgICAgICAncmRzLWRhdGE6QmVnaW5UcmFuc2FjdGlvbicsXG4gICAgICAgICAgICAgICdyZHMtZGF0YTpDb21taXRUcmFuc2FjdGlvbicsXG4gICAgICAgICAgICAgICdyZHMtZGF0YTpFeGVjdXRlU3RhdGVtZW50JyxcbiAgICAgICAgICAgICAgJ3Jkcy1kYXRhOlJvbGxiYWNrVHJhbnNhY3Rpb24nLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBBY3Rpb246IFtcbiAgICAgICAgICAgICAgJ3NlY3JldHNtYW5hZ2VyOkdldFNlY3JldFZhbHVlJyxcbiAgICAgICAgICAgICAgJ3NlY3JldHNtYW5hZ2VyOkRlc2NyaWJlU2VjcmV0JyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICBSZXNvdXJjZToge1xuICAgICAgICAgICAgICBSZWY6ICdTZWNyZXRBNzIwRUYwNScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIFZlcnNpb246ICcyMDEyLTEwLTE3JyxcbiAgICAgIH0sXG4gICAgICBQb2xpY3lOYW1lOiAnVXNlckRlZmF1bHRQb2xpY3kxRjk3NzgxRScsXG4gICAgICBVc2VyczogW1xuICAgICAgICB7XG4gICAgICAgICAgUmVmOiAnVXNlcjAwQjAxNUExJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2dyYW50IERhdGEgQVBJIGFjY2VzcyBlbmFibGVzIHRoZSBEYXRhIEFQSScsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gdGVzdFN0YWNrKCk7XG4gICAgY29uc3QgdnBjID0gZWMyLlZwYy5mcm9tTG9va3VwKHN0YWNrLCAnVlBDJywgeyBpc0RlZmF1bHQ6IHRydWUgfSk7XG4gICAgY29uc3QgY2x1c3RlciA9IG5ldyBTZXJ2ZXJsZXNzQ2x1c3RlcihzdGFjaywgJ0RhdGFiYXNlJywge1xuICAgICAgZW5naW5lOiBEYXRhYmFzZUNsdXN0ZXJFbmdpbmUuQVVST1JBX01ZU1FMLFxuICAgICAgdnBjLFxuICAgIH0pO1xuICAgIGNvbnN0IHVzZXIgPSBuZXcgaWFtLlVzZXIoc3RhY2ssICdVc2VyJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgY2x1c3Rlci5ncmFudERhdGFBcGlBY2Nlc3ModXNlcik7XG5cbiAgICAvL1RIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSRFM6OkRCQ2x1c3RlcicsIHtcbiAgICAgIEVuYWJsZUh0dHBFbmRwb2ludDogdHJ1ZSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnZ3JhbnQgRGF0YSBBUEkgYWNjZXNzIHRocm93cyBpZiB0aGUgRGF0YSBBUEkgaXMgZGlzYWJsZWQnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IHZwYyA9IGVjMi5WcGMuZnJvbUxvb2t1cChzdGFjaywgJ1ZQQycsIHsgaXNEZWZhdWx0OiB0cnVlIH0pO1xuICAgIGNvbnN0IGNsdXN0ZXIgPSBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICAgIHZwYyxcbiAgICAgIGVuYWJsZURhdGFBcGk6IGZhbHNlLFxuICAgIH0pO1xuICAgIGNvbnN0IHVzZXIgPSBuZXcgaWFtLlVzZXIoc3RhY2ssICdVc2VyJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgZXhwZWN0KCgpID0+IGNsdXN0ZXIuZ3JhbnREYXRhQXBpQWNjZXNzKHVzZXIpKS50b1Rocm93KC9DYW5ub3QgZ3JhbnQgRGF0YSBBUEkgYWNjZXNzIHdoZW4gdGhlIERhdGEgQVBJIGlzIGRpc2FibGVkLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NoYW5nZXMgdGhlIGNhc2Ugb2YgdGhlIGNsdXN0ZXIgaWRlbnRpZmllciBpZiB0aGUgbG93ZXJjYXNlRGJJZGVudGlmaWVyIGZlYXR1cmUgZmxhZyBpcyBlbmFibGVkJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IGNkay5BcHAoe1xuICAgICAgY29udGV4dDogeyBbY3hhcGkuUkRTX0xPV0VSQ0FTRV9EQl9JREVOVElGSUVSXTogdHJ1ZSB9LFxuICAgIH0pO1xuICAgIGNvbnN0IHN0YWNrID0gdGVzdFN0YWNrKGFwcCk7XG4gICAgY29uc3QgY2x1c3RlcklkZW50aWZpZXIgPSAnVGVzdENsdXN0ZXJJZGVudGlmaWVyJztcbiAgICBjb25zdCB2cGMgPSBlYzIuVnBjLmZyb21Mb29rdXAoc3RhY2ssICdWUEMnLCB7IGlzRGVmYXVsdDogdHJ1ZSB9KTtcblxuICAgIC8vIFdIRU5cbiAgICBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICAgIHZwYyxcbiAgICAgIGNsdXN0ZXJJZGVudGlmaWVyLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJEUzo6REJDbHVzdGVyJywge1xuICAgICAgREJDbHVzdGVySWRlbnRpZmllcjogY2x1c3RlcklkZW50aWZpZXIudG9Mb3dlckNhc2UoKSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnZG9lcyBub3QgY2hhbmdlIHRoZSBjYXNlIG9mIHRoZSBjbHVzdGVyIGlkZW50aWZpZXIgaWYgdGhlIGxvd2VyY2FzZURiSWRlbnRpZmllciBmZWF0dXJlIGZsYWcgaXMgZGlzYWJsZWQnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgY2RrLkFwcCh7IGNvbnRleHQ6IHsgJ0Bhd3MtY2RrL2F3cy1yZHM6bG93ZXJjYXNlRGJJZGVudGlmaWVyJzogZmFsc2UgfSB9KTtcbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjayhhcHApO1xuICAgIGNvbnN0IGNsdXN0ZXJJZGVudGlmaWVyID0gJ1Rlc3RDbHVzdGVySWRlbnRpZmllcic7XG4gICAgY29uc3QgdnBjID0gZWMyLlZwYy5mcm9tTG9va3VwKHN0YWNrLCAnVlBDJywgeyBpc0RlZmF1bHQ6IHRydWUgfSk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgICB2cGMsXG4gICAgICBjbHVzdGVySWRlbnRpZmllcixcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSRFM6OkRCQ2x1c3RlcicsIHtcbiAgICAgIERCQ2x1c3RlcklkZW50aWZpZXI6IGNsdXN0ZXJJZGVudGlmaWVyLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gY3JlYXRlIGEgU2VydmVybGVzcyBjbHVzdGVyIHdpdGhvdXQgVlBDJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSB0ZXN0U3RhY2soKTtcblxuICAgIC8vIFdIRU5cbiAgICBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSRFM6OkRCQ2x1c3RlcicsIHtcbiAgICAgIEVuZ2luZTogJ2F1cm9yYS1teXNxbCcsXG4gICAgICBFbmdpbmVNb2RlOiAnc2VydmVybGVzcycsXG4gICAgICBEYlN1Ym5ldEdyb3VwTmFtZTogTWF0Y2guYWJzZW50KCksXG4gICAgICBWcGNTZWN1cml0eUdyb3VwSWRzOiBbXSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnY2Fubm90IGNyZWF0ZSBhIFNlcnZlcmxlc3MgY2x1c3RlciB3aXRob3V0IFZQQyBidXQgc3BlY2lmeWluZyBhIHNlY3VyaXR5IGdyb3VwJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSB0ZXN0U3RhY2soKTtcbiAgICBjb25zdCBzZyA9IGVjMi5TZWN1cml0eUdyb3VwLmZyb21TZWN1cml0eUdyb3VwSWQoc3RhY2ssICdTRycsICdTZWN1cml0eUdyb3VwSWQxMjM0NScpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCgoKSA9PiBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICAgIHNlY3VyaXR5R3JvdXBzOiBbc2ddLFxuICAgIH0pKS50b1Rocm93KC9BIFZQQyBpcyByZXF1aXJlZCB0byB1c2Ugc2VjdXJpdHlHcm91cHMgaW4gU2VydmVybGVzc0NsdXN0ZXIuIFBsZWFzZSBhZGQgYSBWUEMgb3IgcmVtb3ZlIHNlY3VyaXR5R3JvdXBzLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2Nhbm5vdCBjcmVhdGUgYSBTZXJ2ZXJsZXNzIGNsdXN0ZXIgd2l0aG91dCBWUEMgYnV0IHNwZWNpZnlpbmcgYSBzdWJuZXQgZ3JvdXAnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuICAgIGNvbnN0IFN1Ym5ldEdyb3VwTmFtZSA9ICdTdWJuZXRHcm91cElkMTIzNDUnO1xuICAgIGNvbnN0IHN1Ym5ldEdyb3VwID0gU3VibmV0R3JvdXAuZnJvbVN1Ym5ldEdyb3VwTmFtZShzdGFjaywgJ1N1Ym5ldEdyb3VwMTIzNDUnLCBTdWJuZXRHcm91cE5hbWUpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCgoKSA9PiBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQV9NWVNRTCxcbiAgICAgIHN1Ym5ldEdyb3VwLFxuICAgIH0pKS50b1Rocm93KC9BIFZQQyBpcyByZXF1aXJlZCB0byB1c2Ugc3VibmV0R3JvdXAgaW4gU2VydmVybGVzc0NsdXN0ZXIuIFBsZWFzZSBhZGQgYSBWUEMgb3IgcmVtb3ZlIHN1Ym5ldEdyb3VwLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2Nhbm5vdCBjcmVhdGUgYSBTZXJ2ZXJsZXNzIGNsdXN0ZXIgd2l0aG91dCBWUEMgYnV0IHNwZWNpZnlpbmcgVlBDIHN1Ym5ldHMnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHZwY1N1Ym5ldHMgPSB7XG4gICAgICBzdWJuZXROYW1lOiAnQVZwY1N1Ym5ldCcsXG4gICAgfTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoKCkgPT4gbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgICB2cGNTdWJuZXRzLFxuICAgIH0pKS50b1Rocm93KC9BIFZQQyBpcyByZXF1aXJlZCB0byB1c2UgdnBjU3VibmV0cyBpbiBTZXJ2ZXJsZXNzQ2x1c3Rlci4gUGxlYXNlIGFkZCBhIFZQQyBvciByZW1vdmUgdnBjU3VibmV0cy8pO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gY2FsbCBleHBvcnRWYWx1ZSBvbiBlbmRwb2ludC5wb3J0JywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgY29uc3QgdnBjID0gbmV3IGVjMi5WcGMoc3RhY2ssICdWUEMnKTtcbiAgICBjb25zdCBjbHVzdGVyID0gbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfTVlTUUwsXG4gICAgICBjcmVkZW50aWFsczogeyB1c2VybmFtZTogJ2FkbWluJyB9LFxuICAgICAgdnBjLFxuICAgIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIHN0YWNrLmV4cG9ydFZhbHVlKGNsdXN0ZXIuY2x1c3RlckVuZHBvaW50LnBvcnQpO1xuXG4gICAgLy8gVEhFTlxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcbiAgICB0ZW1wbGF0ZS5oYXNPdXRwdXQoJ0V4cG9ydHNPdXRwdXRGbkdldEF0dERhdGFiYXNlQjI2OUQ4QkJFbmRwb2ludFBvcnQzQUNCM0Y1MScsIHtcbiAgICAgIFZhbHVlOiB7ICdGbjo6R2V0QXR0JzogWydEYXRhYmFzZUIyNjlEOEJCJywgJ0VuZHBvaW50LlBvcnQnXSB9LFxuICAgICAgRXhwb3J0OiB7IE5hbWU6ICdEZWZhdWx0OkV4cG9ydHNPdXRwdXRGbkdldEF0dERhdGFiYXNlQjI2OUQ4QkJFbmRwb2ludFBvcnQzQUNCM0Y1MScgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnY2x1c3RlciB3aXRoIGNvcHlUYWdzVG9TbmFwc2hvdCBkZWZhdWx0JywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSB0ZXN0U3RhY2soKTtcblxuICAgIC8vIFdIRU5cbiAgICBuZXcgU2VydmVybGVzc0NsdXN0ZXIoc3RhY2ssICdEYXRhYmFzZScsIHtcbiAgICAgIGVuZ2luZTogRGF0YWJhc2VDbHVzdGVyRW5naW5lLkFVUk9SQSxcbiAgICAgIHBhcmFtZXRlckdyb3VwOiBQYXJhbWV0ZXJHcm91cC5mcm9tUGFyYW1ldGVyR3JvdXBOYW1lKHN0YWNrLCAnUGFyYW1ldGVyR3JvdXAnLCAnZGVmYXVsdC5hdXJvcmEtcG9zdGdyZXNxbDEwJyksXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6UkRTOjpEQkNsdXN0ZXInLCB7XG4gICAgICBDb3B5VGFnc1RvU25hcHNob3Q6IHRydWUsXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NsdXN0ZXIgd2l0aCBjb3B5VGFnc1RvU25hcHNob3QgZGlzYWJsZWQnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IHRlc3RTdGFjaygpO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBTZXJ2ZXJsZXNzQ2x1c3RlcihzdGFjaywgJ0RhdGFiYXNlJywge1xuICAgICAgZW5naW5lOiBEYXRhYmFzZUNsdXN0ZXJFbmdpbmUuQVVST1JBX1BPU1RHUkVTUUwsXG4gICAgICBjb3B5VGFnc1RvU25hcHNob3Q6IGZhbHNlLFxuICAgICAgcGFyYW1ldGVyR3JvdXA6IFBhcmFtZXRlckdyb3VwLmZyb21QYXJhbWV0ZXJHcm91cE5hbWUoc3RhY2ssICdQYXJhbWV0ZXJHcm91cCcsICdkZWZhdWx0LmF1cm9yYS1wb3N0Z3Jlc3FsMTAnKSxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSRFM6OkRCQ2x1c3RlcicsIHtcbiAgICAgIENvcHlUYWdzVG9TbmFwc2hvdDogZmFsc2UsXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NsdXN0ZXIgd2l0aCBjb3B5VGFnc1RvU25hcHNob3QgZW5hYmxlZCcsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gdGVzdFN0YWNrKCk7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IFNlcnZlcmxlc3NDbHVzdGVyKHN0YWNrLCAnRGF0YWJhc2UnLCB7XG4gICAgICBlbmdpbmU6IERhdGFiYXNlQ2x1c3RlckVuZ2luZS5BVVJPUkFfUE9TVEdSRVNRTCxcbiAgICAgIGNvcHlUYWdzVG9TbmFwc2hvdDogdHJ1ZSxcbiAgICAgIHBhcmFtZXRlckdyb3VwOiBQYXJhbWV0ZXJHcm91cC5mcm9tUGFyYW1ldGVyR3JvdXBOYW1lKHN0YWNrLCAnUGFyYW1ldGVyR3JvdXAnLCAnZGVmYXVsdC5hdXJvcmEtcG9zdGdyZXNxbDEwJyksXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6UkRTOjpEQkNsdXN0ZXInLCB7XG4gICAgICBDb3B5VGFnc1RvU25hcHNob3Q6IHRydWUsXG4gICAgfSk7XG4gIH0pO1xuXG59KTtcblxuZnVuY3Rpb24gdGVzdFN0YWNrKGFwcD86IGNkay5BcHAsIGlkPzogc3RyaW5nKTogY2RrLlN0YWNrIHtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKGFwcCwgaWQsIHsgZW52OiB7IGFjY291bnQ6ICcxMjM0NScsIHJlZ2lvbjogJ3VzLXRlc3QtMScgfSB9KTtcbiAgc3RhY2subm9kZS5zZXRDb250ZXh0KCdhdmFpbGFiaWxpdHktem9uZXM6MTIzNDU6dXMtdGVzdC0xJywgWyd1cy10ZXN0LTFhJywgJ3VzLXRlc3QtMWInXSk7XG4gIHJldHVybiBzdGFjaztcbn1cbiJdfQ==