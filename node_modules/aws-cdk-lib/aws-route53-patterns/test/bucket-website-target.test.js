"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const aws_certificatemanager_1 = require("../../aws-certificatemanager");
const aws_route53_1 = require("../../aws-route53");
const cdk_build_tools_1 = require("@aws-cdk/cdk-build-tools");
const core_1 = require("../../core");
const cx_api_1 = require("../../cx-api");
const lib_1 = require("../lib");
(0, cdk_build_tools_1.testDeprecated)('create HTTPS redirect', () => {
    // GIVEN
    const app = new core_1.App();
    const stack = new core_1.Stack(app, 'test', { env: { region: 'us-east-1' } });
    // WHEN
    new lib_1.HttpsRedirect(stack, 'Redirect', {
        recordNames: ['foo.example.com', 'baz.example.com'],
        targetDomain: 'bar.example.com',
        zone: aws_route53_1.HostedZone.fromHostedZoneAttributes(stack, 'HostedZone', {
            hostedZoneId: 'ID',
            zoneName: 'example.com',
        }),
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::S3::Bucket', {
        WebsiteConfiguration: {
            RedirectAllRequestsTo: {
                HostName: 'bar.example.com',
                Protocol: 'https',
            },
        },
        PublicAccessBlockConfiguration: {
            BlockPublicAcls: true,
            BlockPublicPolicy: true,
            IgnorePublicAcls: true,
            RestrictPublicBuckets: true,
        },
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::Distribution', {
        DistributionConfig: {
            Aliases: ['foo.example.com', 'baz.example.com'],
            DefaultRootObject: '',
        },
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Type: 'A',
        Name: 'foo.example.com.',
        HostedZoneId: 'ID',
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Type: 'AAAA',
        Name: 'foo.example.com.',
        HostedZoneId: 'ID',
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Type: 'A',
        Name: 'baz.example.com.',
        HostedZoneId: 'ID',
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Type: 'AAAA',
        Name: 'baz.example.com.',
        HostedZoneId: 'ID',
    });
});
(0, cdk_build_tools_1.testDeprecated)('create HTTPS redirect for apex', () => {
    // GIVEN
    const app = new core_1.App();
    const stack = new core_1.Stack(app, 'test', { env: { region: 'us-east-1' } });
    // WHEN
    new lib_1.HttpsRedirect(stack, 'Redirect', {
        targetDomain: 'bar.example.com',
        zone: aws_route53_1.HostedZone.fromHostedZoneAttributes(stack, 'HostedZone', {
            hostedZoneId: 'ID',
            zoneName: 'example.com',
        }),
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::S3::Bucket', {
        WebsiteConfiguration: {
            RedirectAllRequestsTo: {
                HostName: 'bar.example.com',
                Protocol: 'https',
            },
        },
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Type: 'A',
        Name: 'example.com.',
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Type: 'AAAA',
        Name: 'example.com.',
    });
});
(0, cdk_build_tools_1.testDeprecated)('create HTTPS redirect with existing cert', () => {
    // GIVEN
    const app = new core_1.App();
    const stack = new core_1.Stack(app, 'test', { env: { region: 'us-east-1' } });
    // WHEN
    new lib_1.HttpsRedirect(stack, 'Redirect', {
        recordNames: ['foo.example.com'],
        certificate: aws_certificatemanager_1.Certificate.fromCertificateArn(stack, 'Certificate', 'arn:aws:acm:us-east-1:1111111:certificate/11-3336f1-44483d-adc7-9cd375c5169d'),
        targetDomain: 'bar.example.com',
        zone: aws_route53_1.HostedZone.fromHostedZoneAttributes(stack, 'HostedZone', {
            hostedZoneId: 'ID',
            zoneName: 'example.com',
        }),
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::S3::Bucket', {
        WebsiteConfiguration: {
            RedirectAllRequestsTo: {
                HostName: 'bar.example.com',
                Protocol: 'https',
            },
        },
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::Distribution', {
        DistributionConfig: {
            ViewerCertificate: {
                AcmCertificateArn: 'arn:aws:acm:us-east-1:1111111:certificate/11-3336f1-44483d-adc7-9cd375c5169d',
            },
        },
    });
});
test('throws when certificate in region other than us-east-1 is supplied', () => {
    // GIVEN
    const app = new core_1.App();
    const stack = new core_1.Stack(app, 'test', { env: { region: 'us-east-1' } });
    const certificate = aws_certificatemanager_1.Certificate.fromCertificateArn(stack, 'Certificate', 'arn:aws:acm:us-east-2:123456789012:certificate/11-3336f1-44483d-adc7-9cd375c5169d');
    // WHEN / THEN
    expect(() => {
        new lib_1.HttpsRedirect(stack, 'Redirect', {
            recordNames: ['foo.example.com'],
            certificate,
            targetDomain: 'bar.example.com',
            zone: aws_route53_1.HostedZone.fromHostedZoneAttributes(stack, 'HostedZone', {
                hostedZoneId: 'ID',
                zoneName: 'example.com',
            }),
        });
    }).toThrow(/The certificate must be in the us-east-1 region and the certificate you provided is in us-east-2./);
});
describe('Uses Certificate when @aws-cdk/aws-route53-patters:useCertificate=true', () => {
    test('explicit different region', () => {
        // GIVEN
        const app = new core_1.App({
            context: {
                [cx_api_1.ROUTE53_PATTERNS_USE_CERTIFICATE]: true,
            },
        });
        // WHEN
        const stack = new core_1.Stack(app, 'test', { env: { region: 'us-east-2' }, crossRegionReferences: true });
        new lib_1.HttpsRedirect(stack, 'Redirect', {
            recordNames: ['foo.example.com'],
            targetDomain: 'bar.example.com',
            zone: aws_route53_1.HostedZone.fromHostedZoneAttributes(stack, 'HostedZone', {
                hostedZoneId: 'ID',
                zoneName: 'example.com',
            }),
        });
        // THEN
        const certStack = app.node.findChild(`certificate-redirect-stack-${stack.node.addr}`);
        assertions_1.Template.fromStack(certStack).hasResourceProperties('AWS::CertificateManager::Certificate', {
            DomainName: 'foo.example.com',
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                ViewerCertificate: {
                    AcmCertificateArn: {
                        'Fn::GetAtt': [
                            'ExportsReader8B249524',
                            '/cdk/exports/test/certificateredirectstackc8e2763df63c0f7e0c9afe0394e299bb731e281e8euseast1RefRedirectCertificatec8693e36481e135aa76e35c2db892ec6a33a94c7461E1B6E15A36EB7DA',
                        ],
                    },
                },
            },
        });
    });
    test('explicit same region', () => {
        // GIVEN
        const app = new core_1.App({
            context: {
                [cx_api_1.ROUTE53_PATTERNS_USE_CERTIFICATE]: true,
            },
        });
        // WHEN
        const stack = new core_1.Stack(app, 'test', { env: { region: 'us-east-1' }, crossRegionReferences: true });
        new lib_1.HttpsRedirect(stack, 'Redirect', {
            recordNames: ['foo.example.com'],
            targetDomain: 'bar.example.com',
            zone: aws_route53_1.HostedZone.fromHostedZoneAttributes(stack, 'HostedZone', {
                hostedZoneId: 'ID',
                zoneName: 'example.com',
            }),
        });
        // THEN
        const certStack = app.node.tryFindChild(`certificate-redirect-stack-${stack.node.addr}`);
        expect(certStack).toBeUndefined();
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CertificateManager::Certificate', {
            DomainName: 'foo.example.com',
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFront::Distribution', {
            DistributionConfig: {
                ViewerCertificate: {
                    AcmCertificateArn: {
                        Ref: 'RedirectRedirectCertificateB4F2F130',
                    },
                },
            },
        });
    });
    test('same support stack used for multiple certificates', () => {
        // GIVEN
        const app = new core_1.App({
            context: {
                [cx_api_1.ROUTE53_PATTERNS_USE_CERTIFICATE]: true,
            },
        });
        // WHEN
        const stack = new core_1.Stack(app, 'test', { env: { region: 'us-east-2' }, crossRegionReferences: true });
        new lib_1.HttpsRedirect(stack, 'Redirect', {
            recordNames: ['foo.example.com'],
            targetDomain: 'bar.example.com',
            zone: aws_route53_1.HostedZone.fromHostedZoneAttributes(stack, 'HostedZone', {
                hostedZoneId: 'ID',
                zoneName: 'example.com',
            }),
        });
        new lib_1.HttpsRedirect(stack, 'Redirect2', {
            recordNames: ['foo2.example.com'],
            targetDomain: 'bar2.example.com',
            zone: aws_route53_1.HostedZone.fromHostedZoneAttributes(stack, 'HostedZone2', {
                hostedZoneId: 'ID',
                zoneName: 'example.com',
            }),
        });
        // THEN
        const certStack = app.node.tryFindChild(`certificate-redirect-stack-${stack.node.addr}`);
        assertions_1.Template.fromStack(certStack).hasResourceProperties('AWS::CertificateManager::Certificate', {
            DomainName: 'foo.example.com',
        });
        assertions_1.Template.fromStack(certStack).hasResourceProperties('AWS::CertificateManager::Certificate', {
            DomainName: 'foo2.example.com',
        });
    });
    test('unresolved region throws', () => {
        // GIVEN
        const app = new core_1.App({
            context: {
                [cx_api_1.ROUTE53_PATTERNS_USE_CERTIFICATE]: true,
            },
        });
        // WHEN
        const stack = new core_1.Stack(app, 'test');
        // THEN
        expect(() => {
            new lib_1.HttpsRedirect(stack, 'Redirect', {
                recordNames: ['foo.example.com'],
                targetDomain: 'bar.example.com',
                zone: aws_route53_1.HostedZone.fromHostedZoneAttributes(stack, 'HostedZone', {
                    hostedZoneId: 'ID',
                    zoneName: 'example.com',
                }),
            });
        }).toThrow(/When @aws-cdk\/aws-route53-patters:useCertificate is enabled, a region must be defined on the Stack/);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVja2V0LXdlYnNpdGUtdGFyZ2V0LnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJidWNrZXQtd2Vic2l0ZS10YXJnZXQudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUE0QztBQUM1Qyx5RUFBMkQ7QUFDM0QsbURBQStDO0FBQy9DLDhEQUEwRDtBQUMxRCxxQ0FBd0M7QUFDeEMseUNBQWdFO0FBQ2hFLGdDQUF1QztBQUV2QyxJQUFBLGdDQUFjLEVBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQzNDLFFBQVE7SUFDUixNQUFNLEdBQUcsR0FBRyxJQUFJLFVBQUcsRUFBRSxDQUFDO0lBQ3RCLE1BQU0sS0FBSyxHQUFHLElBQUksWUFBSyxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRXZFLE9BQU87SUFDUCxJQUFJLG1CQUFhLENBQUMsS0FBSyxFQUFFLFVBQVUsRUFBRTtRQUNuQyxXQUFXLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxpQkFBaUIsQ0FBQztRQUNuRCxZQUFZLEVBQUUsaUJBQWlCO1FBQy9CLElBQUksRUFBRSx3QkFBVSxDQUFDLHdCQUF3QixDQUFDLEtBQUssRUFBRSxZQUFZLEVBQUU7WUFDN0QsWUFBWSxFQUFFLElBQUk7WUFDbEIsUUFBUSxFQUFFLGFBQWE7U0FDeEIsQ0FBQztLQUNILENBQUMsQ0FBQztJQUVILE9BQU87SUFDUCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxpQkFBaUIsRUFBRTtRQUNqRSxvQkFBb0IsRUFBRTtZQUNwQixxQkFBcUIsRUFBRTtnQkFDckIsUUFBUSxFQUFFLGlCQUFpQjtnQkFDM0IsUUFBUSxFQUFFLE9BQU87YUFDbEI7U0FDRjtRQUNELDhCQUE4QixFQUFFO1lBQzlCLGVBQWUsRUFBRSxJQUFJO1lBQ3JCLGlCQUFpQixF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UixNQUFNLEdBQUcsR0FBRyxJQUFJLFVBQUcsQ0FBQztZQUNsQixPQUFPLEVBQUU7Z0JBQ1AsQ0FBQyx5Q0FBZ0MsQ0FBQyxFQUFFLElBQUk7YUFDekM7U0FDRixDQUFDLENBQUM7UUFFSCxPQUFPO1FBQ1AsTUFBTSxLQUFLLEdBQUcsSUFBSSxZQUFLLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRXJDLE9BQU87UUFDUCxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsSUFBSSxtQkFBYSxDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUU7Z0JBQ25DLFdBQVcsRUFBRSxDQUFDLGlCQUFpQixDQUFDO2dCQUNoQyxZQUFZLEVBQUUsaUJBQWlCO2dCQUMvQixJQUFJLEVBQUUsd0JBQVUsQ0FBQyx3QkFBd0IsQ0FBQyxLQUFLLEVBQUUsWUFBWSxFQUFFO29CQUM3RCxZQUFZLEVBQUUsSUFBSTtvQkFDbEIsUUFBUSxFQUFFLGFBQWE7aUJBQ3hCLENBQUM7YUFDSCxDQUFDLENBQUM7UUFFTCxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMscUdBQXFHLENBQUMsQ0FBQztJQUNwSCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVtcGxhdGUgfSBmcm9tICcuLi8uLi9hc3NlcnRpb25zJztcbmltcG9ydCB7IENlcnRpZmljYXRlIH0gZnJvbSAnLi4vLi4vYXdzLWNlcnRpZmljYXRlbWFuYWdlcic7XG5pbXBvcnQgeyBIb3N0ZWRab25lIH0gZnJvbSAnLi4vLi4vYXdzLXJvdXRlNTMnO1xuaW1wb3J0IHsgdGVzdERlcHJlY2F0ZWQgfSBmcm9tICdAYXdzLWNkay9jZGstYnVpbGQtdG9vbHMnO1xuaW1wb3J0IHsgQXBwLCBTdGFjayB9IGZyb20gJy4uLy4uL2NvcmUnO1xuaW1wb3J0IHsgUk9VVEU1M19QQVRURVJOU19VU0VfQ0VSVElGSUNBVEUgfSBmcm9tICcuLi8uLi9jeC1hcGknO1xuaW1wb3J0IHsgSHR0cHNSZWRpcmVjdCB9IGZyb20gJy4uL2xpYic7XG5cbnRlc3REZXByZWNhdGVkKCdjcmVhdGUgSFRUUFMgcmVkaXJlY3QnLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAndGVzdCcsIHsgZW52OiB7IHJlZ2lvbjogJ3VzLWVhc3QtMScgfSB9KTtcblxuICAvLyBXSEVOXG4gIG5ldyBIdHRwc1JlZGlyZWN0KHN0YWNrLCAnUmVkaXJlY3QnLCB7XG4gICAgcmVjb3JkTmFtZXM6IFsnZm9vLmV4YW1wbGUuY29tJywgJ2Jhei5leGFtcGxlLmNvbSddLFxuICAgIHRhcmdldERvbWFpbjogJ2Jhci5leGFtcGxlLmNvbScsXG4gICAgem9uZTogSG9zdGVkWm9uZS5mcm9tSG9zdGVkWm9uZUF0dHJpYnV0ZXMoc3RhY2ssICdIb3N0ZWRab25lJywge1xuICAgICAgaG9zdGVkWm9uZUlkOiAnSUQnLFxuICAgICAgem9uZU5hbWU6ICdleGFtcGxlLmNvbScsXG4gICAgfSksXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6UzM6OkJ1Y2tldCcsIHtcbiAgICBXZWJzaXRlQ29uZmlndXJhdGlvbjoge1xuICAgICAgUmVkaXJlY3RBbGxSZXF1ZXN0c1RvOiB7XG4gICAgICAgIEhvc3ROYW1lOiAnYmFyLmV4YW1wbGUuY29tJyxcbiAgICAgICAgUHJvdG9jb2w6ICdodHRwcycsXG4gICAgICB9LFxuICAgIH0sXG4gICAgUHVibGljQWNjZXNzQmxvY2tDb25maWd1cmF0aW9uOiB7XG4gICAgICBCbG9ja1B1YmxpY0FjbHM6IHRydWUsXG4gICAgICBCbG9ja1B1YmxpY1BvbGljeTogdHJ1ZSxcbiAgICAgIElnbm9yZVB1YmxpY0FjbHM6IHRydWUsXG4gICAgICBSZXN0cmljdFB1YmxpY0J1Y2tldHM6IHRydWUsXG4gICAgfSxcbiAgfSk7XG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkRpc3RyaWJ1dGlvbicsIHtcbiAgICBEaXN0cmlidXRpb25Db25maWc6IHtcbiAgICAgIEFsaWFzZXM6IFsnZm9vLmV4YW1wbGUuY29tJywgJ2Jhei5leGFtcGxlLmNvbSddLFxuICAgICAgRGVmYXVsdFJvb3RPYmplY3Q6ICcnLFxuICAgIH0sXG4gIH0pO1xuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSb3V0ZTUzOjpSZWNvcmRTZXQnLCB7XG4gICAgVHlwZTogJ0EnLFxuICAgIE5hbWU6ICdmb28uZXhhbXBsZS5jb20uJyxcbiAgICBIb3N0ZWRab25lSWQ6ICdJRCcsXG4gIH0pO1xuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSb3V0ZTUzOjpSZWNvcmRTZXQnLCB7XG4gICAgVHlwZTogJ0FBQUEnLFxuICAgIE5hbWU6ICdmb28uZXhhbXBsZS5jb20uJyxcbiAgICBIb3N0ZWRab25lSWQ6ICdJRCcsXG4gIH0pO1xuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSb3V0ZTUzOjpSZWNvcmRTZXQnLCB7XG4gICAgVHlwZTogJ0EnLFxuICAgIE5hbWU6ICdiYXouZXhhbXBsZS5jb20uJyxcbiAgICBIb3N0ZWRab25lSWQ6ICdJRCcsXG4gIH0pO1xuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSb3V0ZTUzOjpSZWNvcmRTZXQnLCB7XG4gICAgVHlwZTogJ0FBQUEnLFxuICAgIE5hbWU6ICdiYXouZXhhbXBsZS5jb20uJyxcbiAgICBIb3N0ZWRab25lSWQ6ICdJRCcsXG4gIH0pO1xufSk7XG5cbnRlc3REZXByZWNhdGVkKCdjcmVhdGUgSFRUUFMgcmVkaXJlY3QgZm9yIGFwZXgnLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAndGVzdCcsIHsgZW52OiB7IHJlZ2lvbjogJ3VzLWVhc3QtMScgfSB9KTtcblxuICAvLyBXSEVOXG4gIG5ldyBIdHRwc1JlZGlyZWN0KHN0YWNrLCAnUmVkaXJlY3QnLCB7XG4gICAgdGFyZ2V0RG9tYWluOiAnYmFyLmV4YW1wbGUuY29tJyxcbiAgICB6b25lOiBIb3N0ZWRab25lLmZyb21Ib3N0ZWRab25lQXR0cmlidXRlcyhzdGFjaywgJ0hvc3RlZFpvbmUnLCB7XG4gICAgICBob3N0ZWRab25lSWQ6ICdJRCcsXG4gICAgICB6b25lTmFtZTogJ2V4YW1wbGUuY29tJyxcbiAgICB9KSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpTMzo6QnVja2V0Jywge1xuICAgIFdlYnNpdGVDb25maWd1cmF0aW9uOiB7XG4gICAgICBSZWRpcmVjdEFsbFJlcXVlc3RzVG86IHtcbiAgICAgICAgSG9zdE5hbWU6ICdiYXIuZXhhbXBsZS5jb20nLFxuICAgICAgICBQcm90b2NvbDogJ2h0dHBzJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJvdXRlNTM6OlJlY29yZFNldCcsIHtcbiAgICBUeXBlOiAnQScsXG4gICAgTmFtZTogJ2V4YW1wbGUuY29tLicsXG4gIH0pO1xuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSb3V0ZTUzOjpSZWNvcmRTZXQnLCB7XG4gICAgVHlwZTogJ0FBQUEnLFxuICAgIE5hbWU6ICdleGFtcGxlLmNvbS4nLFxuICB9KTtcbn0pO1xuXG50ZXN0RGVwcmVjYXRlZCgnY3JlYXRlIEhUVFBTIHJlZGlyZWN0IHdpdGggZXhpc3RpbmcgY2VydCcsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHAsICd0ZXN0JywgeyBlbnY6IHsgcmVnaW9uOiAndXMtZWFzdC0xJyB9IH0pO1xuXG4gIC8vIFdIRU5cbiAgbmV3IEh0dHBzUmVkaXJlY3Qoc3RhY2ssICdSZWRpcmVjdCcsIHtcbiAgICByZWNvcmROYW1lczogWydmb28uZXhhbXBsZS5jb20nXSxcbiAgICBjZXJ0aWZpY2F0ZTogQ2VydGlmaWNhdGUuZnJvbUNlcnRpZmljYXRlQXJuKFxuICAgICAgc3RhY2ssICdDZXJ0aWZpY2F0ZScsICdhcm46YXdzOmFjbTp1cy1lYXN0LTE6MTExMTExMTpjZXJ0aWZpY2F0ZS8xMS0zMzM2ZjEtNDQ0ODNkLWFkYzctOWNkMzc1YzUxNjlkJyxcbiAgICApLFxuICAgIHRhcmdldERvbWFpbjogJ2Jhci5leGFtcGxlLmNvbScsXG4gICAgem9uZTogSG9zdGVkWm9uZS5mcm9tSG9zdGVkWm9uZUF0dHJpYnV0ZXMoc3RhY2ssICdIb3N0ZWRab25lJywge1xuICAgICAgaG9zdGVkWm9uZUlkOiAnSUQnLFxuICAgICAgem9uZU5hbWU6ICdleGFtcGxlLmNvbScsXG4gICAgfSksXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6UzM6OkJ1Y2tldCcsIHtcbiAgICBXZWJzaXRlQ29uZmlndXJhdGlvbjoge1xuICAgICAgUmVkaXJlY3RBbGxSZXF1ZXN0c1RvOiB7XG4gICAgICAgIEhvc3ROYW1lOiAnYmFyLmV4YW1wbGUuY29tJyxcbiAgICAgICAgUHJvdG9jb2w6ICdodHRwcycsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZEZyb250OjpEaXN0cmlidXRpb24nLCB7XG4gICAgRGlzdHJpYnV0aW9uQ29uZmlnOiB7XG4gICAgICBWaWV3ZXJDZXJ0aWZpY2F0ZToge1xuICAgICAgICBBY21DZXJ0aWZpY2F0ZUFybjogJ2Fybjphd3M6YWNtOnVzLWVhc3QtMToxMTExMTExOmNlcnRpZmljYXRlLzExLTMzMzZmMS00NDQ4M2QtYWRjNy05Y2QzNzVjNTE2OWQnLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCd0aHJvd3Mgd2hlbiBjZXJ0aWZpY2F0ZSBpbiByZWdpb24gb3RoZXIgdGhhbiB1cy1lYXN0LTEgaXMgc3VwcGxpZWQnLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAndGVzdCcsIHsgZW52OiB7IHJlZ2lvbjogJ3VzLWVhc3QtMScgfSB9KTtcbiAgY29uc3QgY2VydGlmaWNhdGUgPSBDZXJ0aWZpY2F0ZS5mcm9tQ2VydGlmaWNhdGVBcm4oXG4gICAgc3RhY2ssICdDZXJ0aWZpY2F0ZScsICdhcm46YXdzOmFjbTp1cy1lYXN0LTI6MTIzNDU2Nzg5MDEyOmNlcnRpZmljYXRlLzExLTMzMzZmMS00NDQ4M2QtYWRjNy05Y2QzNzVjNTE2OWQnLFxuICApO1xuXG4gIC8vIFdIRU4gLyBUSEVOXG4gIGV4cGVjdCgoKSA9PiB7XG4gICAgbmV3IEh0dHBzUmVkaXJlY3Qoc3RhY2ssICdSZWRpcmVjdCcsIHtcbiAgICAgIHJlY29yZE5hbWVzOiBbJ2Zvby5leGFtcGxlLmNvbSddLFxuICAgICAgY2VydGlmaWNhdGUsXG4gICAgICB0YXJnZXREb21haW46ICdiYXIuZXhhbXBsZS5jb20nLFxuICAgICAgem9uZTogSG9zdGVkWm9uZS5mcm9tSG9zdGVkWm9uZUF0dHJpYnV0ZXMoc3RhY2ssICdIb3N0ZWRab25lJywge1xuICAgICAgICBob3N0ZWRab25lSWQ6ICdJRCcsXG4gICAgICAgIHpvbmVOYW1lOiAnZXhhbXBsZS5jb20nLFxuICAgICAgfSksXG4gICAgfSk7XG4gIH0pLnRvVGhyb3coL1RoZSBjZXJ0aWZpY2F0ZSBtdXN0IGJlIGluIHRoZSB1cy1lYXN0LTEgcmVnaW9uIGFuZCB0aGUgY2VydGlmaWNhdGUgeW91IHByb3ZpZGVkIGlzIGluIHVzLWVhc3QtMi4vKTtcbn0pO1xuXG5kZXNjcmliZSgnVXNlcyBDZXJ0aWZpY2F0ZSB3aGVuIEBhd3MtY2RrL2F3cy1yb3V0ZTUzLXBhdHRlcnM6dXNlQ2VydGlmaWNhdGU9dHJ1ZScsICgpID0+IHtcbiAgdGVzdCgnZXhwbGljaXQgZGlmZmVyZW50IHJlZ2lvbicsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoe1xuICAgICAgY29udGV4dDoge1xuICAgICAgICBbUk9VVEU1M19QQVRURVJOU19VU0VfQ0VSVElGSUNBVEVdOiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHAsICd0ZXN0JywgeyBlbnY6IHsgcmVnaW9uOiAndXMtZWFzdC0yJyB9LCBjcm9zc1JlZ2lvblJlZmVyZW5jZXM6IHRydWUgfSk7XG4gICAgbmV3IEh0dHBzUmVkaXJlY3Qoc3RhY2ssICdSZWRpcmVjdCcsIHtcbiAgICAgIHJlY29yZE5hbWVzOiBbJ2Zvby5leGFtcGxlLmNvbSddLFxuICAgICAgdGFyZ2V0RG9tYWluOiAnYmFyLmV4YW1wbGUuY29tJyxcbiAgICAgIHpvbmU6IEhvc3RlZFpvbmUuZnJvbUhvc3RlZFpvbmVBdHRyaWJ1dGVzKHN0YWNrLCAnSG9zdGVkWm9uZScsIHtcbiAgICAgICAgaG9zdGVkWm9uZUlkOiAnSUQnLFxuICAgICAgICB6b25lTmFtZTogJ2V4YW1wbGUuY29tJyxcbiAgICAgIH0pLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGNvbnN0IGNlcnRTdGFjayA9IGFwcC5ub2RlLmZpbmRDaGlsZChgY2VydGlmaWNhdGUtcmVkaXJlY3Qtc3RhY2stJHtzdGFjay5ub2RlLmFkZHJ9YCkgYXMgU3RhY2s7XG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKGNlcnRTdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNlcnRpZmljYXRlTWFuYWdlcjo6Q2VydGlmaWNhdGUnLCB7XG4gICAgICBEb21haW5OYW1lOiAnZm9vLmV4YW1wbGUuY29tJyxcbiAgICB9KTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRnJvbnQ6OkRpc3RyaWJ1dGlvbicsIHtcbiAgICAgIERpc3RyaWJ1dGlvbkNvbmZpZzoge1xuICAgICAgICBWaWV3ZXJDZXJ0aWZpY2F0ZToge1xuICAgICAgICAgIEFjbUNlcnRpZmljYXRlQXJuOiB7XG4gICAgICAgICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgICAgICAgJ0V4cG9ydHNSZWFkZXI4QjI0OTUyNCcsXG4gICAgICAgICAgICAgICcvY2RrL2V4cG9ydHMvdGVzdC9jZXJ0aWZpY2F0ZXJlZGlyZWN0c3RhY2tjOGUyNzYzZGY2M2MwZjdlMGM5YWZlMDM5NGUyOTliYjczMWUyODFlOGV1c2Vhc3QxUmVmUmVkaXJlY3RDZXJ0aWZpY2F0ZWM4NjkzZTM2NDgxZTEzNWFhNzZlMzVjMmRiODkyZWM2YTMzYTk0Yzc0NjFFMUI2RTE1QTM2RUI3REEnLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnZXhwbGljaXQgc2FtZSByZWdpb24nLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKHtcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgW1JPVVRFNTNfUEFUVEVSTlNfVVNFX0NFUlRJRklDQVRFXTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAndGVzdCcsIHsgZW52OiB7IHJlZ2lvbjogJ3VzLWVhc3QtMScgfSwgY3Jvc3NSZWdpb25SZWZlcmVuY2VzOiB0cnVlIH0pO1xuICAgIG5ldyBIdHRwc1JlZGlyZWN0KHN0YWNrLCAnUmVkaXJlY3QnLCB7XG4gICAgICByZWNvcmROYW1lczogWydmb28uZXhhbXBsZS5jb20nXSxcbiAgICAgIHRhcmdldERvbWFpbjogJ2Jhci5leGFtcGxlLmNvbScsXG4gICAgICB6b25lOiBIb3N0ZWRab25lLmZyb21Ib3N0ZWRab25lQXR0cmlidXRlcyhzdGFjaywgJ0hvc3RlZFpvbmUnLCB7XG4gICAgICAgIGhvc3RlZFpvbmVJZDogJ0lEJyxcbiAgICAgICAgem9uZU5hbWU6ICdleGFtcGxlLmNvbScsXG4gICAgICB9KSxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBjb25zdCBjZXJ0U3RhY2sgPSBhcHAubm9kZS50cnlGaW5kQ2hpbGQoYGNlcnRpZmljYXRlLXJlZGlyZWN0LXN0YWNrLSR7c3RhY2subm9kZS5hZGRyfWApO1xuICAgIGV4cGVjdChjZXJ0U3RhY2spLnRvQmVVbmRlZmluZWQoKTtcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDZXJ0aWZpY2F0ZU1hbmFnZXI6OkNlcnRpZmljYXRlJywge1xuICAgICAgRG9tYWluTmFtZTogJ2Zvby5leGFtcGxlLmNvbScsXG4gICAgfSk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZEZyb250OjpEaXN0cmlidXRpb24nLCB7XG4gICAgICBEaXN0cmlidXRpb25Db25maWc6IHtcbiAgICAgICAgVmlld2VyQ2VydGlmaWNhdGU6IHtcbiAgICAgICAgICBBY21DZXJ0aWZpY2F0ZUFybjoge1xuICAgICAgICAgICAgUmVmOiAnUmVkaXJlY3RSZWRpcmVjdENlcnRpZmljYXRlQjRGMkYxMzAnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdzYW1lIHN1cHBvcnQgc3RhY2sgdXNlZCBmb3IgbXVsdGlwbGUgY2VydGlmaWNhdGVzJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCh7XG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIFtST1VURTUzX1BBVFRFUk5TX1VTRV9DRVJUSUZJQ0FURV06IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ3Rlc3QnLCB7IGVudjogeyByZWdpb246ICd1cy1lYXN0LTInIH0sIGNyb3NzUmVnaW9uUmVmZXJlbmNlczogdHJ1ZSB9KTtcbiAgICBuZXcgSHR0cHNSZWRpcmVjdChzdGFjaywgJ1JlZGlyZWN0Jywge1xuICAgICAgcmVjb3JkTmFtZXM6IFsnZm9vLmV4YW1wbGUuY29tJ10sXG4gICAgICB0YXJnZXREb21haW46ICdiYXIuZXhhbXBsZS5jb20nLFxuICAgICAgem9uZTogSG9zdGVkWm9uZS5mcm9tSG9zdGVkWm9uZUF0dHJpYnV0ZXMoc3RhY2ssICdIb3N0ZWRab25lJywge1xuICAgICAgICBob3N0ZWRab25lSWQ6ICdJRCcsXG4gICAgICAgIHpvbmVOYW1lOiAnZXhhbXBsZS5jb20nLFxuICAgICAgfSksXG4gICAgfSk7XG5cbiAgICBuZXcgSHR0cHNSZWRpcmVjdChzdGFjaywgJ1JlZGlyZWN0MicsIHtcbiAgICAgIHJlY29yZE5hbWVzOiBbJ2ZvbzIuZXhhbXBsZS5jb20nXSxcbiAgICAgIHRhcmdldERvbWFpbjogJ2JhcjIuZXhhbXBsZS5jb20nLFxuICAgICAgem9uZTogSG9zdGVkWm9uZS5mcm9tSG9zdGVkWm9uZUF0dHJpYnV0ZXMoc3RhY2ssICdIb3N0ZWRab25lMicsIHtcbiAgICAgICAgaG9zdGVkWm9uZUlkOiAnSUQnLFxuICAgICAgICB6b25lTmFtZTogJ2V4YW1wbGUuY29tJyxcbiAgICAgIH0pLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGNvbnN0IGNlcnRTdGFjayA9IGFwcC5ub2RlLnRyeUZpbmRDaGlsZChgY2VydGlmaWNhdGUtcmVkaXJlY3Qtc3RhY2stJHtzdGFjay5ub2RlLmFkZHJ9YCkgYXMgU3RhY2s7XG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKGNlcnRTdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNlcnRpZmljYXRlTWFuYWdlcjo6Q2VydGlmaWNhdGUnLCB7XG4gICAgICBEb21haW5OYW1lOiAnZm9vLmV4YW1wbGUuY29tJyxcbiAgICB9KTtcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soY2VydFN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q2VydGlmaWNhdGVNYW5hZ2VyOjpDZXJ0aWZpY2F0ZScsIHtcbiAgICAgIERvbWFpbk5hbWU6ICdmb28yLmV4YW1wbGUuY29tJyxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgndW5yZXNvbHZlZCByZWdpb24gdGhyb3dzJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCh7XG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIFtST1VURTUzX1BBVFRFUk5TX1VTRV9DRVJUSUZJQ0FURV06IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ3Rlc3QnKTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgbmV3IEh0dHBzUmVkaXJlY3Qoc3RhY2ssICdSZWRpcmVjdCcsIHtcbiAgICAgICAgcmVjb3JkTmFtZXM6IFsnZm9vLmV4YW1wbGUuY29tJ10sXG4gICAgICAgIHRhcmdldERvbWFpbjogJ2Jhci5leGFtcGxlLmNvbScsXG4gICAgICAgIHpvbmU6IEhvc3RlZFpvbmUuZnJvbUhvc3RlZFpvbmVBdHRyaWJ1dGVzKHN0YWNrLCAnSG9zdGVkWm9uZScsIHtcbiAgICAgICAgICBob3N0ZWRab25lSWQ6ICdJRCcsXG4gICAgICAgICAgem9uZU5hbWU6ICdleGFtcGxlLmNvbScsXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICB9KS50b1Rocm93KC9XaGVuIEBhd3MtY2RrXFwvYXdzLXJvdXRlNTMtcGF0dGVyczp1c2VDZXJ0aWZpY2F0ZSBpcyBlbmFibGVkLCBhIHJlZ2lvbiBtdXN0IGJlIGRlZmluZWQgb24gdGhlIFN0YWNrLyk7XG4gIH0pO1xufSk7XG4iXX0=