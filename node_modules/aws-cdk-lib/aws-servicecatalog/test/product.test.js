"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const path = require("path");
const assertions_1 = require("../../assertions");
const sns = require("../../aws-sns");
const cdk = require("../../core");
const servicecatalog = require("../lib");
const lib_1 = require("../lib");
const product_stack_history_1 = require("../lib/product-stack-history");
/* eslint-disable quote-props */
describe('Product', () => {
    let app;
    let stack;
    beforeEach(() => {
        app = new cdk.App();
        stack = new cdk.Stack(app, 'Stack', {
            synthesizer: new cdk.LegacyStackSynthesizer(),
        });
    });
    test('default product test', () => {
        new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
            productName: 'testProduct',
            owner: 'testOwner',
            productVersions: [
                {
                    cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromUrl('https://awsdocs.s3.amazonaws.com/servicecatalog/development-environment.template'),
                },
            ],
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::ServiceCatalog::CloudFormationProduct', {
            Name: 'testProduct',
            Owner: 'testOwner',
            ProvisioningArtifactParameters: [
                {
                    'DisableTemplateValidation': false,
                    'Info': {
                        'LoadTemplateFromURL': 'https://awsdocs.s3.amazonaws.com/servicecatalog/development-environment.template',
                    },
                },
            ],
        });
    }),
        test('default product test with validation disabled', () => {
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    {
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromUrl('https://awsdocs.s3.amazonaws.com/servicecatalog/development-environment.template'),
                        validateTemplate: false,
                    },
                ],
            });
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::ServiceCatalog::CloudFormationProduct', {
                Name: 'testProduct',
                Owner: 'testOwner',
                ProvisioningArtifactParameters: [
                    {
                        'DisableTemplateValidation': true,
                        'Info': {
                            'LoadTemplateFromURL': 'https://awsdocs.s3.amazonaws.com/servicecatalog/development-environment.template',
                        },
                    },
                ],
            });
        }),
        test('product test from Asset', () => {
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    {
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromAsset(path.join(__dirname, 'product1.template.json')),
                    },
                ],
            });
            const assembly = app.synth();
            const synthesized = assembly.stacks[0];
            expect(synthesized.assets.length).toEqual(1);
        }),
        test('multiple product versions from Assets', () => {
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    {
                        productVersionName: 'v1',
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromAsset(path.join(__dirname, 'product1.template.json')),
                    },
                    {
                        productVersionName: 'v2',
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromAsset(path.join(__dirname, 'product2.template.json')),
                    },
                ],
            });
            const assembly = app.synth();
            const synthesized = assembly.stacks[0];
            expect(synthesized.assets.length).toEqual(2);
        }),
        test('product test from product stack', () => {
            const productStack = new servicecatalog.ProductStack(stack, 'ProductStack');
            new sns.Topic(productStack, 'SNSTopicProductStack');
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    {
                        productVersionName: 'v1',
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromProductStack(productStack),
                    },
                ],
            });
            const assembly = app.synth();
            expect(assembly.artifacts.length).toEqual(2);
            expect(assembly.stacks[0].assets.length).toBe(1);
            expect(assembly.stacks[0].assets[0].path).toEqual('StackProductStack190B56DE.product.template.json');
        }),
        test('multiple product versions from product stack', () => {
            const productStackVersion1 = new servicecatalog.ProductStack(stack, 'ProductStackV1');
            const productStackVersion2 = new servicecatalog.ProductStack(stack, 'ProductStackV2');
            new sns.Topic(productStackVersion1, 'SNSTopicProductStack1');
            new sns.Topic(productStackVersion2, 'SNSTopicProductStack2', {
                displayName: 'a test',
            });
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    {
                        productVersionName: 'v1',
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromProductStack(productStackVersion1),
                    },
                    {
                        productVersionName: 'v2',
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromProductStack(productStackVersion2),
                    },
                ],
            });
            const assembly = app.synth();
            expect(assembly.stacks[0].assets.length).toBe(2);
            expect(assembly.stacks[0].assets[0].path).toEqual('StackProductStackV111F65963.product.template.json');
            expect(assembly.stacks[0].assets[1].path).toEqual('StackProductStackV24832700A.product.template.json');
        }),
        test('identical product versions from product stack creates one asset', () => {
            class TestProductStack extends servicecatalog.ProductStack {
                constructor(scope, id) {
                    super(scope, id);
                    new sns.Topic(this, 'TopicProduct');
                }
            }
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    {
                        productVersionName: 'v1',
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromProductStack(new TestProductStack(stack, 'v1')),
                    },
                    {
                        productVersionName: 'v2',
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromProductStack(new TestProductStack(stack, 'v2')),
                    },
                    {
                        productVersionName: 'v3',
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromProductStack(new TestProductStack(stack, 'v3')),
                    },
                ],
            });
            const assembly = app.synth();
            expect(assembly.stacks[0].assets.length).toBe(1);
        }),
        test('product test from product stack history', () => {
            const productStack = new servicecatalog.ProductStack(stack, 'ProductStack');
            const productStackHistory = new product_stack_history_1.ProductStackHistory(stack, 'MyProductStackHistory', {
                productStack: productStack,
                currentVersionName: 'v1',
                currentVersionLocked: false,
            });
            new sns.Topic(productStack, 'SNSTopicProductStack');
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    productStackHistory.currentVersion(),
                ],
            });
            const assembly = app.synth();
            expect(assembly.artifacts.length).toEqual(2);
            expect(assembly.stacks[0].assets.length).toBe(1);
            expect(assembly.stacks[0].assets[0].path).toEqual('StackProductStack190B56DE.product.template.json');
            const expectedTemplateFileKey = 'StackMyProductStackHistory8F05371C.StackProductStack190B56DE.v1.product.template.json';
            const snapshotExists = fs.existsSync(path.join(lib_1.DEFAULT_PRODUCT_STACK_SNAPSHOT_DIRECTORY, expectedTemplateFileKey));
            expect(snapshotExists).toBe(true);
        }),
        test('product test from product stack history with nested directory', () => {
            const productStack = new servicecatalog.ProductStack(stack, 'ProductStack');
            const productStackHistory = new product_stack_history_1.ProductStackHistory(stack, 'MyProductStackHistory', {
                productStack: productStack,
                currentVersionName: 'v1',
                currentVersionLocked: false,
                directory: 'product-stack-snapshots/nested',
            });
            new sns.Topic(productStack, 'SNSTopicProductStack');
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    productStackHistory.currentVersion(),
                ],
            });
            const assembly = app.synth();
            expect(assembly.artifacts.length).toEqual(2);
            expect(assembly.stacks[0].assets.length).toBe(1);
            expect(assembly.stacks[0].assets[0].path).toEqual('StackProductStack190B56DE.product.template.json');
            const expectedTemplateFileKey = 'StackMyProductStackHistory8F05371C.StackProductStack190B56DE.v1.product.template.json';
            const snapshotExists = fs.existsSync(path.join('product-stack-snapshots/nested', expectedTemplateFileKey));
            expect(snapshotExists).toBe(true);
        }),
        test('fails product test from product stack when template changes and locked', () => {
            const productStack = new servicecatalog.ProductStack(stack, 'ProductStack');
            const productStackHistory = new product_stack_history_1.ProductStackHistory(stack, 'MyProductStackHistory', {
                productStack: productStack,
                currentVersionName: 'v1',
                currentVersionLocked: true,
            });
            new sns.Topic(productStack, 'SNSTopicProductStack2');
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    productStackHistory.currentVersion(),
                ],
            });
            expect(() => {
                app.synth();
            }).toThrowError('Template has changed for ProductStack Version v1');
        }),
        test('product test from product stack history when template changes and unlocked', () => {
            const productStack = new servicecatalog.ProductStack(stack, 'ProductStack');
            const productStackHistory = new product_stack_history_1.ProductStackHistory(stack, 'MyProductStackHistory', {
                productStack: productStack,
                currentVersionName: 'v1',
                currentVersionLocked: false,
            });
            new sns.Topic(productStack, 'SNSTopicProductStack2');
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    productStackHistory.currentVersion(),
                ],
            });
            const assembly = app.synth();
            expect(assembly.artifacts.length).toEqual(2);
            expect(assembly.stacks[0].assets.length).toBe(1);
            expect(assembly.stacks[0].assets[0].path).toEqual('StackProductStack190B56DE.product.template.json');
            const expectedTemplateFileKey = 'StackMyProductStackHistory8F05371C.StackProductStack190B56DE.v1.product.template.json';
            const snapshotExists = fs.existsSync(path.join(lib_1.DEFAULT_PRODUCT_STACK_SNAPSHOT_DIRECTORY, expectedTemplateFileKey));
            expect(snapshotExists).toBe(true);
        }),
        test('product test from product stack history snapshot', () => {
            const productStack = new servicecatalog.ProductStack(stack, 'ProductStack');
            const productStackHistory = new product_stack_history_1.ProductStackHistory(stack, 'MyProductStackHistory', {
                productStack: productStack,
                currentVersionName: 'v2',
                currentVersionLocked: false,
            });
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    productStackHistory.versionFromSnapshot('v1'),
                ],
            });
            const assembly = app.synth();
            expect(assembly.artifacts.length).toEqual(2);
            expect(assembly.stacks[0].assets.length).toBe(2);
            expect(assembly.stacks[0].assets[0].path).toEqual('asset.434625edc7e017d93f388b5f116c2ebcf11a38457cfb89a9b00d4e551c0bf731.json');
        }),
        test('fails product from product stack history snapshot not found', () => {
            const productStack = new servicecatalog.ProductStack(stack, 'ProductStack');
            const productStackHistory = new product_stack_history_1.ProductStackHistory(stack, 'MyProductStackHistory', {
                productStack: productStack,
                currentVersionName: 'v2',
                currentVersionLocked: false,
            });
            expect(() => {
                new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                    productName: 'testProduct',
                    owner: 'testOwner',
                    productVersions: [
                        productStackHistory.versionFromSnapshot('v3'),
                    ],
                });
            }).toThrowError('Template StackMyProductStackHistory8F05371C.StackProductStack190B56DE.v3.product.template.json cannot be found in product-stack-snapshots');
        }),
        test('product test from multiple sources', () => {
            new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                productName: 'testProduct',
                owner: 'testOwner',
                productVersions: [
                    {
                        productVersionName: 'v1',
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromUrl('https://awsdocs.s3.amazonaws.com/servicecatalog/development-environment.template'),
                    },
                    {
                        productVersionName: 'v2',
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromUrl('https://awsdocs.s3.amazonaws.com/servicecatalog/development-environment-v2.template'),
                    },
                    {
                        productVersionName: 'v3',
                        cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromAsset(path.join(__dirname, 'product1.template.json')),
                    },
                ],
            });
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::ServiceCatalog::CloudFormationProduct', {
                Name: 'testProduct',
                Owner: 'testOwner',
                ProvisioningArtifactParameters: assertions_1.Match.arrayWith([
                    assertions_1.Match.objectLike({
                        'Info': {
                            'LoadTemplateFromURL': 'https://awsdocs.s3.amazonaws.com/servicecatalog/development-environment.template',
                        },
                    }),
                ]),
            });
        }),
        test('product from attributes', () => {
            const product = servicecatalog.Product.fromProductArn(stack, 'MyProduct', 'arn:aws:catalog:region:account-id:product/prod-djh8932wr');
            expect(product.productArn).toEqual('arn:aws:catalog:region:account-id:product/prod-djh8932wr');
        }),
        test('fails product from attributes without resource name in arn', () => {
            expect(() => {
                servicecatalog.Product.fromProductArn(stack, 'MyProduct', 'arn:aws:catalog:region:account-id:product');
            }).toThrowError('Missing required Portfolio ID from Portfolio ARN: arn:aws:catalog:region:account-id:product');
        }),
        test('fails product creation with invalid email', () => {
            expect(() => {
                new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                    productName: 'testProduct',
                    owner: 'testOwner',
                    productVersions: [
                        {
                            cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromUrl('https://awsdocs.s3.amazonaws.com/servicecatalog/development-environment.template'),
                        },
                    ],
                    supportEmail: 'invalid email',
                });
            }).toThrowError(/Invalid support email for resource Stack\/MyProduct/);
        }),
        test('fails product creation with invalid url', () => {
            expect(() => {
                new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                    productName: 'testProduct',
                    owner: 'testOwner',
                    productVersions: [
                        {
                            cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromUrl('invalid url'),
                        },
                    ],
                });
            }).toThrowError(/Invalid provisioning template url for resource Stack\/MyProduct/);
        }),
        test('fails product creation with empty productVersions', () => {
            expect(() => {
                new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                    productName: 'testProduct',
                    owner: 'testOwner',
                    productVersions: [],
                });
            }).toThrowError(/Invalid product versions for resource Stack\/MyProduct/);
        }),
        describe('adding and associating TagOptions to a product', () => {
            let product;
            beforeEach(() => {
                product = new servicecatalog.CloudFormationProduct(stack, 'MyProduct', {
                    productName: 'testProduct',
                    owner: 'testOwner',
                    productVersions: [
                        {
                            cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromUrl('https://awsdocs.s3.amazonaws.com/servicecatalog/development-environment.template'),
                        },
                    ],
                });
            });
            test('add tag options to product', () => {
                const tagOptions = new servicecatalog.TagOptions(stack, 'TagOptions', {
                    allowedValuesForTags: {
                        key1: ['value1', 'value2'],
                        key2: ['value1'],
                    },
                });
                product.associateTagOptions(tagOptions);
                assertions_1.Template.fromStack(stack).resourceCountIs('AWS::ServiceCatalog::TagOption', 3); //Generates a resource for each unique key-value pair
                assertions_1.Template.fromStack(stack).resourceCountIs('AWS::ServiceCatalog::TagOptionAssociation', 3);
            }),
                test('add tag options as input to product in props', () => {
                    const tagOptions = new servicecatalog.TagOptions(stack, 'TagOptions', {
                        allowedValuesForTags: {
                            key1: ['value1', 'value2'],
                            key2: ['value1'],
                        },
                    });
                    new servicecatalog.CloudFormationProduct(stack, 'MyProductWithTagOptions', {
                        productName: 'testProduct',
                        owner: 'testOwner',
                        productVersions: [
                            {
                                cloudFormationTemplate: servicecatalog.CloudFormationTemplate.fromUrl('https://awsdocs.s3.amazonaws.com/servicecatalog/development-environment.template'),
                            },
                        ],
                        tagOptions: tagOptions,
                    });
                    assertions_1.Template.fromStack(stack).resourceCountIs('AWS::ServiceCatalog::TagOption', 3); //Generates a resource for each unique key-value pair
                    assertions_1.Template.fromStack(stack).resourceCountIs('AWS::ServiceCatalog::TagOptionAssociation', 3);
                }),
                test('adding tag options to product multiple times is idempotent', () => {
                    const tagOptions = new servicecatalog.TagOptions(stack, 'TagOptions', {
                        allowedValuesForTags: {
                            key1: ['value1', 'value2'],
                            key2: ['value1'],
                        },
                    });
                    product.associateTagOptions(tagOptions);
                    product.associateTagOptions(tagOptions); // If not idempotent this would fail
                    assertions_1.Template.fromStack(stack).resourceCountIs('AWS::ServiceCatalog::TagOption', 3); //Generates a resource for each unique key-value pair
                    assertions_1.Template.fromStack(stack).resourceCountIs('AWS::ServiceCatalog::TagOptionAssociation', 3);
                });
        });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicHJvZHVjdC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEseUJBQXlCO0FBQ3pCLDZCQUE2QjtBQUM3QixpREFBbUQ7QUFDbkQscUNBQXFDO0FBQ3JDLGtDQUFrQztBQUNsQyx5Q0FBeUM7QUFDekMsZ0NBQWtFO0FBQ2xFLHdFQUFtRTtBQUVuRSxnQ0FBZ0M7QUFDaEMsUUFBUSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7SUFDdkIsSUFBSSxHQUFZLENBQUM7SUFDakIsSUFBSSxLQUFnQixDQUFDO0lBRXJCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDcEIsS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFO1lBQ2xDLFdBQVcsRUFBRSxJQUFJLEdBQUcsQ0FBQyxzQkFBc0IsRUFBRTtTQUM5QyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7UUFDaEMsSUFBSSxjQUFjLENBQUMscUJBQXFCLENBQUMsS0FBSyxFQUFFLFdBQVcsRUFBRTtZQUMzRCxXQUFXLEVBQUUsYUFBYTtZQUMxQixLQUFLLEVBQUUsV0FBVztZQUNsQixlQUFlLEVBQUU7Z0JBQ2Y7b0JBQ0Usc0JBQXNCLEVBQUUsY0FBYyxDQUFDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxrRkFBa0YsQ0FBQztpQkFDMUo7YUFDRjtTQUNGLENBQUMsQ0FBQztRQUVILHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLDRDQUE0QyxFQUFFO1lBQzVGLElBQUksRUFBRSxhQUFhO1lBQ25CLEtBQUssRUFBRSxXQUFXO1lBQ2xCLDhCQUE4QixFQUFFO2dCQUM5QjtvQkFDRSwyQkFB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QyxDQUFDO2dCQUM1RixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgTWF0Y2gsIFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgKiBhcyBzbnMgZnJvbSAnLi4vLi4vYXdzLXNucyc7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgKiBhcyBzZXJ2aWNlY2F0YWxvZyBmcm9tICcuLi9saWInO1xuaW1wb3J0IHsgREVGQVVMVF9QUk9EVUNUX1NUQUNLX1NOQVBTSE9UX0RJUkVDVE9SWSB9IGZyb20gJy4uL2xpYic7XG5pbXBvcnQgeyBQcm9kdWN0U3RhY2tIaXN0b3J5IH0gZnJvbSAnLi4vbGliL3Byb2R1Y3Qtc3RhY2staGlzdG9yeSc7XG5cbi8qIGVzbGludC1kaXNhYmxlIHF1b3RlLXByb3BzICovXG5kZXNjcmliZSgnUHJvZHVjdCcsICgpID0+IHtcbiAgbGV0IGFwcDogY2RrLkFwcDtcbiAgbGV0IHN0YWNrOiBjZGsuU3RhY2s7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgYXBwID0gbmV3IGNkay5BcHAoKTtcbiAgICBzdGFjayA9IG5ldyBjZGsuU3RhY2soYXBwLCAnU3RhY2snLCB7XG4gICAgICBzeW50aGVzaXplcjogbmV3IGNkay5MZWdhY3lTdGFja1N5bnRoZXNpemVyKCksXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2RlZmF1bHQgcHJvZHVjdCB0ZXN0JywgKCkgPT4ge1xuICAgIG5ldyBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblByb2R1Y3Qoc3RhY2ssICdNeVByb2R1Y3QnLCB7XG4gICAgICBwcm9kdWN0TmFtZTogJ3Rlc3RQcm9kdWN0JyxcbiAgICAgIG93bmVyOiAndGVzdE93bmVyJyxcbiAgICAgIHByb2R1Y3RWZXJzaW9uczogW1xuICAgICAgICB7XG4gICAgICAgICAgY2xvdWRGb3JtYXRpb25UZW1wbGF0ZTogc2VydmljZWNhdGFsb2cuQ2xvdWRGb3JtYXRpb25UZW1wbGF0ZS5mcm9tVXJsKCdodHRwczovL2F3c2RvY3MuczMuYW1hem9uYXdzLmNvbS9zZXJ2aWNlY2F0YWxvZy9kZXZlbG9wbWVudC1lbnZpcm9ubWVudC50ZW1wbGF0ZScpLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlNlcnZpY2VDYXRhbG9nOjpDbG91ZEZvcm1hdGlvblByb2R1Y3QnLCB7XG4gICAgICBOYW1lOiAndGVzdFByb2R1Y3QnLFxuICAgICAgT3duZXI6ICd0ZXN0T3duZXInLFxuICAgICAgUHJvdmlzaW9uaW5nQXJ0aWZhY3RQYXJhbWV0ZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAnRGlzYWJsZVRlbXBsYXRlVmFsaWRhdGlvbic6IGZhbHNlLFxuICAgICAgICAgICdJbmZvJzoge1xuICAgICAgICAgICAgJ0xvYWRUZW1wbGF0ZUZyb21VUkwnOiAnaHR0cHM6Ly9hd3Nkb2NzLnMzLmFtYXpvbmF3cy5jb20vc2VydmljZWNhdGFsb2cvZGV2ZWxvcG1lbnQtZW52aXJvbm1lbnQudGVtcGxhdGUnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9KSxcblxuICB0ZXN0KCdkZWZhdWx0IHByb2R1Y3QgdGVzdCB3aXRoIHZhbGlkYXRpb24gZGlzYWJsZWQnLCAoKSA9PiB7XG4gICAgbmV3IHNlcnZpY2VjYXRhbG9nLkNsb3VkRm9ybWF0aW9uUHJvZHVjdChzdGFjaywgJ015UHJvZHVjdCcsIHtcbiAgICAgIHByb2R1Y3ROYW1lOiAndGVzdFByb2R1Y3QnLFxuICAgICAgb3duZXI6ICd0ZXN0T3duZXInLFxuICAgICAgcHJvZHVjdFZlcnNpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBjbG91ZEZvcm1hdGlvblRlbXBsYXRlOiBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblRlbXBsYXRlLmZyb21VcmwoJ2h0dHBzOi8vYXdzZG9jcy5zMy5hbWF6b25hd3MuY29tL3NlcnZpY2VjYXRhbG9nL2RldmVsb3BtZW50LWVudmlyb25tZW50LnRlbXBsYXRlJyksXG4gICAgICAgICAgdmFsaWRhdGVUZW1wbGF0ZTogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6U2VydmljZUNhdGFsb2c6OkNsb3VkRm9ybWF0aW9uUHJvZHVjdCcsIHtcbiAgICAgIE5hbWU6ICd0ZXN0UHJvZHVjdCcsXG4gICAgICBPd25lcjogJ3Rlc3RPd25lcicsXG4gICAgICBQcm92aXNpb25pbmdBcnRpZmFjdFBhcmFtZXRlcnM6IFtcbiAgICAgICAge1xuICAgICAgICAgICdEaXNhYmxlVGVtcGxhdGVWYWxpZGF0aW9uJzogdHJ1ZSxcbiAgICAgICAgICAnSW5mbyc6IHtcbiAgICAgICAgICAgICdMb2FkVGVtcGxhdGVGcm9tVVJMJzogJ2h0dHBzOi8vYXdzZG9jcy5zMy5hbWF6b25hd3MuY29tL3NlcnZpY2VjYXRhbG9nL2RldmVsb3BtZW50LWVudmlyb25tZW50LnRlbXBsYXRlJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSksXG5cbiAgdGVzdCgncHJvZHVjdCB0ZXN0IGZyb20gQXNzZXQnLCAoKSA9PiB7XG4gICAgbmV3IHNlcnZpY2VjYXRhbG9nLkNsb3VkRm9ybWF0aW9uUHJvZHVjdChzdGFjaywgJ015UHJvZHVjdCcsIHtcbiAgICAgIHByb2R1Y3ROYW1lOiAndGVzdFByb2R1Y3QnLFxuICAgICAgb3duZXI6ICd0ZXN0T3duZXInLFxuICAgICAgcHJvZHVjdFZlcnNpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBjbG91ZEZvcm1hdGlvblRlbXBsYXRlOiBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblRlbXBsYXRlLmZyb21Bc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCAncHJvZHVjdDEudGVtcGxhdGUuanNvbicpKSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBhc3NlbWJseSA9IGFwcC5zeW50aCgpO1xuICAgIGNvbnN0IHN5bnRoZXNpemVkID0gYXNzZW1ibHkuc3RhY2tzWzBdO1xuICAgIGV4cGVjdChzeW50aGVzaXplZC5hc3NldHMubGVuZ3RoKS50b0VxdWFsKDEpO1xuICB9KSxcblxuICB0ZXN0KCdtdWx0aXBsZSBwcm9kdWN0IHZlcnNpb25zIGZyb20gQXNzZXRzJywgKCkgPT4ge1xuICAgIG5ldyBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblByb2R1Y3Qoc3RhY2ssICdNeVByb2R1Y3QnLCB7XG4gICAgICBwcm9kdWN0TmFtZTogJ3Rlc3RQcm9kdWN0JyxcbiAgICAgIG93bmVyOiAndGVzdE93bmVyJyxcbiAgICAgIHByb2R1Y3RWZXJzaW9uczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvZHVjdFZlcnNpb25OYW1lOiAndjEnLFxuICAgICAgICAgIGNsb3VkRm9ybWF0aW9uVGVtcGxhdGU6IHNlcnZpY2VjYXRhbG9nLkNsb3VkRm9ybWF0aW9uVGVtcGxhdGUuZnJvbUFzc2V0KHBhdGguam9pbihfX2Rpcm5hbWUsICdwcm9kdWN0MS50ZW1wbGF0ZS5qc29uJykpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvZHVjdFZlcnNpb25OYW1lOiAndjInLFxuICAgICAgICAgIGNsb3VkRm9ybWF0aW9uVGVtcGxhdGU6IHNlcnZpY2VjYXRhbG9nLkNsb3VkRm9ybWF0aW9uVGVtcGxhdGUuZnJvbUFzc2V0KHBhdGguam9pbihfX2Rpcm5hbWUsICdwcm9kdWN0Mi50ZW1wbGF0ZS5qc29uJykpLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGFzc2VtYmx5ID0gYXBwLnN5bnRoKCk7XG4gICAgY29uc3Qgc3ludGhlc2l6ZWQgPSBhc3NlbWJseS5zdGFja3NbMF07XG4gICAgZXhwZWN0KHN5bnRoZXNpemVkLmFzc2V0cy5sZW5ndGgpLnRvRXF1YWwoMik7XG4gIH0pLFxuXG4gIHRlc3QoJ3Byb2R1Y3QgdGVzdCBmcm9tIHByb2R1Y3Qgc3RhY2snLCAoKSA9PiB7XG4gICAgY29uc3QgcHJvZHVjdFN0YWNrID0gbmV3IHNlcnZpY2VjYXRhbG9nLlByb2R1Y3RTdGFjayhzdGFjaywgJ1Byb2R1Y3RTdGFjaycpO1xuXG4gICAgbmV3IHNucy5Ub3BpYyhwcm9kdWN0U3RhY2ssICdTTlNUb3BpY1Byb2R1Y3RTdGFjaycpO1xuXG4gICAgbmV3IHNlcnZpY2VjYXRhbG9nLkNsb3VkRm9ybWF0aW9uUHJvZHVjdChzdGFjaywgJ015UHJvZHVjdCcsIHtcbiAgICAgIHByb2R1Y3ROYW1lOiAndGVzdFByb2R1Y3QnLFxuICAgICAgb3duZXI6ICd0ZXN0T3duZXInLFxuICAgICAgcHJvZHVjdFZlcnNpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm9kdWN0VmVyc2lvbk5hbWU6ICd2MScsXG4gICAgICAgICAgY2xvdWRGb3JtYXRpb25UZW1wbGF0ZTogc2VydmljZWNhdGFsb2cuQ2xvdWRGb3JtYXRpb25UZW1wbGF0ZS5mcm9tUHJvZHVjdFN0YWNrKHByb2R1Y3RTdGFjayksXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYXNzZW1ibHkgPSBhcHAuc3ludGgoKTtcbiAgICBleHBlY3QoYXNzZW1ibHkuYXJ0aWZhY3RzLmxlbmd0aCkudG9FcXVhbCgyKTtcbiAgICBleHBlY3QoYXNzZW1ibHkuc3RhY2tzWzBdLmFzc2V0cy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgZXhwZWN0KGFzc2VtYmx5LnN0YWNrc1swXS5hc3NldHNbMF0ucGF0aCkudG9FcXVhbCgnU3RhY2tQcm9kdWN0U3RhY2sxOTBCNTZERS5wcm9kdWN0LnRlbXBsYXRlLmpzb24nKTtcbiAgfSksXG5cbiAgdGVzdCgnbXVsdGlwbGUgcHJvZHVjdCB2ZXJzaW9ucyBmcm9tIHByb2R1Y3Qgc3RhY2snLCAoKSA9PiB7XG4gICAgY29uc3QgcHJvZHVjdFN0YWNrVmVyc2lvbjEgPSBuZXcgc2VydmljZWNhdGFsb2cuUHJvZHVjdFN0YWNrKHN0YWNrLCAnUHJvZHVjdFN0YWNrVjEnKTtcbiAgICBjb25zdCBwcm9kdWN0U3RhY2tWZXJzaW9uMiA9IG5ldyBzZXJ2aWNlY2F0YWxvZy5Qcm9kdWN0U3RhY2soc3RhY2ssICdQcm9kdWN0U3RhY2tWMicpO1xuXG4gICAgbmV3IHNucy5Ub3BpYyhwcm9kdWN0U3RhY2tWZXJzaW9uMSwgJ1NOU1RvcGljUHJvZHVjdFN0YWNrMScpO1xuXG4gICAgbmV3IHNucy5Ub3BpYyhwcm9kdWN0U3RhY2tWZXJzaW9uMiwgJ1NOU1RvcGljUHJvZHVjdFN0YWNrMicsIHtcbiAgICAgIGRpc3BsYXlOYW1lOiAnYSB0ZXN0JyxcbiAgICB9KTtcblxuICAgIG5ldyBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblByb2R1Y3Qoc3RhY2ssICdNeVByb2R1Y3QnLCB7XG4gICAgICBwcm9kdWN0TmFtZTogJ3Rlc3RQcm9kdWN0JyxcbiAgICAgIG93bmVyOiAndGVzdE93bmVyJyxcbiAgICAgIHByb2R1Y3RWZXJzaW9uczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvZHVjdFZlcnNpb25OYW1lOiAndjEnLFxuICAgICAgICAgIGNsb3VkRm9ybWF0aW9uVGVtcGxhdGU6IHNlcnZpY2VjYXRhbG9nLkNsb3VkRm9ybWF0aW9uVGVtcGxhdGUuZnJvbVByb2R1Y3RTdGFjayhwcm9kdWN0U3RhY2tWZXJzaW9uMSksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm9kdWN0VmVyc2lvbk5hbWU6ICd2MicsXG4gICAgICAgICAgY2xvdWRGb3JtYXRpb25UZW1wbGF0ZTogc2VydmljZWNhdGFsb2cuQ2xvdWRGb3JtYXRpb25UZW1wbGF0ZS5mcm9tUHJvZHVjdFN0YWNrKHByb2R1Y3RTdGFja1ZlcnNpb24yKSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBhc3NlbWJseSA9IGFwcC5zeW50aCgpO1xuXG4gICAgZXhwZWN0KGFzc2VtYmx5LnN0YWNrc1swXS5hc3NldHMubGVuZ3RoKS50b0JlKDIpO1xuICAgIGV4cGVjdChhc3NlbWJseS5zdGFja3NbMF0uYXNzZXRzWzBdLnBhdGgpLnRvRXF1YWwoJ1N0YWNrUHJvZHVjdFN0YWNrVjExMUY2NTk2My5wcm9kdWN0LnRlbXBsYXRlLmpzb24nKTtcbiAgICBleHBlY3QoYXNzZW1ibHkuc3RhY2tzWzBdLmFzc2V0c1sxXS5wYXRoKS50b0VxdWFsKCdTdGFja1Byb2R1Y3RTdGFja1YyNDgzMjcwMEEucHJvZHVjdC50ZW1wbGF0ZS5qc29uJyk7XG4gIH0pLFxuXG4gIHRlc3QoJ2lkZW50aWNhbCBwcm9kdWN0IHZlcnNpb25zIGZyb20gcHJvZHVjdCBzdGFjayBjcmVhdGVzIG9uZSBhc3NldCcsICgpID0+IHtcbiAgICBjbGFzcyBUZXN0UHJvZHVjdFN0YWNrIGV4dGVuZHMgc2VydmljZWNhdGFsb2cuUHJvZHVjdFN0YWNrIHtcbiAgICAgIGNvbnN0cnVjdG9yKHNjb3BlOiBhbnksIGlkOiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgICAgICBuZXcgc25zLlRvcGljKHRoaXMsICdUb3BpY1Byb2R1Y3QnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBuZXcgc2VydmljZWNhdGFsb2cuQ2xvdWRGb3JtYXRpb25Qcm9kdWN0KHN0YWNrLCAnTXlQcm9kdWN0Jywge1xuICAgICAgcHJvZHVjdE5hbWU6ICd0ZXN0UHJvZHVjdCcsXG4gICAgICBvd25lcjogJ3Rlc3RPd25lcicsXG4gICAgICBwcm9kdWN0VmVyc2lvbnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHByb2R1Y3RWZXJzaW9uTmFtZTogJ3YxJyxcbiAgICAgICAgICBjbG91ZEZvcm1hdGlvblRlbXBsYXRlOiBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblRlbXBsYXRlLmZyb21Qcm9kdWN0U3RhY2sobmV3IFRlc3RQcm9kdWN0U3RhY2soc3RhY2ssICd2MScpKSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb2R1Y3RWZXJzaW9uTmFtZTogJ3YyJyxcbiAgICAgICAgICBjbG91ZEZvcm1hdGlvblRlbXBsYXRlOiBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblRlbXBsYXRlLmZyb21Qcm9kdWN0U3RhY2sobmV3IFRlc3RQcm9kdWN0U3RhY2soc3RhY2ssICd2MicpKSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb2R1Y3RWZXJzaW9uTmFtZTogJ3YzJyxcbiAgICAgICAgICBjbG91ZEZvcm1hdGlvblRlbXBsYXRlOiBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblRlbXBsYXRlLmZyb21Qcm9kdWN0U3RhY2sobmV3IFRlc3RQcm9kdWN0U3RhY2soc3RhY2ssICd2MycpKSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBhc3NlbWJseSA9IGFwcC5zeW50aCgpO1xuXG4gICAgZXhwZWN0KGFzc2VtYmx5LnN0YWNrc1swXS5hc3NldHMubGVuZ3RoKS50b0JlKDEpO1xuICB9KSxcblxuICB0ZXN0KCdwcm9kdWN0IHRlc3QgZnJvbSBwcm9kdWN0IHN0YWNrIGhpc3RvcnknLCAoKSA9PiB7XG4gICAgY29uc3QgcHJvZHVjdFN0YWNrID0gbmV3IHNlcnZpY2VjYXRhbG9nLlByb2R1Y3RTdGFjayhzdGFjaywgJ1Byb2R1Y3RTdGFjaycpO1xuXG4gICAgY29uc3QgcHJvZHVjdFN0YWNrSGlzdG9yeSA9IG5ldyBQcm9kdWN0U3RhY2tIaXN0b3J5KHN0YWNrLCAnTXlQcm9kdWN0U3RhY2tIaXN0b3J5Jywge1xuICAgICAgcHJvZHVjdFN0YWNrOiBwcm9kdWN0U3RhY2ssXG4gICAgICBjdXJyZW50VmVyc2lvbk5hbWU6ICd2MScsXG4gICAgICBjdXJyZW50VmVyc2lvbkxvY2tlZDogZmFsc2UsXG4gICAgfSk7XG5cbiAgICBuZXcgc25zLlRvcGljKHByb2R1Y3RTdGFjaywgJ1NOU1RvcGljUHJvZHVjdFN0YWNrJyk7XG5cbiAgICBuZXcgc2VydmljZWNhdGFsb2cuQ2xvdWRGb3JtYXRpb25Qcm9kdWN0KHN0YWNrLCAnTXlQcm9kdWN0Jywge1xuICAgICAgcHJvZHVjdE5hbWU6ICd0ZXN0UHJvZHVjdCcsXG4gICAgICBvd25lcjogJ3Rlc3RPd25lcicsXG4gICAgICBwcm9kdWN0VmVyc2lvbnM6IFtcbiAgICAgICAgcHJvZHVjdFN0YWNrSGlzdG9yeS5jdXJyZW50VmVyc2lvbigpLFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGFzc2VtYmx5ID0gYXBwLnN5bnRoKCk7XG4gICAgZXhwZWN0KGFzc2VtYmx5LmFydGlmYWN0cy5sZW5ndGgpLnRvRXF1YWwoMik7XG4gICAgZXhwZWN0KGFzc2VtYmx5LnN0YWNrc1swXS5hc3NldHMubGVuZ3RoKS50b0JlKDEpO1xuICAgIGV4cGVjdChhc3NlbWJseS5zdGFja3NbMF0uYXNzZXRzWzBdLnBhdGgpLnRvRXF1YWwoJ1N0YWNrUHJvZHVjdFN0YWNrMTkwQjU2REUucHJvZHVjdC50ZW1wbGF0ZS5qc29uJyk7XG5cbiAgICBjb25zdCBleHBlY3RlZFRlbXBsYXRlRmlsZUtleSA9ICdTdGFja015UHJvZHVjdFN0YWNrSGlzdG9yeThGMDUzNzFDLlN0YWNrUHJvZHVjdFN0YWNrMTkwQjU2REUudjEucHJvZHVjdC50ZW1wbGF0ZS5qc29uJztcbiAgICBjb25zdCBzbmFwc2hvdEV4aXN0cyA9IGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKERFRkFVTFRfUFJPRFVDVF9TVEFDS19TTkFQU0hPVF9ESVJFQ1RPUlksIGV4cGVjdGVkVGVtcGxhdGVGaWxlS2V5KSk7XG4gICAgZXhwZWN0KHNuYXBzaG90RXhpc3RzKS50b0JlKHRydWUpO1xuICB9KSxcblxuICB0ZXN0KCdwcm9kdWN0IHRlc3QgZnJvbSBwcm9kdWN0IHN0YWNrIGhpc3Rvcnkgd2l0aCBuZXN0ZWQgZGlyZWN0b3J5JywgKCkgPT4ge1xuICAgIGNvbnN0IHByb2R1Y3RTdGFjayA9IG5ldyBzZXJ2aWNlY2F0YWxvZy5Qcm9kdWN0U3RhY2soc3RhY2ssICdQcm9kdWN0U3RhY2snKTtcblxuICAgIGNvbnN0IHByb2R1Y3RTdGFja0hpc3RvcnkgPSBuZXcgUHJvZHVjdFN0YWNrSGlzdG9yeShzdGFjaywgJ015UHJvZHVjdFN0YWNrSGlzdG9yeScsIHtcbiAgICAgIHByb2R1Y3RTdGFjazogcHJvZHVjdFN0YWNrLFxuICAgICAgY3VycmVudFZlcnNpb25OYW1lOiAndjEnLFxuICAgICAgY3VycmVudFZlcnNpb25Mb2NrZWQ6IGZhbHNlLFxuICAgICAgZGlyZWN0b3J5OiAncHJvZHVjdC1zdGFjay1zbmFwc2hvdHMvbmVzdGVkJyxcbiAgICB9KTtcblxuICAgIG5ldyBzbnMuVG9waWMocHJvZHVjdFN0YWNrLCAnU05TVG9waWNQcm9kdWN0U3RhY2snKTtcblxuICAgIG5ldyBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblByb2R1Y3Qoc3RhY2ssICdNeVByb2R1Y3QnLCB7XG4gICAgICBwcm9kdWN0TmFtZTogJ3Rlc3RQcm9kdWN0JyxcbiAgICAgIG93bmVyOiAndGVzdE93bmVyJyxcbiAgICAgIHByb2R1Y3RWZXJzaW9uczogW1xuICAgICAgICBwcm9kdWN0U3RhY2tIaXN0b3J5LmN1cnJlbnRWZXJzaW9uKCksXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYXNzZW1ibHkgPSBhcHAuc3ludGgoKTtcbiAgICBleHBlY3QoYXNzZW1ibHkuYXJ0aWZhY3RzLmxlbmd0aCkudG9FcXVhbCgyKTtcbiAgICBleHBlY3QoYXNzZW1ibHkuc3RhY2tzWzBdLmFzc2V0cy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgZXhwZWN0KGFzc2VtYmx5LnN0YWNrc1swXS5hc3NldHNbMF0ucGF0aCkudG9FcXVhbCgnU3RhY2tQcm9kdWN0U3RhY2sxOTBCNTZERS5wcm9kdWN0LnRlbXBsYXRlLmpzb24nKTtcblxuICAgIGNvbnN0IGV4cGVjdGVkVGVtcGxhdGVGaWxlS2V5ID0gJ1N0YWNrTXlQcm9kdWN0U3RhY2tIaXN0b3J5OEYwNTM3MUMuU3RhY2tQcm9kdWN0U3RhY2sxOTBCNTZERS52MS5wcm9kdWN0LnRlbXBsYXRlLmpzb24nO1xuICAgIGNvbnN0IHNuYXBzaG90RXhpc3RzID0gZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oJ3Byb2R1Y3Qtc3RhY2stc25hcHNob3RzL25lc3RlZCcsIGV4cGVjdGVkVGVtcGxhdGVGaWxlS2V5KSk7XG4gICAgZXhwZWN0KHNuYXBzaG90RXhpc3RzKS50b0JlKHRydWUpO1xuICB9KSxcblxuICB0ZXN0KCdmYWlscyBwcm9kdWN0IHRlc3QgZnJvbSBwcm9kdWN0IHN0YWNrIHdoZW4gdGVtcGxhdGUgY2hhbmdlcyBhbmQgbG9ja2VkJywgKCkgPT4ge1xuICAgIGNvbnN0IHByb2R1Y3RTdGFjayA9IG5ldyBzZXJ2aWNlY2F0YWxvZy5Qcm9kdWN0U3RhY2soc3RhY2ssICdQcm9kdWN0U3RhY2snKTtcblxuICAgIGNvbnN0IHByb2R1Y3RTdGFja0hpc3RvcnkgPSBuZXcgUHJvZHVjdFN0YWNrSGlzdG9yeShzdGFjaywgJ015UHJvZHVjdFN0YWNrSGlzdG9yeScsIHtcbiAgICAgIHByb2R1Y3RTdGFjazogcHJvZHVjdFN0YWNrLFxuICAgICAgY3VycmVudFZlcnNpb25OYW1lOiAndjEnLFxuICAgICAgY3VycmVudFZlcnNpb25Mb2NrZWQ6IHRydWUsXG4gICAgfSk7XG5cbiAgICBuZXcgc25zLlRvcGljKHByb2R1Y3RTdGFjaywgJ1NOU1RvcGljUHJvZHVjdFN0YWNrMicpO1xuXG4gICAgbmV3IHNlcnZpY2VjYXRhbG9nLkNsb3VkRm9ybWF0aW9uUHJvZHVjdChzdGFjaywgJ015UHJvZHVjdCcsIHtcbiAgICAgIHByb2R1Y3ROYW1lOiAndGVzdFByb2R1Y3QnLFxuICAgICAgb3duZXI6ICd0ZXN0T3duZXInLFxuICAgICAgcHJvZHVjdFZlcnNpb25zOiBbXG4gICAgICAgIHByb2R1Y3RTdGFja0hpc3RvcnkuY3VycmVudFZlcnNpb24oKSxcbiAgICAgIF0sXG4gICAgfSk7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGFwcC5zeW50aCgpO1xuICAgIH0pLnRvVGhyb3dFcnJvcignVGVtcGxhdGUgaGFzIGNoYW5nZWQgZm9yIFByb2R1Y3RTdGFjayBWZXJzaW9uIHYxJyk7XG4gIH0pLFxuXG4gIHRlc3QoJ3Byb2R1Y3QgdGVzdCBmcm9tIHByb2R1Y3Qgc3RhY2sgaGlzdG9yeSB3aGVuIHRlbXBsYXRlIGNoYW5nZXMgYW5kIHVubG9ja2VkJywgKCkgPT4ge1xuICAgIGNvbnN0IHByb2R1Y3RTdGFjayA9IG5ldyBzZXJ2aWNlY2F0YWxvZy5Qcm9kdWN0U3RhY2soc3RhY2ssICdQcm9kdWN0U3RhY2snKTtcblxuICAgIGNvbnN0IHByb2R1Y3RTdGFja0hpc3RvcnkgPSBuZXcgUHJvZHVjdFN0YWNrSGlzdG9yeShzdGFjaywgJ015UHJvZHVjdFN0YWNrSGlzdG9yeScsIHtcbiAgICAgIHByb2R1Y3RTdGFjazogcHJvZHVjdFN0YWNrLFxuICAgICAgY3VycmVudFZlcnNpb25OYW1lOiAndjEnLFxuICAgICAgY3VycmVudFZlcnNpb25Mb2NrZWQ6IGZhbHNlLFxuICAgIH0pO1xuXG4gICAgbmV3IHNucy5Ub3BpYyhwcm9kdWN0U3RhY2ssICdTTlNUb3BpY1Byb2R1Y3RTdGFjazInKTtcblxuICAgIG5ldyBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblByb2R1Y3Qoc3RhY2ssICdNeVByb2R1Y3QnLCB7XG4gICAgICBwcm9kdWN0TmFtZTogJ3Rlc3RQcm9kdWN0JyxcbiAgICAgIG93bmVyOiAndGVzdE93bmVyJyxcbiAgICAgIHByb2R1Y3RWZXJzaW9uczogW1xuICAgICAgICBwcm9kdWN0U3RhY2tIaXN0b3J5LmN1cnJlbnRWZXJzaW9uKCksXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYXNzZW1ibHkgPSBhcHAuc3ludGgoKTtcbiAgICBleHBlY3QoYXNzZW1ibHkuYXJ0aWZhY3RzLmxlbmd0aCkudG9FcXVhbCgyKTtcbiAgICBleHBlY3QoYXNzZW1ibHkuc3RhY2tzWzBdLmFzc2V0cy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgZXhwZWN0KGFzc2VtYmx5LnN0YWNrc1swXS5hc3NldHNbMF0ucGF0aCkudG9FcXVhbCgnU3RhY2tQcm9kdWN0U3RhY2sxOTBCNTZERS5wcm9kdWN0LnRlbXBsYXRlLmpzb24nKTtcblxuICAgIGNvbnN0IGV4cGVjdGVkVGVtcGxhdGVGaWxlS2V5ID0gJ1N0YWNrTXlQcm9kdWN0U3RhY2tIaXN0b3J5OEYwNTM3MUMuU3RhY2tQcm9kdWN0U3RhY2sxOTBCNTZERS52MS5wcm9kdWN0LnRlbXBsYXRlLmpzb24nO1xuICAgIGNvbnN0IHNuYXBzaG90RXhpc3RzID0gZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4oREVGQVVMVF9QUk9EVUNUX1NUQUNLX1NOQVBTSE9UX0RJUkVDVE9SWSwgZXhwZWN0ZWRUZW1wbGF0ZUZpbGVLZXkpKTtcbiAgICBleHBlY3Qoc25hcHNob3RFeGlzdHMpLnRvQmUodHJ1ZSk7XG4gIH0pLFxuXG4gIHRlc3QoJ3Byb2R1Y3QgdGVzdCBmcm9tIHByb2R1Y3Qgc3RhY2sgaGlzdG9yeSBzbmFwc2hvdCcsICgpID0+IHtcbiAgICBjb25zdCBwcm9kdWN0U3RhY2sgPSBuZXcgc2VydmljZWNhdGFsb2cuUHJvZHVjdFN0YWNrKHN0YWNrLCAnUHJvZHVjdFN0YWNrJyk7XG5cbiAgICBjb25zdCBwcm9kdWN0U3RhY2tIaXN0b3J5ID0gbmV3IFByb2R1Y3RTdGFja0hpc3Rvcnkoc3RhY2ssICdNeVByb2R1Y3RTdGFja0hpc3RvcnknLCB7XG4gICAgICBwcm9kdWN0U3RhY2s6IHByb2R1Y3RTdGFjayxcbiAgICAgIGN1cnJlbnRWZXJzaW9uTmFtZTogJ3YyJyxcbiAgICAgIGN1cnJlbnRWZXJzaW9uTG9ja2VkOiBmYWxzZSxcbiAgICB9KTtcblxuICAgIG5ldyBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblByb2R1Y3Qoc3RhY2ssICdNeVByb2R1Y3QnLCB7XG4gICAgICBwcm9kdWN0TmFtZTogJ3Rlc3RQcm9kdWN0JyxcbiAgICAgIG93bmVyOiAndGVzdE93bmVyJyxcbiAgICAgIHByb2R1Y3RWZXJzaW9uczogW1xuICAgICAgICBwcm9kdWN0U3RhY2tIaXN0b3J5LnZlcnNpb25Gcm9tU25hcHNob3QoJ3YxJyksXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYXNzZW1ibHkgPSBhcHAuc3ludGgoKTtcbiAgICBleHBlY3QoYXNzZW1ibHkuYXJ0aWZhY3RzLmxlbmd0aCkudG9FcXVhbCgyKTtcbiAgICBleHBlY3QoYXNzZW1ibHkuc3RhY2tzWzBdLmFzc2V0cy5sZW5ndGgpLnRvQmUoMik7XG4gICAgZXhwZWN0KGFzc2VtYmx5LnN0YWNrc1swXS5hc3NldHNbMF0ucGF0aCkudG9FcXVhbCgnYXNzZXQuNDM0NjI1ZWRjN2UwMTdkOTNmMzg4YjVmMTE2YzJlYmNmMTFhMzg0NTdjZmI4OWE5YjAwZDRlNTUxYzBiZjczMS5qc29uJyk7XG4gIH0pLFxuXG4gIHRlc3QoJ2ZhaWxzIHByb2R1Y3QgZnJvbSBwcm9kdWN0IHN0YWNrIGhpc3Rvcnkgc25hcHNob3Qgbm90IGZvdW5kJywgKCkgPT4ge1xuICAgIGNvbnN0IHByb2R1Y3RTdGFjayA9IG5ldyBzZXJ2aWNlY2F0YWxvZy5Qcm9kdWN0U3RhY2soc3RhY2ssICdQcm9kdWN0U3RhY2snKTtcblxuICAgIGNvbnN0IHByb2R1Y3RTdGFja0hpc3RvcnkgPSBuZXcgUHJvZHVjdFN0YWNrSGlzdG9yeShzdGFjaywgJ015UHJvZHVjdFN0YWNrSGlzdG9yeScsIHtcbiAgICAgIHByb2R1Y3RTdGFjazogcHJvZHVjdFN0YWNrLFxuICAgICAgY3VycmVudFZlcnNpb25OYW1lOiAndjInLFxuICAgICAgY3VycmVudFZlcnNpb25Mb2NrZWQ6IGZhbHNlLFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIG5ldyBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblByb2R1Y3Qoc3RhY2ssICdNeVByb2R1Y3QnLCB7XG4gICAgICAgIHByb2R1Y3ROYW1lOiAndGVzdFByb2R1Y3QnLFxuICAgICAgICBvd25lcjogJ3Rlc3RPd25lcicsXG4gICAgICAgIHByb2R1Y3RWZXJzaW9uczogW1xuICAgICAgICAgIHByb2R1Y3RTdGFja0hpc3RvcnkudmVyc2lvbkZyb21TbmFwc2hvdCgndjMnKSxcbiAgICAgICAgXSxcbiAgICAgIH0pO1xuICAgIH0pLnRvVGhyb3dFcnJvcignVGVtcGxhdGUgU3RhY2tNeVByb2R1Y3RTdGFja0hpc3Rvcnk4RjA1MzcxQy5TdGFja1Byb2R1Y3RTdGFjazE5MEI1NkRFLnYzLnByb2R1Y3QudGVtcGxhdGUuanNvbiBjYW5ub3QgYmUgZm91bmQgaW4gcHJvZHVjdC1zdGFjay1zbmFwc2hvdHMnKTtcbiAgfSksXG5cbiAgdGVzdCgncHJvZHVjdCB0ZXN0IGZyb20gbXVsdGlwbGUgc291cmNlcycsICgpID0+IHtcbiAgICBuZXcgc2VydmljZWNhdGFsb2cuQ2xvdWRGb3JtYXRpb25Qcm9kdWN0KHN0YWNrLCAnTXlQcm9kdWN0Jywge1xuICAgICAgcHJvZHVjdE5hbWU6ICd0ZXN0UHJvZHVjdCcsXG4gICAgICBvd25lcjogJ3Rlc3RPd25lcicsXG4gICAgICBwcm9kdWN0VmVyc2lvbnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHByb2R1Y3RWZXJzaW9uTmFtZTogJ3YxJyxcbiAgICAgICAgICBjbG91ZEZvcm1hdGlvblRlbXBsYXRlOiBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblRlbXBsYXRlLmZyb21VcmwoJ2h0dHBzOi8vYXdzZG9jcy5zMy5hbWF6b25hd3MuY29tL3NlcnZpY2VjYXRhbG9nL2RldmVsb3BtZW50LWVudmlyb25tZW50LnRlbXBsYXRlJyksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm9kdWN0VmVyc2lvbk5hbWU6ICd2MicsXG4gICAgICAgICAgY2xvdWRGb3JtYXRpb25UZW1wbGF0ZTogc2VydmljZWNhdGFsb2cuQ2xvdWRGb3JtYXRpb25UZW1wbGF0ZS5mcm9tVXJsKCdodHRwczovL2F3c2RvY3MuczMuYW1hem9uYXdzLmNvbS9zZXJ2aWNlY2F0YWxvZy9kZXZlbG9wbWVudC1lbnZpcm9ubWVudC12Mi50ZW1wbGF0ZScpLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvZHVjdFZlcnNpb25OYW1lOiAndjMnLFxuICAgICAgICAgIGNsb3VkRm9ybWF0aW9uVGVtcGxhdGU6IHNlcnZpY2VjYXRhbG9nLkNsb3VkRm9ybWF0aW9uVGVtcGxhdGUuZnJvbUFzc2V0KHBhdGguam9pbihfX2Rpcm5hbWUsICdwcm9kdWN0MS50ZW1wbGF0ZS5qc29uJykpLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlNlcnZpY2VDYXRhbG9nOjpDbG91ZEZvcm1hdGlvblByb2R1Y3QnLCB7XG4gICAgICBOYW1lOiAndGVzdFByb2R1Y3QnLFxuICAgICAgT3duZXI6ICd0ZXN0T3duZXInLFxuICAgICAgUHJvdmlzaW9uaW5nQXJ0aWZhY3RQYXJhbWV0ZXJzOiBNYXRjaC5hcnJheVdpdGgoW1xuICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAnSW5mbyc6IHtcbiAgICAgICAgICAgICdMb2FkVGVtcGxhdGVGcm9tVVJMJzogJ2h0dHBzOi8vYXdzZG9jcy5zMy5hbWF6b25hd3MuY29tL3NlcnZpY2VjYXRhbG9nL2RldmVsb3BtZW50LWVudmlyb25tZW50LnRlbXBsYXRlJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgIF0pLFxuICAgIH0pO1xuICB9KSxcblxuICB0ZXN0KCdwcm9kdWN0IGZyb20gYXR0cmlidXRlcycsICgpID0+IHtcbiAgICBjb25zdCBwcm9kdWN0ID0gc2VydmljZWNhdGFsb2cuUHJvZHVjdC5mcm9tUHJvZHVjdEFybihzdGFjaywgJ015UHJvZHVjdCcsICdhcm46YXdzOmNhdGFsb2c6cmVnaW9uOmFjY291bnQtaWQ6cHJvZHVjdC9wcm9kLWRqaDg5MzJ3cicpO1xuXG4gICAgZXhwZWN0KHByb2R1Y3QucHJvZHVjdEFybikudG9FcXVhbCgnYXJuOmF3czpjYXRhbG9nOnJlZ2lvbjphY2NvdW50LWlkOnByb2R1Y3QvcHJvZC1kamg4OTMyd3InKTtcbiAgfSksXG5cbiAgdGVzdCgnZmFpbHMgcHJvZHVjdCBmcm9tIGF0dHJpYnV0ZXMgd2l0aG91dCByZXNvdXJjZSBuYW1lIGluIGFybicsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgc2VydmljZWNhdGFsb2cuUHJvZHVjdC5mcm9tUHJvZHVjdEFybihzdGFjaywgJ015UHJvZHVjdCcsICdhcm46YXdzOmNhdGFsb2c6cmVnaW9uOmFjY291bnQtaWQ6cHJvZHVjdCcpO1xuICAgIH0pLnRvVGhyb3dFcnJvcignTWlzc2luZyByZXF1aXJlZCBQb3J0Zm9saW8gSUQgZnJvbSBQb3J0Zm9saW8gQVJOOiBhcm46YXdzOmNhdGFsb2c6cmVnaW9uOmFjY291bnQtaWQ6cHJvZHVjdCcpO1xuICB9KSxcblxuICB0ZXN0KCdmYWlscyBwcm9kdWN0IGNyZWF0aW9uIHdpdGggaW52YWxpZCBlbWFpbCcsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgbmV3IHNlcnZpY2VjYXRhbG9nLkNsb3VkRm9ybWF0aW9uUHJvZHVjdChzdGFjaywgJ015UHJvZHVjdCcsIHtcbiAgICAgICAgcHJvZHVjdE5hbWU6ICd0ZXN0UHJvZHVjdCcsXG4gICAgICAgIG93bmVyOiAndGVzdE93bmVyJyxcbiAgICAgICAgcHJvZHVjdFZlcnNpb25zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgY2xvdWRGb3JtYXRpb25UZW1wbGF0ZTogc2VydmljZWNhdGFsb2cuQ2xvdWRGb3JtYXRpb25UZW1wbGF0ZS5mcm9tVXJsKCdodHRwczovL2F3c2RvY3MuczMuYW1hem9uYXdzLmNvbS9zZXJ2aWNlY2F0YWxvZy9kZXZlbG9wbWVudC1lbnZpcm9ubWVudC50ZW1wbGF0ZScpLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHN1cHBvcnRFbWFpbDogJ2ludmFsaWQgZW1haWwnLFxuICAgICAgfSk7XG4gICAgfSkudG9UaHJvd0Vycm9yKC9JbnZhbGlkIHN1cHBvcnQgZW1haWwgZm9yIHJlc291cmNlIFN0YWNrXFwvTXlQcm9kdWN0Lyk7XG4gIH0pLFxuXG4gIHRlc3QoJ2ZhaWxzIHByb2R1Y3QgY3JlYXRpb24gd2l0aCBpbnZhbGlkIHVybCcsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgbmV3IHNlcnZpY2VjYXRhbG9nLkNsb3VkRm9ybWF0aW9uUHJvZHVjdChzdGFjaywgJ015UHJvZHVjdCcsIHtcbiAgICAgICAgcHJvZHVjdE5hbWU6ICd0ZXN0UHJvZHVjdCcsXG4gICAgICAgIG93bmVyOiAndGVzdE93bmVyJyxcbiAgICAgICAgcHJvZHVjdFZlcnNpb25zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgY2xvdWRGb3JtYXRpb25UZW1wbGF0ZTogc2VydmljZWNhdGFsb2cuQ2xvdWRGb3JtYXRpb25UZW1wbGF0ZS5mcm9tVXJsKCdpbnZhbGlkIHVybCcpLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9KTtcbiAgICB9KS50b1Rocm93RXJyb3IoL0ludmFsaWQgcHJvdmlzaW9uaW5nIHRlbXBsYXRlIHVybCBmb3IgcmVzb3VyY2UgU3RhY2tcXC9NeVByb2R1Y3QvKTtcbiAgfSksXG5cbiAgdGVzdCgnZmFpbHMgcHJvZHVjdCBjcmVhdGlvbiB3aXRoIGVtcHR5IHByb2R1Y3RWZXJzaW9ucycsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgbmV3IHNlcnZpY2VjYXRhbG9nLkNsb3VkRm9ybWF0aW9uUHJvZHVjdChzdGFjaywgJ015UHJvZHVjdCcsIHtcbiAgICAgICAgcHJvZHVjdE5hbWU6ICd0ZXN0UHJvZHVjdCcsXG4gICAgICAgIG93bmVyOiAndGVzdE93bmVyJyxcbiAgICAgICAgcHJvZHVjdFZlcnNpb25zOiBbXSxcbiAgICAgIH0pO1xuICAgIH0pLnRvVGhyb3dFcnJvcigvSW52YWxpZCBwcm9kdWN0IHZlcnNpb25zIGZvciByZXNvdXJjZSBTdGFja1xcL015UHJvZHVjdC8pO1xuICB9KSxcblxuICBkZXNjcmliZSgnYWRkaW5nIGFuZCBhc3NvY2lhdGluZyBUYWdPcHRpb25zIHRvIGEgcHJvZHVjdCcsICgpID0+IHtcbiAgICBsZXQgcHJvZHVjdDogc2VydmljZWNhdGFsb2cuSVByb2R1Y3Q7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHByb2R1Y3QgPSBuZXcgc2VydmljZWNhdGFsb2cuQ2xvdWRGb3JtYXRpb25Qcm9kdWN0KHN0YWNrLCAnTXlQcm9kdWN0Jywge1xuICAgICAgICBwcm9kdWN0TmFtZTogJ3Rlc3RQcm9kdWN0JyxcbiAgICAgICAgb3duZXI6ICd0ZXN0T3duZXInLFxuICAgICAgICBwcm9kdWN0VmVyc2lvbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBjbG91ZEZvcm1hdGlvblRlbXBsYXRlOiBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblRlbXBsYXRlLmZyb21VcmwoJ2h0dHBzOi8vYXdzZG9jcy5zMy5hbWF6b25hd3MuY29tL3NlcnZpY2VjYXRhbG9nL2RldmVsb3BtZW50LWVudmlyb25tZW50LnRlbXBsYXRlJyksXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnYWRkIHRhZyBvcHRpb25zIHRvIHByb2R1Y3QnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0YWdPcHRpb25zID0gbmV3IHNlcnZpY2VjYXRhbG9nLlRhZ09wdGlvbnMoc3RhY2ssICdUYWdPcHRpb25zJywge1xuICAgICAgICBhbGxvd2VkVmFsdWVzRm9yVGFnczoge1xuICAgICAgICAgIGtleTE6IFsndmFsdWUxJywgJ3ZhbHVlMiddLFxuICAgICAgICAgIGtleTI6IFsndmFsdWUxJ10sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgcHJvZHVjdC5hc3NvY2lhdGVUYWdPcHRpb25zKHRhZ09wdGlvbnMpO1xuXG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLnJlc291cmNlQ291bnRJcygnQVdTOjpTZXJ2aWNlQ2F0YWxvZzo6VGFnT3B0aW9uJywgMyk7IC8vR2VuZXJhdGVzIGEgcmVzb3VyY2UgZm9yIGVhY2ggdW5pcXVlIGtleS12YWx1ZSBwYWlyXG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLnJlc291cmNlQ291bnRJcygnQVdTOjpTZXJ2aWNlQ2F0YWxvZzo6VGFnT3B0aW9uQXNzb2NpYXRpb24nLCAzKTtcbiAgICB9KSxcblxuICAgIHRlc3QoJ2FkZCB0YWcgb3B0aW9ucyBhcyBpbnB1dCB0byBwcm9kdWN0IGluIHByb3BzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGFnT3B0aW9ucyA9IG5ldyBzZXJ2aWNlY2F0YWxvZy5UYWdPcHRpb25zKHN0YWNrLCAnVGFnT3B0aW9ucycsIHtcbiAgICAgICAgYWxsb3dlZFZhbHVlc0ZvclRhZ3M6IHtcbiAgICAgICAgICBrZXkxOiBbJ3ZhbHVlMScsICd2YWx1ZTInXSxcbiAgICAgICAgICBrZXkyOiBbJ3ZhbHVlMSddLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIG5ldyBzZXJ2aWNlY2F0YWxvZy5DbG91ZEZvcm1hdGlvblByb2R1Y3Qoc3RhY2ssICdNeVByb2R1Y3RXaXRoVGFnT3B0aW9ucycsIHtcbiAgICAgICAgcHJvZHVjdE5hbWU6ICd0ZXN0UHJvZHVjdCcsXG4gICAgICAgIG93bmVyOiAndGVzdE93bmVyJyxcbiAgICAgICAgcHJvZHVjdFZlcnNpb25zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgY2xvdWRGb3JtYXRpb25UZW1wbGF0ZTogc2VydmljZWNhdGFsb2cuQ2xvdWRGb3JtYXRpb25UZW1wbGF0ZS5mcm9tVXJsKCdodHRwczovL2F3c2RvY3MuczMuYW1hem9uYXdzLmNvbS9zZXJ2aWNlY2F0YWxvZy9kZXZlbG9wbWVudC1lbnZpcm9ubWVudC50ZW1wbGF0ZScpLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHRhZ09wdGlvbnM6IHRhZ09wdGlvbnMsXG4gICAgICB9KTtcblxuICAgICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5yZXNvdXJjZUNvdW50SXMoJ0FXUzo6U2VydmljZUNhdGFsb2c6OlRhZ09wdGlvbicsIDMpOyAvL0dlbmVyYXRlcyBhIHJlc291cmNlIGZvciBlYWNoIHVuaXF1ZSBrZXktdmFsdWUgcGFpclxuICAgICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5yZXNvdXJjZUNvdW50SXMoJ0FXUzo6U2VydmljZUNhdGFsb2c6OlRhZ09wdGlvbkFzc29jaWF0aW9uJywgMyk7XG4gICAgfSksXG5cbiAgICB0ZXN0KCdhZGRpbmcgdGFnIG9wdGlvbnMgdG8gcHJvZHVjdCBtdWx0aXBsZSB0aW1lcyBpcyBpZGVtcG90ZW50JywgKCkgPT4ge1xuICAgICAgY29uc3QgdGFnT3B0aW9ucyA9IG5ldyBzZXJ2aWNlY2F0YWxvZy5UYWdPcHRpb25zKHN0YWNrLCAnVGFnT3B0aW9ucycsIHtcbiAgICAgICAgYWxsb3dlZFZhbHVlc0ZvclRhZ3M6IHtcbiAgICAgICAgICBrZXkxOiBbJ3ZhbHVlMScsICd2YWx1ZTInXSxcbiAgICAgICAgICBrZXkyOiBbJ3ZhbHVlMSddLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIHByb2R1Y3QuYXNzb2NpYXRlVGFnT3B0aW9ucyh0YWdPcHRpb25zKTtcbiAgICAgIHByb2R1Y3QuYXNzb2NpYXRlVGFnT3B0aW9ucyh0YWdPcHRpb25zKTsgLy8gSWYgbm90IGlkZW1wb3RlbnQgdGhpcyB3b3VsZCBmYWlsXG5cbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykucmVzb3VyY2VDb3VudElzKCdBV1M6OlNlcnZpY2VDYXRhbG9nOjpUYWdPcHRpb24nLCAzKTsgLy9HZW5lcmF0ZXMgYSByZXNvdXJjZSBmb3IgZWFjaCB1bmlxdWUga2V5LXZhbHVlIHBhaXJcbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykucmVzb3VyY2VDb3VudElzKCdBV1M6OlNlcnZpY2VDYXRhbG9nOjpUYWdPcHRpb25Bc3NvY2lhdGlvbicsIDMpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19