"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const route53 = require("../../aws-route53");
const core_1 = require("../../core");
const lib_1 = require("../lib");
let stack;
beforeEach(() => {
    stack = new core_1.Stack();
});
test('default email identity for a domain', () => {
    new lib_1.EmailIdentity(stack, 'Identity', {
        identity: lib_1.Identity.domain('cdk.dev'),
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::SES::EmailIdentity', {
        EmailIdentity: 'cdk.dev',
    });
});
test('email identity from a hosted zone with easy dkim', () => {
    const hostedZone = new route53.PublicHostedZone(stack, 'HostedZone', {
        zoneName: 'cdk.dev',
    });
    new lib_1.EmailIdentity(stack, 'Identity', {
        identity: lib_1.Identity.publicHostedZone(hostedZone),
        configurationSet: new lib_1.ConfigurationSet(stack, 'ConfigurationSet'),
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::SES::EmailIdentity', {
        EmailIdentity: 'cdk.dev',
        ConfigurationSetAttributes: {
            ConfigurationSetName: {
                Ref: 'ConfigurationSet3DD38186',
            },
        },
    });
    assertions_1.Template.fromStack(stack).resourceCountIs('AWS::Route53::RecordSet', 3);
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Name: {
            'Fn::GetAtt': [
                'Identity2D60E2CC',
                'DkimDNSTokenName1',
            ],
        },
        Type: 'CNAME',
        HostedZoneId: {
            Ref: 'HostedZoneDB99F866',
        },
        ResourceRecords: [
            {
                'Fn::GetAtt': [
                    'Identity2D60E2CC',
                    'DkimDNSTokenValue1',
                ],
            },
        ],
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Name: {
            'Fn::GetAtt': [
                'Identity2D60E2CC',
                'DkimDNSTokenName2',
            ],
        },
        Type: 'CNAME',
        HostedZoneId: {
            Ref: 'HostedZoneDB99F866',
        },
        ResourceRecords: [
            {
                'Fn::GetAtt': [
                    'Identity2D60E2CC',
                    'DkimDNSTokenValue2',
                ],
            },
        ],
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Name: {
            'Fn::GetAtt': [
                'Identity2D60E2CC',
                'DkimDNSTokenName3',
            ],
        },
        Type: 'CNAME',
        HostedZoneId: {
            Ref: 'HostedZoneDB99F866',
        },
        ResourceRecords: [
            {
                'Fn::GetAtt': [
                    'Identity2D60E2CC',
                    'DkimDNSTokenValue3',
                ],
            },
        ],
    });
});
test('email identity from a hosted zone with BYO dkim', () => {
    const hostedZone = new route53.PublicHostedZone(stack, 'HostedZone', {
        zoneName: 'cdk.dev',
    });
    new lib_1.EmailIdentity(stack, 'Identity', {
        identity: lib_1.Identity.publicHostedZone(hostedZone),
        dkimIdentity: lib_1.DkimIdentity.byoDkim({
            privateKey: core_1.SecretValue.secretsManager('my-secret'),
            selector: 'selector',
            publicKey: 'public-key',
        }),
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::SES::EmailIdentity', {
        EmailIdentity: 'cdk.dev',
        DkimSigningAttributes: {
            DomainSigningPrivateKey: '{{resolve:secretsmanager:my-secret:SecretString:::}}',
            DomainSigningSelector: 'selector',
        },
    });
    assertions_1.Template.fromStack(stack).resourceCountIs('AWS::Route53::RecordSet', 1);
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Name: 'selector._domainkey.cdk.dev.',
        Type: 'TXT',
        HostedZoneId: {
            Ref: 'HostedZoneDB99F866',
        },
        ResourceRecords: [
            '"p=public-key"',
        ],
    });
});
test('with mail from and hosted zone', () => {
    const hostedZone = new route53.PublicHostedZone(stack, 'HostedZone', {
        zoneName: 'cdk.dev',
    });
    new lib_1.EmailIdentity(stack, 'Identity', {
        identity: lib_1.Identity.publicHostedZone(hostedZone),
        mailFromDomain: 'mail.cdk.dev',
        mailFromBehaviorOnMxFailure: lib_1.MailFromBehaviorOnMxFailure.REJECT_MESSAGE,
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::SES::EmailIdentity', {
        MailFromAttributes: {
            BehaviorOnMxFailure: 'REJECT_MESSAGE',
            MailFromDomain: 'mail.cdk.dev',
        },
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Name: 'mail.cdk.dev.',
        Type: 'MX',
        HostedZoneId: {
            Ref: 'HostedZoneDB99F866',
        },
        ResourceRecords: [
            {
                'Fn::Join': [
                    '',
                    [
                        '10 feedback-smtp.',
                        {
                            Ref: 'AWS::Region',
                        },
                        '.amazonses.com',
                    ],
                ],
            },
        ],
    });
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Name: 'mail.cdk.dev.',
        Type: 'TXT',
        HostedZoneId: {
            Ref: 'HostedZoneDB99F866',
        },
        ResourceRecords: [
            '"v=spf1 include:amazonses.com ~all"',
        ],
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1haWwtaWRlbnRpdHkudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImVtYWlsLWlkZW50aXR5LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBNEM7QUFDNUMsNkNBQTZDO0FBQzdDLHFDQUFnRDtBQUNoRCxnQ0FBOEc7QUFFOUcsSUFBSSxLQUFZLENBQUM7QUFDakIsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLEtBQUssR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO0FBQ3RCLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRTtJQUMvQyxJQUFJLG1CQUFhLENBQUMsS0FBSyxFQUFFLFVBQVUsRUFBRTtRQUNuQyxRQUFRLEVBQUUsY0FBUSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7S0FDckMsQ0FBQyxDQUFDO0lBRUgscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMseUJBQXlCLEVBQUU7UUFDekUsYUFBYSxFQUFFLFNBQVM7S0FDekIsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsa0RBQWtELEVBQUUsR0FBRyxFQUFFO0lBQzVELE1BQU0sVUFBVSxHQUFHLElBQUksT0FBTyxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxZQUFZLEVBQUU7UUFDbkUsUUFBUSxFQUFFLFNBQVM7S0FDcEIsQ0FBQyxDQUFDO0lBRUgsSUFBSSxtQkFBYSxDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUU7UUFDbkMsUUFBUSxFQUFFLGNBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUM7UUFDL0MsZ0JBQWdCLEVBQUUsSUFBSSxzQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsa0JBQWtCLENBQUM7S0FDbEUsQ0FBQyxDQUFDO0lBRUgscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMseUJB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O0lBRUgscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMseUJBQXlCLEVBQUU7UUFDekUsSUFBSSxFQUFFLGVBQWU7UUFDckIsSUFBSSxFQUFFLEtBQUs7UUFDWCxZQUFZLEVBQUU7WUFDWixHQUFHLEVBQUUsb0JBQW9CO1NBQzFCO1FBQ0QsZUFBZSxFQUFFO1lBQ2YscUNBQXFDO1NBQ3RDO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gJy4uLy4uL2Fzc2VydGlvbnMnO1xuaW1wb3J0ICogYXMgcm91dGU1MyBmcm9tICcuLi8uLi9hd3Mtcm91dGU1Myc7XG5pbXBvcnQgeyBTZWNyZXRWYWx1ZSwgU3RhY2sgfSBmcm9tICcuLi8uLi9jb3JlJztcbmltcG9ydCB7IENvbmZpZ3VyYXRpb25TZXQsIERraW1JZGVudGl0eSwgRW1haWxJZGVudGl0eSwgSWRlbnRpdHksIE1haWxGcm9tQmVoYXZpb3JPbk14RmFpbHVyZSB9IGZyb20gJy4uL2xpYic7XG5cbmxldCBzdGFjazogU3RhY2s7XG5iZWZvcmVFYWNoKCgpID0+IHtcbiAgc3RhY2sgPSBuZXcgU3RhY2soKTtcbn0pO1xuXG50ZXN0KCdkZWZhdWx0IGVtYWlsIGlkZW50aXR5IGZvciBhIGRvbWFpbicsICgpID0+IHtcbiAgbmV3IEVtYWlsSWRlbnRpdHkoc3RhY2ssICdJZGVudGl0eScsIHtcbiAgICBpZGVudGl0eTogSWRlbnRpdHkuZG9tYWluKCdjZGsuZGV2JyksXG4gIH0pO1xuXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlNFUzo6RW1haWxJZGVudGl0eScsIHtcbiAgICBFbWFpbElkZW50aXR5OiAnY2RrLmRldicsXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2VtYWlsIGlkZW50aXR5IGZyb20gYSBob3N0ZWQgem9uZSB3aXRoIGVhc3kgZGtpbScsICgpID0+IHtcbiAgY29uc3QgaG9zdGVkWm9uZSA9IG5ldyByb3V0ZTUzLlB1YmxpY0hvc3RlZFpvbmUoc3RhY2ssICdIb3N0ZWRab25lJywge1xuICAgIHpvbmVOYW1lOiAnY2RrLmRldicsXG4gIH0pO1xuXG4gIG5ldyBFbWFpbElkZW50aXR5KHN0YWNrLCAnSWRlbnRpdHknLCB7XG4gICAgaWRlbnRpdHk6IElkZW50aXR5LnB1YmxpY0hvc3RlZFpvbmUoaG9zdGVkWm9uZSksXG4gICAgY29uZmlndXJhdGlvblNldDogbmV3IENvbmZpZ3VyYXRpb25TZXQoc3RhY2ssICdDb25maWd1cmF0aW9uU2V0JyksXG4gIH0pO1xuXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlNFUzo6RW1haWxJZGVudGl0eScsIHtcbiAgICBFbWFpbElkZW50aXR5OiAnY2RrLmRldicsXG4gICAgQ29uZmlndXJhdGlvblNldEF0dHJpYnV0ZXM6IHtcbiAgICAgIENvbmZpZ3VyYXRpb25TZXROYW1lOiB7XG4gICAgICAgIFJlZjogJ0NvbmZpZ3VyYXRpb25TZXQzREQzODE4NicsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykucmVzb3VyY2VDb3VudElzKCdBV1M6OlJvdXRlNTM6OlJlY29yZFNldCcsIDMpO1xuXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJvdXRlNTM6OlJlY29yZFNldCcsIHtcbiAgICBOYW1lOiB7XG4gICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgJ0lkZW50aXR5MkQ2MEUyQ0MnLFxuICAgICAgICAnRGtpbUROU1Rva2VuTmFtZTEnLFxuICAgICAgXSxcbiAgICB9LFxuICAgIFR5cGU6ICdDTkFNRScsXG4gICAgSG9zdGVkWm9uZUlkOiB7XG4gICAgICBSZWY6ICdIb3N0ZWRab25lREI5OUY4NjYnLFxuICAgIH0sXG4gICAgUmVzb3VyY2VSZWNvcmRzOiBbXG4gICAgICB7XG4gICAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAgICdJZGVudGl0eTJENjBFMkNDJyxcbiAgICAgICAgICAnRGtpbUROU1Rva2VuVmFsdWUxJyxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgXSxcbiAgfSk7XG5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Um91dGU1Mzo6UmVjb3JkU2V0Jywge1xuICAgIE5hbWU6IHtcbiAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAnSWRlbnRpdHkyRDYwRTJDQycsXG4gICAgICAgICdEa2ltRE5TVG9rZW5OYW1lMicsXG4gICAgICBdLFxuICAgIH0sXG4gICAgVHlwZTogJ0NOQU1FJyxcbiAgICBIb3N0ZWRab25lSWQ6IHtcbiAgICAgIFJlZjogJ0hvc3RlZFpvbmVEQjk5Rjg2NicsXG4gICAgfSxcbiAgICBSZXNvdXJjZVJlY29yZHM6IFtcbiAgICAgIHtcbiAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgJ0lkZW50aXR5MkQ2MEUyQ0MnLFxuICAgICAgICAgICdEa2ltRE5TVG9rZW5WYWx1ZTInLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICBdLFxuICB9KTtcblxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSb3V0ZTUzOjpSZWNvcmRTZXQnLCB7XG4gICAgTmFtZToge1xuICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICdJZGVudGl0eTJENjBFMkNDJyxcbiAgICAgICAgJ0RraW1ETlNUb2tlbk5hbWUzJyxcbiAgICAgIF0sXG4gICAgfSxcbiAgICBUeXBlOiAnQ05BTUUnLFxuICAgIEhvc3RlZFpvbmVJZDoge1xuICAgICAgUmVmOiAnSG9zdGVkWm9uZURCOTlGODY2JyxcbiAgICB9LFxuICAgIFJlc291cmNlUmVjb3JkczogW1xuICAgICAge1xuICAgICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgICAnSWRlbnRpdHkyRDYwRTJDQycsXG4gICAgICAgICAgJ0RraW1ETlNUb2tlblZhbHVlMycsXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2VtYWlsIGlkZW50aXR5IGZyb20gYSBob3N0ZWQgem9uZSB3aXRoIEJZTyBka2ltJywgKCkgPT4ge1xuICBjb25zdCBob3N0ZWRab25lID0gbmV3IHJvdXRlNTMuUHVibGljSG9zdGVkWm9uZShzdGFjaywgJ0hvc3RlZFpvbmUnLCB7XG4gICAgem9uZU5hbWU6ICdjZGsuZGV2JyxcbiAgfSk7XG5cbiAgbmV3IEVtYWlsSWRlbnRpdHkoc3RhY2ssICdJZGVudGl0eScsIHtcbiAgICBpZGVudGl0eTogSWRlbnRpdHkucHVibGljSG9zdGVkWm9uZShob3N0ZWRab25lKSxcbiAgICBka2ltSWRlbnRpdHk6IERraW1JZGVudGl0eS5ieW9Ea2ltKHtcbiAgICAgIHByaXZhdGVLZXk6IFNlY3JldFZhbHVlLnNlY3JldHNNYW5hZ2VyKCdteS1zZWNyZXQnKSxcbiAgICAgIHNlbGVjdG9yOiAnc2VsZWN0b3InLFxuICAgICAgcHVibGljS2V5OiAncHVibGljLWtleScsXG4gICAgfSksXG4gIH0pO1xuXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlNFUzo6RW1haWxJZGVudGl0eScsIHtcbiAgICBFbWFpbElkZW50aXR5OiAnY2RrLmRldicsXG4gICAgRGtpbVNpZ25pbmdBdHRyaWJ1dGVzOiB7XG4gICAgICBEb21haW5TaWduaW5nUHJpdmF0ZUtleTogJ3t7cmVzb2x2ZTpzZWNyZXRzbWFuYWdlcjpteS1zZWNyZXQ6U2VjcmV0U3RyaW5nOjo6fX0nLFxuICAgICAgRG9tYWluU2lnbmluZ1NlbGVjdG9yOiAnc2VsZWN0b3InLFxuICAgIH0sXG4gIH0pO1xuXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykucmVzb3VyY2VDb3VudElzKCdBV1M6OlJvdXRlNTM6OlJlY29yZFNldCcsIDEpO1xuXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJvdXRlNTM6OlJlY29yZFNldCcsIHtcbiAgICBOYW1lOiAnc2VsZWN0b3IuX2RvbWFpbmtleS5jZGsuZGV2LicsXG4gICAgVHlwZTogJ1RYVCcsXG4gICAgSG9zdGVkWm9uZUlkOiB7XG4gICAgICBSZWY6ICdIb3N0ZWRab25lREI5OUY4NjYnLFxuICAgIH0sXG4gICAgUmVzb3VyY2VSZWNvcmRzOiBbXG4gICAgICAnXCJwPXB1YmxpYy1rZXlcIicsXG4gICAgXSxcbiAgfSk7XG59KTtcblxudGVzdCgnd2l0aCBtYWlsIGZyb20gYW5kIGhvc3RlZCB6b25lJywgKCkgPT4ge1xuICBjb25zdCBob3N0ZWRab25lID0gbmV3IHJvdXRlNTMuUHVibGljSG9zdGVkWm9uZShzdGFjaywgJ0hvc3RlZFpvbmUnLCB7XG4gICAgem9uZU5hbWU6ICdjZGsuZGV2JyxcbiAgfSk7XG5cbiAgbmV3IEVtYWlsSWRlbnRpdHkoc3RhY2ssICdJZGVudGl0eScsIHtcbiAgICBpZGVudGl0eTogSWRlbnRpdHkucHVibGljSG9zdGVkWm9uZShob3N0ZWRab25lKSxcbiAgICBtYWlsRnJvbURvbWFpbjogJ21haWwuY2RrLmRldicsXG4gICAgbWFpbEZyb21CZWhhdmlvck9uTXhGYWlsdXJlOiBNYWlsRnJvbUJlaGF2aW9yT25NeEZhaWx1cmUuUkVKRUNUX01FU1NBR0UsXG4gIH0pO1xuXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlNFUzo6RW1haWxJZGVudGl0eScsIHtcbiAgICBNYWlsRnJvbUF0dHJpYnV0ZXM6IHtcbiAgICAgIEJlaGF2aW9yT25NeEZhaWx1cmU6ICdSRUpFQ1RfTUVTU0FHRScsXG4gICAgICBNYWlsRnJvbURvbWFpbjogJ21haWwuY2RrLmRldicsXG4gICAgfSxcbiAgfSk7XG5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Um91dGU1Mzo6UmVjb3JkU2V0Jywge1xuICAgIE5hbWU6ICdtYWlsLmNkay5kZXYuJyxcbiAgICBUeXBlOiAnTVgnLFxuICAgIEhvc3RlZFpvbmVJZDoge1xuICAgICAgUmVmOiAnSG9zdGVkWm9uZURCOTlGODY2JyxcbiAgICB9LFxuICAgIFJlc291cmNlUmVjb3JkczogW1xuICAgICAge1xuICAgICAgICAnRm46OkpvaW4nOiBbXG4gICAgICAgICAgJycsXG4gICAgICAgICAgW1xuICAgICAgICAgICAgJzEwIGZlZWRiYWNrLXNtdHAuJyxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgUmVmOiAnQVdTOjpSZWdpb24nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICcuYW1hem9uc2VzLmNvbScsXG4gICAgICAgICAgXSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgXSxcbiAgfSk7XG5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Um91dGU1Mzo6UmVjb3JkU2V0Jywge1xuICAgIE5hbWU6ICdtYWlsLmNkay5kZXYuJyxcbiAgICBUeXBlOiAnVFhUJyxcbiAgICBIb3N0ZWRab25lSWQ6IHtcbiAgICAgIFJlZjogJ0hvc3RlZFpvbmVEQjk5Rjg2NicsXG4gICAgfSxcbiAgICBSZXNvdXJjZVJlY29yZHM6IFtcbiAgICAgICdcInY9c3BmMSBpbmNsdWRlOmFtYXpvbnNlcy5jb20gfmFsbFwiJyxcbiAgICBdLFxuICB9KTtcbn0pO1xuXG4iXX0=