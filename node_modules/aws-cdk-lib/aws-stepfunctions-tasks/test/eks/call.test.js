"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const eks = require("../../../aws-eks");
const sfn = require("../../../aws-stepfunctions");
const core_1 = require("../../../core");
const call_1 = require("../../lib/eks/call");
let stack;
let cluster;
beforeEach(() => {
    //GIVEN
    stack = new core_1.Stack();
    cluster = new eks.Cluster(stack, 'Cluster', {
        version: eks.KubernetesVersion.V1_21,
        clusterName: 'eksCluster',
    });
});
test('Call an EKS endpoint', () => {
    // WHEN
    const task = new call_1.EksCall(stack, 'Call', {
        cluster: cluster,
        httpMethod: call_1.HttpMethods.GET,
        httpPath: 'path',
        requestBody: sfn.TaskInput.fromObject({
            Body: 'requestBody',
        }),
    });
    // THEN
    expect(stack.resolve(task.toStateJson())).toEqual({
        Type: 'Task',
        Resource: {
            'Fn::Join': [
                '',
                [
                    'arn:',
                    {
                        Ref: 'AWS::Partition',
                    },
                    ':states:::eks:call',
                ],
            ],
        },
        End: true,
        Parameters: {
            ClusterName: {
                Ref: 'Cluster9EE0221C',
            },
            CertificateAuthority: {
                'Fn::GetAtt': [
                    'Cluster9EE0221C',
                    'CertificateAuthorityData',
                ],
            },
            Endpoint: {
                'Fn::GetAtt': [
                    'Cluster9EE0221C',
                    'Endpoint',
                ],
            },
            Method: 'GET',
            Path: 'path',
            RequestBody: {
                Body: 'requestBody',
            },
        },
    });
});
test('Call an EKS endpoint with requestBody as a string', () => {
    // WHEN
    const task = new call_1.EksCall(stack, 'Call', {
        cluster: cluster,
        httpMethod: call_1.HttpMethods.GET,
        httpPath: 'path',
        requestBody: sfn.TaskInput.fromText('requestBody'),
    });
    // THEN
    expect(stack.resolve(task.toStateJson())).toEqual({
        Type: 'Task',
        Resource: {
            'Fn::Join': [
                '',
                [
                    'arn:',
                    {
                        Ref: 'AWS::Partition',
                    },
                    ':states:::eks:call',
                ],
            ],
        },
        End: true,
        Parameters: {
            ClusterName: {
                Ref: 'Cluster9EE0221C',
            },
            CertificateAuthority: {
                'Fn::GetAtt': [
                    'Cluster9EE0221C',
                    'CertificateAuthorityData',
                ],
            },
            Endpoint: {
                'Fn::GetAtt': [
                    'Cluster9EE0221C',
                    'Endpoint',
                ],
            },
            Method: 'GET',
            Path: 'path',
            RequestBody: 'requestBody',
        },
    });
});
test('Call an EKS endpoint with requestBody supply through path', () => {
    // WHEN
    const task = new call_1.EksCall(stack, 'Call', {
        cluster: cluster,
        httpMethod: call_1.HttpMethods.GET,
        httpPath: 'path',
        requestBody: sfn.TaskInput.fromJsonPathAt('$.Request.Body'),
    });
    // THEN
    expect(stack.resolve(task.toStateJson())).toEqual({
        Type: 'Task',
        Resource: {
            'Fn::Join': [
                '',
                [
                    'arn:',
                    {
                        Ref: 'AWS::Partition',
                    },
                    ':states:::eks:call',
                ],
            ],
        },
        End: true,
        Parameters: {
            'ClusterName': {
                Ref: 'Cluster9EE0221C',
            },
            'CertificateAuthority': {
                'Fn::GetAtt': [
                    'Cluster9EE0221C',
                    'CertificateAuthorityData',
                ],
            },
            'Endpoint': {
                'Fn::GetAtt': [
                    'Cluster9EE0221C',
                    'Endpoint',
                ],
            },
            'Method': 'GET',
            'Path': 'path',
            'RequestBody.$': '$.Request.Body',
        },
    });
});
test('Task throws if RUN_JOB is supplied as service integration pattern', () => {
    expect(() => {
        new call_1.EksCall(stack, 'Call', {
            cluster: cluster,
            httpMethod: call_1.HttpMethods.GET,
            httpPath: 'path',
            requestBody: sfn.TaskInput.fromObject({
                RequestBody: 'requestBody',
            }),
            integrationPattern: sfn.IntegrationPattern.RUN_JOB,
        });
    }).toThrow(/Unsupported service integration pattern. Supported Patterns: REQUEST_RESPONSE. Received: RUN_JOB/);
});
test('Task throws if WAIT_FOR_TASK_TOKEN is supplied as service integration pattern', () => {
    expect(() => {
        new call_1.EksCall(stack, 'Call', {
            cluster: cluster,
            httpMethod: call_1.HttpMethods.GET,
            httpPath: 'path',
            requestBody: sfn.TaskInput.fromObject({
                RequestBody: 'requestBody',
            }),
            integrationPattern: sfn.IntegrationPattern.WAIT_FOR_TASK_TOKEN,
        });
    }).toThrow(/Unsupported service integration pattern. Supported Patterns: REQUEST_RESPONSE. Received: WAIT_FOR_TASK_TOKEN/);
});
test('Task throws if cluster supplied does not have clusterEndpoint configured', () => {
    const importedCluster = eks.Cluster.fromClusterAttributes(stack, 'InvalidCluster', {
        clusterName: 'importedCluster',
        clusterCertificateAuthorityData: 'clusterCertificateAuthorityData',
    });
    expect(() => {
        new call_1.EksCall(stack, 'Call', {
            cluster: importedCluster,
            httpMethod: call_1.HttpMethods.GET,
            httpPath: 'path',
            requestBody: sfn.TaskInput.fromObject({
                RequestBody: 'requestBody',
            }),
        });
    }).toThrow(/The "clusterEndpoint" property must be specified when using an imported Cluster./);
});
test('Task throws if cluster supplied does not have clusterCertificateAuthorityData configured', () => {
    const importedCluster = eks.Cluster.fromClusterAttributes(stack, 'InvalidCluster', {
        clusterName: 'importedCluster',
        clusterEndpoint: 'clusterEndpoint',
    });
    expect(() => {
        new call_1.EksCall(stack, 'Call', {
            cluster: importedCluster,
            httpMethod: call_1.HttpMethods.GET,
            httpPath: 'path',
            requestBody: sfn.TaskInput.fromObject({
                RequestBody: 'requestBody',
            }),
        });
    }).toThrow(/The "clusterCertificateAuthorityData" property must be specified when using an imported Cluster./);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsbC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2FsbC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsd0NBQXdDO0FBQ3hDLGtEQUFrRDtBQUNsRCx3Q0FBc0M7QUFDdEMsNkNBQTBEO0FBRTFELElBQUksS0FBWSxDQUFDO0FBQ2pCLElBQUksT0FBb0IsQ0FBQztBQUV6QixVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2QsT0FBTztJQUNQLEtBQUssR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO0lBQ3BCLE9BQU8sR0FBRyxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRTtRQUMxQyxPQUFPLEVBQUUsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEtBQUs7UUFDcEMsV0FBVyxFQUFFLFlBQVk7S0FDMUIsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO0lBQ2hDLE9BQU87SUFDUCxNQUFNLElBQUksR0FBRyxJQUFJLGNBQU8sQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFO1FBQ3RDLE9BQU8sRUFBRSxPQUFPO1FBQ2hCLFVBQVUsRUFBRSxrQkFBVyxDQUFDLEdBQUc7UUFDM0IsUUFBUSxFQUFFLE1BQU07UUFDaEIsV0FBVyxFQUFFLEdBQUcsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDO1lBQ3BDLElBQUksRUFBRSxhQUFhO1NBQ3BCLENBQUM7S0FDSCxDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7UUFDaEQsSUFBSSxFQUFFLE1BQU07UUFDWixRQUFRLEVBQUU7WUFDUixVQUFVLEVBQUU7Z0JBQ1YsRUFBRTtnQkFDRjtvQkFDRSxNQUFNO29CQUNOO3dCQUNFLEdBQUcsRUFBRSxnQkFBZ0I7cUJB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V0FBVyxFQUFFLGFBQWE7YUFDM0IsQ0FBQztTQUNILENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDUixrR0FBa0csQ0FDbkcsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZWtzIGZyb20gJy4uLy4uLy4uL2F3cy1la3MnO1xuaW1wb3J0ICogYXMgc2ZuIGZyb20gJy4uLy4uLy4uL2F3cy1zdGVwZnVuY3Rpb25zJztcbmltcG9ydCB7IFN0YWNrIH0gZnJvbSAnLi4vLi4vLi4vY29yZSc7XG5pbXBvcnQgeyBFa3NDYWxsLCBIdHRwTWV0aG9kcyB9IGZyb20gJy4uLy4uL2xpYi9la3MvY2FsbCc7XG5cbmxldCBzdGFjazogU3RhY2s7XG5sZXQgY2x1c3RlcjogZWtzLkNsdXN0ZXI7XG5cbmJlZm9yZUVhY2goKCkgPT4ge1xuICAvL0dJVkVOXG4gIHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gIGNsdXN0ZXIgPSBuZXcgZWtzLkNsdXN0ZXIoc3RhY2ssICdDbHVzdGVyJywge1xuICAgIHZlcnNpb246IGVrcy5LdWJlcm5ldGVzVmVyc2lvbi5WMV8yMSxcbiAgICBjbHVzdGVyTmFtZTogJ2Vrc0NsdXN0ZXInLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdDYWxsIGFuIEVLUyBlbmRwb2ludCcsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCB0YXNrID0gbmV3IEVrc0NhbGwoc3RhY2ssICdDYWxsJywge1xuICAgIGNsdXN0ZXI6IGNsdXN0ZXIsXG4gICAgaHR0cE1ldGhvZDogSHR0cE1ldGhvZHMuR0VULFxuICAgIGh0dHBQYXRoOiAncGF0aCcsXG4gICAgcmVxdWVzdEJvZHk6IHNmbi5UYXNrSW5wdXQuZnJvbU9iamVjdCh7XG4gICAgICBCb2R5OiAncmVxdWVzdEJvZHknLFxuICAgIH0pLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChzdGFjay5yZXNvbHZlKHRhc2sudG9TdGF0ZUpzb24oKSkpLnRvRXF1YWwoe1xuICAgIFR5cGU6ICdUYXNrJyxcbiAgICBSZXNvdXJjZToge1xuICAgICAgJ0ZuOjpKb2luJzogW1xuICAgICAgICAnJyxcbiAgICAgICAgW1xuICAgICAgICAgICdhcm46JyxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBSZWY6ICdBV1M6OlBhcnRpdGlvbicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICAnOnN0YXRlczo6OmVrczpjYWxsJyxcbiAgICAgICAgXSxcbiAgICAgIF0sXG4gICAgfSxcbiAgICBFbmQ6IHRydWUsXG4gICAgUGFyYW1ldGVyczoge1xuICAgICAgQ2x1c3Rlck5hbWU6IHtcbiAgICAgICAgUmVmOiAnQ2x1c3RlcjlFRTAyMjFDJyxcbiAgICAgIH0sXG4gICAgICBDZXJ0aWZpY2F0ZUF1dGhvcml0eToge1xuICAgICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgICAnQ2x1c3RlcjlFRTAyMjFDJyxcbiAgICAgICAgICAnQ2VydGlmaWNhdGVBdXRob3JpdHlEYXRhJyxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgICBFbmRwb2ludDoge1xuICAgICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgICAnQ2x1c3RlcjlFRTAyMjFDJyxcbiAgICAgICAgICAnRW5kcG9pbnQnLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICAgIE1ldGhvZDogJ0dFVCcsXG4gICAgICBQYXRoOiAncGF0aCcsXG4gICAgICBSZXF1ZXN0Qm9keToge1xuICAgICAgICBCb2R5OiAncmVxdWVzdEJvZHknLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCdDYWxsIGFuIEVLUyBlbmRwb2ludCB3aXRoIHJlcXVlc3RCb2R5IGFzIGEgc3RyaW5nJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IHRhc2sgPSBuZXcgRWtzQ2FsbChzdGFjaywgJ0NhbGwnLCB7XG4gICAgY2x1c3RlcjogY2x1c3RlcixcbiAgICBodHRwTWV0aG9kOiBIdHRwTWV0aG9kcy5HRVQsXG4gICAgaHR0cFBhdGg6ICdwYXRoJyxcbiAgICByZXF1ZXN0Qm9keTogc2ZuLlRhc2tJbnB1dC5mcm9tVGV4dCgncmVxdWVzdEJvZHknKSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3Qoc3RhY2sucmVzb2x2ZSh0YXNrLnRvU3RhdGVKc29uKCkpKS50b0VxdWFsKHtcbiAgICBUeXBlOiAnVGFzaycsXG4gICAgUmVzb3VyY2U6IHtcbiAgICAgICdGbjo6Sm9pbic6IFtcbiAgICAgICAgJycsXG4gICAgICAgIFtcbiAgICAgICAgICAnYXJuOicsXG4gICAgICAgICAge1xuICAgICAgICAgICAgUmVmOiAnQVdTOjpQYXJ0aXRpb24nLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgJzpzdGF0ZXM6Ojpla3M6Y2FsbCcsXG4gICAgICAgIF0sXG4gICAgICBdLFxuICAgIH0sXG4gICAgRW5kOiB0cnVlLFxuICAgIFBhcmFtZXRlcnM6IHtcbiAgICAgIENsdXN0ZXJOYW1lOiB7XG4gICAgICAgIFJlZjogJ0NsdXN0ZXI5RUUwMjIxQycsXG4gICAgICB9LFxuICAgICAgQ2VydGlmaWNhdGVBdXRob3JpdHk6IHtcbiAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgJ0NsdXN0ZXI5RUUwMjIxQycsXG4gICAgICAgICAgJ0NlcnRpZmljYXRlQXV0aG9yaXR5RGF0YScsXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgICAgRW5kcG9pbnQ6IHtcbiAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgJ0NsdXN0ZXI5RUUwMjIxQycsXG4gICAgICAgICAgJ0VuZHBvaW50JyxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgICBNZXRob2Q6ICdHRVQnLFxuICAgICAgUGF0aDogJ3BhdGgnLFxuICAgICAgUmVxdWVzdEJvZHk6ICdyZXF1ZXN0Qm9keScsXG4gICAgfSxcbiAgfSk7XG59KTtcblxudGVzdCgnQ2FsbCBhbiBFS1MgZW5kcG9pbnQgd2l0aCByZXF1ZXN0Qm9keSBzdXBwbHkgdGhyb3VnaCBwYXRoJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IHRhc2sgPSBuZXcgRWtzQ2FsbChzdGFjaywgJ0NhbGwnLCB7XG4gICAgY2x1c3RlcjogY2x1c3RlcixcbiAgICBodHRwTWV0aG9kOiBIdHRwTWV0aG9kcy5HRVQsXG4gICAgaHR0cFBhdGg6ICdwYXRoJyxcbiAgICByZXF1ZXN0Qm9keTogc2ZuLlRhc2tJbnB1dC5mcm9tSnNvblBhdGhBdCgnJC5SZXF1ZXN0LkJvZHknKSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3Qoc3RhY2sucmVzb2x2ZSh0YXNrLnRvU3RhdGVKc29uKCkpKS50b0VxdWFsKHtcbiAgICBUeXBlOiAnVGFzaycsXG4gICAgUmVzb3VyY2U6IHtcbiAgICAgICdGbjo6Sm9pbic6IFtcbiAgICAgICAgJycsXG4gICAgICAgIFtcbiAgICAgICAgICAnYXJuOicsXG4gICAgICAgICAge1xuICAgICAgICAgICAgUmVmOiAnQVdTOjpQYXJ0aXRpb24nLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgJzpzdGF0ZXM6Ojpla3M6Y2FsbCcsXG4gICAgICAgIF0sXG4gICAgICBdLFxuICAgIH0sXG4gICAgRW5kOiB0cnVlLFxuICAgIFBhcmFtZXRlcnM6IHtcbiAgICAgICdDbHVzdGVyTmFtZSc6IHtcbiAgICAgICAgUmVmOiAnQ2x1c3RlcjlFRTAyMjFDJyxcbiAgICAgIH0sXG4gICAgICAnQ2VydGlmaWNhdGVBdXRob3JpdHknOiB7XG4gICAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAgICdDbHVzdGVyOUVFMDIyMUMnLFxuICAgICAgICAgICdDZXJ0aWZpY2F0ZUF1dGhvcml0eURhdGEnLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICAgICdFbmRwb2ludCc6IHtcbiAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgJ0NsdXN0ZXI5RUUwMjIxQycsXG4gICAgICAgICAgJ0VuZHBvaW50JyxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgICAnTWV0aG9kJzogJ0dFVCcsXG4gICAgICAnUGF0aCc6ICdwYXRoJyxcbiAgICAgICdSZXF1ZXN0Qm9keS4kJzogJyQuUmVxdWVzdC5Cb2R5JyxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCdUYXNrIHRocm93cyBpZiBSVU5fSk9CIGlzIHN1cHBsaWVkIGFzIHNlcnZpY2UgaW50ZWdyYXRpb24gcGF0dGVybicsICgpID0+IHtcbiAgZXhwZWN0KCgpID0+IHtcbiAgICBuZXcgRWtzQ2FsbChzdGFjaywgJ0NhbGwnLCB7XG4gICAgICBjbHVzdGVyOiBjbHVzdGVyLFxuICAgICAgaHR0cE1ldGhvZDogSHR0cE1ldGhvZHMuR0VULFxuICAgICAgaHR0cFBhdGg6ICdwYXRoJyxcbiAgICAgIHJlcXVlc3RCb2R5OiBzZm4uVGFza0lucHV0LmZyb21PYmplY3Qoe1xuICAgICAgICBSZXF1ZXN0Qm9keTogJ3JlcXVlc3RCb2R5JyxcbiAgICAgIH0pLFxuICAgICAgaW50ZWdyYXRpb25QYXR0ZXJuOiBzZm4uSW50ZWdyYXRpb25QYXR0ZXJuLlJVTl9KT0IsXG4gICAgfSk7XG4gIH0pLnRvVGhyb3coXG4gICAgL1Vuc3VwcG9ydGVkIHNlcnZpY2UgaW50ZWdyYXRpb24gcGF0dGVybi4gU3VwcG9ydGVkIFBhdHRlcm5zOiBSRVFVRVNUX1JFU1BPTlNFLiBSZWNlaXZlZDogUlVOX0pPQi8sXG4gICk7XG59KTtcblxudGVzdCgnVGFzayB0aHJvd3MgaWYgV0FJVF9GT1JfVEFTS19UT0tFTiBpcyBzdXBwbGllZCBhcyBzZXJ2aWNlIGludGVncmF0aW9uIHBhdHRlcm4nLCAoKSA9PiB7XG4gIGV4cGVjdCgoKSA9PiB7XG4gICAgbmV3IEVrc0NhbGwoc3RhY2ssICdDYWxsJywge1xuICAgICAgY2x1c3RlcjogY2x1c3RlcixcbiAgICAgIGh0dHBNZXRob2Q6IEh0dHBNZXRob2RzLkdFVCxcbiAgICAgIGh0dHBQYXRoOiAncGF0aCcsXG4gICAgICByZXF1ZXN0Qm9keTogc2ZuLlRhc2tJbnB1dC5mcm9tT2JqZWN0KHtcbiAgICAgICAgUmVxdWVzdEJvZHk6ICdyZXF1ZXN0Qm9keScsXG4gICAgICB9KSxcbiAgICAgIGludGVncmF0aW9uUGF0dGVybjogc2ZuLkludGVncmF0aW9uUGF0dGVybi5XQUlUX0ZPUl9UQVNLX1RPS0VOLFxuICAgIH0pO1xuICB9KS50b1Rocm93KFxuICAgIC9VbnN1cHBvcnRlZCBzZXJ2aWNlIGludGVncmF0aW9uIHBhdHRlcm4uIFN1cHBvcnRlZCBQYXR0ZXJuczogUkVRVUVTVF9SRVNQT05TRS4gUmVjZWl2ZWQ6IFdBSVRfRk9SX1RBU0tfVE9LRU4vLFxuICApO1xufSk7XG5cbnRlc3QoJ1Rhc2sgdGhyb3dzIGlmIGNsdXN0ZXIgc3VwcGxpZWQgZG9lcyBub3QgaGF2ZSBjbHVzdGVyRW5kcG9pbnQgY29uZmlndXJlZCcsICgpID0+IHtcbiAgY29uc3QgaW1wb3J0ZWRDbHVzdGVyID0gZWtzLkNsdXN0ZXIuZnJvbUNsdXN0ZXJBdHRyaWJ1dGVzKHN0YWNrLCAnSW52YWxpZENsdXN0ZXInLCB7XG4gICAgY2x1c3Rlck5hbWU6ICdpbXBvcnRlZENsdXN0ZXInLFxuICAgIGNsdXN0ZXJDZXJ0aWZpY2F0ZUF1dGhvcml0eURhdGE6ICdjbHVzdGVyQ2VydGlmaWNhdGVBdXRob3JpdHlEYXRhJyxcbiAgfSk7XG4gIGV4cGVjdCgoKSA9PiB7XG4gICAgbmV3IEVrc0NhbGwoc3RhY2ssICdDYWxsJywge1xuICAgICAgY2x1c3RlcjogaW1wb3J0ZWRDbHVzdGVyLFxuICAgICAgaHR0cE1ldGhvZDogSHR0cE1ldGhvZHMuR0VULFxuICAgICAgaHR0cFBhdGg6ICdwYXRoJyxcbiAgICAgIHJlcXVlc3RCb2R5OiBzZm4uVGFza0lucHV0LmZyb21PYmplY3Qoe1xuICAgICAgICBSZXF1ZXN0Qm9keTogJ3JlcXVlc3RCb2R5JyxcbiAgICAgIH0pLFxuICAgIH0pO1xuICB9KS50b1Rocm93KFxuICAgIC9UaGUgXCJjbHVzdGVyRW5kcG9pbnRcIiBwcm9wZXJ0eSBtdXN0IGJlIHNwZWNpZmllZCB3aGVuIHVzaW5nIGFuIGltcG9ydGVkIENsdXN0ZXIuLyxcbiAgKTtcbn0pO1xuXG50ZXN0KCdUYXNrIHRocm93cyBpZiBjbHVzdGVyIHN1cHBsaWVkIGRvZXMgbm90IGhhdmUgY2x1c3RlckNlcnRpZmljYXRlQXV0aG9yaXR5RGF0YSBjb25maWd1cmVkJywgKCkgPT4ge1xuICBjb25zdCBpbXBvcnRlZENsdXN0ZXIgPSBla3MuQ2x1c3Rlci5mcm9tQ2x1c3RlckF0dHJpYnV0ZXMoc3RhY2ssICdJbnZhbGlkQ2x1c3RlcicsIHtcbiAgICBjbHVzdGVyTmFtZTogJ2ltcG9ydGVkQ2x1c3RlcicsXG4gICAgY2x1c3RlckVuZHBvaW50OiAnY2x1c3RlckVuZHBvaW50JyxcbiAgfSk7XG4gIGV4cGVjdCgoKSA9PiB7XG4gICAgbmV3IEVrc0NhbGwoc3RhY2ssICdDYWxsJywge1xuICAgICAgY2x1c3RlcjogaW1wb3J0ZWRDbHVzdGVyLFxuICAgICAgaHR0cE1ldGhvZDogSHR0cE1ldGhvZHMuR0VULFxuICAgICAgaHR0cFBhdGg6ICdwYXRoJyxcbiAgICAgIHJlcXVlc3RCb2R5OiBzZm4uVGFza0lucHV0LmZyb21PYmplY3Qoe1xuICAgICAgICBSZXF1ZXN0Qm9keTogJ3JlcXVlc3RCb2R5JyxcbiAgICAgIH0pLFxuICAgIH0pO1xuICB9KS50b1Rocm93KFxuICAgIC9UaGUgXCJjbHVzdGVyQ2VydGlmaWNhdGVBdXRob3JpdHlEYXRhXCIgcHJvcGVydHkgbXVzdCBiZSBzcGVjaWZpZWQgd2hlbiB1c2luZyBhbiBpbXBvcnRlZCBDbHVzdGVyLi8sXG4gICk7XG59KTsiXX0=