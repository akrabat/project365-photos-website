"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../../assertions");
const sfn = require("../../../aws-stepfunctions");
const cdk = require("../../../core");
const tasks = require("../../lib");
let stack;
beforeEach(() => {
    // GIVEN
    stack = new cdk.Stack();
});
test('Modify an InstanceGroup with static ClusterId, InstanceGroupName, and InstanceGroup', () => {
    // WHEN
    const task = new tasks.EmrModifyInstanceGroupByName(stack, 'Task', {
        clusterId: 'ClusterId',
        instanceGroupName: 'InstanceGroupName',
        instanceGroup: {
            configurations: [{
                    classification: 'Classification',
                    properties: {
                        Key: 'Value',
                    },
                }],
            eC2InstanceIdsToTerminate: ['InstanceToTerminate'],
            instanceCount: 1,
            shrinkPolicy: {
                decommissionTimeout: cdk.Duration.seconds(1),
                instanceResizePolicy: {
                    instanceTerminationTimeout: cdk.Duration.seconds(1),
                    instancesToProtect: ['InstanceToProtect'],
                    instancesToTerminate: ['InstanceToTerminate'],
                },
            },
        },
    });
    // THEN
    expect(stack.resolve(task.toStateJson())).toEqual({
        Type: 'Task',
        Resource: {
            'Fn::Join': [
                '',
                [
                    'arn:',
                    {
                        Ref: 'AWS::Partition',
                    },
                    ':states:::elasticmapreduce:modifyInstanceGroupByName',
                ],
            ],
        },
        End: true,
        Parameters: {
            ClusterId: 'ClusterId',
            InstanceGroupName: 'InstanceGroupName',
            InstanceGroup: {
                Configurations: [{
                        Classification: 'Classification',
                        Properties: {
                            Key: 'Value',
                        },
                    }],
                EC2InstanceIdsToTerminate: ['InstanceToTerminate'],
                InstanceCount: 1,
                ShrinkPolicy: {
                    DecommissionTimeout: 1,
                    InstanceResizePolicy: {
                        InstanceTerminationTimeout: 1,
                        InstancesToProtect: ['InstanceToProtect'],
                        InstancesToTerminate: ['InstanceToTerminate'],
                    },
                },
            },
        },
    });
});
test('task policies are generated', () => {
    // WHEN
    const task = new tasks.EmrModifyInstanceGroupByName(stack, 'Task', {
        clusterId: 'ClusterId',
        instanceGroupName: 'InstanceGroupName',
        instanceGroup: {
            configurations: [{
                    classification: 'Classification',
                    properties: {
                        Key: 'Value',
                    },
                }],
        },
    });
    new sfn.StateMachine(stack, 'SM', {
        definition: task,
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
        PolicyDocument: {
            Statement: [
                {
                    Action: [
                        'elasticmapreduce:ModifyInstanceGroups',
                        'elasticmapreduce:ListInstanceGroups',
                    ],
                    Effect: 'Allow',
                    Resource: {
                        'Fn::Join': [
                            '',
                            [
                                'arn:',
                                {
                                    Ref: 'AWS::Partition',
                                },
                                ':elasticmapreduce:',
                                {
                                    Ref: 'AWS::Region',
                                },
                                ':',
                                {
                                    Ref: 'AWS::AccountId',
                                },
                                ':cluster/*',
                            ],
                        ],
                    },
                },
            ],
        },
    });
});
test('Modify an InstanceGroup with ClusterId from payload and static InstanceGroupName and InstanceGroupConfiguration', () => {
    // WHEN
    const task = new tasks.EmrModifyInstanceGroupByName(stack, 'Task', {
        clusterId: sfn.JsonPath.stringAt('$.ClusterId'),
        instanceGroupName: 'InstanceGroupName',
        instanceGroup: {
            instanceCount: 1,
        },
    });
    // THEN
    expect(stack.resolve(task.toStateJson())).toEqual({
        Type: 'Task',
        Resource: {
            'Fn::Join': [
                '',
                [
                    'arn:',
                    {
                        Ref: 'AWS::Partition',
                    },
                    ':states:::elasticmapreduce:modifyInstanceGroupByName',
                ],
            ],
        },
        End: true,
        Parameters: {
            'ClusterId.$': '$.ClusterId',
            'InstanceGroupName': 'InstanceGroupName',
            'InstanceGroup': {
                InstanceCount: 1,
            },
        },
    });
});
test('Modify an InstanceGroup with static ClusterId and InstanceGroupConfigurateion and InstanceGroupName from payload', () => {
    // WHEN
    const task = new tasks.EmrModifyInstanceGroupByName(stack, 'Task', {
        clusterId: 'ClusterId',
        instanceGroupName: sfn.JsonPath.stringAt('$.InstanceGroupName'),
        instanceGroup: {
            instanceCount: 1,
        },
    });
    // THEN
    expect(stack.resolve(task.toStateJson())).toEqual({
        Type: 'Task',
        Resource: {
            'Fn::Join': [
                '',
                [
                    'arn:',
                    {
                        Ref: 'AWS::Partition',
                    },
                    ':states:::elasticmapreduce:modifyInstanceGroupByName',
                ],
            ],
        },
        End: true,
        Parameters: {
            'ClusterId': 'ClusterId',
            'InstanceGroupName.$': '$.InstanceGroupName',
            'InstanceGroup': {
                InstanceCount: 1,
            },
        },
    });
});
test('Modify an InstanceGroup with static ClusterId and InstanceGroupName and InstanceCount from payload', () => {
    // WHEN
    const task = new tasks.EmrModifyInstanceGroupByName(stack, 'Task', {
        clusterId: 'ClusterId',
        instanceGroupName: 'InstanceGroupName',
        instanceGroup: {
            instanceCount: sfn.JsonPath.numberAt('$.InstanceCount'),
        },
    });
    // THEN
    expect(stack.resolve(task.toStateJson())).toEqual({
        Type: 'Task',
        Resource: {
            'Fn::Join': [
                '',
                [
                    'arn:',
                    {
                        Ref: 'AWS::Partition',
                    },
                    ':states:::elasticmapreduce:modifyInstanceGroupByName',
                ],
            ],
        },
        End: true,
        Parameters: {
            ClusterId: 'ClusterId',
            InstanceGroupName: 'InstanceGroupName',
            InstanceGroup: {
                'InstanceCount.$': '$.InstanceCount',
            },
        },
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1yLW1vZGlmeS1pbnN0YW5jZS1ncm91cC1ieS1uYW1lLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJlbXItbW9kaWZ5LWluc3RhbmNlLWdyb3VwLWJ5LW5hbWUudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG9EQUErQztBQUMvQyxrREFBa0Q7QUFDbEQscUNBQXFDO0FBQ3JDLG1DQUFtQztBQUVuQyxJQUFJLEtBQWdCLENBQUM7QUFFckIsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLFFBQVE7SUFDUixLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDMUIsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMscUZBQXFGLEVBQUUsR0FBRyxFQUFFO0lBQy9GLE9BQU87SUFDUCxNQUFNLElBQUksR0FBRyxJQUFJLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFO1FBQ2pFLFNBQVMsRUFBRSxXQUFXO1FBQ3RCLGlCQUFpQixFQUFFLG1CQUFtQjtRQUN0QyxhQUFhLEVBQUU7WUFDYixjQUFjLEVBQUUsQ0FBQztvQkFDZixjQUFjLEVBQUUsZ0JBQWdCO29CQUNoQyxVQUFVLEVBQUU7d0JBQ1YsR0FBRyxFQUFFLE9BQU87cUJBQ2I7aUJBQ0YsQ0FBQztZQUNGLHlCQUF5QixFQUFFLENBQUMscUJBQXFCLENBQUM7WUFDbEQsYUFBYSxFQUFFLENBQUM7WUFDaEIsWUFBWSxFQUFFO2dCQUNaLG1CQUFtQixFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDNUMsb0JBQW9CLEVBQUU7b0JBQ3BCLDBCQUEwQixFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztvQkFDbkQsa0JBQWtCLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQztvQkFDekMsb0JBQW9CLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQztpQkFDOUM7YUFD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RCxHQUFHLEVBQUUsSUFBSTtRQUNULFVBQVUsRUFBRTtZQUNWLFdBQVcsRUFBRSxXQUFXO1lBQ3hCLHFCQUFxQixFQUFFLHFCQUFxQjtZQUM1QyxlQUFlLEVBQUU7Z0JBQ2YsYUFBYSxFQUFFLENBQUM7YUFDakI7U0FDRjtLQUNGLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLG9HQUFvRyxFQUFFLEdBQUcsRUFBRTtJQUM5RyxPQUFPO0lBQ1AsTUFBTSxJQUFJLEdBQUcsSUFBSSxLQUFLLENBQUMsNEJBQTRCLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRTtRQUNqRSxTQUFTLEVBQUUsV0FBVztRQUN0QixpQkFBaUIsRUFBRSxtQkFBbUI7UUFDdEMsYUFBYSxFQUFFO1lBQ2IsYUFBYSxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDO1NBQ3hEO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsT0FBTztJQUNQLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQ2hELElBQUksRUFBRSxNQUFNO1FBQ1osUUFBUSxFQUFFO1lBQ1IsVUFBVSxFQUFFO2dCQUNWLEVBQUU7Z0JBQ0Y7b0JBQ0UsTUFBTTtvQkFDTjt3QkFDRSxHQUFHLEVBQUUsZ0JBQWdCO3FCQUN0QjtvQkFDRCxzREFBc0Q7aUJBQ3ZEO2FBQ0Y7U0FDRjtRQUNELEdBQUcsRUFBRSxJQUFJO1FBQ1QsVUFBVSxFQUFFO1lBQ1YsU0FBUyxFQUFFLFdBQVc7WUFDdEIsaUJBQWlCLEVBQUUsbUJBQW1CO1lBQ3RDLGFBQWEsRUFBRTtnQkFDYixpQkFBaUIsRUFBRSxpQkFBaUI7YUFDckM7U0FDRjtLQUNGLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVtcGxhdGUgfSBmcm9tICcuLi8uLi8uLi9hc3NlcnRpb25zJztcbmltcG9ydCAqIGFzIHNmbiBmcm9tICcuLi8uLi8uLi9hd3Mtc3RlcGZ1bmN0aW9ucyc7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnLi4vLi4vLi4vY29yZSc7XG5pbXBvcnQgKiBhcyB0YXNrcyBmcm9tICcuLi8uLi9saWInO1xuXG5sZXQgc3RhY2s6IGNkay5TdGFjaztcblxuYmVmb3JlRWFjaCgoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xufSk7XG5cbnRlc3QoJ01vZGlmeSBhbiBJbnN0YW5jZUdyb3VwIHdpdGggc3RhdGljIENsdXN0ZXJJZCwgSW5zdGFuY2VHcm91cE5hbWUsIGFuZCBJbnN0YW5jZUdyb3VwJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IHRhc2sgPSBuZXcgdGFza3MuRW1yTW9kaWZ5SW5zdGFuY2VHcm91cEJ5TmFtZShzdGFjaywgJ1Rhc2snLCB7XG4gICAgY2x1c3RlcklkOiAnQ2x1c3RlcklkJyxcbiAgICBpbnN0YW5jZUdyb3VwTmFtZTogJ0luc3RhbmNlR3JvdXBOYW1lJyxcbiAgICBpbnN0YW5jZUdyb3VwOiB7XG4gICAgICBjb25maWd1cmF0aW9uczogW3tcbiAgICAgICAgY2xhc3NpZmljYXRpb246ICdDbGFzc2lmaWNhdGlvbicsXG4gICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICBLZXk6ICdWYWx1ZScsXG4gICAgICAgIH0sXG4gICAgICB9XSxcbiAgICAgIGVDMkluc3RhbmNlSWRzVG9UZXJtaW5hdGU6IFsnSW5zdGFuY2VUb1Rlcm1pbmF0ZSddLFxuICAgICAgaW5zdGFuY2VDb3VudDogMSxcbiAgICAgIHNocmlua1BvbGljeToge1xuICAgICAgICBkZWNvbW1pc3Npb25UaW1lb3V0OiBjZGsuRHVyYXRpb24uc2Vjb25kcygxKSxcbiAgICAgICAgaW5zdGFuY2VSZXNpemVQb2xpY3k6IHtcbiAgICAgICAgICBpbnN0YW5jZVRlcm1pbmF0aW9uVGltZW91dDogY2RrLkR1cmF0aW9uLnNlY29uZHMoMSksXG4gICAgICAgICAgaW5zdGFuY2VzVG9Qcm90ZWN0OiBbJ0luc3RhbmNlVG9Qcm90ZWN0J10sXG4gICAgICAgICAgaW5zdGFuY2VzVG9UZXJtaW5hdGU6IFsnSW5zdGFuY2VUb1Rlcm1pbmF0ZSddLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChzdGFjay5yZXNvbHZlKHRhc2sudG9TdGF0ZUpzb24oKSkpLnRvRXF1YWwoe1xuICAgIFR5cGU6ICdUYXNrJyxcbiAgICBSZXNvdXJjZToge1xuICAgICAgJ0ZuOjpKb2luJzogW1xuICAgICAgICAnJyxcbiAgICAgICAgW1xuICAgICAgICAgICdhcm46JyxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBSZWY6ICdBV1M6OlBhcnRpdGlvbicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICAnOnN0YXRlczo6OmVsYXN0aWNtYXByZWR1Y2U6bW9kaWZ5SW5zdGFuY2VHcm91cEJ5TmFtZScsXG4gICAgICAgIF0sXG4gICAgICBdLFxuICAgIH0sXG4gICAgRW5kOiB0cnVlLFxuICAgIFBhcmFtZXRlcnM6IHtcbiAgICAgIENsdXN0ZXJJZDogJ0NsdXN0ZXJJZCcsXG4gICAgICBJbnN0YW5jZUdyb3VwTmFtZTogJ0luc3RhbmNlR3JvdXBOYW1lJyxcbiAgICAgIEluc3RhbmNlR3JvdXA6IHtcbiAgICAgICAgQ29uZmlndXJhdGlvbnM6IFt7XG4gICAgICAgICAgQ2xhc3NpZmljYXRpb246ICdDbGFzc2lmaWNhdGlvbicsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgS2V5OiAnVmFsdWUnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH1dLFxuICAgICAgICBFQzJJbnN0YW5jZUlkc1RvVGVybWluYXRlOiBbJ0luc3RhbmNlVG9UZXJtaW5hdGUnXSxcbiAgICAgICAgSW5zdGFuY2VDb3VudDogMSxcbiAgICAgICAgU2hyaW5rUG9saWN5OiB7XG4gICAgICAgICAgRGVjb21taXNzaW9uVGltZW91dDogMSxcbiAgICAgICAgICBJbnN0YW5jZVJlc2l6ZVBvbGljeToge1xuICAgICAgICAgICAgSW5zdGFuY2VUZXJtaW5hdGlvblRpbWVvdXQ6IDEsXG4gICAgICAgICAgICBJbnN0YW5jZXNUb1Byb3RlY3Q6IFsnSW5zdGFuY2VUb1Byb3RlY3QnXSxcbiAgICAgICAgICAgIEluc3RhbmNlc1RvVGVybWluYXRlOiBbJ0luc3RhbmNlVG9UZXJtaW5hdGUnXSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCd0YXNrIHBvbGljaWVzIGFyZSBnZW5lcmF0ZWQnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgdGFzayA9IG5ldyB0YXNrcy5FbXJNb2RpZnlJbnN0YW5jZUdyb3VwQnlOYW1lKHN0YWNrLCAnVGFzaycsIHtcbiAgICBjbHVzdGVySWQ6ICdDbHVzdGVySWQnLFxuICAgIGluc3RhbmNlR3JvdXBOYW1lOiAnSW5zdGFuY2VHcm91cE5hbWUnLFxuICAgIGluc3RhbmNlR3JvdXA6IHtcbiAgICAgIGNvbmZpZ3VyYXRpb25zOiBbe1xuICAgICAgICBjbGFzc2lmaWNhdGlvbjogJ0NsYXNzaWZpY2F0aW9uJyxcbiAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgIEtleTogJ1ZhbHVlJyxcbiAgICAgICAgfSxcbiAgICAgIH1dLFxuICAgIH0sXG4gIH0pO1xuICBuZXcgc2ZuLlN0YXRlTWFjaGluZShzdGFjaywgJ1NNJywge1xuICAgIGRlZmluaXRpb246IHRhc2ssXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6SUFNOjpQb2xpY3knLCB7XG4gICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgIFN0YXRlbWVudDogW1xuICAgICAgICB7XG4gICAgICAgICAgQWN0aW9uOiBbXG4gICAgICAgICAgICAnZWxhc3RpY21hcHJlZHVjZTpNb2RpZnlJbnN0YW5jZUdyb3VwcycsXG4gICAgICAgICAgICAnZWxhc3RpY21hcHJlZHVjZTpMaXN0SW5zdGFuY2VHcm91cHMnLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgIFJlc291cmNlOiB7XG4gICAgICAgICAgICAnRm46OkpvaW4nOiBbXG4gICAgICAgICAgICAgICcnLFxuICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIFJlZjogJ0FXUzo6UGFydGl0aW9uJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICc6ZWxhc3RpY21hcHJlZHVjZTonLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIFJlZjogJ0FXUzo6UmVnaW9uJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICc6JyxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBSZWY6ICdBV1M6OkFjY291bnRJZCcsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAnOmNsdXN0ZXIvKicsXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ01vZGlmeSBhbiBJbnN0YW5jZUdyb3VwIHdpdGggQ2x1c3RlcklkIGZyb20gcGF5bG9hZCBhbmQgc3RhdGljIEluc3RhbmNlR3JvdXBOYW1lIGFuZCBJbnN0YW5jZUdyb3VwQ29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCB0YXNrID0gbmV3IHRhc2tzLkVtck1vZGlmeUluc3RhbmNlR3JvdXBCeU5hbWUoc3RhY2ssICdUYXNrJywge1xuICAgIGNsdXN0ZXJJZDogc2ZuLkpzb25QYXRoLnN0cmluZ0F0KCckLkNsdXN0ZXJJZCcpLFxuICAgIGluc3RhbmNlR3JvdXBOYW1lOiAnSW5zdGFuY2VHcm91cE5hbWUnLFxuICAgIGluc3RhbmNlR3JvdXA6IHtcbiAgICAgIGluc3RhbmNlQ291bnQ6IDEsXG4gICAgfSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3Qoc3RhY2sucmVzb2x2ZSh0YXNrLnRvU3RhdGVKc29uKCkpKS50b0VxdWFsKHtcbiAgICBUeXBlOiAnVGFzaycsXG4gICAgUmVzb3VyY2U6IHtcbiAgICAgICdGbjo6Sm9pbic6IFtcbiAgICAgICAgJycsXG4gICAgICAgIFtcbiAgICAgICAgICAnYXJuOicsXG4gICAgICAgICAge1xuICAgICAgICAgICAgUmVmOiAnQVdTOjpQYXJ0aXRpb24nLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgJzpzdGF0ZXM6OjplbGFzdGljbWFwcmVkdWNlOm1vZGlmeUluc3RhbmNlR3JvdXBCeU5hbWUnLFxuICAgICAgICBdLFxuICAgICAgXSxcbiAgICB9LFxuICAgIEVuZDogdHJ1ZSxcbiAgICBQYXJhbWV0ZXJzOiB7XG4gICAgICAnQ2x1c3RlcklkLiQnOiAnJC5DbHVzdGVySWQnLFxuICAgICAgJ0luc3RhbmNlR3JvdXBOYW1lJzogJ0luc3RhbmNlR3JvdXBOYW1lJyxcbiAgICAgICdJbnN0YW5jZUdyb3VwJzoge1xuICAgICAgICBJbnN0YW5jZUNvdW50OiAxLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCdNb2RpZnkgYW4gSW5zdGFuY2VHcm91cCB3aXRoIHN0YXRpYyBDbHVzdGVySWQgYW5kIEluc3RhbmNlR3JvdXBDb25maWd1cmF0ZWlvbiBhbmQgSW5zdGFuY2VHcm91cE5hbWUgZnJvbSBwYXlsb2FkJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IHRhc2sgPSBuZXcgdGFza3MuRW1yTW9kaWZ5SW5zdGFuY2VHcm91cEJ5TmFtZShzdGFjaywgJ1Rhc2snLCB7XG4gICAgY2x1c3RlcklkOiAnQ2x1c3RlcklkJyxcbiAgICBpbnN0YW5jZUdyb3VwTmFtZTogc2ZuLkpzb25QYXRoLnN0cmluZ0F0KCckLkluc3RhbmNlR3JvdXBOYW1lJyksXG4gICAgaW5zdGFuY2VHcm91cDoge1xuICAgICAgaW5zdGFuY2VDb3VudDogMSxcbiAgICB9LFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChzdGFjay5yZXNvbHZlKHRhc2sudG9TdGF0ZUpzb24oKSkpLnRvRXF1YWwoe1xuICAgIFR5cGU6ICdUYXNrJyxcbiAgICBSZXNvdXJjZToge1xuICAgICAgJ0ZuOjpKb2luJzogW1xuICAgICAgICAnJyxcbiAgICAgICAgW1xuICAgICAgICAgICdhcm46JyxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBSZWY6ICdBV1M6OlBhcnRpdGlvbicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICAnOnN0YXRlczo6OmVsYXN0aWNtYXByZWR1Y2U6bW9kaWZ5SW5zdGFuY2VHcm91cEJ5TmFtZScsXG4gICAgICAgIF0sXG4gICAgICBdLFxuICAgIH0sXG4gICAgRW5kOiB0cnVlLFxuICAgIFBhcmFtZXRlcnM6IHtcbiAgICAgICdDbHVzdGVySWQnOiAnQ2x1c3RlcklkJyxcbiAgICAgICdJbnN0YW5jZUdyb3VwTmFtZS4kJzogJyQuSW5zdGFuY2VHcm91cE5hbWUnLFxuICAgICAgJ0luc3RhbmNlR3JvdXAnOiB7XG4gICAgICAgIEluc3RhbmNlQ291bnQ6IDEsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ01vZGlmeSBhbiBJbnN0YW5jZUdyb3VwIHdpdGggc3RhdGljIENsdXN0ZXJJZCBhbmQgSW5zdGFuY2VHcm91cE5hbWUgYW5kIEluc3RhbmNlQ291bnQgZnJvbSBwYXlsb2FkJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IHRhc2sgPSBuZXcgdGFza3MuRW1yTW9kaWZ5SW5zdGFuY2VHcm91cEJ5TmFtZShzdGFjaywgJ1Rhc2snLCB7XG4gICAgY2x1c3RlcklkOiAnQ2x1c3RlcklkJyxcbiAgICBpbnN0YW5jZUdyb3VwTmFtZTogJ0luc3RhbmNlR3JvdXBOYW1lJyxcbiAgICBpbnN0YW5jZUdyb3VwOiB7XG4gICAgICBpbnN0YW5jZUNvdW50OiBzZm4uSnNvblBhdGgubnVtYmVyQXQoJyQuSW5zdGFuY2VDb3VudCcpLFxuICAgIH0sXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KHN0YWNrLnJlc29sdmUodGFzay50b1N0YXRlSnNvbigpKSkudG9FcXVhbCh7XG4gICAgVHlwZTogJ1Rhc2snLFxuICAgIFJlc291cmNlOiB7XG4gICAgICAnRm46OkpvaW4nOiBbXG4gICAgICAgICcnLFxuICAgICAgICBbXG4gICAgICAgICAgJ2FybjonLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIFJlZjogJ0FXUzo6UGFydGl0aW9uJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgICc6c3RhdGVzOjo6ZWxhc3RpY21hcHJlZHVjZTptb2RpZnlJbnN0YW5jZUdyb3VwQnlOYW1lJyxcbiAgICAgICAgXSxcbiAgICAgIF0sXG4gICAgfSxcbiAgICBFbmQ6IHRydWUsXG4gICAgUGFyYW1ldGVyczoge1xuICAgICAgQ2x1c3RlcklkOiAnQ2x1c3RlcklkJyxcbiAgICAgIEluc3RhbmNlR3JvdXBOYW1lOiAnSW5zdGFuY2VHcm91cE5hbWUnLFxuICAgICAgSW5zdGFuY2VHcm91cDoge1xuICAgICAgICAnSW5zdGFuY2VDb3VudC4kJzogJyQuSW5zdGFuY2VDb3VudCcsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xufSk7XG4iXX0=