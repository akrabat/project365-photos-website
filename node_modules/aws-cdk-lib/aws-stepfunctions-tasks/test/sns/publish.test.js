"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const sns = require("../../../aws-sns");
const sfn = require("../../../aws-stepfunctions");
const cdk = require("../../../core");
const publish_1 = require("../../lib/sns/publish");
describe('Publish', () => {
    test('default settings', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const topic = new sns.Topic(stack, 'Topic');
        // WHEN
        const task = new publish_1.SnsPublish(stack, 'Publish', {
            topic,
            message: sfn.TaskInput.fromText('Publish this message'),
        });
        // THEN
        expect(stack.resolve(task.toStateJson())).toEqual({
            Type: 'Task',
            Resource: {
                'Fn::Join': [
                    '',
                    [
                        'arn:',
                        {
                            Ref: 'AWS::Partition',
                        },
                        ':states:::sns:publish',
                    ],
                ],
            },
            End: true,
            Parameters: {
                TopicArn: { Ref: 'TopicBFC7AF6E' },
                Message: 'Publish this message',
            },
        });
    });
    test('with message attributes', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const topic = new sns.Topic(stack, 'Topic');
        const token = cdk.Token.asString('cakes can be resolved');
        // WHEN
        const task = new publish_1.SnsPublish(stack, 'Publish', {
            topic,
            message: sfn.TaskInput.fromText('Publish this message'),
            messageAttributes: {
                cake: {
                    value: 'chocolate',
                },
                cakeCount: {
                    value: 2,
                },
                resolvable: {
                    value: token,
                },
                binary: {
                    value: 'a2345',
                    dataType: publish_1.MessageAttributeDataType.BINARY,
                },
                binaryNumberIsString: {
                    value: 123456987,
                    dataType: publish_1.MessageAttributeDataType.BINARY,
                },
                taskInput: {
                    value: sfn.TaskInput.fromJsonPathAt('$$.StateMachine.Name'),
                },
                executionId: {
                    value: sfn.JsonPath.stringAt('$$.Execution.Id'),
                },
                vendors: {
                    value: ['Great Cakes', true, false, null, 3, 'Local Cakes'],
                },
            },
        });
        // THEN
        expect(stack.resolve(task.toStateJson())).toEqual({
            Type: 'Task',
            Resource: {
                'Fn::Join': [
                    '',
                    [
                        'arn:',
                        {
                            Ref: 'AWS::Partition',
                        },
                        ':states:::sns:publish',
                    ],
                ],
            },
            End: true,
            Parameters: {
                TopicArn: { Ref: 'TopicBFC7AF6E' },
                Message: 'Publish this message',
                MessageAttributes: {
                    binary: {
                        DataType: 'Binary',
                        BinaryValue: 'a2345',
                    },
                    binaryNumberIsString: {
                        DataType: 'Binary',
                        BinaryValue: '123456987',
                    },
                    cake: {
                        DataType: 'String',
                        StringValue: 'chocolate',
                    },
                    cakeCount: {
                        DataType: 'Number',
                        StringValue: '2',
                    },
                    resolvable: {
                        DataType: 'String',
                        StringValue: 'cakes can be resolved',
                    },
                    executionId: {
                        'DataType': 'String',
                        'StringValue.$': '$$.Execution.Id',
                    },
                    taskInput: {
                        'DataType': 'String',
                        'StringValue.$': '$$.StateMachine.Name',
                    },
                    vendors: {
                        DataType: 'String.Array',
                        StringValue: '["Great Cakes",true,false,null,3,"Local Cakes"]',
                    },
                },
            },
        });
    });
    describe('invalid message attribute configurations', () => {
        // GIVEN
        const attributes = [
            {
                value: 2,
                dataType: publish_1.MessageAttributeDataType.STRING,
            },
            {
                value: 'foo',
                dataType: publish_1.MessageAttributeDataType.NUMBER,
            },
            {
                value: 'foo',
                dataType: publish_1.MessageAttributeDataType.STRING_ARRAY,
            },
            {
                value: ['foo', undefined, 2, true],
                dataType: publish_1.MessageAttributeDataType.STRING_ARRAY,
            },
            {
                value: ['foo', { bar: 2 }, 2, true],
                dataType: publish_1.MessageAttributeDataType.STRING_ARRAY,
            },
            {
                value: false,
                dataType: publish_1.MessageAttributeDataType.STRING_ARRAY,
            },
            {
                value: false,
                dataType: publish_1.MessageAttributeDataType.NUMBER,
            },
        ];
        attributes.forEach((a) => {
            test(`${JSON.stringify(a)} is not valid`, () => {
                // WHEN
                const stack = new cdk.Stack();
                const topic = new sns.Topic(stack, 'Topic');
                const task = new publish_1.SnsPublish(stack, 'Publish', {
                    topic,
                    message: sfn.TaskInput.fromText('Publish this message'),
                    messageAttributes: {
                        test: a,
                    },
                });
                // THEN
                expect(() => {
                    stack.resolve(task.toStateJson());
                }).toThrow(/Requested SNS message attribute type was/);
            });
        });
    });
    test('publish SNS message and wait for task token', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const topic = new sns.Topic(stack, 'Topic');
        // WHEN
        const task = new publish_1.SnsPublish(stack, 'Publish', {
            topic,
            integrationPattern: sfn.IntegrationPattern.WAIT_FOR_TASK_TOKEN,
            message: sfn.TaskInput.fromObject({
                Input: 'Publish this message',
                Token: sfn.JsonPath.taskToken,
            }),
        });
        // THEN
        expect(stack.resolve(task.toStateJson())).toEqual({
            Type: 'Task',
            Resource: {
                'Fn::Join': [
                    '',
                    [
                        'arn:',
                        {
                            Ref: 'AWS::Partition',
                        },
                        ':states:::sns:publish.waitForTaskToken',
                    ],
                ],
            },
            End: true,
            Parameters: {
                TopicArn: { Ref: 'TopicBFC7AF6E' },
                Message: {
                    'Input': 'Publish this message',
                    'Token.$': '$$.Task.Token',
                },
            },
        });
    });
    test('publish different message per subscription type', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const topic = new sns.Topic(stack, 'Topic');
        // WHEN
        const task = new publish_1.SnsPublish(stack, 'Publish', {
            topic,
            integrationPattern: sfn.IntegrationPattern.REQUEST_RESPONSE,
            message: sfn.TaskInput.fromObject({
                default: 'A message',
                sqs: 'A message for Amazon SQS',
                email: 'A message for email',
            }),
            messagePerSubscriptionType: true,
        });
        // THEN
        expect(stack.resolve(task.toStateJson())).toEqual({
            End: true,
            Type: 'Task',
            Resource: {
                'Fn::Join': [
                    '',
                    [
                        'arn:',
                        {
                            Ref: 'AWS::Partition',
                        },
                        ':states:::sns:publish',
                    ],
                ],
            },
            Parameters: {
                TopicArn: { Ref: 'TopicBFC7AF6E' },
                Message: {
                    default: 'A message',
                    sqs: 'A message for Amazon SQS',
                    email: 'A message for email',
                },
                MessageStructure: 'json',
            },
        });
    });
    test('topic ARN supplied through the task input', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const topic = sns.Topic.fromTopicArn(stack, 'Topic', sfn.JsonPath.stringAt('$.topicArn'));
        // WHEN
        const task = new publish_1.SnsPublish(stack, 'Publish', {
            topic,
            message: sfn.TaskInput.fromText('Publish this message'),
        });
        // THEN
        expect(stack.resolve(task.toStateJson())).toEqual({
            Type: 'Task',
            Resource: {
                'Fn::Join': [
                    '',
                    [
                        'arn:',
                        {
                            Ref: 'AWS::Partition',
                        },
                        ':states:::sns:publish',
                    ],
                ],
            },
            End: true,
            Parameters: {
                'TopicArn.$': '$.topicArn',
                'Message': 'Publish this message',
            },
        });
    });
    test('fails when WAIT_FOR_TASK_TOKEN integration pattern is used without supplying a task token in message', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const topic = new sns.Topic(stack, 'Topic');
        expect(() => {
            // WHEN
            new publish_1.SnsPublish(stack, 'Publish', {
                topic,
                integrationPattern: sfn.IntegrationPattern.WAIT_FOR_TASK_TOKEN,
                message: sfn.TaskInput.fromText('Publish this message'),
            });
            // THEN
        }).toThrow(/Task Token is required in `message` Use JsonPath.taskToken to set the token./);
    });
    test('fails when RUN_JOB integration pattern is used', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const topic = new sns.Topic(stack, 'Topic');
        expect(() => {
            new publish_1.SnsPublish(stack, 'Publish', {
                topic,
                integrationPattern: sfn.IntegrationPattern.RUN_JOB,
                message: sfn.TaskInput.fromText('Publish this message'),
            });
        }).toThrow(/Unsupported service integration pattern. Supported Patterns: REQUEST_RESPONSE,WAIT_FOR_TASK_TOKEN. Received: RUN_JOB/);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVibGlzaC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicHVibGlzaC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsd0NBQXdDO0FBQ3hDLGtEQUFrRDtBQUNsRCxxQ0FBcUM7QUFDckMsbURBQStGO0FBRS9GLFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO0lBRXZCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDNUIsUUFBUTtRQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzlCLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFNUMsT0FBTztRQUNQLE1BQU0sSUFBSSxHQUFHLElBQUksb0JBQVUsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFO1lBQzVDLEtBQUs7WUFDTCxPQUFPLEVBQUUsR0FBRyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsc0JBQXNCLENBQUM7U0FDeEQsQ0FBQyxDQUFDO1FBRUgsT0FBTztRQUNQLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ2hELElBQUksRUFBRSxNQUFNO1lBQ1osUUFBUSxFQUFFO2dCQUNSLFVBQVUsRUFBRTtvQkFDVixFQUFFO29CQUNGO3dCQUNFLE1BQU07d0JBQ047NEJBQ0UsR0FBRyxFQUFFLGdCQUFnQjt5QkFDdEI7d0JBQ0QsdUJBQXVCO3FCQUN4QjtpQkFDRjthQUNGO1lBQ0QsR0FBRyxFQUFFLElBQUk7WUFDVCxVQUFVLEVBQUU7Z0JBQ1YsUUFBUSxFQUFFLEVBQUUsR0FBRyxFQUFFLGVBQWUsRUFBRTtnQkFDbEMsT0FBTyxFQUFFLHNCQUFzQjthQUNoQztTQUNGLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0gsSUFBSSxDQUFDLHlCQUF5QixFQUFFLEdBQUcsRUFBRTtRQUNuQyxRQUFRO1FBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDOUIsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM1QyxNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBRTFELE9BQU87UUFDUCxNQUFNLElBQUksR0FBRyxJQUFJLG9CQUFVLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRTtZQUM1QyxLQUFLO1lBQ0wsT0FBTyxFQUFFLEdBQUcsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLHNCQUFzQixDQUFDO1lBQ3ZELGlCQUFpQixFQUFFO2dCQUNqQixJQUFJLEVBQUU7b0JBQ0osS0FBSyxFQUFFLFdBQVc7aUJBQ25CO2dCQUNELFNBQVMsRUFBRTtvQkFDVCxLQUFLLEVBQUUsQ0FBQztpQkFDVDtnQkFDRCxVQUFVLEVBQUU7b0JBQ1YsS0FBSyxFQUFFLEtBQUs7aUJBQ2I7Z0JBQ0QsTUFBTSxFQUFFO29CQUNOLEtBQUssRUFBRSxPQUFPO29CQUNkLFFBQVEsRUFBRSxrQ0FBd0IsQ0FBQyxNQUFNO2lCQUMxQztnQkFDRCxvQkFBb0IsRUFBRTtvQkFDcEIsS0FBSyxFQUFFLFNBQVM7b0JBQ2hCLFFBQVEsRUFBRSxrQ0FBd0IsQ0FBQyxNQUFNO2lCQUMxQztnQkFDRCxTQUFTLEVBQUU7b0JBQ1QsS0FBSyxFQUFFLEdBQUcsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLHNCQUFzQixDQUFDO2lCQUM1RDtnQkFDRCxXQUFXLEVBQUU7b0JBQ1gsS0FBSyxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDO2lCQUNoRDtnQkFDRCxPQUFPLEVBQUU7b0JBQ1AsS0FBSyxFQUFFLENBQUMsYUFBYSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxhQUFhLENBQUM7aUJBQzVEO2FBQ0Y7U0FDRixDQUFDLENBQUM7UUFFSCxPQUFPO1FBQ1AsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDaEQsSUFBSSxFQUFFLE1BQU07WUFDWixRQUFRLEVBQUU7Z0JBQ1IsVUFBVSxFQUFFO29CQUNWLEVBQUU7b0JBQ0Y7d0JBQ0UsTUFBTTt3QkFDTjs0QkFDRSxHQUFHLEVBQUUsZ0JBQWdCO3lCQUN0Qjt3QkFDRCx1QkFBdUI7cUJBQ3hCO2lCQUNGO2FBQ0Y7WUFDRCxHQUFHLEVBQUUsSUFBSTtZQUNULFVBQVUsRUFBRTtnQkFDVixRQUFRLEVBQUUsRUFBRSxHQUFHLEVBQUUsZUFBZSxFQUFFO2dCQUNsQyxPQUFPLEVBQUUsc0JBQXNCO2dCQUMvQixpQkFBaUIsRUFBRTtvQkFDakIsTUFBTSxFQUFFO3dCQUNOLFFBQVEsRUFBRSxRQUFRO3dCQUNsQixXQUFXLEVBQUUsT0FBTztxQkFDckI7b0JBQ0Qsb0JBQW9CLEVBQUU7d0JBQ3BCLFFBQVEsRUFBRSxRQUFRO3dCQUNsQixXQUFXLEVBQUUsV0FBVztxQkFDekI7b0JBQ0QsSUFBSSxFQUFFO3dCQUNKLFFBQVEsRUFBRSxRQUFRO3dCQUNsQixXQUFXLEVBQUUsV0FBVztxQkFDekI7b0JBQ0QsU0FBUyxFQUFFO3dCQUNULFFBQVEsRUFBRSxRQUFRO3dCQUNsQixXQUFXLEVBQUUsR0FBRztxQkFDakI7b0JBQ0QsVUFBVSxFQUFFO3dCQUNWLFFBQVEsRUFBRSxRQUFRO3dCQUNsQixXQUFXLEVBQUUsdUJBQXVCO3FCQUNyQztvQkFDRCxXQUFXLEVBQUU7d0JBQ1gsVUFBVSxFQUFFLFFBQVE7d0JBQ3BCLGVBQWUsRUFBRSxpQkFBaUI7cUJBQ25DO29CQUNELFNBQVMsRUFBRTt3QkFDVCxVQUFVLEVBQUUsUUFBUTt3QkFDcEIsZUFBZSxFQUFFLHNCQUFzQjtxQkFDeEM7b0JBQ0QsT0FBTyxFQUFFO3dCQUNQLFFBQVEsRUFBRSxjQUFjO3dCQUN4QixXQUFXLEVBQUUsaURBQWlEO3FCQUMvRDtpQkFDRjthQUNGO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDSCxRQUFRLENBQUMsMENBQTBDLEVBQUUsR0FBRyxFQUFFO1FBQ3hELFFBQVE7UUFDUixNQUFNLFVBQVUsR0FBdUI7WUFDckM7Z0JBQ0UsS0FBSyxFQUFFLENBQUM7Z0JBQ1IsUUFBUSxFQUFFLGtDQUF3QixDQUFDLE1BQU07YUFDMUM7WUFDRDtnQkFDRSxLQUFLLEVBQUUsS0FBSztnQkFDWixRQUFRLEVBQUUsa0NBQXdCLENBQUMsTUFBTTthQUMxQztZQUNEO2dCQUNFLEtBQUssRUFBRSxLQUFLO2dCQUNaLFFBQVEsRUFBRSxrQ0FBd0IsQ0FBQyxZQUFZO2FBQ2hEO1lBQ0Q7Z0JBQ0UsS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDO2dCQUNsQyxRQUFRLEVBQUUsa0NBQXdCLENBQUMsWUFBWTthQUNoRDtZQUNEO2dCQUNFLEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDO2dCQUNuQyxRQUFRLEVBQUUsa0NBQXdCLENBQUMsWUFBWTthQUNoRDtZQUNEO2dCQUNFLEtBQUssRUFBRSxLQUFLO2dCQUNaLFFBQVEsRUFBRSxrQ0FBd0IsQ0FBQyxZQUFZO2FBQ2hEO1lBQ0Q7Z0JBQ0UsS0FBSyxFQUFFLEtBQUs7Z0JBQ1osUUFBUSxFQUFFLGtDQUF3QixDQUFDLE1BQU07YUFDMUM7U0FDRixDQUFDO1FBQ0YsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7Z0JBQzdDLE9BQU87Z0JBQ1AsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQzlCLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQzVDLE1BQU0sSUFBSSxHQUFHLElBQUksb0JBQVUsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFO29CQUM1QyxLQUFLO29CQUNMLE9BQU8sRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxzQkFBc0IsQ0FBQztvQkFDdkQsaUJBQWlCLEVBQUU7d0JBQ2pCLElBQUksRUFBRSxDQUFDO3FCQUNSO2lCQUNGLENBQUMsQ0FBQztnQkFFSCxPQUFPO2dCQUNQLE1BQU0sQ0FBQyxHQUFHLEVBQUU7b0JBQ1YsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztnQkFDcEMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLDBDQUEwQyxDQUFDLENBQUM7WUFDekQsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLDZDQUE2QyxFQUFFLEdBQUcsRUFBRTtRQUN2RCxRQUFRO1FBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDOUIsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztRQUU1QyxPQUFPO1FBQ1AsTUFBTSxJQUFJLEdBQUcsSUFBSSxvQkFBVSxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUU7WUFDNUMsS0FBSztZQUNMLGtCQUFrQixFQUFFLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxtQkFBbUI7WUFDOUQsT0FBTyxFQUFFLEdBQUcsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDO2dCQUNoQyxLQUFLLEVBQUUsc0JBQXNCO2dCQUM3QixLQUFLLEVBQUUsR0FBRyxDQUFDLFFBQVEsQ0FBQyxTQUFTO2FBQzlCLENBQUM7U0FDSCxDQUFDLENBQUM7UUFFSCxPQUFPO1FBQ1AsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDaEQsSUFBSSxFQUFFLE1BQU07WUFDWixRQUFRLEVBQUU7Z0JBQ1IsVUFBVSxFQUFFO29CQUNWLEVBQUU7b0JBQ0Y7d0JBQ0UsTUFBTTt3QkFDTjs0QkFDRSxHQUFHLEVBQUUsZ0JBQWdCO3lCQUN0Qjt3QkFDRCx3Q0FBd0M7cUJBQ3pDO2lCQUNGO2FBQ0Y7WUFDRCxHQUFHLEVBQUUsSUFBSTtZQUNULFVBQVUsRUFBRTtnQkFDVixRQUFRLEVBQUUsRUFBRSxHQUFHLEVBQUUsZUFBZSxFQUFFO2dCQUNsQyxPQUFPLEVBQUU7b0JBQ1AsT0FBTyxFQUFFLHNCQUFzQjtvQkFDL0IsU0FBUyxFQUFFLGVBQWU7aUJBQzNCO2FBQ0Y7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxpREFBaUQsRUFBRSxHQUFHLEVBQUU7UUFDM0QsUUFBUTtRQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzlCLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFNUMsT0FBTztRQUNQLE1BQU0sSUFBSSxHQUFHLElBQUksb0JBQVUsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFO1lBQzVDLEtBQUs7WUFDTCxrQkFBa0IsRUFBRSxHQUFHLENBQUMsa0JBQWtCLENBQUMsZ0JBQWdCO1lBQzNELE9BQU8sRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQztnQkFDaEMsT0FBTyxFQUFFLFdBQVc7Z0JBQ3BCLEdBQUcsRUFBRSwwQkFBMEI7Z0JBQy9CLEtBQUssRUFBRSxxQkFBcUI7YUFDN0IsQ0FBQztZQUNGLDBCQUEwQixFQUFFLElBQUk7U0FDakMsQ0FBQyxDQUFDO1FBRUgsT0FBTztRQUNQLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ2hELEdBQUcsRUFBRSxJQUFJO1lBQ1QsSUFBSSxFQUFFLE1BQU07WUFDWixRQUFRLEVBQUU7Z0JBQ1IsVUFBVSxFQUFFO29CQUNWLEVBQUU7b0JBQ0Y7d0JBQ0UsTUFBTTt3QkFDTjs0QkFDRSxHQUFHLEVBQUUsZ0JBQWdCO3lCQUN0Qjt3QkFDRCx1QkFBdUI7cUJBQ3hCO2lCQUNGO2FBQ0Y7WUFDRCxVQUFVLEVBQUU7Z0JBQ1YsUUFBUSxFQUFFLEVBQUUsR0FBRyxFQUFFLGVBQWUsRUFBRTtnQkFDbEMsT0FBTyxFQUFFO29CQUNQLE9BQU8sRUFBRSxXQUFXO29CQUNwQixHQUFHLEVBQUUsMEJBQTBCO29CQUMvQixLQUFLLEVBQUUscUJBQXFCO2lCQUM3QjtnQkFDRCxnQkFBZ0IsRUFBRSxNQUFNO2FBQ3pCO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsMkNBQTJDLEVBQUUsR0FBRyxFQUFFO1FBQ3JELFFBQVE7UUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUM5QixNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7UUFFMUYsT0FBTztRQUNQLE1BQU0sSUFBSSxHQUFHLElBQUksb0JBQVUsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFO1lBQzVDLEtBQUs7WUFDTCxPQUFPLEVBQUUsR0FBRyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsc0JBQXNCLENBQUM7U0FDeEQsQ0FBQyxDQUFDO1FBRUgsT0FBTztRQUNQLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ2hELElBQUksRUFBRSxNQUFNO1lBQ1osUUFBUSxFQUFFO2dCQUNSLFVBQVUsRUFBRTtvQkFDVixFQUFFO29CQUNGO3dCQUNFLE1BQU07d0JBQ047NEJBQ0UsR0FBRyxFQUFFLGdCQUFnQjt5QkFDdEI7d0JBQ0QsdUJBQXVCO3FCQUN4QjtpQkFDRjthQUNGO1lBQ0QsR0FBRyxFQUFFLElBQUk7WUFDVCxVQUFVLEVBQUU7Z0JBQ1YsWUFBWSxFQUFFLFlBQVk7Z0JBQzFCLFNBQVMsRUFBRSxzQkFBc0I7YUFDbEM7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxzR0FBc0csRUFBRSxHQUFHLEVBQUU7UUFDaEgsUUFBUTtRQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzlCLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFNUMsTUFBTSxDQUFDLEdBQUcsRUFBRTtZQUNWLE9BQU87WUFDUCxJQUFJLG9CQUFVLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRTtnQkFDL0IsS0FBSztnQkFDTCxrQkFBa0IsRUFBRSxHQUFHLENBQUMsa0JBQWtCLENBQUMsbUJBQW1CO2dCQUM5RCxPQUFPLEVBQUUsR0FBRyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsc0JBQXNCLENBQUM7YUFDeEQsQ0FBQyxDQUFDO1lBQ0gsT0FBTztRQUNULENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyw4RUFBOEUsQ0FBQyxDQUFDO0lBQzdGLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLGdEQUFnRCxFQUFFLEdBQUcsRUFBRTtRQUMxRCxRQUFRO1FBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDOUIsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztRQUU1QyxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsSUFBSSxvQkFBVSxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUU7Z0JBQy9CLEtBQUs7Z0JBQ0wsa0JBQWtCLEVBQUUsR0FBRyxDQUFDLGtCQUFrQixDQUFDLE9BQU87Z0JBQ2xELE9BQU8sRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxzQkFBc0IsQ0FBQzthQUN4RCxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsc0hBQXNILENBQUMsQ0FBQztJQUNySSxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgc25zIGZyb20gJy4uLy4uLy4uL2F3cy1zbnMnO1xuaW1wb3J0ICogYXMgc2ZuIGZyb20gJy4uLy4uLy4uL2F3cy1zdGVwZnVuY3Rpb25zJztcbmltcG9ydCAqIGFzIGNkayBmcm9tICcuLi8uLi8uLi9jb3JlJztcbmltcG9ydCB7IFNuc1B1Ymxpc2gsIE1lc3NhZ2VBdHRyaWJ1dGVEYXRhVHlwZSwgTWVzc2FnZUF0dHJpYnV0ZSB9IGZyb20gJy4uLy4uL2xpYi9zbnMvcHVibGlzaCc7XG5cbmRlc2NyaWJlKCdQdWJsaXNoJywgKCkgPT4ge1xuXG4gIHRlc3QoJ2RlZmF1bHQgc2V0dGluZ3MnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgICBjb25zdCB0b3BpYyA9IG5ldyBzbnMuVG9waWMoc3RhY2ssICdUb3BpYycpO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHRhc2sgPSBuZXcgU25zUHVibGlzaChzdGFjaywgJ1B1Ymxpc2gnLCB7XG4gICAgICB0b3BpYyxcbiAgICAgIG1lc3NhZ2U6IHNmbi5UYXNrSW5wdXQuZnJvbVRleHQoJ1B1Ymxpc2ggdGhpcyBtZXNzYWdlJyksXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHN0YWNrLnJlc29sdmUodGFzay50b1N0YXRlSnNvbigpKSkudG9FcXVhbCh7XG4gICAgICBUeXBlOiAnVGFzaycsXG4gICAgICBSZXNvdXJjZToge1xuICAgICAgICAnRm46OkpvaW4nOiBbXG4gICAgICAgICAgJycsXG4gICAgICAgICAgW1xuICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBSZWY6ICdBV1M6OlBhcnRpdGlvbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJzpzdGF0ZXM6OjpzbnM6cHVibGlzaCcsXG4gICAgICAgICAgXSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgICBFbmQ6IHRydWUsXG4gICAgICBQYXJhbWV0ZXJzOiB7XG4gICAgICAgIFRvcGljQXJuOiB7IFJlZjogJ1RvcGljQkZDN0FGNkUnIH0sXG4gICAgICAgIE1lc3NhZ2U6ICdQdWJsaXNoIHRoaXMgbWVzc2FnZScsXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcbiAgdGVzdCgnd2l0aCBtZXNzYWdlIGF0dHJpYnV0ZXMnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgICBjb25zdCB0b3BpYyA9IG5ldyBzbnMuVG9waWMoc3RhY2ssICdUb3BpYycpO1xuICAgIGNvbnN0IHRva2VuID0gY2RrLlRva2VuLmFzU3RyaW5nKCdjYWtlcyBjYW4gYmUgcmVzb2x2ZWQnKTtcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCB0YXNrID0gbmV3IFNuc1B1Ymxpc2goc3RhY2ssICdQdWJsaXNoJywge1xuICAgICAgdG9waWMsXG4gICAgICBtZXNzYWdlOiBzZm4uVGFza0lucHV0LmZyb21UZXh0KCdQdWJsaXNoIHRoaXMgbWVzc2FnZScpLFxuICAgICAgbWVzc2FnZUF0dHJpYnV0ZXM6IHtcbiAgICAgICAgY2FrZToge1xuICAgICAgICAgIHZhbHVlOiAnY2hvY29sYXRlJyxcbiAgICAgICAgfSxcbiAgICAgICAgY2FrZUNvdW50OiB7XG4gICAgICAgICAgdmFsdWU6IDIsXG4gICAgICAgIH0sXG4gICAgICAgIHJlc29sdmFibGU6IHtcbiAgICAgICAgICB2YWx1ZTogdG9rZW4sXG4gICAgICAgIH0sXG4gICAgICAgIGJpbmFyeToge1xuICAgICAgICAgIHZhbHVlOiAnYTIzNDUnLFxuICAgICAgICAgIGRhdGFUeXBlOiBNZXNzYWdlQXR0cmlidXRlRGF0YVR5cGUuQklOQVJZLFxuICAgICAgICB9LFxuICAgICAgICBiaW5hcnlOdW1iZXJJc1N0cmluZzoge1xuICAgICAgICAgIHZhbHVlOiAxMjM0NTY5ODcsXG4gICAgICAgICAgZGF0YVR5cGU6IE1lc3NhZ2VBdHRyaWJ1dGVEYXRhVHlwZS5CSU5BUlksXG4gICAgICAgIH0sXG4gICAgICAgIHRhc2tJbnB1dDoge1xuICAgICAgICAgIHZhbHVlOiBzZm4uVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KCckJC5TdGF0ZU1hY2hpbmUuTmFtZScpLFxuICAgICAgICB9LFxuICAgICAgICBleGVjdXRpb25JZDoge1xuICAgICAgICAgIHZhbHVlOiBzZm4uSnNvblBhdGguc3RyaW5nQXQoJyQkLkV4ZWN1dGlvbi5JZCcpLFxuICAgICAgICB9LFxuICAgICAgICB2ZW5kb3JzOiB7XG4gICAgICAgICAgdmFsdWU6IFsnR3JlYXQgQ2FrZXMnLCB0cnVlLCBmYWxzZSwgbnVsbCwgMywgJ0xvY2FsIENha2VzJ10sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKHRhc2sudG9TdGF0ZUpzb24oKSkpLnRvRXF1YWwoe1xuICAgICAgVHlwZTogJ1Rhc2snLFxuICAgICAgUmVzb3VyY2U6IHtcbiAgICAgICAgJ0ZuOjpKb2luJzogW1xuICAgICAgICAgICcnLFxuICAgICAgICAgIFtcbiAgICAgICAgICAgICdhcm46JyxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgUmVmOiAnQVdTOjpQYXJ0aXRpb24nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICc6c3RhdGVzOjo6c25zOnB1Ymxpc2gnLFxuICAgICAgICAgIF0sXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgICAgRW5kOiB0cnVlLFxuICAgICAgUGFyYW1ldGVyczoge1xuICAgICAgICBUb3BpY0FybjogeyBSZWY6ICdUb3BpY0JGQzdBRjZFJyB9LFxuICAgICAgICBNZXNzYWdlOiAnUHVibGlzaCB0aGlzIG1lc3NhZ2UnLFxuICAgICAgICBNZXNzYWdlQXR0cmlidXRlczoge1xuICAgICAgICAgIGJpbmFyeToge1xuICAgICAgICAgICAgRGF0YVR5cGU6ICdCaW5hcnknLFxuICAgICAgICAgICAgQmluYXJ5VmFsdWU6ICdhMjM0NScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBiaW5hcnlOdW1iZXJJc1N0cmluZzoge1xuICAgICAgICAgICAgRGF0YVR5cGU6ICdCaW5hcnknLFxuICAgICAgICAgICAgQmluYXJ5VmFsdWU6ICcxMjM0NTY5ODcnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2FrZToge1xuICAgICAgICAgICAgRGF0YVR5cGU6ICdTdHJpbmcnLFxuICAgICAgICAgICAgU3RyaW5nVmFsdWU6ICdjaG9jb2xhdGUnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2FrZUNvdW50OiB7XG4gICAgICAgICAgICBEYXRhVHlwZTogJ051bWJlcicsXG4gICAgICAgICAgICBTdHJpbmdWYWx1ZTogJzInLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVzb2x2YWJsZToge1xuICAgICAgICAgICAgRGF0YVR5cGU6ICdTdHJpbmcnLFxuICAgICAgICAgICAgU3RyaW5nVmFsdWU6ICdjYWtlcyBjYW4gYmUgcmVzb2x2ZWQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXhlY3V0aW9uSWQ6IHtcbiAgICAgICAgICAgICdEYXRhVHlwZSc6ICdTdHJpbmcnLFxuICAgICAgICAgICAgJ1N0cmluZ1ZhbHVlLiQnOiAnJCQuRXhlY3V0aW9uLklkJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRhc2tJbnB1dDoge1xuICAgICAgICAgICAgJ0RhdGFUeXBlJzogJ1N0cmluZycsXG4gICAgICAgICAgICAnU3RyaW5nVmFsdWUuJCc6ICckJC5TdGF0ZU1hY2hpbmUuTmFtZScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB2ZW5kb3JzOiB7XG4gICAgICAgICAgICBEYXRhVHlwZTogJ1N0cmluZy5BcnJheScsXG4gICAgICAgICAgICBTdHJpbmdWYWx1ZTogJ1tcIkdyZWF0IENha2VzXCIsdHJ1ZSxmYWxzZSxudWxsLDMsXCJMb2NhbCBDYWtlc1wiXScsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnaW52YWxpZCBtZXNzYWdlIGF0dHJpYnV0ZSBjb25maWd1cmF0aW9ucycsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IGF0dHJpYnV0ZXM6IE1lc3NhZ2VBdHRyaWJ1dGVbXSA9IFtcbiAgICAgIHtcbiAgICAgICAgdmFsdWU6IDIsXG4gICAgICAgIGRhdGFUeXBlOiBNZXNzYWdlQXR0cmlidXRlRGF0YVR5cGUuU1RSSU5HLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdmFsdWU6ICdmb28nLFxuICAgICAgICBkYXRhVHlwZTogTWVzc2FnZUF0dHJpYnV0ZURhdGFUeXBlLk5VTUJFUixcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiAnZm9vJyxcbiAgICAgICAgZGF0YVR5cGU6IE1lc3NhZ2VBdHRyaWJ1dGVEYXRhVHlwZS5TVFJJTkdfQVJSQVksXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB2YWx1ZTogWydmb28nLCB1bmRlZmluZWQsIDIsIHRydWVdLFxuICAgICAgICBkYXRhVHlwZTogTWVzc2FnZUF0dHJpYnV0ZURhdGFUeXBlLlNUUklOR19BUlJBWSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiBbJ2ZvbycsIHsgYmFyOiAyIH0sIDIsIHRydWVdLFxuICAgICAgICBkYXRhVHlwZTogTWVzc2FnZUF0dHJpYnV0ZURhdGFUeXBlLlNUUklOR19BUlJBWSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHZhbHVlOiBmYWxzZSxcbiAgICAgICAgZGF0YVR5cGU6IE1lc3NhZ2VBdHRyaWJ1dGVEYXRhVHlwZS5TVFJJTkdfQVJSQVksXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB2YWx1ZTogZmFsc2UsXG4gICAgICAgIGRhdGFUeXBlOiBNZXNzYWdlQXR0cmlidXRlRGF0YVR5cGUuTlVNQkVSLFxuICAgICAgfSxcbiAgICBdO1xuICAgIGF0dHJpYnV0ZXMuZm9yRWFjaCgoYSkgPT4ge1xuICAgICAgdGVzdChgJHtKU09OLnN0cmluZ2lmeShhKX0gaXMgbm90IHZhbGlkYCwgKCkgPT4ge1xuICAgICAgICAvLyBXSEVOXG4gICAgICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgICAgICBjb25zdCB0b3BpYyA9IG5ldyBzbnMuVG9waWMoc3RhY2ssICdUb3BpYycpO1xuICAgICAgICBjb25zdCB0YXNrID0gbmV3IFNuc1B1Ymxpc2goc3RhY2ssICdQdWJsaXNoJywge1xuICAgICAgICAgIHRvcGljLFxuICAgICAgICAgIG1lc3NhZ2U6IHNmbi5UYXNrSW5wdXQuZnJvbVRleHQoJ1B1Ymxpc2ggdGhpcyBtZXNzYWdlJyksXG4gICAgICAgICAgbWVzc2FnZUF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgIHRlc3Q6IGEsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVEhFTlxuICAgICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICAgIHN0YWNrLnJlc29sdmUodGFzay50b1N0YXRlSnNvbigpKTtcbiAgICAgICAgfSkudG9UaHJvdygvUmVxdWVzdGVkIFNOUyBtZXNzYWdlIGF0dHJpYnV0ZSB0eXBlIHdhcy8pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3B1Ymxpc2ggU05TIG1lc3NhZ2UgYW5kIHdhaXQgZm9yIHRhc2sgdG9rZW4nLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgICBjb25zdCB0b3BpYyA9IG5ldyBzbnMuVG9waWMoc3RhY2ssICdUb3BpYycpO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHRhc2sgPSBuZXcgU25zUHVibGlzaChzdGFjaywgJ1B1Ymxpc2gnLCB7XG4gICAgICB0b3BpYyxcbiAgICAgIGludGVncmF0aW9uUGF0dGVybjogc2ZuLkludGVncmF0aW9uUGF0dGVybi5XQUlUX0ZPUl9UQVNLX1RPS0VOLFxuICAgICAgbWVzc2FnZTogc2ZuLlRhc2tJbnB1dC5mcm9tT2JqZWN0KHtcbiAgICAgICAgSW5wdXQ6ICdQdWJsaXNoIHRoaXMgbWVzc2FnZScsXG4gICAgICAgIFRva2VuOiBzZm4uSnNvblBhdGgudGFza1Rva2VuLFxuICAgICAgfSksXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHN0YWNrLnJlc29sdmUodGFzay50b1N0YXRlSnNvbigpKSkudG9FcXVhbCh7XG4gICAgICBUeXBlOiAnVGFzaycsXG4gICAgICBSZXNvdXJjZToge1xuICAgICAgICAnRm46OkpvaW4nOiBbXG4gICAgICAgICAgJycsXG4gICAgICAgICAgW1xuICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBSZWY6ICdBV1M6OlBhcnRpdGlvbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJzpzdGF0ZXM6OjpzbnM6cHVibGlzaC53YWl0Rm9yVGFza1Rva2VuJyxcbiAgICAgICAgICBdLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICAgIEVuZDogdHJ1ZSxcbiAgICAgIFBhcmFtZXRlcnM6IHtcbiAgICAgICAgVG9waWNBcm46IHsgUmVmOiAnVG9waWNCRkM3QUY2RScgfSxcbiAgICAgICAgTWVzc2FnZToge1xuICAgICAgICAgICdJbnB1dCc6ICdQdWJsaXNoIHRoaXMgbWVzc2FnZScsXG4gICAgICAgICAgJ1Rva2VuLiQnOiAnJCQuVGFzay5Ub2tlbicsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdwdWJsaXNoIGRpZmZlcmVudCBtZXNzYWdlIHBlciBzdWJzY3JpcHRpb24gdHlwZScsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgIGNvbnN0IHRvcGljID0gbmV3IHNucy5Ub3BpYyhzdGFjaywgJ1RvcGljJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3QgdGFzayA9IG5ldyBTbnNQdWJsaXNoKHN0YWNrLCAnUHVibGlzaCcsIHtcbiAgICAgIHRvcGljLFxuICAgICAgaW50ZWdyYXRpb25QYXR0ZXJuOiBzZm4uSW50ZWdyYXRpb25QYXR0ZXJuLlJFUVVFU1RfUkVTUE9OU0UsXG4gICAgICBtZXNzYWdlOiBzZm4uVGFza0lucHV0LmZyb21PYmplY3Qoe1xuICAgICAgICBkZWZhdWx0OiAnQSBtZXNzYWdlJyxcbiAgICAgICAgc3FzOiAnQSBtZXNzYWdlIGZvciBBbWF6b24gU1FTJyxcbiAgICAgICAgZW1haWw6ICdBIG1lc3NhZ2UgZm9yIGVtYWlsJyxcbiAgICAgIH0pLFxuICAgICAgbWVzc2FnZVBlclN1YnNjcmlwdGlvblR5cGU6IHRydWUsXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHN0YWNrLnJlc29sdmUodGFzay50b1N0YXRlSnNvbigpKSkudG9FcXVhbCh7XG4gICAgICBFbmQ6IHRydWUsXG4gICAgICBUeXBlOiAnVGFzaycsXG4gICAgICBSZXNvdXJjZToge1xuICAgICAgICAnRm46OkpvaW4nOiBbXG4gICAgICAgICAgJycsXG4gICAgICAgICAgW1xuICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBSZWY6ICdBV1M6OlBhcnRpdGlvbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJzpzdGF0ZXM6OjpzbnM6cHVibGlzaCcsXG4gICAgICAgICAgXSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgICBQYXJhbWV0ZXJzOiB7XG4gICAgICAgIFRvcGljQXJuOiB7IFJlZjogJ1RvcGljQkZDN0FGNkUnIH0sXG4gICAgICAgIE1lc3NhZ2U6IHtcbiAgICAgICAgICBkZWZhdWx0OiAnQSBtZXNzYWdlJyxcbiAgICAgICAgICBzcXM6ICdBIG1lc3NhZ2UgZm9yIEFtYXpvbiBTUVMnLFxuICAgICAgICAgIGVtYWlsOiAnQSBtZXNzYWdlIGZvciBlbWFpbCcsXG4gICAgICAgIH0sXG4gICAgICAgIE1lc3NhZ2VTdHJ1Y3R1cmU6ICdqc29uJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3RvcGljIEFSTiBzdXBwbGllZCB0aHJvdWdoIHRoZSB0YXNrIGlucHV0JywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgY29uc3QgdG9waWMgPSBzbnMuVG9waWMuZnJvbVRvcGljQXJuKHN0YWNrLCAnVG9waWMnLCBzZm4uSnNvblBhdGguc3RyaW5nQXQoJyQudG9waWNBcm4nKSk7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3QgdGFzayA9IG5ldyBTbnNQdWJsaXNoKHN0YWNrLCAnUHVibGlzaCcsIHtcbiAgICAgIHRvcGljLFxuICAgICAgbWVzc2FnZTogc2ZuLlRhc2tJbnB1dC5mcm9tVGV4dCgnUHVibGlzaCB0aGlzIG1lc3NhZ2UnKSxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZSh0YXNrLnRvU3RhdGVKc29uKCkpKS50b0VxdWFsKHtcbiAgICAgIFR5cGU6ICdUYXNrJyxcbiAgICAgIFJlc291cmNlOiB7XG4gICAgICAgICdGbjo6Sm9pbic6IFtcbiAgICAgICAgICAnJyxcbiAgICAgICAgICBbXG4gICAgICAgICAgICAnYXJuOicsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFJlZjogJ0FXUzo6UGFydGl0aW9uJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAnOnN0YXRlczo6OnNuczpwdWJsaXNoJyxcbiAgICAgICAgICBdLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICAgIEVuZDogdHJ1ZSxcbiAgICAgIFBhcmFtZXRlcnM6IHtcbiAgICAgICAgJ1RvcGljQXJuLiQnOiAnJC50b3BpY0FybicsXG4gICAgICAgICdNZXNzYWdlJzogJ1B1Ymxpc2ggdGhpcyBtZXNzYWdlJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2ZhaWxzIHdoZW4gV0FJVF9GT1JfVEFTS19UT0tFTiBpbnRlZ3JhdGlvbiBwYXR0ZXJuIGlzIHVzZWQgd2l0aG91dCBzdXBwbHlpbmcgYSB0YXNrIHRva2VuIGluIG1lc3NhZ2UnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgICBjb25zdCB0b3BpYyA9IG5ldyBzbnMuVG9waWMoc3RhY2ssICdUb3BpYycpO1xuXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIC8vIFdIRU5cbiAgICAgIG5ldyBTbnNQdWJsaXNoKHN0YWNrLCAnUHVibGlzaCcsIHtcbiAgICAgICAgdG9waWMsXG4gICAgICAgIGludGVncmF0aW9uUGF0dGVybjogc2ZuLkludGVncmF0aW9uUGF0dGVybi5XQUlUX0ZPUl9UQVNLX1RPS0VOLFxuICAgICAgICBtZXNzYWdlOiBzZm4uVGFza0lucHV0LmZyb21UZXh0KCdQdWJsaXNoIHRoaXMgbWVzc2FnZScpLFxuICAgICAgfSk7XG4gICAgICAvLyBUSEVOXG4gICAgfSkudG9UaHJvdygvVGFzayBUb2tlbiBpcyByZXF1aXJlZCBpbiBgbWVzc2FnZWAgVXNlIEpzb25QYXRoLnRhc2tUb2tlbiB0byBzZXQgdGhlIHRva2VuLi8pO1xuICB9KTtcblxuICB0ZXN0KCdmYWlscyB3aGVuIFJVTl9KT0IgaW50ZWdyYXRpb24gcGF0dGVybiBpcyB1c2VkJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgY29uc3QgdG9waWMgPSBuZXcgc25zLlRvcGljKHN0YWNrLCAnVG9waWMnKTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBuZXcgU25zUHVibGlzaChzdGFjaywgJ1B1Ymxpc2gnLCB7XG4gICAgICAgIHRvcGljLFxuICAgICAgICBpbnRlZ3JhdGlvblBhdHRlcm46IHNmbi5JbnRlZ3JhdGlvblBhdHRlcm4uUlVOX0pPQixcbiAgICAgICAgbWVzc2FnZTogc2ZuLlRhc2tJbnB1dC5mcm9tVGV4dCgnUHVibGlzaCB0aGlzIG1lc3NhZ2UnKSxcbiAgICAgIH0pO1xuICAgIH0pLnRvVGhyb3coL1Vuc3VwcG9ydGVkIHNlcnZpY2UgaW50ZWdyYXRpb24gcGF0dGVybi4gU3VwcG9ydGVkIFBhdHRlcm5zOiBSRVFVRVNUX1JFU1BPTlNFLFdBSVRfRk9SX1RBU0tfVE9LRU4uIFJlY2VpdmVkOiBSVU5fSk9CLyk7XG4gIH0pO1xufSk7XG4iXX0=