"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const os = require("os");
const path = require("path");
const lib_1 = require("../lib");
describe('Docker image asset', () => {
    test('valid input', () => {
        expect(() => {
            validate({
                version: lib_1.Manifest.version(),
                dockerImages: {
                    asset: {
                        source: {
                            directory: '.',
                        },
                        destinations: {
                            dest: {
                                region: 'us-north-20',
                                repositoryName: 'REPO',
                                imageTag: 'TAG',
                            },
                        },
                    },
                    externalAsset: {
                        source: {
                            executable: ['sometool'],
                        },
                        destinations: {
                            dest: {
                                region: 'us-north-20',
                                repositoryName: 'REPO',
                                imageTag: 'TAG',
                            },
                        },
                    },
                },
            });
        }).not.toThrow();
    });
    test('invalid input', () => {
        expect(() => {
            validate({
                version: lib_1.Manifest.version(),
                dockerImages: {
                    asset: {
                        source: {
                            directory: true,
                        },
                        destinations: {},
                    },
                    externalAsset: {
                        source: {},
                        destinations: {},
                    },
                },
            });
        }).toThrow(/instance\.dockerImages\.asset\.source\.directory is not of a type\(s\) string/);
    });
});
describe('File asset', () => {
    describe('valid input', () => {
        test('without packaging', () => {
            expect(() => {
                validate({
                    version: lib_1.Manifest.version(),
                    files: {
                        asset: {
                            source: {
                                path: 'a/b/c',
                            },
                            destinations: {
                                dest: {
                                    region: 'us-north-20',
                                    bucketName: 'Bouquet',
                                    objectKey: 'key',
                                },
                            },
                        },
                        externalAsset: {
                            source: {
                                executable: ['sometool'],
                            },
                            destinations: {
                                dest: {
                                    region: 'us-north-20',
                                    bucketName: 'Bouquet',
                                    objectKey: 'key',
                                },
                            },
                        },
                    },
                });
            }).not.toThrow();
        });
        for (const packaging of Object.values(lib_1.FileAssetPackaging)) {
            test(`with "${packaging}" packaging`, () => {
                expect(() => {
                    validate({
                        version: lib_1.Manifest.version(),
                        files: {
                            asset: {
                                source: {
                                    path: 'a/b/c',
                                    packaging,
                                },
                                destinations: {
                                    dest: {
                                        region: 'us-north-20',
                                        bucketName: 'Bouquet',
                                        objectKey: 'key',
                                    },
                                },
                            },
                        },
                    });
                }).not.toThrow();
            });
        }
    });
    describe('invalid input', () => {
        test('bad "source.path" property', () => {
            expect(() => {
                validate({
                    version: lib_1.Manifest.version(),
                    files: {
                        asset: {
                            source: {
                                path: 3,
                            },
                            destinations: {
                                dest: {
                                    region: 'us-north-20',
                                    bucketName: 'Bouquet',
                                    objectKey: 'key',
                                },
                            },
                        },
                        externalAsset: {
                            source: {
                                executable: ['sometool'],
                            },
                            destinations: {
                                dest: {
                                    region: 'us-north-20',
                                    bucketName: 'Bouquet',
                                    objectKey: 'key',
                                },
                            },
                        },
                    },
                });
            }).toThrow(/instance\.files\.asset\.source\.path is not of a type\(s\) string/);
        });
        test('bad "source.packaging" property', () => {
            expect(() => {
                validate({
                    version: lib_1.Manifest.version(),
                    files: {
                        asset: {
                            source: {
                                path: 'a/b/c',
                                packaging: 'BLACK_HOLE',
                            },
                            destinations: {
                                dest: {
                                    region: 'us-north-20',
                                    bucketName: 'Bouquet',
                                    objectKey: 'key',
                                },
                            },
                        },
                    },
                });
            }).toThrow(/instance\.files\.asset\.source\.packaging is not one of enum values: file,zip/);
        });
    });
});
function validate(manifest) {
    const dir = fs.mkdtempSync(path.join(os.tmpdir(), 'assets.test.'));
    const filePath = path.join(dir, 'manifest.json');
    fs.writeFileSync(filePath, JSON.stringify(manifest, undefined, 2));
    try {
        lib_1.Manifest.loadAssetManifest(filePath);
    }
    finally {
        fs.unlinkSync(filePath);
        fs.rmdirSync(dir);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXRzLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhc3NldHMudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHlCQUF5QjtBQUN6Qix5QkFBeUI7QUFDekIsNkJBQTZCO0FBQzdCLGdDQUFzRDtBQUV0RCxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO0lBQ2xDLElBQUksQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQ3ZCLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixRQUFRLENBQUM7Z0JBQ1AsT0FBTyxFQUFFLGNBQVEsQ0FBQyxPQUFPLEVBQUU7Z0JBQzNCLFlBQVksRUFBRTtvQkFDWixLQUFLLEVBQUU7d0JBQ0wsTUFBTSxFQUFFOzRCQUNOLFNBQVMsRUFBRSxHQUFHO3lCQUNmO3dCQUNELFlBQVksRUFBRTs0QkFDWixJQUFJLEVBQUU7Z0NBQ0osTUFBTSxFQUFFLGFBQWE7Z0NBQ3JCLGNBQWMsRUFBRSxNQUFNO2dDQUN0QixRQUFRLEVBQUUsS0FBSzs2QkFDaEI7eUJBQ0Y7cUJBQ0Y7b0JBQ0QsYUFBYSxFQUFFO3dCQUNiLE1BQU0sRUFBRTs0QkFDTixVQUFVLEVBQUUsQ0FBQyxVQUFVLENBQUM7eUJBQ3pCO3dCQUNELFlBQVksRUFBRTs0QkFDWixJQUFJLEVBQUU7Z0NBQ0osTUFBTSxFQUFFLGFBQWE7Z0NBQ3JCLGNBQWMsRUFBRSxNQUFNO2dDQUN0QixRQUFRLEVBQUUsS0FBSzs2QkFDaEI7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7YUFDRixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDbkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtRQUN6QixNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsUUFBUSxDQUFDO2dCQUNQLE9BQU8sRUFBRSxjQUFRLENBQUMsT0FBTyxFQUFFO2dCQUMzQixZQUFZLEVB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akQsRUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbkUsSUFBSTtRQUNGLGNBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUN0QztZQUFTO1FBQ1IsRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN4QixFQUFFLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ25CO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIG9zIGZyb20gJ29zJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBGaWxlQXNzZXRQYWNrYWdpbmcsIE1hbmlmZXN0IH0gZnJvbSAnLi4vbGliJztcblxuZGVzY3JpYmUoJ0RvY2tlciBpbWFnZSBhc3NldCcsICgpID0+IHtcbiAgdGVzdCgndmFsaWQgaW5wdXQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIHZhbGlkYXRlKHtcbiAgICAgICAgdmVyc2lvbjogTWFuaWZlc3QudmVyc2lvbigpLFxuICAgICAgICBkb2NrZXJJbWFnZXM6IHtcbiAgICAgICAgICBhc3NldDoge1xuICAgICAgICAgICAgc291cmNlOiB7XG4gICAgICAgICAgICAgIGRpcmVjdG9yeTogJy4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uczoge1xuICAgICAgICAgICAgICBkZXN0OiB7XG4gICAgICAgICAgICAgICAgcmVnaW9uOiAndXMtbm9ydGgtMjAnLFxuICAgICAgICAgICAgICAgIHJlcG9zaXRvcnlOYW1lOiAnUkVQTycsXG4gICAgICAgICAgICAgICAgaW1hZ2VUYWc6ICdUQUcnLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGV4dGVybmFsQXNzZXQ6IHtcbiAgICAgICAgICAgIHNvdXJjZToge1xuICAgICAgICAgICAgICBleGVjdXRhYmxlOiBbJ3NvbWV0b29sJ10sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVzdGluYXRpb25zOiB7XG4gICAgICAgICAgICAgIGRlc3Q6IHtcbiAgICAgICAgICAgICAgICByZWdpb246ICd1cy1ub3J0aC0yMCcsXG4gICAgICAgICAgICAgICAgcmVwb3NpdG9yeU5hbWU6ICdSRVBPJyxcbiAgICAgICAgICAgICAgICBpbWFnZVRhZzogJ1RBRycsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KS5ub3QudG9UaHJvdygpO1xuICB9KTtcblxuICB0ZXN0KCdpbnZhbGlkIGlucHV0JywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICB2YWxpZGF0ZSh7XG4gICAgICAgIHZlcnNpb246IE1hbmlmZXN0LnZlcnNpb24oKSxcbiAgICAgICAgZG9ja2VySW1hZ2VzOiB7XG4gICAgICAgICAgYXNzZXQ6IHtcbiAgICAgICAgICAgIHNvdXJjZToge1xuICAgICAgICAgICAgICBkaXJlY3Rvcnk6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVzdGluYXRpb25zOiB7fSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGV4dGVybmFsQXNzZXQ6IHtcbiAgICAgICAgICAgIHNvdXJjZToge30sXG4gICAgICAgICAgICBkZXN0aW5hdGlvbnM6IHt9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KS50b1Rocm93KC9pbnN0YW5jZVxcLmRvY2tlckltYWdlc1xcLmFzc2V0XFwuc291cmNlXFwuZGlyZWN0b3J5IGlzIG5vdCBvZiBhIHR5cGVcXChzXFwpIHN0cmluZy8pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnRmlsZSBhc3NldCcsICgpID0+IHtcbiAgZGVzY3JpYmUoJ3ZhbGlkIGlucHV0JywgKCkgPT4ge1xuICAgIHRlc3QoJ3dpdGhvdXQgcGFja2FnaW5nJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgdmFsaWRhdGUoe1xuICAgICAgICAgIHZlcnNpb246IE1hbmlmZXN0LnZlcnNpb24oKSxcbiAgICAgICAgICBmaWxlczoge1xuICAgICAgICAgICAgYXNzZXQ6IHtcbiAgICAgICAgICAgICAgc291cmNlOiB7XG4gICAgICAgICAgICAgICAgcGF0aDogJ2EvYi9jJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZGVzdGluYXRpb25zOiB7XG4gICAgICAgICAgICAgICAgZGVzdDoge1xuICAgICAgICAgICAgICAgICAgcmVnaW9uOiAndXMtbm9ydGgtMjAnLFxuICAgICAgICAgICAgICAgICAgYnVja2V0TmFtZTogJ0JvdXF1ZXQnLFxuICAgICAgICAgICAgICAgICAgb2JqZWN0S2V5OiAna2V5JyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGV4dGVybmFsQXNzZXQ6IHtcbiAgICAgICAgICAgICAgc291cmNlOiB7XG4gICAgICAgICAgICAgICAgZXhlY3V0YWJsZTogWydzb21ldG9vbCddLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBkZXN0aW5hdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBkZXN0OiB7XG4gICAgICAgICAgICAgICAgICByZWdpb246ICd1cy1ub3J0aC0yMCcsXG4gICAgICAgICAgICAgICAgICBidWNrZXROYW1lOiAnQm91cXVldCcsXG4gICAgICAgICAgICAgICAgICBvYmplY3RLZXk6ICdrZXknLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSkubm90LnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGZvciAoY29uc3QgcGFja2FnaW5nIG9mIE9iamVjdC52YWx1ZXMoRmlsZUFzc2V0UGFja2FnaW5nKSkge1xuICAgICAgdGVzdChgd2l0aCBcIiR7cGFja2FnaW5nfVwiIHBhY2thZ2luZ2AsICgpID0+IHtcbiAgICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgICB2YWxpZGF0ZSh7XG4gICAgICAgICAgICB2ZXJzaW9uOiBNYW5pZmVzdC52ZXJzaW9uKCksXG4gICAgICAgICAgICBmaWxlczoge1xuICAgICAgICAgICAgICBhc3NldDoge1xuICAgICAgICAgICAgICAgIHNvdXJjZToge1xuICAgICAgICAgICAgICAgICAgcGF0aDogJ2EvYi9jJyxcbiAgICAgICAgICAgICAgICAgIHBhY2thZ2luZyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uczoge1xuICAgICAgICAgICAgICAgICAgZGVzdDoge1xuICAgICAgICAgICAgICAgICAgICByZWdpb246ICd1cy1ub3J0aC0yMCcsXG4gICAgICAgICAgICAgICAgICAgIGJ1Y2tldE5hbWU6ICdCb3VxdWV0JyxcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0S2V5OiAna2V5JyxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pLm5vdC50b1Rocm93KCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnZhbGlkIGlucHV0JywgKCkgPT4ge1xuICAgIHRlc3QoJ2JhZCBcInNvdXJjZS5wYXRoXCIgcHJvcGVydHknLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICB2YWxpZGF0ZSh7XG4gICAgICAgICAgdmVyc2lvbjogTWFuaWZlc3QudmVyc2lvbigpLFxuICAgICAgICAgIGZpbGVzOiB7XG4gICAgICAgICAgICBhc3NldDoge1xuICAgICAgICAgICAgICBzb3VyY2U6IHtcbiAgICAgICAgICAgICAgICBwYXRoOiAzLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBkZXN0aW5hdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBkZXN0OiB7XG4gICAgICAgICAgICAgICAgICByZWdpb246ICd1cy1ub3J0aC0yMCcsXG4gICAgICAgICAgICAgICAgICBidWNrZXROYW1lOiAnQm91cXVldCcsXG4gICAgICAgICAgICAgICAgICBvYmplY3RLZXk6ICdrZXknLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXh0ZXJuYWxBc3NldDoge1xuICAgICAgICAgICAgICBzb3VyY2U6IHtcbiAgICAgICAgICAgICAgICBleGVjdXRhYmxlOiBbJ3NvbWV0b29sJ10sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGRlc3RpbmF0aW9uczoge1xuICAgICAgICAgICAgICAgIGRlc3Q6IHtcbiAgICAgICAgICAgICAgICAgIHJlZ2lvbjogJ3VzLW5vcnRoLTIwJyxcbiAgICAgICAgICAgICAgICAgIGJ1Y2tldE5hbWU6ICdCb3VxdWV0JyxcbiAgICAgICAgICAgICAgICAgIG9iamVjdEtleTogJ2tleScsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KS50b1Rocm93KC9pbnN0YW5jZVxcLmZpbGVzXFwuYXNzZXRcXC5zb3VyY2VcXC5wYXRoIGlzIG5vdCBvZiBhIHR5cGVcXChzXFwpIHN0cmluZy8pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnYmFkIFwic291cmNlLnBhY2thZ2luZ1wiIHByb3BlcnR5JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgdmFsaWRhdGUoe1xuICAgICAgICAgIHZlcnNpb246IE1hbmlmZXN0LnZlcnNpb24oKSxcbiAgICAgICAgICBmaWxlczoge1xuICAgICAgICAgICAgYXNzZXQ6IHtcbiAgICAgICAgICAgICAgc291cmNlOiB7XG4gICAgICAgICAgICAgICAgcGF0aDogJ2EvYi9jJyxcbiAgICAgICAgICAgICAgICBwYWNrYWdpbmc6ICdCTEFDS19IT0xFJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZGVzdGluYXRpb25zOiB7XG4gICAgICAgICAgICAgICAgZGVzdDoge1xuICAgICAgICAgICAgICAgICAgcmVnaW9uOiAndXMtbm9ydGgtMjAnLFxuICAgICAgICAgICAgICAgICAgYnVja2V0TmFtZTogJ0JvdXF1ZXQnLFxuICAgICAgICAgICAgICAgICAgb2JqZWN0S2V5OiAna2V5JyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pLnRvVGhyb3coL2luc3RhbmNlXFwuZmlsZXNcXC5hc3NldFxcLnNvdXJjZVxcLnBhY2thZ2luZyBpcyBub3Qgb25lIG9mIGVudW0gdmFsdWVzOiBmaWxlLHppcC8pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5mdW5jdGlvbiB2YWxpZGF0ZShtYW5pZmVzdDogYW55KSB7XG4gIGNvbnN0IGRpciA9IGZzLm1rZHRlbXBTeW5jKHBhdGguam9pbihvcy50bXBkaXIoKSwgJ2Fzc2V0cy50ZXN0LicpKTtcbiAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4oZGlyLCAnbWFuaWZlc3QuanNvbicpO1xuICBmcy53cml0ZUZpbGVTeW5jKGZpbGVQYXRoLCBKU09OLnN0cmluZ2lmeShtYW5pZmVzdCwgdW5kZWZpbmVkLCAyKSk7XG4gIHRyeSB7XG4gICAgTWFuaWZlc3QubG9hZEFzc2V0TWFuaWZlc3QoZmlsZVBhdGgpO1xuICB9IGZpbmFsbHkge1xuICAgIGZzLnVubGlua1N5bmMoZmlsZVBhdGgpO1xuICAgIGZzLnJtZGlyU3luYyhkaXIpO1xuICB9XG59XG4iXX0=