"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const assertions_1 = require("../../assertions");
const core = require("../../core");
const cxapi = require("../../cx-api");
const inc = require("../lib");
describe('CDK Include', () => {
    let app;
    let stack;
    beforeEach(() => {
        app = new core.App({ context: { [cxapi.NEW_STYLE_STACK_SYNTHESIS_CONTEXT]: false } });
        stack = new core.Stack(app);
    });
    test('throws a validation exception for a template with a missing required top-level resource property', () => {
        expect(() => {
            includeTestTemplate(stack, 'bucket-policy-without-bucket.json');
        }).toThrow(/missing required property: bucket/);
    });
    test('throws a validation exception for a template with a resource property expecting an array assigned the wrong type', () => {
        includeTestTemplate(stack, 'bucket-with-cors-rules-not-an-array.json');
        expect(() => {
            app.synth();
        }).toThrow(/corsRules: "CorsRules!" should be a list/);
    });
    test('throws a validation exception for a template with a null array element of a complex type with required fields', () => {
        includeTestTemplate(stack, 'bucket-with-cors-rules-null-element.json');
        expect(() => {
            app.synth();
        }).toThrow(/allowedMethods: required but missing/);
    });
    test('throws a validation exception for a template with a missing nested resource property', () => {
        includeTestTemplate(stack, 'bucket-with-invalid-cors-rule.json');
        expect(() => {
            app.synth();
        }).toThrow(/allowedOrigins: required but missing/);
    });
    test("throws a validation exception for a template with a DependsOn that doesn't exist", () => {
        expect(() => {
            includeTestTemplate(stack, 'non-existent-depends-on.json');
        }).toThrow(/Resource 'Bucket2' depends on 'Bucket1' that doesn't exist/);
    });
    test("throws a validation exception for a template referencing a Condition in the Conditions section that doesn't exist", () => {
        expect(() => {
            includeTestTemplate(stack, 'non-existent-condition-in-conditions.json');
        }).toThrow(/Referenced Condition with name 'AlwaysFalse' was not found in the template/);
    });
    test('throws a validation exception for a template using Fn::GetAtt in the Conditions section', () => {
        expect(() => {
            includeTestTemplate(stack, 'getatt-in-conditions.json');
        }).toThrow(/Using GetAtt in Condition definitions is not allowed/);
    });
    test("throws a validation exception for a template referencing a Condition resource attribute that doesn't exist", () => {
        expect(() => {
            includeTestTemplate(stack, 'non-existent-condition.json');
        }).toThrow(/Resource 'Bucket' uses Condition 'AlwaysFalseCond' that doesn't exist/);
    });
    test("throws a validation exception for a template referencing a Condition in an If expression that doesn't exist", () => {
        expect(() => {
            includeTestTemplate(stack, 'non-existent-condition-in-if.json');
        }).toThrow(/Condition 'AlwaysFalse' used in an Fn::If expression does not exist in the template/);
    });
    test("throws an exception when encountering a CFN function it doesn't support", () => {
        expect(() => {
            includeTestTemplate(stack, 'only-codecommit-repo-using-cfn-functions.json');
        }).toThrow(/Unsupported CloudFormation function 'Fn::ValueOfAll'/);
    });
    test('parses even the unrecognized attributes of resources', () => {
        expect(() => {
            includeTestTemplate(stack, 'non-existent-resource-attribute.json');
        }).toThrow(/Element used in Ref expression with logical ID: 'NonExistentResource' not found/);
    });
    test("throws a validation exception when encountering a Ref-erence to a template element that doesn't exist", () => {
        expect(() => {
            includeTestTemplate(stack, 'ref-ing-a-non-existent-element.json');
        }).toThrow(/Element used in Ref expression with logical ID: 'DoesNotExist' not found/);
    });
    test("throws a validation exception when encountering a GetAtt reference to a resource that doesn't exist", () => {
        expect(() => {
            includeTestTemplate(stack, 'getting-attribute-of-a-non-existent-resource.json');
        }).toThrow(/Resource used in GetAtt expression with logical ID: 'DoesNotExist' not found/);
    });
    test("throws a validation exception when an Output references a Condition that doesn't exist", () => {
        expect(() => {
            includeTestTemplate(stack, 'output-referencing-nonexistant-condition.json');
        }).toThrow(/Output with name 'SomeOutput' refers to a Condition with name 'NonexistantCondition' which was not found in this template/);
    });
    test("throws a validation exception when a Resource property references a Mapping that doesn't exist", () => {
        expect(() => {
            includeTestTemplate(stack, 'non-existent-mapping.json');
        }).toThrow(/Mapping used in FindInMap expression with name 'NonExistentMapping' was not found in the template/);
    });
    test("throws a validation exception when a Rule references a Parameter that isn't in the template", () => {
        expect(() => {
            includeTestTemplate(stack, 'rule-referencing-a-non-existent-parameter.json');
        }).toThrow(/Rule references parameter 'Subnets' which was not found in the template/);
    });
    test("throws a validation exception when Fn::Sub in string form uses a key that isn't in the template", () => {
        expect(() => {
            includeTestTemplate(stack, 'fn-sub-key-not-in-template-string.json');
        }).toThrow(/Element referenced in Fn::Sub expression with logical ID: 'AFakeResource' was not found in the template/);
    });
    test('throws a validation exception when Fn::Sub has an empty ${} reference', () => {
        expect(() => {
            includeTestTemplate(stack, 'fn-sub-${}-only.json');
        }).toThrow(/Element referenced in Fn::Sub expression with logical ID: '' was not found in the template/);
    });
    test("throws an exception for a template with a non-number string passed to a property with type 'number'", () => {
        includeTestTemplate(stack, 'alphabetical-string-passed-to-number.json');
        expect(() => {
            app.synth();
        }).toThrow(/"abc" should be a number/);
    });
    test('throws an exception for a template with a short-form Fn::GetAtt whose string argument does not contain a dot', () => {
        expect(() => {
            includeTestTemplate(stack, 'short-form-get-att-no-dot.yaml');
        }).toThrow(/Short-form Fn::GetAtt must contain a '.' in its string argument, got: 'Bucket1Arn'/);
    });
    /**
     * A->B
     * B->A
     * simplified version of cycle-in-resources.json, an example of cyclical references
     */
    test('by default does not accept a cycle between resources in the template', () => {
        expect(() => {
            includeTestTemplate(stack, 'cycle-in-resources.json');
        }).toThrow(/Found a cycle between resources in the template: Bucket1 depends on Bucket2 depends on Bucket1/);
    });
    /**
     * A->B
     * B->C
     * C->{D,A}
     * D->B
     * simplified version of multi-cycle-in-resources.json, an example of multiple cyclical references
     */
    test('by default does not accept multiple cycles between resources in the template', () => {
        expect(() => {
            includeTestTemplate(stack, 'multi-cycle-in-resources.json');
        }).toThrow(/Found a cycle between resources in the template: Bucket1 depends on Bucket2 depends on Bucket3 depends on Bucket4 depends on Bucket2/);
    });
    /**
     * A->B
     * B->{C,A}
     * C->A
     * simplified version of multi-cycle-multi-dest-in-resources.json, an example of multiple cyclical references that
     * include visiting the same destination more than once
     */
    test('by default does not accept multiple cycles and multiple destinations between resources in the template', () => {
        expect(() => {
            includeTestTemplate(stack, 'multi-cycle-multi-dest-in-resources.json');
        }).toThrow(/Found a cycle between resources in the template: Bucket1 depends on Bucket2 depends on Bucket3 depends on Bucket1/);
    });
    /**
     * A->B
     * B->A
     * simplified version of cycle-in-resources.json, an example of cyclical references
     */
    test('accepts a cycle between resources in the template if allowed', () => {
        includeTestTemplate(stack, 'cycle-in-resources.json', { allowCyclicalReferences: true });
        assertions_1.Template.fromStack(stack, { skipCyclicalDependenciesCheck: true }).templateMatches({
            Resources: {
                Bucket2: { Type: 'AWS::S3::Bucket', DependsOn: ['Bucket1'] },
                Bucket1: {
                    Type: 'AWS::S3::Bucket',
                    Properties: { BucketName: { Ref: 'Bucket2' } },
                },
            },
        });
    });
    /**
     * A->B
     * B->C
     * C->{D,A}
     * D->B
     * simplified version of multi-cycle-in-resources.json, an example of multiple cyclical references
     */
    test('accepts multiple cycles between resources in the template if allowed', () => {
        includeTestTemplate(stack, 'multi-cycle-in-resources.json', { allowCyclicalReferences: true });
        assertions_1.Template.fromStack(stack, { skipCyclicalDependenciesCheck: true }).templateMatches({
            Resources: {
                Bucket2: { Type: 'AWS::S3::Bucket', DependsOn: ['Bucket3'] },
                Bucket3: { Type: 'AWS::S3::Bucket', DependsOn: ['Bucket4', 'Bucket1'] },
                Bucket4: { Type: 'AWS::S3::Bucket', DependsOn: ['Bucket2'] },
                Bucket1: {
                    Type: 'AWS::S3::Bucket',
                    Properties: { BucketName: { Ref: 'Bucket2' } },
                },
            },
        });
    });
    /**
     * A->B
     * B->{C,A}
     * C->A
     * simplified version of multi-cycle-multi-dest-in-resources.json, an example of multiple cyclical references that
     * include visiting the same destination more than once
     */
    test('accepts multiple cycles and multiple destinations between resources in the template if allowed', () => {
        includeTestTemplate(stack, 'multi-cycle-multi-dest-in-resources.json', { allowCyclicalReferences: true });
        assertions_1.Template.fromStack(stack, { skipCyclicalDependenciesCheck: true }).templateMatches({
            Resources: {
                Bucket2: { Type: 'AWS::S3::Bucket', DependsOn: ['Bucket3', 'Bucket1'] },
                Bucket3: { Type: 'AWS::S3::Bucket', DependsOn: ['Bucket1'] },
                Bucket1: {
                    Type: 'AWS::S3::Bucket',
                    Properties: { BucketName: { Ref: 'Bucket2' } },
                },
            },
        });
    });
});
function includeTestTemplate(scope, testTemplate, props = {}) {
    return new inc.CfnInclude(scope, 'MyScope', {
        templateFile: _testTemplateFilePath(testTemplate),
        allowCyclicalReferences: props.allowCyclicalReferences,
    });
}
function _testTemplateFilePath(testTemplate) {
    return path.join(__dirname, 'test-templates', 'invalid', testTemplate);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW52YWxpZC10ZW1wbGF0ZXMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImludmFsaWQtdGVtcGxhdGVzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2QkFBNkI7QUFDN0IsaURBQTRDO0FBQzVDLG1DQUFtQztBQUNuQyxzQ0FBc0M7QUFFdEMsOEJBQThCO0FBRTlCLFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO0lBQzNCLElBQUksR0FBYSxDQUFDO0lBQ2xCLElBQUksS0FBaUIsQ0FBQztJQUV0QixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsR0FBRyxHQUFHLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLGlDQUFpQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3RGLEtBQUssR0FBRyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsa0dBQWtHLEVBQUUsR0FBRyxFQUFFO1FBQzVHLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsbUNBQW1DLENBQUMsQ0FBQztRQUNsRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsbUNBQW1DLENBQUMsQ0FBQztJQUNsRCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxrSEFBa0gsRUFBRSxHQUFHLEVBQUU7UUFDNUgsbUJBQW1CLENBQUMsS0FBSyxFQUFFLDBDQUEwQyxDQUFDLENBQUM7UUFFdkUsTUFBTSxDQUFDLEdBQUcsRUFBRTtZQUNWLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNkLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO0lBQ3pELENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLCtHQUErRyxFQUFFLEdBQUcsRUFBRTtRQUN6SCxtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsMENBQTBDLENBQUMsQ0FBQztRQUV2RSxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7SUFDckQsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsc0ZBQXNGLEVBQUUsR0FBRyxFQUFFO1FBQ2hHLG1CQUFtQixDQUFDLEtBQUssRUFBRSxvQ0FBb0MsQ0FBQyxDQUFDO1FBRWpFLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsc0NBQXNDLENBQUMsQ0FBQztJQUNyRCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxrRkFBa0YsRUFBRSxHQUFHLEVBQUU7UUFDNUYsTUFBTSxDQUFDLEdBQUcsRUFBRTtZQUNWLG1CQUFtQixDQUFDLEtBQUssRUFBRSw4QkFBOEIsQ0FBQyxDQUFDO1FBQzdELENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyw0REFBNEQsQ0FBQyxDQUFDO0lBQzNFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLG1IQUFtSCxFQUFFLEdBQUcsRUFBRTtRQUM3SCxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsbUJBQW1CLENBQUMsS0FBSyxFQUFFLDJDQUEyQyxDQUFDLENBQUM7UUFDMUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLDRFQUE0RSxDQUFDLENBQUM7SUFDM0YsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMseUZBQXlGLEVBQUUsR0FBRyxFQUFFO1FBQ25HLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsMkJBQTJCLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsc0RBQXNELENBQUMsQ0FBQztJQUNyRSxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyw0R0FBNEcsRUFBRSxHQUFHLEVBQUU7UUFDdEgsTUFBTSxDQUFDLEdBQUcsRUFBRTtZQUNWLG1CQUFtQixDQUFDLEtBQUssRUFBRSw2QkFBNkIsQ0FBQyxDQUFDO1FBQzVELENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyx1RUFBdUUsQ0FBQyxDQUFDO0lBQ3RGLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLDZHQUE2RyxFQUFFLEdBQUcsRUFBRTtRQUN2SCxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsbUJBQW1CLENBQUMsS0FBSyxFQUFFLG1DQUFtQyxDQUFDLENBQUM7UUFDbEUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLHFGQUFxRixDQUFDLENBQUM7SUFDcEcsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMseUVBQXlFLEVBQUUsR0FBRyxFQUFFO1FBQ25GLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsK0NBQStDLENBQUMsQ0FBQztRQUM5RSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsc0RBQXNELENBQUMsQ0FBQztJQUNyRSxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxzREFBc0QsRUFBRSxHQUFHLEVBQUU7UUFDaEUsTUFBTSxDQUFDLEdBQUcsRUFBRTtZQUNWLG1CQUFtQixDQUFDLEtBQUssRUFBRSxzQ0FBc0MsQ0FBQyxDQUFDO1FBQ3JFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxpRkFBaUYsQ0FBQyxDQUFDO0lBQ2hHLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHVHQUF1RyxFQUFFLEdBQUcsRUFBRTtRQUNqSCxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsbUJBQW1CLENBQUMsS0FBSyxFQUFFLHFDQUFxQyxDQUFDLENBQUM7UUFDcEUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLDBFQUEwRSxDQUFDLENBQUM7SUFDekYsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMscUdBQXFHLEVBQUUsR0FBRyxFQUFFO1FBQy9HLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsbURBQW1ELENBQUMsQ0FBQztRQUNsRixDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsOEVBQThFLENBQUMsQ0FBQztJQUM3RixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyx3RkFBd0YsRUFBRSxHQUFHLEVBQUU7UUFDbEcsTUFBTSxDQUFDLEdBQUcsRUFBRTtZQUNWLG1CQUFtQixDQUFDLEtBQUssRUFBRSwrQ0FBK0MsQ0FBQyxDQUFDO1FBQzlFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQywySEFBMkgsQ0FBQyxDQUFDO0lBQzFJLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLGdHQUFnRyxFQUFFLEdBQUcsRUFBRTtRQUMxRyxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsbUJBQW1CLENBQUMsS0FBSyxFQUFFLDJCQUEyQixDQUFDLENBQUM7UUFDMUQsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLG1HQUFtRyxDQUFDLENBQUM7SUFDbEgsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsNkZBQTZGLEVBQUUsR0FBRyxFQUFFO1FBQ3ZHLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsZ0RBQWdELENBQUMsQ0FBQztRQUMvRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMseUVBQXlFLENBQUMsQ0FBQztJQUN4RixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxpR0FBaUcsRUFBRSxHQUFHLEVBQUU7UUFDM0csTUFBTSxDQUFDLEdBQUcsRUFBRTtZQUNWLG1CQUFtQixDQUFDLEtBQUssRUFBRSx3Q0FBd0MsQ0FBQyxDQUFDO1FBQ3ZFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyx5R0FBeUcsQ0FBQyxDQUFDO0lBQ3hILENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHVFQUF1RSxFQUFFLEdBQUcsRUFBRTtRQUNqRixNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsbUJBQW1CLENBQUMsS0FBSyxFQUFFLHNCQUFzQixDQUFDLENBQUM7UUFDckQsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLDRGQUE0RixDQUFDLENBQUM7SUFDM0csQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMscUdBQXFHLEVBQUUsR0FBRyxFQUFFO1FBQy9HLG1CQUFtQixDQUFDLEtBQUssRUFBRSwyQ0FBMkMsQ0FBQyxDQUFDO1FBRXhFLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsMEJBQTBCLENBQUMsQ0FBQztJQUN6QyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyw4R0FBOEcsRUFBRSxHQUFHLEVBQUU7UUFDeEgsTUFBTSxDQUFDLEdBQUcsRUFBRTtZQUNWLG1CQUFtQixDQUFDLEtBQUssRUFBRSxnQ0FBZ0MsQ0FBQyxDQUFDO1FBQy9ELENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxvRkFBb0YsQ0FBQyxDQUFDO0lBQ25HLENBQUMsQ0FBQyxDQUFDO0lBRUg7Ozs7T0FJRztJQUNILElBQUksQ0FBQyxzRUFBc0UsRUFBRSxHQUFHLEVBQUU7UUFDaEYsTUFBTSxDQUFDLEdBQUcsRUFBRTtZQUNWLG1CQUFtQixDQUFDLEtBQUssRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO1FBQ3hELENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxnR0FBZ0csQ0FBQyxDQUFDO0lBQy9HLENBQUMsQ0FBQyxDQUFDO0lBRUg7Ozs7OztPQU1HO0lBQ0gsSUFBSSxDQUFDLDhFQUE4RSxFQUFFLEdBQUcsRUFBRTtRQUN4RixNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsbUJBQW1CLENBQUMsS0FBSyxFQUFFLCtCQUErQixDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLHNJQUFzSSxDQUFDLENBQUM7SUFDckosQ0FBQyxDQUFDLENBQUM7SUFFSDs7Ozs7O09BTUc7SUFDSCxJQUFJLENBQUMsd0dBQXdHLEVBQUUsR0FBRyxFQUFFO1FBQ2xILE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDVixtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsMENBQTBDLENBQUMsQ0FBQztRQUN6RSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsbUhBQW1ILENBQUMsQ0FBQztJQUNsSSxDQUFDLENBQUMsQ0FBQztJQUVIOzs7O09BSUc7SUFDSCxJQUFJLENBQUMsOERBQThELEVBQUUsR0FBRyxFQUFFO1FBQ3hFLG1CQUFtQixDQUFDLEtBQUssRUFBRSx5QkFBeUIsRUFBRSxFQUFFLHVCQUF1QixFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFDekYscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLEVBQUUsNkJBQTZCLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxlQUFlLENBQ2hGO1lBQ0UsU0FBUyxFQUFFO2dCQUNULE9BQU8sRUFBRSxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsQ0FBQyxTQUFTLENBQUMsRUFBRTtnQkFDNUQsT0FBTyxFQUFFO29CQUNQLElBQUksRUFBRSxpQkFBaUI7b0JBQ3ZCLFVBQVUsRUFBRSxFQUFFLFVBQVUsRUFBRSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsRUFBRTtpQkFDL0M7YUFDRjtTQUNGLENBQ0YsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0lBRUg7Ozs7OztPQU1HO0lBQ0gsSUFBSSxDQUFDLHNFQUFzRSxFQUFFLEdBQUcsRUFBRTtRQUNoRixtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsK0JBQStCLEVBQUUsRUFBRSx1QkFBdUIsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQy9GLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxFQUFFLDZCQUE2QixFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsZUFBZSxDQUNoRjtZQUNFLFNBQVMsRUFBRTtnQkFDVCxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUU7Z0JBQzVELE9BQU8sRUFBRSxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLEVBQUU7Z0JBQ3ZFLE9BQU8sRUFBRSxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsQ0FBQyxTQUFTLENBQUMsRUFBRTtnQkFDNUQsT0FBTyxFQUFFO29CQUNQLElBQUksRUFBRSxpQkFBaUI7b0JBQ3ZCLFVBQVUsRUFBRSxFQUFFLFVBQVUsRUFBRSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsRUFBRTtpQkFDL0M7YUFDRjtTQUNGLENBQ0YsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0lBRUg7Ozs7OztPQU1HO0lBQ0gsSUFBSSxDQUFDLGdHQUFnRyxFQUFFLEdBQUcsRUFBRTtRQUMxRyxtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsMENBQTBDLEVBQUUsRUFBRSx1QkFBdUIsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQzFHLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxFQUFFLDZCQUE2QixFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsZUFBZSxDQUNoRjtZQUNFLFNBQVMsRUFBRTtnQkFDVCxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxFQUFFO2dCQUN2RSxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUU7Z0JBQzVELE9BQU8sRUFBRTtvQkFDUCxJQUFJLEVBQUUsaUJBQWlCO29CQUN2QixVQUFVLEVBQUUsRUFBRSxVQUFVLEVBQUUsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEVBQUU7aUJBQy9DO2FBQ0Y7U0FDRixDQUNGLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBT0gsU0FBUyxtQkFBbUIsQ0FBQyxLQUEyQixFQUFFLFlBQW9CLEVBQUUsUUFBa0MsRUFBRTtJQUNsSCxPQUFPLElBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFO1FBQzFDLFlBQVksRUFBRSxxQkFBcUIsQ0FBQyxZQUFZLENBQUM7UUFDakQsdUJBQXVCLEVBQUUsS0FBSyxDQUFDLHVCQUF1QjtLQUN2RCxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsU0FBUyxxQkFBcUIsQ0FBQyxZQUFvQjtJQUNqRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxZQUFZLENBQUMsQ0FBQztBQUN6RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgKiBhcyBjb3JlIGZyb20gJy4uLy4uL2NvcmUnO1xuaW1wb3J0ICogYXMgY3hhcGkgZnJvbSAnLi4vLi4vY3gtYXBpJztcbmltcG9ydCAqIGFzIGNvbnN0cnVjdHMgZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgKiBhcyBpbmMgZnJvbSAnLi4vbGliJztcblxuZGVzY3JpYmUoJ0NESyBJbmNsdWRlJywgKCkgPT4ge1xuICBsZXQgYXBwOiBjb3JlLkFwcDtcbiAgbGV0IHN0YWNrOiBjb3JlLlN0YWNrO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGFwcCA9IG5ldyBjb3JlLkFwcCh7IGNvbnRleHQ6IHsgW2N4YXBpLk5FV19TVFlMRV9TVEFDS19TWU5USEVTSVNfQ09OVEVYVF06IGZhbHNlIH0gfSk7XG4gICAgc3RhY2sgPSBuZXcgY29yZS5TdGFjayhhcHApO1xuICB9KTtcblxuICB0ZXN0KCd0aHJvd3MgYSB2YWxpZGF0aW9uIGV4Y2VwdGlvbiBmb3IgYSB0ZW1wbGF0ZSB3aXRoIGEgbWlzc2luZyByZXF1aXJlZCB0b3AtbGV2ZWwgcmVzb3VyY2UgcHJvcGVydHknLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdidWNrZXQtcG9saWN5LXdpdGhvdXQtYnVja2V0Lmpzb24nKTtcbiAgICB9KS50b1Rocm93KC9taXNzaW5nIHJlcXVpcmVkIHByb3BlcnR5OiBidWNrZXQvKTtcbiAgfSk7XG5cbiAgdGVzdCgndGhyb3dzIGEgdmFsaWRhdGlvbiBleGNlcHRpb24gZm9yIGEgdGVtcGxhdGUgd2l0aCBhIHJlc291cmNlIHByb3BlcnR5IGV4cGVjdGluZyBhbiBhcnJheSBhc3NpZ25lZCB0aGUgd3JvbmcgdHlwZScsICgpID0+IHtcbiAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnYnVja2V0LXdpdGgtY29ycy1ydWxlcy1ub3QtYW4tYXJyYXkuanNvbicpO1xuXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGFwcC5zeW50aCgpO1xuICAgIH0pLnRvVGhyb3coL2NvcnNSdWxlczogXCJDb3JzUnVsZXMhXCIgc2hvdWxkIGJlIGEgbGlzdC8pO1xuICB9KTtcblxuICB0ZXN0KCd0aHJvd3MgYSB2YWxpZGF0aW9uIGV4Y2VwdGlvbiBmb3IgYSB0ZW1wbGF0ZSB3aXRoIGEgbnVsbCBhcnJheSBlbGVtZW50IG9mIGEgY29tcGxleCB0eXBlIHdpdGggcmVxdWlyZWQgZmllbGRzJywgKCkgPT4ge1xuICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdidWNrZXQtd2l0aC1jb3JzLXJ1bGVzLW51bGwtZWxlbWVudC5qc29uJyk7XG5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgYXBwLnN5bnRoKCk7XG4gICAgfSkudG9UaHJvdygvYWxsb3dlZE1ldGhvZHM6IHJlcXVpcmVkIGJ1dCBtaXNzaW5nLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Rocm93cyBhIHZhbGlkYXRpb24gZXhjZXB0aW9uIGZvciBhIHRlbXBsYXRlIHdpdGggYSBtaXNzaW5nIG5lc3RlZCByZXNvdXJjZSBwcm9wZXJ0eScsICgpID0+IHtcbiAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnYnVja2V0LXdpdGgtaW52YWxpZC1jb3JzLXJ1bGUuanNvbicpO1xuXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGFwcC5zeW50aCgpO1xuICAgIH0pLnRvVGhyb3coL2FsbG93ZWRPcmlnaW5zOiByZXF1aXJlZCBidXQgbWlzc2luZy8pO1xuICB9KTtcblxuICB0ZXN0KFwidGhyb3dzIGEgdmFsaWRhdGlvbiBleGNlcHRpb24gZm9yIGEgdGVtcGxhdGUgd2l0aCBhIERlcGVuZHNPbiB0aGF0IGRvZXNuJ3QgZXhpc3RcIiwgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnbm9uLWV4aXN0ZW50LWRlcGVuZHMtb24uanNvbicpO1xuICAgIH0pLnRvVGhyb3coL1Jlc291cmNlICdCdWNrZXQyJyBkZXBlbmRzIG9uICdCdWNrZXQxJyB0aGF0IGRvZXNuJ3QgZXhpc3QvKTtcbiAgfSk7XG5cbiAgdGVzdChcInRocm93cyBhIHZhbGlkYXRpb24gZXhjZXB0aW9uIGZvciBhIHRlbXBsYXRlIHJlZmVyZW5jaW5nIGEgQ29uZGl0aW9uIGluIHRoZSBDb25kaXRpb25zIHNlY3Rpb24gdGhhdCBkb2Vzbid0IGV4aXN0XCIsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ25vbi1leGlzdGVudC1jb25kaXRpb24taW4tY29uZGl0aW9ucy5qc29uJyk7XG4gICAgfSkudG9UaHJvdygvUmVmZXJlbmNlZCBDb25kaXRpb24gd2l0aCBuYW1lICdBbHdheXNGYWxzZScgd2FzIG5vdCBmb3VuZCBpbiB0aGUgdGVtcGxhdGUvKTtcbiAgfSk7XG5cbiAgdGVzdCgndGhyb3dzIGEgdmFsaWRhdGlvbiBleGNlcHRpb24gZm9yIGEgdGVtcGxhdGUgdXNpbmcgRm46OkdldEF0dCBpbiB0aGUgQ29uZGl0aW9ucyBzZWN0aW9uJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnZ2V0YXR0LWluLWNvbmRpdGlvbnMuanNvbicpO1xuICAgIH0pLnRvVGhyb3coL1VzaW5nIEdldEF0dCBpbiBDb25kaXRpb24gZGVmaW5pdGlvbnMgaXMgbm90IGFsbG93ZWQvKTtcbiAgfSk7XG5cbiAgdGVzdChcInRocm93cyBhIHZhbGlkYXRpb24gZXhjZXB0aW9uIGZvciBhIHRlbXBsYXRlIHJlZmVyZW5jaW5nIGEgQ29uZGl0aW9uIHJlc291cmNlIGF0dHJpYnV0ZSB0aGF0IGRvZXNuJ3QgZXhpc3RcIiwgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnbm9uLWV4aXN0ZW50LWNvbmRpdGlvbi5qc29uJyk7XG4gICAgfSkudG9UaHJvdygvUmVzb3VyY2UgJ0J1Y2tldCcgdXNlcyBDb25kaXRpb24gJ0Fsd2F5c0ZhbHNlQ29uZCcgdGhhdCBkb2Vzbid0IGV4aXN0Lyk7XG4gIH0pO1xuXG4gIHRlc3QoXCJ0aHJvd3MgYSB2YWxpZGF0aW9uIGV4Y2VwdGlvbiBmb3IgYSB0ZW1wbGF0ZSByZWZlcmVuY2luZyBhIENvbmRpdGlvbiBpbiBhbiBJZiBleHByZXNzaW9uIHRoYXQgZG9lc24ndCBleGlzdFwiLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdub24tZXhpc3RlbnQtY29uZGl0aW9uLWluLWlmLmpzb24nKTtcbiAgICB9KS50b1Rocm93KC9Db25kaXRpb24gJ0Fsd2F5c0ZhbHNlJyB1c2VkIGluIGFuIEZuOjpJZiBleHByZXNzaW9uIGRvZXMgbm90IGV4aXN0IGluIHRoZSB0ZW1wbGF0ZS8pO1xuICB9KTtcblxuICB0ZXN0KFwidGhyb3dzIGFuIGV4Y2VwdGlvbiB3aGVuIGVuY291bnRlcmluZyBhIENGTiBmdW5jdGlvbiBpdCBkb2Vzbid0IHN1cHBvcnRcIiwgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnb25seS1jb2RlY29tbWl0LXJlcG8tdXNpbmctY2ZuLWZ1bmN0aW9ucy5qc29uJyk7XG4gICAgfSkudG9UaHJvdygvVW5zdXBwb3J0ZWQgQ2xvdWRGb3JtYXRpb24gZnVuY3Rpb24gJ0ZuOjpWYWx1ZU9mQWxsJy8pO1xuICB9KTtcblxuICB0ZXN0KCdwYXJzZXMgZXZlbiB0aGUgdW5yZWNvZ25pemVkIGF0dHJpYnV0ZXMgb2YgcmVzb3VyY2VzJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnbm9uLWV4aXN0ZW50LXJlc291cmNlLWF0dHJpYnV0ZS5qc29uJyk7XG4gICAgfSkudG9UaHJvdygvRWxlbWVudCB1c2VkIGluIFJlZiBleHByZXNzaW9uIHdpdGggbG9naWNhbCBJRDogJ05vbkV4aXN0ZW50UmVzb3VyY2UnIG5vdCBmb3VuZC8pO1xuICB9KTtcblxuICB0ZXN0KFwidGhyb3dzIGEgdmFsaWRhdGlvbiBleGNlcHRpb24gd2hlbiBlbmNvdW50ZXJpbmcgYSBSZWYtZXJlbmNlIHRvIGEgdGVtcGxhdGUgZWxlbWVudCB0aGF0IGRvZXNuJ3QgZXhpc3RcIiwgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAncmVmLWluZy1hLW5vbi1leGlzdGVudC1lbGVtZW50Lmpzb24nKTtcbiAgICB9KS50b1Rocm93KC9FbGVtZW50IHVzZWQgaW4gUmVmIGV4cHJlc3Npb24gd2l0aCBsb2dpY2FsIElEOiAnRG9lc05vdEV4aXN0JyBub3QgZm91bmQvKTtcbiAgfSk7XG5cbiAgdGVzdChcInRocm93cyBhIHZhbGlkYXRpb24gZXhjZXB0aW9uIHdoZW4gZW5jb3VudGVyaW5nIGEgR2V0QXR0IHJlZmVyZW5jZSB0byBhIHJlc291cmNlIHRoYXQgZG9lc24ndCBleGlzdFwiLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdnZXR0aW5nLWF0dHJpYnV0ZS1vZi1hLW5vbi1leGlzdGVudC1yZXNvdXJjZS5qc29uJyk7XG4gICAgfSkudG9UaHJvdygvUmVzb3VyY2UgdXNlZCBpbiBHZXRBdHQgZXhwcmVzc2lvbiB3aXRoIGxvZ2ljYWwgSUQ6ICdEb2VzTm90RXhpc3QnIG5vdCBmb3VuZC8pO1xuICB9KTtcblxuICB0ZXN0KFwidGhyb3dzIGEgdmFsaWRhdGlvbiBleGNlcHRpb24gd2hlbiBhbiBPdXRwdXQgcmVmZXJlbmNlcyBhIENvbmRpdGlvbiB0aGF0IGRvZXNuJ3QgZXhpc3RcIiwgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnb3V0cHV0LXJlZmVyZW5jaW5nLW5vbmV4aXN0YW50LWNvbmRpdGlvbi5qc29uJyk7XG4gICAgfSkudG9UaHJvdygvT3V0cHV0IHdpdGggbmFtZSAnU29tZU91dHB1dCcgcmVmZXJzIHRvIGEgQ29uZGl0aW9uIHdpdGggbmFtZSAnTm9uZXhpc3RhbnRDb25kaXRpb24nIHdoaWNoIHdhcyBub3QgZm91bmQgaW4gdGhpcyB0ZW1wbGF0ZS8pO1xuICB9KTtcblxuICB0ZXN0KFwidGhyb3dzIGEgdmFsaWRhdGlvbiBleGNlcHRpb24gd2hlbiBhIFJlc291cmNlIHByb3BlcnR5IHJlZmVyZW5jZXMgYSBNYXBwaW5nIHRoYXQgZG9lc24ndCBleGlzdFwiLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdub24tZXhpc3RlbnQtbWFwcGluZy5qc29uJyk7XG4gICAgfSkudG9UaHJvdygvTWFwcGluZyB1c2VkIGluIEZpbmRJbk1hcCBleHByZXNzaW9uIHdpdGggbmFtZSAnTm9uRXhpc3RlbnRNYXBwaW5nJyB3YXMgbm90IGZvdW5kIGluIHRoZSB0ZW1wbGF0ZS8pO1xuICB9KTtcblxuICB0ZXN0KFwidGhyb3dzIGEgdmFsaWRhdGlvbiBleGNlcHRpb24gd2hlbiBhIFJ1bGUgcmVmZXJlbmNlcyBhIFBhcmFtZXRlciB0aGF0IGlzbid0IGluIHRoZSB0ZW1wbGF0ZVwiLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdydWxlLXJlZmVyZW5jaW5nLWEtbm9uLWV4aXN0ZW50LXBhcmFtZXRlci5qc29uJyk7XG4gICAgfSkudG9UaHJvdygvUnVsZSByZWZlcmVuY2VzIHBhcmFtZXRlciAnU3VibmV0cycgd2hpY2ggd2FzIG5vdCBmb3VuZCBpbiB0aGUgdGVtcGxhdGUvKTtcbiAgfSk7XG5cbiAgdGVzdChcInRocm93cyBhIHZhbGlkYXRpb24gZXhjZXB0aW9uIHdoZW4gRm46OlN1YiBpbiBzdHJpbmcgZm9ybSB1c2VzIGEga2V5IHRoYXQgaXNuJ3QgaW4gdGhlIHRlbXBsYXRlXCIsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ2ZuLXN1Yi1rZXktbm90LWluLXRlbXBsYXRlLXN0cmluZy5qc29uJyk7XG4gICAgfSkudG9UaHJvdygvRWxlbWVudCByZWZlcmVuY2VkIGluIEZuOjpTdWIgZXhwcmVzc2lvbiB3aXRoIGxvZ2ljYWwgSUQ6ICdBRmFrZVJlc291cmNlJyB3YXMgbm90IGZvdW5kIGluIHRoZSB0ZW1wbGF0ZS8pO1xuICB9KTtcblxuICB0ZXN0KCd0aHJvd3MgYSB2YWxpZGF0aW9uIGV4Y2VwdGlvbiB3aGVuIEZuOjpTdWIgaGFzIGFuIGVtcHR5ICR7fSByZWZlcmVuY2UnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdmbi1zdWItJHt9LW9ubHkuanNvbicpO1xuICAgIH0pLnRvVGhyb3coL0VsZW1lbnQgcmVmZXJlbmNlZCBpbiBGbjo6U3ViIGV4cHJlc3Npb24gd2l0aCBsb2dpY2FsIElEOiAnJyB3YXMgbm90IGZvdW5kIGluIHRoZSB0ZW1wbGF0ZS8pO1xuICB9KTtcblxuICB0ZXN0KFwidGhyb3dzIGFuIGV4Y2VwdGlvbiBmb3IgYSB0ZW1wbGF0ZSB3aXRoIGEgbm9uLW51bWJlciBzdHJpbmcgcGFzc2VkIHRvIGEgcHJvcGVydHkgd2l0aCB0eXBlICdudW1iZXInXCIsICgpID0+IHtcbiAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnYWxwaGFiZXRpY2FsLXN0cmluZy1wYXNzZWQtdG8tbnVtYmVyLmpzb24nKTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBhcHAuc3ludGgoKTtcbiAgICB9KS50b1Rocm93KC9cImFiY1wiIHNob3VsZCBiZSBhIG51bWJlci8pO1xuICB9KTtcblxuICB0ZXN0KCd0aHJvd3MgYW4gZXhjZXB0aW9uIGZvciBhIHRlbXBsYXRlIHdpdGggYSBzaG9ydC1mb3JtIEZuOjpHZXRBdHQgd2hvc2Ugc3RyaW5nIGFyZ3VtZW50IGRvZXMgbm90IGNvbnRhaW4gYSBkb3QnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdzaG9ydC1mb3JtLWdldC1hdHQtbm8tZG90LnlhbWwnKTtcbiAgICB9KS50b1Rocm93KC9TaG9ydC1mb3JtIEZuOjpHZXRBdHQgbXVzdCBjb250YWluIGEgJy4nIGluIGl0cyBzdHJpbmcgYXJndW1lbnQsIGdvdDogJ0J1Y2tldDFBcm4nLyk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBBLT5CXG4gICAqIEItPkFcbiAgICogc2ltcGxpZmllZCB2ZXJzaW9uIG9mIGN5Y2xlLWluLXJlc291cmNlcy5qc29uLCBhbiBleGFtcGxlIG9mIGN5Y2xpY2FsIHJlZmVyZW5jZXNcbiAgICovXG4gIHRlc3QoJ2J5IGRlZmF1bHQgZG9lcyBub3QgYWNjZXB0IGEgY3ljbGUgYmV0d2VlbiByZXNvdXJjZXMgaW4gdGhlIHRlbXBsYXRlJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnY3ljbGUtaW4tcmVzb3VyY2VzLmpzb24nKTtcbiAgICB9KS50b1Rocm93KC9Gb3VuZCBhIGN5Y2xlIGJldHdlZW4gcmVzb3VyY2VzIGluIHRoZSB0ZW1wbGF0ZTogQnVja2V0MSBkZXBlbmRzIG9uIEJ1Y2tldDIgZGVwZW5kcyBvbiBCdWNrZXQxLyk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBBLT5CXG4gICAqIEItPkNcbiAgICogQy0+e0QsQX1cbiAgICogRC0+QlxuICAgKiBzaW1wbGlmaWVkIHZlcnNpb24gb2YgbXVsdGktY3ljbGUtaW4tcmVzb3VyY2VzLmpzb24sIGFuIGV4YW1wbGUgb2YgbXVsdGlwbGUgY3ljbGljYWwgcmVmZXJlbmNlc1xuICAgKi9cbiAgdGVzdCgnYnkgZGVmYXVsdCBkb2VzIG5vdCBhY2NlcHQgbXVsdGlwbGUgY3ljbGVzIGJldHdlZW4gcmVzb3VyY2VzIGluIHRoZSB0ZW1wbGF0ZScsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ211bHRpLWN5Y2xlLWluLXJlc291cmNlcy5qc29uJyk7XG4gICAgfSkudG9UaHJvdygvRm91bmQgYSBjeWNsZSBiZXR3ZWVuIHJlc291cmNlcyBpbiB0aGUgdGVtcGxhdGU6IEJ1Y2tldDEgZGVwZW5kcyBvbiBCdWNrZXQyIGRlcGVuZHMgb24gQnVja2V0MyBkZXBlbmRzIG9uIEJ1Y2tldDQgZGVwZW5kcyBvbiBCdWNrZXQyLyk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBBLT5CXG4gICAqIEItPntDLEF9XG4gICAqIEMtPkFcbiAgICogc2ltcGxpZmllZCB2ZXJzaW9uIG9mIG11bHRpLWN5Y2xlLW11bHRpLWRlc3QtaW4tcmVzb3VyY2VzLmpzb24sIGFuIGV4YW1wbGUgb2YgbXVsdGlwbGUgY3ljbGljYWwgcmVmZXJlbmNlcyB0aGF0XG4gICAqIGluY2x1ZGUgdmlzaXRpbmcgdGhlIHNhbWUgZGVzdGluYXRpb24gbW9yZSB0aGFuIG9uY2VcbiAgICovXG4gIHRlc3QoJ2J5IGRlZmF1bHQgZG9lcyBub3QgYWNjZXB0IG11bHRpcGxlIGN5Y2xlcyBhbmQgbXVsdGlwbGUgZGVzdGluYXRpb25zIGJldHdlZW4gcmVzb3VyY2VzIGluIHRoZSB0ZW1wbGF0ZScsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ211bHRpLWN5Y2xlLW11bHRpLWRlc3QtaW4tcmVzb3VyY2VzLmpzb24nKTtcbiAgICB9KS50b1Rocm93KC9Gb3VuZCBhIGN5Y2xlIGJldHdlZW4gcmVzb3VyY2VzIGluIHRoZSB0ZW1wbGF0ZTogQnVja2V0MSBkZXBlbmRzIG9uIEJ1Y2tldDIgZGVwZW5kcyBvbiBCdWNrZXQzIGRlcGVuZHMgb24gQnVja2V0MS8pO1xuICB9KTtcblxuICAvKipcbiAgICogQS0+QlxuICAgKiBCLT5BXG4gICAqIHNpbXBsaWZpZWQgdmVyc2lvbiBvZiBjeWNsZS1pbi1yZXNvdXJjZXMuanNvbiwgYW4gZXhhbXBsZSBvZiBjeWNsaWNhbCByZWZlcmVuY2VzXG4gICAqL1xuICB0ZXN0KCdhY2NlcHRzIGEgY3ljbGUgYmV0d2VlbiByZXNvdXJjZXMgaW4gdGhlIHRlbXBsYXRlIGlmIGFsbG93ZWQnLCAoKSA9PiB7XG4gICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ2N5Y2xlLWluLXJlc291cmNlcy5qc29uJywgeyBhbGxvd0N5Y2xpY2FsUmVmZXJlbmNlczogdHJ1ZSB9KTtcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2ssIHsgc2tpcEN5Y2xpY2FsRGVwZW5kZW5jaWVzQ2hlY2s6IHRydWUgfSkudGVtcGxhdGVNYXRjaGVzKFxuICAgICAge1xuICAgICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgICBCdWNrZXQyOiB7IFR5cGU6ICdBV1M6OlMzOjpCdWNrZXQnLCBEZXBlbmRzT246IFsnQnVja2V0MSddIH0sXG4gICAgICAgICAgQnVja2V0MToge1xuICAgICAgICAgICAgVHlwZTogJ0FXUzo6UzM6OkJ1Y2tldCcsXG4gICAgICAgICAgICBQcm9wZXJ0aWVzOiB7IEJ1Y2tldE5hbWU6IHsgUmVmOiAnQnVja2V0MicgfSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBBLT5CXG4gICAqIEItPkNcbiAgICogQy0+e0QsQX1cbiAgICogRC0+QlxuICAgKiBzaW1wbGlmaWVkIHZlcnNpb24gb2YgbXVsdGktY3ljbGUtaW4tcmVzb3VyY2VzLmpzb24sIGFuIGV4YW1wbGUgb2YgbXVsdGlwbGUgY3ljbGljYWwgcmVmZXJlbmNlc1xuICAgKi9cbiAgdGVzdCgnYWNjZXB0cyBtdWx0aXBsZSBjeWNsZXMgYmV0d2VlbiByZXNvdXJjZXMgaW4gdGhlIHRlbXBsYXRlIGlmIGFsbG93ZWQnLCAoKSA9PiB7XG4gICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ211bHRpLWN5Y2xlLWluLXJlc291cmNlcy5qc29uJywgeyBhbGxvd0N5Y2xpY2FsUmVmZXJlbmNlczogdHJ1ZSB9KTtcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2ssIHsgc2tpcEN5Y2xpY2FsRGVwZW5kZW5jaWVzQ2hlY2s6IHRydWUgfSkudGVtcGxhdGVNYXRjaGVzKFxuICAgICAge1xuICAgICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgICBCdWNrZXQyOiB7IFR5cGU6ICdBV1M6OlMzOjpCdWNrZXQnLCBEZXBlbmRzT246IFsnQnVja2V0MyddIH0sXG4gICAgICAgICAgQnVja2V0MzogeyBUeXBlOiAnQVdTOjpTMzo6QnVja2V0JywgRGVwZW5kc09uOiBbJ0J1Y2tldDQnLCAnQnVja2V0MSddIH0sXG4gICAgICAgICAgQnVja2V0NDogeyBUeXBlOiAnQVdTOjpTMzo6QnVja2V0JywgRGVwZW5kc09uOiBbJ0J1Y2tldDInXSB9LFxuICAgICAgICAgIEJ1Y2tldDE6IHtcbiAgICAgICAgICAgIFR5cGU6ICdBV1M6OlMzOjpCdWNrZXQnLFxuICAgICAgICAgICAgUHJvcGVydGllczogeyBCdWNrZXROYW1lOiB7IFJlZjogJ0J1Y2tldDInIH0gfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICApO1xuICB9KTtcblxuICAvKipcbiAgICogQS0+QlxuICAgKiBCLT57QyxBfVxuICAgKiBDLT5BXG4gICAqIHNpbXBsaWZpZWQgdmVyc2lvbiBvZiBtdWx0aS1jeWNsZS1tdWx0aS1kZXN0LWluLXJlc291cmNlcy5qc29uLCBhbiBleGFtcGxlIG9mIG11bHRpcGxlIGN5Y2xpY2FsIHJlZmVyZW5jZXMgdGhhdFxuICAgKiBpbmNsdWRlIHZpc2l0aW5nIHRoZSBzYW1lIGRlc3RpbmF0aW9uIG1vcmUgdGhhbiBvbmNlXG4gICAqL1xuICB0ZXN0KCdhY2NlcHRzIG11bHRpcGxlIGN5Y2xlcyBhbmQgbXVsdGlwbGUgZGVzdGluYXRpb25zIGJldHdlZW4gcmVzb3VyY2VzIGluIHRoZSB0ZW1wbGF0ZSBpZiBhbGxvd2VkJywgKCkgPT4ge1xuICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdtdWx0aS1jeWNsZS1tdWx0aS1kZXN0LWluLXJlc291cmNlcy5qc29uJywgeyBhbGxvd0N5Y2xpY2FsUmVmZXJlbmNlczogdHJ1ZSB9KTtcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2ssIHsgc2tpcEN5Y2xpY2FsRGVwZW5kZW5jaWVzQ2hlY2s6IHRydWUgfSkudGVtcGxhdGVNYXRjaGVzKFxuICAgICAge1xuICAgICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgICBCdWNrZXQyOiB7IFR5cGU6ICdBV1M6OlMzOjpCdWNrZXQnLCBEZXBlbmRzT246IFsnQnVja2V0MycsICdCdWNrZXQxJ10gfSxcbiAgICAgICAgICBCdWNrZXQzOiB7IFR5cGU6ICdBV1M6OlMzOjpCdWNrZXQnLCBEZXBlbmRzT246IFsnQnVja2V0MSddIH0sXG4gICAgICAgICAgQnVja2V0MToge1xuICAgICAgICAgICAgVHlwZTogJ0FXUzo6UzM6OkJ1Y2tldCcsXG4gICAgICAgICAgICBQcm9wZXJ0aWVzOiB7IEJ1Y2tldE5hbWU6IHsgUmVmOiAnQnVja2V0MicgfSB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICk7XG4gIH0pO1xufSk7XG5cbmludGVyZmFjZSBJbmNsdWRlVGVzdFRlbXBsYXRlUHJvcHMge1xuICAvKiogQGRlZmF1bHQgZmFsc2UgKi9cbiAgcmVhZG9ubHkgYWxsb3dDeWNsaWNhbFJlZmVyZW5jZXM/OiBib29sZWFuO1xufVxuXG5mdW5jdGlvbiBpbmNsdWRlVGVzdFRlbXBsYXRlKHNjb3BlOiBjb25zdHJ1Y3RzLkNvbnN0cnVjdCwgdGVzdFRlbXBsYXRlOiBzdHJpbmcsIHByb3BzOiBJbmNsdWRlVGVzdFRlbXBsYXRlUHJvcHMgPSB7fSk6IGluYy5DZm5JbmNsdWRlIHtcbiAgcmV0dXJuIG5ldyBpbmMuQ2ZuSW5jbHVkZShzY29wZSwgJ015U2NvcGUnLCB7XG4gICAgdGVtcGxhdGVGaWxlOiBfdGVzdFRlbXBsYXRlRmlsZVBhdGgodGVzdFRlbXBsYXRlKSxcbiAgICBhbGxvd0N5Y2xpY2FsUmVmZXJlbmNlczogcHJvcHMuYWxsb3dDeWNsaWNhbFJlZmVyZW5jZXMsXG4gIH0pO1xufVxuXG5mdW5jdGlvbiBfdGVzdFRlbXBsYXRlRmlsZVBhdGgodGVzdFRlbXBsYXRlOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHBhdGguam9pbihfX2Rpcm5hbWUsICd0ZXN0LXRlbXBsYXRlcycsICdpbnZhbGlkJywgdGVzdFRlbXBsYXRlKTtcbn1cbiJdfQ==