"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const assertions_1 = require("../../assertions");
const core = require("../../core");
const cxapi = require("../../cx-api");
const inc = require("../lib");
const futils = require("../lib/file-utils");
/* eslint-disable quote-props */
/* eslint-disable quotes */
describe('CDK Include for nested stacks', () => {
    let stack;
    beforeEach(() => {
        const app = new core.App({ context: { [cxapi.NEW_STYLE_STACK_SYNTHESIS_CONTEXT]: false } });
        stack = new core.Stack(app);
    });
    test('can ingest a template with one child', () => {
        const parentTemplate = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-one-child.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                },
            },
        });
        const childStack = parentTemplate.getNestedStack('ChildStack');
        assertions_1.Template.fromStack(childStack.stack).templateMatches(loadTestFileToJsObject('grandchild-import-stack.json'));
    });
    test('can ingest a template with two children', () => {
        const parentTemplate = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-two-children.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                },
                'AnotherChildStack': {
                    templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                },
            },
        });
        const childStack = parentTemplate.getNestedStack('ChildStack');
        const anotherChildStack = parentTemplate.getNestedStack('AnotherChildStack');
        assertions_1.Template.fromStack(childStack.stack).templateMatches(loadTestFileToJsObject('grandchild-import-stack.json'));
        assertions_1.Template.fromStack(anotherChildStack.stack).templateMatches(loadTestFileToJsObject('grandchild-import-stack.json'));
    });
    test('can ingest a template with one child and one grandchild', () => {
        const parentTemplate = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-two-children.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('child-import-stack.json'),
                    loadNestedStacks: {
                        'GrandChildStack': {
                            templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                        },
                    },
                },
            },
        });
        const childStack = parentTemplate.getNestedStack('ChildStack');
        const grandChildStack = childStack.includedTemplate.getNestedStack('GrandChildStack');
        assertions_1.Template.fromStack(childStack.stack).templateMatches(loadTestFileToJsObject('child-import-stack.expected.json'));
        assertions_1.Template.fromStack(grandChildStack.stack).templateMatches(loadTestFileToJsObject('grandchild-import-stack.json'));
    });
    test('throws an error when provided a nested stack that is not present in the template', () => {
        expect(() => {
            new inc.CfnInclude(stack, 'ParentStack', {
                templateFile: testTemplateFilePath('parent-two-children.json'),
                loadNestedStacks: {
                    'FakeStack': {
                        templateFile: testTemplateFilePath('child-import-stack.json'),
                    },
                },
            });
        }).toThrow(/Nested Stack with logical ID 'FakeStack' was not found in the template/);
    });
    test('throws an exception when NestedStacks contains an ID that is not a CloudFormation::Stack in the template', () => {
        expect(() => {
            new inc.CfnInclude(stack, 'ParentStack', {
                templateFile: testTemplateFilePath('child-import-stack.json'),
                loadNestedStacks: {
                    'BucketImport': {
                        templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                    },
                },
            });
        }).toThrow(/Nested Stack with logical ID 'BucketImport' is not an AWS::CloudFormation::Stack resource/);
    });
    test('throws an exception when the nestedStack resource uses the CreationPolicy attribute', () => {
        expect(() => {
            new inc.CfnInclude(stack, 'ParentStack', {
                templateFile: testTemplateFilePath('parent-creation-policy.json'),
                loadNestedStacks: {
                    'ChildStack': {
                        templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                    },
                },
            });
        }).toThrow(/CreationPolicy is not supported by the AWS::CloudFormation::Stack resource/);
    });
    test('throws an exception when the nested stack resource uses the UpdatePolicy attribute', () => {
        expect(() => {
            new inc.CfnInclude(stack, 'ParentStack', {
                templateFile: testTemplateFilePath('parent-update-policy.json'),
                loadNestedStacks: {
                    'ChildStack': {
                        templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                    },
                },
            });
        }).toThrow(/UpdatePolicy is not supported by the AWS::CloudFormation::Stack resource/);
    });
    test('throws an exception when a nested stack refers to a Condition that does not exist in the template', () => {
        expect(() => {
            new inc.CfnInclude(stack, 'ParentStack', {
                templateFile: testTemplateFilePath('parent-invalid-condition.json'),
                loadNestedStacks: {
                    'ChildStack': {
                        templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                    },
                },
            });
        }).toThrow(/Resource 'ChildStack' uses Condition 'FakeCondition' that doesn't exist/);
    });
    test('throws an exception when a nested stacks depends on a resource that does not exist in the template', () => {
        expect(() => {
            new inc.CfnInclude(stack, 'ParentStack', {
                templateFile: testTemplateFilePath('parent-bad-depends-on.json'),
                loadNestedStacks: {
                    'ChildStack': {
                        templateFile: testTemplateFilePath('child-import-stack.json'),
                    },
                },
            });
        }).toThrow(/Resource 'ChildStack' depends on 'AFakeResource' that doesn't exist/);
    });
    test('throws an exception when an ID was passed in loadNestedStacks that is a resource type not in the CloudFormation schema', () => {
        expect(() => {
            new inc.CfnInclude(stack, 'Template', {
                templateFile: testTemplateFilePath('custom-resource.json'),
                loadNestedStacks: {
                    'CustomResource': {
                        templateFile: testTemplateFilePath('whatever.json'),
                    },
                },
            });
        }).toThrow(/Nested Stack with logical ID 'CustomResource' is not an AWS::CloudFormation::Stack resource/);
    });
    test('can modify resources in nested stacks', () => {
        const parent = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('child-import-stack.json'),
            loadNestedStacks: {
                'GrandChildStack': {
                    templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                },
            },
        });
        const childTemplate = parent.getNestedStack('GrandChildStack').includedTemplate;
        const bucket = childTemplate.getResource('BucketImport');
        bucket.bucketName = 'modified-bucket-name';
        assertions_1.Template.fromStack(childTemplate.stack).hasResourceProperties('AWS::S3::Bucket', { BucketName: 'modified-bucket-name' });
    });
    test('can use a condition', () => {
        const parent = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-valid-condition.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                },
            },
        });
        const alwaysFalseCondition = parent.getCondition('AlwaysFalseCond');
        expect(parent.getResource('ChildStack').cfnOptions.condition).toBe(alwaysFalseCondition);
    });
    test('asset parameters generated in parent and child are identical', () => {
        new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-one-child.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                },
            },
        });
        const assetParam = 'AssetParameters5dc7d4a99cfe2979687dc74f2db9fd75f253b5505a1912b5ceecf70c9aefba50S3BucketEAA24F0C';
        const assetParamKey = 'AssetParameters5dc7d4a99cfe2979687dc74f2db9fd75f253b5505a1912b5ceecf70c9aefba50S3VersionKey1194CAB2';
        assertions_1.Template.fromStack(stack).templateMatches({
            "Parameters": {
                [assetParam]: {
                    "Type": "String",
                    "Description": "S3 bucket for asset \"5dc7d4a99cfe2979687dc74f2db9fd75f253b5505a1912b5ceecf70c9aefba50\"",
                },
                [assetParamKey]: {
                    "Type": "String",
                    "Description": "S3 key for asset version \"5dc7d4a99cfe2979687dc74f2db9fd75f253b5505a1912b5ceecf70c9aefba50\"",
                },
                "AssetParameters5dc7d4a99cfe2979687dc74f2db9fd75f253b5505a1912b5ceecf70c9aefba50ArtifactHash9C417847": {
                    "Type": "String",
                    "Description": "Artifact hash for asset \"5dc7d4a99cfe2979687dc74f2db9fd75f253b5505a1912b5ceecf70c9aefba50\"",
                },
            },
            "Resources": {
                "ChildStack": {
                    "Type": "AWS::CloudFormation::Stack",
                    "Properties": {
                        "TemplateURL": {
                            "Fn::Join": ["", [
                                    "https://s3.",
                                    { "Ref": "AWS::Region" },
                                    ".",
                                    { "Ref": "AWS::URLSuffix" },
                                    "/",
                                    { "Ref": assetParam },
                                    "/",
                                    {
                                        "Fn::Select": [
                                            0,
                                            {
                                                "Fn::Split": [
                                                    "||",
                                                    { "Ref": assetParamKey },
                                                ],
                                            },
                                        ],
                                    },
                                    {
                                        "Fn::Select": [
                                            1,
                                            {
                                                "Fn::Split": [
                                                    "||",
                                                    { "Ref": assetParamKey },
                                                ],
                                            },
                                        ],
                                    },
                                ]],
                        },
                        "Parameters": {
                            "MyBucketParameter": "some-magic-bucket-name",
                        },
                    },
                },
            },
        });
    });
    test('templates with nested stacks that were not provided in the loadNestedStacks property are left unmodified', () => {
        new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-two-children.json'),
        });
        assertions_1.Template.fromStack(stack).templateMatches(loadTestFileToJsObject('parent-two-children.json'));
    });
    test('getNestedStack() throws an exception when getting a resource that does not exist in the template', () => {
        const parentTemplate = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-two-children.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('child-import-stack.json'),
                },
            },
        });
        expect(() => {
            parentTemplate.getNestedStack('FakeStack');
        }).toThrow(/Nested Stack with logical ID 'FakeStack' was not found/);
    });
    test('getNestedStack() throws an exception when getting a resource that exists in the template, but is not a Stack', () => {
        const parentTemplate = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-two-children.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('child-import-stack.json'),
                },
            },
        });
        const childTemplate = parentTemplate.getNestedStack('ChildStack').includedTemplate;
        expect(() => {
            childTemplate.getNestedStack('BucketImport');
        }).toThrow(/Resource with logical ID 'BucketImport' is not a CloudFormation Stack/);
    });
    test('getNestedStack() throws an exception when getting a nested stack that exists in the template, but was not specified in the props', () => {
        const parentTemplate = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-two-children.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('child-import-stack.json'),
                },
            },
        });
        expect(() => {
            parentTemplate.getNestedStack('AnotherChildStack');
        }).toThrow(/Nested Stack 'AnotherChildStack' was not included in the parent template/);
    });
    test('correctly handles references in nested stacks Parameters', () => {
        new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('cross-stack-refs.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('child-import-stack.json'),
                },
            },
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFormation::Stack', {
            "Parameters": {
                "Param1": {
                    "Ref": "Param",
                },
                "Param2": {
                    "Fn::GetAtt": ["Bucket", "Arn"],
                },
            },
        });
    });
    test('correctly handles renaming of references across nested stacks', () => {
        const parentTemplate = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('cross-stack-refs.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('child-import-stack.json'),
                },
            },
        });
        const cfnBucket = parentTemplate.getResource('Bucket');
        cfnBucket.overrideLogicalId('DifferentBucket');
        const parameter = parentTemplate.getParameter('Param');
        parameter.overrideLogicalId('DifferentParameter');
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFormation::Stack', {
            "Parameters": {
                "Param1": {
                    "Ref": "DifferentParameter",
                },
                "Param2": {
                    "Fn::GetAtt": ["DifferentBucket", "Arn"],
                },
            },
        });
    });
    test('returns the CfnStack object from getResource() for a nested stack that was not in the loadNestedStacks property', () => {
        const cfnTemplate = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-two-children.json'),
        });
        const childStack1 = cfnTemplate.getResource('ChildStack');
        expect(childStack1).toBeInstanceOf(core.CfnStack);
    });
    test('returns the CfnStack object from getResource() for a nested stack that was in the loadNestedStacks property', () => {
        const cfnTemplate = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-one-child.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('child-import-stack.json'),
                },
            },
        });
        const childStack1 = cfnTemplate.getResource('ChildStack');
        expect(childStack1).toBeInstanceOf(core.CfnStack);
    });
    test("handles Metadata, DeletionPolicy, and UpdateReplacePolicy attributes of the nested stack's resource", () => {
        new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-with-attributes.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('child-import-stack.json'),
                },
            },
        });
        assertions_1.Template.fromStack(stack).hasResource('AWS::CloudFormation::Stack', {
            "Metadata": {
                "Property1": "Value1",
            },
            "DeletionPolicy": "Retain",
            "DependsOn": [
                "AnotherChildStack",
            ],
            "UpdateReplacePolicy": "Retain",
        });
    });
    test('correctly parses NotificationsARNs, Timeout', () => {
        new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-with-attributes.json'),
            loadNestedStacks: {
                'ChildStack': {
                    templateFile: testTemplateFilePath('custom-resource.json'),
                },
                'AnotherChildStack': {
                    templateFile: testTemplateFilePath('custom-resource.json'),
                },
            },
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFormation::Stack', {
            "NotificationARNs": ["arn1"],
            "TimeoutInMinutes": 5,
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFormation::Stack', {
            "NotificationARNs": { "Ref": "ArrayParam" },
            "TimeoutInMinutes": {
                "Fn::Select": [0, {
                        "Ref": "ArrayParam",
                    }],
            },
        });
    });
    test('can ingest a NestedStack with a Number CFN Parameter passed as a number', () => {
        new inc.CfnInclude(stack, 'MyScope', {
            templateFile: testTemplateFilePath('parent-number-in-child-params.yaml'),
            loadNestedStacks: {
                'NestedStack': {
                    templateFile: testTemplateFilePath('child-with-number-parameter.yaml'),
                },
            },
        });
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CloudFormation::Stack', {
            "Parameters": {
                "Number": "60",
            },
        });
    });
    test('can lazily include a single child nested stack', () => {
        const parentTemplate = new inc.CfnInclude(stack, 'ParentStack', {
            templateFile: testTemplateFilePath('parent-one-child.json'),
        });
        const includedChild = parentTemplate.loadNestedStack('ChildStack', {
            templateFile: testTemplateFilePath('child-no-bucket.json'),
        });
        assertions_1.Template.fromStack(includedChild.stack).templateMatches(loadTestFileToJsObject('child-no-bucket.json'));
        expect(includedChild.includedTemplate.getResource('GrandChildStack')).toBeDefined();
    });
    describe('for a parent stack with children and grandchildren', () => {
        let assetStack;
        let parentTemplate;
        let child;
        let grandChild;
        let hash1;
        let hash2;
        let parentBucketParam;
        let parentKeyParam;
        let grandChildBucketParam;
        let grandChildKeyParam;
        let childBucketParam;
        let childKeyParam;
        beforeAll(() => {
            const app = new core.App({ context: { [cxapi.NEW_STYLE_STACK_SYNTHESIS_CONTEXT]: false } });
            assetStack = new core.Stack(app);
            parentTemplate = new inc.CfnInclude(assetStack, 'ParentStack', {
                templateFile: testTemplateFilePath('parent-one-child.json'),
                loadNestedStacks: {
                    'ChildStack': {
                        templateFile: testTemplateFilePath('child-no-bucket.json'),
                        loadNestedStacks: {
                            'GrandChildStack': {
                                templateFile: testTemplateFilePath('grandchild-import-stack.json'),
                            },
                        },
                    },
                },
            });
            child = parentTemplate.getNestedStack('ChildStack');
            grandChild = child.includedTemplate.getNestedStack('GrandChildStack');
            hash1 = '5dc7d4a99cfe2979687dc74f2db9fd75f253b5505a1912b5ceecf70c9aefba50';
            hash2 = '7775730164edb5faae717ac1d2e90d9c0d0fdbeafe48763e5c1b7fb5e39e00a5';
            parentBucketParam = `AssetParameters${hash1}S3BucketEAA24F0C`;
            parentKeyParam = `AssetParameters${hash1}S3VersionKey1194CAB2`;
            grandChildBucketParam = `referencetoAssetParameters${hash1}S3BucketEAA24F0CRef`;
            grandChildKeyParam = `referencetoAssetParameters${hash1}S3VersionKey1194CAB2Ref`;
            childBucketParam = `AssetParameters${hash2}S3BucketDEB194C6`;
            childKeyParam = `AssetParameters${hash2}S3VersionKey8B342ED1`;
        });
        test('correctly creates parameters in the parent stack, and passes them to the child stack', () => {
            assertions_1.Template.fromStack(assetStack).templateMatches({
                "Parameters": {
                    [parentBucketParam]: {
                        "Type": "String",
                        "Description": `S3 bucket for asset \"${hash1}\"`,
                    },
                    [parentKeyParam]: {
                        "Type": "String",
                        "Description": `S3 key for asset version \"${hash1}\"`,
                    },
                    [`AssetParameters${hash1}ArtifactHash9C417847`]: {
                        "Type": "String",
                        "Description": `Artifact hash for asset \"${hash1}\"`,
                    },
                    [childBucketParam]: {
                        "Type": "String",
                        "Description": `S3 bucket for asset \"${hash2}\"`,
                    },
                    [childKeyParam]: {
                        "Type": "String",
                        "Description": `S3 key for asset version \"${hash2}\"`,
                    },
                    [`AssetParameters${hash2}ArtifactHashAA82D4CC`]: {
                        "Type": "String",
                        "Description": `Artifact hash for asset \"${hash2}\"`,
                    },
                },
                "Resources": {
                    "ChildStack": {
                        "Type": "AWS::CloudFormation::Stack",
                        "Properties": {
                            "TemplateURL": {
                                "Fn::Join": ["", [
                                        "https://s3.",
                                        { "Ref": "AWS::Region" },
                                        ".",
                                        { "Ref": "AWS::URLSuffix" },
                                        "/",
                                        { "Ref": childBucketParam },
                                        "/",
                                        {
                                            "Fn::Select": [
                                                0,
                                                {
                                                    "Fn::Split": [
                                                        "||",
                                                        { "Ref": childKeyParam },
                                                    ],
                                                },
                                            ],
                                        },
                                        {
                                            "Fn::Select": [
                                                1,
                                                {
                                                    "Fn::Split": [
                                                        "||",
                                                        { "Ref": childKeyParam },
                                                    ],
                                                },
                                            ],
                                        },
                                    ]],
                            },
                            "Parameters": {
                                "MyBucketParameter": "some-magic-bucket-name",
                                [grandChildBucketParam]: {
                                    "Ref": parentBucketParam,
                                },
                                [grandChildKeyParam]: {
                                    "Ref": parentKeyParam,
                                },
                            },
                        },
                    },
                },
            });
        });
        test('correctly creates parameters in the child stack, and passes them to the grandchild stack', () => {
            assertions_1.Template.fromStack(child.stack).templateMatches({
                "Parameters": {
                    "MyBucketParameter": {
                        "Type": "String",
                        "Default": "default-bucket-param-name",
                    },
                    [grandChildBucketParam]: {
                        "Type": "String",
                    },
                    [grandChildKeyParam]: {
                        "Type": "String",
                    },
                },
                "Resources": {
                    "GrandChildStack": {
                        "Type": "AWS::CloudFormation::Stack",
                        "Properties": {
                            "TemplateURL": {
                                "Fn::Join": ["", [
                                        "https://s3.",
                                        { "Ref": "AWS::Region" },
                                        ".",
                                        { "Ref": "AWS::URLSuffix" },
                                        "/",
                                        { "Ref": grandChildBucketParam },
                                        "/",
                                        {
                                            "Fn::Select": [
                                                0,
                                                {
                                                    "Fn::Split": [
                                                        "||",
                                                        { "Ref": grandChildKeyParam },
                                                    ],
                                                },
                                            ],
                                        },
                                        {
                                            "Fn::Select": [
                                                1,
                                                {
                                                    "Fn::Split": [
                                                        "||",
                                                        { "Ref": grandChildKeyParam },
                                                    ],
                                                },
                                            ],
                                        },
                                    ]],
                            },
                            "Parameters": {
                                "MyBucketParameter": "some-other-bucket-name",
                            },
                        },
                    },
                },
            });
        });
        test('leaves grandchild stack unmodified', () => {
            assertions_1.Template.fromStack(grandChild.stack).templateMatches(loadTestFileToJsObject('grandchild-import-stack.json'));
        });
    });
    describe('for a parameter passed to the included child stack', () => {
        let parentStack;
        let childStack;
        beforeAll(() => {
            parentStack = new core.Stack();
            const parentTemplate = new inc.CfnInclude(parentStack, 'ParentStack', {
                templateFile: testTemplateFilePath('parent-two-parameters.json'),
                loadNestedStacks: {
                    'ChildStack': {
                        templateFile: testTemplateFilePath('child-two-parameters.json'),
                        parameters: {
                            'FirstParameter': 'test-value',
                        },
                    },
                },
            });
            childStack = parentTemplate.getNestedStack('ChildStack').stack;
        });
        test('correctly removes the parameter from the child stack', () => {
            assertions_1.Template.fromStack(childStack).templateMatches({
                "Parameters": {
                    "SecondParameter": {
                        "Type": "String",
                    },
                },
                "Resources": {
                    "BucketImport": {
                        "Type": "AWS::S3::Bucket",
                        "Properties": {
                            "BucketName": "test-value",
                            "AccessControl": {
                                "Ref": "SecondParameter",
                            },
                        },
                    },
                    "GrandChildStack": {
                        "Type": "AWS::CloudFormation::Stack",
                        "Properties": {
                            "TemplateURL": "https://cfn-templates-set.s3.amazonaws.com/grandchild-import-stack.json",
                            "Parameters": {
                                "FirstParameter": "test-value",
                            },
                        },
                    },
                },
            });
        });
        test('correctly removes the parameter from the parent stack', () => {
            assertions_1.Template.fromStack(parentStack).hasResourceProperties('AWS::CloudFormation::Stack', {
                "Parameters": {
                    "FirstParameter": assertions_1.Match.absent(),
                    "SecondParameter": "second-value",
                },
            });
        });
    });
});
function loadTestFileToJsObject(testTemplate) {
    return futils.readJsonSync(testTemplateFilePath(testTemplate));
}
function testTemplateFilePath(testTemplate) {
    return path.join(__dirname, 'test-templates/nested', testTemplate);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmVzdGVkLXN0YWNrcy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibmVzdGVkLXN0YWNrcy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsNkJBQTZCO0FBQzdCLGlEQUFtRDtBQUVuRCxtQ0FBbUM7QUFDbkMsc0NBQXNDO0FBQ3RDLDhCQUE4QjtBQUM5Qiw0Q0FBNEM7QUFFNUMsZ0NBQWdDO0FBQ2hDLDJCQUEyQjtBQUUzQixRQUFRLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO0lBQzdDLElBQUksS0FBaUIsQ0FBQztJQUV0QixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsTUFBTSxHQUFHLEdBQUcsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsT0FBTyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsaUNBQWlDLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDNUYsS0FBSyxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM5QixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxzQ0FBc0MsRUFBRSxHQUFHLEVBQUU7UUFDaEQsTUFBTSxjQUFjLEdBQUcsSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxhQUFhLEVBQUU7WUFDOUQsWUFBWSxFQUFFLG9CQUFvQixDQUFDLHVCQUF1QixDQUFDO1lBQzNELGdCQUFnQixFQUFFO2dCQUNoQixZQUFZLEVBQUU7b0JBQ1osWUFBWSxFQUFFLG9CQUFvQixDQUFDLDhCQUE4QixDQUFDO2lCQUNuRTthQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsTUFBTSxVQUFVLEdBQUcsY0FBYyxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUMvRCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsZUFBZSxDQUNsRCxzQkFBc0IsQ0FBQyw4QkFBOEIsQ0FBQyxDQUN2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Q0FBQyxZQUFvQjtJQUNoRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLHVCQUF1QixFQUFFLFlBQVksQ0FBQyxDQUFDO0FBQ3JFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgTWF0Y2gsIFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgKiBhcyBzMyBmcm9tICcuLi8uLi9hd3MtczMnO1xuaW1wb3J0ICogYXMgY29yZSBmcm9tICcuLi8uLi9jb3JlJztcbmltcG9ydCAqIGFzIGN4YXBpIGZyb20gJy4uLy4uL2N4LWFwaSc7XG5pbXBvcnQgKiBhcyBpbmMgZnJvbSAnLi4vbGliJztcbmltcG9ydCAqIGFzIGZ1dGlscyBmcm9tICcuLi9saWIvZmlsZS11dGlscyc7XG5cbi8qIGVzbGludC1kaXNhYmxlIHF1b3RlLXByb3BzICovXG4vKiBlc2xpbnQtZGlzYWJsZSBxdW90ZXMgKi9cblxuZGVzY3JpYmUoJ0NESyBJbmNsdWRlIGZvciBuZXN0ZWQgc3RhY2tzJywgKCkgPT4ge1xuICBsZXQgc3RhY2s6IGNvcmUuU3RhY2s7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgY29uc3QgYXBwID0gbmV3IGNvcmUuQXBwKHsgY29udGV4dDogeyBbY3hhcGkuTkVXX1NUWUxFX1NUQUNLX1NZTlRIRVNJU19DT05URVhUXTogZmFsc2UgfSB9KTtcbiAgICBzdGFjayA9IG5ldyBjb3JlLlN0YWNrKGFwcCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBpbmdlc3QgYSB0ZW1wbGF0ZSB3aXRoIG9uZSBjaGlsZCcsICgpID0+IHtcbiAgICBjb25zdCBwYXJlbnRUZW1wbGF0ZSA9IG5ldyBpbmMuQ2ZuSW5jbHVkZShzdGFjaywgJ1BhcmVudFN0YWNrJywge1xuICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgncGFyZW50LW9uZS1jaGlsZC5qc29uJyksXG4gICAgICBsb2FkTmVzdGVkU3RhY2tzOiB7XG4gICAgICAgICdDaGlsZFN0YWNrJzoge1xuICAgICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ2dyYW5kY2hpbGQtaW1wb3J0LXN0YWNrLmpzb24nKSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBjaGlsZFN0YWNrID0gcGFyZW50VGVtcGxhdGUuZ2V0TmVzdGVkU3RhY2soJ0NoaWxkU3RhY2snKTtcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soY2hpbGRTdGFjay5zdGFjaykudGVtcGxhdGVNYXRjaGVzKFxuICAgICAgbG9hZFRlc3RGaWxlVG9Kc09iamVjdCgnZ3JhbmRjaGlsZC1pbXBvcnQtc3RhY2suanNvbicpLFxuICAgICk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBpbmdlc3QgYSB0ZW1wbGF0ZSB3aXRoIHR3byBjaGlsZHJlbicsICgpID0+IHtcbiAgICBjb25zdCBwYXJlbnRUZW1wbGF0ZSA9IG5ldyBpbmMuQ2ZuSW5jbHVkZShzdGFjaywgJ1BhcmVudFN0YWNrJywge1xuICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgncGFyZW50LXR3by1jaGlsZHJlbi5qc29uJyksXG4gICAgICBsb2FkTmVzdGVkU3RhY2tzOiB7XG4gICAgICAgICdDaGlsZFN0YWNrJzoge1xuICAgICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ2dyYW5kY2hpbGQtaW1wb3J0LXN0YWNrLmpzb24nKSxcbiAgICAgICAgfSxcbiAgICAgICAgJ0Fub3RoZXJDaGlsZFN0YWNrJzoge1xuICAgICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ2dyYW5kY2hpbGQtaW1wb3J0LXN0YWNrLmpzb24nKSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBjaGlsZFN0YWNrID0gcGFyZW50VGVtcGxhdGUuZ2V0TmVzdGVkU3RhY2soJ0NoaWxkU3RhY2snKTtcbiAgICBjb25zdCBhbm90aGVyQ2hpbGRTdGFjayA9IHBhcmVudFRlbXBsYXRlLmdldE5lc3RlZFN0YWNrKCdBbm90aGVyQ2hpbGRTdGFjaycpO1xuICAgIFRlbXBsYXRlLmZyb21TdGFjayhjaGlsZFN0YWNrLnN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoXG4gICAgICBsb2FkVGVzdEZpbGVUb0pzT2JqZWN0KCdncmFuZGNoaWxkLWltcG9ydC1zdGFjay5qc29uJyksXG4gICAgKTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhhbm90aGVyQ2hpbGRTdGFjay5zdGFjaykudGVtcGxhdGVNYXRjaGVzKFxuICAgICAgbG9hZFRlc3RGaWxlVG9Kc09iamVjdCgnZ3JhbmRjaGlsZC1pbXBvcnQtc3RhY2suanNvbicpLFxuICAgICk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBpbmdlc3QgYSB0ZW1wbGF0ZSB3aXRoIG9uZSBjaGlsZCBhbmQgb25lIGdyYW5kY2hpbGQnLCAoKSA9PiB7XG4gICAgY29uc3QgcGFyZW50VGVtcGxhdGUgPSBuZXcgaW5jLkNmbkluY2x1ZGUoc3RhY2ssICdQYXJlbnRTdGFjaycsIHtcbiAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ3BhcmVudC10d28tY2hpbGRyZW4uanNvbicpLFxuICAgICAgbG9hZE5lc3RlZFN0YWNrczoge1xuICAgICAgICAnQ2hpbGRTdGFjayc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjaGlsZC1pbXBvcnQtc3RhY2suanNvbicpLFxuICAgICAgICAgIGxvYWROZXN0ZWRTdGFja3M6IHtcbiAgICAgICAgICAgICdHcmFuZENoaWxkU3RhY2snOiB7XG4gICAgICAgICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ2dyYW5kY2hpbGQtaW1wb3J0LXN0YWNrLmpzb24nKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBjaGlsZFN0YWNrID0gcGFyZW50VGVtcGxhdGUuZ2V0TmVzdGVkU3RhY2soJ0NoaWxkU3RhY2snKTtcbiAgICBjb25zdCBncmFuZENoaWxkU3RhY2sgPSBjaGlsZFN0YWNrLmluY2x1ZGVkVGVtcGxhdGUuZ2V0TmVzdGVkU3RhY2soJ0dyYW5kQ2hpbGRTdGFjaycpO1xuICAgIFRlbXBsYXRlLmZyb21TdGFjayhjaGlsZFN0YWNrLnN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoXG4gICAgICBsb2FkVGVzdEZpbGVUb0pzT2JqZWN0KCdjaGlsZC1pbXBvcnQtc3RhY2suZXhwZWN0ZWQuanNvbicpLFxuICAgICk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soZ3JhbmRDaGlsZFN0YWNrLnN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoXG4gICAgICBsb2FkVGVzdEZpbGVUb0pzT2JqZWN0KCdncmFuZGNoaWxkLWltcG9ydC1zdGFjay5qc29uJyksXG4gICAgKTtcbiAgfSk7XG5cbiAgdGVzdCgndGhyb3dzIGFuIGVycm9yIHdoZW4gcHJvdmlkZWQgYSBuZXN0ZWQgc3RhY2sgdGhhdCBpcyBub3QgcHJlc2VudCBpbiB0aGUgdGVtcGxhdGUnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIG5ldyBpbmMuQ2ZuSW5jbHVkZShzdGFjaywgJ1BhcmVudFN0YWNrJywge1xuICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdwYXJlbnQtdHdvLWNoaWxkcmVuLmpzb24nKSxcbiAgICAgICAgbG9hZE5lc3RlZFN0YWNrczoge1xuICAgICAgICAgICdGYWtlU3RhY2snOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjaGlsZC1pbXBvcnQtc3RhY2suanNvbicpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KS50b1Rocm93KC9OZXN0ZWQgU3RhY2sgd2l0aCBsb2dpY2FsIElEICdGYWtlU3RhY2snIHdhcyBub3QgZm91bmQgaW4gdGhlIHRlbXBsYXRlLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Rocm93cyBhbiBleGNlcHRpb24gd2hlbiBOZXN0ZWRTdGFja3MgY29udGFpbnMgYW4gSUQgdGhhdCBpcyBub3QgYSBDbG91ZEZvcm1hdGlvbjo6U3RhY2sgaW4gdGhlIHRlbXBsYXRlJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBuZXcgaW5jLkNmbkluY2x1ZGUoc3RhY2ssICdQYXJlbnRTdGFjaycsIHtcbiAgICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgnY2hpbGQtaW1wb3J0LXN0YWNrLmpzb24nKSxcbiAgICAgICAgbG9hZE5lc3RlZFN0YWNrczoge1xuICAgICAgICAgICdCdWNrZXRJbXBvcnQnOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdncmFuZGNoaWxkLWltcG9ydC1zdGFjay5qc29uJyksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pLnRvVGhyb3coL05lc3RlZCBTdGFjayB3aXRoIGxvZ2ljYWwgSUQgJ0J1Y2tldEltcG9ydCcgaXMgbm90IGFuIEFXUzo6Q2xvdWRGb3JtYXRpb246OlN0YWNrIHJlc291cmNlLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Rocm93cyBhbiBleGNlcHRpb24gd2hlbiB0aGUgbmVzdGVkU3RhY2sgcmVzb3VyY2UgdXNlcyB0aGUgQ3JlYXRpb25Qb2xpY3kgYXR0cmlidXRlJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBuZXcgaW5jLkNmbkluY2x1ZGUoc3RhY2ssICdQYXJlbnRTdGFjaycsIHtcbiAgICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgncGFyZW50LWNyZWF0aW9uLXBvbGljeS5qc29uJyksXG4gICAgICAgIGxvYWROZXN0ZWRTdGFja3M6IHtcbiAgICAgICAgICAnQ2hpbGRTdGFjayc6IHtcbiAgICAgICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ2dyYW5kY2hpbGQtaW1wb3J0LXN0YWNrLmpzb24nKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSkudG9UaHJvdygvQ3JlYXRpb25Qb2xpY3kgaXMgbm90IHN1cHBvcnRlZCBieSB0aGUgQVdTOjpDbG91ZEZvcm1hdGlvbjo6U3RhY2sgcmVzb3VyY2UvKTtcbiAgfSk7XG5cbiAgdGVzdCgndGhyb3dzIGFuIGV4Y2VwdGlvbiB3aGVuIHRoZSBuZXN0ZWQgc3RhY2sgcmVzb3VyY2UgdXNlcyB0aGUgVXBkYXRlUG9saWN5IGF0dHJpYnV0ZScsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgbmV3IGluYy5DZm5JbmNsdWRlKHN0YWNrLCAnUGFyZW50U3RhY2snLCB7XG4gICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ3BhcmVudC11cGRhdGUtcG9saWN5Lmpzb24nKSxcbiAgICAgICAgbG9hZE5lc3RlZFN0YWNrczoge1xuICAgICAgICAgICdDaGlsZFN0YWNrJzoge1xuICAgICAgICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgnZ3JhbmRjaGlsZC1pbXBvcnQtc3RhY2suanNvbicpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KS50b1Rocm93KC9VcGRhdGVQb2xpY3kgaXMgbm90IHN1cHBvcnRlZCBieSB0aGUgQVdTOjpDbG91ZEZvcm1hdGlvbjo6U3RhY2sgcmVzb3VyY2UvKTtcbiAgfSk7XG5cbiAgdGVzdCgndGhyb3dzIGFuIGV4Y2VwdGlvbiB3aGVuIGEgbmVzdGVkIHN0YWNrIHJlZmVycyB0byBhIENvbmRpdGlvbiB0aGF0IGRvZXMgbm90IGV4aXN0IGluIHRoZSB0ZW1wbGF0ZScsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgbmV3IGluYy5DZm5JbmNsdWRlKHN0YWNrLCAnUGFyZW50U3RhY2snLCB7XG4gICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ3BhcmVudC1pbnZhbGlkLWNvbmRpdGlvbi5qc29uJyksXG4gICAgICAgIGxvYWROZXN0ZWRTdGFja3M6IHtcbiAgICAgICAgICAnQ2hpbGRTdGFjayc6IHtcbiAgICAgICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ2dyYW5kY2hpbGQtaW1wb3J0LXN0YWNrLmpzb24nKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSkudG9UaHJvdygvUmVzb3VyY2UgJ0NoaWxkU3RhY2snIHVzZXMgQ29uZGl0aW9uICdGYWtlQ29uZGl0aW9uJyB0aGF0IGRvZXNuJ3QgZXhpc3QvKTtcbiAgfSk7XG5cbiAgdGVzdCgndGhyb3dzIGFuIGV4Y2VwdGlvbiB3aGVuIGEgbmVzdGVkIHN0YWNrcyBkZXBlbmRzIG9uIGEgcmVzb3VyY2UgdGhhdCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgdGVtcGxhdGUnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIG5ldyBpbmMuQ2ZuSW5jbHVkZShzdGFjaywgJ1BhcmVudFN0YWNrJywge1xuICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdwYXJlbnQtYmFkLWRlcGVuZHMtb24uanNvbicpLFxuICAgICAgICBsb2FkTmVzdGVkU3RhY2tzOiB7XG4gICAgICAgICAgJ0NoaWxkU3RhY2snOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjaGlsZC1pbXBvcnQtc3RhY2suanNvbicpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KS50b1Rocm93KC9SZXNvdXJjZSAnQ2hpbGRTdGFjaycgZGVwZW5kcyBvbiAnQUZha2VSZXNvdXJjZScgdGhhdCBkb2Vzbid0IGV4aXN0Lyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Rocm93cyBhbiBleGNlcHRpb24gd2hlbiBhbiBJRCB3YXMgcGFzc2VkIGluIGxvYWROZXN0ZWRTdGFja3MgdGhhdCBpcyBhIHJlc291cmNlIHR5cGUgbm90IGluIHRoZSBDbG91ZEZvcm1hdGlvbiBzY2hlbWEnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIG5ldyBpbmMuQ2ZuSW5jbHVkZShzdGFjaywgJ1RlbXBsYXRlJywge1xuICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjdXN0b20tcmVzb3VyY2UuanNvbicpLFxuICAgICAgICBsb2FkTmVzdGVkU3RhY2tzOiB7XG4gICAgICAgICAgJ0N1c3RvbVJlc291cmNlJzoge1xuICAgICAgICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgnd2hhdGV2ZXIuanNvbicpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KS50b1Rocm93KC9OZXN0ZWQgU3RhY2sgd2l0aCBsb2dpY2FsIElEICdDdXN0b21SZXNvdXJjZScgaXMgbm90IGFuIEFXUzo6Q2xvdWRGb3JtYXRpb246OlN0YWNrIHJlc291cmNlLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBtb2RpZnkgcmVzb3VyY2VzIGluIG5lc3RlZCBzdGFja3MnLCAoKSA9PiB7XG4gICAgY29uc3QgcGFyZW50ID0gbmV3IGluYy5DZm5JbmNsdWRlKHN0YWNrLCAnUGFyZW50U3RhY2snLCB7XG4gICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjaGlsZC1pbXBvcnQtc3RhY2suanNvbicpLFxuICAgICAgbG9hZE5lc3RlZFN0YWNrczoge1xuICAgICAgICAnR3JhbmRDaGlsZFN0YWNrJzoge1xuICAgICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ2dyYW5kY2hpbGQtaW1wb3J0LXN0YWNrLmpzb24nKSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBjaGlsZFRlbXBsYXRlID0gcGFyZW50LmdldE5lc3RlZFN0YWNrKCdHcmFuZENoaWxkU3RhY2snKS5pbmNsdWRlZFRlbXBsYXRlO1xuICAgIGNvbnN0IGJ1Y2tldCA9IGNoaWxkVGVtcGxhdGUuZ2V0UmVzb3VyY2UoJ0J1Y2tldEltcG9ydCcpIGFzIHMzLkNmbkJ1Y2tldDtcblxuICAgIGJ1Y2tldC5idWNrZXROYW1lID0gJ21vZGlmaWVkLWJ1Y2tldC1uYW1lJztcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhjaGlsZFRlbXBsYXRlLnN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6UzM6OkJ1Y2tldCcsIHsgQnVja2V0TmFtZTogJ21vZGlmaWVkLWJ1Y2tldC1uYW1lJyB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnY2FuIHVzZSBhIGNvbmRpdGlvbicsICgpID0+IHtcbiAgICBjb25zdCBwYXJlbnQgPSBuZXcgaW5jLkNmbkluY2x1ZGUoc3RhY2ssICdQYXJlbnRTdGFjaycsIHtcbiAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ3BhcmVudC12YWxpZC1jb25kaXRpb24uanNvbicpLFxuICAgICAgbG9hZE5lc3RlZFN0YWNrczoge1xuICAgICAgICAnQ2hpbGRTdGFjayc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdncmFuZGNoaWxkLWltcG9ydC1zdGFjay5qc29uJyksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgYWx3YXlzRmFsc2VDb25kaXRpb24gPSBwYXJlbnQuZ2V0Q29uZGl0aW9uKCdBbHdheXNGYWxzZUNvbmQnKTtcblxuICAgIGV4cGVjdChwYXJlbnQuZ2V0UmVzb3VyY2UoJ0NoaWxkU3RhY2snKS5jZm5PcHRpb25zLmNvbmRpdGlvbikudG9CZShhbHdheXNGYWxzZUNvbmRpdGlvbik7XG4gIH0pO1xuXG4gIHRlc3QoJ2Fzc2V0IHBhcmFtZXRlcnMgZ2VuZXJhdGVkIGluIHBhcmVudCBhbmQgY2hpbGQgYXJlIGlkZW50aWNhbCcsICgpID0+IHtcbiAgICBuZXcgaW5jLkNmbkluY2x1ZGUoc3RhY2ssICdQYXJlbnRTdGFjaycsIHtcbiAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ3BhcmVudC1vbmUtY2hpbGQuanNvbicpLFxuICAgICAgbG9hZE5lc3RlZFN0YWNrczoge1xuICAgICAgICAnQ2hpbGRTdGFjayc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdncmFuZGNoaWxkLWltcG9ydC1zdGFjay5qc29uJyksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgYXNzZXRQYXJhbSA9ICdBc3NldFBhcmFtZXRlcnM1ZGM3ZDRhOTljZmUyOTc5Njg3ZGM3NGYyZGI5ZmQ3NWYyNTNiNTUwNWExOTEyYjVjZWVjZjcwYzlhZWZiYTUwUzNCdWNrZXRFQUEyNEYwQyc7XG4gICAgY29uc3QgYXNzZXRQYXJhbUtleSA9ICdBc3NldFBhcmFtZXRlcnM1ZGM3ZDRhOTljZmUyOTc5Njg3ZGM3NGYyZGI5ZmQ3NWYyNTNiNTUwNWExOTEyYjVjZWVjZjcwYzlhZWZiYTUwUzNWZXJzaW9uS2V5MTE5NENBQjInO1xuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykudGVtcGxhdGVNYXRjaGVzKHtcbiAgICAgIFwiUGFyYW1ldGVyc1wiOiB7XG4gICAgICAgIFthc3NldFBhcmFtXToge1xuICAgICAgICAgIFwiVHlwZVwiOiBcIlN0cmluZ1wiLFxuICAgICAgICAgIFwiRGVzY3JpcHRpb25cIjogXCJTMyBidWNrZXQgZm9yIGFzc2V0IFxcXCI1ZGM3ZDRhOTljZmUyOTc5Njg3ZGM3NGYyZGI5ZmQ3NWYyNTNiNTUwNWExOTEyYjVjZWVjZjcwYzlhZWZiYTUwXFxcIlwiLFxuICAgICAgICB9LFxuICAgICAgICBbYXNzZXRQYXJhbUtleV06IHtcbiAgICAgICAgICBcIlR5cGVcIjogXCJTdHJpbmdcIixcbiAgICAgICAgICBcIkRlc2NyaXB0aW9uXCI6IFwiUzMga2V5IGZvciBhc3NldCB2ZXJzaW9uIFxcXCI1ZGM3ZDRhOTljZmUyOTc5Njg3ZGM3NGYyZGI5ZmQ3NWYyNTNiNTUwNWExOTEyYjVjZWVjZjcwYzlhZWZiYTUwXFxcIlwiLFxuICAgICAgICB9LFxuICAgICAgICBcIkFzc2V0UGFyYW1ldGVyczVkYzdkNGE5OWNmZTI5Nzk2ODdkYzc0ZjJkYjlmZDc1ZjI1M2I1NTA1YTE5MTJiNWNlZWNmNzBjOWFlZmJhNTBBcnRpZmFjdEhhc2g5QzQxNzg0N1wiOiB7XG4gICAgICAgICAgXCJUeXBlXCI6IFwiU3RyaW5nXCIsXG4gICAgICAgICAgXCJEZXNjcmlwdGlvblwiOiBcIkFydGlmYWN0IGhhc2ggZm9yIGFzc2V0IFxcXCI1ZGM3ZDRhOTljZmUyOTc5Njg3ZGM3NGYyZGI5ZmQ3NWYyNTNiNTUwNWExOTEyYjVjZWVjZjcwYzlhZWZiYTUwXFxcIlwiLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIFwiUmVzb3VyY2VzXCI6IHtcbiAgICAgICAgXCJDaGlsZFN0YWNrXCI6IHtcbiAgICAgICAgICBcIlR5cGVcIjogXCJBV1M6OkNsb3VkRm9ybWF0aW9uOjpTdGFja1wiLFxuICAgICAgICAgIFwiUHJvcGVydGllc1wiOiB7XG4gICAgICAgICAgICBcIlRlbXBsYXRlVVJMXCI6IHtcbiAgICAgICAgICAgICAgXCJGbjo6Sm9pblwiOiBbXCJcIiwgW1xuICAgICAgICAgICAgICAgIFwiaHR0cHM6Ly9zMy5cIixcbiAgICAgICAgICAgICAgICB7IFwiUmVmXCI6IFwiQVdTOjpSZWdpb25cIiB9LFxuICAgICAgICAgICAgICAgIFwiLlwiLFxuICAgICAgICAgICAgICAgIHsgXCJSZWZcIjogXCJBV1M6OlVSTFN1ZmZpeFwiIH0sXG4gICAgICAgICAgICAgICAgXCIvXCIsXG4gICAgICAgICAgICAgICAgeyBcIlJlZlwiOiBhc3NldFBhcmFtIH0sXG4gICAgICAgICAgICAgICAgXCIvXCIsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgXCJGbjo6U2VsZWN0XCI6IFtcbiAgICAgICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgIFwiRm46OlNwbGl0XCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwifHxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgXCJSZWZcIjogYXNzZXRQYXJhbUtleSB9LFxuICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgXCJGbjo6U2VsZWN0XCI6IFtcbiAgICAgICAgICAgICAgICAgICAgMSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgIFwiRm46OlNwbGl0XCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwifHxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgXCJSZWZcIjogYXNzZXRQYXJhbUtleSB9LFxuICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiUGFyYW1ldGVyc1wiOiB7XG4gICAgICAgICAgICAgIFwiTXlCdWNrZXRQYXJhbWV0ZXJcIjogXCJzb21lLW1hZ2ljLWJ1Y2tldC1uYW1lXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCd0ZW1wbGF0ZXMgd2l0aCBuZXN0ZWQgc3RhY2tzIHRoYXQgd2VyZSBub3QgcHJvdmlkZWQgaW4gdGhlIGxvYWROZXN0ZWRTdGFja3MgcHJvcGVydHkgYXJlIGxlZnQgdW5tb2RpZmllZCcsICgpID0+IHtcbiAgICBuZXcgaW5jLkNmbkluY2x1ZGUoc3RhY2ssICdQYXJlbnRTdGFjaycsIHtcbiAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ3BhcmVudC10d28tY2hpbGRyZW4uanNvbicpLFxuICAgIH0pO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMobG9hZFRlc3RGaWxlVG9Kc09iamVjdCgncGFyZW50LXR3by1jaGlsZHJlbi5qc29uJykpO1xuICB9KTtcblxuICB0ZXN0KCdnZXROZXN0ZWRTdGFjaygpIHRocm93cyBhbiBleGNlcHRpb24gd2hlbiBnZXR0aW5nIGEgcmVzb3VyY2UgdGhhdCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgdGVtcGxhdGUnLCAoKSA9PiB7XG4gICAgY29uc3QgcGFyZW50VGVtcGxhdGUgPSBuZXcgaW5jLkNmbkluY2x1ZGUoc3RhY2ssICdQYXJlbnRTdGFjaycsIHtcbiAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ3BhcmVudC10d28tY2hpbGRyZW4uanNvbicpLFxuICAgICAgbG9hZE5lc3RlZFN0YWNrczoge1xuICAgICAgICAnQ2hpbGRTdGFjayc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjaGlsZC1pbXBvcnQtc3RhY2suanNvbicpLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBwYXJlbnRUZW1wbGF0ZS5nZXROZXN0ZWRTdGFjaygnRmFrZVN0YWNrJyk7XG4gICAgfSkudG9UaHJvdygvTmVzdGVkIFN0YWNrIHdpdGggbG9naWNhbCBJRCAnRmFrZVN0YWNrJyB3YXMgbm90IGZvdW5kLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ2dldE5lc3RlZFN0YWNrKCkgdGhyb3dzIGFuIGV4Y2VwdGlvbiB3aGVuIGdldHRpbmcgYSByZXNvdXJjZSB0aGF0IGV4aXN0cyBpbiB0aGUgdGVtcGxhdGUsIGJ1dCBpcyBub3QgYSBTdGFjaycsICgpID0+IHtcbiAgICBjb25zdCBwYXJlbnRUZW1wbGF0ZSA9IG5ldyBpbmMuQ2ZuSW5jbHVkZShzdGFjaywgJ1BhcmVudFN0YWNrJywge1xuICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgncGFyZW50LXR3by1jaGlsZHJlbi5qc29uJyksXG4gICAgICBsb2FkTmVzdGVkU3RhY2tzOiB7XG4gICAgICAgICdDaGlsZFN0YWNrJzoge1xuICAgICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ2NoaWxkLWltcG9ydC1zdGFjay5qc29uJyksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgY2hpbGRUZW1wbGF0ZSA9IHBhcmVudFRlbXBsYXRlLmdldE5lc3RlZFN0YWNrKCdDaGlsZFN0YWNrJykuaW5jbHVkZWRUZW1wbGF0ZTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBjaGlsZFRlbXBsYXRlLmdldE5lc3RlZFN0YWNrKCdCdWNrZXRJbXBvcnQnKTtcbiAgICB9KS50b1Rocm93KC9SZXNvdXJjZSB3aXRoIGxvZ2ljYWwgSUQgJ0J1Y2tldEltcG9ydCcgaXMgbm90IGEgQ2xvdWRGb3JtYXRpb24gU3RhY2svKTtcbiAgfSk7XG5cbiAgdGVzdCgnZ2V0TmVzdGVkU3RhY2soKSB0aHJvd3MgYW4gZXhjZXB0aW9uIHdoZW4gZ2V0dGluZyBhIG5lc3RlZCBzdGFjayB0aGF0IGV4aXN0cyBpbiB0aGUgdGVtcGxhdGUsIGJ1dCB3YXMgbm90IHNwZWNpZmllZCBpbiB0aGUgcHJvcHMnLCAoKSA9PiB7XG4gICAgY29uc3QgcGFyZW50VGVtcGxhdGUgPSBuZXcgaW5jLkNmbkluY2x1ZGUoc3RhY2ssICdQYXJlbnRTdGFjaycsIHtcbiAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ3BhcmVudC10d28tY2hpbGRyZW4uanNvbicpLFxuICAgICAgbG9hZE5lc3RlZFN0YWNrczoge1xuICAgICAgICAnQ2hpbGRTdGFjayc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjaGlsZC1pbXBvcnQtc3RhY2suanNvbicpLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBwYXJlbnRUZW1wbGF0ZS5nZXROZXN0ZWRTdGFjaygnQW5vdGhlckNoaWxkU3RhY2snKTtcbiAgICB9KS50b1Rocm93KC9OZXN0ZWQgU3RhY2sgJ0Fub3RoZXJDaGlsZFN0YWNrJyB3YXMgbm90IGluY2x1ZGVkIGluIHRoZSBwYXJlbnQgdGVtcGxhdGUvKTtcbiAgfSk7XG5cbiAgdGVzdCgnY29ycmVjdGx5IGhhbmRsZXMgcmVmZXJlbmNlcyBpbiBuZXN0ZWQgc3RhY2tzIFBhcmFtZXRlcnMnLCAoKSA9PiB7XG4gICAgbmV3IGluYy5DZm5JbmNsdWRlKHN0YWNrLCAnUGFyZW50U3RhY2snLCB7XG4gICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjcm9zcy1zdGFjay1yZWZzLmpzb24nKSxcbiAgICAgIGxvYWROZXN0ZWRTdGFja3M6IHtcbiAgICAgICAgJ0NoaWxkU3RhY2snOiB7XG4gICAgICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgnY2hpbGQtaW1wb3J0LXN0YWNrLmpzb24nKSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDbG91ZEZvcm1hdGlvbjo6U3RhY2snLCB7XG4gICAgICBcIlBhcmFtZXRlcnNcIjoge1xuICAgICAgICBcIlBhcmFtMVwiOiB7XG4gICAgICAgICAgXCJSZWZcIjogXCJQYXJhbVwiLFxuICAgICAgICB9LFxuICAgICAgICBcIlBhcmFtMlwiOiB7XG4gICAgICAgICAgXCJGbjo6R2V0QXR0XCI6IFtcIkJ1Y2tldFwiLCBcIkFyblwiXSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NvcnJlY3RseSBoYW5kbGVzIHJlbmFtaW5nIG9mIHJlZmVyZW5jZXMgYWNyb3NzIG5lc3RlZCBzdGFja3MnLCAoKSA9PiB7XG4gICAgY29uc3QgcGFyZW50VGVtcGxhdGUgPSBuZXcgaW5jLkNmbkluY2x1ZGUoc3RhY2ssICdQYXJlbnRTdGFjaycsIHtcbiAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ2Nyb3NzLXN0YWNrLXJlZnMuanNvbicpLFxuICAgICAgbG9hZE5lc3RlZFN0YWNrczoge1xuICAgICAgICAnQ2hpbGRTdGFjayc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjaGlsZC1pbXBvcnQtc3RhY2suanNvbicpLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBjb25zdCBjZm5CdWNrZXQgPSBwYXJlbnRUZW1wbGF0ZS5nZXRSZXNvdXJjZSgnQnVja2V0Jyk7XG4gICAgY2ZuQnVja2V0Lm92ZXJyaWRlTG9naWNhbElkKCdEaWZmZXJlbnRCdWNrZXQnKTtcbiAgICBjb25zdCBwYXJhbWV0ZXIgPSBwYXJlbnRUZW1wbGF0ZS5nZXRQYXJhbWV0ZXIoJ1BhcmFtJyk7XG4gICAgcGFyYW1ldGVyLm92ZXJyaWRlTG9naWNhbElkKCdEaWZmZXJlbnRQYXJhbWV0ZXInKTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRm9ybWF0aW9uOjpTdGFjaycsIHtcbiAgICAgIFwiUGFyYW1ldGVyc1wiOiB7XG4gICAgICAgIFwiUGFyYW0xXCI6IHtcbiAgICAgICAgICBcIlJlZlwiOiBcIkRpZmZlcmVudFBhcmFtZXRlclwiLFxuICAgICAgICB9LFxuICAgICAgICBcIlBhcmFtMlwiOiB7XG4gICAgICAgICAgXCJGbjo6R2V0QXR0XCI6IFtcIkRpZmZlcmVudEJ1Y2tldFwiLCBcIkFyblwiXSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JldHVybnMgdGhlIENmblN0YWNrIG9iamVjdCBmcm9tIGdldFJlc291cmNlKCkgZm9yIGEgbmVzdGVkIHN0YWNrIHRoYXQgd2FzIG5vdCBpbiB0aGUgbG9hZE5lc3RlZFN0YWNrcyBwcm9wZXJ0eScsICgpID0+IHtcbiAgICBjb25zdCBjZm5UZW1wbGF0ZSA9IG5ldyBpbmMuQ2ZuSW5jbHVkZShzdGFjaywgJ1BhcmVudFN0YWNrJywge1xuICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgncGFyZW50LXR3by1jaGlsZHJlbi5qc29uJyksXG4gICAgfSk7XG5cbiAgICBjb25zdCBjaGlsZFN0YWNrMSA9IGNmblRlbXBsYXRlLmdldFJlc291cmNlKCdDaGlsZFN0YWNrJyk7XG5cbiAgICBleHBlY3QoY2hpbGRTdGFjazEpLnRvQmVJbnN0YW5jZU9mKGNvcmUuQ2ZuU3RhY2spO1xuICB9KTtcblxuICB0ZXN0KCdyZXR1cm5zIHRoZSBDZm5TdGFjayBvYmplY3QgZnJvbSBnZXRSZXNvdXJjZSgpIGZvciBhIG5lc3RlZCBzdGFjayB0aGF0IHdhcyBpbiB0aGUgbG9hZE5lc3RlZFN0YWNrcyBwcm9wZXJ0eScsICgpID0+IHtcbiAgICBjb25zdCBjZm5UZW1wbGF0ZSA9IG5ldyBpbmMuQ2ZuSW5jbHVkZShzdGFjaywgJ1BhcmVudFN0YWNrJywge1xuICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgncGFyZW50LW9uZS1jaGlsZC5qc29uJyksXG4gICAgICBsb2FkTmVzdGVkU3RhY2tzOiB7XG4gICAgICAgICdDaGlsZFN0YWNrJzoge1xuICAgICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ2NoaWxkLWltcG9ydC1zdGFjay5qc29uJyksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgY2hpbGRTdGFjazEgPSBjZm5UZW1wbGF0ZS5nZXRSZXNvdXJjZSgnQ2hpbGRTdGFjaycpO1xuXG4gICAgZXhwZWN0KGNoaWxkU3RhY2sxKS50b0JlSW5zdGFuY2VPZihjb3JlLkNmblN0YWNrKTtcbiAgfSk7XG5cbiAgdGVzdChcImhhbmRsZXMgTWV0YWRhdGEsIERlbGV0aW9uUG9saWN5LCBhbmQgVXBkYXRlUmVwbGFjZVBvbGljeSBhdHRyaWJ1dGVzIG9mIHRoZSBuZXN0ZWQgc3RhY2sncyByZXNvdXJjZVwiLCAoKSA9PiB7XG4gICAgbmV3IGluYy5DZm5JbmNsdWRlKHN0YWNrLCAnUGFyZW50U3RhY2snLCB7XG4gICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdwYXJlbnQtd2l0aC1hdHRyaWJ1dGVzLmpzb24nKSxcbiAgICAgIGxvYWROZXN0ZWRTdGFja3M6IHtcbiAgICAgICAgJ0NoaWxkU3RhY2snOiB7XG4gICAgICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgnY2hpbGQtaW1wb3J0LXN0YWNrLmpzb24nKSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlKCdBV1M6OkNsb3VkRm9ybWF0aW9uOjpTdGFjaycsIHtcbiAgICAgIFwiTWV0YWRhdGFcIjoge1xuICAgICAgICBcIlByb3BlcnR5MVwiOiBcIlZhbHVlMVwiLFxuICAgICAgfSxcbiAgICAgIFwiRGVsZXRpb25Qb2xpY3lcIjogXCJSZXRhaW5cIixcbiAgICAgIFwiRGVwZW5kc09uXCI6IFtcbiAgICAgICAgXCJBbm90aGVyQ2hpbGRTdGFja1wiLFxuICAgICAgXSxcbiAgICAgIFwiVXBkYXRlUmVwbGFjZVBvbGljeVwiOiBcIlJldGFpblwiLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjb3JyZWN0bHkgcGFyc2VzIE5vdGlmaWNhdGlvbnNBUk5zLCBUaW1lb3V0JywgKCkgPT4ge1xuICAgIG5ldyBpbmMuQ2ZuSW5jbHVkZShzdGFjaywgJ1BhcmVudFN0YWNrJywge1xuICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgncGFyZW50LXdpdGgtYXR0cmlidXRlcy5qc29uJyksXG4gICAgICBsb2FkTmVzdGVkU3RhY2tzOiB7XG4gICAgICAgICdDaGlsZFN0YWNrJzoge1xuICAgICAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ2N1c3RvbS1yZXNvdXJjZS5qc29uJyksXG4gICAgICAgIH0sXG4gICAgICAgICdBbm90aGVyQ2hpbGRTdGFjayc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjdXN0b20tcmVzb3VyY2UuanNvbicpLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRm9ybWF0aW9uOjpTdGFjaycsIHtcbiAgICAgIFwiTm90aWZpY2F0aW9uQVJOc1wiOiBbXCJhcm4xXCJdLFxuICAgICAgXCJUaW1lb3V0SW5NaW51dGVzXCI6IDUsXG4gICAgfSk7XG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q2xvdWRGb3JtYXRpb246OlN0YWNrJywge1xuICAgICAgXCJOb3RpZmljYXRpb25BUk5zXCI6IHsgXCJSZWZcIjogXCJBcnJheVBhcmFtXCIgfSxcbiAgICAgIFwiVGltZW91dEluTWludXRlc1wiOiB7XG4gICAgICAgIFwiRm46OlNlbGVjdFwiOiBbMCwge1xuICAgICAgICAgIFwiUmVmXCI6IFwiQXJyYXlQYXJhbVwiLFxuICAgICAgICB9XSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBpbmdlc3QgYSBOZXN0ZWRTdGFjayB3aXRoIGEgTnVtYmVyIENGTiBQYXJhbWV0ZXIgcGFzc2VkIGFzIGEgbnVtYmVyJywgKCkgPT4ge1xuICAgIG5ldyBpbmMuQ2ZuSW5jbHVkZShzdGFjaywgJ015U2NvcGUnLCB7XG4gICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdwYXJlbnQtbnVtYmVyLWluLWNoaWxkLXBhcmFtcy55YW1sJyksXG4gICAgICBsb2FkTmVzdGVkU3RhY2tzOiB7XG4gICAgICAgICdOZXN0ZWRTdGFjayc6IHtcbiAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjaGlsZC13aXRoLW51bWJlci1wYXJhbWV0ZXIueWFtbCcpLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNsb3VkRm9ybWF0aW9uOjpTdGFjaycsIHtcbiAgICAgIFwiUGFyYW1ldGVyc1wiOiB7XG4gICAgICAgIFwiTnVtYmVyXCI6IFwiNjBcIixcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBsYXppbHkgaW5jbHVkZSBhIHNpbmdsZSBjaGlsZCBuZXN0ZWQgc3RhY2snLCAoKSA9PiB7XG4gICAgY29uc3QgcGFyZW50VGVtcGxhdGUgPSBuZXcgaW5jLkNmbkluY2x1ZGUoc3RhY2ssICdQYXJlbnRTdGFjaycsIHtcbiAgICAgIHRlbXBsYXRlRmlsZTogdGVzdFRlbXBsYXRlRmlsZVBhdGgoJ3BhcmVudC1vbmUtY2hpbGQuanNvbicpLFxuICAgIH0pO1xuICAgIGNvbnN0IGluY2x1ZGVkQ2hpbGQgPSBwYXJlbnRUZW1wbGF0ZS5sb2FkTmVzdGVkU3RhY2soJ0NoaWxkU3RhY2snLCB7XG4gICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjaGlsZC1uby1idWNrZXQuanNvbicpLFxuICAgIH0pO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKGluY2x1ZGVkQ2hpbGQuc3RhY2spLnRlbXBsYXRlTWF0Y2hlcyhcbiAgICAgIGxvYWRUZXN0RmlsZVRvSnNPYmplY3QoJ2NoaWxkLW5vLWJ1Y2tldC5qc29uJyksXG4gICAgKTtcbiAgICBleHBlY3QoaW5jbHVkZWRDaGlsZC5pbmNsdWRlZFRlbXBsYXRlLmdldFJlc291cmNlKCdHcmFuZENoaWxkU3RhY2snKSkudG9CZURlZmluZWQoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZvciBhIHBhcmVudCBzdGFjayB3aXRoIGNoaWxkcmVuIGFuZCBncmFuZGNoaWxkcmVuJywgKCkgPT4ge1xuICAgIGxldCBhc3NldFN0YWNrOiBjb3JlLlN0YWNrO1xuICAgIGxldCBwYXJlbnRUZW1wbGF0ZTogaW5jLkNmbkluY2x1ZGU7XG4gICAgbGV0IGNoaWxkOiBpbmMuSW5jbHVkZWROZXN0ZWRTdGFjaztcbiAgICBsZXQgZ3JhbmRDaGlsZDogaW5jLkluY2x1ZGVkTmVzdGVkU3RhY2s7XG5cbiAgICBsZXQgaGFzaDE6IHN0cmluZztcbiAgICBsZXQgaGFzaDI6IHN0cmluZztcblxuICAgIGxldCBwYXJlbnRCdWNrZXRQYXJhbTogc3RyaW5nO1xuICAgIGxldCBwYXJlbnRLZXlQYXJhbTogc3RyaW5nO1xuICAgIGxldCBncmFuZENoaWxkQnVja2V0UGFyYW06IHN0cmluZztcbiAgICBsZXQgZ3JhbmRDaGlsZEtleVBhcmFtOiBzdHJpbmc7XG5cbiAgICBsZXQgY2hpbGRCdWNrZXRQYXJhbTogc3RyaW5nO1xuICAgIGxldCBjaGlsZEtleVBhcmFtOiBzdHJpbmc7XG5cbiAgICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgICAgY29uc3QgYXBwID0gbmV3IGNvcmUuQXBwKHsgY29udGV4dDogeyBbY3hhcGkuTkVXX1NUWUxFX1NUQUNLX1NZTlRIRVNJU19DT05URVhUXTogZmFsc2UgfSB9KTtcbiAgICAgIGFzc2V0U3RhY2sgPSBuZXcgY29yZS5TdGFjayhhcHApO1xuICAgICAgcGFyZW50VGVtcGxhdGUgPSBuZXcgaW5jLkNmbkluY2x1ZGUoYXNzZXRTdGFjaywgJ1BhcmVudFN0YWNrJywge1xuICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdwYXJlbnQtb25lLWNoaWxkLmpzb24nKSxcbiAgICAgICAgbG9hZE5lc3RlZFN0YWNrczoge1xuICAgICAgICAgICdDaGlsZFN0YWNrJzoge1xuICAgICAgICAgICAgdGVtcGxhdGVGaWxlOiB0ZXN0VGVtcGxhdGVGaWxlUGF0aCgnY2hpbGQtbm8tYnVja2V0Lmpzb24nKSxcbiAgICAgICAgICAgIGxvYWROZXN0ZWRTdGFja3M6IHtcbiAgICAgICAgICAgICAgJ0dyYW5kQ2hpbGRTdGFjayc6IHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdncmFuZGNoaWxkLWltcG9ydC1zdGFjay5qc29uJyksXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY2hpbGQgPSBwYXJlbnRUZW1wbGF0ZS5nZXROZXN0ZWRTdGFjaygnQ2hpbGRTdGFjaycpO1xuICAgICAgZ3JhbmRDaGlsZCA9IGNoaWxkLmluY2x1ZGVkVGVtcGxhdGUuZ2V0TmVzdGVkU3RhY2soJ0dyYW5kQ2hpbGRTdGFjaycpO1xuXG4gICAgICBoYXNoMSA9ICc1ZGM3ZDRhOTljZmUyOTc5Njg3ZGM3NGYyZGI5ZmQ3NWYyNTNiNTUwNWExOTEyYjVjZWVjZjcwYzlhZWZiYTUwJztcbiAgICAgIGhhc2gyID0gJzc3NzU3MzAxNjRlZGI1ZmFhZTcxN2FjMWQyZTkwZDljMGQwZmRiZWFmZTQ4NzYzZTVjMWI3ZmI1ZTM5ZTAwYTUnO1xuXG4gICAgICBwYXJlbnRCdWNrZXRQYXJhbSA9IGBBc3NldFBhcmFtZXRlcnMke2hhc2gxfVMzQnVja2V0RUFBMjRGMENgO1xuICAgICAgcGFyZW50S2V5UGFyYW0gPSBgQXNzZXRQYXJhbWV0ZXJzJHtoYXNoMX1TM1ZlcnNpb25LZXkxMTk0Q0FCMmA7XG4gICAgICBncmFuZENoaWxkQnVja2V0UGFyYW0gPSBgcmVmZXJlbmNldG9Bc3NldFBhcmFtZXRlcnMke2hhc2gxfVMzQnVja2V0RUFBMjRGMENSZWZgO1xuICAgICAgZ3JhbmRDaGlsZEtleVBhcmFtID0gYHJlZmVyZW5jZXRvQXNzZXRQYXJhbWV0ZXJzJHtoYXNoMX1TM1ZlcnNpb25LZXkxMTk0Q0FCMlJlZmA7XG5cbiAgICAgIGNoaWxkQnVja2V0UGFyYW0gPSBgQXNzZXRQYXJhbWV0ZXJzJHtoYXNoMn1TM0J1Y2tldERFQjE5NEM2YDtcbiAgICAgIGNoaWxkS2V5UGFyYW0gPSBgQXNzZXRQYXJhbWV0ZXJzJHtoYXNoMn1TM1ZlcnNpb25LZXk4QjM0MkVEMWA7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdjb3JyZWN0bHkgY3JlYXRlcyBwYXJhbWV0ZXJzIGluIHRoZSBwYXJlbnQgc3RhY2ssIGFuZCBwYXNzZXMgdGhlbSB0byB0aGUgY2hpbGQgc3RhY2snLCAoKSA9PiB7XG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soYXNzZXRTdGFjaykudGVtcGxhdGVNYXRjaGVzKHtcbiAgICAgICAgXCJQYXJhbWV0ZXJzXCI6IHtcbiAgICAgICAgICBbcGFyZW50QnVja2V0UGFyYW1dOiB7XG4gICAgICAgICAgICBcIlR5cGVcIjogXCJTdHJpbmdcIixcbiAgICAgICAgICAgIFwiRGVzY3JpcHRpb25cIjogYFMzIGJ1Y2tldCBmb3IgYXNzZXQgXFxcIiR7aGFzaDF9XFxcImAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBbcGFyZW50S2V5UGFyYW1dOiB7XG4gICAgICAgICAgICBcIlR5cGVcIjogXCJTdHJpbmdcIixcbiAgICAgICAgICAgIFwiRGVzY3JpcHRpb25cIjogYFMzIGtleSBmb3IgYXNzZXQgdmVyc2lvbiBcXFwiJHtoYXNoMX1cXFwiYCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIFtgQXNzZXRQYXJhbWV0ZXJzJHtoYXNoMX1BcnRpZmFjdEhhc2g5QzQxNzg0N2BdOiB7XG4gICAgICAgICAgICBcIlR5cGVcIjogXCJTdHJpbmdcIixcbiAgICAgICAgICAgIFwiRGVzY3JpcHRpb25cIjogYEFydGlmYWN0IGhhc2ggZm9yIGFzc2V0IFxcXCIke2hhc2gxfVxcXCJgLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgW2NoaWxkQnVja2V0UGFyYW1dOiB7XG4gICAgICAgICAgICBcIlR5cGVcIjogXCJTdHJpbmdcIixcbiAgICAgICAgICAgIFwiRGVzY3JpcHRpb25cIjogYFMzIGJ1Y2tldCBmb3IgYXNzZXQgXFxcIiR7aGFzaDJ9XFxcImAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBbY2hpbGRLZXlQYXJhbV06IHtcbiAgICAgICAgICAgIFwiVHlwZVwiOiBcIlN0cmluZ1wiLFxuICAgICAgICAgICAgXCJEZXNjcmlwdGlvblwiOiBgUzMga2V5IGZvciBhc3NldCB2ZXJzaW9uIFxcXCIke2hhc2gyfVxcXCJgLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgW2BBc3NldFBhcmFtZXRlcnMke2hhc2gyfUFydGlmYWN0SGFzaEFBODJENENDYF06IHtcbiAgICAgICAgICAgIFwiVHlwZVwiOiBcIlN0cmluZ1wiLFxuICAgICAgICAgICAgXCJEZXNjcmlwdGlvblwiOiBgQXJ0aWZhY3QgaGFzaCBmb3IgYXNzZXQgXFxcIiR7aGFzaDJ9XFxcImAsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgICAgIFwiQ2hpbGRTdGFja1wiOiB7XG4gICAgICAgICAgICBcIlR5cGVcIjogXCJBV1M6OkNsb3VkRm9ybWF0aW9uOjpTdGFja1wiLFxuICAgICAgICAgICAgXCJQcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgICAgXCJUZW1wbGF0ZVVSTFwiOiB7XG4gICAgICAgICAgICAgICAgXCJGbjo6Sm9pblwiOiBbXCJcIiwgW1xuICAgICAgICAgICAgICAgICAgXCJodHRwczovL3MzLlwiLFxuICAgICAgICAgICAgICAgICAgeyBcIlJlZlwiOiBcIkFXUzo6UmVnaW9uXCIgfSxcbiAgICAgICAgICAgICAgICAgIFwiLlwiLFxuICAgICAgICAgICAgICAgICAgeyBcIlJlZlwiOiBcIkFXUzo6VVJMU3VmZml4XCIgfSxcbiAgICAgICAgICAgICAgICAgIFwiL1wiLFxuICAgICAgICAgICAgICAgICAgeyBcIlJlZlwiOiBjaGlsZEJ1Y2tldFBhcmFtIH0sXG4gICAgICAgICAgICAgICAgICBcIi9cIixcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgXCJGbjo6U2VsZWN0XCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiRm46OlNwbGl0XCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ8fFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICB7IFwiUmVmXCI6IGNoaWxkS2V5UGFyYW0gfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIFwiRm46OlNlbGVjdFwiOiBbXG4gICAgICAgICAgICAgICAgICAgICAgMSxcbiAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcIkZuOjpTcGxpdFwiOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFwifHxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgeyBcIlJlZlwiOiBjaGlsZEtleVBhcmFtIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBcIlBhcmFtZXRlcnNcIjoge1xuICAgICAgICAgICAgICAgIFwiTXlCdWNrZXRQYXJhbWV0ZXJcIjogXCJzb21lLW1hZ2ljLWJ1Y2tldC1uYW1lXCIsXG4gICAgICAgICAgICAgICAgW2dyYW5kQ2hpbGRCdWNrZXRQYXJhbV06IHtcbiAgICAgICAgICAgICAgICAgIFwiUmVmXCI6IHBhcmVudEJ1Y2tldFBhcmFtLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgW2dyYW5kQ2hpbGRLZXlQYXJhbV06IHtcbiAgICAgICAgICAgICAgICAgIFwiUmVmXCI6IHBhcmVudEtleVBhcmFtLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2NvcnJlY3RseSBjcmVhdGVzIHBhcmFtZXRlcnMgaW4gdGhlIGNoaWxkIHN0YWNrLCBhbmQgcGFzc2VzIHRoZW0gdG8gdGhlIGdyYW5kY2hpbGQgc3RhY2snLCAoKSA9PiB7XG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soY2hpbGQuc3RhY2spLnRlbXBsYXRlTWF0Y2hlcyh7XG4gICAgICAgIFwiUGFyYW1ldGVyc1wiOiB7XG4gICAgICAgICAgXCJNeUJ1Y2tldFBhcmFtZXRlclwiOiB7XG4gICAgICAgICAgICBcIlR5cGVcIjogXCJTdHJpbmdcIixcbiAgICAgICAgICAgIFwiRGVmYXVsdFwiOiBcImRlZmF1bHQtYnVja2V0LXBhcmFtLW5hbWVcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIFtncmFuZENoaWxkQnVja2V0UGFyYW1dOiB7XG4gICAgICAgICAgICBcIlR5cGVcIjogXCJTdHJpbmdcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIFtncmFuZENoaWxkS2V5UGFyYW1dOiB7XG4gICAgICAgICAgICBcIlR5cGVcIjogXCJTdHJpbmdcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBcIlJlc291cmNlc1wiOiB7XG4gICAgICAgICAgXCJHcmFuZENoaWxkU3RhY2tcIjoge1xuICAgICAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpDbG91ZEZvcm1hdGlvbjo6U3RhY2tcIixcbiAgICAgICAgICAgIFwiUHJvcGVydGllc1wiOiB7XG4gICAgICAgICAgICAgIFwiVGVtcGxhdGVVUkxcIjoge1xuICAgICAgICAgICAgICAgIFwiRm46OkpvaW5cIjogW1wiXCIsIFtcbiAgICAgICAgICAgICAgICAgIFwiaHR0cHM6Ly9zMy5cIixcbiAgICAgICAgICAgICAgICAgIHsgXCJSZWZcIjogXCJBV1M6OlJlZ2lvblwiIH0sXG4gICAgICAgICAgICAgICAgICBcIi5cIixcbiAgICAgICAgICAgICAgICAgIHsgXCJSZWZcIjogXCJBV1M6OlVSTFN1ZmZpeFwiIH0sXG4gICAgICAgICAgICAgICAgICBcIi9cIixcbiAgICAgICAgICAgICAgICAgIHsgXCJSZWZcIjogZ3JhbmRDaGlsZEJ1Y2tldFBhcmFtIH0sXG4gICAgICAgICAgICAgICAgICBcIi9cIixcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgXCJGbjo6U2VsZWN0XCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiRm46OlNwbGl0XCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ8fFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICB7IFwiUmVmXCI6IGdyYW5kQ2hpbGRLZXlQYXJhbSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgXCJGbjo6U2VsZWN0XCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAxLFxuICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiRm46OlNwbGl0XCI6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ8fFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICB7IFwiUmVmXCI6IGdyYW5kQ2hpbGRLZXlQYXJhbSB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBdXSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXCJQYXJhbWV0ZXJzXCI6IHtcbiAgICAgICAgICAgICAgICBcIk15QnVja2V0UGFyYW1ldGVyXCI6IFwic29tZS1vdGhlci1idWNrZXQtbmFtZVwiLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdsZWF2ZXMgZ3JhbmRjaGlsZCBzdGFjayB1bm1vZGlmaWVkJywgKCkgPT4ge1xuICAgICAgVGVtcGxhdGUuZnJvbVN0YWNrKGdyYW5kQ2hpbGQuc3RhY2spLnRlbXBsYXRlTWF0Y2hlcyhcbiAgICAgICAgbG9hZFRlc3RGaWxlVG9Kc09iamVjdCgnZ3JhbmRjaGlsZC1pbXBvcnQtc3RhY2suanNvbicpLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZvciBhIHBhcmFtZXRlciBwYXNzZWQgdG8gdGhlIGluY2x1ZGVkIGNoaWxkIHN0YWNrJywgKCkgPT4ge1xuICAgIGxldCBwYXJlbnRTdGFjazogY29yZS5TdGFjaztcbiAgICBsZXQgY2hpbGRTdGFjazogY29yZS5TdGFjaztcblxuICAgIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgICBwYXJlbnRTdGFjayA9IG5ldyBjb3JlLlN0YWNrKCk7XG4gICAgICBjb25zdCBwYXJlbnRUZW1wbGF0ZSA9IG5ldyBpbmMuQ2ZuSW5jbHVkZShwYXJlbnRTdGFjaywgJ1BhcmVudFN0YWNrJywge1xuICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdwYXJlbnQtdHdvLXBhcmFtZXRlcnMuanNvbicpLFxuICAgICAgICBsb2FkTmVzdGVkU3RhY2tzOiB7XG4gICAgICAgICAgJ0NoaWxkU3RhY2snOiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZUZpbGU6IHRlc3RUZW1wbGF0ZUZpbGVQYXRoKCdjaGlsZC10d28tcGFyYW1ldGVycy5qc29uJyksXG4gICAgICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgICAgICdGaXJzdFBhcmFtZXRlcic6ICd0ZXN0LXZhbHVlJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgY2hpbGRTdGFjayA9IHBhcmVudFRlbXBsYXRlLmdldE5lc3RlZFN0YWNrKCdDaGlsZFN0YWNrJykuc3RhY2s7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdjb3JyZWN0bHkgcmVtb3ZlcyB0aGUgcGFyYW1ldGVyIGZyb20gdGhlIGNoaWxkIHN0YWNrJywgKCkgPT4ge1xuICAgICAgVGVtcGxhdGUuZnJvbVN0YWNrKGNoaWxkU3RhY2spLnRlbXBsYXRlTWF0Y2hlcyh7XG4gICAgICAgIFwiUGFyYW1ldGVyc1wiOiB7XG4gICAgICAgICAgXCJTZWNvbmRQYXJhbWV0ZXJcIjoge1xuICAgICAgICAgICAgXCJUeXBlXCI6IFwiU3RyaW5nXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgICAgIFwiQnVja2V0SW1wb3J0XCI6IHtcbiAgICAgICAgICAgIFwiVHlwZVwiOiBcIkFXUzo6UzM6OkJ1Y2tldFwiLFxuICAgICAgICAgICAgXCJQcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgICAgXCJCdWNrZXROYW1lXCI6IFwidGVzdC12YWx1ZVwiLFxuICAgICAgICAgICAgICBcIkFjY2Vzc0NvbnRyb2xcIjoge1xuICAgICAgICAgICAgICAgIFwiUmVmXCI6IFwiU2Vjb25kUGFyYW1ldGVyXCIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJHcmFuZENoaWxkU3RhY2tcIjoge1xuICAgICAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpDbG91ZEZvcm1hdGlvbjo6U3RhY2tcIixcbiAgICAgICAgICAgIFwiUHJvcGVydGllc1wiOiB7XG4gICAgICAgICAgICAgIFwiVGVtcGxhdGVVUkxcIjogXCJodHRwczovL2Nmbi10ZW1wbGF0ZXMtc2V0LnMzLmFtYXpvbmF3cy5jb20vZ3JhbmRjaGlsZC1pbXBvcnQtc3RhY2suanNvblwiLFxuICAgICAgICAgICAgICBcIlBhcmFtZXRlcnNcIjoge1xuICAgICAgICAgICAgICAgIFwiRmlyc3RQYXJhbWV0ZXJcIjogXCJ0ZXN0LXZhbHVlXCIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2NvcnJlY3RseSByZW1vdmVzIHRoZSBwYXJhbWV0ZXIgZnJvbSB0aGUgcGFyZW50IHN0YWNrJywgKCkgPT4ge1xuICAgICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBhcmVudFN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q2xvdWRGb3JtYXRpb246OlN0YWNrJywge1xuICAgICAgICBcIlBhcmFtZXRlcnNcIjoge1xuICAgICAgICAgIFwiRmlyc3RQYXJhbWV0ZXJcIjogTWF0Y2guYWJzZW50KCksXG4gICAgICAgICAgXCJTZWNvbmRQYXJhbWV0ZXJcIjogXCJzZWNvbmQtdmFsdWVcIixcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5mdW5jdGlvbiBsb2FkVGVzdEZpbGVUb0pzT2JqZWN0KHRlc3RUZW1wbGF0ZTogc3RyaW5nKTogYW55IHtcbiAgcmV0dXJuIGZ1dGlscy5yZWFkSnNvblN5bmModGVzdFRlbXBsYXRlRmlsZVBhdGgodGVzdFRlbXBsYXRlKSk7XG59XG5cbmZ1bmN0aW9uIHRlc3RUZW1wbGF0ZUZpbGVQYXRoKHRlc3RUZW1wbGF0ZTogc3RyaW5nKSB7XG4gIHJldHVybiBwYXRoLmpvaW4oX19kaXJuYW1lLCAndGVzdC10ZW1wbGF0ZXMvbmVzdGVkJywgdGVzdFRlbXBsYXRlKTtcbn1cbiJdfQ==