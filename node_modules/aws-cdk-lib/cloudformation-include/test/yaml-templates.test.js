"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const assertions_1 = require("../../assertions");
const core = require("../../core");
const inc = require("../lib");
const futils = require("../lib/file-utils");
/* eslint-disable quote-props */
/* eslint-disable quotes */
describe('CDK Include', () => {
    let stack;
    beforeEach(() => {
        stack = new core.Stack();
    });
    test('can ingest a template with all long-form CloudFormation functions and output it unchanged', () => {
        includeTestTemplate(stack, 'long-form-vpc.yaml');
        assertions_1.Template.fromStack(stack).templateMatches(loadTestFileToJsObject('long-form-vpc.yaml'));
    });
    test('can ingest a template with year-month-date parsed as string instead of Date', () => {
        includeTestTemplate(stack, 'year-month-date-as-strings.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "AWSTemplateFormatVersion": "2010-09-09",
            "Resources": {
                "Role": {
                    "Type": "AWS::IAM::Role",
                    "Properties": {
                        "AssumeRolePolicyDocument": {
                            "Version": "2012-10-17",
                            "Statement": [
                                {
                                    "Effect": "Allow",
                                    "Principal": {
                                        "Service": ["ec2.amazonaws.com"],
                                    },
                                    "Action": ["sts:AssumeRole"],
                                },
                            ],
                        },
                    },
                },
            },
        });
    });
    test('can ingest a template with the short form Base64 function', () => {
        includeTestTemplate(stack, 'short-form-base64.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "Resources": {
                "Base64Bucket": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": {
                            "Fn::Base64": "NonBase64BucketName",
                        },
                    },
                },
            },
        });
    });
    test('can ingest a template with the short form !Cidr function', () => {
        includeTestTemplate(stack, 'short-form-cidr.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "Resources": {
                "CidrVpc1": {
                    "Type": "AWS::EC2::VPC",
                    "Properties": {
                        "CidrBlock": {
                            "Fn::Cidr": [
                                "192.168.1.1/24",
                                2,
                                5,
                            ],
                        },
                    },
                },
                "CidrVpc2": {
                    "Type": "AWS::EC2::VPC",
                    "Properties": {
                        "CidrBlock": {
                            "Fn::Cidr": [
                                "192.168.1.1/24",
                                "2",
                                "5",
                            ],
                        },
                    },
                },
            },
        });
    });
    test('can ingest a template with the short form !FindInMap function, in both hyphen and bracket notation', () => {
        includeTestTemplate(stack, 'short-form-find-in-map.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "Mappings": {
                "RegionMap": {
                    "region-1": {
                        "HVM64": "name1",
                        "HVMG2": "name2",
                    },
                },
            },
            "Resources": {
                "Bucket1": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": {
                            "Fn::FindInMap": [
                                "RegionMap",
                                "region-1",
                                "HVM64",
                            ],
                        },
                    },
                },
                "Bucket2": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": {
                            "Fn::FindInMap": [
                                "RegionMap",
                                "region-1",
                                "HVMG2",
                            ],
                        },
                    },
                },
            },
        });
    });
    test('can ingest a template with the short form !GetAtt function', () => {
        includeTestTemplate(stack, 'short-form-get-att.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "Resources": {
                "ELB": {
                    "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
                    "Properties": {
                        "AvailabilityZones": [
                            "us-east-1a",
                        ],
                        "Listeners": [
                            {
                                "LoadBalancerPort": "80",
                                "InstancePort": "80",
                                "Protocol": "HTTP",
                            },
                        ],
                    },
                },
                "Bucket0": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": { "BucketName": "some-bucket" },
                },
                "Bucket1": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": { "Fn::GetAtt": "Bucket0.Arn" },
                        "AccessControl": { "Fn::GetAtt": ["ELB", "SourceSecurityGroup.GroupName"] },
                    },
                },
                "Bucket2": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": { "Fn::GetAtt": ["Bucket1", "Arn"] },
                        "AccessControl": { "Fn::GetAtt": "ELB.SourceSecurityGroup.GroupName" },
                    },
                },
            },
        });
    });
    test('can ingest a template with short form Select, GetAZs, and Ref functions', () => {
        includeTestTemplate(stack, 'short-form-select.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "Resources": {
                "Subnet1": {
                    "Type": "AWS::EC2::Subnet",
                    "Properties": {
                        "VpcId": {
                            "Fn::Select": [0, { "Fn::GetAZs": "" }],
                        },
                        "CidrBlock": "10.0.0.0/24",
                        "AvailabilityZone": {
                            "Fn::Select": ["0", { "Fn::GetAZs": "eu-west-2" }],
                        },
                    },
                },
                "Subnet2": {
                    "Type": "AWS::EC2::Subnet",
                    "Properties": {
                        "VpcId": {
                            "Ref": "Subnet1",
                        },
                        "CidrBlock": "10.0.0.0/24",
                        "AvailabilityZone": {
                            "Fn::Select": [0, { "Fn::GetAZs": "eu-west-2" }],
                        },
                    },
                },
            },
        });
    });
    test('can ingest a template with the short form !ImportValue function', () => {
        includeTestTemplate(stack, 'short-form-import-value.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "Resources": {
                "Bucket1": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": {
                            "Fn::ImportValue": "SomeSharedValue",
                        },
                    },
                },
            },
        });
    });
    test('can ingest a template with the short form !Join function', () => {
        includeTestTemplate(stack, 'short-form-join.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "Resources": {
                "Bucket": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": {
                            "Fn::Join": [' ', [
                                    "NamePart1 ",
                                    { "Fn::ImportValue": "SomeSharedValue" },
                                ]],
                        },
                    },
                },
            },
        });
    });
    test('can ingest a template with the short form !Split function that uses both brackets and hyphens', () => {
        includeTestTemplate(stack, 'short-form-split.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "Resources": {
                "Bucket1": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": {
                            "Fn::Split": [' ', {
                                    "Fn::ImportValue": "SomeSharedBucketName",
                                }],
                        },
                    },
                },
                "Bucket2": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": {
                            "Fn::Split": [' ', {
                                    "Fn::ImportValue": "SomeSharedBucketName",
                                }],
                        },
                    },
                },
            },
        });
    });
    test('can ingest a template with the short form !Transform function', () => {
        // Note that this yaml template fails validation. It is unclear how to invoke !Transform.
        includeTestTemplate(stack, 'invalid/short-form-transform.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "Resources": {
                "Bucket": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": {
                            "Fn::Transform": {
                                "Name": "SomeMacroName",
                                "Parameters": {
                                    "key1": "value1",
                                    "key2": "value2",
                                },
                            },
                        },
                    },
                },
            },
        });
    });
    test('can ingest a template with the short form conditionals', () => {
        includeTestTemplate(stack, 'short-form-conditionals.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "Conditions": {
                "AlwaysTrueCond": {
                    "Fn::And": [
                        {
                            "Fn::Not": [
                                { "Fn::Equals": [{ "Ref": "AWS::Region" }, "completely-made-up-region"] },
                            ],
                        },
                        {
                            "Fn::Or": [
                                { "Fn::Equals": [{ "Ref": "AWS::Region" }, "completely-made-up-region"] },
                                { "Fn::Equals": [{ "Ref": "AWS::Region" }, "completely-made-up-region"] },
                            ],
                        },
                    ],
                },
            },
            "Resources": {
                "Bucket": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": {
                            "Fn::If": [
                                "AlwaysTrueCond",
                                "MyBucketName",
                                { "Ref": "AWS::NoValue" },
                            ],
                        },
                    },
                },
            },
        });
    });
    test('can ingest a template with the short form Conditions', () => {
        includeTestTemplate(stack, 'short-form-conditions.yaml');
        assertions_1.Template.fromStack(stack).templateMatches({
            "Conditions": {
                "AlwaysTrueCond": {
                    "Fn::Not": [
                        { "Fn::Equals": [{ "Ref": "AWS::Region" }, "completely-made-up-region1"] },
                    ],
                },
                "AnotherAlwaysTrueCond": {
                    "Fn::Not": [
                        { "Fn::Equals": [{ "Ref": "AWS::Region" }, "completely-made-up-region2"] },
                    ],
                },
                "ThirdAlwaysTrueCond": {
                    "Fn::Not": [
                        { "Fn::Equals": [{ "Ref": "AWS::Region" }, "completely-made-up-region3"] },
                    ],
                },
                "CombinedCond": {
                    "Fn::Or": [
                        { "Condition": "AlwaysTrueCond" },
                        { "Condition": "AnotherAlwaysTrueCond" },
                        { "Condition": "ThirdAlwaysTrueCond" },
                    ],
                },
            },
            "Resources": {
                "Bucket": {
                    "Type": "AWS::S3::Bucket",
                    "Properties": {
                        "BucketName": {
                            "Fn::If": [
                                "CombinedCond",
                                "MyBucketName",
                                { "Ref": "AWS::NoValue" },
                            ],
                        },
                    },
                },
            },
        });
    });
    test('can ingest a yaml with long-form functions and output it unchanged', () => {
        includeTestTemplate(stack, 'long-form-subnet.yaml');
        assertions_1.Template.fromStack(stack).templateMatches(loadTestFileToJsObject('long-form-subnet.yaml'));
    });
    test('can ingest a YAML template with Fn::Sub in string form and output it unchanged', () => {
        includeTestTemplate(stack, 'short-form-fnsub-string.yaml');
        assertions_1.Template.fromStack(stack).templateMatches(loadTestFileToJsObject('short-form-fnsub-string.yaml'));
    });
    test('can ingest a YAML template with Fn::Sub in map form and output it unchanged', () => {
        includeTestTemplate(stack, 'short-form-sub-map.yaml');
        assertions_1.Template.fromStack(stack).templateMatches(loadTestFileToJsObject('short-form-sub-map.yaml'));
    });
    test('can correctly substitute values inside a string containing JSON passed to Fn::Sub', () => {
        const cfnInclude = includeTestTemplate(stack, 'json-in-fn-sub.yaml', {
            Stage: 'test',
        });
        const dashboard = cfnInclude.getResource('Dashboard');
        // we need to resolve the Fn::Sub expression to get to its argument
        const resolvedDashboardBody = stack.resolve(dashboard.dashboardBody)['Fn::Sub'];
        expect(JSON.parse(resolvedDashboardBody)).toStrictEqual({
            "widgets": [
                {
                    "type": "text",
                    "properties": {
                        "markdown": "test test",
                    },
                },
                {
                    "type": "text",
                    "properties": {
                        "markdown": "test test",
                    },
                },
            ],
        });
    });
    test('the parser throws an error on a YAML template with short form import value that uses short form sub', () => {
        expect(() => {
            includeTestTemplate(stack, 'invalid/short-form-import-sub.yaml');
        }).toThrow(/A node can have at most one tag/);
    });
});
function includeTestTemplate(scope, testTemplate, parameters) {
    return new inc.CfnInclude(scope, 'MyScope', {
        templateFile: _testTemplateFilePath(testTemplate),
        parameters,
    });
}
function loadTestFileToJsObject(testTemplate) {
    return futils.readYamlSync(_testTemplateFilePath(testTemplate));
}
function _testTemplateFilePath(testTemplate) {
    return path.join(__dirname, 'test-templates/yaml', testTemplate);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieWFtbC10ZW1wbGF0ZXMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInlhbWwtdGVtcGxhdGVzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2QkFBNkI7QUFDN0IsaURBQTRDO0FBRTVDLG1DQUFtQztBQUVuQyw4QkFBOEI7QUFDOUIsNENBQTRDO0FBRTVDLGdDQUFnQztBQUNoQywyQkFBMkI7QUFFM0IsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7SUFDM0IsSUFBSSxLQUFpQixDQUFDO0lBRXRCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxLQUFLLEdBQUcsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDM0IsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsMkZBQTJGLEVBQUUsR0FBRyxFQUFFO1FBQ3JHLG1CQUFtQixDQUFDLEtBQUssRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO1FBRWpELHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLGVBQWUsQ0FDdkMsc0JBQXNCLENBQUMsb0JBQW9CLENBQUMsQ0FDN0MsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLDZFQUE2RSxFQUFFLEdBQUcsRUFBRTtRQUN2RixtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsaUNBQWlDLENBQUMsQ0FBQztRQUU5RCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxlQUFlLENBQUM7WUFDeEMsMEJBQTBCLEVBQUUsWUFBWTtZQUN4QyxXQUFXLEVBQUU7Z0JBQ1gsTUFBTSxFQUFFO29CQUNOLE1BQU0sRUFBRSxnQkFBZ0I7b0JBQ3hCLFlBQVksRUFBRTt3QkFDWiwwQkFBMEIsRUFBRTs0QkFDMUIsU0FBUyxFQUFFLFlBQVk7NEJBQ3ZCLFdBQVcsRUFBRTtnQ0FDWDtvQ0FDRSxRQUFRLEVBQUUsT0FBTztvQ0FDakIsV0FBVyxFQUFFO3dDQUNYLFNBQVMsRUFBRSxD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QUNGO2dCQUNEO29CQUNFLE1BQU0sRUFBRSxNQUFNO29CQUNkLFlBQVksRUFBRTt3QkFDWixVQUFVLEVBQUUsV0FBVztxQkFDeEI7aUJBQ0Y7YUFDRjtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHFHQUFxRyxFQUFFLEdBQUcsRUFBRTtRQUMvRyxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsbUJBQW1CLENBQUMsS0FBSyxFQUFFLG9DQUFvQyxDQUFDLENBQUM7UUFDbkUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7SUFDaEQsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILFNBQVMsbUJBQW1CLENBQUMsS0FBMkIsRUFBRSxZQUFvQixFQUFFLFVBQXNDO0lBQ3BILE9BQU8sSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUU7UUFDMUMsWUFBWSxFQUFFLHFCQUFxQixDQUFDLFlBQVksQ0FBQztRQUNqRCxVQUFVO0tBQ1gsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVELFNBQVMsc0JBQXNCLENBQUMsWUFBb0I7SUFDbEQsT0FBTyxNQUFNLENBQUMsWUFBWSxDQUFDLHFCQUFxQixDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7QUFDbEUsQ0FBQztBQUVELFNBQVMscUJBQXFCLENBQUMsWUFBb0I7SUFDakQsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxxQkFBcUIsRUFBRSxZQUFZLENBQUMsQ0FBQztBQUNuRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgKiBhcyBjbG91ZHdhdGNoIGZyb20gJy4uLy4uL2F3cy1jbG91ZHdhdGNoJztcbmltcG9ydCAqIGFzIGNvcmUgZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgKiBhcyBjb25zdHJ1Y3RzIGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0ICogYXMgaW5jIGZyb20gJy4uL2xpYic7XG5pbXBvcnQgKiBhcyBmdXRpbHMgZnJvbSAnLi4vbGliL2ZpbGUtdXRpbHMnO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBxdW90ZS1wcm9wcyAqL1xuLyogZXNsaW50LWRpc2FibGUgcXVvdGVzICovXG5cbmRlc2NyaWJlKCdDREsgSW5jbHVkZScsICgpID0+IHtcbiAgbGV0IHN0YWNrOiBjb3JlLlN0YWNrO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHN0YWNrID0gbmV3IGNvcmUuU3RhY2soKTtcbiAgfSk7XG5cbiAgdGVzdCgnY2FuIGluZ2VzdCBhIHRlbXBsYXRlIHdpdGggYWxsIGxvbmctZm9ybSBDbG91ZEZvcm1hdGlvbiBmdW5jdGlvbnMgYW5kIG91dHB1dCBpdCB1bmNoYW5nZWQnLCAoKSA9PiB7XG4gICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ2xvbmctZm9ybS12cGMueWFtbCcpO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoXG4gICAgICBsb2FkVGVzdEZpbGVUb0pzT2JqZWN0KCdsb25nLWZvcm0tdnBjLnlhbWwnKSxcbiAgICApO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gaW5nZXN0IGEgdGVtcGxhdGUgd2l0aCB5ZWFyLW1vbnRoLWRhdGUgcGFyc2VkIGFzIHN0cmluZyBpbnN0ZWFkIG9mIERhdGUnLCAoKSA9PiB7XG4gICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ3llYXItbW9udGgtZGF0ZS1hcy1zdHJpbmdzLnlhbWwnKTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykudGVtcGxhdGVNYXRjaGVzKHtcbiAgICAgIFwiQVdTVGVtcGxhdGVGb3JtYXRWZXJzaW9uXCI6IFwiMjAxMC0wOS0wOVwiLFxuICAgICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgICBcIlJvbGVcIjoge1xuICAgICAgICAgIFwiVHlwZVwiOiBcIkFXUzo6SUFNOjpSb2xlXCIsXG4gICAgICAgICAgXCJQcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgIFwiQXNzdW1lUm9sZVBvbGljeURvY3VtZW50XCI6IHtcbiAgICAgICAgICAgICAgXCJWZXJzaW9uXCI6IFwiMjAxMi0xMC0xN1wiLFxuICAgICAgICAgICAgICBcIlN0YXRlbWVudFwiOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgXCJFZmZlY3RcIjogXCJBbGxvd1wiLFxuICAgICAgICAgICAgICAgICAgXCJQcmluY2lwYWxcIjoge1xuICAgICAgICAgICAgICAgICAgICBcIlNlcnZpY2VcIjogW1wiZWMyLmFtYXpvbmF3cy5jb21cIl0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgXCJBY3Rpb25cIjogW1wic3RzOkFzc3VtZVJvbGVcIl0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBpbmdlc3QgYSB0ZW1wbGF0ZSB3aXRoIHRoZSBzaG9ydCBmb3JtIEJhc2U2NCBmdW5jdGlvbicsICgpID0+IHtcbiAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnc2hvcnQtZm9ybS1iYXNlNjQueWFtbCcpO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoe1xuICAgICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgICBcIkJhc2U2NEJ1Y2tldFwiOiB7XG4gICAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpTMzo6QnVja2V0XCIsXG4gICAgICAgICAgXCJQcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgIFwiQnVja2V0TmFtZVwiOiB7XG4gICAgICAgICAgICAgIFwiRm46OkJhc2U2NFwiOiBcIk5vbkJhc2U2NEJ1Y2tldE5hbWVcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBpbmdlc3QgYSB0ZW1wbGF0ZSB3aXRoIHRoZSBzaG9ydCBmb3JtICFDaWRyIGZ1bmN0aW9uJywgKCkgPT4ge1xuICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdzaG9ydC1mb3JtLWNpZHIueWFtbCcpO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoe1xuICAgICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgICBcIkNpZHJWcGMxXCI6IHtcbiAgICAgICAgICBcIlR5cGVcIjogXCJBV1M6OkVDMjo6VlBDXCIsXG4gICAgICAgICAgXCJQcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgIFwiQ2lkckJsb2NrXCI6IHtcbiAgICAgICAgICAgICAgXCJGbjo6Q2lkclwiOiBbXG4gICAgICAgICAgICAgICAgXCIxOTIuMTY4LjEuMS8yNFwiLFxuICAgICAgICAgICAgICAgIDIsXG4gICAgICAgICAgICAgICAgNSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgXCJDaWRyVnBjMlwiOiB7XG4gICAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpFQzI6OlZQQ1wiLFxuICAgICAgICAgIFwiUHJvcGVydGllc1wiOiB7XG4gICAgICAgICAgICBcIkNpZHJCbG9ja1wiOiB7XG4gICAgICAgICAgICAgIFwiRm46OkNpZHJcIjogW1xuICAgICAgICAgICAgICAgIFwiMTkyLjE2OC4xLjEvMjRcIixcbiAgICAgICAgICAgICAgICBcIjJcIixcbiAgICAgICAgICAgICAgICBcIjVcIixcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBpbmdlc3QgYSB0ZW1wbGF0ZSB3aXRoIHRoZSBzaG9ydCBmb3JtICFGaW5kSW5NYXAgZnVuY3Rpb24sIGluIGJvdGggaHlwaGVuIGFuZCBicmFja2V0IG5vdGF0aW9uJywgKCkgPT4ge1xuICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdzaG9ydC1mb3JtLWZpbmQtaW4tbWFwLnlhbWwnKTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykudGVtcGxhdGVNYXRjaGVzKHtcbiAgICAgIFwiTWFwcGluZ3NcIjoge1xuICAgICAgICBcIlJlZ2lvbk1hcFwiOiB7XG4gICAgICAgICAgXCJyZWdpb24tMVwiOiB7XG4gICAgICAgICAgICBcIkhWTTY0XCI6IFwibmFtZTFcIixcbiAgICAgICAgICAgIFwiSFZNRzJcIjogXCJuYW1lMlwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgICBcIkJ1Y2tldDFcIjoge1xuICAgICAgICAgIFwiVHlwZVwiOiBcIkFXUzo6UzM6OkJ1Y2tldFwiLFxuICAgICAgICAgIFwiUHJvcGVydGllc1wiOiB7XG4gICAgICAgICAgICBcIkJ1Y2tldE5hbWVcIjoge1xuICAgICAgICAgICAgICBcIkZuOjpGaW5kSW5NYXBcIjogW1xuICAgICAgICAgICAgICAgIFwiUmVnaW9uTWFwXCIsXG4gICAgICAgICAgICAgICAgXCJyZWdpb24tMVwiLFxuICAgICAgICAgICAgICAgIFwiSFZNNjRcIixcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgXCJCdWNrZXQyXCI6IHtcbiAgICAgICAgICBcIlR5cGVcIjogXCJBV1M6OlMzOjpCdWNrZXRcIixcbiAgICAgICAgICBcIlByb3BlcnRpZXNcIjoge1xuICAgICAgICAgICAgXCJCdWNrZXROYW1lXCI6IHtcbiAgICAgICAgICAgICAgXCJGbjo6RmluZEluTWFwXCI6IFtcbiAgICAgICAgICAgICAgICBcIlJlZ2lvbk1hcFwiLFxuICAgICAgICAgICAgICAgIFwicmVnaW9uLTFcIixcbiAgICAgICAgICAgICAgICBcIkhWTUcyXCIsXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gaW5nZXN0IGEgdGVtcGxhdGUgd2l0aCB0aGUgc2hvcnQgZm9ybSAhR2V0QXR0IGZ1bmN0aW9uJywgKCkgPT4ge1xuICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdzaG9ydC1mb3JtLWdldC1hdHQueWFtbCcpO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoe1xuICAgICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgICBcIkVMQlwiOiB7XG4gICAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpFbGFzdGljTG9hZEJhbGFuY2luZzo6TG9hZEJhbGFuY2VyXCIsXG4gICAgICAgICAgXCJQcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgIFwiQXZhaWxhYmlsaXR5Wm9uZXNcIjogW1xuICAgICAgICAgICAgICBcInVzLWVhc3QtMWFcIixcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBcIkxpc3RlbmVyc1wiOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcIkxvYWRCYWxhbmNlclBvcnRcIjogXCI4MFwiLFxuICAgICAgICAgICAgICAgIFwiSW5zdGFuY2VQb3J0XCI6IFwiODBcIixcbiAgICAgICAgICAgICAgICBcIlByb3RvY29sXCI6IFwiSFRUUFwiLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBcIkJ1Y2tldDBcIjoge1xuICAgICAgICAgIFwiVHlwZVwiOiBcIkFXUzo6UzM6OkJ1Y2tldFwiLFxuICAgICAgICAgIFwiUHJvcGVydGllc1wiOiB7IFwiQnVja2V0TmFtZVwiOiBcInNvbWUtYnVja2V0XCIgfSxcbiAgICAgICAgfSxcbiAgICAgICAgXCJCdWNrZXQxXCI6IHtcbiAgICAgICAgICBcIlR5cGVcIjogXCJBV1M6OlMzOjpCdWNrZXRcIixcbiAgICAgICAgICBcIlByb3BlcnRpZXNcIjoge1xuICAgICAgICAgICAgXCJCdWNrZXROYW1lXCI6IHsgXCJGbjo6R2V0QXR0XCI6IFwiQnVja2V0MC5Bcm5cIiB9LFxuICAgICAgICAgICAgXCJBY2Nlc3NDb250cm9sXCI6IHsgXCJGbjo6R2V0QXR0XCI6IFtcIkVMQlwiLCBcIlNvdXJjZVNlY3VyaXR5R3JvdXAuR3JvdXBOYW1lXCJdIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgXCJCdWNrZXQyXCI6IHtcbiAgICAgICAgICBcIlR5cGVcIjogXCJBV1M6OlMzOjpCdWNrZXRcIixcbiAgICAgICAgICBcIlByb3BlcnRpZXNcIjoge1xuICAgICAgICAgICAgXCJCdWNrZXROYW1lXCI6IHsgXCJGbjo6R2V0QXR0XCI6IFtcIkJ1Y2tldDFcIiwgXCJBcm5cIl0gfSxcbiAgICAgICAgICAgIFwiQWNjZXNzQ29udHJvbFwiOiB7IFwiRm46OkdldEF0dFwiOiBcIkVMQi5Tb3VyY2VTZWN1cml0eUdyb3VwLkdyb3VwTmFtZVwiIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBpbmdlc3QgYSB0ZW1wbGF0ZSB3aXRoIHNob3J0IGZvcm0gU2VsZWN0LCBHZXRBWnMsIGFuZCBSZWYgZnVuY3Rpb25zJywgKCkgPT4ge1xuICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdzaG9ydC1mb3JtLXNlbGVjdC55YW1sJyk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLnRlbXBsYXRlTWF0Y2hlcyh7XG4gICAgICBcIlJlc291cmNlc1wiOiB7XG4gICAgICAgIFwiU3VibmV0MVwiOiB7XG4gICAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpFQzI6OlN1Ym5ldFwiLFxuICAgICAgICAgIFwiUHJvcGVydGllc1wiOiB7XG4gICAgICAgICAgICBcIlZwY0lkXCI6IHtcbiAgICAgICAgICAgICAgXCJGbjo6U2VsZWN0XCI6IFswLCB7IFwiRm46OkdldEFac1wiOiBcIlwiIH1dLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiQ2lkckJsb2NrXCI6IFwiMTAuMC4wLjAvMjRcIixcbiAgICAgICAgICAgIFwiQXZhaWxhYmlsaXR5Wm9uZVwiOiB7XG4gICAgICAgICAgICAgIFwiRm46OlNlbGVjdFwiOiBbXCIwXCIsIHsgXCJGbjo6R2V0QVpzXCI6IFwiZXUtd2VzdC0yXCIgfV0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIFwiU3VibmV0MlwiOiB7XG4gICAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpFQzI6OlN1Ym5ldFwiLFxuICAgICAgICAgIFwiUHJvcGVydGllc1wiOiB7XG4gICAgICAgICAgICBcIlZwY0lkXCI6IHtcbiAgICAgICAgICAgICAgXCJSZWZcIjogXCJTdWJuZXQxXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJDaWRyQmxvY2tcIjogXCIxMC4wLjAuMC8yNFwiLFxuICAgICAgICAgICAgXCJBdmFpbGFiaWxpdHlab25lXCI6IHtcbiAgICAgICAgICAgICAgXCJGbjo6U2VsZWN0XCI6IFswLCB7IFwiRm46OkdldEFac1wiOiBcImV1LXdlc3QtMlwiIH1dLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnY2FuIGluZ2VzdCBhIHRlbXBsYXRlIHdpdGggdGhlIHNob3J0IGZvcm0gIUltcG9ydFZhbHVlIGZ1bmN0aW9uJywgKCkgPT4ge1xuICAgIGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdzaG9ydC1mb3JtLWltcG9ydC12YWx1ZS55YW1sJyk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLnRlbXBsYXRlTWF0Y2hlcyh7XG4gICAgICBcIlJlc291cmNlc1wiOiB7XG4gICAgICAgIFwiQnVja2V0MVwiOiB7XG4gICAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpTMzo6QnVja2V0XCIsXG4gICAgICAgICAgXCJQcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgIFwiQnVja2V0TmFtZVwiOiB7XG4gICAgICAgICAgICAgIFwiRm46OkltcG9ydFZhbHVlXCI6IFwiU29tZVNoYXJlZFZhbHVlXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gaW5nZXN0IGEgdGVtcGxhdGUgd2l0aCB0aGUgc2hvcnQgZm9ybSAhSm9pbiBmdW5jdGlvbicsICgpID0+IHtcbiAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnc2hvcnQtZm9ybS1qb2luLnlhbWwnKTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykudGVtcGxhdGVNYXRjaGVzKHtcbiAgICAgIFwiUmVzb3VyY2VzXCI6IHtcbiAgICAgICAgXCJCdWNrZXRcIjoge1xuICAgICAgICAgIFwiVHlwZVwiOiBcIkFXUzo6UzM6OkJ1Y2tldFwiLFxuICAgICAgICAgIFwiUHJvcGVydGllc1wiOiB7XG4gICAgICAgICAgICBcIkJ1Y2tldE5hbWVcIjoge1xuICAgICAgICAgICAgICBcIkZuOjpKb2luXCI6IFsnICcsIFtcbiAgICAgICAgICAgICAgICBcIk5hbWVQYXJ0MSBcIixcbiAgICAgICAgICAgICAgICB7IFwiRm46OkltcG9ydFZhbHVlXCI6IFwiU29tZVNoYXJlZFZhbHVlXCIgfSxcbiAgICAgICAgICAgICAgXV0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gaW5nZXN0IGEgdGVtcGxhdGUgd2l0aCB0aGUgc2hvcnQgZm9ybSAhU3BsaXQgZnVuY3Rpb24gdGhhdCB1c2VzIGJvdGggYnJhY2tldHMgYW5kIGh5cGhlbnMnLCAoKSA9PiB7XG4gICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ3Nob3J0LWZvcm0tc3BsaXQueWFtbCcpO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoe1xuICAgICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgICBcIkJ1Y2tldDFcIjoge1xuICAgICAgICAgIFwiVHlwZVwiOiBcIkFXUzo6UzM6OkJ1Y2tldFwiLFxuICAgICAgICAgIFwiUHJvcGVydGllc1wiOiB7XG4gICAgICAgICAgICBcIkJ1Y2tldE5hbWVcIjoge1xuICAgICAgICAgICAgICBcIkZuOjpTcGxpdFwiOiBbJyAnLCB7XG4gICAgICAgICAgICAgICAgXCJGbjo6SW1wb3J0VmFsdWVcIjogXCJTb21lU2hhcmVkQnVja2V0TmFtZVwiLFxuICAgICAgICAgICAgICB9XSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgXCJCdWNrZXQyXCI6IHtcbiAgICAgICAgICBcIlR5cGVcIjogXCJBV1M6OlMzOjpCdWNrZXRcIixcbiAgICAgICAgICBcIlByb3BlcnRpZXNcIjoge1xuICAgICAgICAgICAgXCJCdWNrZXROYW1lXCI6IHtcbiAgICAgICAgICAgICAgXCJGbjo6U3BsaXRcIjogWycgJywge1xuICAgICAgICAgICAgICAgIFwiRm46OkltcG9ydFZhbHVlXCI6IFwiU29tZVNoYXJlZEJ1Y2tldE5hbWVcIixcbiAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gaW5nZXN0IGEgdGVtcGxhdGUgd2l0aCB0aGUgc2hvcnQgZm9ybSAhVHJhbnNmb3JtIGZ1bmN0aW9uJywgKCkgPT4ge1xuICAgIC8vIE5vdGUgdGhhdCB0aGlzIHlhbWwgdGVtcGxhdGUgZmFpbHMgdmFsaWRhdGlvbi4gSXQgaXMgdW5jbGVhciBob3cgdG8gaW52b2tlICFUcmFuc2Zvcm0uXG4gICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ2ludmFsaWQvc2hvcnQtZm9ybS10cmFuc2Zvcm0ueWFtbCcpO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoe1xuICAgICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgICBcIkJ1Y2tldFwiOiB7XG4gICAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpTMzo6QnVja2V0XCIsXG4gICAgICAgICAgXCJQcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgIFwiQnVja2V0TmFtZVwiOiB7XG4gICAgICAgICAgICAgIFwiRm46OlRyYW5zZm9ybVwiOiB7XG4gICAgICAgICAgICAgICAgXCJOYW1lXCI6IFwiU29tZU1hY3JvTmFtZVwiLFxuICAgICAgICAgICAgICAgIFwiUGFyYW1ldGVyc1wiOiB7XG4gICAgICAgICAgICAgICAgICBcImtleTFcIjogXCJ2YWx1ZTFcIixcbiAgICAgICAgICAgICAgICAgIFwia2V5MlwiOiBcInZhbHVlMlwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gaW5nZXN0IGEgdGVtcGxhdGUgd2l0aCB0aGUgc2hvcnQgZm9ybSBjb25kaXRpb25hbHMnLCAoKSA9PiB7XG4gICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ3Nob3J0LWZvcm0tY29uZGl0aW9uYWxzLnlhbWwnKTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykudGVtcGxhdGVNYXRjaGVzKHtcbiAgICAgIFwiQ29uZGl0aW9uc1wiOiB7XG4gICAgICAgIFwiQWx3YXlzVHJ1ZUNvbmRcIjoge1xuICAgICAgICAgIFwiRm46OkFuZFwiOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFwiRm46Ok5vdFwiOiBbXG4gICAgICAgICAgICAgICAgeyBcIkZuOjpFcXVhbHNcIjogW3sgXCJSZWZcIjogXCJBV1M6OlJlZ2lvblwiIH0sIFwiY29tcGxldGVseS1tYWRlLXVwLXJlZ2lvblwiXSB9LFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgXCJGbjo6T3JcIjogW1xuICAgICAgICAgICAgICAgIHsgXCJGbjo6RXF1YWxzXCI6IFt7IFwiUmVmXCI6IFwiQVdTOjpSZWdpb25cIiB9LCBcImNvbXBsZXRlbHktbWFkZS11cC1yZWdpb25cIl0gfSxcbiAgICAgICAgICAgICAgICB7IFwiRm46OkVxdWFsc1wiOiBbeyBcIlJlZlwiOiBcIkFXUzo6UmVnaW9uXCIgfSwgXCJjb21wbGV0ZWx5LW1hZGUtdXAtcmVnaW9uXCJdIH0sXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgICBcIkJ1Y2tldFwiOiB7XG4gICAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpTMzo6QnVja2V0XCIsXG4gICAgICAgICAgXCJQcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgIFwiQnVja2V0TmFtZVwiOiB7XG4gICAgICAgICAgICAgIFwiRm46OklmXCI6IFtcbiAgICAgICAgICAgICAgICBcIkFsd2F5c1RydWVDb25kXCIsXG4gICAgICAgICAgICAgICAgXCJNeUJ1Y2tldE5hbWVcIixcbiAgICAgICAgICAgICAgICB7IFwiUmVmXCI6IFwiQVdTOjpOb1ZhbHVlXCIgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBpbmdlc3QgYSB0ZW1wbGF0ZSB3aXRoIHRoZSBzaG9ydCBmb3JtIENvbmRpdGlvbnMnLCAoKSA9PiB7XG4gICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ3Nob3J0LWZvcm0tY29uZGl0aW9ucy55YW1sJyk7XG5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLnRlbXBsYXRlTWF0Y2hlcyh7XG4gICAgICBcIkNvbmRpdGlvbnNcIjoge1xuICAgICAgICBcIkFsd2F5c1RydWVDb25kXCI6IHtcbiAgICAgICAgICBcIkZuOjpOb3RcIjogW1xuICAgICAgICAgICAgeyBcIkZuOjpFcXVhbHNcIjogW3sgXCJSZWZcIjogXCJBV1M6OlJlZ2lvblwiIH0sIFwiY29tcGxldGVseS1tYWRlLXVwLXJlZ2lvbjFcIl0gfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBcIkFub3RoZXJBbHdheXNUcnVlQ29uZFwiOiB7XG4gICAgICAgICAgXCJGbjo6Tm90XCI6IFtcbiAgICAgICAgICAgIHsgXCJGbjo6RXF1YWxzXCI6IFt7IFwiUmVmXCI6IFwiQVdTOjpSZWdpb25cIiB9LCBcImNvbXBsZXRlbHktbWFkZS11cC1yZWdpb24yXCJdIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICAgXCJUaGlyZEFsd2F5c1RydWVDb25kXCI6IHtcbiAgICAgICAgICBcIkZuOjpOb3RcIjogW1xuICAgICAgICAgICAgeyBcIkZuOjpFcXVhbHNcIjogW3sgXCJSZWZcIjogXCJBV1M6OlJlZ2lvblwiIH0sIFwiY29tcGxldGVseS1tYWRlLXVwLXJlZ2lvbjNcIl0gfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBcIkNvbWJpbmVkQ29uZFwiOiB7XG4gICAgICAgICAgXCJGbjo6T3JcIjogW1xuICAgICAgICAgICAgeyBcIkNvbmRpdGlvblwiOiBcIkFsd2F5c1RydWVDb25kXCIgfSxcbiAgICAgICAgICAgIHsgXCJDb25kaXRpb25cIjogXCJBbm90aGVyQWx3YXlzVHJ1ZUNvbmRcIiB9LFxuICAgICAgICAgICAgeyBcIkNvbmRpdGlvblwiOiBcIlRoaXJkQWx3YXlzVHJ1ZUNvbmRcIiB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgXCJSZXNvdXJjZXNcIjoge1xuICAgICAgICBcIkJ1Y2tldFwiOiB7XG4gICAgICAgICAgXCJUeXBlXCI6IFwiQVdTOjpTMzo6QnVja2V0XCIsXG4gICAgICAgICAgXCJQcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgIFwiQnVja2V0TmFtZVwiOiB7XG4gICAgICAgICAgICAgIFwiRm46OklmXCI6IFtcbiAgICAgICAgICAgICAgICBcIkNvbWJpbmVkQ29uZFwiLFxuICAgICAgICAgICAgICAgIFwiTXlCdWNrZXROYW1lXCIsXG4gICAgICAgICAgICAgICAgeyBcIlJlZlwiOiBcIkFXUzo6Tm9WYWx1ZVwiIH0sXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gaW5nZXN0IGEgeWFtbCB3aXRoIGxvbmctZm9ybSBmdW5jdGlvbnMgYW5kIG91dHB1dCBpdCB1bmNoYW5nZWQnLCAoKSA9PiB7XG4gICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ2xvbmctZm9ybS1zdWJuZXQueWFtbCcpO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS50ZW1wbGF0ZU1hdGNoZXMoXG4gICAgICBsb2FkVGVzdEZpbGVUb0pzT2JqZWN0KCdsb25nLWZvcm0tc3VibmV0LnlhbWwnKSxcbiAgICApO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gaW5nZXN0IGEgWUFNTCB0ZW1wbGF0ZSB3aXRoIEZuOjpTdWIgaW4gc3RyaW5nIGZvcm0gYW5kIG91dHB1dCBpdCB1bmNoYW5nZWQnLCAoKSA9PiB7XG4gICAgaW5jbHVkZVRlc3RUZW1wbGF0ZShzdGFjaywgJ3Nob3J0LWZvcm0tZm5zdWItc3RyaW5nLnlhbWwnKTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykudGVtcGxhdGVNYXRjaGVzKFxuICAgICAgbG9hZFRlc3RGaWxlVG9Kc09iamVjdCgnc2hvcnQtZm9ybS1mbnN1Yi1zdHJpbmcueWFtbCcpLFxuICAgICk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBpbmdlc3QgYSBZQU1MIHRlbXBsYXRlIHdpdGggRm46OlN1YiBpbiBtYXAgZm9ybSBhbmQgb3V0cHV0IGl0IHVuY2hhbmdlZCcsICgpID0+IHtcbiAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnc2hvcnQtZm9ybS1zdWItbWFwLnlhbWwnKTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykudGVtcGxhdGVNYXRjaGVzKFxuICAgICAgbG9hZFRlc3RGaWxlVG9Kc09iamVjdCgnc2hvcnQtZm9ybS1zdWItbWFwLnlhbWwnKSxcbiAgICApO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gY29ycmVjdGx5IHN1YnN0aXR1dGUgdmFsdWVzIGluc2lkZSBhIHN0cmluZyBjb250YWluaW5nIEpTT04gcGFzc2VkIHRvIEZuOjpTdWInLCAoKSA9PiB7XG4gICAgY29uc3QgY2ZuSW5jbHVkZSA9IGluY2x1ZGVUZXN0VGVtcGxhdGUoc3RhY2ssICdqc29uLWluLWZuLXN1Yi55YW1sJywge1xuICAgICAgU3RhZ2U6ICd0ZXN0JyxcbiAgICB9KTtcblxuICAgIGNvbnN0IGRhc2hib2FyZCA9IGNmbkluY2x1ZGUuZ2V0UmVzb3VyY2UoJ0Rhc2hib2FyZCcpIGFzIGNsb3Vkd2F0Y2guQ2ZuRGFzaGJvYXJkO1xuICAgIC8vIHdlIG5lZWQgdG8gcmVzb2x2ZSB0aGUgRm46OlN1YiBleHByZXNzaW9uIHRvIGdldCB0byBpdHMgYXJndW1lbnRcbiAgICBjb25zdCByZXNvbHZlZERhc2hib2FyZEJvZHkgPSBzdGFjay5yZXNvbHZlKGRhc2hib2FyZC5kYXNoYm9hcmRCb2R5KVsnRm46OlN1YiddO1xuICAgIGV4cGVjdChKU09OLnBhcnNlKHJlc29sdmVkRGFzaGJvYXJkQm9keSkpLnRvU3RyaWN0RXF1YWwoe1xuICAgICAgXCJ3aWRnZXRzXCI6IFtcbiAgICAgICAge1xuICAgICAgICAgIFwidHlwZVwiOiBcInRleHRcIixcbiAgICAgICAgICBcInByb3BlcnRpZXNcIjoge1xuICAgICAgICAgICAgXCJtYXJrZG93blwiOiBcInRlc3QgdGVzdFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBcInR5cGVcIjogXCJ0ZXh0XCIsXG4gICAgICAgICAgXCJwcm9wZXJ0aWVzXCI6IHtcbiAgICAgICAgICAgIFwibWFya2Rvd25cIjogXCJ0ZXN0IHRlc3RcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgndGhlIHBhcnNlciB0aHJvd3MgYW4gZXJyb3Igb24gYSBZQU1MIHRlbXBsYXRlIHdpdGggc2hvcnQgZm9ybSBpbXBvcnQgdmFsdWUgdGhhdCB1c2VzIHNob3J0IGZvcm0gc3ViJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBpbmNsdWRlVGVzdFRlbXBsYXRlKHN0YWNrLCAnaW52YWxpZC9zaG9ydC1mb3JtLWltcG9ydC1zdWIueWFtbCcpO1xuICAgIH0pLnRvVGhyb3coL0Egbm9kZSBjYW4gaGF2ZSBhdCBtb3N0IG9uZSB0YWcvKTtcbiAgfSk7XG59KTtcblxuZnVuY3Rpb24gaW5jbHVkZVRlc3RUZW1wbGF0ZShzY29wZTogY29uc3RydWN0cy5Db25zdHJ1Y3QsIHRlc3RUZW1wbGF0ZTogc3RyaW5nLCBwYXJhbWV0ZXJzPzogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSk6IGluYy5DZm5JbmNsdWRlIHtcbiAgcmV0dXJuIG5ldyBpbmMuQ2ZuSW5jbHVkZShzY29wZSwgJ015U2NvcGUnLCB7XG4gICAgdGVtcGxhdGVGaWxlOiBfdGVzdFRlbXBsYXRlRmlsZVBhdGgodGVzdFRlbXBsYXRlKSxcbiAgICBwYXJhbWV0ZXJzLFxuICB9KTtcbn1cblxuZnVuY3Rpb24gbG9hZFRlc3RGaWxlVG9Kc09iamVjdCh0ZXN0VGVtcGxhdGU6IHN0cmluZyk6IGFueSB7XG4gIHJldHVybiBmdXRpbHMucmVhZFlhbWxTeW5jKF90ZXN0VGVtcGxhdGVGaWxlUGF0aCh0ZXN0VGVtcGxhdGUpKTtcbn1cblxuZnVuY3Rpb24gX3Rlc3RUZW1wbGF0ZUZpbGVQYXRoKHRlc3RUZW1wbGF0ZTogc3RyaW5nKSB7XG4gIHJldHVybiBwYXRoLmpvaW4oX19kaXJuYW1lLCAndGVzdC10ZW1wbGF0ZXMveWFtbCcsIHRlc3RUZW1wbGF0ZSk7XG59XG4iXX0=