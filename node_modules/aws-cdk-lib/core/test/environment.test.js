"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../lib");
describe('environment', () => {
    test('By default, environment region and account are not defined and resolve to intrinsics', () => {
        const stack = new lib_1.Stack();
        expect(lib_1.Token.isUnresolved(stack.account)).toEqual(true);
        expect(lib_1.Token.isUnresolved(stack.region)).toEqual(true);
        expect(stack.resolve(stack.account)).toEqual({ Ref: 'AWS::AccountId' });
        expect(stack.resolve(stack.region)).toEqual({ Ref: 'AWS::Region' });
    });
    test('If only `env.region` or `env.account` are specified, Refs will be used for the other', () => {
        const app = new lib_1.App();
        const stack1 = new lib_1.Stack(app, 'S1', { env: { region: 'only-region' } });
        const stack2 = new lib_1.Stack(app, 'S2', { env: { account: 'only-account' } });
        expect(stack1.resolve(stack1.account)).toEqual({ Ref: 'AWS::AccountId' });
        expect(stack1.resolve(stack1.region)).toEqual('only-region');
        expect(stack2.resolve(stack2.account)).toEqual('only-account');
        expect(stack2.resolve(stack2.region)).toEqual({ Ref: 'AWS::Region' });
    });
    describe('environment defaults', () => {
        test('if "env" is not specified, it implies account/region agnostic', () => {
            // GIVEN
            const app = new lib_1.App();
            // WHEN
            const stack = new lib_1.Stack(app, 'stack');
            // THEN
            expect(stack.resolve(stack.account)).toEqual({ Ref: 'AWS::AccountId' });
            expect(stack.resolve(stack.region)).toEqual({ Ref: 'AWS::Region' });
            expect(app.synth().getStackByName(stack.stackName).environment).toEqual({
                account: 'unknown-account',
                region: 'unknown-region',
                name: 'aws://unknown-account/unknown-region',
            });
        });
        test('only region is set', () => {
            // GIVEN
            const app = new lib_1.App();
            // WHEN
            const stack = new lib_1.Stack(app, 'stack', { env: { region: 'explicit-region' } });
            // THEN
            expect(stack.resolve(stack.account)).toEqual({ Ref: 'AWS::AccountId' });
            expect(stack.resolve(stack.region)).toEqual('explicit-region');
            expect(app.synth().getStackByName(stack.stackName).environment).toEqual({
                account: 'unknown-account',
                region: 'explicit-region',
                name: 'aws://unknown-account/explicit-region',
            });
        });
        test('both "region" and "account" are set', () => {
            // GIVEN
            const app = new lib_1.App();
            // WHEN
            const stack = new lib_1.Stack(app, 'stack', {
                env: {
                    account: 'explicit-account',
                    region: 'explicit-region',
                },
            });
            // THEN
            expect(stack.resolve(stack.account)).toEqual('explicit-account');
            expect(stack.resolve(stack.region)).toEqual('explicit-region');
            expect(app.synth().getStackByName(stack.stackName).environment).toEqual({
                account: 'explicit-account',
                region: 'explicit-region',
                name: 'aws://explicit-account/explicit-region',
            });
        });
        test('token-account and token-region', () => {
            // GIVEN
            const app = new lib_1.App();
            // WHEN
            const stack = new lib_1.Stack(app, 'stack', {
                env: {
                    account: lib_1.Aws.ACCOUNT_ID,
                    region: lib_1.Aws.REGION,
                },
            });
            // THEN
            expect(stack.resolve(stack.account)).toEqual({ Ref: 'AWS::AccountId' });
            expect(stack.resolve(stack.region)).toEqual({ Ref: 'AWS::Region' });
            expect(app.synth().getStackByName(stack.stackName).environment).toEqual({
                account: 'unknown-account',
                region: 'unknown-region',
                name: 'aws://unknown-account/unknown-region',
            });
        });
        test('token-account explicit region', () => {
            // GIVEN
            const app = new lib_1.App();
            // WHEN
            const stack = new lib_1.Stack(app, 'stack', {
                env: {
                    account: lib_1.Aws.ACCOUNT_ID,
                    region: 'us-east-2',
                },
            });
            // THEN
            expect(stack.resolve(stack.account)).toEqual({ Ref: 'AWS::AccountId' });
            expect(stack.resolve(stack.region)).toEqual('us-east-2');
            expect(app.synth().getStackByName(stack.stackName).environment).toEqual({
                account: 'unknown-account',
                region: 'us-east-2',
                name: 'aws://unknown-account/us-east-2',
            });
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW52aXJvbm1lbnQudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImVudmlyb25tZW50LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxnQ0FBZ0Q7QUFFaEQsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7SUFDM0IsSUFBSSxDQUFDLHNGQUFzRixFQUFFLEdBQUcsRUFBRTtRQUNoRyxNQUFNLEtBQUssR0FBRyxJQUFJLFdBQUssRUFBRSxDQUFDO1FBQzFCLE1BQU0sQ0FBQyxXQUFLLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RCxNQUFNLENBQUMsV0FBSyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkQsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFLENBQUMsQ0FBQztRQUN4RSxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxHQUFHLEVBQUUsYUFBYSxFQUFFLENBQUMsQ0FBQztJQUV0RSxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxzRkFBc0YsRUFBRSxHQUFHLEVBQUU7UUFDaEcsTUFBTSxHQUFHLEdBQUcsSUFBSSxTQUFHLEVBQUUsQ0FBQztRQUV0QixNQUFNLE1BQU0sR0FBRyxJQUFJLFdBQUssQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsTUFBTSxFQUFFLGFBQWEsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN4RSxNQUFNLE1BQU0sR0FBRyxJQUFJLFdBQUssQ0FBQyxHQUFH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LEtBQUssRUFBRSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsT0FBTyxDQUFDO2dCQUN0RSxPQUFPLEVBQUUsaUJBQWlCO2dCQUMxQixNQUFNLEVBQUUsV0FBVztnQkFDbkIsSUFBSSxFQUFFLGlDQUFpQzthQUN4QyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHAsIEF3cywgU3RhY2ssIFRva2VuIH0gZnJvbSAnLi4vbGliJztcblxuZGVzY3JpYmUoJ2Vudmlyb25tZW50JywgKCkgPT4ge1xuICB0ZXN0KCdCeSBkZWZhdWx0LCBlbnZpcm9ubWVudCByZWdpb24gYW5kIGFjY291bnQgYXJlIG5vdCBkZWZpbmVkIGFuZCByZXNvbHZlIHRvIGludHJpbnNpY3MnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICBleHBlY3QoVG9rZW4uaXNVbnJlc29sdmVkKHN0YWNrLmFjY291bnQpKS50b0VxdWFsKHRydWUpO1xuICAgIGV4cGVjdChUb2tlbi5pc1VucmVzb2x2ZWQoc3RhY2sucmVnaW9uKSkudG9FcXVhbCh0cnVlKTtcbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShzdGFjay5hY2NvdW50KSkudG9FcXVhbCh7IFJlZjogJ0FXUzo6QWNjb3VudElkJyB9KTtcbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShzdGFjay5yZWdpb24pKS50b0VxdWFsKHsgUmVmOiAnQVdTOjpSZWdpb24nIH0pO1xuXG4gIH0pO1xuXG4gIHRlc3QoJ0lmIG9ubHkgYGVudi5yZWdpb25gIG9yIGBlbnYuYWNjb3VudGAgYXJlIHNwZWNpZmllZCwgUmVmcyB3aWxsIGJlIHVzZWQgZm9yIHRoZSBvdGhlcicsICgpID0+IHtcbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG5cbiAgICBjb25zdCBzdGFjazEgPSBuZXcgU3RhY2soYXBwLCAnUzEnLCB7IGVudjogeyByZWdpb246ICdvbmx5LXJlZ2lvbicgfSB9KTtcbiAgICBjb25zdCBzdGFjazIgPSBuZXcgU3RhY2soYXBwLCAnUzInLCB7IGVudjogeyBhY2NvdW50OiAnb25seS1hY2NvdW50JyB9IH0pO1xuXG4gICAgZXhwZWN0KHN0YWNrMS5yZXNvbHZlKHN0YWNrMS5hY2NvdW50KSkudG9FcXVhbCh7IFJlZjogJ0FXUzo6QWNjb3VudElkJyB9KTtcbiAgICBleHBlY3Qoc3RhY2sxLnJlc29sdmUoc3RhY2sxLnJlZ2lvbikpLnRvRXF1YWwoJ29ubHktcmVnaW9uJyk7XG5cbiAgICBleHBlY3Qoc3RhY2syLnJlc29sdmUoc3RhY2syLmFjY291bnQpKS50b0VxdWFsKCdvbmx5LWFjY291bnQnKTtcbiAgICBleHBlY3Qoc3RhY2syLnJlc29sdmUoc3RhY2syLnJlZ2lvbikpLnRvRXF1YWwoeyBSZWY6ICdBV1M6OlJlZ2lvbicgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlbnZpcm9ubWVudCBkZWZhdWx0cycsICgpID0+IHtcbiAgICB0ZXN0KCdpZiBcImVudlwiIGlzIG5vdCBzcGVjaWZpZWQsIGl0IGltcGxpZXMgYWNjb3VudC9yZWdpb24gYWdub3N0aWMnLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHAsICdzdGFjaycpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShzdGFjay5hY2NvdW50KSkudG9FcXVhbCh7IFJlZjogJ0FXUzo6QWNjb3VudElkJyB9KTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKHN0YWNrLnJlZ2lvbikpLnRvRXF1YWwoeyBSZWY6ICdBV1M6OlJlZ2lvbicgfSk7XG4gICAgICBleHBlY3QoYXBwLnN5bnRoKCkuZ2V0U3RhY2tCeU5hbWUoc3RhY2suc3RhY2tOYW1lKS5lbnZpcm9ubWVudCkudG9FcXVhbCh7XG4gICAgICAgIGFjY291bnQ6ICd1bmtub3duLWFjY291bnQnLFxuICAgICAgICByZWdpb246ICd1bmtub3duLXJlZ2lvbicsXG4gICAgICAgIG5hbWU6ICdhd3M6Ly91bmtub3duLWFjY291bnQvdW5rbm93bi1yZWdpb24nLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdvbmx5IHJlZ2lvbiBpcyBzZXQnLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHAsICdzdGFjaycsIHsgZW52OiB7IHJlZ2lvbjogJ2V4cGxpY2l0LXJlZ2lvbicgfSB9KTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoc3RhY2suYWNjb3VudCkpLnRvRXF1YWwoeyBSZWY6ICdBV1M6OkFjY291bnRJZCcgfSk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShzdGFjay5yZWdpb24pKS50b0VxdWFsKCdleHBsaWNpdC1yZWdpb24nKTtcbiAgICAgIGV4cGVjdChhcHAuc3ludGgoKS5nZXRTdGFja0J5TmFtZShzdGFjay5zdGFja05hbWUpLmVudmlyb25tZW50KS50b0VxdWFsKHtcbiAgICAgICAgYWNjb3VudDogJ3Vua25vd24tYWNjb3VudCcsXG4gICAgICAgIHJlZ2lvbjogJ2V4cGxpY2l0LXJlZ2lvbicsXG4gICAgICAgIG5hbWU6ICdhd3M6Ly91bmtub3duLWFjY291bnQvZXhwbGljaXQtcmVnaW9uJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnYm90aCBcInJlZ2lvblwiIGFuZCBcImFjY291bnRcIiBhcmUgc2V0JywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnc3RhY2snLCB7XG4gICAgICAgIGVudjoge1xuICAgICAgICAgIGFjY291bnQ6ICdleHBsaWNpdC1hY2NvdW50JyxcbiAgICAgICAgICByZWdpb246ICdleHBsaWNpdC1yZWdpb24nLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKHN0YWNrLmFjY291bnQpKS50b0VxdWFsKCdleHBsaWNpdC1hY2NvdW50Jyk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShzdGFjay5yZWdpb24pKS50b0VxdWFsKCdleHBsaWNpdC1yZWdpb24nKTtcbiAgICAgIGV4cGVjdChhcHAuc3ludGgoKS5nZXRTdGFja0J5TmFtZShzdGFjay5zdGFja05hbWUpLmVudmlyb25tZW50KS50b0VxdWFsKHtcbiAgICAgICAgYWNjb3VudDogJ2V4cGxpY2l0LWFjY291bnQnLFxuICAgICAgICByZWdpb246ICdleHBsaWNpdC1yZWdpb24nLFxuICAgICAgICBuYW1lOiAnYXdzOi8vZXhwbGljaXQtYWNjb3VudC9leHBsaWNpdC1yZWdpb24nLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCd0b2tlbi1hY2NvdW50IGFuZCB0b2tlbi1yZWdpb24nLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHAsICdzdGFjaycsIHtcbiAgICAgICAgZW52OiB7XG4gICAgICAgICAgYWNjb3VudDogQXdzLkFDQ09VTlRfSUQsXG4gICAgICAgICAgcmVnaW9uOiBBd3MuUkVHSU9OLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKHN0YWNrLmFjY291bnQpKS50b0VxdWFsKHsgUmVmOiAnQVdTOjpBY2NvdW50SWQnIH0pO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoc3RhY2sucmVnaW9uKSkudG9FcXVhbCh7IFJlZjogJ0FXUzo6UmVnaW9uJyB9KTtcbiAgICAgIGV4cGVjdChhcHAuc3ludGgoKS5nZXRTdGFja0J5TmFtZShzdGFjay5zdGFja05hbWUpLmVudmlyb25tZW50KS50b0VxdWFsKHtcbiAgICAgICAgYWNjb3VudDogJ3Vua25vd24tYWNjb3VudCcsXG4gICAgICAgIHJlZ2lvbjogJ3Vua25vd24tcmVnaW9uJyxcbiAgICAgICAgbmFtZTogJ2F3czovL3Vua25vd24tYWNjb3VudC91bmtub3duLXJlZ2lvbicsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Rva2VuLWFjY291bnQgZXhwbGljaXQgcmVnaW9uJywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnc3RhY2snLCB7XG4gICAgICAgIGVudjoge1xuICAgICAgICAgIGFjY291bnQ6IEF3cy5BQ0NPVU5UX0lELFxuICAgICAgICAgIHJlZ2lvbjogJ3VzLWVhc3QtMicsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoc3RhY2suYWNjb3VudCkpLnRvRXF1YWwoeyBSZWY6ICdBV1M6OkFjY291bnRJZCcgfSk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShzdGFjay5yZWdpb24pKS50b0VxdWFsKCd1cy1lYXN0LTInKTtcbiAgICAgIGV4cGVjdChhcHAuc3ludGgoKS5nZXRTdGFja0J5TmFtZShzdGFjay5zdGFja05hbWUpLmVudmlyb25tZW50KS50b0VxdWFsKHtcbiAgICAgICAgYWNjb3VudDogJ3Vua25vd24tYWNjb3VudCcsXG4gICAgICAgIHJlZ2lvbjogJ3VzLWVhc3QtMicsXG4gICAgICAgIG5hbWU6ICdhd3M6Ly91bmtub3duLWFjY291bnQvdXMtZWFzdC0yJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19