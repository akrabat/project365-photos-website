"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("./util");
const lib_1 = require("../lib");
let app;
let stack;
beforeEach(() => {
    app = new lib_1.App();
    stack = new lib_1.Stack(app, 'Stack');
});
describe('output', () => {
    test('outputs can be added to the stack', () => {
        const res = new lib_1.CfnResource(stack, 'MyResource', { type: 'R' });
        const ref = res.ref;
        new lib_1.CfnOutput(stack, 'MyOutput', {
            exportName: 'ExportName',
            value: ref,
            description: 'CfnOutput properties',
        });
        expect((0, util_1.toCloudFormation)(stack)).toEqual({
            Resources: { MyResource: { Type: 'R' } },
            Outputs: {
                MyOutput: {
                    Description: 'CfnOutput properties',
                    Export: { Name: 'ExportName' },
                    Value: { Ref: 'MyResource' },
                },
            },
        });
    });
    test('No export is created by default', () => {
        // WHEN
        new lib_1.CfnOutput(stack, 'SomeOutput', { value: 'x' });
        // THEN
        expect((0, util_1.toCloudFormation)(stack)).toEqual({
            Outputs: {
                SomeOutput: {
                    Value: 'x',
                },
            },
        });
    });
    test('importValue can be used to obtain a Fn::ImportValue expression', () => {
        // GIVEN
        const stack2 = new lib_1.Stack(app, 'Stack2');
        // WHEN
        const output = new lib_1.CfnOutput(stack, 'SomeOutput', { value: 'x', exportName: 'asdf' });
        new lib_1.CfnResource(stack2, 'Resource', {
            type: 'Some::Resource',
            properties: {
                input: output.importValue,
            },
        });
        // THEN
        expect((0, util_1.toCloudFormation)(stack2)).toEqual({
            Resources: {
                Resource: {
                    Type: 'Some::Resource',
                    Properties: {
                        input: { 'Fn::ImportValue': 'asdf' },
                    },
                },
            },
        });
    });
    test('importValue used inside the same stack produces an error', () => {
        // WHEN
        const output = new lib_1.CfnOutput(stack, 'SomeOutput', { value: 'x', exportName: 'asdf' });
        new lib_1.CfnResource(stack, 'Resource', {
            type: 'Some::Resource',
            properties: {
                input: output.importValue,
            },
        });
        // THEN
        expect(() => (0, util_1.toCloudFormation)(stack)).toThrow(/should only be used in a different Stack/);
    });
    test('error message if importValue is used and Output is not exported', () => {
        // GIVEN
        const stack2 = new lib_1.Stack(app, 'Stack2');
        // WHEN
        const output = new lib_1.CfnOutput(stack, 'SomeOutput', { value: 'x' });
        new lib_1.CfnResource(stack2, 'Resource', {
            type: 'Some::Resource',
            properties: {
                input: output.importValue,
            },
        });
        expect(() => {
            (0, util_1.toCloudFormation)(stack2);
        }).toThrow(/Add an exportName to the CfnOutput/);
    });
    test('throw if Output is passed a string list', () => {
        // WHEN
        expect(() => {
            new lib_1.CfnOutput(stack, 'SomeOutput', { value: ['listValue'] });
        }).toThrow(/CloudFormation output was given a string list instead of a string/);
    });
    test('Verify maximum length of export name', () => {
        const output = new lib_1.CfnOutput(stack, 'SomeOutput', { value: 'x', exportName: 'x'.repeat(260) });
        const errors = output.node.validate();
        expect(errors).toEqual([
            expect.stringContaining('Export name cannot exceed 255 characters'),
        ]);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3V0cHV0LnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJvdXRwdXQudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlDQUEwQztBQUMxQyxnQ0FBNEQ7QUFFNUQsSUFBSSxHQUFRLENBQUM7QUFDYixJQUFJLEtBQVksQ0FBQztBQUNqQixVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2QsR0FBRyxHQUFHLElBQUksU0FBRyxFQUFFLENBQUM7SUFDaEIsS0FBSyxHQUFHLElBQUksV0FBSyxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNsQyxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFO0lBQ3RCLElBQUksQ0FBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUU7UUFDN0MsTUFBTSxHQUFHLEdBQUcsSUFBSSxpQkFBVyxDQUFDLEtBQUssRUFBRSxZQUFZLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNoRSxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDO1FBRXBCLElBQUksZUFBUyxDQUFDLEtBQUssRUFBRSxVQUFVLEVBQUU7WUFDL0IsVUFBVSxFQUFFLFlBQVk7WUFDeEIsS0FBSyxFQUFFLEdBQUc7WUFDVixXQUFXLEVBQUUsc0JBQXNCO1NBQ3BDLENBQUMsQ0FBQztRQUNILE1BQU0sQ0FBQyxJQUFBLHVCQUFnQixFQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ3RDLFNBQVMsRUFBRSxFQUFFLFVBQVUsRUFBRSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsRUFBRTtZQUN4QyxPQUFPLEVBQ1I7Z0JBQ0UsUUFBUSxFQUNUO29CQUNFLFdBQVcsRUFBRSxzQkFBc0I7b0JBQ25DLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUU7b0JBQzlCLEtBQUssRUFBRSxFQUFFLEdBQUcsRUFBRSxZQUFZLEVBQUU7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QyxDQUFDLENBQUM7SUFDbkQsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1FBQ25ELE9BQU87UUFDUCxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsSUFBSSxlQUFTLENBQUMsS0FBSyxFQUFFLFlBQVksRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLFdBQVcsQ0FBUSxFQUFFLENBQUMsQ0FBQztRQUN0RSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsbUVBQW1FLENBQUMsQ0FBQztJQUNsRixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxzQ0FBc0MsRUFBRSxHQUFHLEVBQUU7UUFDaEQsTUFBTSxNQUFNLEdBQUcsSUFBSSxlQUFTLENBQUMsS0FBSyxFQUFFLFlBQVksRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQy9GLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFFdEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUNyQixNQUFNLENBQUMsZ0JBQWdCLENBQUMsMENBQTBDLENBQUM7U0FDcEUsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHRvQ2xvdWRGb3JtYXRpb24gfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IHsgQXBwLCBDZm5PdXRwdXQsIENmblJlc291cmNlLCBTdGFjayB9IGZyb20gJy4uL2xpYic7XG5cbmxldCBhcHA6IEFwcDtcbmxldCBzdGFjazogU3RhY2s7XG5iZWZvcmVFYWNoKCgpID0+IHtcbiAgYXBwID0gbmV3IEFwcCgpO1xuICBzdGFjayA9IG5ldyBTdGFjayhhcHAsICdTdGFjaycpO1xufSk7XG5cbmRlc2NyaWJlKCdvdXRwdXQnLCAoKSA9PiB7XG4gIHRlc3QoJ291dHB1dHMgY2FuIGJlIGFkZGVkIHRvIHRoZSBzdGFjaycsICgpID0+IHtcbiAgICBjb25zdCByZXMgPSBuZXcgQ2ZuUmVzb3VyY2Uoc3RhY2ssICdNeVJlc291cmNlJywgeyB0eXBlOiAnUicgfSk7XG4gICAgY29uc3QgcmVmID0gcmVzLnJlZjtcblxuICAgIG5ldyBDZm5PdXRwdXQoc3RhY2ssICdNeU91dHB1dCcsIHtcbiAgICAgIGV4cG9ydE5hbWU6ICdFeHBvcnROYW1lJyxcbiAgICAgIHZhbHVlOiByZWYsXG4gICAgICBkZXNjcmlwdGlvbjogJ0Nmbk91dHB1dCBwcm9wZXJ0aWVzJyxcbiAgICB9KTtcbiAgICBleHBlY3QodG9DbG91ZEZvcm1hdGlvbihzdGFjaykpLnRvRXF1YWwoe1xuICAgICAgUmVzb3VyY2VzOiB7IE15UmVzb3VyY2U6IHsgVHlwZTogJ1InIH0gfSxcbiAgICAgIE91dHB1dHM6XG4gICAgIHtcbiAgICAgICBNeU91dHB1dDpcbiAgICAgIHtcbiAgICAgICAgRGVzY3JpcHRpb246ICdDZm5PdXRwdXQgcHJvcGVydGllcycsXG4gICAgICAgIEV4cG9ydDogeyBOYW1lOiAnRXhwb3J0TmFtZScgfSxcbiAgICAgICAgVmFsdWU6IHsgUmVmOiAnTXlSZXNvdXJjZScgfSxcbiAgICAgIH0sXG4gICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ05vIGV4cG9ydCBpcyBjcmVhdGVkIGJ5IGRlZmF1bHQnLCAoKSA9PiB7XG4gICAgLy8gV0hFTlxuICAgIG5ldyBDZm5PdXRwdXQoc3RhY2ssICdTb21lT3V0cHV0JywgeyB2YWx1ZTogJ3gnIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCh0b0Nsb3VkRm9ybWF0aW9uKHN0YWNrKSkudG9FcXVhbCh7XG4gICAgICBPdXRwdXRzOiB7XG4gICAgICAgIFNvbWVPdXRwdXQ6IHtcbiAgICAgICAgICBWYWx1ZTogJ3gnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnaW1wb3J0VmFsdWUgY2FuIGJlIHVzZWQgdG8gb2J0YWluIGEgRm46OkltcG9ydFZhbHVlIGV4cHJlc3Npb24nLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjazIgPSBuZXcgU3RhY2soYXBwLCAnU3RhY2syJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3Qgb3V0cHV0ID0gbmV3IENmbk91dHB1dChzdGFjaywgJ1NvbWVPdXRwdXQnLCB7IHZhbHVlOiAneCcsIGV4cG9ydE5hbWU6ICdhc2RmJyB9KTtcbiAgICBuZXcgQ2ZuUmVzb3VyY2Uoc3RhY2syLCAnUmVzb3VyY2UnLCB7XG4gICAgICB0eXBlOiAnU29tZTo6UmVzb3VyY2UnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBpbnB1dDogb3V0cHV0LmltcG9ydFZhbHVlLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QodG9DbG91ZEZvcm1hdGlvbihzdGFjazIpKS50b0VxdWFsKHtcbiAgICAgIFJlc291cmNlczoge1xuICAgICAgICBSZXNvdXJjZToge1xuICAgICAgICAgIFR5cGU6ICdTb21lOjpSZXNvdXJjZScsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgaW5wdXQ6IHsgJ0ZuOjpJbXBvcnRWYWx1ZSc6ICdhc2RmJyB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdpbXBvcnRWYWx1ZSB1c2VkIGluc2lkZSB0aGUgc2FtZSBzdGFjayBwcm9kdWNlcyBhbiBlcnJvcicsICgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3Qgb3V0cHV0ID0gbmV3IENmbk91dHB1dChzdGFjaywgJ1NvbWVPdXRwdXQnLCB7IHZhbHVlOiAneCcsIGV4cG9ydE5hbWU6ICdhc2RmJyB9KTtcbiAgICBuZXcgQ2ZuUmVzb3VyY2Uoc3RhY2ssICdSZXNvdXJjZScsIHtcbiAgICAgIHR5cGU6ICdTb21lOjpSZXNvdXJjZScsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGlucHV0OiBvdXRwdXQuaW1wb3J0VmFsdWUsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCgoKSA9PiB0b0Nsb3VkRm9ybWF0aW9uKHN0YWNrKSkudG9UaHJvdygvc2hvdWxkIG9ubHkgYmUgdXNlZCBpbiBhIGRpZmZlcmVudCBTdGFjay8pO1xuICB9KTtcblxuICB0ZXN0KCdlcnJvciBtZXNzYWdlIGlmIGltcG9ydFZhbHVlIGlzIHVzZWQgYW5kIE91dHB1dCBpcyBub3QgZXhwb3J0ZWQnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjazIgPSBuZXcgU3RhY2soYXBwLCAnU3RhY2syJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3Qgb3V0cHV0ID0gbmV3IENmbk91dHB1dChzdGFjaywgJ1NvbWVPdXRwdXQnLCB7IHZhbHVlOiAneCcgfSk7XG4gICAgbmV3IENmblJlc291cmNlKHN0YWNrMiwgJ1Jlc291cmNlJywge1xuICAgICAgdHlwZTogJ1NvbWU6OlJlc291cmNlJyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgaW5wdXQ6IG91dHB1dC5pbXBvcnRWYWx1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgdG9DbG91ZEZvcm1hdGlvbihzdGFjazIpO1xuICAgIH0pLnRvVGhyb3coL0FkZCBhbiBleHBvcnROYW1lIHRvIHRoZSBDZm5PdXRwdXQvKTtcbiAgfSk7XG5cbiAgdGVzdCgndGhyb3cgaWYgT3V0cHV0IGlzIHBhc3NlZCBhIHN0cmluZyBsaXN0JywgKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgbmV3IENmbk91dHB1dChzdGFjaywgJ1NvbWVPdXRwdXQnLCB7IHZhbHVlOiBbJ2xpc3RWYWx1ZSddIGFzIGFueSB9KTtcbiAgICB9KS50b1Rocm93KC9DbG91ZEZvcm1hdGlvbiBvdXRwdXQgd2FzIGdpdmVuIGEgc3RyaW5nIGxpc3QgaW5zdGVhZCBvZiBhIHN0cmluZy8pO1xuICB9KTtcblxuICB0ZXN0KCdWZXJpZnkgbWF4aW11bSBsZW5ndGggb2YgZXhwb3J0IG5hbWUnLCAoKSA9PiB7XG4gICAgY29uc3Qgb3V0cHV0ID0gbmV3IENmbk91dHB1dChzdGFjaywgJ1NvbWVPdXRwdXQnLCB7IHZhbHVlOiAneCcsIGV4cG9ydE5hbWU6ICd4Jy5yZXBlYXQoMjYwKSB9KTtcbiAgICBjb25zdCBlcnJvcnMgPSBvdXRwdXQubm9kZS52YWxpZGF0ZSgpO1xuXG4gICAgZXhwZWN0KGVycm9ycykudG9FcXVhbChbXG4gICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnRXhwb3J0IG5hbWUgY2Fubm90IGV4Y2VlZCAyNTUgY2hhcmFjdGVycycpLFxuICAgIF0pO1xuICB9KTtcbn0pO1xuIl19