"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cache_1 = require("../../lib/private/cache");
let invocations = 0;
let cache;
function returnFoo() {
    invocations++;
    return 'foo';
}
beforeEach(() => {
    cache = new cache_1.Cache();
    invocations = 0;
});
test('invoke retrieval function only once per key', () => {
    // First call
    const value = cache.obtain('key', returnFoo);
    expect(value).toEqual('foo');
    expect(invocations).toEqual(1);
    // Second call
    const value2 = cache.obtain('key', returnFoo);
    expect(value2).toEqual('foo');
    expect(invocations).toEqual(1);
    // Different key
    const value3 = cache.obtain('key2', returnFoo);
    expect(value3).toEqual('foo');
    expect(invocations).toEqual(2);
});
test('cache can be cleared', () => {
    // First call
    expect(cache.obtain('key', returnFoo)).toEqual('foo');
    cache.clear();
    expect(cache.obtain('key', returnFoo)).toEqual('foo');
    expect(invocations).toEqual(2);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FjaGUudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNhY2hlLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxtREFBZ0Q7QUFFaEQsSUFBSSxXQUFXLEdBQUcsQ0FBQyxDQUFDO0FBQ3BCLElBQUksS0FBb0IsQ0FBQztBQUV6QixTQUFTLFNBQVM7SUFDaEIsV0FBVyxFQUFFLENBQUM7SUFDZCxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUM7QUFFRCxVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2QsS0FBSyxHQUFHLElBQUksYUFBSyxFQUFVLENBQUM7SUFDNUIsV0FBVyxHQUFHLENBQUMsQ0FBQztBQUNsQixDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyw2Q0FBNkMsRUFBRSxHQUFHLEVBQUU7SUFDdkQsYUFBYTtJQUNiLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQzdDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDN0IsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUUvQixjQUFjO0lBQ2QsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDOUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM5QixNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRS9CLGdCQUFnQjtJQUNoQixNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxTQUFTLENBQUMsQ0FBQztJQUMvQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzlCLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDakMsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO0lBQ2hDLGFBQWE7SUFDYixNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFdEQsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBRWQsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRXRELE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDakMsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDYWNoZSB9IGZyb20gJy4uLy4uL2xpYi9wcml2YXRlL2NhY2hlJztcblxubGV0IGludm9jYXRpb25zID0gMDtcbmxldCBjYWNoZTogQ2FjaGU8c3RyaW5nPjtcblxuZnVuY3Rpb24gcmV0dXJuRm9vKCkge1xuICBpbnZvY2F0aW9ucysrO1xuICByZXR1cm4gJ2Zvbyc7XG59XG5cbmJlZm9yZUVhY2goKCkgPT4ge1xuICBjYWNoZSA9IG5ldyBDYWNoZTxzdHJpbmc+KCk7XG4gIGludm9jYXRpb25zID0gMDtcbn0pO1xuXG50ZXN0KCdpbnZva2UgcmV0cmlldmFsIGZ1bmN0aW9uIG9ubHkgb25jZSBwZXIga2V5JywgKCkgPT4ge1xuICAvLyBGaXJzdCBjYWxsXG4gIGNvbnN0IHZhbHVlID0gY2FjaGUub2J0YWluKCdrZXknLCByZXR1cm5Gb28pO1xuICBleHBlY3QodmFsdWUpLnRvRXF1YWwoJ2ZvbycpO1xuICBleHBlY3QoaW52b2NhdGlvbnMpLnRvRXF1YWwoMSk7XG5cbiAgLy8gU2Vjb25kIGNhbGxcbiAgY29uc3QgdmFsdWUyID0gY2FjaGUub2J0YWluKCdrZXknLCByZXR1cm5Gb28pO1xuICBleHBlY3QodmFsdWUyKS50b0VxdWFsKCdmb28nKTtcbiAgZXhwZWN0KGludm9jYXRpb25zKS50b0VxdWFsKDEpO1xuXG4gIC8vIERpZmZlcmVudCBrZXlcbiAgY29uc3QgdmFsdWUzID0gY2FjaGUub2J0YWluKCdrZXkyJywgcmV0dXJuRm9vKTtcbiAgZXhwZWN0KHZhbHVlMykudG9FcXVhbCgnZm9vJyk7XG4gIGV4cGVjdChpbnZvY2F0aW9ucykudG9FcXVhbCgyKTtcbn0pO1xuXG50ZXN0KCdjYWNoZSBjYW4gYmUgY2xlYXJlZCcsICgpID0+IHtcbiAgLy8gRmlyc3QgY2FsbFxuICBleHBlY3QoY2FjaGUub2J0YWluKCdrZXknLCByZXR1cm5Gb28pKS50b0VxdWFsKCdmb28nKTtcblxuICBjYWNoZS5jbGVhcigpO1xuXG4gIGV4cGVjdChjYWNoZS5vYnRhaW4oJ2tleScsIHJldHVybkZvbykpLnRvRXF1YWwoJ2ZvbycpO1xuXG4gIGV4cGVjdChpbnZvY2F0aW9ucykudG9FcXVhbCgyKTtcbn0pOyJdfQ==