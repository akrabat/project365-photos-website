"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../../lib");
const physical_name_generator_1 = require("../../lib/private/physical-name-generator");
describe('physical name generator', () => {
    describe('generatePhysicalName', () => {
        test('generates correct physical names', () => {
            const app = new lib_1.App();
            const stack = new lib_1.Stack(app, 'TestStack', { env: { account: '012345678912', region: 'bermuda-triangle-1' } });
            const testResourceA = new TestResource(stack, 'A');
            const testResourceB = new TestResource(testResourceA, 'B');
            expect((0, physical_name_generator_1.generatePhysicalName)(testResourceA)).toEqual('teststackteststackaa164c141d59b37c1b663');
            expect((0, physical_name_generator_1.generatePhysicalName)(testResourceB)).toEqual('teststackteststackab27595cd34d8188283a1f');
        });
        test('generates different names in different accounts', () => {
            const appA = new lib_1.App();
            const stackA = new lib_1.Stack(appA, 'TestStack', { env: { account: '012345678912', region: 'bermuda-triangle-1' } });
            const resourceA = new TestResource(stackA, 'Resource');
            const appB = new lib_1.App();
            const stackB = new lib_1.Stack(appB, 'TestStack', { env: { account: '012345678913', region: 'bermuda-triangle-1' } });
            const resourceB = new TestResource(stackB, 'Resource');
            expect((0, physical_name_generator_1.generatePhysicalName)(resourceA)).not.toEqual((0, physical_name_generator_1.generatePhysicalName)(resourceB));
        });
        test('generates different names in different regions', () => {
            const appA = new lib_1.App();
            const stackA = new lib_1.Stack(appA, 'TestStack', { env: { account: '012345678912', region: 'bermuda-triangle-1' } });
            const resourceA = new TestResource(stackA, 'Resource');
            const appB = new lib_1.App();
            const stackB = new lib_1.Stack(appB, 'TestStack', { env: { account: '012345678912', region: 'bermuda-triangle-2' } });
            const resourceB = new TestResource(stackB, 'Resource');
            expect((0, physical_name_generator_1.generatePhysicalName)(resourceA)).not.toEqual((0, physical_name_generator_1.generatePhysicalName)(resourceB));
        });
        test('fails when the region is an unresolved token', () => {
            const app = new lib_1.App();
            const stack = new lib_1.Stack(app, 'TestStack', { env: { account: '012345678912', region: lib_1.Aws.REGION } });
            const testResource = new TestResource(stack, 'A');
            expect(() => (0, physical_name_generator_1.generatePhysicalName)(testResource)).toThrow(/Cannot generate a physical name for TestStack\/A, because the region is un-resolved or missing/);
        });
        test('fails when the region is not provided', () => {
            const app = new lib_1.App();
            const stack = new lib_1.Stack(app, 'TestStack', { env: { account: '012345678912' } });
            const testResource = new TestResource(stack, 'A');
            expect(() => (0, physical_name_generator_1.generatePhysicalName)(testResource)).toThrow(/Cannot generate a physical name for TestStack\/A, because the region is un-resolved or missing/);
        });
        test('fails when the account is an unresolved token', () => {
            const app = new lib_1.App();
            const stack = new lib_1.Stack(app, 'TestStack', { env: { account: lib_1.Aws.ACCOUNT_ID, region: 'bermuda-triangle-1' } });
            const testResource = new TestResource(stack, 'A');
            expect(() => (0, physical_name_generator_1.generatePhysicalName)(testResource)).toThrow(/Cannot generate a physical name for TestStack\/A, because the account is un-resolved or missing/);
        });
        test('fails when the account is not provided', () => {
            const app = new lib_1.App();
            const stack = new lib_1.Stack(app, 'TestStack', { env: { region: 'bermuda-triangle-1' } });
            const testResource = new TestResource(stack, 'A');
            expect(() => (0, physical_name_generator_1.generatePhysicalName)(testResource)).toThrow(/Cannot generate a physical name for TestStack\/A, because the account is un-resolved or missing/);
        });
    });
    describe('GeneratedWhenNeededMarker', () => {
        test('is correctly recognized', () => {
            const marker = new physical_name_generator_1.GeneratedWhenNeededMarker();
            const asString = lib_1.Token.asString(marker);
            expect((0, physical_name_generator_1.isGeneratedWhenNeededMarker)(asString)).toEqual(true);
        });
        test('throws when resolved', () => {
            const marker = new physical_name_generator_1.GeneratedWhenNeededMarker();
            const asString = lib_1.Token.asString(marker);
            expect(() => new lib_1.Stack().resolve(asString)).toThrow(/Use "this.physicalName" instead/);
        });
    });
    describe('isGeneratedWhenNeededMarker', () => {
        test('correctly response for other tokens', () => {
            expect((0, physical_name_generator_1.isGeneratedWhenNeededMarker)('this is not even a token!')).toEqual(false);
            expect((0, physical_name_generator_1.isGeneratedWhenNeededMarker)(lib_1.Lazy.string({ produce: () => 'Bazinga!' }))).toEqual(false);
        });
    });
});
class TestResource extends lib_1.Resource {
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGh5c2ljYWwtbmFtZS1nZW5lcmF0b3IudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBoeXNpY2FsLW5hbWUtZ2VuZXJhdG9yLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxtQ0FBbUU7QUFDbkUsdUZBQXlJO0FBRXpJLFFBQVEsQ0FBQyx5QkFBeUIsRUFBRSxHQUFHLEVBQUU7SUFDdkMsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtRQUNwQyxJQUFJLENBQUMsa0NBQWtDLEVBQUUsR0FBRyxFQUFFO1lBQzVDLE1BQU0sR0FBRyxHQUFHLElBQUksU0FBRyxFQUFFLENBQUM7WUFDdEIsTUFBTSxLQUFLLEdBQUcsSUFBSSxXQUFLLENBQUMsR0FBRyxFQUFFLFdBQVcsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxFQUFFLG9CQUFvQixFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRTlHLE1BQU0sYUFBYSxHQUFHLElBQUksWUFBWSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNuRCxNQUFNLGFBQWEsR0FBRyxJQUFJLFlBQVksQ0FBQyxhQUFhLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFFM0QsTUFBTSxDQUFDLElBQUEsOENBQW9CLEVBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMseUNBQXlDLENBQUMsQ0FBQztZQUMvRixNQUFNLENBQUMsSUFBQSw4Q0FBb0IsRUFBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO1FBR2xHLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLGlEQUFpRCxFQUFFLEdBQUcsRUFBRTtZQUMzRCxNQUFNLElBQUksR0FBRyxJQUFJLFNBQUcsRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sTUFBTSxHQUFHLElBQUksV0FBSyxDQUFDLElBQUksRUFBRSxXQUFXLEVBQUUsRUFBRSxHQUFH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SCxNQUFNLFlBQWEsU0FBUSxjQUFRO0NBQUciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHAsIEF3cywgTGF6eSwgUmVzb3VyY2UsIFN0YWNrLCBUb2tlbiB9IGZyb20gJy4uLy4uL2xpYic7XG5pbXBvcnQgeyBHZW5lcmF0ZWRXaGVuTmVlZGVkTWFya2VyLCBnZW5lcmF0ZVBoeXNpY2FsTmFtZSwgaXNHZW5lcmF0ZWRXaGVuTmVlZGVkTWFya2VyIH0gZnJvbSAnLi4vLi4vbGliL3ByaXZhdGUvcGh5c2ljYWwtbmFtZS1nZW5lcmF0b3InO1xuXG5kZXNjcmliZSgncGh5c2ljYWwgbmFtZSBnZW5lcmF0b3InLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdnZW5lcmF0ZVBoeXNpY2FsTmFtZScsICgpID0+IHtcbiAgICB0ZXN0KCdnZW5lcmF0ZXMgY29ycmVjdCBwaHlzaWNhbCBuYW1lcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ1Rlc3RTdGFjaycsIHsgZW52OiB7IGFjY291bnQ6ICcwMTIzNDU2Nzg5MTInLCByZWdpb246ICdiZXJtdWRhLXRyaWFuZ2xlLTEnIH0gfSk7XG5cbiAgICAgIGNvbnN0IHRlc3RSZXNvdXJjZUEgPSBuZXcgVGVzdFJlc291cmNlKHN0YWNrLCAnQScpO1xuICAgICAgY29uc3QgdGVzdFJlc291cmNlQiA9IG5ldyBUZXN0UmVzb3VyY2UodGVzdFJlc291cmNlQSwgJ0InKTtcblxuICAgICAgZXhwZWN0KGdlbmVyYXRlUGh5c2ljYWxOYW1lKHRlc3RSZXNvdXJjZUEpKS50b0VxdWFsKCd0ZXN0c3RhY2t0ZXN0c3RhY2thYTE2NGMxNDFkNTliMzdjMWI2NjMnKTtcbiAgICAgIGV4cGVjdChnZW5lcmF0ZVBoeXNpY2FsTmFtZSh0ZXN0UmVzb3VyY2VCKSkudG9FcXVhbCgndGVzdHN0YWNrdGVzdHN0YWNrYWIyNzU5NWNkMzRkODE4ODI4M2ExZicpO1xuXG5cbiAgICB9KTtcblxuICAgIHRlc3QoJ2dlbmVyYXRlcyBkaWZmZXJlbnQgbmFtZXMgaW4gZGlmZmVyZW50IGFjY291bnRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXBwQSA9IG5ldyBBcHAoKTtcbiAgICAgIGNvbnN0IHN0YWNrQSA9IG5ldyBTdGFjayhhcHBBLCAnVGVzdFN0YWNrJywgeyBlbnY6IHsgYWNjb3VudDogJzAxMjM0NTY3ODkxMicsIHJlZ2lvbjogJ2Jlcm11ZGEtdHJpYW5nbGUtMScgfSB9KTtcbiAgICAgIGNvbnN0IHJlc291cmNlQSA9IG5ldyBUZXN0UmVzb3VyY2Uoc3RhY2tBLCAnUmVzb3VyY2UnKTtcblxuICAgICAgY29uc3QgYXBwQiA9IG5ldyBBcHAoKTtcbiAgICAgIGNvbnN0IHN0YWNrQiA9IG5ldyBTdGFjayhhcHBCLCAnVGVzdFN0YWNrJywgeyBlbnY6IHsgYWNjb3VudDogJzAxMjM0NTY3ODkxMycsIHJlZ2lvbjogJ2Jlcm11ZGEtdHJpYW5nbGUtMScgfSB9KTtcbiAgICAgIGNvbnN0IHJlc291cmNlQiA9IG5ldyBUZXN0UmVzb3VyY2Uoc3RhY2tCLCAnUmVzb3VyY2UnKTtcblxuICAgICAgZXhwZWN0KGdlbmVyYXRlUGh5c2ljYWxOYW1lKHJlc291cmNlQSkpLm5vdC50b0VxdWFsKGdlbmVyYXRlUGh5c2ljYWxOYW1lKHJlc291cmNlQikpO1xuXG5cbiAgICB9KTtcblxuICAgIHRlc3QoJ2dlbmVyYXRlcyBkaWZmZXJlbnQgbmFtZXMgaW4gZGlmZmVyZW50IHJlZ2lvbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhcHBBID0gbmV3IEFwcCgpO1xuICAgICAgY29uc3Qgc3RhY2tBID0gbmV3IFN0YWNrKGFwcEEsICdUZXN0U3RhY2snLCB7IGVudjogeyBhY2NvdW50OiAnMDEyMzQ1Njc4OTEyJywgcmVnaW9uOiAnYmVybXVkYS10cmlhbmdsZS0xJyB9IH0pO1xuICAgICAgY29uc3QgcmVzb3VyY2VBID0gbmV3IFRlc3RSZXNvdXJjZShzdGFja0EsICdSZXNvdXJjZScpO1xuXG4gICAgICBjb25zdCBhcHBCID0gbmV3IEFwcCgpO1xuICAgICAgY29uc3Qgc3RhY2tCID0gbmV3IFN0YWNrKGFwcEIsICdUZXN0U3RhY2snLCB7IGVudjogeyBhY2NvdW50OiAnMDEyMzQ1Njc4OTEyJywgcmVnaW9uOiAnYmVybXVkYS10cmlhbmdsZS0yJyB9IH0pO1xuICAgICAgY29uc3QgcmVzb3VyY2VCID0gbmV3IFRlc3RSZXNvdXJjZShzdGFja0IsICdSZXNvdXJjZScpO1xuXG4gICAgICBleHBlY3QoZ2VuZXJhdGVQaHlzaWNhbE5hbWUocmVzb3VyY2VBKSkubm90LnRvRXF1YWwoZ2VuZXJhdGVQaHlzaWNhbE5hbWUocmVzb3VyY2VCKSk7XG5cblxuICAgIH0pO1xuXG4gICAgdGVzdCgnZmFpbHMgd2hlbiB0aGUgcmVnaW9uIGlzIGFuIHVucmVzb2x2ZWQgdG9rZW4nLCAoKSA9PiB7XG4gICAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHAsICdUZXN0U3RhY2snLCB7IGVudjogeyBhY2NvdW50OiAnMDEyMzQ1Njc4OTEyJywgcmVnaW9uOiBBd3MuUkVHSU9OIH0gfSk7XG4gICAgICBjb25zdCB0ZXN0UmVzb3VyY2UgPSBuZXcgVGVzdFJlc291cmNlKHN0YWNrLCAnQScpO1xuXG4gICAgICBleHBlY3QoKCkgPT4gZ2VuZXJhdGVQaHlzaWNhbE5hbWUodGVzdFJlc291cmNlKSkudG9UaHJvdyhcbiAgICAgICAgL0Nhbm5vdCBnZW5lcmF0ZSBhIHBoeXNpY2FsIG5hbWUgZm9yIFRlc3RTdGFja1xcL0EsIGJlY2F1c2UgdGhlIHJlZ2lvbiBpcyB1bi1yZXNvbHZlZCBvciBtaXNzaW5nLyk7XG5cblxuICAgIH0pO1xuXG4gICAgdGVzdCgnZmFpbHMgd2hlbiB0aGUgcmVnaW9uIGlzIG5vdCBwcm92aWRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ1Rlc3RTdGFjaycsIHsgZW52OiB7IGFjY291bnQ6ICcwMTIzNDU2Nzg5MTInIH0gfSk7XG4gICAgICBjb25zdCB0ZXN0UmVzb3VyY2UgPSBuZXcgVGVzdFJlc291cmNlKHN0YWNrLCAnQScpO1xuXG4gICAgICBleHBlY3QoKCkgPT4gZ2VuZXJhdGVQaHlzaWNhbE5hbWUodGVzdFJlc291cmNlKSkudG9UaHJvdyhcbiAgICAgICAgL0Nhbm5vdCBnZW5lcmF0ZSBhIHBoeXNpY2FsIG5hbWUgZm9yIFRlc3RTdGFja1xcL0EsIGJlY2F1c2UgdGhlIHJlZ2lvbiBpcyB1bi1yZXNvbHZlZCBvciBtaXNzaW5nLyk7XG5cblxuICAgIH0pO1xuXG4gICAgdGVzdCgnZmFpbHMgd2hlbiB0aGUgYWNjb3VudCBpcyBhbiB1bnJlc29sdmVkIHRva2VuJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnVGVzdFN0YWNrJywgeyBlbnY6IHsgYWNjb3VudDogQXdzLkFDQ09VTlRfSUQsIHJlZ2lvbjogJ2Jlcm11ZGEtdHJpYW5nbGUtMScgfSB9KTtcbiAgICAgIGNvbnN0IHRlc3RSZXNvdXJjZSA9IG5ldyBUZXN0UmVzb3VyY2Uoc3RhY2ssICdBJyk7XG5cbiAgICAgIGV4cGVjdCgoKSA9PiBnZW5lcmF0ZVBoeXNpY2FsTmFtZSh0ZXN0UmVzb3VyY2UpKS50b1Rocm93KFxuICAgICAgICAvQ2Fubm90IGdlbmVyYXRlIGEgcGh5c2ljYWwgbmFtZSBmb3IgVGVzdFN0YWNrXFwvQSwgYmVjYXVzZSB0aGUgYWNjb3VudCBpcyB1bi1yZXNvbHZlZCBvciBtaXNzaW5nLyk7XG5cblxuICAgIH0pO1xuXG4gICAgdGVzdCgnZmFpbHMgd2hlbiB0aGUgYWNjb3VudCBpcyBub3QgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHAsICdUZXN0U3RhY2snLCB7IGVudjogeyByZWdpb246ICdiZXJtdWRhLXRyaWFuZ2xlLTEnIH0gfSk7XG4gICAgICBjb25zdCB0ZXN0UmVzb3VyY2UgPSBuZXcgVGVzdFJlc291cmNlKHN0YWNrLCAnQScpO1xuXG4gICAgICBleHBlY3QoKCkgPT4gZ2VuZXJhdGVQaHlzaWNhbE5hbWUodGVzdFJlc291cmNlKSkudG9UaHJvdyhcbiAgICAgICAgL0Nhbm5vdCBnZW5lcmF0ZSBhIHBoeXNpY2FsIG5hbWUgZm9yIFRlc3RTdGFja1xcL0EsIGJlY2F1c2UgdGhlIGFjY291bnQgaXMgdW4tcmVzb2x2ZWQgb3IgbWlzc2luZy8pO1xuXG5cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dlbmVyYXRlZFdoZW5OZWVkZWRNYXJrZXInLCAoKSA9PiB7XG4gICAgdGVzdCgnaXMgY29ycmVjdGx5IHJlY29nbml6ZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtYXJrZXIgPSBuZXcgR2VuZXJhdGVkV2hlbk5lZWRlZE1hcmtlcigpO1xuICAgICAgY29uc3QgYXNTdHJpbmcgPSBUb2tlbi5hc1N0cmluZyhtYXJrZXIpO1xuXG4gICAgICBleHBlY3QoaXNHZW5lcmF0ZWRXaGVuTmVlZGVkTWFya2VyKGFzU3RyaW5nKSkudG9FcXVhbCh0cnVlKTtcblxuXG4gICAgfSk7XG5cbiAgICB0ZXN0KCd0aHJvd3Mgd2hlbiByZXNvbHZlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1hcmtlciA9IG5ldyBHZW5lcmF0ZWRXaGVuTmVlZGVkTWFya2VyKCk7XG4gICAgICBjb25zdCBhc1N0cmluZyA9IFRva2VuLmFzU3RyaW5nKG1hcmtlcik7XG5cbiAgICAgIGV4cGVjdCgoKSA9PiBuZXcgU3RhY2soKS5yZXNvbHZlKGFzU3RyaW5nKSkudG9UaHJvdygvVXNlIFwidGhpcy5waHlzaWNhbE5hbWVcIiBpbnN0ZWFkLyk7XG5cblxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaXNHZW5lcmF0ZWRXaGVuTmVlZGVkTWFya2VyJywgKCkgPT4ge1xuICAgIHRlc3QoJ2NvcnJlY3RseSByZXNwb25zZSBmb3Igb3RoZXIgdG9rZW5zJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGlzR2VuZXJhdGVkV2hlbk5lZWRlZE1hcmtlcigndGhpcyBpcyBub3QgZXZlbiBhIHRva2VuIScpKS50b0VxdWFsKGZhbHNlKTtcbiAgICAgIGV4cGVjdChpc0dlbmVyYXRlZFdoZW5OZWVkZWRNYXJrZXIoTGF6eS5zdHJpbmcoeyBwcm9kdWNlOiAoKSA9PiAnQmF6aW5nYSEnIH0pKSkudG9FcXVhbChmYWxzZSk7XG5cblxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5jbGFzcyBUZXN0UmVzb3VyY2UgZXh0ZW5kcyBSZXNvdXJjZSB7fVxuIl19