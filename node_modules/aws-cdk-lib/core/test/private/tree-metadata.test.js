"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const path = require("path");
const cxschema = require("../../../cloud-assembly-schema");
const constructs_1 = require("constructs");
const index_1 = require("../../lib/index");
class AbstractCfnResource extends index_1.CfnResource {
    constructor(scope, id) {
        super(scope, id, {
            type: 'CDK::UnitTest::MyCfnResource',
        });
    }
    inspect(inspector) {
        inspector.addAttribute('aws:cdk:cloudformation:type', 'CDK::UnitTest::MyCfnResource');
        inspector.addAttribute('aws:cdk:cloudformation:props', this.cfnProperties);
    }
}
describe('tree metadata', () => {
    test('tree metadata is generated as expected', () => {
        const app = new index_1.App();
        const stack = new index_1.Stack(app, 'mystack');
        new constructs_1.Construct(stack, 'myconstruct');
        const assembly = app.synth();
        const treeArtifact = assembly.tree();
        expect(treeArtifact).toBeDefined();
        expect(readJson(assembly.directory, treeArtifact.file)).toEqual({
            version: 'tree-0.1',
            tree: expect.objectContaining({
                id: 'App',
                path: '',
                children: {
                    Tree: expect.objectContaining({
                        id: 'Tree',
                        path: 'Tree',
                    }),
                    mystack: expect.objectContaining({
                        id: 'mystack',
                        path: 'mystack',
                        children: {
                            BootstrapVersion: {
                                constructInfo: {
                                    fqn: 'aws-cdk-lib.CfnParameter',
                                    version: expect.any(String),
                                },
                                id: 'BootstrapVersion',
                                path: 'mystack/BootstrapVersion',
                            },
                            CheckBootstrapVersion: {
                                constructInfo: {
                                    fqn: 'aws-cdk-lib.CfnRule',
                                    version: expect.any(String),
                                },
                                id: 'CheckBootstrapVersion',
                                path: 'mystack/CheckBootstrapVersion',
                            },
                            myconstruct: expect.objectContaining({
                                id: 'myconstruct',
                                path: 'mystack/myconstruct',
                            }),
                        },
                    }),
                },
            }),
        });
    });
    test('tree metadata for a Cfn resource', () => {
        class MyCfnResource extends AbstractCfnResource {
            get cfnProperties() {
                return {
                    mystringpropkey: 'mystringpropval',
                    mylistpropkey: ['listitem1'],
                    mystructpropkey: {
                        myboolpropkey: true,
                        mynumpropkey: 50,
                    },
                };
            }
        }
        const app = new index_1.App();
        const stack = new index_1.Stack(app, 'mystack');
        new MyCfnResource(stack, 'mycfnresource');
        const assembly = app.synth();
        const treeArtifact = assembly.tree();
        expect(treeArtifact).toBeDefined();
        expect(readJson(assembly.directory, treeArtifact.file)).toEqual({
            version: 'tree-0.1',
            tree: expect.objectContaining({
                id: 'App',
                path: '',
                children: {
                    Tree: expect.objectContaining({
                        id: 'Tree',
                        path: 'Tree',
                    }),
                    mystack: expect.objectContaining({
                        id: 'mystack',
                        path: 'mystack',
                        children: expect.objectContaining({
                            mycfnresource: expect.objectContaining({
                                id: 'mycfnresource',
                                path: 'mystack/mycfnresource',
                                attributes: {
                                    'aws:cdk:cloudformation:type': 'CDK::UnitTest::MyCfnResource',
                                    'aws:cdk:cloudformation:props': {
                                        mystringpropkey: 'mystringpropval',
                                        mylistpropkey: ['listitem1'],
                                        mystructpropkey: {
                                            myboolpropkey: true,
                                            mynumpropkey: 50,
                                        },
                                    },
                                },
                            }),
                        }),
                    }),
                },
            }),
        });
    });
    test('tree metadata has construct class & version in there', () => {
        // The runtime metadata this test relies on is only available if the most
        // recent compile has happened using 'jsii', as the jsii compiler injects
        // this metadata.
        //
        // If the most recent compile was using 'tsc', the metadata will not have
        // been injected, and the test will fail.
        //
        // People may choose to run `tsc` directly (instead of `yarn build` for
        // example) to escape the additional TSC compilation time that is necessary
        // to run 'eslint', or the additional time that 'jsii' needs to analyze the
        // type system), this test is allowed to fail if we're not running on CI.
        //
        // If the compile of this library has been done using `tsc`, the runtime
        // information will always find `constructs.Construct` as the construct
        // identifier, since `constructs` will have had a release build done using `jsii`.
        //
        // If this test is running on CodeBuild, we will require that the more specific
        // class names are found. If this test is NOT running on CodeBuild, we will
        // allow the specific class name (for a 'jsii' build) or the generic
        // 'constructs.Construct' class name (for a 'tsc' build).
        const app = new index_1.App();
        const stack = new index_1.Stack(app, 'mystack');
        new index_1.CfnResource(stack, 'myconstruct', { type: 'Aws::Some::Resource' });
        const assembly = app.synth();
        const treeArtifact = assembly.tree();
        expect(treeArtifact).toBeDefined();
        const codeBuild = !!process.env.CODEBUILD_BUILD_ID;
        expect(readJson(assembly.directory, treeArtifact.file)).toEqual({
            version: 'tree-0.1',
            tree: expect.objectContaining({
                children: expect.objectContaining({
                    mystack: expect.objectContaining({
                        constructInfo: {
                            fqn: expect.stringMatching(codeBuild ? /\bStack$/ : /\bStack$|^constructs.Construct$/),
                            version: expect.any(String),
                        },
                        children: expect.objectContaining({
                            myconstruct: expect.objectContaining({
                                constructInfo: {
                                    fqn: expect.stringMatching(codeBuild ? /\bCfnResource$/ : /\bCfnResource$|^constructs.Construct$/),
                                    version: expect.any(String),
                                },
                            }),
                        }),
                    }),
                }),
            }),
        });
    });
    test('token resolution & cfn parameter', () => {
        const app = new index_1.App();
        const stack = new index_1.Stack(app, 'mystack');
        const cfnparam = new index_1.CfnParameter(stack, 'mycfnparam');
        class MyCfnResource extends AbstractCfnResource {
            get cfnProperties() {
                return {
                    lazykey: index_1.Lazy.string({ produce: () => 'LazyResolved!' }),
                    cfnparamkey: cfnparam,
                };
            }
        }
        new MyCfnResource(stack, 'mycfnresource');
        const assembly = app.synth();
        const treeArtifact = assembly.tree();
        expect(treeArtifact).toBeDefined();
        expect(readJson(assembly.directory, treeArtifact.file)).toEqual({
            version: 'tree-0.1',
            tree: expect.objectContaining({
                id: 'App',
                path: '',
                children: {
                    Tree: expect.objectContaining({
                        id: 'Tree',
                        path: 'Tree',
                    }),
                    mystack: expect.objectContaining({
                        id: 'mystack',
                        path: 'mystack',
                        children: expect.objectContaining({
                            mycfnparam: expect.objectContaining({
                                id: 'mycfnparam',
                                path: 'mystack/mycfnparam',
                            }),
                            mycfnresource: expect.objectContaining({
                                id: 'mycfnresource',
                                path: 'mystack/mycfnresource',
                                attributes: {
                                    'aws:cdk:cloudformation:type': 'CDK::UnitTest::MyCfnResource',
                                    'aws:cdk:cloudformation:props': {
                                        lazykey: 'LazyResolved!',
                                        cfnparamkey: { Ref: 'mycfnparam' },
                                    },
                                },
                            }),
                        }),
                    }),
                },
            }),
        });
    });
    test('cross-stack tokens', () => {
        class MyFirstResource extends AbstractCfnResource {
            constructor(scope, id) {
                super(scope, id);
                this.lazykey = index_1.Lazy.string({ produce: () => 'LazyResolved!' });
            }
            get cfnProperties() {
                return {
                    lazykey: this.lazykey,
                };
            }
        }
        class MySecondResource extends AbstractCfnResource {
            constructor(scope, id, myprop) {
                super(scope, id);
                this.myprop = myprop;
            }
            get cfnProperties() {
                return {
                    myprop: this.myprop,
                };
            }
        }
        const app = new index_1.App();
        const firststack = new index_1.Stack(app, 'myfirststack');
        const firstres = new MyFirstResource(firststack, 'myfirstresource');
        const secondstack = new index_1.Stack(app, 'mysecondstack');
        new MySecondResource(secondstack, 'mysecondresource', firstres.lazykey);
        const assembly = app.synth();
        const treeArtifact = assembly.tree();
        expect(treeArtifact).toBeDefined();
        expect(readJson(assembly.directory, treeArtifact.file)).toEqual({
            version: 'tree-0.1',
            tree: expect.objectContaining({
                id: 'App',
                path: '',
                children: {
                    Tree: expect.objectContaining({
                        id: 'Tree',
                        path: 'Tree',
                    }),
                    myfirststack: expect.objectContaining({
                        id: 'myfirststack',
                        path: 'myfirststack',
                        children: expect.objectContaining({
                            myfirstresource: expect.objectContaining({
                                id: 'myfirstresource',
                                path: 'myfirststack/myfirstresource',
                                attributes: {
                                    'aws:cdk:cloudformation:type': 'CDK::UnitTest::MyCfnResource',
                                    'aws:cdk:cloudformation:props': {
                                        lazykey: 'LazyResolved!',
                                    },
                                },
                            }),
                        }),
                    }),
                    mysecondstack: expect.objectContaining({
                        id: 'mysecondstack',
                        path: 'mysecondstack',
                        children: expect.objectContaining({
                            mysecondresource: expect.objectContaining({
                                id: 'mysecondresource',
                                path: 'mysecondstack/mysecondresource',
                                attributes: {
                                    'aws:cdk:cloudformation:type': 'CDK::UnitTest::MyCfnResource',
                                    'aws:cdk:cloudformation:props': {
                                        myprop: 'LazyResolved!',
                                    },
                                },
                            }),
                        }),
                    }),
                },
            }),
        });
    });
    test('tree metadata can be disabled', () => {
        // GIVEN
        const app = new index_1.App({
            treeMetadata: false,
        });
        // WHEN
        const stack = new index_1.Stack(app, 'mystack');
        new constructs_1.Construct(stack, 'myconstruct');
        const assembly = app.synth();
        const treeArtifact = assembly.tree();
        // THEN
        expect(treeArtifact).not.toBeDefined();
    });
    test('failing nodes', () => {
        class MyCfnResource extends index_1.CfnResource {
            inspect(_) {
                throw new Error('Forcing an inspect error');
            }
        }
        const app = new index_1.App();
        const stack = new index_1.Stack(app, 'mystack');
        new MyCfnResource(stack, 'mycfnresource', {
            type: 'CDK::UnitTest::MyCfnResource',
        });
        const assembly = app.synth();
        const treeArtifact = assembly.tree();
        expect(treeArtifact).toBeDefined();
        const treenode = app.node.findChild('Tree');
        const warn = treenode.node.metadata.find((md) => {
            return md.type === cxschema.ArtifactMetadataEntryType.WARN
                && /Forcing an inspect error/.test(md.data)
                && /mycfnresource/.test(md.data);
        });
        expect(warn).toBeDefined();
        // assert that the rest of the construct tree is rendered
        expect(readJson(assembly.directory, treeArtifact.file)).toEqual({
            version: 'tree-0.1',
            tree: expect.objectContaining({
                id: 'App',
                path: '',
                children: {
                    Tree: expect.objectContaining({
                        id: 'Tree',
                        path: 'Tree',
                    }),
                    mystack: expect.objectContaining({
                        id: 'mystack',
                        path: 'mystack',
                    }),
                },
            }),
        });
    });
});
function readJson(outdir, file) {
    return JSON.parse(fs.readFileSync(path.join(outdir, file), 'utf-8'));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1tZXRhZGF0YS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidHJlZS1tZXRhZGF0YS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEseUJBQXlCO0FBQ3pCLDZCQUE2QjtBQUM3QiwyREFBMkQ7QUFDM0QsMkNBQXVDO0FBQ3ZDLDJDQUE2RjtBQUU3RixNQUFlLG1CQUFvQixTQUFRLG1CQUFXO0lBQ3BELFlBQVksS0FBZ0IsRUFBRSxFQUFVO1FBQ3RDLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFO1lBQ2YsSUFBSSxFQUFFLDhCQUE4QjtTQUNyQyxDQUFDLENBQUM7S0FDSjtJQUVNLE9BQU8sQ0FBQyxTQUF3QjtRQUNyQyxTQUFTLENBQUMsWUFBWSxDQUFDLDZCQUE2QixFQUFFLDhCQUE4QixDQUFDLENBQUM7UUFDdEYsU0FBUyxDQUFDLFlBQVksQ0FBQyw4QkFBOEIsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7S0FDNUU7Q0FHRjtBQUVELFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLElBQUksQ0FBQyx3Q0FBd0MsRUFBRSxHQUFHLEVBQUU7UUFDbEQsTUFBTSxHQUFHLEdBQUcsSUFBSSxXQUFHLEVBQUUsQ0FBQztRQUV0QixNQUFNLEtBQUssR0FBRyxJQUFJLGFBQUssQ0FBQyxHQUFHLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDeEMsSUFBSSxzQkFBUyxDQUFDLEtBQUssRUFBRSxhQUFhLENBQUMsQ0FBQztRQUVwQyxNQUFNLFFBQVEsR0FBRyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDN0IsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUVuQyxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsWUFBYSxDQUFDLElBQUksQ0FBQyxDQUFD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QUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUUzQix5REFBeUQ7UUFDekQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLFlBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUMvRCxPQUFPLEVBQUUsVUFBVTtZQUNuQixJQUFJLEVBQUUsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUM1QixFQUFFLEVBQUUsS0FBSztnQkFDVCxJQUFJLEVBQUUsRUFBRTtnQkFDUixRQUFRLEVBQUU7b0JBQ1IsSUFBSSxFQUFFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQzt3QkFDNUIsRUFBRSxFQUFFLE1BQU07d0JBQ1YsSUFBSSxFQUFFLE1BQU07cUJBQ2IsQ0FBQztvQkFDRixPQUFPLEVBQUUsTUFBTSxDQUFDLGdCQUFnQixDQUFDO3dCQUMvQixFQUFFLEVBQUUsU0FBUzt3QkFDYixJQUFJLEVBQUUsU0FBUztxQkFDaEIsQ0FBQztpQkFDSDthQUNGLENBQUM7U0FDSCxDQUFDLENBQUM7SUFHTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsU0FBUyxRQUFRLENBQUMsTUFBYyxFQUFFLElBQVk7SUFDNUMsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztBQUN2RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIGN4c2NoZW1hIGZyb20gJy4uLy4uLy4uL2Nsb3VkLWFzc2VtYmx5LXNjaGVtYSc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IEFwcCwgQ2ZuUGFyYW1ldGVyLCBDZm5SZXNvdXJjZSwgTGF6eSwgU3RhY2ssIFRyZWVJbnNwZWN0b3IgfSBmcm9tICcuLi8uLi9saWIvaW5kZXgnO1xuXG5hYnN0cmFjdCBjbGFzcyBBYnN0cmFjdENmblJlc291cmNlIGV4dGVuZHMgQ2ZuUmVzb3VyY2Uge1xuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCB7XG4gICAgICB0eXBlOiAnQ0RLOjpVbml0VGVzdDo6TXlDZm5SZXNvdXJjZScsXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgaW5zcGVjdChpbnNwZWN0b3I6IFRyZWVJbnNwZWN0b3IpIHtcbiAgICBpbnNwZWN0b3IuYWRkQXR0cmlidXRlKCdhd3M6Y2RrOmNsb3VkZm9ybWF0aW9uOnR5cGUnLCAnQ0RLOjpVbml0VGVzdDo6TXlDZm5SZXNvdXJjZScpO1xuICAgIGluc3BlY3Rvci5hZGRBdHRyaWJ1dGUoJ2F3czpjZGs6Y2xvdWRmb3JtYXRpb246cHJvcHMnLCB0aGlzLmNmblByb3BlcnRpZXMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IG92ZXJyaWRlIGdldCBjZm5Qcm9wZXJ0aWVzKCk6IHsgW2tleTogc3RyaW5nXTogYW55IH07XG59XG5cbmRlc2NyaWJlKCd0cmVlIG1ldGFkYXRhJywgKCkgPT4ge1xuICB0ZXN0KCd0cmVlIG1ldGFkYXRhIGlzIGdlbmVyYXRlZCBhcyBleHBlY3RlZCcsICgpID0+IHtcbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhhcHAsICdteXN0YWNrJyk7XG4gICAgbmV3IENvbnN0cnVjdChzdGFjaywgJ215Y29uc3RydWN0Jyk7XG5cbiAgICBjb25zdCBhc3NlbWJseSA9IGFwcC5zeW50aCgpO1xuICAgIGNvbnN0IHRyZWVBcnRpZmFjdCA9IGFzc2VtYmx5LnRyZWUoKTtcbiAgICBleHBlY3QodHJlZUFydGlmYWN0KS50b0JlRGVmaW5lZCgpO1xuXG4gICAgZXhwZWN0KHJlYWRKc29uKGFzc2VtYmx5LmRpcmVjdG9yeSwgdHJlZUFydGlmYWN0IS5maWxlKSkudG9FcXVhbCh7XG4gICAgICB2ZXJzaW9uOiAndHJlZS0wLjEnLFxuICAgICAgdHJlZTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICBpZDogJ0FwcCcsXG4gICAgICAgIHBhdGg6ICcnLFxuICAgICAgICBjaGlsZHJlbjoge1xuICAgICAgICAgIFRyZWU6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIGlkOiAnVHJlZScsXG4gICAgICAgICAgICBwYXRoOiAnVHJlZScsXG4gICAgICAgICAgfSksXG4gICAgICAgICAgbXlzdGFjazogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgaWQ6ICdteXN0YWNrJyxcbiAgICAgICAgICAgIHBhdGg6ICdteXN0YWNrJyxcbiAgICAgICAgICAgIGNoaWxkcmVuOiB7XG4gICAgICAgICAgICAgIEJvb3RzdHJhcFZlcnNpb246IHtcbiAgICAgICAgICAgICAgICBjb25zdHJ1Y3RJbmZvOiB7XG4gICAgICAgICAgICAgICAgICBmcW46ICdhd3MtY2RrLWxpYi5DZm5QYXJhbWV0ZXInLFxuICAgICAgICAgICAgICAgICAgdmVyc2lvbjogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6ICdCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICAgICAgICBwYXRoOiAnbXlzdGFjay9Cb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgQ2hlY2tCb290c3RyYXBWZXJzaW9uOiB7XG4gICAgICAgICAgICAgICAgY29uc3RydWN0SW5mbzoge1xuICAgICAgICAgICAgICAgICAgZnFuOiAnYXdzLWNkay1saWIuQ2ZuUnVsZScsXG4gICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBleHBlY3QuYW55KFN0cmluZyksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpZDogJ0NoZWNrQm9vdHN0cmFwVmVyc2lvbicsXG4gICAgICAgICAgICAgICAgcGF0aDogJ215c3RhY2svQ2hlY2tCb290c3RyYXBWZXJzaW9uJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbXljb25zdHJ1Y3Q6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgICBpZDogJ215Y29uc3RydWN0JyxcbiAgICAgICAgICAgICAgICBwYXRoOiAnbXlzdGFjay9teWNvbnN0cnVjdCcsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCd0cmVlIG1ldGFkYXRhIGZvciBhIENmbiByZXNvdXJjZScsICgpID0+IHtcbiAgICBjbGFzcyBNeUNmblJlc291cmNlIGV4dGVuZHMgQWJzdHJhY3RDZm5SZXNvdXJjZSB7XG4gICAgICBwcm90ZWN0ZWQgZ2V0IGNmblByb3BlcnRpZXMoKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbXlzdHJpbmdwcm9wa2V5OiAnbXlzdHJpbmdwcm9wdmFsJyxcbiAgICAgICAgICBteWxpc3Rwcm9wa2V5OiBbJ2xpc3RpdGVtMSddLFxuICAgICAgICAgIG15c3RydWN0cHJvcGtleToge1xuICAgICAgICAgICAgbXlib29scHJvcGtleTogdHJ1ZSxcbiAgICAgICAgICAgIG15bnVtcHJvcGtleTogNTAsXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnbXlzdGFjaycpO1xuICAgIG5ldyBNeUNmblJlc291cmNlKHN0YWNrLCAnbXljZm5yZXNvdXJjZScpO1xuXG4gICAgY29uc3QgYXNzZW1ibHkgPSBhcHAuc3ludGgoKTtcbiAgICBjb25zdCB0cmVlQXJ0aWZhY3QgPSBhc3NlbWJseS50cmVlKCk7XG4gICAgZXhwZWN0KHRyZWVBcnRpZmFjdCkudG9CZURlZmluZWQoKTtcblxuICAgIGV4cGVjdChyZWFkSnNvbihhc3NlbWJseS5kaXJlY3RvcnksIHRyZWVBcnRpZmFjdCEuZmlsZSkpLnRvRXF1YWwoe1xuICAgICAgdmVyc2lvbjogJ3RyZWUtMC4xJyxcbiAgICAgIHRyZWU6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgaWQ6ICdBcHAnLFxuICAgICAgICBwYXRoOiAnJyxcbiAgICAgICAgY2hpbGRyZW46IHtcbiAgICAgICAgICBUcmVlOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBpZDogJ1RyZWUnLFxuICAgICAgICAgICAgcGF0aDogJ1RyZWUnLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIG15c3RhY2s6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIGlkOiAnbXlzdGFjaycsXG4gICAgICAgICAgICBwYXRoOiAnbXlzdGFjaycsXG4gICAgICAgICAgICBjaGlsZHJlbjogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgICBteWNmbnJlc291cmNlOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAgICAgaWQ6ICdteWNmbnJlc291cmNlJyxcbiAgICAgICAgICAgICAgICBwYXRoOiAnbXlzdGFjay9teWNmbnJlc291cmNlJyxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICAnYXdzOmNkazpjbG91ZGZvcm1hdGlvbjp0eXBlJzogJ0NESzo6VW5pdFRlc3Q6Ok15Q2ZuUmVzb3VyY2UnLFxuICAgICAgICAgICAgICAgICAgJ2F3czpjZGs6Y2xvdWRmb3JtYXRpb246cHJvcHMnOiB7XG4gICAgICAgICAgICAgICAgICAgIG15c3RyaW5ncHJvcGtleTogJ215c3RyaW5ncHJvcHZhbCcsXG4gICAgICAgICAgICAgICAgICAgIG15bGlzdHByb3BrZXk6IFsnbGlzdGl0ZW0xJ10sXG4gICAgICAgICAgICAgICAgICAgIG15c3RydWN0cHJvcGtleToge1xuICAgICAgICAgICAgICAgICAgICAgIG15Ym9vbHByb3BrZXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgbXludW1wcm9wa2V5OiA1MCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgIH0pO1xuXG4gIH0pO1xuXG4gIHRlc3QoJ3RyZWUgbWV0YWRhdGEgaGFzIGNvbnN0cnVjdCBjbGFzcyAmIHZlcnNpb24gaW4gdGhlcmUnLCAoKSA9PiB7XG4gICAgLy8gVGhlIHJ1bnRpbWUgbWV0YWRhdGEgdGhpcyB0ZXN0IHJlbGllcyBvbiBpcyBvbmx5IGF2YWlsYWJsZSBpZiB0aGUgbW9zdFxuICAgIC8vIHJlY2VudCBjb21waWxlIGhhcyBoYXBwZW5lZCB1c2luZyAnanNpaScsIGFzIHRoZSBqc2lpIGNvbXBpbGVyIGluamVjdHNcbiAgICAvLyB0aGlzIG1ldGFkYXRhLlxuICAgIC8vXG4gICAgLy8gSWYgdGhlIG1vc3QgcmVjZW50IGNvbXBpbGUgd2FzIHVzaW5nICd0c2MnLCB0aGUgbWV0YWRhdGEgd2lsbCBub3QgaGF2ZVxuICAgIC8vIGJlZW4gaW5qZWN0ZWQsIGFuZCB0aGUgdGVzdCB3aWxsIGZhaWwuXG4gICAgLy9cbiAgICAvLyBQZW9wbGUgbWF5IGNob29zZSB0byBydW4gYHRzY2AgZGlyZWN0bHkgKGluc3RlYWQgb2YgYHlhcm4gYnVpbGRgIGZvclxuICAgIC8vIGV4YW1wbGUpIHRvIGVzY2FwZSB0aGUgYWRkaXRpb25hbCBUU0MgY29tcGlsYXRpb24gdGltZSB0aGF0IGlzIG5lY2Vzc2FyeVxuICAgIC8vIHRvIHJ1biAnZXNsaW50Jywgb3IgdGhlIGFkZGl0aW9uYWwgdGltZSB0aGF0ICdqc2lpJyBuZWVkcyB0byBhbmFseXplIHRoZVxuICAgIC8vIHR5cGUgc3lzdGVtKSwgdGhpcyB0ZXN0IGlzIGFsbG93ZWQgdG8gZmFpbCBpZiB3ZSdyZSBub3QgcnVubmluZyBvbiBDSS5cbiAgICAvL1xuICAgIC8vIElmIHRoZSBjb21waWxlIG9mIHRoaXMgbGlicmFyeSBoYXMgYmVlbiBkb25lIHVzaW5nIGB0c2NgLCB0aGUgcnVudGltZVxuICAgIC8vIGluZm9ybWF0aW9uIHdpbGwgYWx3YXlzIGZpbmQgYGNvbnN0cnVjdHMuQ29uc3RydWN0YCBhcyB0aGUgY29uc3RydWN0XG4gICAgLy8gaWRlbnRpZmllciwgc2luY2UgYGNvbnN0cnVjdHNgIHdpbGwgaGF2ZSBoYWQgYSByZWxlYXNlIGJ1aWxkIGRvbmUgdXNpbmcgYGpzaWlgLlxuICAgIC8vXG4gICAgLy8gSWYgdGhpcyB0ZXN0IGlzIHJ1bm5pbmcgb24gQ29kZUJ1aWxkLCB3ZSB3aWxsIHJlcXVpcmUgdGhhdCB0aGUgbW9yZSBzcGVjaWZpY1xuICAgIC8vIGNsYXNzIG5hbWVzIGFyZSBmb3VuZC4gSWYgdGhpcyB0ZXN0IGlzIE5PVCBydW5uaW5nIG9uIENvZGVCdWlsZCwgd2Ugd2lsbFxuICAgIC8vIGFsbG93IHRoZSBzcGVjaWZpYyBjbGFzcyBuYW1lIChmb3IgYSAnanNpaScgYnVpbGQpIG9yIHRoZSBnZW5lcmljXG4gICAgLy8gJ2NvbnN0cnVjdHMuQ29uc3RydWN0JyBjbGFzcyBuYW1lIChmb3IgYSAndHNjJyBidWlsZCkuXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnbXlzdGFjaycpO1xuICAgIG5ldyBDZm5SZXNvdXJjZShzdGFjaywgJ215Y29uc3RydWN0JywgeyB0eXBlOiAnQXdzOjpTb21lOjpSZXNvdXJjZScgfSk7XG5cbiAgICBjb25zdCBhc3NlbWJseSA9IGFwcC5zeW50aCgpO1xuICAgIGNvbnN0IHRyZWVBcnRpZmFjdCA9IGFzc2VtYmx5LnRyZWUoKTtcbiAgICBleHBlY3QodHJlZUFydGlmYWN0KS50b0JlRGVmaW5lZCgpO1xuXG4gICAgY29uc3QgY29kZUJ1aWxkID0gISFwcm9jZXNzLmVudi5DT0RFQlVJTERfQlVJTERfSUQ7XG5cbiAgICBleHBlY3QocmVhZEpzb24oYXNzZW1ibHkuZGlyZWN0b3J5LCB0cmVlQXJ0aWZhY3QhLmZpbGUpKS50b0VxdWFsKHtcbiAgICAgIHZlcnNpb246ICd0cmVlLTAuMScsXG4gICAgICB0cmVlOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIGNoaWxkcmVuOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgbXlzdGFjazogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgY29uc3RydWN0SW5mbzoge1xuICAgICAgICAgICAgICBmcW46IGV4cGVjdC5zdHJpbmdNYXRjaGluZyhjb2RlQnVpbGQgPyAvXFxiU3RhY2skLyA6IC9cXGJTdGFjayR8XmNvbnN0cnVjdHMuQ29uc3RydWN0JC8pLFxuICAgICAgICAgICAgICB2ZXJzaW9uOiBleHBlY3QuYW55KFN0cmluZyksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2hpbGRyZW46IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgbXljb25zdHJ1Y3Q6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgICBjb25zdHJ1Y3RJbmZvOiB7XG4gICAgICAgICAgICAgICAgICBmcW46IGV4cGVjdC5zdHJpbmdNYXRjaGluZyhjb2RlQnVpbGQgPyAvXFxiQ2ZuUmVzb3VyY2UkLyA6IC9cXGJDZm5SZXNvdXJjZSR8XmNvbnN0cnVjdHMuQ29uc3RydWN0JC8pLFxuICAgICAgICAgICAgICAgICAgdmVyc2lvbjogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pLFxuICAgICAgfSksXG4gICAgfSk7XG5cblxuICB9KTtcblxuICB0ZXN0KCd0b2tlbiByZXNvbHV0aW9uICYgY2ZuIHBhcmFtZXRlcicsICgpID0+IHtcbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnbXlzdGFjaycpO1xuICAgIGNvbnN0IGNmbnBhcmFtID0gbmV3IENmblBhcmFtZXRlcihzdGFjaywgJ215Y2ZucGFyYW0nKTtcblxuICAgIGNsYXNzIE15Q2ZuUmVzb3VyY2UgZXh0ZW5kcyBBYnN0cmFjdENmblJlc291cmNlIHtcbiAgICAgIHByb3RlY3RlZCBnZXQgY2ZuUHJvcGVydGllcygpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBsYXp5a2V5OiBMYXp5LnN0cmluZyh7IHByb2R1Y2U6ICgpID0+ICdMYXp5UmVzb2x2ZWQhJyB9KSxcbiAgICAgICAgICBjZm5wYXJhbWtleTogY2ZucGFyYW0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgbmV3IE15Q2ZuUmVzb3VyY2Uoc3RhY2ssICdteWNmbnJlc291cmNlJyk7XG5cbiAgICBjb25zdCBhc3NlbWJseSA9IGFwcC5zeW50aCgpO1xuICAgIGNvbnN0IHRyZWVBcnRpZmFjdCA9IGFzc2VtYmx5LnRyZWUoKTtcbiAgICBleHBlY3QodHJlZUFydGlmYWN0KS50b0JlRGVmaW5lZCgpO1xuXG4gICAgZXhwZWN0KHJlYWRKc29uKGFzc2VtYmx5LmRpcmVjdG9yeSwgdHJlZUFydGlmYWN0IS5maWxlKSkudG9FcXVhbCh7XG4gICAgICB2ZXJzaW9uOiAndHJlZS0wLjEnLFxuICAgICAgdHJlZTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICBpZDogJ0FwcCcsXG4gICAgICAgIHBhdGg6ICcnLFxuICAgICAgICBjaGlsZHJlbjoge1xuICAgICAgICAgIFRyZWU6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIGlkOiAnVHJlZScsXG4gICAgICAgICAgICBwYXRoOiAnVHJlZScsXG4gICAgICAgICAgfSksXG4gICAgICAgICAgbXlzdGFjazogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgaWQ6ICdteXN0YWNrJyxcbiAgICAgICAgICAgIHBhdGg6ICdteXN0YWNrJyxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAgIG15Y2ZucGFyYW06IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgICBpZDogJ215Y2ZucGFyYW0nLFxuICAgICAgICAgICAgICAgIHBhdGg6ICdteXN0YWNrL215Y2ZucGFyYW0nLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgbXljZm5yZXNvdXJjZTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgICAgIGlkOiAnbXljZm5yZXNvdXJjZScsXG4gICAgICAgICAgICAgICAgcGF0aDogJ215c3RhY2svbXljZm5yZXNvdXJjZScsXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgICAgJ2F3czpjZGs6Y2xvdWRmb3JtYXRpb246dHlwZSc6ICdDREs6OlVuaXRUZXN0OjpNeUNmblJlc291cmNlJyxcbiAgICAgICAgICAgICAgICAgICdhd3M6Y2RrOmNsb3VkZm9ybWF0aW9uOnByb3BzJzoge1xuICAgICAgICAgICAgICAgICAgICBsYXp5a2V5OiAnTGF6eVJlc29sdmVkIScsXG4gICAgICAgICAgICAgICAgICAgIGNmbnBhcmFta2V5OiB7IFJlZjogJ215Y2ZucGFyYW0nIH0sXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICB9KTtcblxuICB9KTtcblxuICB0ZXN0KCdjcm9zcy1zdGFjayB0b2tlbnMnLCAoKSA9PiB7XG4gICAgY2xhc3MgTXlGaXJzdFJlc291cmNlIGV4dGVuZHMgQWJzdHJhY3RDZm5SZXNvdXJjZSB7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgbGF6eWtleTogc3RyaW5nO1xuXG4gICAgICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKHNjb3BlLCBpZCk7XG4gICAgICAgIHRoaXMubGF6eWtleSA9IExhenkuc3RyaW5nKHsgcHJvZHVjZTogKCkgPT4gJ0xhenlSZXNvbHZlZCEnIH0pO1xuICAgICAgfVxuXG4gICAgICBwcm90ZWN0ZWQgZ2V0IGNmblByb3BlcnRpZXMoKTogeyBba2V5OiBzdHJpbmddOiBhbnkgfSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbGF6eWtleTogdGhpcy5sYXp5a2V5LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIGNsYXNzIE15U2Vjb25kUmVzb3VyY2UgZXh0ZW5kcyBBYnN0cmFjdENmblJlc291cmNlIHtcbiAgICAgIHB1YmxpYyByZWFkb25seSBteXByb3A6IHN0cmluZztcblxuICAgICAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgbXlwcm9wOiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIoc2NvcGUsIGlkKTtcbiAgICAgICAgdGhpcy5teXByb3AgPSBteXByb3A7XG4gICAgICB9XG5cbiAgICAgIHByb3RlY3RlZCBnZXQgY2ZuUHJvcGVydGllcygpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBteXByb3A6IHRoaXMubXlwcm9wLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgICBjb25zdCBmaXJzdHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ215Zmlyc3RzdGFjaycpO1xuICAgIGNvbnN0IGZpcnN0cmVzID0gbmV3IE15Rmlyc3RSZXNvdXJjZShmaXJzdHN0YWNrLCAnbXlmaXJzdHJlc291cmNlJyk7XG4gICAgY29uc3Qgc2Vjb25kc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnbXlzZWNvbmRzdGFjaycpO1xuICAgIG5ldyBNeVNlY29uZFJlc291cmNlKHNlY29uZHN0YWNrLCAnbXlzZWNvbmRyZXNvdXJjZScsIGZpcnN0cmVzLmxhenlrZXkpO1xuXG4gICAgY29uc3QgYXNzZW1ibHkgPSBhcHAuc3ludGgoKTtcbiAgICBjb25zdCB0cmVlQXJ0aWZhY3QgPSBhc3NlbWJseS50cmVlKCk7XG4gICAgZXhwZWN0KHRyZWVBcnRpZmFjdCkudG9CZURlZmluZWQoKTtcblxuICAgIGV4cGVjdChyZWFkSnNvbihhc3NlbWJseS5kaXJlY3RvcnksIHRyZWVBcnRpZmFjdCEuZmlsZSkpLnRvRXF1YWwoe1xuICAgICAgdmVyc2lvbjogJ3RyZWUtMC4xJyxcbiAgICAgIHRyZWU6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgaWQ6ICdBcHAnLFxuICAgICAgICBwYXRoOiAnJyxcbiAgICAgICAgY2hpbGRyZW46IHtcbiAgICAgICAgICBUcmVlOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBpZDogJ1RyZWUnLFxuICAgICAgICAgICAgcGF0aDogJ1RyZWUnLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIG15Zmlyc3RzdGFjazogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgaWQ6ICdteWZpcnN0c3RhY2snLFxuICAgICAgICAgICAgcGF0aDogJ215Zmlyc3RzdGFjaycsXG4gICAgICAgICAgICBjaGlsZHJlbjogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgICBteWZpcnN0cmVzb3VyY2U6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgICBpZDogJ215Zmlyc3RyZXNvdXJjZScsXG4gICAgICAgICAgICAgICAgcGF0aDogJ215Zmlyc3RzdGFjay9teWZpcnN0cmVzb3VyY2UnLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICAgICdhd3M6Y2RrOmNsb3VkZm9ybWF0aW9uOnR5cGUnOiAnQ0RLOjpVbml0VGVzdDo6TXlDZm5SZXNvdXJjZScsXG4gICAgICAgICAgICAgICAgICAnYXdzOmNkazpjbG91ZGZvcm1hdGlvbjpwcm9wcyc6IHtcbiAgICAgICAgICAgICAgICAgICAgbGF6eWtleTogJ0xhenlSZXNvbHZlZCEnLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIG15c2Vjb25kc3RhY2s6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIGlkOiAnbXlzZWNvbmRzdGFjaycsXG4gICAgICAgICAgICBwYXRoOiAnbXlzZWNvbmRzdGFjaycsXG4gICAgICAgICAgICBjaGlsZHJlbjogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgICBteXNlY29uZHJlc291cmNlOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAgICAgaWQ6ICdteXNlY29uZHJlc291cmNlJyxcbiAgICAgICAgICAgICAgICBwYXRoOiAnbXlzZWNvbmRzdGFjay9teXNlY29uZHJlc291cmNlJyxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICAnYXdzOmNkazpjbG91ZGZvcm1hdGlvbjp0eXBlJzogJ0NESzo6VW5pdFRlc3Q6Ok15Q2ZuUmVzb3VyY2UnLFxuICAgICAgICAgICAgICAgICAgJ2F3czpjZGs6Y2xvdWRmb3JtYXRpb246cHJvcHMnOiB7XG4gICAgICAgICAgICAgICAgICAgIG15cHJvcDogJ0xhenlSZXNvbHZlZCEnLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3RyZWUgbWV0YWRhdGEgY2FuIGJlIGRpc2FibGVkJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCh7XG4gICAgICB0cmVlTWV0YWRhdGE6IGZhbHNlLFxuICAgIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ215c3RhY2snKTtcbiAgICBuZXcgQ29uc3RydWN0KHN0YWNrLCAnbXljb25zdHJ1Y3QnKTtcblxuICAgIGNvbnN0IGFzc2VtYmx5ID0gYXBwLnN5bnRoKCk7XG4gICAgY29uc3QgdHJlZUFydGlmYWN0ID0gYXNzZW1ibHkudHJlZSgpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCh0cmVlQXJ0aWZhY3QpLm5vdC50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICB0ZXN0KCdmYWlsaW5nIG5vZGVzJywgKCkgPT4ge1xuICAgIGNsYXNzIE15Q2ZuUmVzb3VyY2UgZXh0ZW5kcyBDZm5SZXNvdXJjZSB7XG4gICAgICBwdWJsaWMgaW5zcGVjdChfOiBUcmVlSW5zcGVjdG9yKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRm9yY2luZyBhbiBpbnNwZWN0IGVycm9yJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ215c3RhY2snKTtcbiAgICBuZXcgTXlDZm5SZXNvdXJjZShzdGFjaywgJ215Y2ZucmVzb3VyY2UnLCB7XG4gICAgICB0eXBlOiAnQ0RLOjpVbml0VGVzdDo6TXlDZm5SZXNvdXJjZScsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhc3NlbWJseSA9IGFwcC5zeW50aCgpO1xuICAgIGNvbnN0IHRyZWVBcnRpZmFjdCA9IGFzc2VtYmx5LnRyZWUoKTtcbiAgICBleHBlY3QodHJlZUFydGlmYWN0KS50b0JlRGVmaW5lZCgpO1xuXG4gICAgY29uc3QgdHJlZW5vZGUgPSBhcHAubm9kZS5maW5kQ2hpbGQoJ1RyZWUnKTtcblxuICAgIGNvbnN0IHdhcm4gPSB0cmVlbm9kZS5ub2RlLm1ldGFkYXRhLmZpbmQoKG1kKSA9PiB7XG4gICAgICByZXR1cm4gbWQudHlwZSA9PT0gY3hzY2hlbWEuQXJ0aWZhY3RNZXRhZGF0YUVudHJ5VHlwZS5XQVJOXG4gICAgICAgICYmIC9Gb3JjaW5nIGFuIGluc3BlY3QgZXJyb3IvLnRlc3QobWQuZGF0YSBhcyBzdHJpbmcpXG4gICAgICAgICYmIC9teWNmbnJlc291cmNlLy50ZXN0KG1kLmRhdGEgYXMgc3RyaW5nKTtcbiAgICB9KTtcbiAgICBleHBlY3Qod2FybikudG9CZURlZmluZWQoKTtcblxuICAgIC8vIGFzc2VydCB0aGF0IHRoZSByZXN0IG9mIHRoZSBjb25zdHJ1Y3QgdHJlZSBpcyByZW5kZXJlZFxuICAgIGV4cGVjdChyZWFkSnNvbihhc3NlbWJseS5kaXJlY3RvcnksIHRyZWVBcnRpZmFjdCEuZmlsZSkpLnRvRXF1YWwoe1xuICAgICAgdmVyc2lvbjogJ3RyZWUtMC4xJyxcbiAgICAgIHRyZWU6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgaWQ6ICdBcHAnLFxuICAgICAgICBwYXRoOiAnJyxcbiAgICAgICAgY2hpbGRyZW46IHtcbiAgICAgICAgICBUcmVlOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBpZDogJ1RyZWUnLFxuICAgICAgICAgICAgcGF0aDogJ1RyZWUnLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIG15c3RhY2s6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIGlkOiAnbXlzdGFjaycsXG4gICAgICAgICAgICBwYXRoOiAnbXlzdGFjaycsXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICB9KTtcblxuXG4gIH0pO1xufSk7XG5cbmZ1bmN0aW9uIHJlYWRKc29uKG91dGRpcjogc3RyaW5nLCBmaWxlOiBzdHJpbmcpIHtcbiAgcmV0dXJuIEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbihvdXRkaXIsIGZpbGUpLCAndXRmLTgnKSk7XG59XG4iXX0=