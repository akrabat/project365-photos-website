"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const helpers_internal_1 = require("../../lib/helpers-internal");
const unique_resource_name_1 = require("../../lib/private/unique-resource-name");
const pathHash = (path) => {
    return (0, helpers_internal_1.md5hash)(path.join('/')).slice(0, 8).toUpperCase();
};
describe('makeUniqueResourceName tests', () => {
    test('unique resource name is just resource name when the resource is top level, short enough, has no nonalphanumeric characters', () => {
        const uniqueResourceName = (0, unique_resource_name_1.makeUniqueResourceName)(['toplevelresource'], {});
        expect(uniqueResourceName).toEqual('toplevelresource');
    });
    test('unique resource name is shortened with a hash added when resource is top level and resource name is too long', () => {
        const tooLongName = ['anamethatisslightlylongerthan256charactersthatisalsoatoplevelresourcesothereisonlyonevalueinthisarrayandapparentlybrevityisnotthestrongpointofthepersonwhonamedthisresourcewhichIbettheywillcometoregretlaterbutitiswhatitisanywhodlethisfunctionshouldshortenthis'];
        const uniqueResourceName = (0, unique_resource_name_1.makeUniqueResourceName)(tooLongName, {});
        const expectedName = `anamethatisslightlylongerthan256charactersthatisalsoatoplevelresourcesothereisonlyonevalueinthisarrayandapparentlybrevityisngpointofthepersonwhonamedthisresourcewhichIbettheywillcometoregretlaterbutitiswhatitisanywhodlethisfunctionshouldshortenthis${pathHash(tooLongName)}`;
        expect(uniqueResourceName).toEqual(expectedName);
        expect(uniqueResourceName.length).toEqual(256);
    });
    test('unique resource name removes special characters when resource is top level', () => {
        const componentsPath = ['I-love-special-characters-¯\\\_(ツ)_/¯-for-real-though'];
        const expectedName = 'Ilovespecialcharactersforrealthough';
        expect((0, unique_resource_name_1.makeUniqueResourceName)(componentsPath, {})).toEqual(expectedName);
    });
    test('unique resource name shortens from the middle and adds a hash when maxLength is defined, resource is top level, and resource name is longer than max', () => {
        const componentsPath = ['ThisIsStillLongerThanTheAllowedLength'];
        const expectedName = `ThisIsLength${pathHash(componentsPath)}`;
        expect((0, unique_resource_name_1.makeUniqueResourceName)(componentsPath, { maxLength: 20 })).toEqual(expectedName);
    });
    test('unique resource name shortens from the middle and adds a hash when maxLength is defined, resource is top level, resource name is longer than max, and separator is provided', () => {
        const componentsPath = ['ThisIsStillLongerThanTheAllowedLength'];
        const expectedName = `ThisIsength-${pathHash(componentsPath)}`;
        expect((0, unique_resource_name_1.makeUniqueResourceName)(componentsPath, { maxLength: 20, separator: '-' })).toEqual(expectedName);
    });
    test('unique resource name removes special characters and makes no other changes when resouce is top level and too long with special characters but proper length without', () => {
        const tooLongName = ['a-name-that-is-slightly-longer-than-256-characters-that-is-also-a-top-level-resource-so-there-is-only-one-value-in-this-array-and-apparently-brevity-is-not-the-strong-point-of-the-person-who-named-this-resource-which-I-bet-they-will-come-to-regret-later-but-it-is-what-it-is'];
        const expectedName = 'anamethatisslightlylongerthan256charactersthatisalsoatoplevelresourcesothereisonlyonevalueinthisarrayandapparentlybrevityisnotthestrongpointofthepersonwhonamedthisresourcewhichIbettheywillcometoregretlaterbutitiswhatitis';
        expect((0, unique_resource_name_1.makeUniqueResourceName)(tooLongName, {})).toEqual(expectedName);
    });
    test('unique resource name leaves in allowed special characters and adds no hash when resource is top level and resouce name is short enougn', () => {
        const componentsPath = ['¯\\\_(ツ)_/¯-shruggie-gets-to-stay-¯\\\_(ツ)_/¯'];
        const expectedName = '¯\_(ツ)_/¯shruggiegetstostay¯\_(ツ)_/¯';
        expect((0, unique_resource_name_1.makeUniqueResourceName)(componentsPath, { allowedSpecialCharacters: '¯\\\_(ツ)/', maxLength: 200 })).toEqual(expectedName);
    });
    test('unique resource name leaves in allowed special characters and adds no hash or separators when resource is top level and resouce name is short enougn', () => {
        const componentsPath = ['¯\\\_(ツ)_/¯-shruggie-gets-to-stay-¯\\\_(ツ)_/¯'];
        const expectedName = '¯\_(ツ)_/¯shruggiegetstostay¯\_(ツ)_/¯';
        expect((0, unique_resource_name_1.makeUniqueResourceName)(componentsPath, { allowedSpecialCharacters: '¯\\\_(ツ)/', maxLength: 200, separator: '-' })).toEqual(expectedName);
    });
    test('unique resource name is shortened with a hash and separator added when resource is top level, resource name is too long, and separator is provided', () => {
        const tooLongName = ['anamethatisslightlylongerthan256charactersthatisalsoatoplevelresourcesothereisonlyonevalueinthisarrayandapparentlybrevityisnotthestrongpointofthepersonwhonamedthisresourcewhichIbettheywillcometoregretlaterbutitiswhatitisanywhodlethisfunctionshouldshortenthis'];
        const uniqueResourceName = (0, unique_resource_name_1.makeUniqueResourceName)(tooLongName, { separator: '~' });
        const expectedName = `anamethatisslightlylongerthan256charactersthatisalsoatoplevelresourcesothereisonlyonevalueinthisarrayandapparentlybrevityisnpointofthepersonwhonamedthisresourcewhichIbettheywillcometoregretlaterbutitiswhatitisanywhodlethisfunctionshouldshortenthis~${pathHash(tooLongName)}`;
        expect(uniqueResourceName).toEqual(expectedName);
        expect(uniqueResourceName.length).toEqual(256);
    });
    test('unique resource name removes special characters when they are included in the components names', () => {
        const componentsPath = ['I', 'love', 'special', 'characters', '¯\\\_(ツ)_/¯', 'for', 'real', 'though'];
        const expectedName = `Ilovespecialcharactersforrealthough${pathHash(componentsPath)}`;
        expect((0, unique_resource_name_1.makeUniqueResourceName)(componentsPath, {})).toEqual(expectedName);
    });
    test('unique resource name removes special characters that are not allow listed and leaves the allowed ones', () => {
        const componentsPath = ['I-love-special-characters-', '¯\\\_(ツ)_/¯', '-for-real-though-'];
        const expectedName = `I-love-special-characters--for-real-though-${pathHash(componentsPath)}`;
        expect((0, unique_resource_name_1.makeUniqueResourceName)(componentsPath, { allowedSpecialCharacters: '-' })).toEqual(expectedName);
    });
    test('unique resource name adds in separator and adds hash when separator is provided and name is not too long', () => {
        const componentsPath = ['This', 'unique', 'resource', 'name', 'needs', 'a', 'separator'];
        const expectedName = `This.*.unique.*.resource.*.name.*.needs.*.a.*.separator.*.${pathHash(componentsPath)}`;
        expect((0, unique_resource_name_1.makeUniqueResourceName)(componentsPath, { separator: '.*.' })).toEqual(expectedName);
    });
    test('unique resource name adds in separator, adds hash, and shortens name when separator is provided and name too long', () => {
        const componentsPath = ['This', 'unique', 'resource', 'name', 'is', 'longer', 'than', 'allowed'];
        const expectedName = `This/unique/resourcelonger/than/allowed/${pathHash(componentsPath)}`;
        expect((0, unique_resource_name_1.makeUniqueResourceName)(componentsPath, { maxLength: 48, separator: '/' })).toEqual(expectedName);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pcXVlLXJlc291cmNlLW5hbWUudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVuaXF1ZS1yZXNvdXJjZS1uYW1lLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpRUFBcUQ7QUFDckQsaUZBQWdGO0FBRWhGLE1BQU0sUUFBUSxHQUFHLENBQUMsSUFBYyxFQUFVLEVBQUU7SUFDMUMsT0FBTyxJQUFBLDBCQUFPLEVBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDM0QsQ0FBQyxDQUFDO0FBRUYsUUFBUSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtJQUM1QyxJQUFJLENBQUMsNEhBQTRILEVBQUUsR0FBRyxFQUFFO1FBQ3RJLE1BQU0sa0JBQWtCLEdBQUcsSUFBQSw2Q0FBc0IsRUFBQyxDQUFDLGtCQUFrQixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDNUUsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDekQsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsOEdBQThHLEVBQUUsR0FBRyxFQUFFO1FBQ3hILE1BQU0sV0FBVyxHQUFHLENBQUMsb1FBQW9RLENBQUMsQ0FBQztRQUMzUixNQUFNLGtCQUFrQixHQUFHLElBQUEsNkNBQXNCLEVBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRW5FLE1BQU0sWUFBWSxHQUFHLDJQQUEyUCxRQUFRLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztRQUN4UyxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDakQsTUFBTSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNq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LFFBQVEsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO1FBRTdHLE1BQU0sQ0FBQyxJQUFBLDZDQUFzQixFQUFDLGNBQWMsRUFBRSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzdGLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLG1IQUFtSCxFQUFFLEdBQUcsRUFBRTtRQUM3SCxNQUFNLGNBQWMsR0FBRyxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxTQUFTLENBQUMsQ0FBQztRQUNqRyxNQUFNLFlBQVksR0FBRywyQ0FBMkMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUM7UUFFM0YsTUFBTSxDQUFDLElBQUEsNkNBQXNCLEVBQUMsY0FBYyxFQUFFLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUMxRyxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWQ1aGFzaCB9IGZyb20gJy4uLy4uL2xpYi9oZWxwZXJzLWludGVybmFsJztcbmltcG9ydCB7IG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUgfSBmcm9tICcuLi8uLi9saWIvcHJpdmF0ZS91bmlxdWUtcmVzb3VyY2UtbmFtZSc7XG5cbmNvbnN0IHBhdGhIYXNoID0gKHBhdGg6IHN0cmluZ1tdKTogc3RyaW5nID0+IHtcbiAgcmV0dXJuIG1kNWhhc2gocGF0aC5qb2luKCcvJykpLnNsaWNlKDAsIDgpLnRvVXBwZXJDYXNlKCk7XG59O1xuXG5kZXNjcmliZSgnbWFrZVVuaXF1ZVJlc291cmNlTmFtZSB0ZXN0cycsICgpID0+IHtcbiAgdGVzdCgndW5pcXVlIHJlc291cmNlIG5hbWUgaXMganVzdCByZXNvdXJjZSBuYW1lIHdoZW4gdGhlIHJlc291cmNlIGlzIHRvcCBsZXZlbCwgc2hvcnQgZW5vdWdoLCBoYXMgbm8gbm9uYWxwaGFudW1lcmljIGNoYXJhY3RlcnMnLCAoKSA9PiB7XG4gICAgY29uc3QgdW5pcXVlUmVzb3VyY2VOYW1lID0gbWFrZVVuaXF1ZVJlc291cmNlTmFtZShbJ3RvcGxldmVscmVzb3VyY2UnXSwge30pO1xuICAgIGV4cGVjdCh1bmlxdWVSZXNvdXJjZU5hbWUpLnRvRXF1YWwoJ3RvcGxldmVscmVzb3VyY2UnKTtcbiAgfSk7XG5cbiAgdGVzdCgndW5pcXVlIHJlc291cmNlIG5hbWUgaXMgc2hvcnRlbmVkIHdpdGggYSBoYXNoIGFkZGVkIHdoZW4gcmVzb3VyY2UgaXMgdG9wIGxldmVsIGFuZCByZXNvdXJjZSBuYW1lIGlzIHRvbyBsb25nJywgKCkgPT4ge1xuICAgIGNvbnN0IHRvb0xvbmdOYW1lID0gWydhbmFtZXRoYXRpc3NsaWdodGx5bG9uZ2VydGhhbjI1NmNoYXJhY3RlcnN0aGF0aXNhbHNvYXRvcGxldmVscmVzb3VyY2Vzb3RoZXJlaXNvbmx5b25ldmFsdWVpbnRoaXNhcnJheWFuZGFwcGFyZW50bHlicmV2aXR5aXNub3R0aGVzdHJvbmdwb2ludG9mdGhlcGVyc29ud2hvbmFtZWR0aGlzcmVzb3VyY2V3aGljaEliZXR0aGV5d2lsbGNvbWV0b3JlZ3JldGxhdGVyYnV0aXRpc3doYXRpdGlzYW55d2hvZGxldGhpc2Z1bmN0aW9uc2hvdWxkc2hvcnRlbnRoaXMnXTtcbiAgICBjb25zdCB1bmlxdWVSZXNvdXJjZU5hbWUgPSBtYWtlVW5pcXVlUmVzb3VyY2VOYW1lKHRvb0xvbmdOYW1lLCB7fSk7XG5cbiAgICBjb25zdCBleHBlY3RlZE5hbWUgPSBgYW5hbWV0aGF0aXNzbGlnaHRseWxvbmdlcnRoYW4yNTZjaGFyYWN0ZXJzdGhhdGlzYWxzb2F0b3BsZXZlbHJlc291cmNlc290aGVyZWlzb25seW9uZXZhbHVlaW50aGlzYXJyYXlhbmRhcHBhcmVudGx5YnJldml0eWlzbmdwb2ludG9mdGhlcGVyc29ud2hvbmFtZWR0aGlzcmVzb3VyY2V3aGljaEliZXR0aGV5d2lsbGNvbWV0b3JlZ3JldGxhdGVyYnV0aXRpc3doYXRpdGlzYW55d2hvZGxldGhpc2Z1bmN0aW9uc2hvdWxkc2hvcnRlbnRoaXMke3BhdGhIYXNoKHRvb0xvbmdOYW1lKX1gO1xuICAgIGV4cGVjdCh1bmlxdWVSZXNvdXJjZU5hbWUpLnRvRXF1YWwoZXhwZWN0ZWROYW1lKTtcbiAgICBleHBlY3QodW5pcXVlUmVzb3VyY2VOYW1lLmxlbmd0aCkudG9FcXVhbCgyNTYpO1xuICB9KTtcblxuICB0ZXN0KCd1bmlxdWUgcmVzb3VyY2UgbmFtZSByZW1vdmVzIHNwZWNpYWwgY2hhcmFjdGVycyB3aGVuIHJlc291cmNlIGlzIHRvcCBsZXZlbCcsICgpID0+IHtcbiAgICBjb25zdCBjb21wb25lbnRzUGF0aCA9IFsnSS1sb3ZlLXNwZWNpYWwtY2hhcmFjdGVycy3Cr1xcXFxcXF8o44OEKV8vwq8tZm9yLXJlYWwtdGhvdWdoJ107XG4gICAgY29uc3QgZXhwZWN0ZWROYW1lID0gJ0lsb3Zlc3BlY2lhbGNoYXJhY3RlcnNmb3JyZWFsdGhvdWdoJztcblxuICAgIGV4cGVjdChtYWtlVW5pcXVlUmVzb3VyY2VOYW1lKGNvbXBvbmVudHNQYXRoLCB7fSkpLnRvRXF1YWwoZXhwZWN0ZWROYW1lKTtcbiAgfSk7XG5cbiAgdGVzdCgndW5pcXVlIHJlc291cmNlIG5hbWUgc2hvcnRlbnMgZnJvbSB0aGUgbWlkZGxlIGFuZCBhZGRzIGEgaGFzaCB3aGVuIG1heExlbmd0aCBpcyBkZWZpbmVkLCByZXNvdXJjZSBpcyB0b3AgbGV2ZWwsIGFuZCByZXNvdXJjZSBuYW1lIGlzIGxvbmdlciB0aGFuIG1heCcsICgpID0+IHtcbiAgICBjb25zdCBjb21wb25lbnRzUGF0aCA9IFsnVGhpc0lzU3RpbGxMb25nZXJUaGFuVGhlQWxsb3dlZExlbmd0aCddO1xuICAgIGNvbnN0IGV4cGVjdGVkTmFtZSA9IGBUaGlzSXNMZW5ndGgke3BhdGhIYXNoKGNvbXBvbmVudHNQYXRoKX1gO1xuXG4gICAgZXhwZWN0KG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUoY29tcG9uZW50c1BhdGgsIHsgbWF4TGVuZ3RoOiAyMCB9KSkudG9FcXVhbChleHBlY3RlZE5hbWUpO1xuICB9KTtcblxuICB0ZXN0KCd1bmlxdWUgcmVzb3VyY2UgbmFtZSBzaG9ydGVucyBmcm9tIHRoZSBtaWRkbGUgYW5kIGFkZHMgYSBoYXNoIHdoZW4gbWF4TGVuZ3RoIGlzIGRlZmluZWQsIHJlc291cmNlIGlzIHRvcCBsZXZlbCwgcmVzb3VyY2UgbmFtZSBpcyBsb25nZXIgdGhhbiBtYXgsIGFuZCBzZXBhcmF0b3IgaXMgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgY29tcG9uZW50c1BhdGggPSBbJ1RoaXNJc1N0aWxsTG9uZ2VyVGhhblRoZUFsbG93ZWRMZW5ndGgnXTtcbiAgICBjb25zdCBleHBlY3RlZE5hbWUgPSBgVGhpc0lzZW5ndGgtJHtwYXRoSGFzaChjb21wb25lbnRzUGF0aCl9YDtcblxuICAgIGV4cGVjdChtYWtlVW5pcXVlUmVzb3VyY2VOYW1lKGNvbXBvbmVudHNQYXRoLCB7IG1heExlbmd0aDogMjAsIHNlcGFyYXRvcjogJy0nIH0pKS50b0VxdWFsKGV4cGVjdGVkTmFtZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VuaXF1ZSByZXNvdXJjZSBuYW1lIHJlbW92ZXMgc3BlY2lhbCBjaGFyYWN0ZXJzIGFuZCBtYWtlcyBubyBvdGhlciBjaGFuZ2VzIHdoZW4gcmVzb3VjZSBpcyB0b3AgbGV2ZWwgYW5kIHRvbyBsb25nIHdpdGggc3BlY2lhbCBjaGFyYWN0ZXJzIGJ1dCBwcm9wZXIgbGVuZ3RoIHdpdGhvdXQnLCAoKSA9PiB7XG4gICAgY29uc3QgdG9vTG9uZ05hbWUgPSBbJ2EtbmFtZS10aGF0LWlzLXNsaWdodGx5LWxvbmdlci10aGFuLTI1Ni1jaGFyYWN0ZXJzLXRoYXQtaXMtYWxzby1hLXRvcC1sZXZlbC1yZXNvdXJjZS1zby10aGVyZS1pcy1vbmx5LW9uZS12YWx1ZS1pbi10aGlzLWFycmF5LWFuZC1hcHBhcmVudGx5LWJyZXZpdHktaXMtbm90LXRoZS1zdHJvbmctcG9pbnQtb2YtdGhlLXBlcnNvbi13aG8tbmFtZWQtdGhpcy1yZXNvdXJjZS13aGljaC1JLWJldC10aGV5LXdpbGwtY29tZS10by1yZWdyZXQtbGF0ZXItYnV0LWl0LWlzLXdoYXQtaXQtaXMnXTtcbiAgICBjb25zdCBleHBlY3RlZE5hbWUgPSAnYW5hbWV0aGF0aXNzbGlnaHRseWxvbmdlcnRoYW4yNTZjaGFyYWN0ZXJzdGhhdGlzYWxzb2F0b3BsZXZlbHJlc291cmNlc290aGVyZWlzb25seW9uZXZhbHVlaW50aGlzYXJyYXlhbmRhcHBhcmVudGx5YnJldml0eWlzbm90dGhlc3Ryb25ncG9pbnRvZnRoZXBlcnNvbndob25hbWVkdGhpc3Jlc291cmNld2hpY2hJYmV0dGhleXdpbGxjb21ldG9yZWdyZXRsYXRlcmJ1dGl0aXN3aGF0aXRpcyc7XG5cbiAgICBleHBlY3QobWFrZVVuaXF1ZVJlc291cmNlTmFtZSh0b29Mb25nTmFtZSwge30pKS50b0VxdWFsKGV4cGVjdGVkTmFtZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VuaXF1ZSByZXNvdXJjZSBuYW1lIGxlYXZlcyBpbiBhbGxvd2VkIHNwZWNpYWwgY2hhcmFjdGVycyBhbmQgYWRkcyBubyBoYXNoIHdoZW4gcmVzb3VyY2UgaXMgdG9wIGxldmVsIGFuZCByZXNvdWNlIG5hbWUgaXMgc2hvcnQgZW5vdWduJywgKCkgPT4ge1xuICAgIGNvbnN0IGNvbXBvbmVudHNQYXRoID0gWyfCr1xcXFxcXF8o44OEKV8vwq8tc2hydWdnaWUtZ2V0cy10by1zdGF5LcKvXFxcXFxcXyjjg4QpXy/CryddO1xuICAgIGNvbnN0IGV4cGVjdGVkTmFtZSA9ICfCr1xcXyjjg4QpXy/Cr3NocnVnZ2llZ2V0c3Rvc3RhecKvXFxfKOODhClfL8KvJztcblxuICAgIGV4cGVjdChtYWtlVW5pcXVlUmVzb3VyY2VOYW1lKGNvbXBvbmVudHNQYXRoLCB7IGFsbG93ZWRTcGVjaWFsQ2hhcmFjdGVyczogJ8KvXFxcXFxcXyjjg4QpLycsIG1heExlbmd0aDogMjAwIH0pKS50b0VxdWFsKGV4cGVjdGVkTmFtZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VuaXF1ZSByZXNvdXJjZSBuYW1lIGxlYXZlcyBpbiBhbGxvd2VkIHNwZWNpYWwgY2hhcmFjdGVycyBhbmQgYWRkcyBubyBoYXNoIG9yIHNlcGFyYXRvcnMgd2hlbiByZXNvdXJjZSBpcyB0b3AgbGV2ZWwgYW5kIHJlc291Y2UgbmFtZSBpcyBzaG9ydCBlbm91Z24nLCAoKSA9PiB7XG4gICAgY29uc3QgY29tcG9uZW50c1BhdGggPSBbJ8KvXFxcXFxcXyjjg4QpXy/Cry1zaHJ1Z2dpZS1nZXRzLXRvLXN0YXktwq9cXFxcXFxfKOODhClfL8KvJ107XG4gICAgY29uc3QgZXhwZWN0ZWROYW1lID0gJ8KvXFxfKOODhClfL8Kvc2hydWdnaWVnZXRzdG9zdGF5wq9cXF8o44OEKV8vwq8nO1xuXG4gICAgZXhwZWN0KG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUoY29tcG9uZW50c1BhdGgsIHsgYWxsb3dlZFNwZWNpYWxDaGFyYWN0ZXJzOiAnwq9cXFxcXFxfKOODhCkvJywgbWF4TGVuZ3RoOiAyMDAsIHNlcGFyYXRvcjogJy0nIH0pKS50b0VxdWFsKGV4cGVjdGVkTmFtZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VuaXF1ZSByZXNvdXJjZSBuYW1lIGlzIHNob3J0ZW5lZCB3aXRoIGEgaGFzaCBhbmQgc2VwYXJhdG9yIGFkZGVkIHdoZW4gcmVzb3VyY2UgaXMgdG9wIGxldmVsLCByZXNvdXJjZSBuYW1lIGlzIHRvbyBsb25nLCBhbmQgc2VwYXJhdG9yIGlzIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGNvbnN0IHRvb0xvbmdOYW1lID0gWydhbmFtZXRoYXRpc3NsaWdodGx5bG9uZ2VydGhhbjI1NmNoYXJhY3RlcnN0aGF0aXNhbHNvYXRvcGxldmVscmVzb3VyY2Vzb3RoZXJlaXNvbmx5b25ldmFsdWVpbnRoaXNhcnJheWFuZGFwcGFyZW50bHlicmV2aXR5aXNub3R0aGVzdHJvbmdwb2ludG9mdGhlcGVyc29ud2hvbmFtZWR0aGlzcmVzb3VyY2V3aGljaEliZXR0aGV5d2lsbGNvbWV0b3JlZ3JldGxhdGVyYnV0aXRpc3doYXRpdGlzYW55d2hvZGxldGhpc2Z1bmN0aW9uc2hvdWxkc2hvcnRlbnRoaXMnXTtcbiAgICBjb25zdCB1bmlxdWVSZXNvdXJjZU5hbWUgPSBtYWtlVW5pcXVlUmVzb3VyY2VOYW1lKHRvb0xvbmdOYW1lLCB7IHNlcGFyYXRvcjogJ34nIH0pO1xuXG4gICAgY29uc3QgZXhwZWN0ZWROYW1lID0gYGFuYW1ldGhhdGlzc2xpZ2h0bHlsb25nZXJ0aGFuMjU2Y2hhcmFjdGVyc3RoYXRpc2Fsc29hdG9wbGV2ZWxyZXNvdXJjZXNvdGhlcmVpc29ubHlvbmV2YWx1ZWludGhpc2FycmF5YW5kYXBwYXJlbnRseWJyZXZpdHlpc25wb2ludG9mdGhlcGVyc29ud2hvbmFtZWR0aGlzcmVzb3VyY2V3aGljaEliZXR0aGV5d2lsbGNvbWV0b3JlZ3JldGxhdGVyYnV0aXRpc3doYXRpdGlzYW55d2hvZGxldGhpc2Z1bmN0aW9uc2hvdWxkc2hvcnRlbnRoaXN+JHtwYXRoSGFzaCh0b29Mb25nTmFtZSl9YDtcbiAgICBleHBlY3QodW5pcXVlUmVzb3VyY2VOYW1lKS50b0VxdWFsKGV4cGVjdGVkTmFtZSk7XG4gICAgZXhwZWN0KHVuaXF1ZVJlc291cmNlTmFtZS5sZW5ndGgpLnRvRXF1YWwoMjU2KTtcbiAgfSk7XG5cbiAgdGVzdCgndW5pcXVlIHJlc291cmNlIG5hbWUgcmVtb3ZlcyBzcGVjaWFsIGNoYXJhY3RlcnMgd2hlbiB0aGV5IGFyZSBpbmNsdWRlZCBpbiB0aGUgY29tcG9uZW50cyBuYW1lcycsICgpID0+IHtcbiAgICBjb25zdCBjb21wb25lbnRzUGF0aCA9IFsnSScsICdsb3ZlJywgJ3NwZWNpYWwnLCAnY2hhcmFjdGVycycsICfCr1xcXFxcXF8o44OEKV8vwq8nLCAnZm9yJywgJ3JlYWwnLCAndGhvdWdoJ107XG4gICAgY29uc3QgZXhwZWN0ZWROYW1lID0gYElsb3Zlc3BlY2lhbGNoYXJhY3RlcnNmb3JyZWFsdGhvdWdoJHtwYXRoSGFzaChjb21wb25lbnRzUGF0aCl9YDtcblxuICAgIGV4cGVjdChtYWtlVW5pcXVlUmVzb3VyY2VOYW1lKGNvbXBvbmVudHNQYXRoLCB7fSkpLnRvRXF1YWwoZXhwZWN0ZWROYW1lKTtcbiAgfSk7XG5cbiAgdGVzdCgndW5pcXVlIHJlc291cmNlIG5hbWUgcmVtb3ZlcyBzcGVjaWFsIGNoYXJhY3RlcnMgdGhhdCBhcmUgbm90IGFsbG93IGxpc3RlZCBhbmQgbGVhdmVzIHRoZSBhbGxvd2VkIG9uZXMnLCAoKSA9PiB7XG4gICAgY29uc3QgY29tcG9uZW50c1BhdGggPSBbJ0ktbG92ZS1zcGVjaWFsLWNoYXJhY3RlcnMtJywgJ8KvXFxcXFxcXyjjg4QpXy/CrycsICctZm9yLXJlYWwtdGhvdWdoLSddO1xuICAgIGNvbnN0IGV4cGVjdGVkTmFtZSA9IGBJLWxvdmUtc3BlY2lhbC1jaGFyYWN0ZXJzLS1mb3ItcmVhbC10aG91Z2gtJHtwYXRoSGFzaChjb21wb25lbnRzUGF0aCl9YDtcblxuICAgIGV4cGVjdChtYWtlVW5pcXVlUmVzb3VyY2VOYW1lKGNvbXBvbmVudHNQYXRoLCB7IGFsbG93ZWRTcGVjaWFsQ2hhcmFjdGVyczogJy0nIH0pKS50b0VxdWFsKGV4cGVjdGVkTmFtZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VuaXF1ZSByZXNvdXJjZSBuYW1lIGFkZHMgaW4gc2VwYXJhdG9yIGFuZCBhZGRzIGhhc2ggd2hlbiBzZXBhcmF0b3IgaXMgcHJvdmlkZWQgYW5kIG5hbWUgaXMgbm90IHRvbyBsb25nJywgKCkgPT4ge1xuICAgIGNvbnN0IGNvbXBvbmVudHNQYXRoID0gWydUaGlzJywgJ3VuaXF1ZScsICdyZXNvdXJjZScsICduYW1lJywgJ25lZWRzJywgJ2EnLCAnc2VwYXJhdG9yJ107XG4gICAgY29uc3QgZXhwZWN0ZWROYW1lID0gYFRoaXMuKi51bmlxdWUuKi5yZXNvdXJjZS4qLm5hbWUuKi5uZWVkcy4qLmEuKi5zZXBhcmF0b3IuKi4ke3BhdGhIYXNoKGNvbXBvbmVudHNQYXRoKX1gO1xuXG4gICAgZXhwZWN0KG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUoY29tcG9uZW50c1BhdGgsIHsgc2VwYXJhdG9yOiAnLiouJyB9KSkudG9FcXVhbChleHBlY3RlZE5hbWUpO1xuICB9KTtcblxuICB0ZXN0KCd1bmlxdWUgcmVzb3VyY2UgbmFtZSBhZGRzIGluIHNlcGFyYXRvciwgYWRkcyBoYXNoLCBhbmQgc2hvcnRlbnMgbmFtZSB3aGVuIHNlcGFyYXRvciBpcyBwcm92aWRlZCBhbmQgbmFtZSB0b28gbG9uZycsICgpID0+IHtcbiAgICBjb25zdCBjb21wb25lbnRzUGF0aCA9IFsnVGhpcycsICd1bmlxdWUnLCAncmVzb3VyY2UnLCAnbmFtZScsICdpcycsICdsb25nZXInLCAndGhhbicsICdhbGxvd2VkJ107XG4gICAgY29uc3QgZXhwZWN0ZWROYW1lID0gYFRoaXMvdW5pcXVlL3Jlc291cmNlbG9uZ2VyL3RoYW4vYWxsb3dlZC8ke3BhdGhIYXNoKGNvbXBvbmVudHNQYXRoKX1gO1xuXG4gICAgZXhwZWN0KG1ha2VVbmlxdWVSZXNvdXJjZU5hbWUoY29tcG9uZW50c1BhdGgsIHsgbWF4TGVuZ3RoOiA0OCwgc2VwYXJhdG9yOiAnLycgfSkpLnRvRXF1YWwoZXhwZWN0ZWROYW1lKTtcbiAgfSk7XG59KTsiXX0=