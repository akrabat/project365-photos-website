"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cxschema = require("../../cloud-assembly-schema");
const cxapi = require("../../cx-api");
const lib_1 = require("../lib");
describe('stage', () => {
    test('Stack inherits unspecified part of the env from Stage', () => {
        // GIVEN
        const app = new lib_1.App();
        const stage = new lib_1.Stage(app, 'Stage', {
            env: { account: 'account', region: 'region' },
        });
        // WHEN
        const stack1 = new lib_1.Stack(stage, 'Stack1', { env: { region: 'elsewhere' } });
        const stack2 = new lib_1.Stack(stage, 'Stack2', { env: { account: 'tnuocca' } });
        // THEN
        expect(acctRegion(stack1)).toEqual(['account', 'elsewhere']);
        expect(acctRegion(stack2)).toEqual(['tnuocca', 'region']);
    });
    test('envs are inherited deeply', () => {
        // GIVEN
        const app = new lib_1.App();
        const outer = new lib_1.Stage(app, 'Stage', {
            env: { account: 'account', region: 'region' },
        });
        // WHEN
        const innerAcct = new lib_1.Stage(outer, 'Acct', { env: { account: 'tnuocca' } });
        const innerRegion = new lib_1.Stage(outer, 'Rgn', { env: { region: 'elsewhere' } });
        const innerNeither = new lib_1.Stage(outer, 'Neither');
        // THEN
        expect(acctRegion(new lib_1.Stack(innerAcct, 'Stack'))).toEqual(['tnuocca', 'region']);
        expect(acctRegion(new lib_1.Stack(innerRegion, 'Stack'))).toEqual(['account', 'elsewhere']);
        expect(acctRegion(new lib_1.Stack(innerNeither, 'Stack'))).toEqual(['account', 'region']);
    });
    test('The Stage Assembly is in the app Assembly\'s manifest', () => {
        // WHEN
        const app = new lib_1.App();
        const stage = new lib_1.Stage(app, 'Stage');
        new BogusStack(stage, 'Stack2');
        // THEN -- app manifest contains a nested cloud assembly
        const appAsm = app.synth();
        const artifact = appAsm.artifacts.find(x => x instanceof cxapi.NestedCloudAssemblyArtifact);
        expect(artifact).toBeDefined();
    });
    test('Stacks in Stage are in a different cxasm than Stacks in App', () => {
        // WHEN
        const app = new lib_1.App();
        const stack1 = new BogusStack(app, 'Stack1');
        const stage = new lib_1.Stage(app, 'Stage');
        const stack2 = new BogusStack(stage, 'Stack2');
        // THEN
        const stageAsm = stage.synth();
        expect(stageAsm.stacks.map(s => s.stackName)).toEqual([stack2.stackName]);
        const appAsm = app.synth();
        expect(appAsm.stacks.map(s => s.stackName)).toEqual([stack1.stackName]);
    });
    test('Can nest Stages inside other Stages', () => {
        // WHEN
        const app = new lib_1.App();
        const outer = new lib_1.Stage(app, 'Outer');
        const inner = new lib_1.Stage(outer, 'Inner');
        const stack = new BogusStack(inner, 'Stack');
        // WHEN
        const appAsm = app.synth();
        const outerAsm = appAsm.getNestedAssembly(outer.artifactId);
        const innerAsm = outerAsm.getNestedAssembly(inner.artifactId);
        expect(innerAsm.tryGetArtifact(stack.artifactId)).toBeDefined();
    });
    test('Default stack name in Stage objects incorporates the Stage name and no hash', () => {
        // WHEN
        const app = new lib_1.App();
        const stage = new lib_1.Stage(app, 'MyStage');
        const stack = new BogusStack(stage, 'MyStack');
        // THEN
        expect(stage.stageName).toEqual('MyStage');
        expect(stack.stackName).toEqual('MyStage-MyStack');
    });
    test('can override the stage name', () => {
        // WHEN
        const app = new lib_1.App();
        const stage = new lib_1.Stage(app, 'NotMyStageName', { stageName: 'MyStage' });
        const stack = new BogusStack(stage, 'MyStack');
        // THEN
        expect(stage.stageName).toEqual('MyStage');
        expect(stack.stackName).toEqual('MyStage-MyStack');
    });
    test('Can not have dependencies to stacks outside the nested asm', () => {
        // GIVEN
        const app = new lib_1.App();
        const stack1 = new BogusStack(app, 'Stack1');
        const stage = new lib_1.Stage(app, 'MyStage');
        const stack2 = new BogusStack(stage, 'Stack2');
        // WHEN
        expect(() => {
            stack2.addDependency(stack1);
        }).toThrow(/dependency cannot cross stage boundaries/);
    });
    test('When we synth() a stage, aspects inside it must have been applied', () => {
        // GIVEN
        const app = new lib_1.App();
        const stage = new lib_1.Stage(app, 'MyStage');
        const stack = new BogusStack(stage, 'Stack');
        // WHEN
        const aspect = new TouchingAspect();
        lib_1.Aspects.of(stack).add(aspect);
        // THEN
        app.synth();
        expect(aspect.visits.map(c => c.node.path)).toEqual([
            'MyStage/Stack',
            'MyStage/Stack/Resource',
        ]);
    });
    test('Aspects do not apply inside a Stage', () => {
        // GIVEN
        const app = new lib_1.App();
        const stage = new lib_1.Stage(app, 'MyStage');
        new BogusStack(stage, 'Stack');
        // WHEN
        const aspect = new TouchingAspect();
        lib_1.Aspects.of(app).add(aspect);
        // THEN
        app.synth();
        expect(aspect.visits.map(c => c.node.path)).toEqual([
            '',
            'Tree',
        ]);
    });
    test('Automatic dependencies inside a stage are available immediately after synth', () => {
        // GIVEN
        const app = new lib_1.App({ context: { [cxapi.NEW_STYLE_STACK_SYNTHESIS_CONTEXT]: false } });
        const stage = new lib_1.Stage(app, 'MyStage');
        const stack1 = new lib_1.Stack(stage, 'Stack1');
        const stack2 = new lib_1.Stack(stage, 'Stack2');
        // WHEN
        const resource1 = new lib_1.CfnResource(stack1, 'Resource', {
            type: 'CDK::Test::Resource',
        });
        new lib_1.CfnResource(stack2, 'Resource', {
            type: 'CDK::Test::Resource',
            properties: {
                OtherThing: resource1.ref,
            },
        });
        const asm = stage.synth();
        // THEN
        expect(asm.getStackArtifact(stack2.artifactId).dependencies.map(d => d.id)).toEqual([stack1.artifactId]);
    });
    test('Assemblies can be deeply nested', () => {
        // GIVEN
        const app = new lib_1.App({ treeMetadata: false });
        const level1 = new lib_1.Stage(app, 'StageLevel1');
        const level2 = new lib_1.Stage(level1, 'StageLevel2');
        new lib_1.Stage(level2, 'StageLevel3');
        // WHEN
        const rootAssembly = app.synth();
        // THEN
        expect(rootAssembly.manifest.artifacts).toEqual({
            'assembly-StageLevel1': {
                type: 'cdk:cloud-assembly',
                properties: {
                    directoryName: 'assembly-StageLevel1',
                    displayName: 'StageLevel1',
                },
            },
        });
        const assemblyLevel1 = rootAssembly.getNestedAssembly('assembly-StageLevel1');
        expect(assemblyLevel1.manifest.artifacts).toEqual({
            'assembly-StageLevel1-StageLevel2': {
                type: 'cdk:cloud-assembly',
                properties: {
                    directoryName: 'assembly-StageLevel1-StageLevel2',
                    displayName: 'StageLevel1/StageLevel2',
                },
            },
        });
        const assemblyLevel2 = assemblyLevel1.getNestedAssembly('assembly-StageLevel1-StageLevel2');
        expect(assemblyLevel2.manifest.artifacts).toEqual({
            'assembly-StageLevel1-StageLevel2-StageLevel3': {
                type: 'cdk:cloud-assembly',
                properties: {
                    directoryName: 'assembly-StageLevel1-StageLevel2-StageLevel3',
                    displayName: 'StageLevel1/StageLevel2/StageLevel3',
                },
            },
        });
    });
    test('stage name validation', () => {
        const app = new lib_1.App();
        new lib_1.Stage(app, 'abcd');
        new lib_1.Stage(app, 'abcd123');
        new lib_1.Stage(app, 'abcd123-588dfjjk');
        new lib_1.Stage(app, 'abcd123-588dfjjk.sss');
        new lib_1.Stage(app, 'abcd123-588dfjjk.sss_ajsid');
        expect(() => new lib_1.Stage(app, 'abcd123-588dfjjk.sss_ajsid ')).toThrow(/invalid stage name "abcd123-588dfjjk.sss_ajsid "/);
        expect(() => new lib_1.Stage(app, 'abcd123-588dfjjk.sss_ajsid/dfo')).toThrow(/invalid stage name "abcd123-588dfjjk.sss_ajsid\/dfo"/);
        expect(() => new lib_1.Stage(app, '&')).toThrow(/invalid stage name "&"/);
        expect(() => new lib_1.Stage(app, '45hello')).toThrow(/invalid stage name "45hello"/);
        expect(() => new lib_1.Stage(app, 'f')).toThrow(/invalid stage name "f"/);
    });
    test('outdir cannot be specified for nested stages', () => {
        // WHEN
        const app = new lib_1.App();
        // THEN
        expect(() => new lib_1.Stage(app, 'mystage', { outdir: '/tmp/foo/bar' })).toThrow(/"outdir" cannot be specified for nested stages/);
    });
    test('Stage.isStage indicates that a construct is a stage', () => {
        // WHEN
        const app = new lib_1.App();
        const stack = new lib_1.Stack();
        const stage = new lib_1.Stage(app, 'Stage');
        // THEN
        expect(lib_1.Stage.isStage(stage)).toEqual(true);
        expect(lib_1.Stage.isStage(app)).toEqual(true);
        expect(lib_1.Stage.isStage(stack)).toEqual(false);
    });
    test('Stage.isStage indicates that a construct is a stage based on symbol', () => {
        // WHEN
        const app = new lib_1.App();
        const stage = new lib_1.Stage(app, 'Stage');
        const externalStage = {};
        const STAGE_SYMBOL = Symbol.for('@aws-cdk/core.Stage');
        Object.defineProperty(externalStage, STAGE_SYMBOL, { value: true });
        // THEN
        expect(lib_1.Stage.isStage(stage)).toEqual(true);
        expect(lib_1.Stage.isStage(app)).toEqual(true);
        expect(lib_1.Stage.isStage(externalStage)).toEqual(true);
    });
});
test('missing context in Stages is propagated up to root assembly', () => {
    // GIVEN
    const app = new lib_1.App();
    const stage = new lib_1.Stage(app, 'Stage', {
        env: { account: 'account', region: 'region' },
    });
    const stack = new lib_1.Stack(stage, 'Stack');
    new lib_1.CfnResource(stack, 'Resource', { type: 'Something' });
    // WHEN
    stack.reportMissingContextKey({
        key: 'missing-context-key',
        provider: cxschema.ContextProvider.AVAILABILITY_ZONE_PROVIDER,
        props: {
            account: 'account',
            region: 'region',
        },
    });
    // THEN
    const assembly = app.synth();
    expect(assembly.manifest.missing).toEqual([
        {
            key: 'missing-context-key',
            provider: cxschema.ContextProvider.AVAILABILITY_ZONE_PROVIDER,
            props: {
                account: 'account',
                lookupRoleArn: 'arn:${AWS::Partition}:iam::account:role/cdk-hnb659fds-lookup-role-account-region',
                region: 'region',
            },
        },
    ]);
});
class TouchingAspect {
    constructor() {
        this.visits = new Array();
    }
    visit(node) {
        this.visits.push(node);
    }
}
class BogusStack extends lib_1.Stack {
    constructor(scope, id) {
        super(scope, id);
        new lib_1.CfnResource(this, 'Resource', {
            type: 'CDK::Test::Resource',
        });
    }
}
function acctRegion(s) {
    return [s.account, s.region];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhZ2UudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInN0YWdlLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx3REFBd0Q7QUFDeEQsc0NBQXNDO0FBRXRDLGdDQUEwRTtBQUUxRSxRQUFRLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtJQUNyQixJQUFJLENBQUMsdURBQXVELEVBQUUsR0FBRyxFQUFFO1FBQ2pFLFFBQVE7UUFDUixNQUFNLEdBQUcsR0FBRyxJQUFJLFNBQUcsRUFBRSxDQUFDO1FBQ3RCLE1BQU0sS0FBSyxHQUFHLElBQUksV0FBSyxDQUFDLEdBQUcsRUFBRSxPQUFPLEVBQUU7WUFDcEMsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFO1NBQzlDLENBQUMsQ0FBQztRQUVILE9BQU87UUFDUCxNQUFNLE1BQU0sR0FBRyxJQUFJLFdBQUssQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUM1RSxNQUFNLE1BQU0sR0FBRyxJQUFJLFdBQUssQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUUzRSxPQUFPO1FBQ1AsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQzdELE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUM1RCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7UUFDckMsUUFBUTtRQUNSLE1B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USxXQUFLO0lBQzVCLFlBQVksS0FBZ0IsRUFBRSxFQUFVO1FBQ3RDLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFakIsSUFBSSxpQkFBVyxDQUFDLElBQUksRUFBRSxVQUFVLEVBQUU7WUFDaEMsSUFBSSxFQUFFLHFCQUFxQjtTQUM1QixDQUFDLENBQUM7S0FDSjtDQUNGO0FBRUQsU0FBUyxVQUFVLENBQUMsQ0FBUTtJQUMxQixPQUFPLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDL0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGN4c2NoZW1hIGZyb20gJy4uLy4uL2Nsb3VkLWFzc2VtYmx5LXNjaGVtYSc7XG5pbXBvcnQgKiBhcyBjeGFwaSBmcm9tICcuLi8uLi9jeC1hcGknO1xuaW1wb3J0IHsgQ29uc3RydWN0LCBJQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgeyBBcHAsIENmblJlc291cmNlLCBJQXNwZWN0LCBTdGFjaywgU3RhZ2UsIEFzcGVjdHMgfSBmcm9tICcuLi9saWInO1xuXG5kZXNjcmliZSgnc3RhZ2UnLCAoKSA9PiB7XG4gIHRlc3QoJ1N0YWNrIGluaGVyaXRzIHVuc3BlY2lmaWVkIHBhcnQgb2YgdGhlIGVudiBmcm9tIFN0YWdlJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIGNvbnN0IHN0YWdlID0gbmV3IFN0YWdlKGFwcCwgJ1N0YWdlJywge1xuICAgICAgZW52OiB7IGFjY291bnQ6ICdhY2NvdW50JywgcmVnaW9uOiAncmVnaW9uJyB9LFxuICAgIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHN0YWNrMSA9IG5ldyBTdGFjayhzdGFnZSwgJ1N0YWNrMScsIHsgZW52OiB7IHJlZ2lvbjogJ2Vsc2V3aGVyZScgfSB9KTtcbiAgICBjb25zdCBzdGFjazIgPSBuZXcgU3RhY2soc3RhZ2UsICdTdGFjazInLCB7IGVudjogeyBhY2NvdW50OiAndG51b2NjYScgfSB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoYWNjdFJlZ2lvbihzdGFjazEpKS50b0VxdWFsKFsnYWNjb3VudCcsICdlbHNld2hlcmUnXSk7XG4gICAgZXhwZWN0KGFjY3RSZWdpb24oc3RhY2syKSkudG9FcXVhbChbJ3RudW9jY2EnLCAncmVnaW9uJ10pO1xuICB9KTtcblxuICB0ZXN0KCdlbnZzIGFyZSBpbmhlcml0ZWQgZGVlcGx5JywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIGNvbnN0IG91dGVyID0gbmV3IFN0YWdlKGFwcCwgJ1N0YWdlJywge1xuICAgICAgZW52OiB7IGFjY291bnQ6ICdhY2NvdW50JywgcmVnaW9uOiAncmVnaW9uJyB9LFxuICAgIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IGlubmVyQWNjdCA9IG5ldyBTdGFnZShvdXRlciwgJ0FjY3QnLCB7IGVudjogeyBhY2NvdW50OiAndG51b2NjYScgfSB9KTtcbiAgICBjb25zdCBpbm5lclJlZ2lvbiA9IG5ldyBTdGFnZShvdXRlciwgJ1JnbicsIHsgZW52OiB7IHJlZ2lvbjogJ2Vsc2V3aGVyZScgfSB9KTtcbiAgICBjb25zdCBpbm5lck5laXRoZXIgPSBuZXcgU3RhZ2Uob3V0ZXIsICdOZWl0aGVyJyk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KGFjY3RSZWdpb24obmV3IFN0YWNrKGlubmVyQWNjdCwgJ1N0YWNrJykpKS50b0VxdWFsKFsndG51b2NjYScsICdyZWdpb24nXSk7XG4gICAgZXhwZWN0KGFjY3RSZWdpb24obmV3IFN0YWNrKGlubmVyUmVnaW9uLCAnU3RhY2snKSkpLnRvRXF1YWwoWydhY2NvdW50JywgJ2Vsc2V3aGVyZSddKTtcbiAgICBleHBlY3QoYWNjdFJlZ2lvbihuZXcgU3RhY2soaW5uZXJOZWl0aGVyLCAnU3RhY2snKSkpLnRvRXF1YWwoWydhY2NvdW50JywgJ3JlZ2lvbiddKTtcbiAgfSk7XG5cbiAgdGVzdCgnVGhlIFN0YWdlIEFzc2VtYmx5IGlzIGluIHRoZSBhcHAgQXNzZW1ibHlcXCdzIG1hbmlmZXN0JywgKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhZ2UgPSBuZXcgU3RhZ2UoYXBwLCAnU3RhZ2UnKTtcbiAgICBuZXcgQm9ndXNTdGFjayhzdGFnZSwgJ1N0YWNrMicpO1xuXG4gICAgLy8gVEhFTiAtLSBhcHAgbWFuaWZlc3QgY29udGFpbnMgYSBuZXN0ZWQgY2xvdWQgYXNzZW1ibHlcbiAgICBjb25zdCBhcHBBc20gPSBhcHAuc3ludGgoKTtcblxuICAgIGNvbnN0IGFydGlmYWN0ID0gYXBwQXNtLmFydGlmYWN0cy5maW5kKHggPT4geCBpbnN0YW5jZW9mIGN4YXBpLk5lc3RlZENsb3VkQXNzZW1ibHlBcnRpZmFjdCk7XG4gICAgZXhwZWN0KGFydGlmYWN0KS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICB0ZXN0KCdTdGFja3MgaW4gU3RhZ2UgYXJlIGluIGEgZGlmZmVyZW50IGN4YXNtIHRoYW4gU3RhY2tzIGluIEFwcCcsICgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIGNvbnN0IHN0YWNrMSA9IG5ldyBCb2d1c1N0YWNrKGFwcCwgJ1N0YWNrMScpO1xuICAgIGNvbnN0IHN0YWdlID0gbmV3IFN0YWdlKGFwcCwgJ1N0YWdlJyk7XG4gICAgY29uc3Qgc3RhY2syID0gbmV3IEJvZ3VzU3RhY2soc3RhZ2UsICdTdGFjazInKTtcblxuICAgIC8vIFRIRU5cbiAgICBjb25zdCBzdGFnZUFzbSA9IHN0YWdlLnN5bnRoKCk7XG4gICAgZXhwZWN0KHN0YWdlQXNtLnN0YWNrcy5tYXAocyA9PiBzLnN0YWNrTmFtZSkpLnRvRXF1YWwoW3N0YWNrMi5zdGFja05hbWVdKTtcblxuICAgIGNvbnN0IGFwcEFzbSA9IGFwcC5zeW50aCgpO1xuICAgIGV4cGVjdChhcHBBc20uc3RhY2tzLm1hcChzID0+IHMuc3RhY2tOYW1lKSkudG9FcXVhbChbc3RhY2sxLnN0YWNrTmFtZV0pO1xuICB9KTtcblxuICB0ZXN0KCdDYW4gbmVzdCBTdGFnZXMgaW5zaWRlIG90aGVyIFN0YWdlcycsICgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIGNvbnN0IG91dGVyID0gbmV3IFN0YWdlKGFwcCwgJ091dGVyJyk7XG4gICAgY29uc3QgaW5uZXIgPSBuZXcgU3RhZ2Uob3V0ZXIsICdJbm5lcicpO1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IEJvZ3VzU3RhY2soaW5uZXIsICdTdGFjaycpO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IGFwcEFzbSA9IGFwcC5zeW50aCgpO1xuICAgIGNvbnN0IG91dGVyQXNtID0gYXBwQXNtLmdldE5lc3RlZEFzc2VtYmx5KG91dGVyLmFydGlmYWN0SWQpO1xuICAgIGNvbnN0IGlubmVyQXNtID0gb3V0ZXJBc20uZ2V0TmVzdGVkQXNzZW1ibHkoaW5uZXIuYXJ0aWZhY3RJZCk7XG5cbiAgICBleHBlY3QoaW5uZXJBc20udHJ5R2V0QXJ0aWZhY3Qoc3RhY2suYXJ0aWZhY3RJZCkpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ0RlZmF1bHQgc3RhY2sgbmFtZSBpbiBTdGFnZSBvYmplY3RzIGluY29ycG9yYXRlcyB0aGUgU3RhZ2UgbmFtZSBhbmQgbm8gaGFzaCcsICgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIGNvbnN0IHN0YWdlID0gbmV3IFN0YWdlKGFwcCwgJ015U3RhZ2UnKTtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBCb2d1c1N0YWNrKHN0YWdlLCAnTXlTdGFjaycpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChzdGFnZS5zdGFnZU5hbWUpLnRvRXF1YWwoJ015U3RhZ2UnKTtcbiAgICBleHBlY3Qoc3RhY2suc3RhY2tOYW1lKS50b0VxdWFsKCdNeVN0YWdlLU15U3RhY2snKTtcbiAgfSk7XG5cbiAgdGVzdCgnY2FuIG92ZXJyaWRlIHRoZSBzdGFnZSBuYW1lJywgKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhZ2UgPSBuZXcgU3RhZ2UoYXBwLCAnTm90TXlTdGFnZU5hbWUnLCB7IHN0YWdlTmFtZTogJ015U3RhZ2UnIH0pO1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IEJvZ3VzU3RhY2soc3RhZ2UsICdNeVN0YWNrJyk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHN0YWdlLnN0YWdlTmFtZSkudG9FcXVhbCgnTXlTdGFnZScpO1xuICAgIGV4cGVjdChzdGFjay5zdGFja05hbWUpLnRvRXF1YWwoJ015U3RhZ2UtTXlTdGFjaycpO1xuICB9KTtcblxuICB0ZXN0KCdDYW4gbm90IGhhdmUgZGVwZW5kZW5jaWVzIHRvIHN0YWNrcyBvdXRzaWRlIHRoZSBuZXN0ZWQgYXNtJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIGNvbnN0IHN0YWNrMSA9IG5ldyBCb2d1c1N0YWNrKGFwcCwgJ1N0YWNrMScpO1xuICAgIGNvbnN0IHN0YWdlID0gbmV3IFN0YWdlKGFwcCwgJ015U3RhZ2UnKTtcbiAgICBjb25zdCBzdGFjazIgPSBuZXcgQm9ndXNTdGFjayhzdGFnZSwgJ1N0YWNrMicpO1xuXG4gICAgLy8gV0hFTlxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBzdGFjazIuYWRkRGVwZW5kZW5jeShzdGFjazEpO1xuICAgIH0pLnRvVGhyb3coL2RlcGVuZGVuY3kgY2Fubm90IGNyb3NzIHN0YWdlIGJvdW5kYXJpZXMvKTtcbiAgfSk7XG5cbiAgdGVzdCgnV2hlbiB3ZSBzeW50aCgpIGEgc3RhZ2UsIGFzcGVjdHMgaW5zaWRlIGl0IG11c3QgaGF2ZSBiZWVuIGFwcGxpZWQnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhZ2UgPSBuZXcgU3RhZ2UoYXBwLCAnTXlTdGFnZScpO1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IEJvZ3VzU3RhY2soc3RhZ2UsICdTdGFjaycpO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IGFzcGVjdCA9IG5ldyBUb3VjaGluZ0FzcGVjdCgpO1xuICAgIEFzcGVjdHMub2Yoc3RhY2spLmFkZChhc3BlY3QpO1xuXG4gICAgLy8gVEhFTlxuICAgIGFwcC5zeW50aCgpO1xuICAgIGV4cGVjdChhc3BlY3QudmlzaXRzLm1hcChjID0+IGMubm9kZS5wYXRoKSkudG9FcXVhbChbXG4gICAgICAnTXlTdGFnZS9TdGFjaycsXG4gICAgICAnTXlTdGFnZS9TdGFjay9SZXNvdXJjZScsXG4gICAgXSk7XG4gIH0pO1xuXG4gIHRlc3QoJ0FzcGVjdHMgZG8gbm90IGFwcGx5IGluc2lkZSBhIFN0YWdlJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICAgIGNvbnN0IHN0YWdlID0gbmV3IFN0YWdlKGFwcCwgJ015U3RhZ2UnKTtcbiAgICBuZXcgQm9ndXNTdGFjayhzdGFnZSwgJ1N0YWNrJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3QgYXNwZWN0ID0gbmV3IFRvdWNoaW5nQXNwZWN0KCk7XG4gICAgQXNwZWN0cy5vZihhcHApLmFkZChhc3BlY3QpO1xuXG4gICAgLy8gVEhFTlxuICAgIGFwcC5zeW50aCgpO1xuICAgIGV4cGVjdChhc3BlY3QudmlzaXRzLm1hcChjID0+IGMubm9kZS5wYXRoKSkudG9FcXVhbChbXG4gICAgICAnJyxcbiAgICAgICdUcmVlJyxcbiAgICBdKTtcbiAgfSk7XG5cbiAgdGVzdCgnQXV0b21hdGljIGRlcGVuZGVuY2llcyBpbnNpZGUgYSBzdGFnZSBhcmUgYXZhaWxhYmxlIGltbWVkaWF0ZWx5IGFmdGVyIHN5bnRoJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IEFwcCh7IGNvbnRleHQ6IHsgW2N4YXBpLk5FV19TVFlMRV9TVEFDS19TWU5USEVTSVNfQ09OVEVYVF06IGZhbHNlIH0gfSk7XG4gICAgY29uc3Qgc3RhZ2UgPSBuZXcgU3RhZ2UoYXBwLCAnTXlTdGFnZScpO1xuICAgIGNvbnN0IHN0YWNrMSA9IG5ldyBTdGFjayhzdGFnZSwgJ1N0YWNrMScpO1xuICAgIGNvbnN0IHN0YWNrMiA9IG5ldyBTdGFjayhzdGFnZSwgJ1N0YWNrMicpO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHJlc291cmNlMSA9IG5ldyBDZm5SZXNvdXJjZShzdGFjazEsICdSZXNvdXJjZScsIHtcbiAgICAgIHR5cGU6ICdDREs6OlRlc3Q6OlJlc291cmNlJyxcbiAgICB9KTtcbiAgICBuZXcgQ2ZuUmVzb3VyY2Uoc3RhY2syLCAnUmVzb3VyY2UnLCB7XG4gICAgICB0eXBlOiAnQ0RLOjpUZXN0OjpSZXNvdXJjZScsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIE90aGVyVGhpbmc6IHJlc291cmNlMS5yZWYsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgYXNtID0gc3RhZ2Uuc3ludGgoKTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoXG4gICAgICBhc20uZ2V0U3RhY2tBcnRpZmFjdChzdGFjazIuYXJ0aWZhY3RJZCkuZGVwZW5kZW5jaWVzLm1hcChkID0+IGQuaWQpKS50b0VxdWFsKFxuICAgICAgW3N0YWNrMS5hcnRpZmFjdElkXSk7XG4gIH0pO1xuXG4gIHRlc3QoJ0Fzc2VtYmxpZXMgY2FuIGJlIGRlZXBseSBuZXN0ZWQnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKHsgdHJlZU1ldGFkYXRhOiBmYWxzZSB9KTtcblxuICAgIGNvbnN0IGxldmVsMSA9IG5ldyBTdGFnZShhcHAsICdTdGFnZUxldmVsMScpO1xuICAgIGNvbnN0IGxldmVsMiA9IG5ldyBTdGFnZShsZXZlbDEsICdTdGFnZUxldmVsMicpO1xuICAgIG5ldyBTdGFnZShsZXZlbDIsICdTdGFnZUxldmVsMycpO1xuXG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHJvb3RBc3NlbWJseSA9IGFwcC5zeW50aCgpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChyb290QXNzZW1ibHkubWFuaWZlc3QuYXJ0aWZhY3RzKS50b0VxdWFsKHtcbiAgICAgICdhc3NlbWJseS1TdGFnZUxldmVsMSc6IHtcbiAgICAgICAgdHlwZTogJ2NkazpjbG91ZC1hc3NlbWJseScsXG4gICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICBkaXJlY3RvcnlOYW1lOiAnYXNzZW1ibHktU3RhZ2VMZXZlbDEnLFxuICAgICAgICAgIGRpc3BsYXlOYW1lOiAnU3RhZ2VMZXZlbDEnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGFzc2VtYmx5TGV2ZWwxID0gcm9vdEFzc2VtYmx5LmdldE5lc3RlZEFzc2VtYmx5KCdhc3NlbWJseS1TdGFnZUxldmVsMScpO1xuICAgIGV4cGVjdChhc3NlbWJseUxldmVsMS5tYW5pZmVzdC5hcnRpZmFjdHMpLnRvRXF1YWwoe1xuICAgICAgJ2Fzc2VtYmx5LVN0YWdlTGV2ZWwxLVN0YWdlTGV2ZWwyJzoge1xuICAgICAgICB0eXBlOiAnY2RrOmNsb3VkLWFzc2VtYmx5JyxcbiAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgIGRpcmVjdG9yeU5hbWU6ICdhc3NlbWJseS1TdGFnZUxldmVsMS1TdGFnZUxldmVsMicsXG4gICAgICAgICAgZGlzcGxheU5hbWU6ICdTdGFnZUxldmVsMS9TdGFnZUxldmVsMicsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgYXNzZW1ibHlMZXZlbDIgPSBhc3NlbWJseUxldmVsMS5nZXROZXN0ZWRBc3NlbWJseSgnYXNzZW1ibHktU3RhZ2VMZXZlbDEtU3RhZ2VMZXZlbDInKTtcbiAgICBleHBlY3QoYXNzZW1ibHlMZXZlbDIubWFuaWZlc3QuYXJ0aWZhY3RzKS50b0VxdWFsKHtcbiAgICAgICdhc3NlbWJseS1TdGFnZUxldmVsMS1TdGFnZUxldmVsMi1TdGFnZUxldmVsMyc6IHtcbiAgICAgICAgdHlwZTogJ2NkazpjbG91ZC1hc3NlbWJseScsXG4gICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICBkaXJlY3RvcnlOYW1lOiAnYXNzZW1ibHktU3RhZ2VMZXZlbDEtU3RhZ2VMZXZlbDItU3RhZ2VMZXZlbDMnLFxuICAgICAgICAgIGRpc3BsYXlOYW1lOiAnU3RhZ2VMZXZlbDEvU3RhZ2VMZXZlbDIvU3RhZ2VMZXZlbDMnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnc3RhZ2UgbmFtZSB2YWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcblxuICAgIG5ldyBTdGFnZShhcHAsICdhYmNkJyk7XG4gICAgbmV3IFN0YWdlKGFwcCwgJ2FiY2QxMjMnKTtcbiAgICBuZXcgU3RhZ2UoYXBwLCAnYWJjZDEyMy01ODhkZmpqaycpO1xuICAgIG5ldyBTdGFnZShhcHAsICdhYmNkMTIzLTU4OGRmamprLnNzcycpO1xuICAgIG5ldyBTdGFnZShhcHAsICdhYmNkMTIzLTU4OGRmamprLnNzc19hanNpZCcpO1xuXG4gICAgZXhwZWN0KCgpID0+IG5ldyBTdGFnZShhcHAsICdhYmNkMTIzLTU4OGRmamprLnNzc19hanNpZCAnKSkudG9UaHJvdygvaW52YWxpZCBzdGFnZSBuYW1lIFwiYWJjZDEyMy01ODhkZmpqay5zc3NfYWpzaWQgXCIvKTtcbiAgICBleHBlY3QoKCkgPT4gbmV3IFN0YWdlKGFwcCwgJ2FiY2QxMjMtNTg4ZGZqamsuc3NzX2Fqc2lkL2RmbycpKS50b1Rocm93KC9pbnZhbGlkIHN0YWdlIG5hbWUgXCJhYmNkMTIzLTU4OGRmamprLnNzc19hanNpZFxcL2Rmb1wiLyk7XG4gICAgZXhwZWN0KCgpID0+IG5ldyBTdGFnZShhcHAsICcmJykpLnRvVGhyb3coL2ludmFsaWQgc3RhZ2UgbmFtZSBcIiZcIi8pO1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgU3RhZ2UoYXBwLCAnNDVoZWxsbycpKS50b1Rocm93KC9pbnZhbGlkIHN0YWdlIG5hbWUgXCI0NWhlbGxvXCIvKTtcbiAgICBleHBlY3QoKCkgPT4gbmV3IFN0YWdlKGFwcCwgJ2YnKSkudG9UaHJvdygvaW52YWxpZCBzdGFnZSBuYW1lIFwiZlwiLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ291dGRpciBjYW5ub3QgYmUgc3BlY2lmaWVkIGZvciBuZXN0ZWQgc3RhZ2VzJywgKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KCgpID0+IG5ldyBTdGFnZShhcHAsICdteXN0YWdlJywgeyBvdXRkaXI6ICcvdG1wL2Zvby9iYXInIH0pKS50b1Rocm93KC9cIm91dGRpclwiIGNhbm5vdCBiZSBzcGVjaWZpZWQgZm9yIG5lc3RlZCBzdGFnZXMvKTtcbiAgfSk7XG5cbiAgdGVzdCgnU3RhZ2UuaXNTdGFnZSBpbmRpY2F0ZXMgdGhhdCBhIGNvbnN0cnVjdCBpcyBhIHN0YWdlJywgKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBhcHAgPSBuZXcgQXBwKCk7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICBjb25zdCBzdGFnZSA9IG5ldyBTdGFnZShhcHAsICdTdGFnZScpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChTdGFnZS5pc1N0YWdlKHN0YWdlKSkudG9FcXVhbCh0cnVlKTtcbiAgICBleHBlY3QoU3RhZ2UuaXNTdGFnZShhcHApKS50b0VxdWFsKHRydWUpO1xuICAgIGV4cGVjdChTdGFnZS5pc1N0YWdlKHN0YWNrKSkudG9FcXVhbChmYWxzZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ1N0YWdlLmlzU3RhZ2UgaW5kaWNhdGVzIHRoYXQgYSBjb25zdHJ1Y3QgaXMgYSBzdGFnZSBiYXNlZCBvbiBzeW1ib2wnLCAoKSA9PiB7XG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcbiAgICBjb25zdCBzdGFnZSA9IG5ldyBTdGFnZShhcHAsICdTdGFnZScpO1xuXG4gICAgY29uc3QgZXh0ZXJuYWxTdGFnZSA9IHt9O1xuICAgIGNvbnN0IFNUQUdFX1NZTUJPTCA9IFN5bWJvbC5mb3IoJ0Bhd3MtY2RrL2NvcmUuU3RhZ2UnKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXh0ZXJuYWxTdGFnZSwgU1RBR0VfU1lNQk9MLCB7IHZhbHVlOiB0cnVlIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChTdGFnZS5pc1N0YWdlKHN0YWdlKSkudG9FcXVhbCh0cnVlKTtcbiAgICBleHBlY3QoU3RhZ2UuaXNTdGFnZShhcHApKS50b0VxdWFsKHRydWUpO1xuICAgIGV4cGVjdChTdGFnZS5pc1N0YWdlKGV4dGVybmFsU3RhZ2UpKS50b0VxdWFsKHRydWUpO1xuICB9KTtcbn0pO1xuXG50ZXN0KCdtaXNzaW5nIGNvbnRleHQgaW4gU3RhZ2VzIGlzIHByb3BhZ2F0ZWQgdXAgdG8gcm9vdCBhc3NlbWJseScsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgYXBwID0gbmV3IEFwcCgpO1xuICBjb25zdCBzdGFnZSA9IG5ldyBTdGFnZShhcHAsICdTdGFnZScsIHtcbiAgICBlbnY6IHsgYWNjb3VudDogJ2FjY291bnQnLCByZWdpb246ICdyZWdpb24nIH0sXG4gIH0pO1xuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjayhzdGFnZSwgJ1N0YWNrJyk7XG4gIG5ldyBDZm5SZXNvdXJjZShzdGFjaywgJ1Jlc291cmNlJywgeyB0eXBlOiAnU29tZXRoaW5nJyB9KTtcblxuICAvLyBXSEVOXG4gIHN0YWNrLnJlcG9ydE1pc3NpbmdDb250ZXh0S2V5KHtcbiAgICBrZXk6ICdtaXNzaW5nLWNvbnRleHQta2V5JyxcbiAgICBwcm92aWRlcjogY3hzY2hlbWEuQ29udGV4dFByb3ZpZGVyLkFWQUlMQUJJTElUWV9aT05FX1BST1ZJREVSLFxuICAgIHByb3BzOiB7XG4gICAgICBhY2NvdW50OiAnYWNjb3VudCcsXG4gICAgICByZWdpb246ICdyZWdpb24nLFxuICAgIH0sXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgY29uc3QgYXNzZW1ibHkgPSBhcHAuc3ludGgoKTtcblxuICBleHBlY3QoYXNzZW1ibHkubWFuaWZlc3QubWlzc2luZykudG9FcXVhbChbXG4gICAge1xuICAgICAga2V5OiAnbWlzc2luZy1jb250ZXh0LWtleScsXG4gICAgICBwcm92aWRlcjogY3hzY2hlbWEuQ29udGV4dFByb3ZpZGVyLkFWQUlMQUJJTElUWV9aT05FX1BST1ZJREVSLFxuICAgICAgcHJvcHM6IHtcbiAgICAgICAgYWNjb3VudDogJ2FjY291bnQnLFxuICAgICAgICBsb29rdXBSb2xlQXJuOiAnYXJuOiR7QVdTOjpQYXJ0aXRpb259OmlhbTo6YWNjb3VudDpyb2xlL2Nkay1obmI2NTlmZHMtbG9va3VwLXJvbGUtYWNjb3VudC1yZWdpb24nLFxuICAgICAgICByZWdpb246ICdyZWdpb24nLFxuICAgICAgfSxcbiAgICB9LFxuICBdKTtcbn0pO1xuXG5jbGFzcyBUb3VjaGluZ0FzcGVjdCBpbXBsZW1lbnRzIElBc3BlY3Qge1xuICBwdWJsaWMgcmVhZG9ubHkgdmlzaXRzID0gbmV3IEFycmF5PElDb25zdHJ1Y3Q+KCk7XG4gIHB1YmxpYyB2aXNpdChub2RlOiBJQ29uc3RydWN0KTogdm9pZCB7XG4gICAgdGhpcy52aXNpdHMucHVzaChub2RlKTtcbiAgfVxufVxuXG5jbGFzcyBCb2d1c1N0YWNrIGV4dGVuZHMgU3RhY2sge1xuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIG5ldyBDZm5SZXNvdXJjZSh0aGlzLCAnUmVzb3VyY2UnLCB7XG4gICAgICB0eXBlOiAnQ0RLOjpUZXN0OjpSZXNvdXJjZScsXG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYWNjdFJlZ2lvbihzOiBTdGFjaykge1xuICByZXR1cm4gW3MuYWNjb3VudCwgcy5yZWdpb25dO1xufVxuIl19