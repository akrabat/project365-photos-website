"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../lib");
const util_1 = require("../lib/util");
describe('util', () => {
    test('capitalizeResourceProperties capitalizes all keys of an object (recursively) from camelCase to PascalCase', () => {
        const c = new lib_1.Stack();
        expect((0, util_1.capitalizePropertyNames)(c, undefined)).toEqual(undefined);
        expect((0, util_1.capitalizePropertyNames)(c, 12)).toEqual(12);
        expect((0, util_1.capitalizePropertyNames)(c, 'hello')).toEqual('hello');
        expect((0, util_1.capitalizePropertyNames)(c, ['hello', 88])).toEqual(['hello', 88]);
        expect((0, util_1.capitalizePropertyNames)(c, { Hello: 'world', hey: 'dude' })).toEqual({ Hello: 'world', Hey: 'dude' });
        expect((0, util_1.capitalizePropertyNames)(c, [1, 2, { three: 3 }])).toEqual([1, 2, { Three: 3 }]);
        expect((0, util_1.capitalizePropertyNames)(c, { Hello: 'world', recursive: { foo: 123, there: { another: ['hello', { world: 123 }] } } })).toEqual({ Hello: 'world', Recursive: { Foo: 123, There: { Another: ['hello', { World: 123 }] } } });
        // make sure tokens are resolved and result is also capitalized
        expect((0, util_1.capitalizePropertyNames)(c, { hello: { resolve: () => ({ foo: 'bar' }) }, world: new SomeToken() })).toEqual({ Hello: { Foo: 'bar' }, World: 100 });
    });
    describe('ignoreEmpty', () => {
        test('[]', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)([]))).toEqual(undefined);
        });
        test('{}', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)({}))).toEqual(undefined);
        });
        test('undefined/null', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)(undefined))).toEqual(undefined);
            expect(stack.resolve((0, util_1.ignoreEmpty)(null))).toEqual(null);
        });
        test('primitives', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)(12))).toEqual(12);
            expect(stack.resolve((0, util_1.ignoreEmpty)('12'))).toEqual('12');
        });
        test('non-empty arrays/objects', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)([1, 2, 3, undefined]))).toEqual([1, 2, 3]); // undefined array values is cleaned up by "resolve"
            expect(stack.resolve((0, util_1.ignoreEmpty)({ o: 1, b: 2, j: 3 }))).toEqual({ o: 1, b: 2, j: 3 });
        });
        test('resolve first', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)({ xoo: { resolve: () => 123 } }))).toEqual({ xoo: 123 });
            expect(stack.resolve((0, util_1.ignoreEmpty)({ xoo: { resolve: () => undefined } }))).toEqual(undefined);
            expect(stack.resolve((0, util_1.ignoreEmpty)({ xoo: { resolve: () => [] } }))).toEqual({ xoo: [] });
            expect(stack.resolve((0, util_1.ignoreEmpty)({ xoo: { resolve: () => [undefined, undefined] } }))).toEqual({ xoo: [] });
        });
    });
    describe('filterUnderined', () => {
        test('is null-safe (aka treats null and undefined the same)', () => {
            expect((0, util_1.filterUndefined)({ 'a null': null, 'a not null': true })).toEqual({ 'a not null': true });
        });
        test('removes undefined, but leaves the rest', () => {
            expect((0, util_1.filterUndefined)({ 'an undefined': undefined, 'yes': true })).toEqual({ yes: true });
        });
    });
    test('pathToTopLevelStack returns the array of stacks that lead to a stack', () => {
        const a = new lib_1.Stack(undefined, 'a');
        const aa = new Nested(a, 'aa');
        const aaa = new Nested(aa, 'aaa');
        expect(path(aaa)).toEqual(['a', 'aa', 'aaa']);
        expect(path(aa)).toEqual(['a', 'aa']);
        expect(path(a)).toEqual(['a']);
        function path(s) {
            return (0, util_1.pathToTopLevelStack)(s).map(x => x.node.id);
        }
    });
    test('findCommonStack returns the lowest common stack between two stacks or undefined', () => {
        const a = new lib_1.Stack(undefined, 'a');
        const aa = new Nested(a, 'aa');
        const ab = new Nested(a, 'ab');
        const aaa = new Nested(aa, 'aaa');
        const aab = new Nested(aa, 'aab');
        const aba = new Nested(ab, 'aba');
        const b = new lib_1.Stack(undefined, 'b');
        const ba = new Nested(b, 'ba');
        const baa = new Nested(ba, 'baa');
        expect(lca(a, b)).toEqual(undefined);
        expect(lca(aa, ab)).toEqual('a');
        expect(lca(ab, aa)).toEqual('a');
        expect(lca(aa, aba)).toEqual('a');
        expect(lca(aba, aa)).toEqual('a');
        expect(lca(ab, aba)).toEqual('ab');
        expect(lca(aba, ab)).toEqual('ab');
        expect(lca(aba, aba)).toEqual('aba');
        expect(lca(aa, aa)).toEqual('aa');
        expect(lca(a, aaa)).toEqual('a');
        expect(lca(aaa, aab)).toEqual('aa');
        expect(lca(aaa, b)).toEqual(undefined);
        expect(lca(aaa, ba)).toEqual(undefined);
        expect(lca(baa, ba)).toEqual('ba');
        function lca(s1, s2) {
            const res = (0, util_1.findLastCommonElement)((0, util_1.pathToTopLevelStack)(s1), (0, util_1.pathToTopLevelStack)(s2));
            if (!res) {
                return undefined;
            }
            return res.node.id;
        }
    });
});
class SomeToken {
    constructor() {
        this.foo = 60;
        this.goo = 40;
    }
    resolve() {
        return this.foo + this.goo;
    }
}
class Nested extends lib_1.Stack {
    constructor(scope, id) {
        const resource = new lib_1.CfnResource(scope, `${id}+NestedStackResource`, { type: 'AWS::CloudFormation::Stack' });
        super(scope, id);
        this.nestedStackResource = resource;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidXRpbC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsZ0NBQTRDO0FBQzVDLHNDQUFnSTtBQUVoSSxRQUFRLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRTtJQUNwQixJQUFJLENBQUMsMkdBQTJHLEVBQUUsR0FBRyxFQUFFO1FBQ3JILE1BQU0sQ0FBQyxHQUFHLElBQUksV0FBSyxFQUFFLENBQUM7UUFFdEIsTUFBTSxDQUFDLElBQUEsOEJBQXVCLEVBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2pFLE1BQU0sQ0FBQyxJQUFBLDhCQUF1QixFQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNuRCxNQUFNLENBQUMsSUFBQSw4QkFBdUIsRUFBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDN0QsTUFBTSxDQUFDLElBQUEsOEJBQXVCLEVBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN6RSxNQUFNLENBQUMsSUFBQSw4QkFBdUIsRUFBQyxDQUFDLEVBQzlCLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDekMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ25DLE1BQU0sQ0FBQyxJQUFBLDhCQUF1QixFQUFDLENBQUMsRUFDOUIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxD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RSxLQUFLLENBQUMsQ0FBQztRQUNsQyxNQUFNLEdBQUcsR0FBRyxJQUFJLE1BQU0sQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbEMsTUFBTSxHQUFHLEdBQUcsSUFBSSxNQUFNLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRWxDLE1BQU0sQ0FBQyxHQUFHLElBQUksV0FBSyxDQUFDLFNBQVMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNwQyxNQUFNLEVBQUUsR0FBRyxJQUFJLE1BQU0sQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDL0IsTUFBTSxHQUFHLEdBQUcsSUFBSSxNQUFNLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRWxDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3hDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRW5DLFNBQVMsR0FBRyxDQUFDLEVBQVMsRUFBRSxFQUFTO1lBQy9CLE1BQU0sR0FBRyxHQUFHLElBQUEsNEJBQXFCLEVBQUMsSUFBQSwwQkFBbUIsRUFBQyxFQUFFLENBQUMsRUFBRSxJQUFBLDBCQUFtQixFQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDcEYsSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFBRSxPQUFPLFNBQVMsQ0FBQzthQUFFO1lBQy9CLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDckIsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxNQUFNLFNBQVM7SUFBZjtRQUNTLFFBQUcsR0FBRyxFQUFFLENBQUM7UUFDVCxRQUFHLEdBQUcsRUFBRSxDQUFDO0lBSWxCLENBQUM7SUFIUSxPQUFPO1FBQ1osT0FBTyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7S0FDNUI7Q0FDRjtBQUVELE1BQU0sTUFBTyxTQUFRLFdBQUs7SUFFeEIsWUFBWSxLQUFnQixFQUFFLEVBQVU7UUFDdEMsTUFBTSxRQUFRLEdBQUcsSUFBSSxpQkFBVyxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsc0JBQXNCLEVBQUUsRUFBRSxJQUFJLEVBQUUsNEJBQTRCLEVBQUUsQ0FBQyxDQUFDO1FBQzdHLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLFFBQVEsQ0FBQztLQUNyQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgeyBDZm5SZXNvdXJjZSwgU3RhY2sgfSBmcm9tICcuLi9saWInO1xuaW1wb3J0IHsgY2FwaXRhbGl6ZVByb3BlcnR5TmFtZXMsIGZpbHRlclVuZGVmaW5lZCwgZmluZExhc3RDb21tb25FbGVtZW50LCBpZ25vcmVFbXB0eSwgcGF0aFRvVG9wTGV2ZWxTdGFjayB9IGZyb20gJy4uL2xpYi91dGlsJztcblxuZGVzY3JpYmUoJ3V0aWwnLCAoKSA9PiB7XG4gIHRlc3QoJ2NhcGl0YWxpemVSZXNvdXJjZVByb3BlcnRpZXMgY2FwaXRhbGl6ZXMgYWxsIGtleXMgb2YgYW4gb2JqZWN0IChyZWN1cnNpdmVseSkgZnJvbSBjYW1lbENhc2UgdG8gUGFzY2FsQ2FzZScsICgpID0+IHtcbiAgICBjb25zdCBjID0gbmV3IFN0YWNrKCk7XG5cbiAgICBleHBlY3QoY2FwaXRhbGl6ZVByb3BlcnR5TmFtZXMoYywgdW5kZWZpbmVkKSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICAgIGV4cGVjdChjYXBpdGFsaXplUHJvcGVydHlOYW1lcyhjLCAxMikpLnRvRXF1YWwoMTIpO1xuICAgIGV4cGVjdChjYXBpdGFsaXplUHJvcGVydHlOYW1lcyhjLCAnaGVsbG8nKSkudG9FcXVhbCgnaGVsbG8nKTtcbiAgICBleHBlY3QoY2FwaXRhbGl6ZVByb3BlcnR5TmFtZXMoYywgWydoZWxsbycsIDg4XSkpLnRvRXF1YWwoWydoZWxsbycsIDg4XSk7XG4gICAgZXhwZWN0KGNhcGl0YWxpemVQcm9wZXJ0eU5hbWVzKGMsXG4gICAgICB7IEhlbGxvOiAnd29ybGQnLCBoZXk6ICdkdWRlJyB9KSkudG9FcXVhbChcbiAgICAgIHsgSGVsbG86ICd3b3JsZCcsIEhleTogJ2R1ZGUnIH0pO1xuICAgIGV4cGVjdChjYXBpdGFsaXplUHJvcGVydHlOYW1lcyhjLFxuICAgICAgWzEsIDIsIHsgdGhyZWU6IDMgfV0pKS50b0VxdWFsKFxuICAgICAgWzEsIDIsIHsgVGhyZWU6IDMgfV0pO1xuICAgIGV4cGVjdChjYXBpdGFsaXplUHJvcGVydHlOYW1lcyhjLFxuICAgICAgeyBIZWxsbzogJ3dvcmxkJywgcmVjdXJzaXZlOiB7IGZvbzogMTIzLCB0aGVyZTogeyBhbm90aGVyOiBbJ2hlbGxvJywgeyB3b3JsZDogMTIzIH1dIH0gfSB9KSkudG9FcXVhbChcbiAgICAgIHsgSGVsbG86ICd3b3JsZCcsIFJlY3Vyc2l2ZTogeyBGb286IDEyMywgVGhlcmU6IHsgQW5vdGhlcjogWydoZWxsbycsIHsgV29ybGQ6IDEyMyB9XSB9IH0gfSk7XG5cbiAgICAvLyBtYWtlIHN1cmUgdG9rZW5zIGFyZSByZXNvbHZlZCBhbmQgcmVzdWx0IGlzIGFsc28gY2FwaXRhbGl6ZWRcbiAgICBleHBlY3QoY2FwaXRhbGl6ZVByb3BlcnR5TmFtZXMoYyxcbiAgICAgIHsgaGVsbG86IHsgcmVzb2x2ZTogKCkgPT4gKHsgZm9vOiAnYmFyJyB9KSB9LCB3b3JsZDogbmV3IFNvbWVUb2tlbigpIH0pKS50b0VxdWFsKFxuICAgICAgeyBIZWxsbzogeyBGb286ICdiYXInIH0sIFdvcmxkOiAxMDAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpZ25vcmVFbXB0eScsICgpID0+IHtcbiAgICB0ZXN0KCdbXScsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eShbXSkpKS50b0VxdWFsKHVuZGVmaW5lZCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCd7fScsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eSh7fSkpKS50b0VxdWFsKHVuZGVmaW5lZCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCd1bmRlZmluZWQvbnVsbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eSh1bmRlZmluZWQpKSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkobnVsbCkpKS50b0VxdWFsKG51bGwpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgncHJpbWl0aXZlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eSgxMikpKS50b0VxdWFsKDEyKTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KCcxMicpKSkudG9FcXVhbCgnMTInKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ25vbi1lbXB0eSBhcnJheXMvb2JqZWN0cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eShbMSwgMiwgMywgdW5kZWZpbmVkXSkpKS50b0VxdWFsKFsxLCAyLCAzXSk7IC8vIHVuZGVmaW5lZCBhcnJheSB2YWx1ZXMgaXMgY2xlYW5lZCB1cCBieSBcInJlc29sdmVcIlxuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkoeyBvOiAxLCBiOiAyLCBqOiAzIH0pKSkudG9FcXVhbCh7IG86IDEsIGI6IDIsIGo6IDMgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdyZXNvbHZlIGZpcnN0JywgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KHsgeG9vOiB7IHJlc29sdmU6ICgpID0+IDEyMyB9IH0pKSkudG9FcXVhbCh7IHhvbzogMTIzIH0pO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkoeyB4b286IHsgcmVzb2x2ZTogKCkgPT4gdW5kZWZpbmVkIH0gfSkpKS50b0VxdWFsKHVuZGVmaW5lZCk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eSh7IHhvbzogeyByZXNvbHZlOiAoKSA9PiBbXSB9IH0pKSkudG9FcXVhbCh7IHhvbzogW10gfSk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eSh7IHhvbzogeyByZXNvbHZlOiAoKSA9PiBbdW5kZWZpbmVkLCB1bmRlZmluZWRdIH0gfSkpKS50b0VxdWFsKHsgeG9vOiBbXSB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbHRlclVuZGVyaW5lZCcsICgpID0+IHtcbiAgICB0ZXN0KCdpcyBudWxsLXNhZmUgKGFrYSB0cmVhdHMgbnVsbCBhbmQgdW5kZWZpbmVkIHRoZSBzYW1lKScsICgpID0+IHtcbiAgICAgIGV4cGVjdChmaWx0ZXJVbmRlZmluZWQoeyAnYSBudWxsJzogbnVsbCwgJ2Egbm90IG51bGwnOiB0cnVlIH0pKS50b0VxdWFsKHsgJ2Egbm90IG51bGwnOiB0cnVlIH0pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgncmVtb3ZlcyB1bmRlZmluZWQsIGJ1dCBsZWF2ZXMgdGhlIHJlc3QnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoZmlsdGVyVW5kZWZpbmVkKHsgJ2FuIHVuZGVmaW5lZCc6IHVuZGVmaW5lZCwgJ3llcyc6IHRydWUgfSkpLnRvRXF1YWwoeyB5ZXM6IHRydWUgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3BhdGhUb1RvcExldmVsU3RhY2sgcmV0dXJucyB0aGUgYXJyYXkgb2Ygc3RhY2tzIHRoYXQgbGVhZCB0byBhIHN0YWNrJywgKCkgPT4ge1xuICAgIGNvbnN0IGEgPSBuZXcgU3RhY2sodW5kZWZpbmVkLCAnYScpO1xuICAgIGNvbnN0IGFhID0gbmV3IE5lc3RlZChhLCAnYWEnKTtcbiAgICBjb25zdCBhYWEgPSBuZXcgTmVzdGVkKGFhLCAnYWFhJyk7XG5cbiAgICBleHBlY3QocGF0aChhYWEpKS50b0VxdWFsKFsnYScsICdhYScsICdhYWEnXSk7XG4gICAgZXhwZWN0KHBhdGgoYWEpKS50b0VxdWFsKFsnYScsICdhYSddKTtcbiAgICBleHBlY3QocGF0aChhKSkudG9FcXVhbChbJ2EnXSk7XG4gICAgZnVuY3Rpb24gcGF0aChzOiBTdGFjaykge1xuICAgICAgcmV0dXJuIHBhdGhUb1RvcExldmVsU3RhY2socykubWFwKHggPT4geC5ub2RlLmlkKTtcbiAgICB9XG4gIH0pO1xuXG4gIHRlc3QoJ2ZpbmRDb21tb25TdGFjayByZXR1cm5zIHRoZSBsb3dlc3QgY29tbW9uIHN0YWNrIGJldHdlZW4gdHdvIHN0YWNrcyBvciB1bmRlZmluZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgYSA9IG5ldyBTdGFjayh1bmRlZmluZWQsICdhJyk7XG4gICAgY29uc3QgYWEgPSBuZXcgTmVzdGVkKGEsICdhYScpO1xuICAgIGNvbnN0IGFiID0gbmV3IE5lc3RlZChhLCAnYWInKTtcbiAgICBjb25zdCBhYWEgPSBuZXcgTmVzdGVkKGFhLCAnYWFhJyk7XG4gICAgY29uc3QgYWFiID0gbmV3IE5lc3RlZChhYSwgJ2FhYicpO1xuICAgIGNvbnN0IGFiYSA9IG5ldyBOZXN0ZWQoYWIsICdhYmEnKTtcblxuICAgIGNvbnN0IGIgPSBuZXcgU3RhY2sodW5kZWZpbmVkLCAnYicpO1xuICAgIGNvbnN0IGJhID0gbmV3IE5lc3RlZChiLCAnYmEnKTtcbiAgICBjb25zdCBiYWEgPSBuZXcgTmVzdGVkKGJhLCAnYmFhJyk7XG5cbiAgICBleHBlY3QobGNhKGEsIGIpKS50b0VxdWFsKHVuZGVmaW5lZCk7XG4gICAgZXhwZWN0KGxjYShhYSwgYWIpKS50b0VxdWFsKCdhJyk7XG4gICAgZXhwZWN0KGxjYShhYiwgYWEpKS50b0VxdWFsKCdhJyk7XG4gICAgZXhwZWN0KGxjYShhYSwgYWJhKSkudG9FcXVhbCgnYScpO1xuICAgIGV4cGVjdChsY2EoYWJhLCBhYSkpLnRvRXF1YWwoJ2EnKTtcbiAgICBleHBlY3QobGNhKGFiLCBhYmEpKS50b0VxdWFsKCdhYicpO1xuICAgIGV4cGVjdChsY2EoYWJhLCBhYikpLnRvRXF1YWwoJ2FiJyk7XG4gICAgZXhwZWN0KGxjYShhYmEsIGFiYSkpLnRvRXF1YWwoJ2FiYScpO1xuICAgIGV4cGVjdChsY2EoYWEsIGFhKSkudG9FcXVhbCgnYWEnKTtcbiAgICBleHBlY3QobGNhKGEsIGFhYSkpLnRvRXF1YWwoJ2EnKTtcbiAgICBleHBlY3QobGNhKGFhYSwgYWFiKSkudG9FcXVhbCgnYWEnKTtcbiAgICBleHBlY3QobGNhKGFhYSwgYikpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgICBleHBlY3QobGNhKGFhYSwgYmEpKS50b0VxdWFsKHVuZGVmaW5lZCk7XG4gICAgZXhwZWN0KGxjYShiYWEsIGJhKSkudG9FcXVhbCgnYmEnKTtcblxuICAgIGZ1bmN0aW9uIGxjYShzMTogU3RhY2ssIHMyOiBTdGFjaykge1xuICAgICAgY29uc3QgcmVzID0gZmluZExhc3RDb21tb25FbGVtZW50KHBhdGhUb1RvcExldmVsU3RhY2soczEpLCBwYXRoVG9Ub3BMZXZlbFN0YWNrKHMyKSk7XG4gICAgICBpZiAoIXJlcykgeyByZXR1cm4gdW5kZWZpbmVkOyB9XG4gICAgICByZXR1cm4gcmVzLm5vZGUuaWQ7XG4gICAgfVxuICB9KTtcbn0pO1xuXG5jbGFzcyBTb21lVG9rZW4ge1xuICBwdWJsaWMgZm9vID0gNjA7XG4gIHB1YmxpYyBnb28gPSA0MDtcbiAgcHVibGljIHJlc29sdmUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZm9vICsgdGhpcy5nb287XG4gIH1cbn1cblxuY2xhc3MgTmVzdGVkIGV4dGVuZHMgU3RhY2sge1xuICBwdWJsaWMgcmVhZG9ubHkgbmVzdGVkU3RhY2tSZXNvdXJjZT86IENmblJlc291cmNlO1xuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nKSB7XG4gICAgY29uc3QgcmVzb3VyY2UgPSBuZXcgQ2ZuUmVzb3VyY2Uoc2NvcGUsIGAke2lkfStOZXN0ZWRTdGFja1Jlc291cmNlYCwgeyB0eXBlOiAnQVdTOjpDbG91ZEZvcm1hdGlvbjo6U3RhY2snIH0pO1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG4gICAgdGhpcy5uZXN0ZWRTdGFja1Jlc291cmNlID0gcmVzb3VyY2U7XG4gIH1cbn1cbiJdfQ==