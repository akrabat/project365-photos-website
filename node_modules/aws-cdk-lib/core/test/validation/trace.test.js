"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const constructs_1 = require("constructs");
const core = require("../../lib");
const lib_1 = require("../../lib");
const construct_tree_1 = require("../../lib/validation/private/construct-tree");
const trace_1 = require("../../lib/validation/private/trace");
beforeEach(() => {
    jest.spyOn(console, 'log').mockImplementation(() => { return true; });
});
afterEach(() => {
    jest.resetAllMocks();
});
describe('ReportTrace', () => {
    test('trace includes location when CDK_DEBUG=true', () => {
        // GIVEN
        try {
            process.env.CDK_DEBUG = 'true';
            const app = new core.App({
                treeMetadata: true,
            });
            const stack = new MyStack(app, 'MyStack');
            app.synth();
            const tree = new construct_tree_1.ConstructTree(app);
            // WHEN
            const trace = new trace_1.ReportTrace(tree);
            const formatted = trace.formatJson(stack.constructPath);
            // THEN
            expect(formatted).toEqual({
                id: 'MyStack',
                construct: expect.stringMatching(/.*Stack/),
                libraryVersion: expect.any(String),
                location: expect.stringMatching(/Object.<anonymous> \(.*\/trace.test.ts:[0-9]+:[0-9]+\)/),
                path: 'MyStack',
                child: {
                    id: 'MyConstruct',
                    construct: 'constructs.Construct',
                    libraryVersion: expect.any(String),
                    location: expect.stringMatching(/new MyStack \(.*\/trace.test.ts:[0-9]+:[0-9]+\)/),
                    path: 'MyStack/MyConstruct',
                    child: {
                        id: 'MyL2Resource',
                        construct: expect.stringMatching(/Resource/),
                        libraryVersion: expect.any(String),
                        location: expect.stringMatching(/new MyConstruct \(.*\/trace.test.ts:[0-9]+:[0-9]+\)/),
                        path: 'MyStack/MyConstruct/MyL2Resource',
                        child: {
                            id: 'Resource',
                            construct: expect.stringMatching(/CfnResource/),
                            libraryVersion: expect.any(String),
                            location: expect.stringMatching(/new MyL2Resource \(.*\/trace.test.ts:[0-9]+:[0-9]+\)/),
                            path: 'MyStack/MyConstruct/MyL2Resource/Resource',
                        },
                    },
                },
            });
        }
        finally {
            process.env.CDK_DEBUG = '';
        }
    });
    test('trace does not include location when CDK_DEBUG=false', () => {
        // GIVEN
        const app = new core.App({
            treeMetadata: true,
        });
        const stack = new MyStack(app, 'MyStack');
        app.synth();
        const tree = new construct_tree_1.ConstructTree(app);
        // WHEN
        const trace = new trace_1.ReportTrace(tree);
        const formatted = trace.formatJson(stack.constructPath);
        // THEN
        expect(formatted).toEqual({
            id: 'MyStack',
            construct: expect.stringMatching(/.*Stack/),
            libraryVersion: expect.any(String),
            location: "Run with '--debug' to include location info",
            path: 'MyStack',
            child: {
                id: 'MyConstruct',
                construct: 'constructs.Construct',
                libraryVersion: expect.any(String),
                location: "Run with '--debug' to include location info",
                path: 'MyStack/MyConstruct',
                child: {
                    id: 'MyL2Resource',
                    construct: expect.stringMatching(/Resource/),
                    libraryVersion: expect.any(String),
                    location: "Run with '--debug' to include location info",
                    path: 'MyStack/MyConstruct/MyL2Resource',
                    child: {
                        id: 'Resource',
                        construct: expect.stringMatching(/CfnResource/),
                        libraryVersion: expect.any(String),
                        location: "Run with '--debug' to include location info",
                        path: 'MyStack/MyConstruct/MyL2Resource/Resource',
                    },
                },
            },
        });
    });
});
class MyL2Resource extends lib_1.Resource {
    constructor(scope, id) {
        super(scope, id);
        const resource = new core.CfnResource(this, 'Resource', {
            type: 'AWS::CDK::TestResource',
            properties: {
                testProp1: 'testValue',
            },
        });
        this.constructPath = resource.node.path;
    }
}
class MyConstruct extends constructs_1.Construct {
    constructor(scope, id) {
        super(scope, id);
        const myResource = new MyL2Resource(this, 'MyL2Resource');
        this.constructPath = myResource.constructPath;
    }
}
class MyStack extends core.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        const myConstruct = new MyConstruct(this, 'MyConstruct');
        this.constructPath = myConstruct.constructPath;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhY2UudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRyYWNlLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwyQ0FBdUM7QUFDdkMsa0NBQWtDO0FBQ2xDLG1DQUFnRDtBQUNoRCxnRkFBNEU7QUFDNUUsOERBQWlFO0FBRWpFLFVBQVUsQ0FBQyxHQUFHLEVBQUU7SUFDZCxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsR0FBRyxPQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3hFLENBQUMsQ0FBQyxDQUFDO0FBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtJQUNiLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztBQUN2QixDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO0lBQzNCLElBQUksQ0FBQyw2Q0FBNkMsRUFBRSxHQUFHLEVBQUU7UUFDdkQsUUFBUTtRQUNSLElBQUk7WUFDRixPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUM7WUFDL0IsTUFBTSxHQUFHLEdBQUcsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDO2dCQUN2QixZQUFZLEVBQUUsSUFBSTthQUNuQixDQUFDLENBQUM7WUFDSCxNQUFNLEtBQUssR0FBRyxJQUFJLE9BQU8sQ0FBQyxHQUFHLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDMUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ1osTUFBTSxJQUFJLEdBQUcsSUFBSSw4QkFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRXBDLE9BQU87WUFDUCxNQUFNLEtBQUssR0FBRyxJQUFJLG1CQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDcEMsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7WUFF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QWdCLEVBQUUsRUFBVSxFQUFFLEtBQXVCO1FBQy9ELEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3hCLE1BQU0sV0FBVyxHQUFHLElBQUksV0FBVyxDQUFDLElBQUksRUFBRSxhQUFhLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsYUFBYSxHQUFHLFdBQVcsQ0FBQyxhQUFhLENBQUM7S0FDaEQ7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0ICogYXMgY29yZSBmcm9tICcuLi8uLi9saWInO1xuaW1wb3J0IHsgUmVzb3VyY2UsIElSZXNvdXJjZSB9IGZyb20gJy4uLy4uL2xpYic7XG5pbXBvcnQgeyBDb25zdHJ1Y3RUcmVlIH0gZnJvbSAnLi4vLi4vbGliL3ZhbGlkYXRpb24vcHJpdmF0ZS9jb25zdHJ1Y3QtdHJlZSc7XG5pbXBvcnQgeyBSZXBvcnRUcmFjZSB9IGZyb20gJy4uLy4uL2xpYi92YWxpZGF0aW9uL3ByaXZhdGUvdHJhY2UnO1xuXG5iZWZvcmVFYWNoKCgpID0+IHtcbiAgamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHsgcmV0dXJuIHRydWU7IH0pO1xufSk7XG5cbmFmdGVyRWFjaCgoKSA9PiB7XG4gIGplc3QucmVzZXRBbGxNb2NrcygpO1xufSk7XG5cbmRlc2NyaWJlKCdSZXBvcnRUcmFjZScsICgpID0+IHtcbiAgdGVzdCgndHJhY2UgaW5jbHVkZXMgbG9jYXRpb24gd2hlbiBDREtfREVCVUc9dHJ1ZScsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIHRyeSB7XG4gICAgICBwcm9jZXNzLmVudi5DREtfREVCVUcgPSAndHJ1ZSc7XG4gICAgICBjb25zdCBhcHAgPSBuZXcgY29yZS5BcHAoe1xuICAgICAgICB0cmVlTWV0YWRhdGE6IHRydWUsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IE15U3RhY2soYXBwLCAnTXlTdGFjaycpO1xuICAgICAgYXBwLnN5bnRoKCk7XG4gICAgICBjb25zdCB0cmVlID0gbmV3IENvbnN0cnVjdFRyZWUoYXBwKTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgdHJhY2UgPSBuZXcgUmVwb3J0VHJhY2UodHJlZSk7XG4gICAgICBjb25zdCBmb3JtYXR0ZWQgPSB0cmFjZS5mb3JtYXRKc29uKHN0YWNrLmNvbnN0cnVjdFBhdGgpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBleHBlY3QoZm9ybWF0dGVkKS50b0VxdWFsKHtcbiAgICAgICAgaWQ6ICdNeVN0YWNrJyxcbiAgICAgICAgY29uc3RydWN0OiBleHBlY3Quc3RyaW5nTWF0Y2hpbmcoLy4qU3RhY2svKSxcbiAgICAgICAgbGlicmFyeVZlcnNpb246IGV4cGVjdC5hbnkoU3RyaW5nKSxcbiAgICAgICAgbG9jYXRpb246IGV4cGVjdC5zdHJpbmdNYXRjaGluZygvT2JqZWN0Ljxhbm9ueW1vdXM+IFxcKC4qXFwvdHJhY2UudGVzdC50czpbMC05XSs6WzAtOV0rXFwpLyksXG4gICAgICAgIHBhdGg6ICdNeVN0YWNrJyxcbiAgICAgICAgY2hpbGQ6IHtcbiAgICAgICAgICBpZDogJ015Q29uc3RydWN0JyxcbiAgICAgICAgICBjb25zdHJ1Y3Q6ICdjb25zdHJ1Y3RzLkNvbnN0cnVjdCcsXG4gICAgICAgICAgbGlicmFyeVZlcnNpb246IGV4cGVjdC5hbnkoU3RyaW5nKSxcbiAgICAgICAgICBsb2NhdGlvbjogZXhwZWN0LnN0cmluZ01hdGNoaW5nKC9uZXcgTXlTdGFjayBcXCguKlxcL3RyYWNlLnRlc3QudHM6WzAtOV0rOlswLTldK1xcKS8pLFxuICAgICAgICAgIHBhdGg6ICdNeVN0YWNrL015Q29uc3RydWN0JyxcbiAgICAgICAgICBjaGlsZDoge1xuICAgICAgICAgICAgaWQ6ICdNeUwyUmVzb3VyY2UnLFxuICAgICAgICAgICAgY29uc3RydWN0OiBleHBlY3Quc3RyaW5nTWF0Y2hpbmcoL1Jlc291cmNlLyksXG4gICAgICAgICAgICBsaWJyYXJ5VmVyc2lvbjogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICAgICAgbG9jYXRpb246IGV4cGVjdC5zdHJpbmdNYXRjaGluZygvbmV3IE15Q29uc3RydWN0IFxcKC4qXFwvdHJhY2UudGVzdC50czpbMC05XSs6WzAtOV0rXFwpLyksXG4gICAgICAgICAgICBwYXRoOiAnTXlTdGFjay9NeUNvbnN0cnVjdC9NeUwyUmVzb3VyY2UnLFxuICAgICAgICAgICAgY2hpbGQ6IHtcbiAgICAgICAgICAgICAgaWQ6ICdSZXNvdXJjZScsXG4gICAgICAgICAgICAgIGNvbnN0cnVjdDogZXhwZWN0LnN0cmluZ01hdGNoaW5nKC9DZm5SZXNvdXJjZS8pLFxuICAgICAgICAgICAgICBsaWJyYXJ5VmVyc2lvbjogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICAgICAgICBsb2NhdGlvbjogZXhwZWN0LnN0cmluZ01hdGNoaW5nKC9uZXcgTXlMMlJlc291cmNlIFxcKC4qXFwvdHJhY2UudGVzdC50czpbMC05XSs6WzAtOV0rXFwpLyksXG4gICAgICAgICAgICAgIHBhdGg6ICdNeVN0YWNrL015Q29uc3RydWN0L015TDJSZXNvdXJjZS9SZXNvdXJjZScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgcHJvY2Vzcy5lbnYuQ0RLX0RFQlVHID0gJyc7XG4gICAgfVxuICB9KTtcblxuICB0ZXN0KCd0cmFjZSBkb2VzIG5vdCBpbmNsdWRlIGxvY2F0aW9uIHdoZW4gQ0RLX0RFQlVHPWZhbHNlJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgYXBwID0gbmV3IGNvcmUuQXBwKHtcbiAgICAgIHRyZWVNZXRhZGF0YTogdHJ1ZSxcbiAgICB9KTtcbiAgICBjb25zdCBzdGFjayA9IG5ldyBNeVN0YWNrKGFwcCwgJ015U3RhY2snKTtcbiAgICBhcHAuc3ludGgoKTtcbiAgICBjb25zdCB0cmVlID0gbmV3IENvbnN0cnVjdFRyZWUoYXBwKTtcblxuICAgIC8vIFdIRU5cbiAgICBjb25zdCB0cmFjZSA9IG5ldyBSZXBvcnRUcmFjZSh0cmVlKTtcbiAgICBjb25zdCBmb3JtYXR0ZWQgPSB0cmFjZS5mb3JtYXRKc29uKHN0YWNrLmNvbnN0cnVjdFBhdGgpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChmb3JtYXR0ZWQpLnRvRXF1YWwoe1xuICAgICAgaWQ6ICdNeVN0YWNrJyxcbiAgICAgIGNvbnN0cnVjdDogZXhwZWN0LnN0cmluZ01hdGNoaW5nKC8uKlN0YWNrLyksXG4gICAgICBsaWJyYXJ5VmVyc2lvbjogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgbG9jYXRpb246IFwiUnVuIHdpdGggJy0tZGVidWcnIHRvIGluY2x1ZGUgbG9jYXRpb24gaW5mb1wiLFxuICAgICAgcGF0aDogJ015U3RhY2snLFxuICAgICAgY2hpbGQ6IHtcbiAgICAgICAgaWQ6ICdNeUNvbnN0cnVjdCcsXG4gICAgICAgIGNvbnN0cnVjdDogJ2NvbnN0cnVjdHMuQ29uc3RydWN0JyxcbiAgICAgICAgbGlicmFyeVZlcnNpb246IGV4cGVjdC5hbnkoU3RyaW5nKSxcbiAgICAgICAgbG9jYXRpb246IFwiUnVuIHdpdGggJy0tZGVidWcnIHRvIGluY2x1ZGUgbG9jYXRpb24gaW5mb1wiLFxuICAgICAgICBwYXRoOiAnTXlTdGFjay9NeUNvbnN0cnVjdCcsXG4gICAgICAgIGNoaWxkOiB7XG4gICAgICAgICAgaWQ6ICdNeUwyUmVzb3VyY2UnLFxuICAgICAgICAgIGNvbnN0cnVjdDogZXhwZWN0LnN0cmluZ01hdGNoaW5nKC9SZXNvdXJjZS8pLFxuICAgICAgICAgIGxpYnJhcnlWZXJzaW9uOiBleHBlY3QuYW55KFN0cmluZyksXG4gICAgICAgICAgbG9jYXRpb246IFwiUnVuIHdpdGggJy0tZGVidWcnIHRvIGluY2x1ZGUgbG9jYXRpb24gaW5mb1wiLFxuICAgICAgICAgIHBhdGg6ICdNeVN0YWNrL015Q29uc3RydWN0L015TDJSZXNvdXJjZScsXG4gICAgICAgICAgY2hpbGQ6IHtcbiAgICAgICAgICAgIGlkOiAnUmVzb3VyY2UnLFxuICAgICAgICAgICAgY29uc3RydWN0OiBleHBlY3Quc3RyaW5nTWF0Y2hpbmcoL0NmblJlc291cmNlLyksXG4gICAgICAgICAgICBsaWJyYXJ5VmVyc2lvbjogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICAgICAgbG9jYXRpb246IFwiUnVuIHdpdGggJy0tZGVidWcnIHRvIGluY2x1ZGUgbG9jYXRpb24gaW5mb1wiLFxuICAgICAgICAgICAgcGF0aDogJ015U3RhY2svTXlDb25zdHJ1Y3QvTXlMMlJlc291cmNlL1Jlc291cmNlJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuaW50ZXJmYWNlIElNeUwyUmVzb3VyY2UgZXh0ZW5kcyBJUmVzb3VyY2Uge31cblxuY2xhc3MgTXlMMlJlc291cmNlIGV4dGVuZHMgUmVzb3VyY2UgaW1wbGVtZW50cyBJTXlMMlJlc291cmNlIHtcbiAgcHVibGljIHJlYWRvbmx5IGNvbnN0cnVjdFBhdGg6IHN0cmluZztcbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG4gICAgY29uc3QgcmVzb3VyY2UgPSBuZXcgY29yZS5DZm5SZXNvdXJjZSh0aGlzLCAnUmVzb3VyY2UnLCB7XG4gICAgICB0eXBlOiAnQVdTOjpDREs6OlRlc3RSZXNvdXJjZScsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHRlc3RQcm9wMTogJ3Rlc3RWYWx1ZScsXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHRoaXMuY29uc3RydWN0UGF0aCA9IHJlc291cmNlLm5vZGUucGF0aDtcbiAgfVxufVxuXG5jbGFzcyBNeUNvbnN0cnVjdCBleHRlbmRzIENvbnN0cnVjdCB7XG4gIHB1YmxpYyByZWFkb25seSBjb25zdHJ1Y3RQYXRoOiBzdHJpbmc7XG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIGNvbnN0IG15UmVzb3VyY2UgPSBuZXcgTXlMMlJlc291cmNlKHRoaXMsICdNeUwyUmVzb3VyY2UnKTtcbiAgICB0aGlzLmNvbnN0cnVjdFBhdGggPSBteVJlc291cmNlLmNvbnN0cnVjdFBhdGg7XG4gIH1cbn1cblxuY2xhc3MgTXlTdGFjayBleHRlbmRzIGNvcmUuU3RhY2sge1xuICBwdWJsaWMgcmVhZG9ubHkgY29uc3RydWN0UGF0aDogc3RyaW5nO1xuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wcz86IGNvcmUuU3RhY2tQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xuICAgIGNvbnN0IG15Q29uc3RydWN0ID0gbmV3IE15Q29uc3RydWN0KHRoaXMsICdNeUNvbnN0cnVjdCcpO1xuICAgIHRoaXMuY29uc3RydWN0UGF0aCA9IG15Q29uc3RydWN0LmNvbnN0cnVjdFBhdGg7XG4gIH1cbn1cbiJdfQ==