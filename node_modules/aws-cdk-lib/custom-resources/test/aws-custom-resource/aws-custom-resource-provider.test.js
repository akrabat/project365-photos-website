"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const AWS = require("aws-sdk-mock");
const fs = require("fs-extra");
const nock = require("nock");
const sinon = require("sinon");
const lib_1 = require("../../lib");
const runtime_1 = require("../../lib/aws-custom-resource/runtime");
// This test performs an 'npm install' which may take longer than the default
// 5s timeout
jest.setTimeout(60000);
/* eslint-disable no-console */
console.log = jest.fn();
const eventCommon = {
    ServiceToken: 'token',
    ResponseURL: 'https://localhost',
    StackId: 'stackId',
    RequestId: 'requestId',
    LogicalResourceId: 'logicalResourceId',
    ResourceType: 'Custom::AWS',
};
function createRequest(bodyPredicate) {
    return nock('https://localhost')
        .put('/', bodyPredicate)
        .reply(200);
}
beforeEach(() => {
    AWS.setSDK(require.resolve('aws-sdk'));
});
afterEach(() => {
    AWS.restore();
    nock.cleanAll();
});
test('create event with physical resource id path', async () => {
    const listObjectsFake = sinon.fake.resolves({
        Contents: [
            {
                Key: 'first-key',
                ETag: 'first-key-etag',
            },
            {
                Key: 'second-key',
                ETag: 'second-key-etag',
            },
        ],
    });
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: JSON.stringify({
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.fromResponse('Contents.1.ETag'),
            }),
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'second-key-etag' &&
        body.Data['Contents.0.Key'] === 'first-key');
    await (0, runtime_1.handler)(event, {});
    sinon.assert.calledWith(listObjectsFake, {
        Bucket: 'my-bucket',
    });
    expect(request.isDone()).toBeTruthy();
});
test('update event with physical resource id', async () => {
    const publish = sinon.fake.resolves({});
    AWS.mock('SNS', 'publish', publish);
    const event = {
        ...eventCommon,
        RequestType: 'Update',
        PhysicalResourceId: 'physicalResourceId',
        OldResourceProperties: {},
        ResourceProperties: {
            ServiceToken: 'token',
            Update: JSON.stringify({
                service: 'SNS',
                action: 'publish',
                parameters: {
                    Message: 'hello',
                    TopicArn: 'topicarn',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('topicarn'),
            }),
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'topicarn');
    await (0, runtime_1.handler)(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('delete event', async () => {
    const listObjectsFake = sinon.fake.resolves({});
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Delete',
        PhysicalResourceId: 'physicalResourceId',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: JSON.stringify({
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.fromResponse('Contents.1.ETag'),
            }),
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'physicalResourceId' &&
        Object.keys(body.Data).length === 0);
    await (0, runtime_1.handler)(event, {});
    sinon.assert.notCalled(listObjectsFake);
    expect(request.isDone()).toBeTruthy();
});
test('delete event with Delete call and no physical resource id in call', async () => {
    const deleteParameterFake = sinon.fake.resolves({});
    AWS.mock('SSM', 'deleteParameter', deleteParameterFake);
    const event = {
        ...eventCommon,
        RequestType: 'Delete',
        PhysicalResourceId: 'physicalResourceId',
        ResourceProperties: {
            ServiceToken: 'token',
            Delete: JSON.stringify({
                service: 'SSM',
                action: 'deleteParameter',
                parameters: {
                    Name: 'my-param',
                },
            }),
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'physicalResourceId');
    await (0, runtime_1.handler)(event, {});
    sinon.assert.calledWith(deleteParameterFake, {
        Name: 'my-param',
    });
    expect(request.isDone()).toBeTruthy();
});
test('create event with Delete call only', async () => {
    const deleteParameterFake = sinon.fake.resolves({});
    AWS.mock('SSM', 'deleteParameter', deleteParameterFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Delete: JSON.stringify({
                service: 'SSM',
                action: 'deleteParameter',
                parameters: {
                    Name: 'my-param',
                },
            }),
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'logicalResourceId');
    await (0, runtime_1.handler)(event, {});
    sinon.assert.notCalled(deleteParameterFake);
    expect(request.isDone()).toBeTruthy();
});
test('catch errors', async () => {
    const error = new Error();
    error.code = 'NoSuchBucket';
    const listObjectsFake = sinon.fake.rejects(error);
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: JSON.stringify({
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('physicalResourceId'),
                ignoreErrorCodesMatching: 'NoSuchBucket',
            }),
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'physicalResourceId' &&
        Object.keys(body.Data).length === 0);
    await (0, runtime_1.handler)(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('restrict output path', async () => {
    const listObjectsFake = sinon.fake.resolves({
        Contents: [
            {
                Key: 'first-key',
                ETag: 'first-key-etag',
            },
            {
                Key: 'second-key',
                ETag: 'second-key-etag',
            },
        ],
    });
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: JSON.stringify({
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('id'),
                outputPath: 'Contents.0',
            }),
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'id' &&
        body.Data['Contents.0.Key'] === 'first-key' &&
        body.Data['Contents.1.Key'] === undefined);
    await (0, runtime_1.handler)(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('restrict output paths', async () => {
    const listObjectsFake = sinon.fake.resolves({
        Contents: [
            {
                Key: 'first-key',
                ETag: 'first-key-etag',
            },
            {
                Key: 'second-key',
                ETag: 'second-key-etag',
            },
        ],
    });
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: JSON.stringify({
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('id'),
                outputPaths: ['Contents.0.Key', 'Contents.1.Key'],
            }),
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'id' &&
        JSON.stringify(body.Data) === JSON.stringify({
            'Contents.0.Key': 'first-key',
            'Contents.1.Key': 'second-key',
        }));
    await (0, runtime_1.handler)(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('can specify apiVersion and region', async () => {
    const publishFake = sinon.fake.resolves({});
    AWS.mock('SNS', 'publish', publishFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: JSON.stringify({
                service: 'SNS',
                action: 'publish',
                parameters: {
                    Message: 'message',
                    TopicArn: 'topic',
                },
                apiVersion: '2010-03-31',
                region: 'eu-west-1',
                physicalResourceId: lib_1.PhysicalResourceId.of('id'),
            }),
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.Data.apiVersion === '2010-03-31' &&
        body.Data.region === 'eu-west-1');
    await (0, runtime_1.handler)(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('flatten correctly flattens a nested object', () => {
    expect((0, runtime_1.flatten)({
        a: { b: 'c' },
        d: [
            { e: 'f' },
            { g: 'h', i: 1, j: null, k: { l: false } },
        ],
    })).toEqual({
        'a.b': 'c',
        'd.0.e': 'f',
        'd.1.g': 'h',
        'd.1.i': 1,
        'd.1.j': null,
        'd.1.k.l': false,
    });
});
test('flatten correctly flattens an object with buffers', () => {
    expect((0, runtime_1.flatten)({
        body: Buffer.from('body'),
        nested: {
            buffer: Buffer.from('buffer'),
            array: [
                Buffer.from('array.0'),
                Buffer.from('array.1'),
            ],
        },
    })).toEqual({
        'body': 'body',
        'nested.buffer': 'buffer',
        'nested.array.0': 'array.0',
        'nested.array.1': 'array.1',
    });
});
test('installs the latest SDK', async () => {
    const tmpPath = '/tmp/node_modules/aws-sdk';
    // Symlink to normal SDK to be able to call AWS.setSDK()
    await fs.ensureDir('/tmp/node_modules');
    await fs.symlink(require.resolve('aws-sdk'), tmpPath);
    AWS.setSDK(tmpPath);
    // Now remove the symlink and let the handler install it
    await fs.unlink(tmpPath);
    const publishFake = sinon.fake.resolves({});
    AWS.mock('SNS', 'publish', publishFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: JSON.stringify({
                service: 'SNS',
                action: 'publish',
                parameters: {
                    Message: 'message',
                    TopicArn: 'topic',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('id'),
            }),
            InstallLatestAwsSdk: 'true',
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS');
    // Reset to 'false' so that the next run will reinstall aws-sdk
    (0, runtime_1.forceSdkInstallation)();
    await (0, runtime_1.handler)(event, {});
    expect(request.isDone()).toBeTruthy();
    expect(() => require.resolve(tmpPath)).not.toThrow();
    // clean up aws-sdk install
    await fs.remove(tmpPath);
});
test('invalid service name throws explicit error', async () => {
    const publishFake = sinon.fake.resolves({});
    AWS.mock('SNS', 'publish', publishFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: JSON.stringify({
                service: 'thisisnotarealservice',
                action: 'publish',
                parameters: {
                    Message: 'message',
                    TopicArn: 'topic',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('id'),
            }),
        },
    };
    const request = createRequest(body => body.Status === 'FAILED' &&
        body.Reason.startsWith('Service thisisnotarealservice does not exist'));
    await (0, runtime_1.handler)(event, {});
    expect(request.isDone()).toBeTruthy();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXdzLWN1c3RvbS1yZXNvdXJjZS1wcm92aWRlci50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXdzLWN1c3RvbS1yZXNvdXJjZS1wcm92aWRlci50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0Esb0NBQW9DO0FBQ3BDLCtCQUErQjtBQUMvQiw2QkFBNkI7QUFDN0IsK0JBQStCO0FBQy9CLG1DQUEyRDtBQUMzRCxtRUFBK0Y7QUFHL0YsNkVBQTZFO0FBQzdFLGFBQWE7QUFDYixJQUFJLENBQUMsVUFBVSxDQUFDLEtBQU0sQ0FBQyxDQUFDO0FBRXhCLCtCQUErQjtBQUUvQixPQUFPLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUV4QixNQUFNLFdBQVcsR0FBRztJQUNsQixZQUFZLEVBQUUsT0FBTztJQUNyQixXQUFXLEVBQUUsbUJBQW1CO0lBQ2hDLE9BQU8sRUFBRSxTQUFTO0lBQ2xCLFNBQVMsRUFBRSxXQUFXO0lBQ3RCLGlCQUFpQixFQUFFLG1CQUFtQjtJQUN0QyxZQUFZLEVBQUUsYUFBYTtDQUM1QixDQUFDO0FBRUYsU0FBUyxhQUFhLENBQUMsYUFBZ0Y7SUFDckcsT0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUM7U0FDN0IsR0FBRyxDQUFDLEdBQUcsRUFBRSxhQUFhLENBQUM7U0FDdkIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2hCLENBQUM7QUFFRCxVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFDekMsQ0FBQyxDQUFDLENBQUM7QUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO0lBQ2IsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2QsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0FBQ2xCLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLDZDQUE2QyxFQUFF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QUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzNCLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLDRDQUE0QyxFQUFFLEtBQUssSUFBSSxFQUFFO0lBQzVELE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBRTVDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUV4QyxNQUFNLEtBQUssR0FBc0Q7UUFDL0QsR0FBRyxXQUFXO1FBQ2QsV0FBVyxFQUFFLFFBQVE7UUFDckIsa0JBQWtCLEVBQUU7WUFDbEIsWUFBWSxFQUFFLE9BQU87WUFDckIsTUFBTSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7Z0JBQ3JCLE9BQU8sRUFBRSx1QkFBdUI7Z0JBQ2hDLE1BQU0sRUFBRSxTQUFTO2dCQUNqQixVQUFVLEVBQUU7b0JBQ1YsT0FBTyxFQUFFLFNBQVM7b0JBQ2xCLFFBQVEsRUFBRSxPQUFPO2lCQUNsQjtnQkFDRCxrQkFBa0IsRUFBRSx3QkFBa0IsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDO2FBQ2xDLENBQUM7U0FDakI7S0FDRixDQUFDO0lBRUYsTUFBTSxPQUFPLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQ25DLElBQUksQ0FBQyxNQUFNLEtBQUssUUFBUTtRQUN4QixJQUFJLENBQUMsTUFBTyxDQUFDLFVBQVUsQ0FBQyw4Q0FBOEMsQ0FBQyxDQUN4RSxDQUFDO0lBRUYsTUFBTSxJQUFBLGlCQUFPLEVBQUMsS0FBSyxFQUFFLEVBQXVCLENBQUMsQ0FBQztJQUU5QyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7QUFDeEMsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBTREsgZnJvbSAnYXdzLXNkayc7XG5pbXBvcnQgKiBhcyBBV1MgZnJvbSAnYXdzLXNkay1tb2NrJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCAqIGFzIG5vY2sgZnJvbSAnbm9jayc7XG5pbXBvcnQgKiBhcyBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgeyBBd3NTZGtDYWxsLCBQaHlzaWNhbFJlc291cmNlSWQgfSBmcm9tICcuLi8uLi9saWInO1xuaW1wb3J0IHsgZmxhdHRlbiwgaGFuZGxlciwgZm9yY2VTZGtJbnN0YWxsYXRpb24gfSBmcm9tICcuLi8uLi9saWIvYXdzLWN1c3RvbS1yZXNvdXJjZS9ydW50aW1lJztcblxuXG4vLyBUaGlzIHRlc3QgcGVyZm9ybXMgYW4gJ25wbSBpbnN0YWxsJyB3aGljaCBtYXkgdGFrZSBsb25nZXIgdGhhbiB0aGUgZGVmYXVsdFxuLy8gNXMgdGltZW91dFxuamVzdC5zZXRUaW1lb3V0KDYwXzAwMCk7XG5cbi8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi9cblxuY29uc29sZS5sb2cgPSBqZXN0LmZuKCk7XG5cbmNvbnN0IGV2ZW50Q29tbW9uID0ge1xuICBTZXJ2aWNlVG9rZW46ICd0b2tlbicsXG4gIFJlc3BvbnNlVVJMOiAnaHR0cHM6Ly9sb2NhbGhvc3QnLFxuICBTdGFja0lkOiAnc3RhY2tJZCcsXG4gIFJlcXVlc3RJZDogJ3JlcXVlc3RJZCcsXG4gIExvZ2ljYWxSZXNvdXJjZUlkOiAnbG9naWNhbFJlc291cmNlSWQnLFxuICBSZXNvdXJjZVR5cGU6ICdDdXN0b206OkFXUycsXG59O1xuXG5mdW5jdGlvbiBjcmVhdGVSZXF1ZXN0KGJvZHlQcmVkaWNhdGU6IChib2R5OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZVJlc3BvbnNlKSA9PiBib29sZWFuKSB7XG4gIHJldHVybiBub2NrKCdodHRwczovL2xvY2FsaG9zdCcpXG4gICAgLnB1dCgnLycsIGJvZHlQcmVkaWNhdGUpXG4gICAgLnJlcGx5KDIwMCk7XG59XG5cbmJlZm9yZUVhY2goKCkgPT4ge1xuICBBV1Muc2V0U0RLKHJlcXVpcmUucmVzb2x2ZSgnYXdzLXNkaycpKTtcbn0pO1xuXG5hZnRlckVhY2goKCkgPT4ge1xuICBBV1MucmVzdG9yZSgpO1xuICBub2NrLmNsZWFuQWxsKCk7XG59KTtcblxudGVzdCgnY3JlYXRlIGV2ZW50IHdpdGggcGh5c2ljYWwgcmVzb3VyY2UgaWQgcGF0aCcsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgbGlzdE9iamVjdHNGYWtlID0gc2lub24uZmFrZS5yZXNvbHZlcyh7XG4gICAgQ29udGVudHM6IFtcbiAgICAgIHtcbiAgICAgICAgS2V5OiAnZmlyc3Qta2V5JyxcbiAgICAgICAgRVRhZzogJ2ZpcnN0LWtleS1ldGFnJyxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIEtleTogJ3NlY29uZC1rZXknLFxuICAgICAgICBFVGFnOiAnc2Vjb25kLWtleS1ldGFnJyxcbiAgICAgIH0sXG4gICAgXSxcbiAgfSBhcyBTREsuUzMuTGlzdE9iamVjdHNPdXRwdXQpO1xuXG4gIEFXUy5tb2NrKCdTMycsICdsaXN0T2JqZWN0cycsIGxpc3RPYmplY3RzRmFrZSk7XG5cbiAgY29uc3QgZXZlbnQ6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlQ3JlYXRlRXZlbnQgPSB7XG4gICAgLi4uZXZlbnRDb21tb24sXG4gICAgUmVxdWVzdFR5cGU6ICdDcmVhdGUnLFxuICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgU2VydmljZVRva2VuOiAndG9rZW4nLFxuICAgICAgQ3JlYXRlOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHNlcnZpY2U6ICdTMycsXG4gICAgICAgIGFjdGlvbjogJ2xpc3RPYmplY3RzJyxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIEJ1Y2tldDogJ215LWJ1Y2tldCcsXG4gICAgICAgIH0sXG4gICAgICAgIHBoeXNpY2FsUmVzb3VyY2VJZDogUGh5c2ljYWxSZXNvdXJjZUlkLmZyb21SZXNwb25zZSgnQ29udGVudHMuMS5FVGFnJyksXG4gICAgICB9IGFzIEF3c1Nka0NhbGwpLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QoYm9keSA9PlxuICAgIGJvZHkuU3RhdHVzID09PSAnU1VDQ0VTUycgJiZcbiAgICBib2R5LlBoeXNpY2FsUmVzb3VyY2VJZCA9PT0gJ3NlY29uZC1rZXktZXRhZycgJiZcbiAgICBib2R5LkRhdGEhWydDb250ZW50cy4wLktleSddID09PSAnZmlyc3Qta2V5JyxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgobGlzdE9iamVjdHNGYWtlLCB7XG4gICAgQnVja2V0OiAnbXktYnVja2V0JyxcbiAgfSk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCd1cGRhdGUgZXZlbnQgd2l0aCBwaHlzaWNhbCByZXNvdXJjZSBpZCcsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgcHVibGlzaCA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe30pO1xuXG4gIEFXUy5tb2NrKCdTTlMnLCAncHVibGlzaCcsIHB1Ymxpc2gpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZVVwZGF0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnVXBkYXRlJyxcbiAgICBQaHlzaWNhbFJlc291cmNlSWQ6ICdwaHlzaWNhbFJlc291cmNlSWQnLFxuICAgIE9sZFJlc291cmNlUHJvcGVydGllczoge30sXG4gICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiB7XG4gICAgICBTZXJ2aWNlVG9rZW46ICd0b2tlbicsXG4gICAgICBVcGRhdGU6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgc2VydmljZTogJ1NOUycsXG4gICAgICAgIGFjdGlvbjogJ3B1Ymxpc2gnLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgTWVzc2FnZTogJ2hlbGxvJyxcbiAgICAgICAgICBUb3BpY0FybjogJ3RvcGljYXJuJyxcbiAgICAgICAgfSxcbiAgICAgICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBQaHlzaWNhbFJlc291cmNlSWQub2YoJ3RvcGljYXJuJyksXG4gICAgICB9IGFzIEF3c1Nka0NhbGwpLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QoYm9keSA9PlxuICAgIGJvZHkuU3RhdHVzID09PSAnU1VDQ0VTUycgJiZcbiAgICBib2R5LlBoeXNpY2FsUmVzb3VyY2VJZCA9PT0gJ3RvcGljYXJuJyxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCdkZWxldGUgZXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGxpc3RPYmplY3RzRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe30pO1xuXG4gIEFXUy5tb2NrKCdTMycsICdsaXN0T2JqZWN0cycsIGxpc3RPYmplY3RzRmFrZSk7XG5cbiAgY29uc3QgZXZlbnQ6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlRGVsZXRlRXZlbnQgPSB7XG4gICAgLi4uZXZlbnRDb21tb24sXG4gICAgUmVxdWVzdFR5cGU6ICdEZWxldGUnLFxuICAgIFBoeXNpY2FsUmVzb3VyY2VJZDogJ3BoeXNpY2FsUmVzb3VyY2VJZCcsXG4gICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiB7XG4gICAgICBTZXJ2aWNlVG9rZW46ICd0b2tlbicsXG4gICAgICBDcmVhdGU6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgc2VydmljZTogJ1MzJyxcbiAgICAgICAgYWN0aW9uOiAnbGlzdE9iamVjdHMnLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgQnVja2V0OiAnbXktYnVja2V0JyxcbiAgICAgICAgfSxcbiAgICAgICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBQaHlzaWNhbFJlc291cmNlSWQuZnJvbVJlc3BvbnNlKCdDb250ZW50cy4xLkVUYWcnKSxcbiAgICAgIH0gYXMgQXdzU2RrQ2FsbCksXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyAmJlxuICAgIGJvZHkuUGh5c2ljYWxSZXNvdXJjZUlkID09PSAncGh5c2ljYWxSZXNvdXJjZUlkJyAmJlxuICAgIE9iamVjdC5rZXlzKGJvZHkuRGF0YSEpLmxlbmd0aCA9PT0gMCxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgc2lub24uYXNzZXJ0Lm5vdENhbGxlZChsaXN0T2JqZWN0c0Zha2UpO1xuXG4gIGV4cGVjdChyZXF1ZXN0LmlzRG9uZSgpKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnZGVsZXRlIGV2ZW50IHdpdGggRGVsZXRlIGNhbGwgYW5kIG5vIHBoeXNpY2FsIHJlc291cmNlIGlkIGluIGNhbGwnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGRlbGV0ZVBhcmFtZXRlckZha2UgPSBzaW5vbi5mYWtlLnJlc29sdmVzKHt9KTtcblxuICBBV1MubW9jaygnU1NNJywgJ2RlbGV0ZVBhcmFtZXRlcicsIGRlbGV0ZVBhcmFtZXRlckZha2UpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZURlbGV0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnRGVsZXRlJyxcbiAgICBQaHlzaWNhbFJlc291cmNlSWQ6ICdwaHlzaWNhbFJlc291cmNlSWQnLFxuICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgU2VydmljZVRva2VuOiAndG9rZW4nLFxuICAgICAgRGVsZXRlOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHNlcnZpY2U6ICdTU00nLFxuICAgICAgICBhY3Rpb246ICdkZWxldGVQYXJhbWV0ZXInLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgTmFtZTogJ215LXBhcmFtJyxcbiAgICAgICAgfSxcbiAgICAgIH0gYXMgQXdzU2RrQ2FsbCksXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyAmJlxuICAgIGJvZHkuUGh5c2ljYWxSZXNvdXJjZUlkID09PSAncGh5c2ljYWxSZXNvdXJjZUlkJyxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoZGVsZXRlUGFyYW1ldGVyRmFrZSwge1xuICAgIE5hbWU6ICdteS1wYXJhbScsXG4gIH0pO1xuXG4gIGV4cGVjdChyZXF1ZXN0LmlzRG9uZSgpKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnY3JlYXRlIGV2ZW50IHdpdGggRGVsZXRlIGNhbGwgb25seScsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgZGVsZXRlUGFyYW1ldGVyRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe30pO1xuXG4gIEFXUy5tb2NrKCdTU00nLCAnZGVsZXRlUGFyYW1ldGVyJywgZGVsZXRlUGFyYW1ldGVyRmFrZSk7XG5cbiAgY29uc3QgZXZlbnQ6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlQ3JlYXRlRXZlbnQgPSB7XG4gICAgLi4uZXZlbnRDb21tb24sXG4gICAgUmVxdWVzdFR5cGU6ICdDcmVhdGUnLFxuICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgU2VydmljZVRva2VuOiAndG9rZW4nLFxuICAgICAgRGVsZXRlOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHNlcnZpY2U6ICdTU00nLFxuICAgICAgICBhY3Rpb246ICdkZWxldGVQYXJhbWV0ZXInLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgTmFtZTogJ215LXBhcmFtJyxcbiAgICAgICAgfSxcbiAgICAgIH0gYXMgQXdzU2RrQ2FsbCksXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyAmJlxuICAgIGJvZHkuUGh5c2ljYWxSZXNvdXJjZUlkID09PSAnbG9naWNhbFJlc291cmNlSWQnLFxuICApO1xuXG4gIGF3YWl0IGhhbmRsZXIoZXZlbnQsIHt9IGFzIEFXU0xhbWJkYS5Db250ZXh0KTtcblxuICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKGRlbGV0ZVBhcmFtZXRlckZha2UpO1xuXG4gIGV4cGVjdChyZXF1ZXN0LmlzRG9uZSgpKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnY2F0Y2ggZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBlcnJvcjogTm9kZUpTLkVycm5vRXhjZXB0aW9uID0gbmV3IEVycm9yKCk7XG4gIGVycm9yLmNvZGUgPSAnTm9TdWNoQnVja2V0JztcbiAgY29uc3QgbGlzdE9iamVjdHNGYWtlID0gc2lub24uZmFrZS5yZWplY3RzKGVycm9yKTtcblxuICBBV1MubW9jaygnUzMnLCAnbGlzdE9iamVjdHMnLCBsaXN0T2JqZWN0c0Zha2UpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUNyZWF0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgICAgIENyZWF0ZTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBzZXJ2aWNlOiAnUzMnLFxuICAgICAgICBhY3Rpb246ICdsaXN0T2JqZWN0cycsXG4gICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICBCdWNrZXQ6ICdteS1idWNrZXQnLFxuICAgICAgICB9LFxuICAgICAgICBwaHlzaWNhbFJlc291cmNlSWQ6IFBoeXNpY2FsUmVzb3VyY2VJZC5vZigncGh5c2ljYWxSZXNvdXJjZUlkJyksXG4gICAgICAgIGlnbm9yZUVycm9yQ29kZXNNYXRjaGluZzogJ05vU3VjaEJ1Y2tldCcsXG4gICAgICB9IGFzIEF3c1Nka0NhbGwpLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QoYm9keSA9PlxuICAgIGJvZHkuU3RhdHVzID09PSAnU1VDQ0VTUycgJiZcbiAgICBib2R5LlBoeXNpY2FsUmVzb3VyY2VJZCA9PT0gJ3BoeXNpY2FsUmVzb3VyY2VJZCcgJiZcbiAgICBPYmplY3Qua2V5cyhib2R5LkRhdGEhKS5sZW5ndGggPT09IDAsXG4gICk7XG5cbiAgYXdhaXQgaGFuZGxlcihldmVudCwge30gYXMgQVdTTGFtYmRhLkNvbnRleHQpO1xuXG4gIGV4cGVjdChyZXF1ZXN0LmlzRG9uZSgpKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgncmVzdHJpY3Qgb3V0cHV0IHBhdGgnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGxpc3RPYmplY3RzRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe1xuICAgIENvbnRlbnRzOiBbXG4gICAgICB7XG4gICAgICAgIEtleTogJ2ZpcnN0LWtleScsXG4gICAgICAgIEVUYWc6ICdmaXJzdC1rZXktZXRhZycsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBLZXk6ICdzZWNvbmQta2V5JyxcbiAgICAgICAgRVRhZzogJ3NlY29uZC1rZXktZXRhZycsXG4gICAgICB9LFxuICAgIF0sXG4gIH0gYXMgU0RLLlMzLkxpc3RPYmplY3RzT3V0cHV0KTtcblxuICBBV1MubW9jaygnUzMnLCAnbGlzdE9iamVjdHMnLCBsaXN0T2JqZWN0c0Zha2UpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUNyZWF0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgICAgIENyZWF0ZTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBzZXJ2aWNlOiAnUzMnLFxuICAgICAgICBhY3Rpb246ICdsaXN0T2JqZWN0cycsXG4gICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICBCdWNrZXQ6ICdteS1idWNrZXQnLFxuICAgICAgICB9LFxuICAgICAgICBwaHlzaWNhbFJlc291cmNlSWQ6IFBoeXNpY2FsUmVzb3VyY2VJZC5vZignaWQnKSxcbiAgICAgICAgb3V0cHV0UGF0aDogJ0NvbnRlbnRzLjAnLFxuICAgICAgfSBhcyBBd3NTZGtDYWxsKSxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KGJvZHkgPT5cbiAgICBib2R5LlN0YXR1cyA9PT0gJ1NVQ0NFU1MnICYmXG4gICAgYm9keS5QaHlzaWNhbFJlc291cmNlSWQgPT09ICdpZCcgJiZcbiAgICBib2R5LkRhdGEhWydDb250ZW50cy4wLktleSddID09PSAnZmlyc3Qta2V5JyAmJlxuICAgIGJvZHkuRGF0YSFbJ0NvbnRlbnRzLjEuS2V5J10gPT09IHVuZGVmaW5lZCxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCdyZXN0cmljdCBvdXRwdXQgcGF0aHMnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGxpc3RPYmplY3RzRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe1xuICAgIENvbnRlbnRzOiBbXG4gICAgICB7XG4gICAgICAgIEtleTogJ2ZpcnN0LWtleScsXG4gICAgICAgIEVUYWc6ICdmaXJzdC1rZXktZXRhZycsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBLZXk6ICdzZWNvbmQta2V5JyxcbiAgICAgICAgRVRhZzogJ3NlY29uZC1rZXktZXRhZycsXG4gICAgICB9LFxuICAgIF0sXG4gIH0gYXMgU0RLLlMzLkxpc3RPYmplY3RzT3V0cHV0KTtcblxuICBBV1MubW9jaygnUzMnLCAnbGlzdE9iamVjdHMnLCBsaXN0T2JqZWN0c0Zha2UpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUNyZWF0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgICAgIENyZWF0ZTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBzZXJ2aWNlOiAnUzMnLFxuICAgICAgICBhY3Rpb246ICdsaXN0T2JqZWN0cycsXG4gICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICBCdWNrZXQ6ICdteS1idWNrZXQnLFxuICAgICAgICB9LFxuICAgICAgICBwaHlzaWNhbFJlc291cmNlSWQ6IFBoeXNpY2FsUmVzb3VyY2VJZC5vZignaWQnKSxcbiAgICAgICAgb3V0cHV0UGF0aHM6IFsnQ29udGVudHMuMC5LZXknLCAnQ29udGVudHMuMS5LZXknXSxcbiAgICAgIH0gYXMgQXdzU2RrQ2FsbCksXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyAmJlxuICAgIGJvZHkuUGh5c2ljYWxSZXNvdXJjZUlkID09PSAnaWQnICYmXG4gICAgSlNPTi5zdHJpbmdpZnkoYm9keS5EYXRhKSA9PT0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgJ0NvbnRlbnRzLjAuS2V5JzogJ2ZpcnN0LWtleScsXG4gICAgICAnQ29udGVudHMuMS5LZXknOiAnc2Vjb25kLWtleScsXG4gICAgfSksXG4gICk7XG5cbiAgYXdhaXQgaGFuZGxlcihldmVudCwge30gYXMgQVdTTGFtYmRhLkNvbnRleHQpO1xuXG4gIGV4cGVjdChyZXF1ZXN0LmlzRG9uZSgpKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnY2FuIHNwZWNpZnkgYXBpVmVyc2lvbiBhbmQgcmVnaW9uJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBwdWJsaXNoRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe30pO1xuXG4gIEFXUy5tb2NrKCdTTlMnLCAncHVibGlzaCcsIHB1Ymxpc2hGYWtlKTtcblxuICBjb25zdCBldmVudDogQVdTTGFtYmRhLkNsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VDcmVhdGVFdmVudCA9IHtcbiAgICAuLi5ldmVudENvbW1vbixcbiAgICBSZXF1ZXN0VHlwZTogJ0NyZWF0ZScsXG4gICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiB7XG4gICAgICBTZXJ2aWNlVG9rZW46ICd0b2tlbicsXG4gICAgICBDcmVhdGU6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgc2VydmljZTogJ1NOUycsXG4gICAgICAgIGFjdGlvbjogJ3B1Ymxpc2gnLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgTWVzc2FnZTogJ21lc3NhZ2UnLFxuICAgICAgICAgIFRvcGljQXJuOiAndG9waWMnLFxuICAgICAgICB9LFxuICAgICAgICBhcGlWZXJzaW9uOiAnMjAxMC0wMy0zMScsXG4gICAgICAgIHJlZ2lvbjogJ2V1LXdlc3QtMScsXG4gICAgICAgIHBoeXNpY2FsUmVzb3VyY2VJZDogUGh5c2ljYWxSZXNvdXJjZUlkLm9mKCdpZCcpLFxuICAgICAgfSBhcyBBd3NTZGtDYWxsKSxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KGJvZHkgPT5cbiAgICBib2R5LlN0YXR1cyA9PT0gJ1NVQ0NFU1MnICYmXG4gICAgYm9keS5EYXRhIS5hcGlWZXJzaW9uID09PSAnMjAxMC0wMy0zMScgJiZcbiAgICBib2R5LkRhdGEhLnJlZ2lvbiA9PT0gJ2V1LXdlc3QtMScsXG4gICk7XG5cbiAgYXdhaXQgaGFuZGxlcihldmVudCwge30gYXMgQVdTTGFtYmRhLkNvbnRleHQpO1xuXG4gIGV4cGVjdChyZXF1ZXN0LmlzRG9uZSgpKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnZmxhdHRlbiBjb3JyZWN0bHkgZmxhdHRlbnMgYSBuZXN0ZWQgb2JqZWN0JywgKCkgPT4ge1xuICBleHBlY3QoZmxhdHRlbih7XG4gICAgYTogeyBiOiAnYycgfSxcbiAgICBkOiBbXG4gICAgICB7IGU6ICdmJyB9LFxuICAgICAgeyBnOiAnaCcsIGk6IDEsIGo6IG51bGwsIGs6IHsgbDogZmFsc2UgfSB9LFxuICAgIF0sXG4gIH0pKS50b0VxdWFsKHtcbiAgICAnYS5iJzogJ2MnLFxuICAgICdkLjAuZSc6ICdmJyxcbiAgICAnZC4xLmcnOiAnaCcsXG4gICAgJ2QuMS5pJzogMSxcbiAgICAnZC4xLmonOiBudWxsLFxuICAgICdkLjEuay5sJzogZmFsc2UsXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2ZsYXR0ZW4gY29ycmVjdGx5IGZsYXR0ZW5zIGFuIG9iamVjdCB3aXRoIGJ1ZmZlcnMnLCAoKSA9PiB7XG4gIGV4cGVjdChmbGF0dGVuKHtcbiAgICBib2R5OiBCdWZmZXIuZnJvbSgnYm9keScpLFxuICAgIG5lc3RlZDoge1xuICAgICAgYnVmZmVyOiBCdWZmZXIuZnJvbSgnYnVmZmVyJyksXG4gICAgICBhcnJheTogW1xuICAgICAgICBCdWZmZXIuZnJvbSgnYXJyYXkuMCcpLFxuICAgICAgICBCdWZmZXIuZnJvbSgnYXJyYXkuMScpLFxuICAgICAgXSxcbiAgICB9LFxuICB9KSkudG9FcXVhbCh7XG4gICAgJ2JvZHknOiAnYm9keScsXG4gICAgJ25lc3RlZC5idWZmZXInOiAnYnVmZmVyJyxcbiAgICAnbmVzdGVkLmFycmF5LjAnOiAnYXJyYXkuMCcsXG4gICAgJ25lc3RlZC5hcnJheS4xJzogJ2FycmF5LjEnLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdpbnN0YWxscyB0aGUgbGF0ZXN0IFNESycsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgdG1wUGF0aCA9ICcvdG1wL25vZGVfbW9kdWxlcy9hd3Mtc2RrJztcblxuICAvLyBTeW1saW5rIHRvIG5vcm1hbCBTREsgdG8gYmUgYWJsZSB0byBjYWxsIEFXUy5zZXRTREsoKVxuICBhd2FpdCBmcy5lbnN1cmVEaXIoJy90bXAvbm9kZV9tb2R1bGVzJyk7XG4gIGF3YWl0IGZzLnN5bWxpbmsocmVxdWlyZS5yZXNvbHZlKCdhd3Mtc2RrJyksIHRtcFBhdGgpO1xuICBBV1Muc2V0U0RLKHRtcFBhdGgpO1xuXG4gIC8vIE5vdyByZW1vdmUgdGhlIHN5bWxpbmsgYW5kIGxldCB0aGUgaGFuZGxlciBpbnN0YWxsIGl0XG4gIGF3YWl0IGZzLnVubGluayh0bXBQYXRoKTtcblxuICBjb25zdCBwdWJsaXNoRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe30pO1xuXG4gIEFXUy5tb2NrKCdTTlMnLCAncHVibGlzaCcsIHB1Ymxpc2hGYWtlKTtcblxuICBjb25zdCBldmVudDogQVdTTGFtYmRhLkNsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VDcmVhdGVFdmVudCA9IHtcbiAgICAuLi5ldmVudENvbW1vbixcbiAgICBSZXF1ZXN0VHlwZTogJ0NyZWF0ZScsXG4gICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiB7XG4gICAgICBTZXJ2aWNlVG9rZW46ICd0b2tlbicsXG4gICAgICBDcmVhdGU6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgc2VydmljZTogJ1NOUycsXG4gICAgICAgIGFjdGlvbjogJ3B1Ymxpc2gnLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgTWVzc2FnZTogJ21lc3NhZ2UnLFxuICAgICAgICAgIFRvcGljQXJuOiAndG9waWMnLFxuICAgICAgICB9LFxuICAgICAgICBwaHlzaWNhbFJlc291cmNlSWQ6IFBoeXNpY2FsUmVzb3VyY2VJZC5vZignaWQnKSxcbiAgICAgIH0gYXMgQXdzU2RrQ2FsbCksXG4gICAgICBJbnN0YWxsTGF0ZXN0QXdzU2RrOiAndHJ1ZScsXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyxcbiAgKTtcblxuICAvLyBSZXNldCB0byAnZmFsc2UnIHNvIHRoYXQgdGhlIG5leHQgcnVuIHdpbGwgcmVpbnN0YWxsIGF3cy1zZGtcbiAgZm9yY2VTZGtJbnN0YWxsYXRpb24oKTtcbiAgYXdhaXQgaGFuZGxlcihldmVudCwge30gYXMgQVdTTGFtYmRhLkNvbnRleHQpO1xuXG4gIGV4cGVjdChyZXF1ZXN0LmlzRG9uZSgpKS50b0JlVHJ1dGh5KCk7XG5cbiAgZXhwZWN0KCgpID0+IHJlcXVpcmUucmVzb2x2ZSh0bXBQYXRoKSkubm90LnRvVGhyb3coKTtcblxuICAvLyBjbGVhbiB1cCBhd3Mtc2RrIGluc3RhbGxcbiAgYXdhaXQgZnMucmVtb3ZlKHRtcFBhdGgpO1xufSk7XG5cbnRlc3QoJ2ludmFsaWQgc2VydmljZSBuYW1lIHRocm93cyBleHBsaWNpdCBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgcHVibGlzaEZha2UgPSBzaW5vbi5mYWtlLnJlc29sdmVzKHt9KTtcblxuICBBV1MubW9jaygnU05TJywgJ3B1Ymxpc2gnLCBwdWJsaXNoRmFrZSk7XG5cbiAgY29uc3QgZXZlbnQ6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlQ3JlYXRlRXZlbnQgPSB7XG4gICAgLi4uZXZlbnRDb21tb24sXG4gICAgUmVxdWVzdFR5cGU6ICdDcmVhdGUnLFxuICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgU2VydmljZVRva2VuOiAndG9rZW4nLFxuICAgICAgQ3JlYXRlOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHNlcnZpY2U6ICd0aGlzaXNub3RhcmVhbHNlcnZpY2UnLFxuICAgICAgICBhY3Rpb246ICdwdWJsaXNoJyxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIE1lc3NhZ2U6ICdtZXNzYWdlJyxcbiAgICAgICAgICBUb3BpY0FybjogJ3RvcGljJyxcbiAgICAgICAgfSxcbiAgICAgICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBQaHlzaWNhbFJlc291cmNlSWQub2YoJ2lkJyksXG4gICAgICB9IGFzIEF3c1Nka0NhbGwpLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QoYm9keSA9PlxuICAgIGJvZHkuU3RhdHVzID09PSAnRkFJTEVEJyAmJlxuICAgIGJvZHkuUmVhc29uIS5zdGFydHNXaXRoKCdTZXJ2aWNlIHRoaXNpc25vdGFyZWFsc2VydmljZSBkb2VzIG5vdCBleGlzdCcpLFxuICApO1xuXG4gIGF3YWl0IGhhbmRsZXIoZXZlbnQsIHt9IGFzIEFXU0xhbWJkYS5Db250ZXh0KTtcblxuICBleHBlY3QocmVxdWVzdC5pc0RvbmUoKSkudG9CZVRydXRoeSgpO1xufSk7XG5cbiJdfQ==