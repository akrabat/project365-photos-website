"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* eslint-disable max-len */
/* eslint-disable no-console */
/* eslint-disable @typescript-eslint/no-require-imports */
const mocks = require("./mocks");
const cfnResponse = require("../../lib/provider-framework/runtime/cfn-response");
const framework = require("../../lib/provider-framework/runtime/framework");
const outbound = require("../../lib/provider-framework/runtime/outbound");
console.log = jest.fn();
cfnResponse.includeStackTraces = false;
const MOCK_PHYSICAL_ID = 'mock-physical-resource-id';
const MOCK_PROPS = { Name: 'Value', List: ['1', '2', '3'], ServiceToken: 'bla' };
const MOCK_ATTRS = { MyAttribute: 'my-mock-attribute' };
outbound.httpRequest = mocks.httpRequestMock;
outbound.invokeFunction = mocks.invokeFunctionMock;
outbound.startExecution = mocks.startExecutionMock;
const invokeFunctionSpy = jest.spyOn(outbound, 'invokeFunction');
beforeEach(() => mocks.setup());
afterEach(() => invokeFunctionSpy.mockClear());
test('async flow: isComplete returns true only after 3 times', async () => {
    let isCompleteCalls = 0;
    mocks.onEventImplMock = async (event) => {
        expect(event.RequestType).toEqual('Create');
        expect(event.ResourceProperties).toStrictEqual(MOCK_PROPS);
        expect(event.PhysicalResourceId).toBeUndefined(); // physical ID in CREATE
        return {
            PhysicalResourceId: MOCK_PHYSICAL_ID,
            Data: MOCK_ATTRS,
            ArbitraryField: 1234,
        };
    };
    mocks.isCompleteImplMock = async (event) => {
        isCompleteCalls++;
        expect(event.ArbitraryField).toEqual(1234); // any field is passed through
        expect(event.PhysicalResourceId).toEqual(MOCK_PHYSICAL_ID); // physical ID returned from onEvent is passed to "isComplete"
        expect(event.Data).toStrictEqual(MOCK_ATTRS); // attributes are propagated between the calls
        const result = isCompleteCalls === 3;
        if (!result) {
            return {
                IsComplete: false,
            };
        }
        return {
            IsComplete: true,
            Data: {
                Additional: 'attribute', // additional attributes can be returned from "isComplete"
            },
        };
    };
    // WHEN
    await simulateEvent({
        RequestType: 'Create',
        ResourceProperties: MOCK_PROPS,
    });
    // THEN
    expect(isCompleteCalls).toEqual(3);
    expectCloudFormationSuccess({
        PhysicalResourceId: MOCK_PHYSICAL_ID,
        Data: {
            ...MOCK_ATTRS,
            Additional: 'attribute',
        },
    });
});
test('isComplete throws in the first invocation', async () => {
    // GIVEN
    mocks.onEventImplMock = async () => ({ PhysicalResourceId: MOCK_PHYSICAL_ID });
    mocks.isCompleteImplMock = async () => { throw new Error('Some failure'); };
    // WHEN
    await simulateEvent({
        RequestType: 'Create',
        ResourceProperties: MOCK_PROPS,
    });
    expectCloudFormationFailed('Some failure\n\nLogs: /aws/lambda/complete\n');
});
test('fails gracefully if "onEvent" throws an error', async () => {
    // GIVEN
    mocks.onEventImplMock = async () => { throw new Error('error thrown during onEvent'); };
    mocks.isCompleteImplMock = async () => ({ IsComplete: true });
    // WHEN
    await simulateEvent({
        RequestType: 'Create',
    });
    // THEN
    expectCloudFormationFailed('error thrown during onEvent\n\nLogs: /aws/lambda/event\n');
    expectNoWaiter();
});
describe('PhysicalResourceId', () => {
    describe('if not omitted from onEvent result', () => {
        it('defaults to RequestId for CREATE', async () => {
            // WHEN
            mocks.onEventImplMock = async () => undefined;
            // THEN
            await simulateEvent({
                RequestType: 'Create',
            });
            expectCloudFormationSuccess({
                PhysicalResourceId: mocks.MOCK_REQUEST.RequestId,
            });
        });
        it('defaults to the current PhysicalResourceId for UPDATE', async () => {
            // WHEN
            mocks.onEventImplMock = async () => undefined;
            // THEN
            await simulateEvent({
                RequestType: 'Update',
                PhysicalResourceId: MOCK_PHYSICAL_ID,
            });
            expectCloudFormationSuccess({
                PhysicalResourceId: MOCK_PHYSICAL_ID,
            });
        });
        it('defaults to the current PhysicalResourceId for DELETE', async () => {
            // WHEN
            mocks.onEventImplMock = async () => undefined;
            // THEN
            await simulateEvent({
                RequestType: 'Delete',
                PhysicalResourceId: MOCK_PHYSICAL_ID,
            });
            expectCloudFormationSuccess({
                PhysicalResourceId: MOCK_PHYSICAL_ID,
            });
        });
    });
    test('UPDATE: can change the physical ID by returning a new ID', async () => {
        // GIVEN
        mocks.onEventImplMock = async () => ({ PhysicalResourceId: 'NewPhysicalId' });
        mocks.isCompleteImplMock = async () => ({ IsComplete: true });
        // WHEN
        await simulateEvent({
            RequestType: 'Update',
            PhysicalResourceId: 'CurrentPhysicalId',
        });
        // THEN
        expectCloudFormationSuccess({
            PhysicalResourceId: 'NewPhysicalId',
        });
    });
    test('UPDATE: can override the physical ID with the actual on isComplete', async () => {
        // GIVEN
        mocks.onEventImplMock = async () => ({ PhysicalResourceId: 'TemporaryPhysicalId' });
        mocks.isCompleteImplMock = async () => ({ IsComplete: true, PhysicalResourceId: 'NewPhysicalId' });
        // WHEN
        await simulateEvent({
            RequestType: 'Update',
            PhysicalResourceId: 'CurrentPhysicalId',
        });
        // THEN
        expectCloudFormationSuccess({
            PhysicalResourceId: 'NewPhysicalId',
        });
    });
    test('DELETE: cannot change the physical resource ID during a delete', async () => {
        // GIVEN
        mocks.onEventImplMock = async () => ({ PhysicalResourceId: 'NewPhysicalId' });
        mocks.isCompleteImplMock = async () => ({ IsComplete: true });
        // WHEN
        await simulateEvent({
            RequestType: 'Delete',
            PhysicalResourceId: 'CurrentPhysicalId',
        });
        // THEN
        expectNoWaiter();
        expectCloudFormationFailed('DELETE: cannot change the physical resource ID from "CurrentPhysicalId" to "NewPhysicalId" during deletion');
    });
});
test('isComplete always returns "false" and then a timeout occurs', async () => {
    // GIVEN
    mocks.onEventImplMock = async () => ({ Data: { Foo: 123 }, PhysicalResourceId: MOCK_PHYSICAL_ID });
    mocks.isCompleteImplMock = async () => ({ IsComplete: false });
    // WHEN
    await simulateEvent({
        RequestType: 'Update',
        PhysicalResourceId: MOCK_PHYSICAL_ID,
    });
    // THEN
    expectCloudFormationFailed('Operation timed out');
});
test('isComplete: "Data" is not allowed if InComplete is "False"', async () => {
    // GIVEN
    mocks.onEventImplMock = async () => ({ Data: { Foo: 123 }, PhysicalResourceId: MOCK_PHYSICAL_ID });
    mocks.isCompleteImplMock = async () => ({ IsComplete: false, Data: { Foo: 3333 } });
    // WHEN
    await simulateEvent({
        RequestType: 'Update',
        PhysicalResourceId: MOCK_PHYSICAL_ID,
    });
    expectCloudFormationFailed('"Data" is not allowed if "IsComplete" is "False"');
});
test('if there is no user-defined "isComplete", the waiter will not be triggered or needed', async () => {
    // GIVEN
    mocks.onEventImplMock = async () => ({ PhysicalResourceId: MOCK_PHYSICAL_ID });
    // WHEN
    await simulateEvent({
        RequestType: 'Create',
    });
    // THEN
    expectNoWaiter();
    expectCloudFormationSuccess({ PhysicalResourceId: MOCK_PHYSICAL_ID });
});
describe('NoEcho', () => {
    test('with onEvent', async () => {
        // GIVEN
        mocks.onEventImplMock = async () => ({
            Data: {
                Very: 'Sensitive',
            },
            NoEcho: true,
        });
        // WHEN
        await simulateEvent({
            RequestType: 'Create',
        });
        // THEN
        expectCloudFormationSuccess({
            Data: {
                Very: 'Sensitive',
            },
            NoEcho: true,
        });
    });
    test('with isComplete', async () => {
        // GIVEN
        mocks.onEventImplMock = async () => ({
            Data: {
                Very: 'Sensitive',
            },
            NoEcho: true,
        });
        mocks.isCompleteImplMock = async () => ({
            Data: {
                Also: 'Confidential',
            },
            IsComplete: true,
        });
        // WHEN
        await simulateEvent({
            RequestType: 'Create',
        });
        // THEN
        expectCloudFormationSuccess({
            Data: {
                Very: 'Sensitive',
                Also: 'Confidential',
            },
            NoEcho: true,
        });
    });
});
test('fails if user handler returns a non-object response', async () => {
    // GIVEN
    mocks.stringifyPayload = false;
    mocks.onEventImplMock = async () => 'string';
    // WHEN
    await simulateEvent({ RequestType: 'Create' });
    // THEN
    expectCloudFormationFailed('return values from user-handlers must be JSON objects. got: \"string\"');
});
describe('if CREATE fails, the subsequent DELETE will be ignored', () => {
    it('FAILED response sets PhysicalResourceId to a special marker', async () => {
        // WHEN
        mocks.onEventImplMock = async () => { throw new Error('CREATE FAILED'); };
        // THEN
        await simulateEvent({
            RequestType: 'Create',
        });
        expectCloudFormationFailed('CREATE FAILED\n\nLogs: /aws/lambda/event\n', {
            PhysicalResourceId: cfnResponse.CREATE_FAILED_PHYSICAL_ID_MARKER,
        });
    });
    it('DELETE request with the marker succeeds without calling user handler', async () => {
        // GIVEN
        // user handler is not assigned
        // WHEN
        await simulateEvent({
            RequestType: 'Delete',
            PhysicalResourceId: cfnResponse.CREATE_FAILED_PHYSICAL_ID_MARKER,
        });
        // THEN
        expectCloudFormationSuccess();
    });
});
describe('ResponseURL is passed to user function', () => {
    test('for onEvent', async () => {
        // GIVEN
        mocks.onEventImplMock = async () => ({ PhysicalResourceId: MOCK_PHYSICAL_ID });
        // WHEN
        await simulateEvent({
            RequestType: 'Create',
        });
        // THEN
        expect(invokeFunctionSpy).toHaveBeenCalledTimes(1);
        expect(invokeFunctionSpy).toBeCalledWith(expect.objectContaining({
            Payload: expect.stringContaining(`"ResponseURL":"${mocks.MOCK_REQUEST.ResponseURL}"`),
        }));
    });
    test('for isComplete', async () => {
        // GIVEN
        mocks.onEventImplMock = async () => ({ PhysicalResourceId: MOCK_PHYSICAL_ID });
        mocks.isCompleteImplMock = async () => ({ IsComplete: true });
        // WHEN
        await simulateEvent({
            RequestType: 'Create',
        });
        // THEN
        expect(invokeFunctionSpy).toHaveBeenCalledTimes(2);
        expect(invokeFunctionSpy).toHaveBeenLastCalledWith(expect.objectContaining({
            Payload: expect.stringContaining(`"ResponseURL":"${mocks.MOCK_REQUEST.ResponseURL}"`),
        }));
    });
});
// -----------------------------------------------------------------------------------------------------------------------
/**
 * Triggers the custom resource lifecycle event flow by invoking the framework's
 * onEvent function and then, if the waiter state machine was started, simulates
 * the waiter and invokes isComplete and onTimeout as appropriate.
 */
async function simulateEvent(req) {
    const x = {
        ServiceToken: 'SERVICE-TOKEN',
        ResponseURL: mocks.MOCK_REQUEST.ResponseURL,
        StackId: mocks.MOCK_REQUEST.StackId,
        RequestId: mocks.MOCK_REQUEST.RequestId,
        ResourceType: 'Custom::TestResource',
        LogicalResourceId: mocks.MOCK_REQUEST.LogicalResourceId,
        ...req,
    };
    mocks.prepareForExecution();
    await framework.onEvent(x);
    // if the FSM
    if (mocks.startStateMachineInput && mocks.startStateMachineInput.stateMachineArn === mocks.MOCK_SFN_ARN) {
        await simulateWaiter(JSON.parse(mocks.startStateMachineInput.input));
    }
    async function simulateWaiter(event) {
        let retry = true;
        let count = 5;
        while (retry) {
            try {
                await framework.isComplete(event);
                retry = false;
            }
            catch (e) {
                if (e instanceof cfnResponse.Retry) {
                    if (count-- === 0) {
                        await framework.onTimeout({ Cause: JSON.stringify({ errorMessage: e.message }) });
                        retry = false;
                    }
                    else {
                        retry = true;
                        continue;
                    }
                }
                else {
                    throw new Error(e);
                }
            }
        }
    }
}
function expectCloudFormationFailed(expectedReason, resp) {
    expectCloudFormationResponse({
        Status: 'FAILED',
        Reason: expectedReason,
        ...resp,
    });
}
function expectCloudFormationSuccess(resp) {
    if (mocks.cfnResponse.Status !== 'SUCCESS') {
        console.error(mocks.cfnResponse.Reason || '<NO REASON>');
    }
    expectCloudFormationResponse({ Status: 'SUCCESS', ...resp });
}
function expectCloudFormationResponse(resp = {}) {
    for (const [key, expected] of Object.entries(resp)) {
        const actual = mocks.cfnResponse[key];
        expect(actual).toStrictEqual(expected);
    }
}
function expectNoWaiter() {
    expect(mocks.startStateMachineInput).toBeUndefined();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnVudGltZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicnVudGltZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsNEJBQTRCO0FBQzVCLCtCQUErQjtBQUMvQiwwREFBMEQ7QUFDMUQsaUNBQWtDO0FBQ2xDLGlGQUFrRjtBQUNsRiw0RUFBNkU7QUFDN0UsMEVBQTJFO0FBRTNFLE9BQU8sQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBRXhCLFdBQVcsQ0FBQyxrQkFBa0IsR0FBRyxLQUFLLENBQUM7QUFFdkMsTUFBTSxnQkFBZ0IsR0FBRywyQkFBMkIsQ0FBQztBQUNyRCxNQUFNLFVBQVUsR0FBRyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLENBQUM7QUFDakYsTUFBTSxVQUFVLEdBQUcsRUFBRSxXQUFXLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQztBQUV4RCxRQUFRLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxlQUFlLENBQUM7QUFDN0MsUUFBUSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUMsa0JBQWtCLENBQUM7QUFDbkQsUUFBUSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUMsa0JBQWtCLENBQUM7QUFFbkQsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0FBRWpFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztBQUNoQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsaUJBQWlCLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztBQUUvQyxJQUFJLENBQUMsd0RBQXdELEVBQUUsS0FBSyxJQUFJLEVBQUU7SUFDeEUsSUFBSSxlQUFlLEdBQUcsQ0FB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TSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUNsRCxNQUFNLE1BQU0sR0FBSSxLQUFLLENBQUMsV0FBbUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMvQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxDQUFDLFFBQWUsQ0FBQyxDQUFDO0tBQy9DO0FBQ0gsQ0FBQztBQUVELFNBQVMsY0FBYztJQUNyQixNQUFNLENBQUMsS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7QUFDdkQsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG1heC1sZW4gKi9cbi8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi9cbi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1yZXF1aXJlLWltcG9ydHMgKi9cbmltcG9ydCBtb2NrcyA9IHJlcXVpcmUoJy4vbW9ja3MnKTtcbmltcG9ydCBjZm5SZXNwb25zZSA9IHJlcXVpcmUoJy4uLy4uL2xpYi9wcm92aWRlci1mcmFtZXdvcmsvcnVudGltZS9jZm4tcmVzcG9uc2UnKTtcbmltcG9ydCBmcmFtZXdvcmsgPSByZXF1aXJlKCcuLi8uLi9saWIvcHJvdmlkZXItZnJhbWV3b3JrL3J1bnRpbWUvZnJhbWV3b3JrJyk7XG5pbXBvcnQgb3V0Ym91bmQgPSByZXF1aXJlKCcuLi8uLi9saWIvcHJvdmlkZXItZnJhbWV3b3JrL3J1bnRpbWUvb3V0Ym91bmQnKTtcblxuY29uc29sZS5sb2cgPSBqZXN0LmZuKCk7XG5cbmNmblJlc3BvbnNlLmluY2x1ZGVTdGFja1RyYWNlcyA9IGZhbHNlO1xuXG5jb25zdCBNT0NLX1BIWVNJQ0FMX0lEID0gJ21vY2stcGh5c2ljYWwtcmVzb3VyY2UtaWQnO1xuY29uc3QgTU9DS19QUk9QUyA9IHsgTmFtZTogJ1ZhbHVlJywgTGlzdDogWycxJywgJzInLCAnMyddLCBTZXJ2aWNlVG9rZW46ICdibGEnIH07XG5jb25zdCBNT0NLX0FUVFJTID0geyBNeUF0dHJpYnV0ZTogJ215LW1vY2stYXR0cmlidXRlJyB9O1xuXG5vdXRib3VuZC5odHRwUmVxdWVzdCA9IG1vY2tzLmh0dHBSZXF1ZXN0TW9jaztcbm91dGJvdW5kLmludm9rZUZ1bmN0aW9uID0gbW9ja3MuaW52b2tlRnVuY3Rpb25Nb2NrO1xub3V0Ym91bmQuc3RhcnRFeGVjdXRpb24gPSBtb2Nrcy5zdGFydEV4ZWN1dGlvbk1vY2s7XG5cbmNvbnN0IGludm9rZUZ1bmN0aW9uU3B5ID0gamVzdC5zcHlPbihvdXRib3VuZCwgJ2ludm9rZUZ1bmN0aW9uJyk7XG5cbmJlZm9yZUVhY2goKCkgPT4gbW9ja3Muc2V0dXAoKSk7XG5hZnRlckVhY2goKCkgPT4gaW52b2tlRnVuY3Rpb25TcHkubW9ja0NsZWFyKCkpO1xuXG50ZXN0KCdhc3luYyBmbG93OiBpc0NvbXBsZXRlIHJldHVybnMgdHJ1ZSBvbmx5IGFmdGVyIDMgdGltZXMnLCBhc3luYyAoKSA9PiB7XG4gIGxldCBpc0NvbXBsZXRlQ2FsbHMgPSAwO1xuXG4gIG1vY2tzLm9uRXZlbnRJbXBsTW9jayA9IGFzeW5jIGV2ZW50ID0+IHtcbiAgICBleHBlY3QoZXZlbnQuUmVxdWVzdFR5cGUpLnRvRXF1YWwoJ0NyZWF0ZScpO1xuICAgIGV4cGVjdChldmVudC5SZXNvdXJjZVByb3BlcnRpZXMpLnRvU3RyaWN0RXF1YWwoTU9DS19QUk9QUyk7XG4gICAgZXhwZWN0KGV2ZW50LlBoeXNpY2FsUmVzb3VyY2VJZCkudG9CZVVuZGVmaW5lZCgpOyAvLyBwaHlzaWNhbCBJRCBpbiBDUkVBVEVcblxuICAgIHJldHVybiB7XG4gICAgICBQaHlzaWNhbFJlc291cmNlSWQ6IE1PQ0tfUEhZU0lDQUxfSUQsXG4gICAgICBEYXRhOiBNT0NLX0FUVFJTLFxuICAgICAgQXJiaXRyYXJ5RmllbGQ6IDEyMzQsXG4gICAgfTtcbiAgfTtcblxuICBtb2Nrcy5pc0NvbXBsZXRlSW1wbE1vY2sgPSBhc3luYyBldmVudCA9PiB7XG4gICAgaXNDb21wbGV0ZUNhbGxzKys7XG4gICAgZXhwZWN0KChldmVudCBhcyBhbnkpLkFyYml0cmFyeUZpZWxkKS50b0VxdWFsKDEyMzQpOyAvLyBhbnkgZmllbGQgaXMgcGFzc2VkIHRocm91Z2hcbiAgICBleHBlY3QoZXZlbnQuUGh5c2ljYWxSZXNvdXJjZUlkKS50b0VxdWFsKE1PQ0tfUEhZU0lDQUxfSUQpOyAvLyBwaHlzaWNhbCBJRCByZXR1cm5lZCBmcm9tIG9uRXZlbnQgaXMgcGFzc2VkIHRvIFwiaXNDb21wbGV0ZVwiXG4gICAgZXhwZWN0KGV2ZW50LkRhdGEpLnRvU3RyaWN0RXF1YWwoTU9DS19BVFRSUyk7IC8vIGF0dHJpYnV0ZXMgYXJlIHByb3BhZ2F0ZWQgYmV0d2VlbiB0aGUgY2FsbHNcblxuICAgIGNvbnN0IHJlc3VsdCA9IGlzQ29tcGxldGVDYWxscyA9PT0gMztcbiAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgSXNDb21wbGV0ZTogZmFsc2UsXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBJc0NvbXBsZXRlOiB0cnVlLFxuICAgICAgRGF0YToge1xuICAgICAgICBBZGRpdGlvbmFsOiAnYXR0cmlidXRlJywgLy8gYWRkaXRpb25hbCBhdHRyaWJ1dGVzIGNhbiBiZSByZXR1cm5lZCBmcm9tIFwiaXNDb21wbGV0ZVwiXG4gICAgICB9LFxuICAgIH07XG4gIH07XG5cbiAgLy8gV0hFTlxuICBhd2FpdCBzaW11bGF0ZUV2ZW50KHtcbiAgICBSZXF1ZXN0VHlwZTogJ0NyZWF0ZScsXG4gICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiBNT0NLX1BST1BTLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChpc0NvbXBsZXRlQ2FsbHMpLnRvRXF1YWwoMyk7XG5cbiAgZXhwZWN0Q2xvdWRGb3JtYXRpb25TdWNjZXNzKHtcbiAgICBQaHlzaWNhbFJlc291cmNlSWQ6IE1PQ0tfUEhZU0lDQUxfSUQsXG4gICAgRGF0YToge1xuICAgICAgLi4uTU9DS19BVFRSUyxcbiAgICAgIEFkZGl0aW9uYWw6ICdhdHRyaWJ1dGUnLFxuICAgIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2lzQ29tcGxldGUgdGhyb3dzIGluIHRoZSBmaXJzdCBpbnZvY2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBtb2Nrcy5vbkV2ZW50SW1wbE1vY2sgPSBhc3luYyAoKSA9PiAoeyBQaHlzaWNhbFJlc291cmNlSWQ6IE1PQ0tfUEhZU0lDQUxfSUQgfSk7XG4gIG1vY2tzLmlzQ29tcGxldGVJbXBsTW9jayA9IGFzeW5jICgpID0+IHsgdGhyb3cgbmV3IEVycm9yKCdTb21lIGZhaWx1cmUnKTsgfTtcblxuICAvLyBXSEVOXG4gIGF3YWl0IHNpbXVsYXRlRXZlbnQoe1xuICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IE1PQ0tfUFJPUFMsXG4gIH0pO1xuXG4gIGV4cGVjdENsb3VkRm9ybWF0aW9uRmFpbGVkKCdTb21lIGZhaWx1cmVcXG5cXG5Mb2dzOiAvYXdzL2xhbWJkYS9jb21wbGV0ZVxcbicpO1xufSk7XG5cbnRlc3QoJ2ZhaWxzIGdyYWNlZnVsbHkgaWYgXCJvbkV2ZW50XCIgdGhyb3dzIGFuIGVycm9yJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBtb2Nrcy5vbkV2ZW50SW1wbE1vY2sgPSBhc3luYyAoKSA9PiB7IHRocm93IG5ldyBFcnJvcignZXJyb3IgdGhyb3duIGR1cmluZyBvbkV2ZW50Jyk7IH07XG4gIG1vY2tzLmlzQ29tcGxldGVJbXBsTW9jayA9IGFzeW5jICgpID0+ICh7IElzQ29tcGxldGU6IHRydWUgfSk7XG5cbiAgLy8gV0hFTlxuICBhd2FpdCBzaW11bGF0ZUV2ZW50KHtcbiAgICBSZXF1ZXN0VHlwZTogJ0NyZWF0ZScsXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0Q2xvdWRGb3JtYXRpb25GYWlsZWQoJ2Vycm9yIHRocm93biBkdXJpbmcgb25FdmVudFxcblxcbkxvZ3M6IC9hd3MvbGFtYmRhL2V2ZW50XFxuJyk7XG4gIGV4cGVjdE5vV2FpdGVyKCk7XG59KTtcblxuZGVzY3JpYmUoJ1BoeXNpY2FsUmVzb3VyY2VJZCcsICgpID0+IHtcblxuICBkZXNjcmliZSgnaWYgbm90IG9taXR0ZWQgZnJvbSBvbkV2ZW50IHJlc3VsdCcsICgpID0+IHtcblxuICAgIGl0KCdkZWZhdWx0cyB0byBSZXF1ZXN0SWQgZm9yIENSRUFURScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFdIRU5cbiAgICAgIG1vY2tzLm9uRXZlbnRJbXBsTW9jayA9IGFzeW5jICgpID0+IHVuZGVmaW5lZDtcblxuICAgICAgLy8gVEhFTlxuICAgICAgYXdhaXQgc2ltdWxhdGVFdmVudCh7XG4gICAgICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3RDbG91ZEZvcm1hdGlvblN1Y2Nlc3Moe1xuICAgICAgICBQaHlzaWNhbFJlc291cmNlSWQ6IG1vY2tzLk1PQ0tfUkVRVUVTVC5SZXF1ZXN0SWQsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZWZhdWx0cyB0byB0aGUgY3VycmVudCBQaHlzaWNhbFJlc291cmNlSWQgZm9yIFVQREFURScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFdIRU5cbiAgICAgIG1vY2tzLm9uRXZlbnRJbXBsTW9jayA9IGFzeW5jICgpID0+IHVuZGVmaW5lZDtcblxuICAgICAgLy8gVEhFTlxuICAgICAgYXdhaXQgc2ltdWxhdGVFdmVudCh7XG4gICAgICAgIFJlcXVlc3RUeXBlOiAnVXBkYXRlJyxcbiAgICAgICAgUGh5c2ljYWxSZXNvdXJjZUlkOiBNT0NLX1BIWVNJQ0FMX0lELFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdENsb3VkRm9ybWF0aW9uU3VjY2Vzcyh7XG4gICAgICAgIFBoeXNpY2FsUmVzb3VyY2VJZDogTU9DS19QSFlTSUNBTF9JRCxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RlZmF1bHRzIHRvIHRoZSBjdXJyZW50IFBoeXNpY2FsUmVzb3VyY2VJZCBmb3IgREVMRVRFJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gV0hFTlxuICAgICAgbW9ja3Mub25FdmVudEltcGxNb2NrID0gYXN5bmMgKCkgPT4gdW5kZWZpbmVkO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBhd2FpdCBzaW11bGF0ZUV2ZW50KHtcbiAgICAgICAgUmVxdWVzdFR5cGU6ICdEZWxldGUnLFxuICAgICAgICBQaHlzaWNhbFJlc291cmNlSWQ6IE1PQ0tfUEhZU0lDQUxfSUQsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0Q2xvdWRGb3JtYXRpb25TdWNjZXNzKHtcbiAgICAgICAgUGh5c2ljYWxSZXNvdXJjZUlkOiBNT0NLX1BIWVNJQ0FMX0lELFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ1VQREFURTogY2FuIGNoYW5nZSB0aGUgcGh5c2ljYWwgSUQgYnkgcmV0dXJuaW5nIGEgbmV3IElEJywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgbW9ja3Mub25FdmVudEltcGxNb2NrID0gYXN5bmMgKCkgPT4gKHsgUGh5c2ljYWxSZXNvdXJjZUlkOiAnTmV3UGh5c2ljYWxJZCcgfSk7XG4gICAgbW9ja3MuaXNDb21wbGV0ZUltcGxNb2NrID0gYXN5bmMgKCkgPT4gKHsgSXNDb21wbGV0ZTogdHJ1ZSB9KTtcblxuICAgIC8vIFdIRU5cbiAgICBhd2FpdCBzaW11bGF0ZUV2ZW50KHtcbiAgICAgIFJlcXVlc3RUeXBlOiAnVXBkYXRlJyxcbiAgICAgIFBoeXNpY2FsUmVzb3VyY2VJZDogJ0N1cnJlbnRQaHlzaWNhbElkJyxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3RDbG91ZEZvcm1hdGlvblN1Y2Nlc3Moe1xuICAgICAgUGh5c2ljYWxSZXNvdXJjZUlkOiAnTmV3UGh5c2ljYWxJZCcsXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ1VQREFURTogY2FuIG92ZXJyaWRlIHRoZSBwaHlzaWNhbCBJRCB3aXRoIHRoZSBhY3R1YWwgb24gaXNDb21wbGV0ZScsIGFzeW5jICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIG1vY2tzLm9uRXZlbnRJbXBsTW9jayA9IGFzeW5jICgpID0+ICh7IFBoeXNpY2FsUmVzb3VyY2VJZDogJ1RlbXBvcmFyeVBoeXNpY2FsSWQnIH0pO1xuICAgIG1vY2tzLmlzQ29tcGxldGVJbXBsTW9jayA9IGFzeW5jICgpID0+ICh7IElzQ29tcGxldGU6IHRydWUsIFBoeXNpY2FsUmVzb3VyY2VJZDogJ05ld1BoeXNpY2FsSWQnIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIGF3YWl0IHNpbXVsYXRlRXZlbnQoe1xuICAgICAgUmVxdWVzdFR5cGU6ICdVcGRhdGUnLFxuICAgICAgUGh5c2ljYWxSZXNvdXJjZUlkOiAnQ3VycmVudFBoeXNpY2FsSWQnLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdENsb3VkRm9ybWF0aW9uU3VjY2Vzcyh7XG4gICAgICBQaHlzaWNhbFJlc291cmNlSWQ6ICdOZXdQaHlzaWNhbElkJyxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnREVMRVRFOiBjYW5ub3QgY2hhbmdlIHRoZSBwaHlzaWNhbCByZXNvdXJjZSBJRCBkdXJpbmcgYSBkZWxldGUnLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBtb2Nrcy5vbkV2ZW50SW1wbE1vY2sgPSBhc3luYyAoKSA9PiAoeyBQaHlzaWNhbFJlc291cmNlSWQ6ICdOZXdQaHlzaWNhbElkJyB9KTtcbiAgICBtb2Nrcy5pc0NvbXBsZXRlSW1wbE1vY2sgPSBhc3luYyAoKSA9PiAoeyBJc0NvbXBsZXRlOiB0cnVlIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIGF3YWl0IHNpbXVsYXRlRXZlbnQoe1xuICAgICAgUmVxdWVzdFR5cGU6ICdEZWxldGUnLFxuICAgICAgUGh5c2ljYWxSZXNvdXJjZUlkOiAnQ3VycmVudFBoeXNpY2FsSWQnLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdE5vV2FpdGVyKCk7XG4gICAgZXhwZWN0Q2xvdWRGb3JtYXRpb25GYWlsZWQoJ0RFTEVURTogY2Fubm90IGNoYW5nZSB0aGUgcGh5c2ljYWwgcmVzb3VyY2UgSUQgZnJvbSBcIkN1cnJlbnRQaHlzaWNhbElkXCIgdG8gXCJOZXdQaHlzaWNhbElkXCIgZHVyaW5nIGRlbGV0aW9uJyk7XG4gIH0pO1xuXG59KTtcblxudGVzdCgnaXNDb21wbGV0ZSBhbHdheXMgcmV0dXJucyBcImZhbHNlXCIgYW5kIHRoZW4gYSB0aW1lb3V0IG9jY3VycycsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgbW9ja3Mub25FdmVudEltcGxNb2NrID0gYXN5bmMgKCkgPT4gKHsgRGF0YTogeyBGb286IDEyMyB9LCBQaHlzaWNhbFJlc291cmNlSWQ6IE1PQ0tfUEhZU0lDQUxfSUQgfSk7XG4gIG1vY2tzLmlzQ29tcGxldGVJbXBsTW9jayA9IGFzeW5jICgpID0+ICh7IElzQ29tcGxldGU6IGZhbHNlIH0pO1xuXG4gIC8vIFdIRU5cbiAgYXdhaXQgc2ltdWxhdGVFdmVudCh7XG4gICAgUmVxdWVzdFR5cGU6ICdVcGRhdGUnLFxuICAgIFBoeXNpY2FsUmVzb3VyY2VJZDogTU9DS19QSFlTSUNBTF9JRCxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3RDbG91ZEZvcm1hdGlvbkZhaWxlZCgnT3BlcmF0aW9uIHRpbWVkIG91dCcpO1xufSk7XG5cbnRlc3QoJ2lzQ29tcGxldGU6IFwiRGF0YVwiIGlzIG5vdCBhbGxvd2VkIGlmIEluQ29tcGxldGUgaXMgXCJGYWxzZVwiJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBtb2Nrcy5vbkV2ZW50SW1wbE1vY2sgPSBhc3luYyAoKSA9PiAoeyBEYXRhOiB7IEZvbzogMTIzIH0sIFBoeXNpY2FsUmVzb3VyY2VJZDogTU9DS19QSFlTSUNBTF9JRCB9KTtcbiAgbW9ja3MuaXNDb21wbGV0ZUltcGxNb2NrID0gYXN5bmMgKCkgPT4gKHsgSXNDb21wbGV0ZTogZmFsc2UsIERhdGE6IHsgRm9vOiAzMzMzIH0gfSk7XG5cbiAgLy8gV0hFTlxuICBhd2FpdCBzaW11bGF0ZUV2ZW50KHtcbiAgICBSZXF1ZXN0VHlwZTogJ1VwZGF0ZScsXG4gICAgUGh5c2ljYWxSZXNvdXJjZUlkOiBNT0NLX1BIWVNJQ0FMX0lELFxuICB9KTtcblxuICBleHBlY3RDbG91ZEZvcm1hdGlvbkZhaWxlZCgnXCJEYXRhXCIgaXMgbm90IGFsbG93ZWQgaWYgXCJJc0NvbXBsZXRlXCIgaXMgXCJGYWxzZVwiJyk7XG59KTtcblxudGVzdCgnaWYgdGhlcmUgaXMgbm8gdXNlci1kZWZpbmVkIFwiaXNDb21wbGV0ZVwiLCB0aGUgd2FpdGVyIHdpbGwgbm90IGJlIHRyaWdnZXJlZCBvciBuZWVkZWQnLCBhc3luYyAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIG1vY2tzLm9uRXZlbnRJbXBsTW9jayA9IGFzeW5jICgpID0+ICh7IFBoeXNpY2FsUmVzb3VyY2VJZDogTU9DS19QSFlTSUNBTF9JRCB9KTtcblxuICAvLyBXSEVOXG4gIGF3YWl0IHNpbXVsYXRlRXZlbnQoe1xuICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3ROb1dhaXRlcigpO1xuICBleHBlY3RDbG91ZEZvcm1hdGlvblN1Y2Nlc3MoeyBQaHlzaWNhbFJlc291cmNlSWQ6IE1PQ0tfUEhZU0lDQUxfSUQgfSk7XG59KTtcblxuZGVzY3JpYmUoJ05vRWNobycsICgpID0+IHtcbiAgdGVzdCgnd2l0aCBvbkV2ZW50JywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgbW9ja3Mub25FdmVudEltcGxNb2NrID0gYXN5bmMgKCkgPT4gKHtcbiAgICAgIERhdGE6IHtcbiAgICAgICAgVmVyeTogJ1NlbnNpdGl2ZScsXG4gICAgICB9LFxuICAgICAgTm9FY2hvOiB0cnVlLFxuICAgIH0pO1xuXG4gICAgLy8gV0hFTlxuICAgIGF3YWl0IHNpbXVsYXRlRXZlbnQoe1xuICAgICAgUmVxdWVzdFR5cGU6ICdDcmVhdGUnLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdENsb3VkRm9ybWF0aW9uU3VjY2Vzcyh7XG4gICAgICBEYXRhOiB7XG4gICAgICAgIFZlcnk6ICdTZW5zaXRpdmUnLFxuICAgICAgfSxcbiAgICAgIE5vRWNobzogdHJ1ZSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnd2l0aCBpc0NvbXBsZXRlJywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgbW9ja3Mub25FdmVudEltcGxNb2NrID0gYXN5bmMgKCkgPT4gKHtcbiAgICAgIERhdGE6IHtcbiAgICAgICAgVmVyeTogJ1NlbnNpdGl2ZScsXG4gICAgICB9LFxuICAgICAgTm9FY2hvOiB0cnVlLFxuICAgIH0pO1xuICAgIG1vY2tzLmlzQ29tcGxldGVJbXBsTW9jayA9IGFzeW5jICgpID0+ICh7XG4gICAgICBEYXRhOiB7XG4gICAgICAgIEFsc286ICdDb25maWRlbnRpYWwnLFxuICAgICAgfSxcbiAgICAgIElzQ29tcGxldGU6IHRydWUsXG4gICAgfSk7XG5cbiAgICAvLyBXSEVOXG4gICAgYXdhaXQgc2ltdWxhdGVFdmVudCh7XG4gICAgICBSZXF1ZXN0VHlwZTogJ0NyZWF0ZScsXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0Q2xvdWRGb3JtYXRpb25TdWNjZXNzKHtcbiAgICAgIERhdGE6IHtcbiAgICAgICAgVmVyeTogJ1NlbnNpdGl2ZScsXG4gICAgICAgIEFsc286ICdDb25maWRlbnRpYWwnLFxuICAgICAgfSxcbiAgICAgIE5vRWNobzogdHJ1ZSxcbiAgICB9KTtcbiAgfSk7XG59KTtcblxudGVzdCgnZmFpbHMgaWYgdXNlciBoYW5kbGVyIHJldHVybnMgYSBub24tb2JqZWN0IHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBtb2Nrcy5zdHJpbmdpZnlQYXlsb2FkID0gZmFsc2U7XG4gIG1vY2tzLm9uRXZlbnRJbXBsTW9jayA9IGFzeW5jICgpID0+ICdzdHJpbmcnIGFzIGFueTtcblxuICAvLyBXSEVOXG4gIGF3YWl0IHNpbXVsYXRlRXZlbnQoeyBSZXF1ZXN0VHlwZTogJ0NyZWF0ZScgfSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3RDbG91ZEZvcm1hdGlvbkZhaWxlZCgncmV0dXJuIHZhbHVlcyBmcm9tIHVzZXItaGFuZGxlcnMgbXVzdCBiZSBKU09OIG9iamVjdHMuIGdvdDogXFxcInN0cmluZ1xcXCInKTtcbn0pO1xuXG5kZXNjcmliZSgnaWYgQ1JFQVRFIGZhaWxzLCB0aGUgc3Vic2VxdWVudCBERUxFVEUgd2lsbCBiZSBpZ25vcmVkJywgKCkgPT4ge1xuXG4gIGl0KCdGQUlMRUQgcmVzcG9uc2Ugc2V0cyBQaHlzaWNhbFJlc291cmNlSWQgdG8gYSBzcGVjaWFsIG1hcmtlcicsIGFzeW5jICgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgbW9ja3Mub25FdmVudEltcGxNb2NrID0gYXN5bmMgKCkgPT4geyB0aHJvdyBuZXcgRXJyb3IoJ0NSRUFURSBGQUlMRUQnKTsgfTtcblxuICAgIC8vIFRIRU5cbiAgICBhd2FpdCBzaW11bGF0ZUV2ZW50KHtcbiAgICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICB9KTtcblxuICAgIGV4cGVjdENsb3VkRm9ybWF0aW9uRmFpbGVkKCdDUkVBVEUgRkFJTEVEXFxuXFxuTG9nczogL2F3cy9sYW1iZGEvZXZlbnRcXG4nLCB7XG4gICAgICBQaHlzaWNhbFJlc291cmNlSWQ6IGNmblJlc3BvbnNlLkNSRUFURV9GQUlMRURfUEhZU0lDQUxfSURfTUFSS0VSLFxuICAgIH0pO1xuICB9KTtcblxuICBpdCgnREVMRVRFIHJlcXVlc3Qgd2l0aCB0aGUgbWFya2VyIHN1Y2NlZWRzIHdpdGhvdXQgY2FsbGluZyB1c2VyIGhhbmRsZXInLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICAvLyB1c2VyIGhhbmRsZXIgaXMgbm90IGFzc2lnbmVkXG5cbiAgICAvLyBXSEVOXG4gICAgYXdhaXQgc2ltdWxhdGVFdmVudCh7XG4gICAgICBSZXF1ZXN0VHlwZTogJ0RlbGV0ZScsXG4gICAgICBQaHlzaWNhbFJlc291cmNlSWQ6IGNmblJlc3BvbnNlLkNSRUFURV9GQUlMRURfUEhZU0lDQUxfSURfTUFSS0VSLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdENsb3VkRm9ybWF0aW9uU3VjY2VzcygpO1xuICB9KTtcblxufSk7XG5cbmRlc2NyaWJlKCdSZXNwb25zZVVSTCBpcyBwYXNzZWQgdG8gdXNlciBmdW5jdGlvbicsICgpID0+IHtcbiAgdGVzdCgnZm9yIG9uRXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBtb2Nrcy5vbkV2ZW50SW1wbE1vY2sgPSBhc3luYyAoKSA9PiAoeyBQaHlzaWNhbFJlc291cmNlSWQ6IE1PQ0tfUEhZU0lDQUxfSUQgfSk7XG5cbiAgICAvLyBXSEVOXG4gICAgYXdhaXQgc2ltdWxhdGVFdmVudCh7XG4gICAgICBSZXF1ZXN0VHlwZTogJ0NyZWF0ZScsXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KGludm9rZUZ1bmN0aW9uU3B5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KGludm9rZUZ1bmN0aW9uU3B5KS50b0JlQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICBQYXlsb2FkOiBleHBlY3Quc3RyaW5nQ29udGFpbmluZyhgXCJSZXNwb25zZVVSTFwiOlwiJHttb2Nrcy5NT0NLX1JFUVVFU1QuUmVzcG9uc2VVUkx9XCJgKSxcbiAgICB9KSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2ZvciBpc0NvbXBsZXRlJywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgbW9ja3Mub25FdmVudEltcGxNb2NrID0gYXN5bmMgKCkgPT4gKHsgUGh5c2ljYWxSZXNvdXJjZUlkOiBNT0NLX1BIWVNJQ0FMX0lEIH0pO1xuICAgIG1vY2tzLmlzQ29tcGxldGVJbXBsTW9jayA9IGFzeW5jICgpID0+ICh7IElzQ29tcGxldGU6IHRydWUgfSk7XG5cbiAgICAvLyBXSEVOXG4gICAgYXdhaXQgc2ltdWxhdGVFdmVudCh7XG4gICAgICBSZXF1ZXN0VHlwZTogJ0NyZWF0ZScsXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KGludm9rZUZ1bmN0aW9uU3B5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgZXhwZWN0KGludm9rZUZ1bmN0aW9uU3B5KS50b0hhdmVCZWVuTGFzdENhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgUGF5bG9hZDogZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoYFwiUmVzcG9uc2VVUkxcIjpcIiR7bW9ja3MuTU9DS19SRVFVRVNULlJlc3BvbnNlVVJMfVwiYCksXG4gICAgfSkpO1xuICB9KTtcbn0pO1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4vKipcbiAqIFRyaWdnZXJzIHRoZSBjdXN0b20gcmVzb3VyY2UgbGlmZWN5Y2xlIGV2ZW50IGZsb3cgYnkgaW52b2tpbmcgdGhlIGZyYW1ld29yaydzXG4gKiBvbkV2ZW50IGZ1bmN0aW9uIGFuZCB0aGVuLCBpZiB0aGUgd2FpdGVyIHN0YXRlIG1hY2hpbmUgd2FzIHN0YXJ0ZWQsIHNpbXVsYXRlc1xuICogdGhlIHdhaXRlciBhbmQgaW52b2tlcyBpc0NvbXBsZXRlIGFuZCBvblRpbWVvdXQgYXMgYXBwcm9wcmlhdGUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNpbXVsYXRlRXZlbnQocmVxOiBQYXJ0aWFsPEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlRXZlbnQ+KSB7XG4gIGNvbnN0IHggPSB7XG4gICAgU2VydmljZVRva2VuOiAnU0VSVklDRS1UT0tFTicsXG4gICAgUmVzcG9uc2VVUkw6IG1vY2tzLk1PQ0tfUkVRVUVTVC5SZXNwb25zZVVSTCxcbiAgICBTdGFja0lkOiBtb2Nrcy5NT0NLX1JFUVVFU1QuU3RhY2tJZCxcbiAgICBSZXF1ZXN0SWQ6IG1vY2tzLk1PQ0tfUkVRVUVTVC5SZXF1ZXN0SWQsXG4gICAgUmVzb3VyY2VUeXBlOiAnQ3VzdG9tOjpUZXN0UmVzb3VyY2UnLFxuICAgIExvZ2ljYWxSZXNvdXJjZUlkOiBtb2Nrcy5NT0NLX1JFUVVFU1QuTG9naWNhbFJlc291cmNlSWQsXG4gICAgLi4ucmVxLFxuICB9O1xuXG4gIG1vY2tzLnByZXBhcmVGb3JFeGVjdXRpb24oKTtcblxuICBhd2FpdCBmcmFtZXdvcmsub25FdmVudCh4IGFzIEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlRXZlbnQpO1xuXG4gIC8vIGlmIHRoZSBGU01cbiAgaWYgKG1vY2tzLnN0YXJ0U3RhdGVNYWNoaW5lSW5wdXQgJiYgbW9ja3Muc3RhcnRTdGF0ZU1hY2hpbmVJbnB1dC5zdGF0ZU1hY2hpbmVBcm4gPT09IG1vY2tzLk1PQ0tfU0ZOX0FSTikge1xuICAgIGF3YWl0IHNpbXVsYXRlV2FpdGVyKEpTT04ucGFyc2UobW9ja3Muc3RhcnRTdGF0ZU1hY2hpbmVJbnB1dC5pbnB1dCEpKTtcbiAgfVxuXG4gIGFzeW5jIGZ1bmN0aW9uIHNpbXVsYXRlV2FpdGVyKGV2ZW50OiBBV1NDREtBc3luY0N1c3RvbVJlc291cmNlLklzQ29tcGxldGVSZXF1ZXN0KSB7XG4gICAgbGV0IHJldHJ5ID0gdHJ1ZTtcbiAgICBsZXQgY291bnQgPSA1O1xuICAgIHdoaWxlIChyZXRyeSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZnJhbWV3b3JrLmlzQ29tcGxldGUoZXZlbnQpO1xuICAgICAgICByZXRyeSA9IGZhbHNlO1xuICAgICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgY2ZuUmVzcG9uc2UuUmV0cnkpIHtcbiAgICAgICAgICBpZiAoY291bnQtLSA9PT0gMCkge1xuICAgICAgICAgICAgYXdhaXQgZnJhbWV3b3JrLm9uVGltZW91dCh7IENhdXNlOiBKU09OLnN0cmluZ2lmeSh7IGVycm9yTWVzc2FnZTogZS5tZXNzYWdlIH0pIH0pO1xuICAgICAgICAgICAgcmV0cnkgPSBmYWxzZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0cnkgPSB0cnVlO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBleHBlY3RDbG91ZEZvcm1hdGlvbkZhaWxlZChleHBlY3RlZFJlYXNvbjogc3RyaW5nLCByZXNwPzogUGFydGlhbDxBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZVJlc3BvbnNlPikge1xuICBleHBlY3RDbG91ZEZvcm1hdGlvblJlc3BvbnNlKHtcbiAgICBTdGF0dXM6ICdGQUlMRUQnLFxuICAgIFJlYXNvbjogZXhwZWN0ZWRSZWFzb24sXG4gICAgLi4ucmVzcCxcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGV4cGVjdENsb3VkRm9ybWF0aW9uU3VjY2VzcyhyZXNwPzogUGFydGlhbDxBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZVJlc3BvbnNlPikge1xuICBpZiAobW9ja3MuY2ZuUmVzcG9uc2UuU3RhdHVzICE9PSAnU1VDQ0VTUycpIHtcbiAgICBjb25zb2xlLmVycm9yKG1vY2tzLmNmblJlc3BvbnNlLlJlYXNvbiB8fCAnPE5PIFJFQVNPTj4nKTtcbiAgfVxuXG4gIGV4cGVjdENsb3VkRm9ybWF0aW9uUmVzcG9uc2UoeyBTdGF0dXM6ICdTVUNDRVNTJywgLi4ucmVzcCB9KTtcbn1cblxuZnVuY3Rpb24gZXhwZWN0Q2xvdWRGb3JtYXRpb25SZXNwb25zZShyZXNwOiBQYXJ0aWFsPEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlUmVzcG9uc2U+ID0ge30pIHtcbiAgZm9yIChjb25zdCBba2V5LCBleHBlY3RlZF0gb2YgT2JqZWN0LmVudHJpZXMocmVzcCkpIHtcbiAgICBjb25zdCBhY3R1YWwgPSAobW9ja3MuY2ZuUmVzcG9uc2UgYXMgYW55KVtrZXldO1xuICAgIGV4cGVjdChhY3R1YWwpLnRvU3RyaWN0RXF1YWwoZXhwZWN0ZWQgYXMgYW55KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBleHBlY3ROb1dhaXRlcigpIHtcbiAgZXhwZWN0KG1vY2tzLnN0YXJ0U3RhdGVNYWNoaW5lSW5wdXQpLnRvQmVVbmRlZmluZWQoKTtcbn1cbiJdfQ==