"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CodePipeline = void 0;
const jsiiDeprecationWarnings = require("../../../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const fs = require("fs");
const path = require("path");
const cb = require("../../../aws-codebuild");
const cp = require("../../../aws-codepipeline");
const cpa = require("../../../aws-codepipeline-actions");
const iam = require("../../../aws-iam");
const core_1 = require("../../../core");
const cxapi = require("../../../cx-api");
const artifact_map_1 = require("./artifact-map");
const codebuild_step_1 = require("./codebuild-step");
const codebuild_factory_1 = require("./private/codebuild-factory");
const outputs_1 = require("./private/outputs");
const stack_outputs_map_1 = require("./stack-outputs-map");
const blueprint_1 = require("../blueprint");
const docker_credentials_1 = require("../docker-credentials");
const helpers_internal_1 = require("../helpers-internal");
const main_1 = require("../main");
const asset_singleton_role_1 = require("../private/asset-singleton-role");
const cached_fnsub_1 = require("../private/cached-fnsub");
const cli_version_1 = require("../private/cli-version");
const construct_internals_1 = require("../private/construct-internals");
const default_codebuild_image_1 = require("../private/default-codebuild-image");
const fs_1 = require("../private/fs");
const identifiers_1 = require("../private/identifiers");
const javascript_1 = require("../private/javascript");
const template_configuration_1 = require("../private/template-configuration");
/**
 * A CDK Pipeline that uses CodePipeline to deploy CDK apps
 *
 * This is a `Pipeline` with its `engine` property set to
 * `CodePipelineEngine`, and exists for nicer ergonomics for
 * users that don't need to switch out engines.
 */
class CodePipeline extends main_1.PipelineBase {
    constructor(scope, id, props) {
        super(scope, id, props);
        this.props = props;
        this.artifacts = new artifact_map_1.ArtifactMap();
        this.cachedFnSub = new cached_fnsub_1.CachedFnSub();
        /**
         * Asset roles shared for publishing
         */
        this.assetCodeBuildRoles = new Map();
        try {
            jsiiDeprecationWarnings.aws_cdk_lib_pipelines_CodePipelineProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, CodePipeline);
            }
            throw error;
        }
        this.selfMutationEnabled = props.selfMutation ?? true;
        this.dockerCredentials = props.dockerCredentials ?? [];
        this.singlePublisherPerAssetType = !(props.publishAssetsInParallel ?? true);
        this.cliVersion = props.cliVersion ?? (0, cli_version_1.preferredCliVersion)();
        this.useChangeSets = props.useChangeSets ?? true;
        this.stackOutputs = new stack_outputs_map_1.StackOutputsMap(this);
    }
    /**
     * The CodeBuild project that performs the Synth
     *
     * Only available after the pipeline has been built.
     */
    get synthProject() {
        if (!this._synthProject) {
            throw new Error('Call pipeline.buildPipeline() before reading this property');
        }
        return this._synthProject;
    }
    /**
     * The CodeBuild project that performs the SelfMutation
     *
     * Will throw an error if this is accessed before `buildPipeline()`
     * is called, or if selfMutation has been disabled.
     */
    get selfMutationProject() {
        if (!this._pipeline) {
            throw new Error('Call pipeline.buildPipeline() before reading this property');
        }
        if (!this._selfMutationProject) {
            throw new Error('No selfMutationProject since the selfMutation property was set to false');
        }
        return this._selfMutationProject;
    }
    /**
     * The CodePipeline pipeline that deploys the CDK app
     *
     * Only available after the pipeline has been built.
     */
    get pipeline() {
        if (!this._pipeline) {
            throw new Error('Pipeline not created yet');
        }
        return this._pipeline;
    }
    doBuildPipeline() {
        if (this._pipeline) {
            throw new Error('Pipeline already created');
        }
        this._myCxAsmRoot = path.resolve((0, construct_internals_1.assemblyBuilderOf)((0, construct_internals_1.appOf)(this)).outdir);
        if (this.props.codePipeline) {
            if (this.props.pipelineName) {
                throw new Error('Cannot set \'pipelineName\' if an existing CodePipeline is given using \'codePipeline\'');
            }
            if (this.props.crossAccountKeys !== undefined) {
                throw new Error('Cannot set \'crossAccountKeys\' if an existing CodePipeline is given using \'codePipeline\'');
            }
            if (this.props.enableKeyRotation !== undefined) {
                throw new Error('Cannot set \'enableKeyRotation\' if an existing CodePipeline is given using \'codePipeline\'');
            }
            if (this.props.reuseCrossRegionSupportStacks !== undefined) {
                throw new Error('Cannot set \'reuseCrossRegionSupportStacks\' if an existing CodePipeline is given using \'codePipeline\'');
            }
            if (this.props.role !== undefined) {
                throw new Error('Cannot set \'role\' if an existing CodePipeline is given using \'codePipeline\'');
            }
            this._pipeline = this.props.codePipeline;
        }
        else {
            this._pipeline = new cp.Pipeline(this, 'Pipeline', {
                pipelineName: this.props.pipelineName,
                crossAccountKeys: this.props.crossAccountKeys ?? false,
                reuseCrossRegionSupportStacks: this.props.reuseCrossRegionSupportStacks,
                // This is necessary to make self-mutation work (deployments are guaranteed
                // to happen only after the builds of the latest pipeline definition).
                restartExecutionOnUpdate: true,
                role: this.props.role,
                enableKeyRotation: this.props.enableKeyRotation,
            });
        }
        const graphFromBp = new helpers_internal_1.PipelineGraph(this, {
            selfMutation: this.selfMutationEnabled,
            singlePublisherPerAssetType: this.singlePublisherPerAssetType,
            prepareStep: this.useChangeSets,
        });
        this._cloudAssemblyFileSet = graphFromBp.cloudAssemblyFileSet;
        this.pipelineStagesAndActionsFromGraph(graphFromBp);
        // Write a dotfile for the pipeline layout
        const dotFile = `${core_1.Names.uniqueId(this)}.dot`;
        fs.writeFileSync(path.join(this.myCxAsmRoot, dotFile), graphFromBp.graph.renderDot().replace(/input\.dot/, dotFile), { encoding: 'utf-8' });
    }
    get myCxAsmRoot() {
        if (!this._myCxAsmRoot) {
            throw new Error('Can\'t read \'myCxAsmRoot\' if build deployment not called yet');
        }
        return this._myCxAsmRoot;
    }
    /**
     * Scope for Assets-related resources.
     *
     * Purely exists for construct tree backwards compatibility with legacy pipelines
     */
    get assetsScope() {
        return (0, construct_internals_1.obtainScope)(this, 'Assets');
    }
    pipelineStagesAndActionsFromGraph(structure) {
        // Translate graph into Pipeline Stages and Actions
        let beforeSelfMutation = this.selfMutationEnabled;
        for (const stageNode of (0, javascript_1.flatten)(structure.graph.sortedChildren())) {
            if (!(0, helpers_internal_1.isGraph)(stageNode)) {
                throw new Error(`Top-level children must be graphs, got '${stageNode}'`);
            }
            // Group our ordered tranches into blocks of 50.
            // We can map these onto stages without exceeding the capacity of a Stage.
            const chunks = chunkTranches(50, stageNode.sortedLeaves());
            const actionsOverflowStage = chunks.length > 1;
            for (const [i, tranches] of (0, javascript_1.enumerate)(chunks)) {
                const stageName = actionsOverflowStage ? `${stageNode.id}.${i + 1}` : stageNode.id;
                const pipelineStage = this.pipeline.addStage({ stageName });
                const sharedParent = new helpers_internal_1.GraphNodeCollection((0, javascript_1.flatten)(tranches)).commonAncestor();
                let runOrder = 1;
                for (const tranche of tranches) {
                    const runOrdersConsumed = [0];
                    for (const node of tranche) {
                        const factory = this.actionFromNode(node);
                        const nodeType = this.nodeTypeFromNode(node);
                        const name = (0, identifiers_1.actionName)(node, sharedParent);
                        const variablesNamespace = node.data?.type === 'step'
                            ? (0, outputs_1.namespaceStepOutputs)(node.data.step, pipelineStage, name)
                            : undefined;
                        const result = factory.produceAction(pipelineStage, {
                            actionName: name,
                            runOrder,
                            artifacts: this.artifacts,
                            scope: (0, construct_internals_1.obtainScope)(this.pipeline, stageName),
                            fallbackArtifact: this._fallbackArtifact,
                            pipeline: this,
                            // If this step happens to produce a CodeBuild job, set the default options
                            codeBuildDefaults: nodeType ? this.codeBuildDefaultsFor(nodeType) : undefined,
                            beforeSelfMutation,
                            variablesNamespace,
                            stackOutputsMap: this.stackOutputs,
                        });
                        if (node.data?.type === 'self-update') {
                            beforeSelfMutation = false;
                        }
                        this.postProcessNode(node, result);
                        runOrdersConsumed.push(result.runOrdersConsumed);
                    }
                    runOrder += Math.max(...runOrdersConsumed);
                }
            }
        }
    }
    /**
     * Do additional things after the action got added to the pipeline
     *
     * Some minor state manipulation of CodeBuild projects and pipeline
     * artifacts.
     */
    postProcessNode(node, result) {
        const nodeType = this.nodeTypeFromNode(node);
        if (result.project) {
            const dockerUsage = dockerUsageFromCodeBuild(nodeType ?? CodeBuildProjectType.STEP);
            if (dockerUsage) {
                for (const c of this.dockerCredentials) {
                    c.grantRead(result.project, dockerUsage);
                }
            }
            if (nodeType === CodeBuildProjectType.SYNTH) {
                this._synthProject = result.project;
            }
            if (nodeType === CodeBuildProjectType.SELF_MUTATE) {
                this._selfMutationProject = result.project;
            }
        }
        if (node.data?.type === 'step' && node.data.step.primaryOutput?.primaryOutput && !this._fallbackArtifact) {
            this._fallbackArtifact = this.artifacts.toCodePipeline(node.data.step.primaryOutput?.primaryOutput);
        }
    }
    /**
     * Make an action from the given node and/or step
     */
    actionFromNode(node) {
        switch (node.data?.type) {
            // Nothing for these, they are groupings (shouldn't even have popped up here)
            case 'group':
            case 'stack-group':
            case undefined:
                throw new Error(`actionFromNode: did not expect to get group nodes: ${node.data?.type}`);
            case 'self-update':
                return this.selfMutateAction();
            case 'publish-assets':
                return this.publishAssetsAction(node, node.data.assets);
            case 'prepare':
                return this.createChangeSetAction(node.data.stack);
            case 'execute':
                return node.data.withoutChangeSet
                    ? this.executeDeploymentAction(node.data.stack, node.data.captureOutputs)
                    : this.executeChangeSetAction(node.data.stack, node.data.captureOutputs);
            case 'step':
                return this.actionFromStep(node, node.data.step);
            default:
                throw new Error(`CodePipeline does not support graph nodes of type '${node.data?.type}'. You are probably using a feature this CDK Pipelines implementation does not support.`);
        }
    }
    /**
     * Take a Step and turn it into a CodePipeline Action
     *
     * There are only 3 types of Steps we need to support:
     *
     * - Shell (generic)
     * - ManualApproval (generic)
     * - CodePipelineActionFactory (CodePipeline-specific)
     *
     * The rest is expressed in terms of these 3, or in terms of graph nodes
     * which are handled elsewhere.
     */
    actionFromStep(node, step) {
        const nodeType = this.nodeTypeFromNode(node);
        // CodePipeline-specific steps first -- this includes Sources
        if (isCodePipelineActionFactory(step)) {
            return step;
        }
        // Now built-in steps
        if (step instanceof blueprint_1.ShellStep || step instanceof codebuild_step_1.CodeBuildStep) {
            // The 'CdkBuildProject' will be the construct ID of the CodeBuild project, necessary for backwards compat
            let constructId = nodeType === CodeBuildProjectType.SYNTH
                ? 'CdkBuildProject'
                : step.id;
            return step instanceof codebuild_step_1.CodeBuildStep
                ? codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep(constructId, step)
                : codebuild_factory_1.CodeBuildFactory.fromShellStep(constructId, step);
        }
        if (step instanceof blueprint_1.ManualApprovalStep) {
            return {
                produceAction: (stage, options) => {
                    stage.addAction(new cpa.ManualApprovalAction({
                        actionName: options.actionName,
                        runOrder: options.runOrder,
                        additionalInformation: step.comment,
                    }));
                    return { runOrdersConsumed: 1 };
                },
            };
        }
        throw new Error(`Deployment step '${step}' is not supported for CodePipeline-backed pipelines`);
    }
    createChangeSetAction(stack) {
        const changeSetName = 'PipelineChange';
        const templateArtifact = this.artifacts.toCodePipeline(this._cloudAssemblyFileSet);
        const templateConfigurationPath = this.writeTemplateConfiguration(stack);
        const region = stack.region !== core_1.Stack.of(this).region ? stack.region : undefined;
        const account = stack.account !== core_1.Stack.of(this).account ? stack.account : undefined;
        const relativeTemplatePath = path.relative(this.myCxAsmRoot, stack.absoluteTemplatePath);
        return {
            produceAction: (stage, options) => {
                stage.addAction(new cpa.CloudFormationCreateReplaceChangeSetAction({
                    actionName: options.actionName,
                    runOrder: options.runOrder,
                    changeSetName,
                    stackName: stack.stackName,
                    templatePath: templateArtifact.atPath((0, fs_1.toPosixPath)(relativeTemplatePath)),
                    adminPermissions: true,
                    role: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.assumeRoleArn),
                    deploymentRole: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.executionRoleArn),
                    region: region,
                    templateConfiguration: templateConfigurationPath
                        ? templateArtifact.atPath((0, fs_1.toPosixPath)(templateConfigurationPath))
                        : undefined,
                    cfnCapabilities: [core_1.CfnCapabilities.NAMED_IAM, core_1.CfnCapabilities.AUTO_EXPAND],
                }));
                return { runOrdersConsumed: 1 };
            },
        };
    }
    executeChangeSetAction(stack, captureOutputs) {
        const changeSetName = 'PipelineChange';
        const region = stack.region !== core_1.Stack.of(this).region ? stack.region : undefined;
        const account = stack.account !== core_1.Stack.of(this).account ? stack.account : undefined;
        return {
            produceAction: (stage, options) => {
                stage.addAction(new cpa.CloudFormationExecuteChangeSetAction({
                    actionName: options.actionName,
                    runOrder: options.runOrder,
                    changeSetName,
                    stackName: stack.stackName,
                    role: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.assumeRoleArn),
                    region: region,
                    variablesNamespace: captureOutputs ? (0, identifiers_1.stackVariableNamespace)(stack) : undefined,
                }));
                return { runOrdersConsumed: 1 };
            },
        };
    }
    executeDeploymentAction(stack, captureOutputs) {
        const templateArtifact = this.artifacts.toCodePipeline(this._cloudAssemblyFileSet);
        const templateConfigurationPath = this.writeTemplateConfiguration(stack);
        const region = stack.region !== core_1.Stack.of(this).region ? stack.region : undefined;
        const account = stack.account !== core_1.Stack.of(this).account ? stack.account : undefined;
        const relativeTemplatePath = path.relative(this.myCxAsmRoot, stack.absoluteTemplatePath);
        return {
            produceAction: (stage, options) => {
                stage.addAction(new cpa.CloudFormationCreateUpdateStackAction({
                    actionName: options.actionName,
                    runOrder: options.runOrder,
                    stackName: stack.stackName,
                    templatePath: templateArtifact.atPath((0, fs_1.toPosixPath)(relativeTemplatePath)),
                    adminPermissions: true,
                    role: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.assumeRoleArn),
                    deploymentRole: this.roleFromPlaceholderArn(this.pipeline, region, account, stack.executionRoleArn),
                    region: region,
                    templateConfiguration: templateConfigurationPath
                        ? templateArtifact.atPath((0, fs_1.toPosixPath)(templateConfigurationPath))
                        : undefined,
                    cfnCapabilities: [core_1.CfnCapabilities.NAMED_IAM, core_1.CfnCapabilities.AUTO_EXPAND],
                    variablesNamespace: captureOutputs ? (0, identifiers_1.stackVariableNamespace)(stack) : undefined,
                }));
                return { runOrdersConsumed: 1 };
            },
        };
    }
    selfMutateAction() {
        const installSuffix = this.cliVersion ? `@${this.cliVersion}` : '';
        const pipelineStack = core_1.Stack.of(this.pipeline);
        const pipelineStackIdentifier = pipelineStack.node.path ?? pipelineStack.stackName;
        const step = new codebuild_step_1.CodeBuildStep('SelfMutate', {
            projectName: (0, javascript_1.maybeSuffix)(this.props.pipelineName, '-selfupdate'),
            input: this._cloudAssemblyFileSet,
            installCommands: [
                `npm install -g aws-cdk${installSuffix}`,
            ],
            commands: [
                `cdk -a ${(0, fs_1.toPosixPath)((0, construct_internals_1.embeddedAsmPath)(this.pipeline))} deploy ${pipelineStackIdentifier} --require-approval=never --verbose`,
            ],
            rolePolicyStatements: [
                // allow the self-mutating project permissions to assume the bootstrap Action role
                new iam.PolicyStatement({
                    actions: ['sts:AssumeRole'],
                    resources: [`arn:*:iam::${core_1.Stack.of(this.pipeline).account}:role/*`],
                    conditions: {
                        'ForAnyValue:StringEquals': {
                            'iam:ResourceTag/aws-cdk:bootstrap-role': ['image-publishing', 'file-publishing', 'deploy'],
                        },
                    },
                }),
                new iam.PolicyStatement({
                    actions: ['cloudformation:DescribeStacks'],
                    resources: ['*'], // this is needed to check the status of the bootstrap stack when doing `cdk deploy`
                }),
                // S3 checks for the presence of the ListBucket permission
                new iam.PolicyStatement({
                    actions: ['s3:ListBucket'],
                    resources: ['*'],
                }),
            ],
        });
        // Different on purpose -- id needed for backwards compatible LogicalID
        return codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep('SelfMutation', step, {
            additionalConstructLevel: false,
            scope: (0, construct_internals_1.obtainScope)(this, 'UpdatePipeline'),
        });
    }
    publishAssetsAction(node, assets) {
        const installSuffix = this.cliVersion ? `@${this.cliVersion}` : '';
        const commands = assets.map(asset => {
            const relativeAssetManifestPath = path.relative(this.myCxAsmRoot, asset.assetManifestPath);
            return `cdk-assets --path "${(0, fs_1.toPosixPath)(relativeAssetManifestPath)}" --verbose publish "${asset.assetSelector}"`;
        });
        const assetType = assets[0].assetType;
        if (assets.some(a => a.assetType !== assetType)) {
            throw new Error('All assets in a single publishing step must be of the same type');
        }
        const role = this.obtainAssetCodeBuildRole(assets[0].assetType);
        for (const roleArn of assets.flatMap(a => a.assetPublishingRoleArn ? [a.assetPublishingRoleArn] : [])) {
            // The ARNs include raw AWS pseudo parameters (e.g., ${AWS::Partition}), which need to be substituted.
            role.addAssumeRole(this.cachedFnSub.fnSub(roleArn));
        }
        ;
        // The base commands that need to be run
        const script = new codebuild_step_1.CodeBuildStep(node.id, {
            commands,
            installCommands: [
                `npm install -g cdk-assets${installSuffix}`,
            ],
            input: this._cloudAssemblyFileSet,
            buildEnvironment: {
                privileged: (assets.some(asset => asset.assetType === blueprint_1.AssetType.DOCKER_IMAGE) ||
                    this.props.codeBuildDefaults?.buildEnvironment?.privileged),
            },
            role,
        });
        // Customizations that are not accessible to regular users
        return codebuild_factory_1.CodeBuildFactory.fromCodeBuildStep(node.id, script, {
            additionalConstructLevel: false,
            // If we use a single publisher, pass buildspec via file otherwise it'll
            // grow too big.
            passBuildSpecViaCloudAssembly: this.singlePublisherPerAssetType,
            scope: this.assetsScope,
        });
    }
    nodeTypeFromNode(node) {
        if (node.data?.type === 'step') {
            return !!node.data?.isBuildStep ? CodeBuildProjectType.SYNTH : CodeBuildProjectType.STEP;
        }
        if (node.data?.type === 'publish-assets') {
            return CodeBuildProjectType.ASSETS;
        }
        if (node.data?.type === 'self-update') {
            return CodeBuildProjectType.SELF_MUTATE;
        }
        return undefined;
    }
    codeBuildDefaultsFor(nodeType) {
        const defaultOptions = {
            buildEnvironment: {
                buildImage: default_codebuild_image_1.CDKP_DEFAULT_CODEBUILD_IMAGE,
                computeType: cb.ComputeType.SMALL,
            },
        };
        const typeBasedCustomizations = {
            [CodeBuildProjectType.SYNTH]: this.props.dockerEnabledForSynth
                ? (0, codebuild_factory_1.mergeCodeBuildOptions)(this.props.synthCodeBuildDefaults, { buildEnvironment: { privileged: true } })
                : this.props.synthCodeBuildDefaults,
            [CodeBuildProjectType.ASSETS]: this.props.assetPublishingCodeBuildDefaults,
            [CodeBuildProjectType.SELF_MUTATE]: this.props.dockerEnabledForSelfMutation
                ? (0, codebuild_factory_1.mergeCodeBuildOptions)(this.props.selfMutationCodeBuildDefaults, { buildEnvironment: { privileged: true } })
                : this.props.selfMutationCodeBuildDefaults,
            [CodeBuildProjectType.STEP]: {},
        };
        const dockerUsage = dockerUsageFromCodeBuild(nodeType);
        const dockerCommands = dockerUsage !== undefined
            ? (0, docker_credentials_1.dockerCredentialsInstallCommands)(dockerUsage, this.dockerCredentials, 'both')
            : [];
        const typeBasedDockerCommands = dockerCommands.length > 0 ? {
            partialBuildSpec: cb.BuildSpec.fromObject({
                version: '0.2',
                phases: {
                    pre_build: {
                        commands: dockerCommands,
                    },
                },
            }),
        } : {};
        return (0, codebuild_factory_1.mergeCodeBuildOptions)(defaultOptions, this.props.codeBuildDefaults, typeBasedCustomizations[nodeType], typeBasedDockerCommands);
    }
    roleFromPlaceholderArn(scope, region, account, arn) {
        if (!arn) {
            return undefined;
        }
        // Use placeholder arn as construct ID.
        const id = arn;
        // https://github.com/aws/aws-cdk/issues/7255
        let existingRole = scope.node.tryFindChild(`ImmutableRole${id}`);
        if (existingRole) {
            return existingRole;
        }
        // For when #7255 is fixed.
        existingRole = scope.node.tryFindChild(id);
        if (existingRole) {
            return existingRole;
        }
        const arnToImport = cxapi.EnvironmentPlaceholders.replace(arn, {
            region: region ?? core_1.Aws.REGION,
            accountId: account ?? core_1.Aws.ACCOUNT_ID,
            partition: core_1.Aws.PARTITION,
        });
        return iam.Role.fromRoleArn(scope, id, arnToImport, { mutable: false, addGrantsToResources: true });
    }
    /**
     * Non-template config files for CodePipeline actions
     *
     * Currently only supports tags.
     */
    writeTemplateConfiguration(stack) {
        if (Object.keys(stack.tags).length === 0) {
            return undefined;
        }
        const absConfigPath = `${stack.absoluteTemplatePath}.config.json`;
        const relativeConfigPath = path.relative(this.myCxAsmRoot, absConfigPath);
        // Write the template configuration file (for parameters into CreateChangeSet call that
        // cannot be configured any other way). They must come from a file, and there's unfortunately
        // no better hook to write this file (`construct.onSynthesize()` would have been the prime candidate
        // but that is being deprecated--and DeployCdkStackAction isn't even a construct).
        (0, template_configuration_1.writeTemplateConfiguration)(absConfigPath, {
            Tags: (0, javascript_1.noUndefined)(stack.tags),
        });
        return relativeConfigPath;
    }
    /**
     * This role is used by both the CodePipeline build action and related CodeBuild project. Consolidating these two
     * roles into one, and re-using across all assets, saves significant size of the final synthesized output.
     * Modeled after the CodePipeline role and 'CodePipelineActionRole' roles.
     * Generates one role per asset type to separate file and Docker/image-based permissions.
     */
    obtainAssetCodeBuildRole(assetType) {
        const existing = this.assetCodeBuildRoles.get(assetType);
        if (existing) {
            return existing;
        }
        const stack = core_1.Stack.of(this);
        const rolePrefix = assetType === blueprint_1.AssetType.DOCKER_IMAGE ? 'Docker' : 'File';
        const assetRole = new asset_singleton_role_1.AssetSingletonRole(this.assetsScope, `${rolePrefix}Role`, {
            roleName: core_1.PhysicalName.GENERATE_IF_NEEDED,
            assumedBy: new iam.CompositePrincipal(new iam.ServicePrincipal('codebuild.amazonaws.com'), new iam.AccountPrincipal(stack.account)),
        });
        // Grant pull access for any ECR registries and secrets that exist
        if (assetType === blueprint_1.AssetType.DOCKER_IMAGE) {
            this.dockerCredentials.forEach(reg => reg.grantRead(assetRole, docker_credentials_1.DockerCredentialUsage.ASSET_PUBLISHING));
        }
        this.assetCodeBuildRoles.set(assetType, assetRole);
        return assetRole;
    }
}
_a = JSII_RTTI_SYMBOL_1;
CodePipeline[_a] = { fqn: "aws-cdk-lib.pipelines.CodePipeline", version: "2.73.0" };
exports.CodePipeline = CodePipeline;
function dockerUsageFromCodeBuild(cbt) {
    switch (cbt) {
        case CodeBuildProjectType.ASSETS: return docker_credentials_1.DockerCredentialUsage.ASSET_PUBLISHING;
        case CodeBuildProjectType.SELF_MUTATE: return docker_credentials_1.DockerCredentialUsage.SELF_UPDATE;
        case CodeBuildProjectType.SYNTH: return docker_credentials_1.DockerCredentialUsage.SYNTH;
        case CodeBuildProjectType.STEP: return undefined;
    }
}
var CodeBuildProjectType;
(function (CodeBuildProjectType) {
    CodeBuildProjectType["SYNTH"] = "SYNTH";
    CodeBuildProjectType["ASSETS"] = "ASSETS";
    CodeBuildProjectType["SELF_MUTATE"] = "SELF_MUTATE";
    CodeBuildProjectType["STEP"] = "STEP";
})(CodeBuildProjectType || (CodeBuildProjectType = {}));
/**
 * Take a set of tranches and split them up into groups so
 * that no set of tranches has more than n items total
 */
function chunkTranches(n, xss) {
    const ret = [];
    while (xss.length > 0) {
        const tranches = [];
        let count = 0;
        while (xss.length > 0) {
            const xs = xss[0];
            const spaceRemaining = n - count;
            if (xs.length <= spaceRemaining) {
                tranches.push(xs);
                count += xs.length;
                xss.shift();
            }
            else {
                tranches.push(xs.splice(0, spaceRemaining));
                count = n;
                break;
            }
        }
        ret.push(tranches);
    }
    return ret;
}
function isCodePipelineActionFactory(x) {
    return !!x.produceAction;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZXBpcGVsaW5lLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29kZXBpcGVsaW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFDN0IsNkNBQTZDO0FBQzdDLGdEQUFnRDtBQUNoRCx5REFBeUQ7QUFFekQsd0NBQXdDO0FBQ3hDLHdDQUEyRjtBQUMzRix5Q0FBeUM7QUFFekMsaURBQTZDO0FBQzdDLHFEQUFpRDtBQUVqRCxtRUFBc0Y7QUFDdEYsK0NBQXlEO0FBQ3pELDJEQUFzRDtBQUN0RCw0Q0FBc0k7QUFDdEksOERBQWtIO0FBQ2xILDBEQUE4RjtBQUM5RixrQ0FBdUM7QUFDdkMsMEVBQXFFO0FBQ3JFLDBEQUFzRDtBQUN0RCx3REFBNkQ7QUFDN0Qsd0VBQXdHO0FBQ3hHLGdGQUFrRjtBQUNsRixzQ0FBNEM7QUFDNUMsd0RBQTRFO0FBQzVFLHNEQUFxRjtBQUNyRiw4RUFBK0U7QUF1Uy9FOzs7Ozs7R0FNRztBQUNILE1BQWEsWUFBYSxTQUFRLG1CQUFZO0lBK0I1QyxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFtQixLQUF3QjtRQUNqRixLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQURpQyxVQUFLLEdBQUwsS0FBSyxDQUFtQjtRQXhCM0UsY0FBUyxHQUFHLElBQUksMEJBQVcsRUFBRSxDQUFDO1FBTXJCLGdCQUFXLEdBQUcsSUFBSSwwQkFBVyxFQUFFLENBQUM7UUFHakQ7O1dBRUc7UUFDYyx3QkFBbUIsR0FBdUMsSUFBSSxHQUFHLEVBQUUsQ0FBQzs7Ozs7OytDQW5CMUUsWUFBWTs7OztRQWtDckIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLEtBQUssQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDO1FBQ3RELElBQUksQ0FBQyxpQkFBaUIsR0FBRyxLQUFLLENBQUMsaUJBQWlCLElBQUksRUFBRSxDQUFDO1FBQ3ZELElBQUksQ0FBQywyQkFBMkIsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLHVCQUF1QixJQUFJLElBQUksQ0FBQyxDQUFDO1FBQzVFLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDLFVBQVUsSUFBSSxJQUFBLGlDQUFtQixHQUFFLENBQUM7UUFDNUQsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQztRQUNqRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksbUNBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUMvQztJQUVEOzs7O09BSUc7SUFDSCxJQUFXLFlBQVk7UUFDckIsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDdkIsTUFBTSxJQUFJLEtBQUssQ0FBQyw0REFBNEQsQ0FBQyxDQUFDO1NBQy9FO1FBQ0QsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDO0tBQzNCO0lBRUQ7Ozs7O09BS0c7SUFDSCxJQUFXLG1CQUFtQjtRQUM1QixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNuQixNQUFNLElBQUksS0FBSyxDQUFDLDREQUE0RCxDQUFDLENBQUM7U0FDL0U7UUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFO1lBQzlCLE1BQU0sSUFBSSxLQUFLLENBQUMseUVBQXlFLENBQUMsQ0FBQztTQUM1RjtRQUNELE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDO0tBQ2xDO0lBRUQ7Ozs7T0FJRztJQUNILElBQVcsUUFBUTtRQUNqQixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNuQixNQUFNLElBQUksS0FBSyxDQUFDLDBCQUEwQixDQUFDLENBQUM7U0FDN0M7UUFDRCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7S0FDdkI7SUFHUyxlQUFlO1FBQ3ZCLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixNQUFNLElBQUksS0FBSyxDQUFDLDBCQUEwQixDQUFDLENBQUM7U0FDN0M7UUFFRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBQSx1Q0FBaUIsRUFBQyxJQUFBLDJCQUFLLEVBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUV4RSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFO1lBQzNCLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUU7Z0JBQzNCLE1BQU0sSUFBSSxLQUFLLENBQUMseUZBQXlGLENBQUMsQ0FBQzthQUM1RztZQUNELElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsS0FBSyxTQUFTLEVBQUU7Z0JBQzdDLE1BQU0sSUFBSSxLQUFLLENBQUMsNkZBQTZGLENBQUMsQ0FBQzthQUNoSDtZQUNELElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsS0FBSyxTQUFTLEVBQUU7Z0JBQzlDLE1BQU0sSUFBSSxLQUFLLENBQUMsOEZBQThGLENBQUMsQ0FBQzthQUNqSDtZQUNELElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsS0FBSyxTQUFTLEVBQUU7Z0JBQzFELE1BQU0sSUFBSSxLQUFLLENBQUMsMEdBQTBHLENBQUMsQ0FBQzthQUM3SDtZQUNELElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUssU0FBUyxFQUFFO2dCQUNqQyxNQUFNLElBQUksS0FBSyxDQUFDLGlGQUFpRixDQUFDLENBQUM7YUFDcEc7WUFFRCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDO1NBQzFDO2FBQU07WUFDTCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFO2dCQUNqRCxZQUFZLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZO2dCQUNyQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGdCQUFnQixJQUFJLEtBQUs7Z0JBQ3RELDZCQUE2QixFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsNkJBQTZCO2dCQUN2RSwyRUFBMkU7Z0JBQzNFLHNFQUFzRTtnQkFDdEUsd0JBQXdCLEVBQUUsSUFBSTtnQkFDOUIsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSTtnQkFDckIsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUI7YUFDaEQsQ0FBQyxDQUFDO1NBQ0o7UUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLGdDQUFhLENBQUMsSUFBSSxFQUFFO1lBQzFDLFlBQVksRUFBRSxJQUFJLENBQUMsbUJBQW1CO1lBQ3RDLDJCQUEyQixFQUFFLElBQUksQ0FBQywyQkFBMkI7WUFDN0QsV0FBVyxFQUFFLElBQUksQ0FBQyxhQUFhO1NBQ2hDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxxQkFBcUIsR0FBRyxXQUFXLENBQUMsb0JBQW9CLENBQUM7UUFFOUQsSUFBSSxDQUFDLGlDQUFpQyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRXBELDBDQUEwQztRQUMxQyxNQUFNLE9BQU8sR0FBRyxHQUFHLFlBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUM5QyxFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsRUFBRSxXQUFXLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztLQUM3STtJQUVELElBQVksV0FBVztRQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRTtZQUN0QixNQUFNLElBQUksS0FBSyxDQUFDLGdFQUFnRSxDQUFDLENBQUM7U0FDbkY7UUFDRCxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUM7S0FDMUI7SUFFRDs7OztPQUlHO0lBQ0gsSUFBWSxXQUFXO1FBQ3JCLE9BQU8sSUFBQSxpQ0FBVyxFQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztLQUNwQztJQUVPLGlDQUFpQyxDQUFDLFNBQXdCO1FBQ2hFLG1EQUFtRDtRQUNuRCxJQUFJLGtCQUFrQixHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztRQUNsRCxLQUFLLE1BQU0sU0FBUyxJQUFJLElBQUEsb0JBQU8sRUFBQyxTQUFTLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDLEVBQUU7WUFDakUsSUFBSSxDQUFDLElBQUEsMEJBQU8sRUFBQyxTQUFTLENBQUMsRUFBRTtnQkFDdkIsTUFBTSxJQUFJLEtBQUssQ0FBQywyQ0FBMkMsU0FBUyxHQUFHLENBQUMsQ0FBQzthQUMxRTtZQUVELGdEQUFnRDtZQUNoRCwwRUFBMEU7WUFDMUUsTUFBTSxNQUFNLEdBQUcsYUFBYSxDQUFDLEVBQUUsRUFBRSxTQUFTLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQztZQUMzRCxNQUFNLG9CQUFvQixHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQy9DLEtBQUssTUFBTSxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsSUFBSSxJQUFBLHNCQUFTLEVBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQzdDLE1BQU0sU0FBUyxHQUFHLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO2dCQUNuRixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7Z0JBRTVELE1BQU0sWUFBWSxHQUFHLElBQUksc0NBQW1CLENBQUMsSUFBQSxvQkFBTyxFQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7Z0JBRWpGLElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQztnQkFDakIsS0FBSyxNQUFNLE9BQU8sSUFBSSxRQUFRLEVBQUU7b0JBQzlCLE1BQU0saUJBQWlCLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFFOUIsS0FBSyxNQUFNLElBQUksSUFBSSxPQUFPLEVBQUU7d0JBQzFCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7d0JBRTFDLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQzt3QkFDN0MsTUFBTSxJQUFJLEdBQUcsSUFBQSx3QkFBVSxFQUFDLElBQUksRUFBRSxZQUFZLENBQUMsQ0FBQzt3QkFFNUMsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksS0FBSyxNQUFNOzRCQUNuRCxDQUFDLENBQUMsSUFBQSw4QkFBb0IsRUFBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxhQUFhLEVBQUUsSUFBSSxDQUFDOzRCQUMzRCxDQUFDLENBQUMsU0FBUyxDQUFDO3dCQUVkLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsYUFBYSxFQUFFOzRCQUNsRCxVQUFVLEVBQUUsSUFBSTs0QkFDaEIsUUFBUTs0QkFDUixTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVM7NEJBQ3pCLEtBQUssRUFBRSxJQUFBLGlDQUFXLEVBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxTQUFTLENBQUM7NEJBQzVDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxpQkFBaUI7NEJBQ3hDLFFBQVEsRUFBRSxJQUFJOzRCQUNkLDJFQUEyRTs0QkFDM0UsaUJBQWlCLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVM7NEJBQzdFLGtCQUFrQjs0QkFDbEIsa0JBQWtCOzRCQUNsQixlQUFlLEVBQUUsSUFBSSxDQUFDLFlBQVk7eUJBQ25DLENBQUMsQ0FBQzt3QkFFSCxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxLQUFLLGFBQWEsRUFBRTs0QkFDckMsa0JBQWtCLEdBQUcsS0FBSyxDQUFDO3lCQUM1Qjt3QkFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQzt3QkFFbkMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO3FCQUNsRDtvQkFFRCxRQUFRLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLGlCQUFpQixDQUFDLENBQUM7aUJBQzVDO2FBQ0Y7U0FDRjtLQUNGO0lBRUQ7Ozs7O09BS0c7SUFDSyxlQUFlLENBQUMsSUFBZ0IsRUFBRSxNQUF1QztRQUMvRSxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFN0MsSUFBSSxNQUFNLENBQUMsT0FBTyxFQUFFO1lBQ2xCLE1BQU0sV0FBVyxHQUFHLHdCQUF3QixDQUFDLFFBQVEsSUFBSSxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwRixJQUFJLFdBQVcsRUFBRTtnQkFDZixLQUFLLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxpQkFBaUIsRUFBRTtvQkFDdEMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDO2lCQUMxQzthQUNGO1lBRUQsSUFBSSxRQUFRLEtBQUssb0JBQW9CLENBQUMsS0FBSyxFQUFFO2dCQUMzQyxJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUM7YUFDckM7WUFDRCxJQUFJLFFBQVEsS0FBSyxvQkFBb0IsQ0FBQyxXQUFXLEVBQUU7Z0JBQ2pELElBQUksQ0FBQyxvQkFBb0IsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDO2FBQzVDO1NBQ0Y7UUFFRCxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxLQUFLLE1BQU0sSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsYUFBYSxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFO1lBQ3hHLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsYUFBYSxDQUFDLENBQUM7U0FDckc7S0FDRjtJQUVEOztPQUVHO0lBQ0ssY0FBYyxDQUFDLElBQWdCO1FBQ3JDLFFBQVEsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUU7WUFDdkIsNkVBQTZFO1lBQzdFLEtBQUssT0FBTyxDQUFDO1lBQ2IsS0FBSyxhQUFhLENBQUM7WUFDbkIsS0FBSyxTQUFTO2dCQUNaLE1BQU0sSUFBSSxLQUFLLENBQUMsc0RBQXNELElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUUzRixLQUFLLGFBQWE7Z0JBQ2hCLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFakMsS0FBSyxnQkFBZ0I7Z0JBQ25CLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRTFELEtBQUssU0FBUztnQkFDWixPQUFPLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRXJELEtBQUssU0FBUztnQkFDWixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCO29CQUMvQixDQUFDLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDO29CQUN6RSxDQUFDLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7WUFFN0UsS0FBSyxNQUFNO2dCQUNULE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVuRDtnQkFDRSxNQUFNLElBQUksS0FBSyxDQUFDLHNEQUFzRCxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUkseUZBQXlGLENBQUMsQ0FBQztTQUNuTDtLQUNGO0lBRUQ7Ozs7Ozs7Ozs7O09BV0c7SUFDSyxjQUFjLENBQUMsSUFBZ0IsRUFBRSxJQUFVO1FBQ2pELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU3Qyw2REFBNkQ7UUFDN0QsSUFBSSwyQkFBMkIsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNyQyxPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQscUJBQXFCO1FBQ3JCLElBQUksSUFBSSxZQUFZLHFCQUFTLElBQUksSUFBSSxZQUFZLDhCQUFhLEVBQUU7WUFDOUQsMEdBQTBHO1lBQzFHLElBQUksV0FBVyxHQUFHLFFBQVEsS0FBSyxvQkFBb0IsQ0FBQyxLQUFLO2dCQUN2RCxDQUFDLENBQUMsaUJBQWlCO2dCQUNuQixDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUVaLE9BQU8sSUFBSSxZQUFZLDhCQUFhO2dCQUNsQyxDQUFDLENBQUMsb0NBQWdCLENBQUMsaUJBQWlCLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQztnQkFDdkQsQ0FBQyxDQUFDLG9DQUFnQixDQUFDLGFBQWEsQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDdkQ7UUFFRCxJQUFJLElBQUksWUFBWSw4QkFBa0IsRUFBRTtZQUN0QyxPQUFPO2dCQUNMLGFBQWEsRUFBRSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFBRTtvQkFDaEMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQzt3QkFDM0MsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO3dCQUM5QixRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVE7d0JBQzFCLHFCQUFxQixFQUFFLElBQUksQ0FBQyxPQUFPO3FCQUNwQyxDQUFDLENBQUMsQ0FBQztvQkFDSixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQyxFQUFFLENBQUM7Z0JBQ2xDLENBQUM7YUFDRixDQUFDO1NBQ0g7UUFFRCxNQUFNLElBQUksS0FBSyxDQUFDLG9CQUFvQixJQUFJLHNEQUFzRCxDQUFDLENBQUM7S0FDakc7SUFFTyxxQkFBcUIsQ0FBQyxLQUFzQjtRQUNsRCxNQUFNLGFBQWEsR0FBRyxnQkFBZ0IsQ0FBQztRQUV2QyxNQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxxQkFBc0IsQ0FBQyxDQUFDO1FBQ3BGLE1BQU0seUJBQXlCLEdBQUcsSUFBSSxDQUFDLDBCQUEwQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXpFLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLEtBQUssWUFBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUNqRixNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxLQUFLLFlBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFFckYsTUFBTSxvQkFBb0IsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFFekYsT0FBTztZQUNMLGFBQWEsRUFBRSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFBRTtnQkFDaEMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsQ0FBQywwQ0FBMEMsQ0FBQztvQkFDakUsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO29CQUM5QixRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVE7b0JBQzFCLGFBQWE7b0JBQ2IsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTO29CQUMxQixZQUFZLEVBQUUsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLElBQUEsZ0JBQVcsRUFBQyxvQkFBb0IsQ0FBQyxDQUFDO29CQUN4RSxnQkFBZ0IsRUFBRSxJQUFJO29CQUN0QixJQUFJLEVBQUUsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsYUFBYSxDQUFDO29CQUN0RixjQUFjLEVBQUUsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsZ0JBQWdCLENBQUM7b0JBQ25HLE1BQU0sRUFBRSxNQUFNO29CQUNkLHFCQUFxQixFQUFFLHlCQUF5Qjt3QkFDOUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxJQUFBLGdCQUFXLEVBQUMseUJBQXlCLENBQUMsQ0FBQzt3QkFDakUsQ0FBQyxDQUFDLFNBQVM7b0JBQ2IsZUFBZSxFQUFFLENBQUMsc0JBQWUsQ0FBQyxTQUFTLEVBQUUsc0JBQWUsQ0FBQyxXQUFXLENBQUM7aUJBQzFFLENBQUMsQ0FBQyxDQUFDO2dCQUNKLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNsQyxDQUFDO1NBQ0YsQ0FBQztLQUNIO0lBRU8sc0JBQXNCLENBQUMsS0FBc0IsRUFBRSxjQUF1QjtRQUM1RSxNQUFNLGFBQWEsR0FBRyxnQkFBZ0IsQ0FBQztRQUV2QyxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxLQUFLLFlBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFDakYsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sS0FBSyxZQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1FBRXJGLE9BQU87WUFDTCxhQUFhLEVBQUUsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEVBQUU7Z0JBQ2hDLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLENBQUMsb0NBQW9DLENBQUM7b0JBQzNELFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVTtvQkFDOUIsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRO29CQUMxQixhQUFhO29CQUNiLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUztvQkFDMUIsSUFBSSxFQUFFLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLGFBQWEsQ0FBQztvQkFDdEYsTUFBTSxFQUFFLE1BQU07b0JBQ2Qsa0JBQWtCLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQyxJQUFBLG9DQUFzQixFQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTO2lCQUMvRSxDQUFDLENBQUMsQ0FBQztnQkFFSixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDbEMsQ0FBQztTQUNGLENBQUM7S0FDSDtJQUVPLHVCQUF1QixDQUFDLEtBQXNCLEVBQUUsY0FBdUI7UUFDN0UsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMscUJBQXNCLENBQUMsQ0FBQztRQUNwRixNQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUV6RSxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxLQUFLLFlBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFDakYsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sS0FBSyxZQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1FBRXJGLE1BQU0sb0JBQW9CLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBRXpGLE9BQU87WUFDTCxhQUFhLEVBQUUsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEVBQUU7Z0JBQ2hDLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLENBQUMscUNBQXFDLENBQUM7b0JBQzVELFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVTtvQkFDOUIsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRO29CQUMxQixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7b0JBQzFCLFlBQVksRUFBRSxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsSUFBQSxnQkFBVyxFQUFDLG9CQUFvQixDQUFDLENBQUM7b0JBQ3hFLGdCQUFnQixFQUFFLElBQUk7b0JBQ3RCLElBQUksRUFBRSxJQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBQyxhQUFhLENBQUM7b0JBQ3RGLGNBQWMsRUFBRSxJQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQztvQkFDbkcsTUFBTSxFQUFFLE1BQU07b0JBQ2QscUJBQXFCLEVBQUUseUJBQXlCO3dCQUM5QyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLElBQUEsZ0JBQVcsRUFBQyx5QkFBeUIsQ0FBQyxDQUFDO3dCQUNqRSxDQUFDLENBQUMsU0FBUztvQkFDYixlQUFlLEVBQUUsQ0FBQyxzQkFBZSxDQUFDLFNBQVMsRUFBRSxzQkFBZSxDQUFDLFdBQVcsQ0FBQztvQkFDekUsa0JBQWtCLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQyxJQUFBLG9DQUFzQixFQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTO2lCQUMvRSxDQUFDLENBQUMsQ0FBQztnQkFFSixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDbEMsQ0FBQztTQUNGLENBQUM7S0FDSDtJQUVPLGdCQUFnQjtRQUN0QixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBRW5FLE1BQU0sYUFBYSxHQUFHLFlBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzlDLE1BQU0sdUJBQXVCLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksYUFBYSxDQUFDLFNBQVMsQ0FBQztRQUVuRixNQUFNLElBQUksR0FBRyxJQUFJLDhCQUFhLENBQUMsWUFBWSxFQUFFO1lBQzNDLFdBQVcsRUFBRSxJQUFBLHdCQUFXLEVBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsYUFBYSxDQUFDO1lBQ2hFLEtBQUssRUFBRSxJQUFJLENBQUMscUJBQXFCO1lBQ2pDLGVBQWUsRUFBRTtnQkFDZix5QkFBeUIsYUFBYSxFQUFFO2FBQ3pDO1lBQ0QsUUFBUSxFQUFFO2dCQUNSLFVBQVUsSUFBQSxnQkFBVyxFQUFDLElBQUEscUNBQWUsRUFBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsV0FBVyx1QkFBdUIscUNBQXFDO2FBQzdIO1lBRUQsb0JBQW9CLEVBQUU7Z0JBQ3BCLGtGQUFrRjtnQkFDbEYsSUFBSSxHQUFHLENBQUMsZUFBZSxDQUFDO29CQUN0QixPQUFPLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQztvQkFDM0IsU0FBUyxFQUFFLENBQUMsY0FBYyxZQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLFNBQVMsQ0FBQztvQkFDbkUsVUFBVSxFQUFFO3dCQUNWLDBCQUEwQixFQUFFOzRCQUMxQix3Q0FBd0MsRUFBRSxDQUFDLGtCQUFrQixFQUFFLGlCQUFpQixFQUFFLFFBQVEsQ0FBQzt5QkFDNUY7cUJBQ0Y7aUJBQ0YsQ0FBQztnQkFDRixJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUM7b0JBQ3RCLE9BQU8sRUFBRSxDQUFDLCtCQUErQixDQUFDO29CQUMxQyxTQUFTLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxvRkFBb0Y7aUJBQ3ZHLENBQUM7Z0JBQ0YsMERBQTBEO2dCQUMxRCxJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUM7b0JBQ3RCLE9BQU8sRUFBRSxDQUFDLGVBQWUsQ0FBQztvQkFDMUIsU0FBUyxFQUFFLENBQUMsR0FBRyxDQUFDO2lCQUNqQixDQUFDO2FBQ0g7U0FDRixDQUFDLENBQUM7UUFFSCx1RUFBdUU7UUFDdkUsT0FBTyxvQ0FBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxjQUFjLEVBQUUsSUFBSSxFQUFFO1lBQzlELHdCQUF3QixFQUFFLEtBQUs7WUFDL0IsS0FBSyxFQUFFLElBQUEsaUNBQVcsRUFBQyxJQUFJLEVBQUUsZ0JBQWdCLENBQUM7U0FDM0MsQ0FBQyxDQUFDO0tBQ0o7SUFFTyxtQkFBbUIsQ0FBQyxJQUFnQixFQUFFLE1BQW9CO1FBQ2hFLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFFbkUsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNsQyxNQUFNLHlCQUF5QixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUMzRixPQUFPLHNCQUFzQixJQUFBLGdCQUFXLEVBQUMseUJBQXlCLENBQUMsd0JBQXdCLEtBQUssQ0FBQyxhQUFhLEdBQUcsQ0FBQztRQUNwSCxDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFDdEMsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsS0FBSyxTQUFTLENBQUMsRUFBRTtZQUMvQyxNQUFNLElBQUksS0FBSyxDQUFDLGlFQUFpRSxDQUFDLENBQUM7U0FDcEY7UUFFRCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsd0JBQXdCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRWhFLEtBQUssTUFBTSxPQUFPLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUU7WUFDckcsc0dBQXNHO1lBQ3RHLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztTQUNyRDtRQUFBLENBQUM7UUFFRix3Q0FBd0M7UUFDeEMsTUFBTSxNQUFNLEdBQUcsSUFBSSw4QkFBYSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDeEMsUUFBUTtZQUNSLGVBQWUsRUFBRTtnQkFDZiw0QkFBNEIsYUFBYSxFQUFFO2FBQzVDO1lBQ0QsS0FBSyxFQUFFLElBQUksQ0FBQyxxQkFBcUI7WUFDakMsZ0JBQWdCLEVBQUU7Z0JBQ2hCLFVBQVUsRUFBRSxDQUNWLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsU0FBUyxLQUFLLHFCQUFTLENBQUMsWUFBWSxDQUFDO29CQUNoRSxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLGdCQUFnQixFQUFFLFVBQVUsQ0FDM0Q7YUFDRjtZQUNELElBQUk7U0FDTCxDQUFDLENBQUM7UUFFSCwwREFBMEQ7UUFDMUQsT0FBTyxvQ0FBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRTtZQUN6RCx3QkFBd0IsRUFBRSxLQUFLO1lBRS9CLHdFQUF3RTtZQUN4RSxnQkFBZ0I7WUFDaEIsNkJBQTZCLEVBQUUsSUFBSSxDQUFDLDJCQUEyQjtZQUMvRCxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVc7U0FDeEIsQ0FBQyxDQUFDO0tBQ0o7SUFFTyxnQkFBZ0IsQ0FBQyxJQUFnQjtRQUN2QyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxLQUFLLE1BQU0sRUFBRTtZQUM5QixPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsb0JBQW9CLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUM7U0FDMUY7UUFDRCxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxLQUFLLGdCQUFnQixFQUFFO1lBQ3hDLE9BQU8sb0JBQW9CLENBQUMsTUFBTSxDQUFDO1NBQ3BDO1FBQ0QsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksS0FBSyxhQUFhLEVBQUU7WUFDckMsT0FBTyxvQkFBb0IsQ0FBQyxXQUFXLENBQUM7U0FDekM7UUFDRCxPQUFPLFNBQVMsQ0FBQztLQUNsQjtJQUVPLG9CQUFvQixDQUFDLFFBQThCO1FBQ3pELE1BQU0sY0FBYyxHQUFxQjtZQUN2QyxnQkFBZ0IsRUFBRTtnQkFDaEIsVUFBVSxFQUFFLHNEQUE0QjtnQkFDeEMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSzthQUNsQztTQUNGLENBQUM7UUFFRixNQUFNLHVCQUF1QixHQUFHO1lBQzlCLENBQUMsb0JBQW9CLENBQUMsS0FBSyxDQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxxQkFBcUI7Z0JBQzVELENBQUMsQ0FBQyxJQUFBLHlDQUFxQixFQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsc0JBQXNCLEVBQUUsRUFBRSxnQkFBZ0IsRUFBRSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDO2dCQUN0RyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxzQkFBc0I7WUFFckMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGdDQUFnQztZQUUxRSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsNEJBQTRCO2dCQUN6RSxDQUFDLENBQUMsSUFBQSx5Q0FBcUIsRUFBQyxJQUFJLENBQUMsS0FBSyxDQUFDLDZCQUE2QixFQUFFLEVBQUUsZ0JBQWdCLEVBQUUsRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQztnQkFDN0csQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsNkJBQTZCO1lBRTVDLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNoQyxDQUFDO1FBRUYsTUFBTSxXQUFXLEdBQUcsd0JBQXdCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdkQsTUFBTSxjQUFjLEdBQUcsV0FBVyxLQUFLLFNBQVM7WUFDOUMsQ0FBQyxDQUFDLElBQUEscURBQWdDLEVBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxNQUFNLENBQUM7WUFDL0UsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNQLE1BQU0sdUJBQXVCLEdBQUcsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFELGdCQUFnQixFQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDO2dCQUN4QyxPQUFPLEVBQUUsS0FBSztnQkFDZCxNQUFNLEVBQUU7b0JBQ04sU0FBUyxFQUFFO3dCQUNULFFBQVEsRUFBRSxjQUFjO3FCQUN6QjtpQkFDRjthQUNGLENBQUM7U0FDSCxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFFUCxPQUFPLElBQUEseUNBQXFCLEVBQzFCLGNBQWMsRUFDZCxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUM1Qix1QkFBdUIsQ0FBQyxRQUFRLENBQUMsRUFDakMsdUJBQXVCLENBQ3hCLENBQUM7S0FDSDtJQU1PLHNCQUFzQixDQUFDLEtBQWdCLEVBQUUsTUFBMEIsRUFDekUsT0FBMkIsRUFBRSxHQUF1QjtRQUVwRCxJQUFJLENBQUMsR0FBRyxFQUFFO1lBQUUsT0FBTyxTQUFTLENBQUM7U0FBRTtRQUUvQix1Q0FBdUM7UUFDdkMsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDO1FBRWYsNkNBQTZDO1FBQzdDLElBQUksWUFBWSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLGdCQUFnQixFQUFFLEVBQUUsQ0FBYyxDQUFDO1FBQzlFLElBQUksWUFBWSxFQUFFO1lBQUUsT0FBTyxZQUFZLENBQUM7U0FBRTtRQUMxQywyQkFBMkI7UUFDM0IsWUFBWSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBYyxDQUFDO1FBQ3hELElBQUksWUFBWSxFQUFFO1lBQUUsT0FBTyxZQUFZLENBQUM7U0FBRTtRQUUxQyxNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsdUJBQXVCLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRTtZQUM3RCxNQUFNLEVBQUUsTUFBTSxJQUFJLFVBQUcsQ0FBQyxNQUFNO1lBQzVCLFNBQVMsRUFBRSxPQUFPLElBQUksVUFBRyxDQUFDLFVBQVU7WUFDcEMsU0FBUyxFQUFFLFVBQUcsQ0FBQyxTQUFTO1NBQ3pCLENBQUMsQ0FBQztRQUNILE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxXQUFXLEVBQUUsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLG9CQUFvQixFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7S0FDckc7SUFFRDs7OztPQUlHO0lBQ0ssMEJBQTBCLENBQUMsS0FBc0I7UUFDdkQsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQUUsT0FBTyxTQUFTLENBQUM7U0FBRTtRQUUvRCxNQUFNLGFBQWEsR0FBRyxHQUFHLEtBQUssQ0FBQyxvQkFBb0IsY0FBYyxDQUFDO1FBQ2xFLE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1FBRTFFLHVGQUF1RjtRQUN2Riw2RkFBNkY7UUFDN0Ysb0dBQW9HO1FBQ3BHLGtGQUFrRjtRQUNsRixJQUFBLG1EQUEwQixFQUFDLGFBQWEsRUFBRTtZQUN4QyxJQUFJLEVBQUUsSUFBQSx3QkFBVyxFQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7U0FDOUIsQ0FBQyxDQUFDO1FBRUgsT0FBTyxrQkFBa0IsQ0FBQztLQUMzQjtJQUVEOzs7OztPQUtHO0lBQ0ssd0JBQXdCLENBQUMsU0FBb0I7UUFDbkQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN6RCxJQUFJLFFBQVEsRUFBRTtZQUNaLE9BQU8sUUFBUSxDQUFDO1NBQ2pCO1FBRUQsTUFBTSxLQUFLLEdBQUcsWUFBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU3QixNQUFNLFVBQVUsR0FBRyxTQUFTLEtBQUsscUJBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQzVFLE1BQU0sU0FBUyxHQUFHLElBQUkseUNBQWtCLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLFVBQVUsTUFBTSxFQUFFO1lBQzlFLFFBQVEsRUFBRSxtQkFBWSxDQUFDLGtCQUFrQjtZQUN6QyxTQUFTLEVBQUUsSUFBSSxHQUFHLENBQUMsa0JBQWtCLENBQ25DLElBQUksR0FBRyxDQUFDLGdCQUFnQixDQUFDLHlCQUF5QixDQUFDLEVBQ25ELElBQUksR0FBRyxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FDeEM7U0FDRixDQUFDLENBQUM7UUFFSCxrRUFBa0U7UUFDbEUsSUFBSSxTQUFTLEtBQUsscUJBQVMsQ0FBQyxZQUFZLEVBQUU7WUFDeEMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLDBDQUFxQixDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztTQUN6RztRQUVELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ25ELE9BQU8sU0FBUyxDQUFDO0tBQ2xCOzs7O0FBam9CVSxvQ0FBWTtBQXFvQnpCLFNBQVMsd0JBQXdCLENBQUMsR0FBeUI7SUFDekQsUUFBUSxHQUFHLEVBQUU7UUFDWCxLQUFLLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sMENBQXFCLENBQUMsZ0JBQWdCLENBQUM7UUFDaEYsS0FBSyxvQkFBb0IsQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLDBDQUFxQixDQUFDLFdBQVcsQ0FBQztRQUNoRixLQUFLLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sMENBQXFCLENBQUMsS0FBSyxDQUFDO1FBQ3BFLEtBQUssb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxTQUFTLENBQUM7S0FDbEQ7QUFDSCxDQUFDO0FBRUQsSUFBSyxvQkFLSjtBQUxELFdBQUssb0JBQW9CO0lBQ3ZCLHVDQUFlLENBQUE7SUFDZix5Q0FBaUIsQ0FBQTtJQUNqQixtREFBMkIsQ0FBQTtJQUMzQixxQ0FBYSxDQUFBO0FBQ2YsQ0FBQyxFQUxJLG9CQUFvQixLQUFwQixvQkFBb0IsUUFLeEI7QUFFRDs7O0dBR0c7QUFDSCxTQUFTLGFBQWEsQ0FBSSxDQUFTLEVBQUUsR0FBVTtJQUM3QyxNQUFNLEdBQUcsR0FBWSxFQUFFLENBQUM7SUFFeEIsT0FBTyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtRQUNyQixNQUFNLFFBQVEsR0FBVSxFQUFFLENBQUM7UUFDM0IsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBRWQsT0FBTyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNyQixNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEIsTUFBTSxjQUFjLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUNqQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLElBQUksY0FBYyxFQUFFO2dCQUMvQixRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNsQixLQUFLLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQztnQkFDbkIsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO2FBQ2I7aUJBQU07Z0JBQ0wsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDO2dCQUM1QyxLQUFLLEdBQUcsQ0FBQyxDQUFDO2dCQUNWLE1BQU07YUFDUDtTQUNGO1FBRUQsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUNwQjtJQUdELE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQztBQUVELFNBQVMsMkJBQTJCLENBQUMsQ0FBTTtJQUN6QyxPQUFPLENBQUMsQ0FBRSxDQUFnQyxDQUFDLGFBQWEsQ0FBQztBQUMzRCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIGNiIGZyb20gJy4uLy4uLy4uL2F3cy1jb2RlYnVpbGQnO1xuaW1wb3J0ICogYXMgY3AgZnJvbSAnLi4vLi4vLi4vYXdzLWNvZGVwaXBlbGluZSc7XG5pbXBvcnQgKiBhcyBjcGEgZnJvbSAnLi4vLi4vLi4vYXdzLWNvZGVwaXBlbGluZS1hY3Rpb25zJztcbmltcG9ydCAqIGFzIGVjMiBmcm9tICcuLi8uLi8uLi9hd3MtZWMyJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICcuLi8uLi8uLi9hd3MtaWFtJztcbmltcG9ydCB7IEF3cywgQ2ZuQ2FwYWJpbGl0aWVzLCBEdXJhdGlvbiwgUGh5c2ljYWxOYW1lLCBTdGFjaywgTmFtZXMgfSBmcm9tICcuLi8uLi8uLi9jb3JlJztcbmltcG9ydCAqIGFzIGN4YXBpIGZyb20gJy4uLy4uLy4uL2N4LWFwaSc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IEFydGlmYWN0TWFwIH0gZnJvbSAnLi9hcnRpZmFjdC1tYXAnO1xuaW1wb3J0IHsgQ29kZUJ1aWxkU3RlcCB9IGZyb20gJy4vY29kZWJ1aWxkLXN0ZXAnO1xuaW1wb3J0IHsgQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeVJlc3VsdCwgSUNvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnkgfSBmcm9tICcuL2NvZGVwaXBlbGluZS1hY3Rpb24tZmFjdG9yeSc7XG5pbXBvcnQgeyBDb2RlQnVpbGRGYWN0b3J5LCBtZXJnZUNvZGVCdWlsZE9wdGlvbnMgfSBmcm9tICcuL3ByaXZhdGUvY29kZWJ1aWxkLWZhY3RvcnknO1xuaW1wb3J0IHsgbmFtZXNwYWNlU3RlcE91dHB1dHMgfSBmcm9tICcuL3ByaXZhdGUvb3V0cHV0cyc7XG5pbXBvcnQgeyBTdGFja091dHB1dHNNYXAgfSBmcm9tICcuL3N0YWNrLW91dHB1dHMtbWFwJztcbmltcG9ydCB7IEFzc2V0VHlwZSwgRmlsZVNldCwgSUZpbGVTZXRQcm9kdWNlciwgTWFudWFsQXBwcm92YWxTdGVwLCBTaGVsbFN0ZXAsIFN0YWNrQXNzZXQsIFN0YWNrRGVwbG95bWVudCwgU3RlcCB9IGZyb20gJy4uL2JsdWVwcmludCc7XG5pbXBvcnQgeyBEb2NrZXJDcmVkZW50aWFsLCBkb2NrZXJDcmVkZW50aWFsc0luc3RhbGxDb21tYW5kcywgRG9ja2VyQ3JlZGVudGlhbFVzYWdlIH0gZnJvbSAnLi4vZG9ja2VyLWNyZWRlbnRpYWxzJztcbmltcG9ydCB7IEdyYXBoTm9kZUNvbGxlY3Rpb24sIGlzR3JhcGgsIEFHcmFwaE5vZGUsIFBpcGVsaW5lR3JhcGggfSBmcm9tICcuLi9oZWxwZXJzLWludGVybmFsJztcbmltcG9ydCB7IFBpcGVsaW5lQmFzZSB9IGZyb20gJy4uL21haW4nO1xuaW1wb3J0IHsgQXNzZXRTaW5nbGV0b25Sb2xlIH0gZnJvbSAnLi4vcHJpdmF0ZS9hc3NldC1zaW5nbGV0b24tcm9sZSc7XG5pbXBvcnQgeyBDYWNoZWRGblN1YiB9IGZyb20gJy4uL3ByaXZhdGUvY2FjaGVkLWZuc3ViJztcbmltcG9ydCB7IHByZWZlcnJlZENsaVZlcnNpb24gfSBmcm9tICcuLi9wcml2YXRlL2NsaS12ZXJzaW9uJztcbmltcG9ydCB7IGFwcE9mLCBhc3NlbWJseUJ1aWxkZXJPZiwgZW1iZWRkZWRBc21QYXRoLCBvYnRhaW5TY29wZSB9IGZyb20gJy4uL3ByaXZhdGUvY29uc3RydWN0LWludGVybmFscyc7XG5pbXBvcnQgeyBDREtQX0RFRkFVTFRfQ09ERUJVSUxEX0lNQUdFIH0gZnJvbSAnLi4vcHJpdmF0ZS9kZWZhdWx0LWNvZGVidWlsZC1pbWFnZSc7XG5pbXBvcnQgeyB0b1Bvc2l4UGF0aCB9IGZyb20gJy4uL3ByaXZhdGUvZnMnO1xuaW1wb3J0IHsgYWN0aW9uTmFtZSwgc3RhY2tWYXJpYWJsZU5hbWVzcGFjZSB9IGZyb20gJy4uL3ByaXZhdGUvaWRlbnRpZmllcnMnO1xuaW1wb3J0IHsgZW51bWVyYXRlLCBmbGF0dGVuLCBtYXliZVN1ZmZpeCwgbm9VbmRlZmluZWQgfSBmcm9tICcuLi9wcml2YXRlL2phdmFzY3JpcHQnO1xuaW1wb3J0IHsgd3JpdGVUZW1wbGF0ZUNvbmZpZ3VyYXRpb24gfSBmcm9tICcuLi9wcml2YXRlL3RlbXBsYXRlLWNvbmZpZ3VyYXRpb24nO1xuXG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYSBgQ29kZVBpcGVsaW5lYFxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvZGVQaXBlbGluZVByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBidWlsZCBzdGVwIHRoYXQgcHJvZHVjZXMgdGhlIENESyBDbG91ZCBBc3NlbWJseVxuICAgKlxuICAgKiBUaGUgcHJpbWFyeSBvdXRwdXQgb2YgdGhpcyBzdGVwIG5lZWRzIHRvIGJlIHRoZSBgY2RrLm91dGAgZGlyZWN0b3J5XG4gICAqIGdlbmVyYXRlZCBieSB0aGUgYGNkayBzeW50aGAgY29tbWFuZC5cbiAgICpcbiAgICogSWYgeW91IHVzZSBhIGBTaGVsbFN0ZXBgIGhlcmUgYW5kIHlvdSBkb24ndCBjb25maWd1cmUgYW4gb3V0cHV0IGRpcmVjdG9yeSxcbiAgICogdGhlIG91dHB1dCBkaXJlY3Rvcnkgd2lsbCBhdXRvbWF0aWNhbGx5IGJlIGFzc3VtZWQgdG8gYmUgYGNkay5vdXRgLlxuICAgKi9cbiAgcmVhZG9ubHkgc3ludGg6IElGaWxlU2V0UHJvZHVjZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBDb2RlUGlwZWxpbmUgcGlwZWxpbmVcbiAgICpcbiAgICogQGRlZmF1bHQgLSBBdXRvbWF0aWNhbGx5IGdlbmVyYXRlZFxuICAgKi9cbiAgcmVhZG9ubHkgcGlwZWxpbmVOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBDcmVhdGUgS01TIGtleXMgZm9yIHRoZSBhcnRpZmFjdCBidWNrZXRzLCBhbGxvd2luZyBjcm9zcy1hY2NvdW50IGRlcGxveW1lbnRzXG4gICAqXG4gICAqIFRoZSBhcnRpZmFjdCBidWNrZXRzIGhhdmUgdG8gYmUgZW5jcnlwdGVkIHRvIHN1cHBvcnQgZGVwbG95aW5nIENESyBhcHBzIHRvXG4gICAqIGFub3RoZXIgYWNjb3VudCwgc28gaWYgeW91IHdhbnQgdG8gZG8gdGhhdCBvciB3YW50IHRvIGhhdmUgeW91ciBhcnRpZmFjdFxuICAgKiBidWNrZXRzIGVuY3J5cHRlZCwgYmUgc3VyZSB0byBzZXQgdGhpcyB2YWx1ZSB0byBgdHJ1ZWAuXG4gICAqXG4gICAqIEJlIGF3YXJlIHRoZXJlIGlzIGEgY29zdCBhc3NvY2lhdGVkIHdpdGggbWFpbnRhaW5pbmcgdGhlIEtNUyBrZXlzLlxuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgY3Jvc3NBY2NvdW50S2V5cz86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIENESyBDTEkgdmVyc2lvbiB0byB1c2UgaW4gc2VsZi1tdXRhdGlvbiBhbmQgYXNzZXQgcHVibGlzaGluZyBzdGVwc1xuICAgKlxuICAgKiBJZiB5b3Ugd2FudCB0byBsb2NrIHRoZSBDREsgQ0xJIHZlcnNpb24gdXNlZCBpbiB0aGUgcGlwZWxpbmUsIGJ5IHN0ZXBzXG4gICAqIHRoYXQgYXJlIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGZvciB5b3UsIHNwZWNpZnkgdGhlIHZlcnNpb24gaGVyZS5cbiAgICpcbiAgICogV2UgcmVjb21tZW5kIHlvdSBkbyBub3Qgc3BlY2lmeSB0aGlzIHZhbHVlLCBhcyBub3Qgc3BlY2lmeWluZyBpdCBhbHdheXNcbiAgICogdXNlcyB0aGUgbGF0ZXN0IENMSSB2ZXJzaW9uIHdoaWNoIGlzIGJhY2t3YXJkcyBjb21wYXRpYmxlIHdpdGggb2xkIHZlcnNpb25zLlxuICAgKlxuICAgKiBJZiB5b3UgZG8gc3BlY2lmeSBpdCwgYmUgYXdhcmUgdGhhdCB0aGlzIHZlcnNpb24gc2hvdWxkIGFsd2F5cyBiZSBlcXVhbCB0byBvciBoaWdoZXIgdGhhbiB0aGVcbiAgICogdmVyc2lvbiBvZiB0aGUgQ0RLIGZyYW1ld29yayB1c2VkIGJ5IHRoZSBDREsgYXBwLCB3aGVuIHRoZSBDREsgY29tbWFuZHMgYXJlXG4gICAqIHJ1biBkdXJpbmcgeW91ciBwaXBlbGluZSBleGVjdXRpb24uIFdoZW4geW91IGNoYW5nZSB0aGlzIHZlcnNpb24sIHRoZSAqbmV4dFxuICAgKiB0aW1lKiB0aGUgYFNlbGZNdXRhdGVgIHN0ZXAgcnVucyBpdCB3aWxsIHN0aWxsIGJlIHVzaW5nIHRoZSBDTEkgb2YgdGhlIHRoZVxuICAgKiAqcHJldmlvdXMqIHZlcnNpb24gdGhhdCB3YXMgaW4gdGhpcyBwcm9wZXJ0eTogaXQgd2lsbCBvbmx5IHN0YXJ0IHVzaW5nIHRoZVxuICAgKiBuZXcgdmVyc2lvbiBhZnRlciBgU2VsZk11dGF0ZWAgY29tcGxldGVzIHN1Y2Nlc3NmdWxseS4gVGhhdCBtZWFucyB0aGF0IGlmXG4gICAqIHlvdSB3YW50IHRvIHVwZGF0ZSBib3RoIGZyYW1ld29yayBhbmQgQ0xJIHZlcnNpb24sIHlvdSBzaG91bGQgdXBkYXRlIHRoZVxuICAgKiBDTEkgdmVyc2lvbiBmaXJzdCwgY29tbWl0LCBwdXNoIGFuZCBkZXBsb3ksIGFuZCBvbmx5IHRoZW4gdXBkYXRlIHRoZVxuICAgKiBmcmFtZXdvcmsgdmVyc2lvbi5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBMYXRlc3QgdmVyc2lvblxuICAgKi9cbiAgcmVhZG9ubHkgY2xpVmVyc2lvbj86IHN0cmluZztcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgcGlwZWxpbmUgd2lsbCB1cGRhdGUgaXRzZWxmXG4gICAqXG4gICAqIFRoaXMgbmVlZHMgdG8gYmUgc2V0IHRvIGB0cnVlYCB0byBhbGxvdyB0aGUgcGlwZWxpbmUgdG8gcmVjb25maWd1cmVcbiAgICogaXRzZWxmIHdoZW4gYXNzZXRzIG9yIHN0YWdlcyBhcmUgYmVpbmcgYWRkZWQgdG8gaXQsIGFuZCBgdHJ1ZWAgaXMgdGhlXG4gICAqIHJlY29tbWVuZGVkIHNldHRpbmcuXG4gICAqXG4gICAqIFlvdSBjYW4gdGVtcG9yYXJpbHkgc2V0IHRoaXMgdG8gYGZhbHNlYCB3aGlsZSB5b3UgYXJlIGl0ZXJhdGluZ1xuICAgKiBvbiB0aGUgcGlwZWxpbmUgaXRzZWxmIGFuZCBwcmVmZXIgdG8gZGVwbG95IGNoYW5nZXMgdXNpbmcgYGNkayBkZXBsb3lgLlxuICAgKlxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICByZWFkb25seSBzZWxmTXV0YXRpb24/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBFbmFibGUgRG9ja2VyIGZvciB0aGUgc2VsZi1tdXRhdGUgc3RlcFxuICAgKlxuICAgKiBTZXQgdGhpcyB0byB0cnVlIGlmIHRoZSBwaXBlbGluZSBpdHNlbGYgdXNlcyBEb2NrZXIgY29udGFpbmVyIGFzc2V0c1xuICAgKiAoZm9yIGV4YW1wbGUsIGlmIHlvdSB1c2UgYExpbnV4QnVpbGRJbWFnZS5mcm9tQXNzZXQoKWAgYXMgdGhlIGJ1aWxkXG4gICAqIGltYWdlIG9mIGEgQ29kZUJ1aWxkIHN0ZXAgaW4gdGhlIHBpcGVsaW5lKS5cbiAgICpcbiAgICogWW91IGRvIG5vdCBuZWVkIHRvIHNldCBpdCBpZiB5b3UgYnVpbGQgRG9ja2VyIGltYWdlIGFzc2V0cyBpbiB0aGVcbiAgICogYXBwbGljYXRpb24gU3RhZ2VzIGFuZCBTdGFja3MgdGhhdCBhcmUgKmRlcGxveWVkKiBieSB0aGlzIHBpcGVsaW5lLlxuICAgKlxuICAgKiBDb25maWd1cmVzIHByaXZpbGVnZWQgbW9kZSBmb3IgdGhlIHNlbGYtbXV0YXRpb24gQ29kZUJ1aWxkIGFjdGlvbi5cbiAgICpcbiAgICogSWYgeW91IGFyZSBhYm91dCB0byB0dXJuIHRoaXMgb24gaW4gYW4gYWxyZWFkeS1kZXBsb3llZCBQaXBlbGluZSxcbiAgICogc2V0IHRoZSB2YWx1ZSB0byBgdHJ1ZWAgZmlyc3QsIGNvbW1pdCBhbmQgYWxsb3cgdGhlIHBpcGVsaW5lIHRvXG4gICAqIHNlbGYtdXBkYXRlLCBhbmQgb25seSB0aGVuIHVzZSB0aGUgRG9ja2VyIGFzc2V0IGluIHRoZSBwaXBlbGluZS5cbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IGRvY2tlckVuYWJsZWRGb3JTZWxmTXV0YXRpb24/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBFbmFibGUgRG9ja2VyIGZvciB0aGUgJ3N5bnRoJyBzdGVwXG4gICAqXG4gICAqIFNldCB0aGlzIHRvIHRydWUgaWYgeW91IGFyZSB1c2luZyBmaWxlIGFzc2V0cyB0aGF0IHJlcXVpcmVcbiAgICogXCJidW5kbGluZ1wiIGFueXdoZXJlIGluIHlvdXIgYXBwbGljYXRpb24gKG1lYW5pbmcgYW4gYXNzZXRcbiAgICogY29tcGlsYXRpb24gc3RlcCB3aWxsIGJlIHJ1biB3aXRoIHRoZSB0b29scyBwcm92aWRlZCBieVxuICAgKiBhIERvY2tlciBpbWFnZSksIGJvdGggZm9yIHRoZSBQaXBlbGluZSBzdGFjayBhcyB3ZWxsIGFzIHRoZVxuICAgKiBhcHBsaWNhdGlvbiBzdGFja3MuXG4gICAqXG4gICAqIEEgY29tbW9uIHdheSB0byB1c2UgYnVuZGxpbmcgYXNzZXRzIGluIHlvdXIgYXBwbGljYXRpb24gaXMgYnlcbiAgICogdXNpbmcgdGhlIGBAYXdzLWNkay9hd3MtbGFtYmRhLW5vZGVqc2AgbGlicmFyeS5cbiAgICpcbiAgICogQ29uZmlndXJlcyBwcml2aWxlZ2VkIG1vZGUgZm9yIHRoZSBzeW50aCBDb2RlQnVpbGQgYWN0aW9uLlxuICAgKlxuICAgKiBJZiB5b3UgYXJlIGFib3V0IHRvIHR1cm4gdGhpcyBvbiBpbiBhbiBhbHJlYWR5LWRlcGxveWVkIFBpcGVsaW5lLFxuICAgKiBzZXQgdGhlIHZhbHVlIHRvIGB0cnVlYCBmaXJzdCwgY29tbWl0IGFuZCBhbGxvdyB0aGUgcGlwZWxpbmUgdG9cbiAgICogc2VsZi11cGRhdGUsIGFuZCBvbmx5IHRoZW4gdXNlIHRoZSBidW5kbGVkIGFzc2V0LlxuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgZG9ja2VyRW5hYmxlZEZvclN5bnRoPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogQ3VzdG9taXplIHRoZSBDb2RlQnVpbGQgcHJvamVjdHMgY3JlYXRlZCBmb3IgdGhpcyBwaXBlbGluZVxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEFsbCBwcm9qZWN0cyBydW4gbm9uLXByaXZpbGVnZWQgYnVpbGQsIFNNQUxMIGluc3RhbmNlLCBMaW51eEJ1aWxkSW1hZ2UuU1RBTkRBUkRfNl8wXG4gICAqL1xuICByZWFkb25seSBjb2RlQnVpbGREZWZhdWx0cz86IENvZGVCdWlsZE9wdGlvbnM7XG5cbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgY3VzdG9taXphdGlvbnMgdG8gYXBwbHkgdG8gdGhlIHN5bnRoZXNpemUgQ29kZUJ1aWxkIHByb2plY3RzXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gT25seSBgY29kZUJ1aWxkRGVmYXVsdHNgIGFyZSBhcHBsaWVkXG4gICAqL1xuICByZWFkb25seSBzeW50aENvZGVCdWlsZERlZmF1bHRzPzogQ29kZUJ1aWxkT3B0aW9ucztcblxuICAvKipcbiAgICogQWRkaXRpb25hbCBjdXN0b21pemF0aW9ucyB0byBhcHBseSB0byB0aGUgYXNzZXQgcHVibGlzaGluZyBDb2RlQnVpbGQgcHJvamVjdHNcbiAgICpcbiAgICogQGRlZmF1bHQgLSBPbmx5IGBjb2RlQnVpbGREZWZhdWx0c2AgYXJlIGFwcGxpZWRcbiAgICovXG4gIHJlYWRvbmx5IGFzc2V0UHVibGlzaGluZ0NvZGVCdWlsZERlZmF1bHRzPzogQ29kZUJ1aWxkT3B0aW9ucztcblxuICAvKipcbiAgICogQWRkaXRpb25hbCBjdXN0b21pemF0aW9ucyB0byBhcHBseSB0byB0aGUgc2VsZiBtdXRhdGlvbiBDb2RlQnVpbGQgcHJvamVjdHNcbiAgICpcbiAgICogQGRlZmF1bHQgLSBPbmx5IGBjb2RlQnVpbGREZWZhdWx0c2AgYXJlIGFwcGxpZWRcbiAgICovXG4gIHJlYWRvbmx5IHNlbGZNdXRhdGlvbkNvZGVCdWlsZERlZmF1bHRzPzogQ29kZUJ1aWxkT3B0aW9ucztcblxuICAvKipcbiAgICogUHVibGlzaCBhc3NldHMgaW4gbXVsdGlwbGUgQ29kZUJ1aWxkIHByb2plY3RzXG4gICAqXG4gICAqIElmIHNldCB0byBmYWxzZSwgdXNlIG9uZSBQcm9qZWN0IHBlciB0eXBlIHRvIHB1Ymxpc2ggYWxsIGFzc2V0cy5cbiAgICpcbiAgICogUHVibGlzaGluZyBpbiBwYXJhbGxlbCBpbXByb3ZlcyBjb25jdXJyZW5jeSBhbmQgbWF5IHJlZHVjZSBwdWJsaXNoaW5nXG4gICAqIGxhdGVuY3ksIGJ1dCBtYXkgYWxzbyBpbmNyZWFzZSBvdmVyYWxsIHByb3Zpc2lvbmluZyB0aW1lIG9mIHRoZSBDb2RlQnVpbGRcbiAgICogcHJvamVjdHMuXG4gICAqXG4gICAqIEV4cGVyaW1lbnQgYW5kIHNlZSB3aGF0IHZhbHVlIHdvcmtzIGJlc3QgZm9yIHlvdS5cbiAgICpcbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgcmVhZG9ubHkgcHVibGlzaEFzc2V0c0luUGFyYWxsZWw/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBBIGxpc3Qgb2YgY3JlZGVudGlhbHMgdXNlZCB0byBhdXRoZW50aWNhdGUgdG8gRG9ja2VyIHJlZ2lzdHJpZXMuXG4gICAqXG4gICAqIFNwZWNpZnkgYW55IGNyZWRlbnRpYWxzIG5lY2Vzc2FyeSB3aXRoaW4gdGhlIHBpcGVsaW5lIHRvIGJ1aWxkLCBzeW50aCwgdXBkYXRlLCBvciBwdWJsaXNoIGFzc2V0cy5cbiAgICpcbiAgICogQGRlZmF1bHQgW11cbiAgICovXG4gIHJlYWRvbmx5IGRvY2tlckNyZWRlbnRpYWxzPzogRG9ja2VyQ3JlZGVudGlhbFtdO1xuXG4gIC8qKlxuICAgKiBBbiBleGlzdGluZyBQaXBlbGluZSB0byBiZSByZXVzZWQgYW5kIGJ1aWx0IHVwb24uXG4gICAqXG4gICAqIFtkaXNhYmxlLWF3c2xpbnQ6cmVmLXZpYS1pbnRlcmZhY2VdXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gYSBuZXcgdW5kZXJseWluZyBwaXBlbGluZSBpcyBjcmVhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgY29kZVBpcGVsaW5lPzogY3AuUGlwZWxpbmU7XG5cbiAgLyoqXG4gICAqIFJldXNlIHRoZSBzYW1lIGNyb3NzIHJlZ2lvbiBzdXBwb3J0IHN0YWNrIGZvciBhbGwgcGlwZWxpbmVzIGluIHRoZSBBcHAuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdHJ1ZSAoVXNlIHRoZSBzYW1lIHN1cHBvcnQgc3RhY2sgZm9yIGFsbCBwaXBlbGluZXMgaW4gQXBwKVxuICAgKi9cbiAgcmVhZG9ubHkgcmV1c2VDcm9zc1JlZ2lvblN1cHBvcnRTdGFja3M/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBUaGUgSUFNIHJvbGUgdG8gYmUgYXNzdW1lZCBieSB0aGlzIFBpcGVsaW5lXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQSBuZXcgcm9sZSBpcyBjcmVhdGVkXG4gICAqL1xuICByZWFkb25seSByb2xlPzogaWFtLklSb2xlO1xuXG4gIC8qKlxuICAgKiBEZXBsb3kgZXZlcnkgc3RhY2sgYnkgY3JlYXRpbmcgYSBjaGFuZ2Ugc2V0IGFuZCBleGVjdXRpbmcgaXRcbiAgICpcbiAgICogV2hlbiBlbmFibGVkLCBjcmVhdGVzIGEgXCJQcmVwYXJlXCIgYW5kIFwiRXhlY3V0ZVwiIGFjdGlvbiBmb3IgZWFjaCBzdGFjay4gRGlzYWJsZVxuICAgKiB0byBkZXBsb3kgdGhlIHN0YWNrIGluIG9uZSBwaXBlbGluZSBhY3Rpb24uXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHJlYWRvbmx5IHVzZUNoYW5nZVNldHM/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBFbmFibGUgS01TIGtleSByb3RhdGlvbiBmb3IgdGhlIGdlbmVyYXRlZCBLTVMga2V5cy5cbiAgICpcbiAgICogQnkgZGVmYXVsdCBLTVMga2V5IHJvdGF0aW9uIGlzIGRpc2FibGVkLCBidXQgd2lsbCBhZGRcbiAgICogYWRkaXRpb25hbCBjb3N0cyB3aGVuIGVuYWJsZWQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZmFsc2UgKGtleSByb3RhdGlvbiBpcyBkaXNhYmxlZClcbiAgICovXG4gIHJlYWRvbmx5IGVuYWJsZUtleVJvdGF0aW9uPzogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBPcHRpb25zIGZvciBjdXN0b21pemluZyBhIHNpbmdsZSBDb2RlQnVpbGQgcHJvamVjdFxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvZGVCdWlsZE9wdGlvbnMge1xuICAvKipcbiAgICogUGFydGlhbCBidWlsZCBlbnZpcm9ubWVudCwgd2lsbCBiZSBjb21iaW5lZCB3aXRoIG90aGVyIGJ1aWxkIGVudmlyb25tZW50cyB0aGF0IGFwcGx5XG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm9uLXByaXZpbGVnZWQgYnVpbGQsIFNNQUxMIGluc3RhbmNlLCBMaW51eEJ1aWxkSW1hZ2UuU1RBTkRBUkRfNl8wXG4gICAqL1xuICByZWFkb25seSBidWlsZEVudmlyb25tZW50PzogY2IuQnVpbGRFbnZpcm9ubWVudDtcblxuICAvKipcbiAgICogUG9saWN5IHN0YXRlbWVudHMgdG8gYWRkIHRvIHJvbGVcbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBwb2xpY3kgc3RhdGVtZW50cyBhZGRlZCB0byBDb2RlQnVpbGQgUHJvamVjdCBSb2xlXG4gICAqL1xuICByZWFkb25seSByb2xlUG9saWN5PzogaWFtLlBvbGljeVN0YXRlbWVudFtdO1xuXG4gIC8qKlxuICAgKiBQYXJ0aWFsIGJ1aWxkc3BlYywgd2lsbCBiZSBjb21iaW5lZCB3aXRoIG90aGVyIGJ1aWxkc3BlY3MgdGhhdCBhcHBseVxuICAgKlxuICAgKiBUaGUgQnVpbGRTcGVjIG11c3QgYmUgYXZhaWxhYmxlIGlubGluZS0taXQgY2Fubm90IHJlZmVyZW5jZSBhIGZpbGVcbiAgICogb24gZGlzay5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBpbml0aWFsIEJ1aWxkU3BlY1xuICAgKi9cbiAgcmVhZG9ubHkgcGFydGlhbEJ1aWxkU3BlYz86IGNiLkJ1aWxkU3BlYztcblxuICAvKipcbiAgICogV2hpY2ggc2VjdXJpdHkgZ3JvdXAocykgdG8gYXNzb2NpYXRlIHdpdGggdGhlIHByb2plY3QgbmV0d29yayBpbnRlcmZhY2VzLlxuICAgKlxuICAgKiBPbmx5IHVzZWQgaWYgJ3ZwYycgaXMgc3VwcGxpZWQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gU2VjdXJpdHkgZ3JvdXAgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQuXG4gICAqL1xuICByZWFkb25seSBzZWN1cml0eUdyb3Vwcz86IGVjMi5JU2VjdXJpdHlHcm91cFtdO1xuXG4gIC8qKlxuICAgKiBUaGUgVlBDIHdoZXJlIHRvIGNyZWF0ZSB0aGUgQ29kZUJ1aWxkIG5ldHdvcmsgaW50ZXJmYWNlcyBpbi5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBWUENcbiAgICovXG4gIHJlYWRvbmx5IHZwYz86IGVjMi5JVnBjO1xuXG4gIC8qKlxuICAgKiBXaGljaCBzdWJuZXRzIHRvIHVzZS5cbiAgICpcbiAgICogT25seSB1c2VkIGlmICd2cGMnIGlzIHN1cHBsaWVkLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEFsbCBwcml2YXRlIHN1Ym5ldHMuXG4gICAqL1xuICByZWFkb25seSBzdWJuZXRTZWxlY3Rpb24/OiBlYzIuU3VibmV0U2VsZWN0aW9uO1xuXG4gIC8qKlxuICAgKiBDYWNoaW5nIHN0cmF0ZWd5IHRvIHVzZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBjYWNoZVxuICAgKi9cbiAgcmVhZG9ubHkgY2FjaGU/OiBjYi5DYWNoZTtcblxuICAvKipcbiAgICogVGhlIG51bWJlciBvZiBtaW51dGVzIGFmdGVyIHdoaWNoIEFXUyBDb2RlQnVpbGQgc3RvcHMgdGhlIGJ1aWxkIGlmIGl0J3NcbiAgICogbm90IGNvbXBsZXRlLiBGb3IgdmFsaWQgdmFsdWVzLCBzZWUgdGhlIHRpbWVvdXRJbk1pbnV0ZXMgZmllbGQgaW4gdGhlIEFXU1xuICAgKiBDb2RlQnVpbGQgVXNlciBHdWlkZS5cbiAgICpcbiAgICogQGRlZmF1bHQgRHVyYXRpb24uaG91cnMoMSlcbiAgICovXG4gIHJlYWRvbmx5IHRpbWVvdXQ/OiBEdXJhdGlvbjtcblxuICAvKipcbiAgICogUHJvamVjdEZpbGVTeXN0ZW1Mb2NhdGlvbiBvYmplY3RzIGZvciBDb2RlQnVpbGQgYnVpbGQgcHJvamVjdHMuXG4gICAqXG4gICAqIEEgUHJvamVjdEZpbGVTeXN0ZW1Mb2NhdGlvbiBvYmplY3Qgc3BlY2lmaWVzIHRoZSBpZGVudGlmaWVyLCBsb2NhdGlvbiwgbW91bnRPcHRpb25zLCBtb3VudFBvaW50LFxuICAgKiBhbmQgdHlwZSBvZiBhIGZpbGUgc3lzdGVtIGNyZWF0ZWQgdXNpbmcgQW1hem9uIEVsYXN0aWMgRmlsZSBTeXN0ZW0uXG4gICAqIFJlcXVpcmVzIGEgdnBjIHRvIGJlIHNldCBhbmQgcHJpdmlsZWdlZCB0byBiZSBzZXQgdG8gdHJ1ZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBmaWxlIHN5c3RlbSBsb2NhdGlvbnNcbiAgICovXG4gIHJlYWRvbmx5IGZpbGVTeXN0ZW1Mb2NhdGlvbnM/OiBjYi5JRmlsZVN5c3RlbUxvY2F0aW9uW107XG59XG5cblxuLyoqXG4gKiBBIENESyBQaXBlbGluZSB0aGF0IHVzZXMgQ29kZVBpcGVsaW5lIHRvIGRlcGxveSBDREsgYXBwc1xuICpcbiAqIFRoaXMgaXMgYSBgUGlwZWxpbmVgIHdpdGggaXRzIGBlbmdpbmVgIHByb3BlcnR5IHNldCB0b1xuICogYENvZGVQaXBlbGluZUVuZ2luZWAsIGFuZCBleGlzdHMgZm9yIG5pY2VyIGVyZ29ub21pY3MgZm9yXG4gKiB1c2VycyB0aGF0IGRvbid0IG5lZWQgdG8gc3dpdGNoIG91dCBlbmdpbmVzLlxuICovXG5leHBvcnQgY2xhc3MgQ29kZVBpcGVsaW5lIGV4dGVuZHMgUGlwZWxpbmVCYXNlIHtcbiAgLyoqXG4gICAqIFdoZXRoZXIgU2VsZk11dGF0aW9uIGlzIGVuYWJsZWQgZm9yIHRoaXMgQ0RLIFBpcGVsaW5lXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgc2VsZk11dGF0aW9uRW5hYmxlZDogYm9vbGVhbjtcblxuICBwcml2YXRlIF9waXBlbGluZT86IGNwLlBpcGVsaW5lO1xuICBwcml2YXRlIGFydGlmYWN0cyA9IG5ldyBBcnRpZmFjdE1hcCgpO1xuICBwcml2YXRlIF9zeW50aFByb2plY3Q/OiBjYi5JUHJvamVjdDtcbiAgcHJpdmF0ZSBfc2VsZk11dGF0aW9uUHJvamVjdD86IGNiLklQcm9qZWN0O1xuICBwcml2YXRlIHJlYWRvbmx5IHVzZUNoYW5nZVNldHM6IGJvb2xlYW47XG4gIHByaXZhdGUgX215Q3hBc21Sb290Pzogc3RyaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IGRvY2tlckNyZWRlbnRpYWxzOiBEb2NrZXJDcmVkZW50aWFsW107XG4gIHByaXZhdGUgcmVhZG9ubHkgY2FjaGVkRm5TdWIgPSBuZXcgQ2FjaGVkRm5TdWIoKTtcbiAgcHJpdmF0ZSBzdGFja091dHB1dHM6IFN0YWNrT3V0cHV0c01hcDtcblxuICAvKipcbiAgICogQXNzZXQgcm9sZXMgc2hhcmVkIGZvciBwdWJsaXNoaW5nXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGFzc2V0Q29kZUJ1aWxkUm9sZXM6IE1hcDxBc3NldFR5cGUsIEFzc2V0U2luZ2xldG9uUm9sZT4gPSBuZXcgTWFwKCk7XG5cbiAgLyoqXG4gICAqIFRoaXMgaXMgc2V0IHRvIHRoZSB2ZXJ5IGZpcnN0IGFydGlmYWN0IHByb2R1Y2VkIGluIHRoZSBwaXBlbGluZVxuICAgKi9cbiAgcHJpdmF0ZSBfZmFsbGJhY2tBcnRpZmFjdD86IGNwLkFydGlmYWN0O1xuXG4gIHByaXZhdGUgX2Nsb3VkQXNzZW1ibHlGaWxlU2V0PzogRmlsZVNldDtcblxuICBwcml2YXRlIHJlYWRvbmx5IHNpbmdsZVB1Ymxpc2hlclBlckFzc2V0VHlwZTogYm9vbGVhbjtcbiAgcHJpdmF0ZSByZWFkb25seSBjbGlWZXJzaW9uPzogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByaXZhdGUgcmVhZG9ubHkgcHJvcHM6IENvZGVQaXBlbGluZVByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG5cbiAgICB0aGlzLnNlbGZNdXRhdGlvbkVuYWJsZWQgPSBwcm9wcy5zZWxmTXV0YXRpb24gPz8gdHJ1ZTtcbiAgICB0aGlzLmRvY2tlckNyZWRlbnRpYWxzID0gcHJvcHMuZG9ja2VyQ3JlZGVudGlhbHMgPz8gW107XG4gICAgdGhpcy5zaW5nbGVQdWJsaXNoZXJQZXJBc3NldFR5cGUgPSAhKHByb3BzLnB1Ymxpc2hBc3NldHNJblBhcmFsbGVsID8/IHRydWUpO1xuICAgIHRoaXMuY2xpVmVyc2lvbiA9IHByb3BzLmNsaVZlcnNpb24gPz8gcHJlZmVycmVkQ2xpVmVyc2lvbigpO1xuICAgIHRoaXMudXNlQ2hhbmdlU2V0cyA9IHByb3BzLnVzZUNoYW5nZVNldHMgPz8gdHJ1ZTtcbiAgICB0aGlzLnN0YWNrT3V0cHV0cyA9IG5ldyBTdGFja091dHB1dHNNYXAodGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIENvZGVCdWlsZCBwcm9qZWN0IHRoYXQgcGVyZm9ybXMgdGhlIFN5bnRoXG4gICAqXG4gICAqIE9ubHkgYXZhaWxhYmxlIGFmdGVyIHRoZSBwaXBlbGluZSBoYXMgYmVlbiBidWlsdC5cbiAgICovXG4gIHB1YmxpYyBnZXQgc3ludGhQcm9qZWN0KCk6IGNiLklQcm9qZWN0IHtcbiAgICBpZiAoIXRoaXMuX3N5bnRoUHJvamVjdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsIHBpcGVsaW5lLmJ1aWxkUGlwZWxpbmUoKSBiZWZvcmUgcmVhZGluZyB0aGlzIHByb3BlcnR5Jyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9zeW50aFByb2plY3Q7XG4gIH1cblxuICAvKipcbiAgICogVGhlIENvZGVCdWlsZCBwcm9qZWN0IHRoYXQgcGVyZm9ybXMgdGhlIFNlbGZNdXRhdGlvblxuICAgKlxuICAgKiBXaWxsIHRocm93IGFuIGVycm9yIGlmIHRoaXMgaXMgYWNjZXNzZWQgYmVmb3JlIGBidWlsZFBpcGVsaW5lKClgXG4gICAqIGlzIGNhbGxlZCwgb3IgaWYgc2VsZk11dGF0aW9uIGhhcyBiZWVuIGRpc2FibGVkLlxuICAgKi9cbiAgcHVibGljIGdldCBzZWxmTXV0YXRpb25Qcm9qZWN0KCk6IGNiLklQcm9qZWN0IHtcbiAgICBpZiAoIXRoaXMuX3BpcGVsaW5lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGwgcGlwZWxpbmUuYnVpbGRQaXBlbGluZSgpIGJlZm9yZSByZWFkaW5nIHRoaXMgcHJvcGVydHknKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLl9zZWxmTXV0YXRpb25Qcm9qZWN0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHNlbGZNdXRhdGlvblByb2plY3Qgc2luY2UgdGhlIHNlbGZNdXRhdGlvbiBwcm9wZXJ0eSB3YXMgc2V0IHRvIGZhbHNlJyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9zZWxmTXV0YXRpb25Qcm9qZWN0O1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBDb2RlUGlwZWxpbmUgcGlwZWxpbmUgdGhhdCBkZXBsb3lzIHRoZSBDREsgYXBwXG4gICAqXG4gICAqIE9ubHkgYXZhaWxhYmxlIGFmdGVyIHRoZSBwaXBlbGluZSBoYXMgYmVlbiBidWlsdC5cbiAgICovXG4gIHB1YmxpYyBnZXQgcGlwZWxpbmUoKTogY3AuUGlwZWxpbmUge1xuICAgIGlmICghdGhpcy5fcGlwZWxpbmUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUGlwZWxpbmUgbm90IGNyZWF0ZWQgeWV0Jyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9waXBlbGluZTtcbiAgfVxuXG5cbiAgcHJvdGVjdGVkIGRvQnVpbGRQaXBlbGluZSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fcGlwZWxpbmUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUGlwZWxpbmUgYWxyZWFkeSBjcmVhdGVkJyk7XG4gICAgfVxuXG4gICAgdGhpcy5fbXlDeEFzbVJvb3QgPSBwYXRoLnJlc29sdmUoYXNzZW1ibHlCdWlsZGVyT2YoYXBwT2YodGhpcykpLm91dGRpcik7XG5cbiAgICBpZiAodGhpcy5wcm9wcy5jb2RlUGlwZWxpbmUpIHtcbiAgICAgIGlmICh0aGlzLnByb3BzLnBpcGVsaW5lTmFtZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBzZXQgXFwncGlwZWxpbmVOYW1lXFwnIGlmIGFuIGV4aXN0aW5nIENvZGVQaXBlbGluZSBpcyBnaXZlbiB1c2luZyBcXCdjb2RlUGlwZWxpbmVcXCcnKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnByb3BzLmNyb3NzQWNjb3VudEtleXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBzZXQgXFwnY3Jvc3NBY2NvdW50S2V5c1xcJyBpZiBhbiBleGlzdGluZyBDb2RlUGlwZWxpbmUgaXMgZ2l2ZW4gdXNpbmcgXFwnY29kZVBpcGVsaW5lXFwnJyk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5wcm9wcy5lbmFibGVLZXlSb3RhdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNldCBcXCdlbmFibGVLZXlSb3RhdGlvblxcJyBpZiBhbiBleGlzdGluZyBDb2RlUGlwZWxpbmUgaXMgZ2l2ZW4gdXNpbmcgXFwnY29kZVBpcGVsaW5lXFwnJyk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5wcm9wcy5yZXVzZUNyb3NzUmVnaW9uU3VwcG9ydFN0YWNrcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNldCBcXCdyZXVzZUNyb3NzUmVnaW9uU3VwcG9ydFN0YWNrc1xcJyBpZiBhbiBleGlzdGluZyBDb2RlUGlwZWxpbmUgaXMgZ2l2ZW4gdXNpbmcgXFwnY29kZVBpcGVsaW5lXFwnJyk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5wcm9wcy5yb2xlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgc2V0IFxcJ3JvbGVcXCcgaWYgYW4gZXhpc3RpbmcgQ29kZVBpcGVsaW5lIGlzIGdpdmVuIHVzaW5nIFxcJ2NvZGVQaXBlbGluZVxcJycpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9waXBlbGluZSA9IHRoaXMucHJvcHMuY29kZVBpcGVsaW5lO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9waXBlbGluZSA9IG5ldyBjcC5QaXBlbGluZSh0aGlzLCAnUGlwZWxpbmUnLCB7XG4gICAgICAgIHBpcGVsaW5lTmFtZTogdGhpcy5wcm9wcy5waXBlbGluZU5hbWUsXG4gICAgICAgIGNyb3NzQWNjb3VudEtleXM6IHRoaXMucHJvcHMuY3Jvc3NBY2NvdW50S2V5cyA/PyBmYWxzZSxcbiAgICAgICAgcmV1c2VDcm9zc1JlZ2lvblN1cHBvcnRTdGFja3M6IHRoaXMucHJvcHMucmV1c2VDcm9zc1JlZ2lvblN1cHBvcnRTdGFja3MsXG4gICAgICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIG1ha2Ugc2VsZi1tdXRhdGlvbiB3b3JrIChkZXBsb3ltZW50cyBhcmUgZ3VhcmFudGVlZFxuICAgICAgICAvLyB0byBoYXBwZW4gb25seSBhZnRlciB0aGUgYnVpbGRzIG9mIHRoZSBsYXRlc3QgcGlwZWxpbmUgZGVmaW5pdGlvbikuXG4gICAgICAgIHJlc3RhcnRFeGVjdXRpb25PblVwZGF0ZTogdHJ1ZSxcbiAgICAgICAgcm9sZTogdGhpcy5wcm9wcy5yb2xlLFxuICAgICAgICBlbmFibGVLZXlSb3RhdGlvbjogdGhpcy5wcm9wcy5lbmFibGVLZXlSb3RhdGlvbixcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGdyYXBoRnJvbUJwID0gbmV3IFBpcGVsaW5lR3JhcGgodGhpcywge1xuICAgICAgc2VsZk11dGF0aW9uOiB0aGlzLnNlbGZNdXRhdGlvbkVuYWJsZWQsXG4gICAgICBzaW5nbGVQdWJsaXNoZXJQZXJBc3NldFR5cGU6IHRoaXMuc2luZ2xlUHVibGlzaGVyUGVyQXNzZXRUeXBlLFxuICAgICAgcHJlcGFyZVN0ZXA6IHRoaXMudXNlQ2hhbmdlU2V0cyxcbiAgICB9KTtcbiAgICB0aGlzLl9jbG91ZEFzc2VtYmx5RmlsZVNldCA9IGdyYXBoRnJvbUJwLmNsb3VkQXNzZW1ibHlGaWxlU2V0O1xuXG4gICAgdGhpcy5waXBlbGluZVN0YWdlc0FuZEFjdGlvbnNGcm9tR3JhcGgoZ3JhcGhGcm9tQnApO1xuXG4gICAgLy8gV3JpdGUgYSBkb3RmaWxlIGZvciB0aGUgcGlwZWxpbmUgbGF5b3V0XG4gICAgY29uc3QgZG90RmlsZSA9IGAke05hbWVzLnVuaXF1ZUlkKHRoaXMpfS5kb3RgO1xuICAgIGZzLndyaXRlRmlsZVN5bmMocGF0aC5qb2luKHRoaXMubXlDeEFzbVJvb3QsIGRvdEZpbGUpLCBncmFwaEZyb21CcC5ncmFwaC5yZW5kZXJEb3QoKS5yZXBsYWNlKC9pbnB1dFxcLmRvdC8sIGRvdEZpbGUpLCB7IGVuY29kaW5nOiAndXRmLTgnIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgbXlDeEFzbVJvb3QoKTogc3RyaW5nIHtcbiAgICBpZiAoIXRoaXMuX215Q3hBc21Sb290KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhblxcJ3QgcmVhZCBcXCdteUN4QXNtUm9vdFxcJyBpZiBidWlsZCBkZXBsb3ltZW50IG5vdCBjYWxsZWQgeWV0Jyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9teUN4QXNtUm9vdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTY29wZSBmb3IgQXNzZXRzLXJlbGF0ZWQgcmVzb3VyY2VzLlxuICAgKlxuICAgKiBQdXJlbHkgZXhpc3RzIGZvciBjb25zdHJ1Y3QgdHJlZSBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSB3aXRoIGxlZ2FjeSBwaXBlbGluZXNcbiAgICovXG4gIHByaXZhdGUgZ2V0IGFzc2V0c1Njb3BlKCk6IENvbnN0cnVjdCB7XG4gICAgcmV0dXJuIG9idGFpblNjb3BlKHRoaXMsICdBc3NldHMnKTtcbiAgfVxuXG4gIHByaXZhdGUgcGlwZWxpbmVTdGFnZXNBbmRBY3Rpb25zRnJvbUdyYXBoKHN0cnVjdHVyZTogUGlwZWxpbmVHcmFwaCkge1xuICAgIC8vIFRyYW5zbGF0ZSBncmFwaCBpbnRvIFBpcGVsaW5lIFN0YWdlcyBhbmQgQWN0aW9uc1xuICAgIGxldCBiZWZvcmVTZWxmTXV0YXRpb24gPSB0aGlzLnNlbGZNdXRhdGlvbkVuYWJsZWQ7XG4gICAgZm9yIChjb25zdCBzdGFnZU5vZGUgb2YgZmxhdHRlbihzdHJ1Y3R1cmUuZ3JhcGguc29ydGVkQ2hpbGRyZW4oKSkpIHtcbiAgICAgIGlmICghaXNHcmFwaChzdGFnZU5vZGUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVG9wLWxldmVsIGNoaWxkcmVuIG11c3QgYmUgZ3JhcGhzLCBnb3QgJyR7c3RhZ2VOb2RlfSdgKTtcbiAgICAgIH1cblxuICAgICAgLy8gR3JvdXAgb3VyIG9yZGVyZWQgdHJhbmNoZXMgaW50byBibG9ja3Mgb2YgNTAuXG4gICAgICAvLyBXZSBjYW4gbWFwIHRoZXNlIG9udG8gc3RhZ2VzIHdpdGhvdXQgZXhjZWVkaW5nIHRoZSBjYXBhY2l0eSBvZiBhIFN0YWdlLlxuICAgICAgY29uc3QgY2h1bmtzID0gY2h1bmtUcmFuY2hlcyg1MCwgc3RhZ2VOb2RlLnNvcnRlZExlYXZlcygpKTtcbiAgICAgIGNvbnN0IGFjdGlvbnNPdmVyZmxvd1N0YWdlID0gY2h1bmtzLmxlbmd0aCA+IDE7XG4gICAgICBmb3IgKGNvbnN0IFtpLCB0cmFuY2hlc10gb2YgZW51bWVyYXRlKGNodW5rcykpIHtcbiAgICAgICAgY29uc3Qgc3RhZ2VOYW1lID0gYWN0aW9uc092ZXJmbG93U3RhZ2UgPyBgJHtzdGFnZU5vZGUuaWR9LiR7aSArIDF9YCA6IHN0YWdlTm9kZS5pZDtcbiAgICAgICAgY29uc3QgcGlwZWxpbmVTdGFnZSA9IHRoaXMucGlwZWxpbmUuYWRkU3RhZ2UoeyBzdGFnZU5hbWUgfSk7XG5cbiAgICAgICAgY29uc3Qgc2hhcmVkUGFyZW50ID0gbmV3IEdyYXBoTm9kZUNvbGxlY3Rpb24oZmxhdHRlbih0cmFuY2hlcykpLmNvbW1vbkFuY2VzdG9yKCk7XG5cbiAgICAgICAgbGV0IHJ1bk9yZGVyID0gMTtcbiAgICAgICAgZm9yIChjb25zdCB0cmFuY2hlIG9mIHRyYW5jaGVzKSB7XG4gICAgICAgICAgY29uc3QgcnVuT3JkZXJzQ29uc3VtZWQgPSBbMF07XG5cbiAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgdHJhbmNoZSkge1xuICAgICAgICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMuYWN0aW9uRnJvbU5vZGUobm9kZSk7XG5cbiAgICAgICAgICAgIGNvbnN0IG5vZGVUeXBlID0gdGhpcy5ub2RlVHlwZUZyb21Ob2RlKG5vZGUpO1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IGFjdGlvbk5hbWUobm9kZSwgc2hhcmVkUGFyZW50KTtcblxuICAgICAgICAgICAgY29uc3QgdmFyaWFibGVzTmFtZXNwYWNlID0gbm9kZS5kYXRhPy50eXBlID09PSAnc3RlcCdcbiAgICAgICAgICAgICAgPyBuYW1lc3BhY2VTdGVwT3V0cHV0cyhub2RlLmRhdGEuc3RlcCwgcGlwZWxpbmVTdGFnZSwgbmFtZSlcbiAgICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZhY3RvcnkucHJvZHVjZUFjdGlvbihwaXBlbGluZVN0YWdlLCB7XG4gICAgICAgICAgICAgIGFjdGlvbk5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgIHJ1bk9yZGVyLFxuICAgICAgICAgICAgICBhcnRpZmFjdHM6IHRoaXMuYXJ0aWZhY3RzLFxuICAgICAgICAgICAgICBzY29wZTogb2J0YWluU2NvcGUodGhpcy5waXBlbGluZSwgc3RhZ2VOYW1lKSxcbiAgICAgICAgICAgICAgZmFsbGJhY2tBcnRpZmFjdDogdGhpcy5fZmFsbGJhY2tBcnRpZmFjdCxcbiAgICAgICAgICAgICAgcGlwZWxpbmU6IHRoaXMsXG4gICAgICAgICAgICAgIC8vIElmIHRoaXMgc3RlcCBoYXBwZW5zIHRvIHByb2R1Y2UgYSBDb2RlQnVpbGQgam9iLCBzZXQgdGhlIGRlZmF1bHQgb3B0aW9uc1xuICAgICAgICAgICAgICBjb2RlQnVpbGREZWZhdWx0czogbm9kZVR5cGUgPyB0aGlzLmNvZGVCdWlsZERlZmF1bHRzRm9yKG5vZGVUeXBlKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgYmVmb3JlU2VsZk11dGF0aW9uLFxuICAgICAgICAgICAgICB2YXJpYWJsZXNOYW1lc3BhY2UsXG4gICAgICAgICAgICAgIHN0YWNrT3V0cHV0c01hcDogdGhpcy5zdGFja091dHB1dHMsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG5vZGUuZGF0YT8udHlwZSA9PT0gJ3NlbGYtdXBkYXRlJykge1xuICAgICAgICAgICAgICBiZWZvcmVTZWxmTXV0YXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5wb3N0UHJvY2Vzc05vZGUobm9kZSwgcmVzdWx0KTtcblxuICAgICAgICAgICAgcnVuT3JkZXJzQ29uc3VtZWQucHVzaChyZXN1bHQucnVuT3JkZXJzQ29uc3VtZWQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJ1bk9yZGVyICs9IE1hdGgubWF4KC4uLnJ1bk9yZGVyc0NvbnN1bWVkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEbyBhZGRpdGlvbmFsIHRoaW5ncyBhZnRlciB0aGUgYWN0aW9uIGdvdCBhZGRlZCB0byB0aGUgcGlwZWxpbmVcbiAgICpcbiAgICogU29tZSBtaW5vciBzdGF0ZSBtYW5pcHVsYXRpb24gb2YgQ29kZUJ1aWxkIHByb2plY3RzIGFuZCBwaXBlbGluZVxuICAgKiBhcnRpZmFjdHMuXG4gICAqL1xuICBwcml2YXRlIHBvc3RQcm9jZXNzTm9kZShub2RlOiBBR3JhcGhOb2RlLCByZXN1bHQ6IENvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnlSZXN1bHQpIHtcbiAgICBjb25zdCBub2RlVHlwZSA9IHRoaXMubm9kZVR5cGVGcm9tTm9kZShub2RlKTtcblxuICAgIGlmIChyZXN1bHQucHJvamVjdCkge1xuICAgICAgY29uc3QgZG9ja2VyVXNhZ2UgPSBkb2NrZXJVc2FnZUZyb21Db2RlQnVpbGQobm9kZVR5cGUgPz8gQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1RFUCk7XG4gICAgICBpZiAoZG9ja2VyVXNhZ2UpIHtcbiAgICAgICAgZm9yIChjb25zdCBjIG9mIHRoaXMuZG9ja2VyQ3JlZGVudGlhbHMpIHtcbiAgICAgICAgICBjLmdyYW50UmVhZChyZXN1bHQucHJvamVjdCwgZG9ja2VyVXNhZ2UpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChub2RlVHlwZSA9PT0gQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1lOVEgpIHtcbiAgICAgICAgdGhpcy5fc3ludGhQcm9qZWN0ID0gcmVzdWx0LnByb2plY3Q7XG4gICAgICB9XG4gICAgICBpZiAobm9kZVR5cGUgPT09IENvZGVCdWlsZFByb2plY3RUeXBlLlNFTEZfTVVUQVRFKSB7XG4gICAgICAgIHRoaXMuX3NlbGZNdXRhdGlvblByb2plY3QgPSByZXN1bHQucHJvamVjdDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobm9kZS5kYXRhPy50eXBlID09PSAnc3RlcCcgJiYgbm9kZS5kYXRhLnN0ZXAucHJpbWFyeU91dHB1dD8ucHJpbWFyeU91dHB1dCAmJiAhdGhpcy5fZmFsbGJhY2tBcnRpZmFjdCkge1xuICAgICAgdGhpcy5fZmFsbGJhY2tBcnRpZmFjdCA9IHRoaXMuYXJ0aWZhY3RzLnRvQ29kZVBpcGVsaW5lKG5vZGUuZGF0YS5zdGVwLnByaW1hcnlPdXRwdXQ/LnByaW1hcnlPdXRwdXQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNYWtlIGFuIGFjdGlvbiBmcm9tIHRoZSBnaXZlbiBub2RlIGFuZC9vciBzdGVwXG4gICAqL1xuICBwcml2YXRlIGFjdGlvbkZyb21Ob2RlKG5vZGU6IEFHcmFwaE5vZGUpOiBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSB7XG4gICAgc3dpdGNoIChub2RlLmRhdGE/LnR5cGUpIHtcbiAgICAgIC8vIE5vdGhpbmcgZm9yIHRoZXNlLCB0aGV5IGFyZSBncm91cGluZ3MgKHNob3VsZG4ndCBldmVuIGhhdmUgcG9wcGVkIHVwIGhlcmUpXG4gICAgICBjYXNlICdncm91cCc6XG4gICAgICBjYXNlICdzdGFjay1ncm91cCc6XG4gICAgICBjYXNlIHVuZGVmaW5lZDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBhY3Rpb25Gcm9tTm9kZTogZGlkIG5vdCBleHBlY3QgdG8gZ2V0IGdyb3VwIG5vZGVzOiAke25vZGUuZGF0YT8udHlwZX1gKTtcblxuICAgICAgY2FzZSAnc2VsZi11cGRhdGUnOlxuICAgICAgICByZXR1cm4gdGhpcy5zZWxmTXV0YXRlQWN0aW9uKCk7XG5cbiAgICAgIGNhc2UgJ3B1Ymxpc2gtYXNzZXRzJzpcbiAgICAgICAgcmV0dXJuIHRoaXMucHVibGlzaEFzc2V0c0FjdGlvbihub2RlLCBub2RlLmRhdGEuYXNzZXRzKTtcblxuICAgICAgY2FzZSAncHJlcGFyZSc6XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUNoYW5nZVNldEFjdGlvbihub2RlLmRhdGEuc3RhY2spO1xuXG4gICAgICBjYXNlICdleGVjdXRlJzpcbiAgICAgICAgcmV0dXJuIG5vZGUuZGF0YS53aXRob3V0Q2hhbmdlU2V0XG4gICAgICAgICAgPyB0aGlzLmV4ZWN1dGVEZXBsb3ltZW50QWN0aW9uKG5vZGUuZGF0YS5zdGFjaywgbm9kZS5kYXRhLmNhcHR1cmVPdXRwdXRzKVxuICAgICAgICAgIDogdGhpcy5leGVjdXRlQ2hhbmdlU2V0QWN0aW9uKG5vZGUuZGF0YS5zdGFjaywgbm9kZS5kYXRhLmNhcHR1cmVPdXRwdXRzKTtcblxuICAgICAgY2FzZSAnc3RlcCc6XG4gICAgICAgIHJldHVybiB0aGlzLmFjdGlvbkZyb21TdGVwKG5vZGUsIG5vZGUuZGF0YS5zdGVwKTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb2RlUGlwZWxpbmUgZG9lcyBub3Qgc3VwcG9ydCBncmFwaCBub2RlcyBvZiB0eXBlICcke25vZGUuZGF0YT8udHlwZX0nLiBZb3UgYXJlIHByb2JhYmx5IHVzaW5nIGEgZmVhdHVyZSB0aGlzIENESyBQaXBlbGluZXMgaW1wbGVtZW50YXRpb24gZG9lcyBub3Qgc3VwcG9ydC5gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGFrZSBhIFN0ZXAgYW5kIHR1cm4gaXQgaW50byBhIENvZGVQaXBlbGluZSBBY3Rpb25cbiAgICpcbiAgICogVGhlcmUgYXJlIG9ubHkgMyB0eXBlcyBvZiBTdGVwcyB3ZSBuZWVkIHRvIHN1cHBvcnQ6XG4gICAqXG4gICAqIC0gU2hlbGwgKGdlbmVyaWMpXG4gICAqIC0gTWFudWFsQXBwcm92YWwgKGdlbmVyaWMpXG4gICAqIC0gQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSAoQ29kZVBpcGVsaW5lLXNwZWNpZmljKVxuICAgKlxuICAgKiBUaGUgcmVzdCBpcyBleHByZXNzZWQgaW4gdGVybXMgb2YgdGhlc2UgMywgb3IgaW4gdGVybXMgb2YgZ3JhcGggbm9kZXNcbiAgICogd2hpY2ggYXJlIGhhbmRsZWQgZWxzZXdoZXJlLlxuICAgKi9cbiAgcHJpdmF0ZSBhY3Rpb25Gcm9tU3RlcChub2RlOiBBR3JhcGhOb2RlLCBzdGVwOiBTdGVwKTogSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICAgIGNvbnN0IG5vZGVUeXBlID0gdGhpcy5ub2RlVHlwZUZyb21Ob2RlKG5vZGUpO1xuXG4gICAgLy8gQ29kZVBpcGVsaW5lLXNwZWNpZmljIHN0ZXBzIGZpcnN0IC0tIHRoaXMgaW5jbHVkZXMgU291cmNlc1xuICAgIGlmIChpc0NvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkoc3RlcCkpIHtcbiAgICAgIHJldHVybiBzdGVwO1xuICAgIH1cblxuICAgIC8vIE5vdyBidWlsdC1pbiBzdGVwc1xuICAgIGlmIChzdGVwIGluc3RhbmNlb2YgU2hlbGxTdGVwIHx8IHN0ZXAgaW5zdGFuY2VvZiBDb2RlQnVpbGRTdGVwKSB7XG4gICAgICAvLyBUaGUgJ0Nka0J1aWxkUHJvamVjdCcgd2lsbCBiZSB0aGUgY29uc3RydWN0IElEIG9mIHRoZSBDb2RlQnVpbGQgcHJvamVjdCwgbmVjZXNzYXJ5IGZvciBiYWNrd2FyZHMgY29tcGF0XG4gICAgICBsZXQgY29uc3RydWN0SWQgPSBub2RlVHlwZSA9PT0gQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1lOVEhcbiAgICAgICAgPyAnQ2RrQnVpbGRQcm9qZWN0J1xuICAgICAgICA6IHN0ZXAuaWQ7XG5cbiAgICAgIHJldHVybiBzdGVwIGluc3RhbmNlb2YgQ29kZUJ1aWxkU3RlcFxuICAgICAgICA/IENvZGVCdWlsZEZhY3RvcnkuZnJvbUNvZGVCdWlsZFN0ZXAoY29uc3RydWN0SWQsIHN0ZXApXG4gICAgICAgIDogQ29kZUJ1aWxkRmFjdG9yeS5mcm9tU2hlbGxTdGVwKGNvbnN0cnVjdElkLCBzdGVwKTtcbiAgICB9XG5cbiAgICBpZiAoc3RlcCBpbnN0YW5jZW9mIE1hbnVhbEFwcHJvdmFsU3RlcCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJvZHVjZUFjdGlvbjogKHN0YWdlLCBvcHRpb25zKSA9PiB7XG4gICAgICAgICAgc3RhZ2UuYWRkQWN0aW9uKG5ldyBjcGEuTWFudWFsQXBwcm92YWxBY3Rpb24oe1xuICAgICAgICAgICAgYWN0aW9uTmFtZTogb3B0aW9ucy5hY3Rpb25OYW1lLFxuICAgICAgICAgICAgcnVuT3JkZXI6IG9wdGlvbnMucnVuT3JkZXIsXG4gICAgICAgICAgICBhZGRpdGlvbmFsSW5mb3JtYXRpb246IHN0ZXAuY29tbWVudCxcbiAgICAgICAgICB9KSk7XG4gICAgICAgICAgcmV0dXJuIHsgcnVuT3JkZXJzQ29uc3VtZWQ6IDEgfTtcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKGBEZXBsb3ltZW50IHN0ZXAgJyR7c3RlcH0nIGlzIG5vdCBzdXBwb3J0ZWQgZm9yIENvZGVQaXBlbGluZS1iYWNrZWQgcGlwZWxpbmVzYCk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUNoYW5nZVNldEFjdGlvbihzdGFjazogU3RhY2tEZXBsb3ltZW50KTogSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICAgIGNvbnN0IGNoYW5nZVNldE5hbWUgPSAnUGlwZWxpbmVDaGFuZ2UnO1xuXG4gICAgY29uc3QgdGVtcGxhdGVBcnRpZmFjdCA9IHRoaXMuYXJ0aWZhY3RzLnRvQ29kZVBpcGVsaW5lKHRoaXMuX2Nsb3VkQXNzZW1ibHlGaWxlU2V0ISk7XG4gICAgY29uc3QgdGVtcGxhdGVDb25maWd1cmF0aW9uUGF0aCA9IHRoaXMud3JpdGVUZW1wbGF0ZUNvbmZpZ3VyYXRpb24oc3RhY2spO1xuXG4gICAgY29uc3QgcmVnaW9uID0gc3RhY2sucmVnaW9uICE9PSBTdGFjay5vZih0aGlzKS5yZWdpb24gPyBzdGFjay5yZWdpb24gOiB1bmRlZmluZWQ7XG4gICAgY29uc3QgYWNjb3VudCA9IHN0YWNrLmFjY291bnQgIT09IFN0YWNrLm9mKHRoaXMpLmFjY291bnQgPyBzdGFjay5hY2NvdW50IDogdW5kZWZpbmVkO1xuXG4gICAgY29uc3QgcmVsYXRpdmVUZW1wbGF0ZVBhdGggPSBwYXRoLnJlbGF0aXZlKHRoaXMubXlDeEFzbVJvb3QsIHN0YWNrLmFic29sdXRlVGVtcGxhdGVQYXRoKTtcblxuICAgIHJldHVybiB7XG4gICAgICBwcm9kdWNlQWN0aW9uOiAoc3RhZ2UsIG9wdGlvbnMpID0+IHtcbiAgICAgICAgc3RhZ2UuYWRkQWN0aW9uKG5ldyBjcGEuQ2xvdWRGb3JtYXRpb25DcmVhdGVSZXBsYWNlQ2hhbmdlU2V0QWN0aW9uKHtcbiAgICAgICAgICBhY3Rpb25OYW1lOiBvcHRpb25zLmFjdGlvbk5hbWUsXG4gICAgICAgICAgcnVuT3JkZXI6IG9wdGlvbnMucnVuT3JkZXIsXG4gICAgICAgICAgY2hhbmdlU2V0TmFtZSxcbiAgICAgICAgICBzdGFja05hbWU6IHN0YWNrLnN0YWNrTmFtZSxcbiAgICAgICAgICB0ZW1wbGF0ZVBhdGg6IHRlbXBsYXRlQXJ0aWZhY3QuYXRQYXRoKHRvUG9zaXhQYXRoKHJlbGF0aXZlVGVtcGxhdGVQYXRoKSksXG4gICAgICAgICAgYWRtaW5QZXJtaXNzaW9uczogdHJ1ZSxcbiAgICAgICAgICByb2xlOiB0aGlzLnJvbGVGcm9tUGxhY2Vob2xkZXJBcm4odGhpcy5waXBlbGluZSwgcmVnaW9uLCBhY2NvdW50LCBzdGFjay5hc3N1bWVSb2xlQXJuKSxcbiAgICAgICAgICBkZXBsb3ltZW50Um9sZTogdGhpcy5yb2xlRnJvbVBsYWNlaG9sZGVyQXJuKHRoaXMucGlwZWxpbmUsIHJlZ2lvbiwgYWNjb3VudCwgc3RhY2suZXhlY3V0aW9uUm9sZUFybiksXG4gICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgdGVtcGxhdGVDb25maWd1cmF0aW9uOiB0ZW1wbGF0ZUNvbmZpZ3VyYXRpb25QYXRoXG4gICAgICAgICAgICA/IHRlbXBsYXRlQXJ0aWZhY3QuYXRQYXRoKHRvUG9zaXhQYXRoKHRlbXBsYXRlQ29uZmlndXJhdGlvblBhdGgpKVxuICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgY2ZuQ2FwYWJpbGl0aWVzOiBbQ2ZuQ2FwYWJpbGl0aWVzLk5BTUVEX0lBTSwgQ2ZuQ2FwYWJpbGl0aWVzLkFVVE9fRVhQQU5EXSxcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4geyBydW5PcmRlcnNDb25zdW1lZDogMSB9O1xuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBleGVjdXRlQ2hhbmdlU2V0QWN0aW9uKHN0YWNrOiBTdGFja0RlcGxveW1lbnQsIGNhcHR1cmVPdXRwdXRzOiBib29sZWFuKTogSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICAgIGNvbnN0IGNoYW5nZVNldE5hbWUgPSAnUGlwZWxpbmVDaGFuZ2UnO1xuXG4gICAgY29uc3QgcmVnaW9uID0gc3RhY2sucmVnaW9uICE9PSBTdGFjay5vZih0aGlzKS5yZWdpb24gPyBzdGFjay5yZWdpb24gOiB1bmRlZmluZWQ7XG4gICAgY29uc3QgYWNjb3VudCA9IHN0YWNrLmFjY291bnQgIT09IFN0YWNrLm9mKHRoaXMpLmFjY291bnQgPyBzdGFjay5hY2NvdW50IDogdW5kZWZpbmVkO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb2R1Y2VBY3Rpb246IChzdGFnZSwgb3B0aW9ucykgPT4ge1xuICAgICAgICBzdGFnZS5hZGRBY3Rpb24obmV3IGNwYS5DbG91ZEZvcm1hdGlvbkV4ZWN1dGVDaGFuZ2VTZXRBY3Rpb24oe1xuICAgICAgICAgIGFjdGlvbk5hbWU6IG9wdGlvbnMuYWN0aW9uTmFtZSxcbiAgICAgICAgICBydW5PcmRlcjogb3B0aW9ucy5ydW5PcmRlcixcbiAgICAgICAgICBjaGFuZ2VTZXROYW1lLFxuICAgICAgICAgIHN0YWNrTmFtZTogc3RhY2suc3RhY2tOYW1lLFxuICAgICAgICAgIHJvbGU6IHRoaXMucm9sZUZyb21QbGFjZWhvbGRlckFybih0aGlzLnBpcGVsaW5lLCByZWdpb24sIGFjY291bnQsIHN0YWNrLmFzc3VtZVJvbGVBcm4pLFxuICAgICAgICAgIHJlZ2lvbjogcmVnaW9uLFxuICAgICAgICAgIHZhcmlhYmxlc05hbWVzcGFjZTogY2FwdHVyZU91dHB1dHMgPyBzdGFja1ZhcmlhYmxlTmFtZXNwYWNlKHN0YWNrKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIHJldHVybiB7IHJ1bk9yZGVyc0NvbnN1bWVkOiAxIH07XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGV4ZWN1dGVEZXBsb3ltZW50QWN0aW9uKHN0YWNrOiBTdGFja0RlcGxveW1lbnQsIGNhcHR1cmVPdXRwdXRzOiBib29sZWFuKTogSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICAgIGNvbnN0IHRlbXBsYXRlQXJ0aWZhY3QgPSB0aGlzLmFydGlmYWN0cy50b0NvZGVQaXBlbGluZSh0aGlzLl9jbG91ZEFzc2VtYmx5RmlsZVNldCEpO1xuICAgIGNvbnN0IHRlbXBsYXRlQ29uZmlndXJhdGlvblBhdGggPSB0aGlzLndyaXRlVGVtcGxhdGVDb25maWd1cmF0aW9uKHN0YWNrKTtcblxuICAgIGNvbnN0IHJlZ2lvbiA9IHN0YWNrLnJlZ2lvbiAhPT0gU3RhY2sub2YodGhpcykucmVnaW9uID8gc3RhY2sucmVnaW9uIDogdW5kZWZpbmVkO1xuICAgIGNvbnN0IGFjY291bnQgPSBzdGFjay5hY2NvdW50ICE9PSBTdGFjay5vZih0aGlzKS5hY2NvdW50ID8gc3RhY2suYWNjb3VudCA6IHVuZGVmaW5lZDtcblxuICAgIGNvbnN0IHJlbGF0aXZlVGVtcGxhdGVQYXRoID0gcGF0aC5yZWxhdGl2ZSh0aGlzLm15Q3hBc21Sb290LCBzdGFjay5hYnNvbHV0ZVRlbXBsYXRlUGF0aCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcHJvZHVjZUFjdGlvbjogKHN0YWdlLCBvcHRpb25zKSA9PiB7XG4gICAgICAgIHN0YWdlLmFkZEFjdGlvbihuZXcgY3BhLkNsb3VkRm9ybWF0aW9uQ3JlYXRlVXBkYXRlU3RhY2tBY3Rpb24oe1xuICAgICAgICAgIGFjdGlvbk5hbWU6IG9wdGlvbnMuYWN0aW9uTmFtZSxcbiAgICAgICAgICBydW5PcmRlcjogb3B0aW9ucy5ydW5PcmRlcixcbiAgICAgICAgICBzdGFja05hbWU6IHN0YWNrLnN0YWNrTmFtZSxcbiAgICAgICAgICB0ZW1wbGF0ZVBhdGg6IHRlbXBsYXRlQXJ0aWZhY3QuYXRQYXRoKHRvUG9zaXhQYXRoKHJlbGF0aXZlVGVtcGxhdGVQYXRoKSksXG4gICAgICAgICAgYWRtaW5QZXJtaXNzaW9uczogdHJ1ZSxcbiAgICAgICAgICByb2xlOiB0aGlzLnJvbGVGcm9tUGxhY2Vob2xkZXJBcm4odGhpcy5waXBlbGluZSwgcmVnaW9uLCBhY2NvdW50LCBzdGFjay5hc3N1bWVSb2xlQXJuKSxcbiAgICAgICAgICBkZXBsb3ltZW50Um9sZTogdGhpcy5yb2xlRnJvbVBsYWNlaG9sZGVyQXJuKHRoaXMucGlwZWxpbmUsIHJlZ2lvbiwgYWNjb3VudCwgc3RhY2suZXhlY3V0aW9uUm9sZUFybiksXG4gICAgICAgICAgcmVnaW9uOiByZWdpb24sXG4gICAgICAgICAgdGVtcGxhdGVDb25maWd1cmF0aW9uOiB0ZW1wbGF0ZUNvbmZpZ3VyYXRpb25QYXRoXG4gICAgICAgICAgICA/IHRlbXBsYXRlQXJ0aWZhY3QuYXRQYXRoKHRvUG9zaXhQYXRoKHRlbXBsYXRlQ29uZmlndXJhdGlvblBhdGgpKVxuICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgY2ZuQ2FwYWJpbGl0aWVzOiBbQ2ZuQ2FwYWJpbGl0aWVzLk5BTUVEX0lBTSwgQ2ZuQ2FwYWJpbGl0aWVzLkFVVE9fRVhQQU5EXSxcbiAgICAgICAgICB2YXJpYWJsZXNOYW1lc3BhY2U6IGNhcHR1cmVPdXRwdXRzID8gc3RhY2tWYXJpYWJsZU5hbWVzcGFjZShzdGFjaykgOiB1bmRlZmluZWQsXG4gICAgICAgIH0pKTtcblxuICAgICAgICByZXR1cm4geyBydW5PcmRlcnNDb25zdW1lZDogMSB9O1xuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzZWxmTXV0YXRlQWN0aW9uKCk6IElDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IHtcbiAgICBjb25zdCBpbnN0YWxsU3VmZml4ID0gdGhpcy5jbGlWZXJzaW9uID8gYEAke3RoaXMuY2xpVmVyc2lvbn1gIDogJyc7XG5cbiAgICBjb25zdCBwaXBlbGluZVN0YWNrID0gU3RhY2sub2YodGhpcy5waXBlbGluZSk7XG4gICAgY29uc3QgcGlwZWxpbmVTdGFja0lkZW50aWZpZXIgPSBwaXBlbGluZVN0YWNrLm5vZGUucGF0aCA/PyBwaXBlbGluZVN0YWNrLnN0YWNrTmFtZTtcblxuICAgIGNvbnN0IHN0ZXAgPSBuZXcgQ29kZUJ1aWxkU3RlcCgnU2VsZk11dGF0ZScsIHtcbiAgICAgIHByb2plY3ROYW1lOiBtYXliZVN1ZmZpeCh0aGlzLnByb3BzLnBpcGVsaW5lTmFtZSwgJy1zZWxmdXBkYXRlJyksXG4gICAgICBpbnB1dDogdGhpcy5fY2xvdWRBc3NlbWJseUZpbGVTZXQsXG4gICAgICBpbnN0YWxsQ29tbWFuZHM6IFtcbiAgICAgICAgYG5wbSBpbnN0YWxsIC1nIGF3cy1jZGske2luc3RhbGxTdWZmaXh9YCxcbiAgICAgIF0sXG4gICAgICBjb21tYW5kczogW1xuICAgICAgICBgY2RrIC1hICR7dG9Qb3NpeFBhdGgoZW1iZWRkZWRBc21QYXRoKHRoaXMucGlwZWxpbmUpKX0gZGVwbG95ICR7cGlwZWxpbmVTdGFja0lkZW50aWZpZXJ9IC0tcmVxdWlyZS1hcHByb3ZhbD1uZXZlciAtLXZlcmJvc2VgLFxuICAgICAgXSxcblxuICAgICAgcm9sZVBvbGljeVN0YXRlbWVudHM6IFtcbiAgICAgICAgLy8gYWxsb3cgdGhlIHNlbGYtbXV0YXRpbmcgcHJvamVjdCBwZXJtaXNzaW9ucyB0byBhc3N1bWUgdGhlIGJvb3RzdHJhcCBBY3Rpb24gcm9sZVxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydzdHM6QXNzdW1lUm9sZSddLFxuICAgICAgICAgIHJlc291cmNlczogW2Bhcm46KjppYW06OiR7U3RhY2sub2YodGhpcy5waXBlbGluZSkuYWNjb3VudH06cm9sZS8qYF0sXG4gICAgICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICAgICAgJ0ZvckFueVZhbHVlOlN0cmluZ0VxdWFscyc6IHtcbiAgICAgICAgICAgICAgJ2lhbTpSZXNvdXJjZVRhZy9hd3MtY2RrOmJvb3RzdHJhcC1yb2xlJzogWydpbWFnZS1wdWJsaXNoaW5nJywgJ2ZpbGUtcHVibGlzaGluZycsICdkZXBsb3knXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ2Nsb3VkZm9ybWF0aW9uOkRlc2NyaWJlU3RhY2tzJ10sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbJyonXSwgLy8gdGhpcyBpcyBuZWVkZWQgdG8gY2hlY2sgdGhlIHN0YXR1cyBvZiB0aGUgYm9vdHN0cmFwIHN0YWNrIHdoZW4gZG9pbmcgYGNkayBkZXBsb3lgXG4gICAgICAgIH0pLFxuICAgICAgICAvLyBTMyBjaGVja3MgZm9yIHRoZSBwcmVzZW5jZSBvZiB0aGUgTGlzdEJ1Y2tldCBwZXJtaXNzaW9uXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ3MzOkxpc3RCdWNrZXQnXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFsnKiddLFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICAvLyBEaWZmZXJlbnQgb24gcHVycG9zZSAtLSBpZCBuZWVkZWQgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmxlIExvZ2ljYWxJRFxuICAgIHJldHVybiBDb2RlQnVpbGRGYWN0b3J5LmZyb21Db2RlQnVpbGRTdGVwKCdTZWxmTXV0YXRpb24nLCBzdGVwLCB7XG4gICAgICBhZGRpdGlvbmFsQ29uc3RydWN0TGV2ZWw6IGZhbHNlLFxuICAgICAgc2NvcGU6IG9idGFpblNjb3BlKHRoaXMsICdVcGRhdGVQaXBlbGluZScpLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBwdWJsaXNoQXNzZXRzQWN0aW9uKG5vZGU6IEFHcmFwaE5vZGUsIGFzc2V0czogU3RhY2tBc3NldFtdKTogSUNvZGVQaXBlbGluZUFjdGlvbkZhY3Rvcnkge1xuICAgIGNvbnN0IGluc3RhbGxTdWZmaXggPSB0aGlzLmNsaVZlcnNpb24gPyBgQCR7dGhpcy5jbGlWZXJzaW9ufWAgOiAnJztcblxuICAgIGNvbnN0IGNvbW1hbmRzID0gYXNzZXRzLm1hcChhc3NldCA9PiB7XG4gICAgICBjb25zdCByZWxhdGl2ZUFzc2V0TWFuaWZlc3RQYXRoID0gcGF0aC5yZWxhdGl2ZSh0aGlzLm15Q3hBc21Sb290LCBhc3NldC5hc3NldE1hbmlmZXN0UGF0aCk7XG4gICAgICByZXR1cm4gYGNkay1hc3NldHMgLS1wYXRoIFwiJHt0b1Bvc2l4UGF0aChyZWxhdGl2ZUFzc2V0TWFuaWZlc3RQYXRoKX1cIiAtLXZlcmJvc2UgcHVibGlzaCBcIiR7YXNzZXQuYXNzZXRTZWxlY3Rvcn1cImA7XG4gICAgfSk7XG5cbiAgICBjb25zdCBhc3NldFR5cGUgPSBhc3NldHNbMF0uYXNzZXRUeXBlO1xuICAgIGlmIChhc3NldHMuc29tZShhID0+IGEuYXNzZXRUeXBlICE9PSBhc3NldFR5cGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FsbCBhc3NldHMgaW4gYSBzaW5nbGUgcHVibGlzaGluZyBzdGVwIG11c3QgYmUgb2YgdGhlIHNhbWUgdHlwZScpO1xuICAgIH1cblxuICAgIGNvbnN0IHJvbGUgPSB0aGlzLm9idGFpbkFzc2V0Q29kZUJ1aWxkUm9sZShhc3NldHNbMF0uYXNzZXRUeXBlKTtcblxuICAgIGZvciAoY29uc3Qgcm9sZUFybiBvZiBhc3NldHMuZmxhdE1hcChhID0+IGEuYXNzZXRQdWJsaXNoaW5nUm9sZUFybiA/IFthLmFzc2V0UHVibGlzaGluZ1JvbGVBcm5dIDogW10pKSB7XG4gICAgICAvLyBUaGUgQVJOcyBpbmNsdWRlIHJhdyBBV1MgcHNldWRvIHBhcmFtZXRlcnMgKGUuZy4sICR7QVdTOjpQYXJ0aXRpb259KSwgd2hpY2ggbmVlZCB0byBiZSBzdWJzdGl0dXRlZC5cbiAgICAgIHJvbGUuYWRkQXNzdW1lUm9sZSh0aGlzLmNhY2hlZEZuU3ViLmZuU3ViKHJvbGVBcm4pKTtcbiAgICB9O1xuXG4gICAgLy8gVGhlIGJhc2UgY29tbWFuZHMgdGhhdCBuZWVkIHRvIGJlIHJ1blxuICAgIGNvbnN0IHNjcmlwdCA9IG5ldyBDb2RlQnVpbGRTdGVwKG5vZGUuaWQsIHtcbiAgICAgIGNvbW1hbmRzLFxuICAgICAgaW5zdGFsbENvbW1hbmRzOiBbXG4gICAgICAgIGBucG0gaW5zdGFsbCAtZyBjZGstYXNzZXRzJHtpbnN0YWxsU3VmZml4fWAsXG4gICAgICBdLFxuICAgICAgaW5wdXQ6IHRoaXMuX2Nsb3VkQXNzZW1ibHlGaWxlU2V0LFxuICAgICAgYnVpbGRFbnZpcm9ubWVudDoge1xuICAgICAgICBwcml2aWxlZ2VkOiAoXG4gICAgICAgICAgYXNzZXRzLnNvbWUoYXNzZXQgPT4gYXNzZXQuYXNzZXRUeXBlID09PSBBc3NldFR5cGUuRE9DS0VSX0lNQUdFKSB8fFxuICAgICAgICAgIHRoaXMucHJvcHMuY29kZUJ1aWxkRGVmYXVsdHM/LmJ1aWxkRW52aXJvbm1lbnQ/LnByaXZpbGVnZWRcbiAgICAgICAgKSxcbiAgICAgIH0sXG4gICAgICByb2xlLFxuICAgIH0pO1xuXG4gICAgLy8gQ3VzdG9taXphdGlvbnMgdGhhdCBhcmUgbm90IGFjY2Vzc2libGUgdG8gcmVndWxhciB1c2Vyc1xuICAgIHJldHVybiBDb2RlQnVpbGRGYWN0b3J5LmZyb21Db2RlQnVpbGRTdGVwKG5vZGUuaWQsIHNjcmlwdCwge1xuICAgICAgYWRkaXRpb25hbENvbnN0cnVjdExldmVsOiBmYWxzZSxcblxuICAgICAgLy8gSWYgd2UgdXNlIGEgc2luZ2xlIHB1Ymxpc2hlciwgcGFzcyBidWlsZHNwZWMgdmlhIGZpbGUgb3RoZXJ3aXNlIGl0J2xsXG4gICAgICAvLyBncm93IHRvbyBiaWcuXG4gICAgICBwYXNzQnVpbGRTcGVjVmlhQ2xvdWRBc3NlbWJseTogdGhpcy5zaW5nbGVQdWJsaXNoZXJQZXJBc3NldFR5cGUsXG4gICAgICBzY29wZTogdGhpcy5hc3NldHNTY29wZSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgbm9kZVR5cGVGcm9tTm9kZShub2RlOiBBR3JhcGhOb2RlKSB7XG4gICAgaWYgKG5vZGUuZGF0YT8udHlwZSA9PT0gJ3N0ZXAnKSB7XG4gICAgICByZXR1cm4gISFub2RlLmRhdGE/LmlzQnVpbGRTdGVwID8gQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1lOVEggOiBDb2RlQnVpbGRQcm9qZWN0VHlwZS5TVEVQO1xuICAgIH1cbiAgICBpZiAobm9kZS5kYXRhPy50eXBlID09PSAncHVibGlzaC1hc3NldHMnKSB7XG4gICAgICByZXR1cm4gQ29kZUJ1aWxkUHJvamVjdFR5cGUuQVNTRVRTO1xuICAgIH1cbiAgICBpZiAobm9kZS5kYXRhPy50eXBlID09PSAnc2VsZi11cGRhdGUnKSB7XG4gICAgICByZXR1cm4gQ29kZUJ1aWxkUHJvamVjdFR5cGUuU0VMRl9NVVRBVEU7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBwcml2YXRlIGNvZGVCdWlsZERlZmF1bHRzRm9yKG5vZGVUeXBlOiBDb2RlQnVpbGRQcm9qZWN0VHlwZSk6IENvZGVCdWlsZE9wdGlvbnMgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zOiBDb2RlQnVpbGRPcHRpb25zID0ge1xuICAgICAgYnVpbGRFbnZpcm9ubWVudDoge1xuICAgICAgICBidWlsZEltYWdlOiBDREtQX0RFRkFVTFRfQ09ERUJVSUxEX0lNQUdFLFxuICAgICAgICBjb21wdXRlVHlwZTogY2IuQ29tcHV0ZVR5cGUuU01BTEwsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCB0eXBlQmFzZWRDdXN0b21pemF0aW9ucyA9IHtcbiAgICAgIFtDb2RlQnVpbGRQcm9qZWN0VHlwZS5TWU5USF06IHRoaXMucHJvcHMuZG9ja2VyRW5hYmxlZEZvclN5bnRoXG4gICAgICAgID8gbWVyZ2VDb2RlQnVpbGRPcHRpb25zKHRoaXMucHJvcHMuc3ludGhDb2RlQnVpbGREZWZhdWx0cywgeyBidWlsZEVudmlyb25tZW50OiB7IHByaXZpbGVnZWQ6IHRydWUgfSB9KVxuICAgICAgICA6IHRoaXMucHJvcHMuc3ludGhDb2RlQnVpbGREZWZhdWx0cyxcblxuICAgICAgW0NvZGVCdWlsZFByb2plY3RUeXBlLkFTU0VUU106IHRoaXMucHJvcHMuYXNzZXRQdWJsaXNoaW5nQ29kZUJ1aWxkRGVmYXVsdHMsXG5cbiAgICAgIFtDb2RlQnVpbGRQcm9qZWN0VHlwZS5TRUxGX01VVEFURV06IHRoaXMucHJvcHMuZG9ja2VyRW5hYmxlZEZvclNlbGZNdXRhdGlvblxuICAgICAgICA/IG1lcmdlQ29kZUJ1aWxkT3B0aW9ucyh0aGlzLnByb3BzLnNlbGZNdXRhdGlvbkNvZGVCdWlsZERlZmF1bHRzLCB7IGJ1aWxkRW52aXJvbm1lbnQ6IHsgcHJpdmlsZWdlZDogdHJ1ZSB9IH0pXG4gICAgICAgIDogdGhpcy5wcm9wcy5zZWxmTXV0YXRpb25Db2RlQnVpbGREZWZhdWx0cyxcblxuICAgICAgW0NvZGVCdWlsZFByb2plY3RUeXBlLlNURVBdOiB7fSxcbiAgICB9O1xuXG4gICAgY29uc3QgZG9ja2VyVXNhZ2UgPSBkb2NrZXJVc2FnZUZyb21Db2RlQnVpbGQobm9kZVR5cGUpO1xuICAgIGNvbnN0IGRvY2tlckNvbW1hbmRzID0gZG9ja2VyVXNhZ2UgIT09IHVuZGVmaW5lZFxuICAgICAgPyBkb2NrZXJDcmVkZW50aWFsc0luc3RhbGxDb21tYW5kcyhkb2NrZXJVc2FnZSwgdGhpcy5kb2NrZXJDcmVkZW50aWFscywgJ2JvdGgnKVxuICAgICAgOiBbXTtcbiAgICBjb25zdCB0eXBlQmFzZWREb2NrZXJDb21tYW5kcyA9IGRvY2tlckNvbW1hbmRzLmxlbmd0aCA+IDAgPyB7XG4gICAgICBwYXJ0aWFsQnVpbGRTcGVjOiBjYi5CdWlsZFNwZWMuZnJvbU9iamVjdCh7XG4gICAgICAgIHZlcnNpb246ICcwLjInLFxuICAgICAgICBwaGFzZXM6IHtcbiAgICAgICAgICBwcmVfYnVpbGQ6IHtcbiAgICAgICAgICAgIGNvbW1hbmRzOiBkb2NrZXJDb21tYW5kcyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgfSA6IHt9O1xuXG4gICAgcmV0dXJuIG1lcmdlQ29kZUJ1aWxkT3B0aW9ucyhcbiAgICAgIGRlZmF1bHRPcHRpb25zLFxuICAgICAgdGhpcy5wcm9wcy5jb2RlQnVpbGREZWZhdWx0cyxcbiAgICAgIHR5cGVCYXNlZEN1c3RvbWl6YXRpb25zW25vZGVUeXBlXSxcbiAgICAgIHR5cGVCYXNlZERvY2tlckNvbW1hbmRzLFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHJvbGVGcm9tUGxhY2Vob2xkZXJBcm4oc2NvcGU6IENvbnN0cnVjdCwgcmVnaW9uOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICAgYWNjb3VudDogc3RyaW5nIHwgdW5kZWZpbmVkLCBhcm46IHN0cmluZyk6IGlhbS5JUm9sZTtcbiAgcHJpdmF0ZSByb2xlRnJvbVBsYWNlaG9sZGVyQXJuKHNjb3BlOiBDb25zdHJ1Y3QsIHJlZ2lvbjogc3RyaW5nIHwgdW5kZWZpbmVkLFxuICAgIGFjY291bnQ6IHN0cmluZyB8IHVuZGVmaW5lZCwgYXJuOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBpYW0uSVJvbGUgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgcm9sZUZyb21QbGFjZWhvbGRlckFybihzY29wZTogQ29uc3RydWN0LCByZWdpb246IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgICBhY2NvdW50OiBzdHJpbmcgfCB1bmRlZmluZWQsIGFybjogc3RyaW5nIHwgdW5kZWZpbmVkKTogaWFtLklSb2xlIHwgdW5kZWZpbmVkIHtcblxuICAgIGlmICghYXJuKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cblxuICAgIC8vIFVzZSBwbGFjZWhvbGRlciBhcm4gYXMgY29uc3RydWN0IElELlxuICAgIGNvbnN0IGlkID0gYXJuO1xuXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2F3cy9hd3MtY2RrL2lzc3Vlcy83MjU1XG4gICAgbGV0IGV4aXN0aW5nUm9sZSA9IHNjb3BlLm5vZGUudHJ5RmluZENoaWxkKGBJbW11dGFibGVSb2xlJHtpZH1gKSBhcyBpYW0uSVJvbGU7XG4gICAgaWYgKGV4aXN0aW5nUm9sZSkgeyByZXR1cm4gZXhpc3RpbmdSb2xlOyB9XG4gICAgLy8gRm9yIHdoZW4gIzcyNTUgaXMgZml4ZWQuXG4gICAgZXhpc3RpbmdSb2xlID0gc2NvcGUubm9kZS50cnlGaW5kQ2hpbGQoaWQpIGFzIGlhbS5JUm9sZTtcbiAgICBpZiAoZXhpc3RpbmdSb2xlKSB7IHJldHVybiBleGlzdGluZ1JvbGU7IH1cblxuICAgIGNvbnN0IGFyblRvSW1wb3J0ID0gY3hhcGkuRW52aXJvbm1lbnRQbGFjZWhvbGRlcnMucmVwbGFjZShhcm4sIHtcbiAgICAgIHJlZ2lvbjogcmVnaW9uID8/IEF3cy5SRUdJT04sXG4gICAgICBhY2NvdW50SWQ6IGFjY291bnQgPz8gQXdzLkFDQ09VTlRfSUQsXG4gICAgICBwYXJ0aXRpb246IEF3cy5QQVJUSVRJT04sXG4gICAgfSk7XG4gICAgcmV0dXJuIGlhbS5Sb2xlLmZyb21Sb2xlQXJuKHNjb3BlLCBpZCwgYXJuVG9JbXBvcnQsIHsgbXV0YWJsZTogZmFsc2UsIGFkZEdyYW50c1RvUmVzb3VyY2VzOiB0cnVlIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIE5vbi10ZW1wbGF0ZSBjb25maWcgZmlsZXMgZm9yIENvZGVQaXBlbGluZSBhY3Rpb25zXG4gICAqXG4gICAqIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRzIHRhZ3MuXG4gICAqL1xuICBwcml2YXRlIHdyaXRlVGVtcGxhdGVDb25maWd1cmF0aW9uKHN0YWNrOiBTdGFja0RlcGxveW1lbnQpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIGlmIChPYmplY3Qua2V5cyhzdGFjay50YWdzKS5sZW5ndGggPT09IDApIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuXG4gICAgY29uc3QgYWJzQ29uZmlnUGF0aCA9IGAke3N0YWNrLmFic29sdXRlVGVtcGxhdGVQYXRofS5jb25maWcuanNvbmA7XG4gICAgY29uc3QgcmVsYXRpdmVDb25maWdQYXRoID0gcGF0aC5yZWxhdGl2ZSh0aGlzLm15Q3hBc21Sb290LCBhYnNDb25maWdQYXRoKTtcblxuICAgIC8vIFdyaXRlIHRoZSB0ZW1wbGF0ZSBjb25maWd1cmF0aW9uIGZpbGUgKGZvciBwYXJhbWV0ZXJzIGludG8gQ3JlYXRlQ2hhbmdlU2V0IGNhbGwgdGhhdFxuICAgIC8vIGNhbm5vdCBiZSBjb25maWd1cmVkIGFueSBvdGhlciB3YXkpLiBUaGV5IG11c3QgY29tZSBmcm9tIGEgZmlsZSwgYW5kIHRoZXJlJ3MgdW5mb3J0dW5hdGVseVxuICAgIC8vIG5vIGJldHRlciBob29rIHRvIHdyaXRlIHRoaXMgZmlsZSAoYGNvbnN0cnVjdC5vblN5bnRoZXNpemUoKWAgd291bGQgaGF2ZSBiZWVuIHRoZSBwcmltZSBjYW5kaWRhdGVcbiAgICAvLyBidXQgdGhhdCBpcyBiZWluZyBkZXByZWNhdGVkLS1hbmQgRGVwbG95Q2RrU3RhY2tBY3Rpb24gaXNuJ3QgZXZlbiBhIGNvbnN0cnVjdCkuXG4gICAgd3JpdGVUZW1wbGF0ZUNvbmZpZ3VyYXRpb24oYWJzQ29uZmlnUGF0aCwge1xuICAgICAgVGFnczogbm9VbmRlZmluZWQoc3RhY2sudGFncyksXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVsYXRpdmVDb25maWdQYXRoO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgcm9sZSBpcyB1c2VkIGJ5IGJvdGggdGhlIENvZGVQaXBlbGluZSBidWlsZCBhY3Rpb24gYW5kIHJlbGF0ZWQgQ29kZUJ1aWxkIHByb2plY3QuIENvbnNvbGlkYXRpbmcgdGhlc2UgdHdvXG4gICAqIHJvbGVzIGludG8gb25lLCBhbmQgcmUtdXNpbmcgYWNyb3NzIGFsbCBhc3NldHMsIHNhdmVzIHNpZ25pZmljYW50IHNpemUgb2YgdGhlIGZpbmFsIHN5bnRoZXNpemVkIG91dHB1dC5cbiAgICogTW9kZWxlZCBhZnRlciB0aGUgQ29kZVBpcGVsaW5lIHJvbGUgYW5kICdDb2RlUGlwZWxpbmVBY3Rpb25Sb2xlJyByb2xlcy5cbiAgICogR2VuZXJhdGVzIG9uZSByb2xlIHBlciBhc3NldCB0eXBlIHRvIHNlcGFyYXRlIGZpbGUgYW5kIERvY2tlci9pbWFnZS1iYXNlZCBwZXJtaXNzaW9ucy5cbiAgICovXG4gIHByaXZhdGUgb2J0YWluQXNzZXRDb2RlQnVpbGRSb2xlKGFzc2V0VHlwZTogQXNzZXRUeXBlKTogQXNzZXRTaW5nbGV0b25Sb2xlIHtcbiAgICBjb25zdCBleGlzdGluZyA9IHRoaXMuYXNzZXRDb2RlQnVpbGRSb2xlcy5nZXQoYXNzZXRUeXBlKTtcbiAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgIHJldHVybiBleGlzdGluZztcbiAgICB9XG5cbiAgICBjb25zdCBzdGFjayA9IFN0YWNrLm9mKHRoaXMpO1xuXG4gICAgY29uc3Qgcm9sZVByZWZpeCA9IGFzc2V0VHlwZSA9PT0gQXNzZXRUeXBlLkRPQ0tFUl9JTUFHRSA/ICdEb2NrZXInIDogJ0ZpbGUnO1xuICAgIGNvbnN0IGFzc2V0Um9sZSA9IG5ldyBBc3NldFNpbmdsZXRvblJvbGUodGhpcy5hc3NldHNTY29wZSwgYCR7cm9sZVByZWZpeH1Sb2xlYCwge1xuICAgICAgcm9sZU5hbWU6IFBoeXNpY2FsTmFtZS5HRU5FUkFURV9JRl9ORUVERUQsXG4gICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uQ29tcG9zaXRlUHJpbmNpcGFsKFxuICAgICAgICBuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2NvZGVidWlsZC5hbWF6b25hd3MuY29tJyksXG4gICAgICAgIG5ldyBpYW0uQWNjb3VudFByaW5jaXBhbChzdGFjay5hY2NvdW50KSxcbiAgICAgICksXG4gICAgfSk7XG5cbiAgICAvLyBHcmFudCBwdWxsIGFjY2VzcyBmb3IgYW55IEVDUiByZWdpc3RyaWVzIGFuZCBzZWNyZXRzIHRoYXQgZXhpc3RcbiAgICBpZiAoYXNzZXRUeXBlID09PSBBc3NldFR5cGUuRE9DS0VSX0lNQUdFKSB7XG4gICAgICB0aGlzLmRvY2tlckNyZWRlbnRpYWxzLmZvckVhY2gocmVnID0+IHJlZy5ncmFudFJlYWQoYXNzZXRSb2xlLCBEb2NrZXJDcmVkZW50aWFsVXNhZ2UuQVNTRVRfUFVCTElTSElORykpO1xuICAgIH1cblxuICAgIHRoaXMuYXNzZXRDb2RlQnVpbGRSb2xlcy5zZXQoYXNzZXRUeXBlLCBhc3NldFJvbGUpO1xuICAgIHJldHVybiBhc3NldFJvbGU7XG4gIH1cblxufVxuXG5mdW5jdGlvbiBkb2NrZXJVc2FnZUZyb21Db2RlQnVpbGQoY2J0OiBDb2RlQnVpbGRQcm9qZWN0VHlwZSk6IERvY2tlckNyZWRlbnRpYWxVc2FnZSB8IHVuZGVmaW5lZCB7XG4gIHN3aXRjaCAoY2J0KSB7XG4gICAgY2FzZSBDb2RlQnVpbGRQcm9qZWN0VHlwZS5BU1NFVFM6IHJldHVybiBEb2NrZXJDcmVkZW50aWFsVXNhZ2UuQVNTRVRfUFVCTElTSElORztcbiAgICBjYXNlIENvZGVCdWlsZFByb2plY3RUeXBlLlNFTEZfTVVUQVRFOiByZXR1cm4gRG9ja2VyQ3JlZGVudGlhbFVzYWdlLlNFTEZfVVBEQVRFO1xuICAgIGNhc2UgQ29kZUJ1aWxkUHJvamVjdFR5cGUuU1lOVEg6IHJldHVybiBEb2NrZXJDcmVkZW50aWFsVXNhZ2UuU1lOVEg7XG4gICAgY2FzZSBDb2RlQnVpbGRQcm9qZWN0VHlwZS5TVEVQOiByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG59XG5cbmVudW0gQ29kZUJ1aWxkUHJvamVjdFR5cGUge1xuICBTWU5USCA9ICdTWU5USCcsXG4gIEFTU0VUUyA9ICdBU1NFVFMnLFxuICBTRUxGX01VVEFURSA9ICdTRUxGX01VVEFURScsXG4gIFNURVAgPSAnU1RFUCcsXG59XG5cbi8qKlxuICogVGFrZSBhIHNldCBvZiB0cmFuY2hlcyBhbmQgc3BsaXQgdGhlbSB1cCBpbnRvIGdyb3VwcyBzb1xuICogdGhhdCBubyBzZXQgb2YgdHJhbmNoZXMgaGFzIG1vcmUgdGhhbiBuIGl0ZW1zIHRvdGFsXG4gKi9cbmZ1bmN0aW9uIGNodW5rVHJhbmNoZXM8QT4objogbnVtYmVyLCB4c3M6IEFbXVtdKTogQVtdW11bXSB7XG4gIGNvbnN0IHJldDogQVtdW11bXSA9IFtdO1xuXG4gIHdoaWxlICh4c3MubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IHRyYW5jaGVzOiBBW11bXSA9IFtdO1xuICAgIGxldCBjb3VudCA9IDA7XG5cbiAgICB3aGlsZSAoeHNzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHhzID0geHNzWzBdO1xuICAgICAgY29uc3Qgc3BhY2VSZW1haW5pbmcgPSBuIC0gY291bnQ7XG4gICAgICBpZiAoeHMubGVuZ3RoIDw9IHNwYWNlUmVtYWluaW5nKSB7XG4gICAgICAgIHRyYW5jaGVzLnB1c2goeHMpO1xuICAgICAgICBjb3VudCArPSB4cy5sZW5ndGg7XG4gICAgICAgIHhzcy5zaGlmdCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHJhbmNoZXMucHVzaCh4cy5zcGxpY2UoMCwgc3BhY2VSZW1haW5pbmcpKTtcbiAgICAgICAgY291bnQgPSBuO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXQucHVzaCh0cmFuY2hlcyk7XG4gIH1cblxuXG4gIHJldHVybiByZXQ7XG59XG5cbmZ1bmN0aW9uIGlzQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSh4OiBhbnkpOiB4IGlzIElDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5IHtcbiAgcmV0dXJuICEhKHggYXMgSUNvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnkpLnByb2R1Y2VBY3Rpb247XG59XG4iXX0=