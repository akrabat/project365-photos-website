"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../../assertions");
const ccommit = require("../../../aws-codecommit");
const aws_codepipeline_1 = require("../../../aws-codepipeline");
const iam = require("../../../aws-iam");
const sqs = require("../../../aws-sqs");
const cdk = require("../../../core");
const core_1 = require("../../../core");
const cdkp = require("../../lib");
const lib_1 = require("../../lib");
const testhelpers_1 = require("../testhelpers");
let app;
beforeEach(() => {
    app = new testhelpers_1.TestApp();
});
afterEach(() => {
    app.cleanup();
});
const testStageEnv = {
    account: '123456789012',
    region: 'us-east-1',
};
describe('CodePipeline support stack reuse', () => {
    test('CodePipeline generates the same support stack containing the replication Bucket without the need to bootstrap in that environment for multiple pipelines', () => {
        new ReuseCodePipelineStack(app, 'PipelineStackA', {
            env: testhelpers_1.PIPELINE_ENV,
        });
        new ReuseCodePipelineStack(app, 'PipelineStackB', {
            env: testhelpers_1.PIPELINE_ENV,
        });
        const assembly = app.synth();
        // 2 Pipeline Stacks and 1 support stack for both pipeline stacks.
        expect(assembly.stacks.length).toEqual(3);
        assembly.getStackByName(`PipelineStackA-support-${testStageEnv.region}`);
        expect(() => {
            assembly.getStackByName(`PipelineStackB-support-${testStageEnv.region}`);
        }).toThrowError(/Unable to find stack with stack name/);
    });
    test('CodePipeline generates the unique support stack containing the replication Bucket without the need to bootstrap in that environment for multiple pipelines', () => {
        new ReuseCodePipelineStack(app, 'PipelineStackA', {
            env: testhelpers_1.PIPELINE_ENV,
            reuseCrossRegionSupportStacks: false,
        });
        new ReuseCodePipelineStack(app, 'PipelineStackB', {
            env: testhelpers_1.PIPELINE_ENV,
            reuseCrossRegionSupportStacks: false,
        });
        const assembly = app.synth();
        // 2 Pipeline Stacks and 1 support stack for each pipeline stack.
        expect(assembly.stacks.length).toEqual(4);
        const supportStackAArtifact = assembly.getStackByName(`PipelineStackA-support-${testStageEnv.region}`);
        const supportStackBArtifact = assembly.getStackByName(`PipelineStackB-support-${testStageEnv.region}`);
        const supportStackATemplate = assertions_1.Template.fromJSON(supportStackAArtifact.template);
        supportStackATemplate.hasResourceProperties('AWS::S3::Bucket', {
            BucketName: 'pipelinestacka-support-useplicationbucket80db3753a0ebbf052279',
        });
        supportStackATemplate.hasResourceProperties('AWS::KMS::Alias', {
            AliasName: 'alias/pport-ustencryptionalias5cad45754e1ff088476b',
        });
        const supportStackBTemplate = assertions_1.Template.fromJSON(supportStackBArtifact.template);
        supportStackBTemplate.hasResourceProperties('AWS::S3::Bucket', {
            BucketName: 'pipelinestackb-support-useplicationbucket1d556ec7f959b336abf8',
        });
        supportStackBTemplate.hasResourceProperties('AWS::KMS::Alias', {
            AliasName: 'alias/pport-ustencryptionalias668c7ffd0de17c9867b0',
        });
    });
});
describe('Providing codePipeline parameter and prop(s) of codePipeline parameter to CodePipeline constructor should throw error', () => {
    test('Providing codePipeline parameter and pipelineName parameter should throw error', () => {
        expect(() => new CodePipelinePropsCheckTest(app, 'CodePipeline', {
            pipelineName: 'randomName',
        }).create()).toThrowError('Cannot set \'pipelineName\' if an existing CodePipeline is given using \'codePipeline\'');
    });
    test('Providing codePipeline parameter and enableKeyRotation parameter should throw error', () => {
        expect(() => new CodePipelinePropsCheckTest(app, 'CodePipeline', {
            enableKeyRotation: true,
        }).create()).toThrowError('Cannot set \'enableKeyRotation\' if an existing CodePipeline is given using \'codePipeline\'');
    });
    test('Providing codePipeline parameter and crossAccountKeys parameter should throw error', () => {
        expect(() => new CodePipelinePropsCheckTest(app, 'CodePipeline', {
            crossAccountKeys: true,
        }).create()).toThrowError('Cannot set \'crossAccountKeys\' if an existing CodePipeline is given using \'codePipeline\'');
    });
    test('Providing codePipeline parameter and reuseCrossRegionSupportStacks parameter should throw error', () => {
        expect(() => new CodePipelinePropsCheckTest(app, 'CodePipeline', {
            reuseCrossRegionSupportStacks: true,
        }).create()).toThrowError('Cannot set \'reuseCrossRegionSupportStacks\' if an existing CodePipeline is given using \'codePipeline\'');
    });
    test('Providing codePipeline parameter and role parameter should throw error', () => {
        const stack = new core_1.Stack(app, 'Stack');
        expect(() => new CodePipelinePropsCheckTest(stack, 'CodePipeline', {
            role: new iam.Role(stack, 'Role', {
                assumedBy: new iam.ServicePrincipal('codebuild.amazonaws.com'),
            }),
        }).create()).toThrowError('Cannot set \'role\' if an existing CodePipeline is given using \'codePipeline\'');
    });
});
test('Policy sizes do not exceed the maximum size', () => {
    const pipelineStack = new cdk.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
    pipelineStack.node.setContext('@aws-cdk/aws-iam:minimizePolicies', true);
    const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
        crossAccountKeys: true,
    });
    // WHEN
    const regions = ['us-east-1', 'us-east-2', 'eu-west-1', 'eu-west-2', 'somethingelse1', 'somethingelse-2', 'yapregion', 'more-region'];
    for (let i = 0; i < 70; i++) {
        pipeline.addStage(new testhelpers_1.FileAssetApp(pipelineStack, `App${i}`, {
            env: {
                account: `account${i}`,
                region: regions[i % regions.length],
            },
        }), {
            post: [
                new cdkp.ShellStep('DoAThing', { commands: ['true'] }),
                new cdkp.ShellStep('DoASecondThing', { commands: ['false'] }),
            ],
        });
    }
    // THEN
    const template = assertions_1.Template.fromStack(pipelineStack);
    // Collect policies by role
    const rolePolicies = {};
    for (const pol of Object.values(template.findResources('AWS::IAM::Policy'))) {
        for (const roleName of pol.Properties?.Roles ?? []) {
            const roleLogicalId = roleName.Ref; // Roles: [ { Ref: MyRole } ]
            if (!roleLogicalId) {
                continue;
            }
            if (!rolePolicies[roleLogicalId]) {
                rolePolicies[roleLogicalId] = [];
            }
            rolePolicies[roleLogicalId].push(pol.Properties.PolicyDocument);
        }
    }
    // Validate sizes
    //
    // Not entirely accurate, because our "Ref"s and "Fn::GetAtt"s actually need to be evaluated
    // to ARNs... but it gives an order-of-magnitude indication.
    // 10% of margin for CFN intrinsics like { Fn::Join } and { Ref: 'AWS::Partition' } which don't contribute to
    // the ACTUAL size, but do contribute to the measured size here.
    const cfnOverheadMargin = 1.10;
    for (const [logId, poldoc] of Object.entries(rolePolicies)) {
        const totalJson = JSON.stringify(poldoc);
        if (totalJson.length > 10000 * cfnOverheadMargin) {
            throw new Error(`Policy for Role ${logId} is too large (${totalJson.length} bytes): ${JSON.stringify(poldoc, undefined, 2)}`);
        }
    }
    for (const [logId, poldoc] of Object.entries(template.findResources('AWS::IAM::ManagedPolicy'))) {
        const totalJson = JSON.stringify(poldoc);
        if (totalJson.length > 6000 * cfnOverheadMargin) {
            throw new Error(`Managed Policy ${logId} is too large (${totalJson.length} bytes): ${JSON.stringify(poldoc, undefined, 2)}`);
        }
    }
    assertions_1.Annotations.fromStack(pipelineStack).hasNoWarning('*', assertions_1.Match.anyValue());
});
test('CodeBuild action role has the right AssumeRolePolicyDocument', () => {
    const pipelineStack = new cdk.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
    new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
    const template = assertions_1.Template.fromStack(pipelineStack);
    template.hasResourceProperties('AWS::IAM::Role', {
        AssumeRolePolicyDocument: {
            Statement: [
                {
                    Action: 'sts:AssumeRole',
                    Principal: {
                        AWS: { 'Fn::Join': ['', ['arn:', { Ref: 'AWS::Partition' }, ':iam::123pipeline:root']] },
                    },
                    Condition: {
                        Bool: {
                            'aws:ViaAWSService': 'codepipeline.amazonaws.com',
                        },
                    },
                },
            ],
        },
    });
});
test('CodePipeline throws when key rotation is enabled without enabling cross account keys', () => {
    const pipelineStack = new cdk.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
    const repo = new ccommit.Repository(pipelineStack, 'Repo', {
        repositoryName: 'MyRepo',
    });
    const cdkInput = cdkp.CodePipelineSource.codeCommit(repo, 'main');
    expect(() => new lib_1.CodePipeline(pipelineStack, 'Pipeline', {
        enableKeyRotation: true,
        synth: new cdkp.ShellStep('Synth', {
            input: cdkInput,
            installCommands: ['npm ci'],
            commands: [
                'npm run build',
                'npx cdk synth',
            ],
        }),
    }).buildPipeline()).toThrowError('Setting \'enableKeyRotation\' to true also requires \'crossAccountKeys\' to be enabled');
});
test('CodePipeline enables key rotation on cross account keys', () => {
    const pipelineStack = new cdk.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
    const repo = new ccommit.Repository(pipelineStack, 'Repo', {
        repositoryName: 'MyRepo',
    });
    const cdkInput = cdkp.CodePipelineSource.codeCommit(repo, 'main');
    new lib_1.CodePipeline(pipelineStack, 'Pipeline', {
        enableKeyRotation: true,
        crossAccountKeys: true,
        synth: new cdkp.ShellStep('Synth', {
            input: cdkInput,
            installCommands: ['npm ci'],
            commands: [
                'npm run build',
                'npx cdk synth',
            ],
        }),
    });
    const template = assertions_1.Template.fromStack(pipelineStack);
    template.hasResourceProperties('AWS::KMS::Key', {
        EnableKeyRotation: true,
    });
});
test('CodePipeline supports use of existing role', () => {
    const pipelineStack = new cdk.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
    const repo = new ccommit.Repository(pipelineStack, 'Repo', {
        repositoryName: 'MyRepo',
    });
    const cdkInput = cdkp.CodePipelineSource.codeCommit(repo, 'main');
    new lib_1.CodePipeline(pipelineStack, 'Pipeline', {
        synth: new cdkp.ShellStep('Synth', {
            input: cdkInput,
            installCommands: ['npm ci'],
            commands: [
                'npm run build',
                'npx cdk synth',
            ],
        }),
        role: new iam.Role(pipelineStack, 'CustomRole', {
            assumedBy: new iam.ServicePrincipal('codepipeline.amazonaws.com'),
            roleName: 'MyCustomPipelineRole',
        }),
    });
    const template = assertions_1.Template.fromStack(pipelineStack);
    template.hasResourceProperties('AWS::IAM::Role', {
        AssumeRolePolicyDocument: {
            Statement: [
                {
                    Action: 'sts:AssumeRole',
                    Effect: 'Allow',
                    Principal: {
                        Service: 'codepipeline.amazonaws.com',
                    },
                },
            ],
        },
        RoleName: 'MyCustomPipelineRole',
    });
    template.hasResourceProperties('AWS::CodePipeline::Pipeline', {
        RoleArn: { 'Fn::GetAtt': ['CustomRole6D8E6809', 'Arn'] },
    });
});
describe('deployment of stack', () => {
    test('is done with Prepare and Deploy step by default', () => {
        const pipelineStack = new cdk.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
            crossAccountKeys: true,
        });
        pipeline.addStage(new testhelpers_1.FileAssetApp(pipelineStack, 'App', {}));
        // THEN
        const template = assertions_1.Template.fromStack(pipelineStack);
        // There should be Prepare step in piepline
        template.hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Actions: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            Configuration: assertions_1.Match.objectLike({
                                ActionMode: 'CHANGE_SET_REPLACE',
                            }),
                            Name: 'Prepare',
                        }),
                        assertions_1.Match.objectLike({
                            Configuration: assertions_1.Match.objectLike({
                                ActionMode: 'CHANGE_SET_EXECUTE',
                            }),
                            Name: 'Deploy',
                        }),
                    ]),
                    Name: 'App',
                }]),
        });
    });
    test('can be done with single step', () => {
        const pipelineStack = new cdk.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
            crossAccountKeys: true,
            useChangeSets: false,
        });
        pipeline.addStage(new testhelpers_1.FileAssetApp(pipelineStack, 'App', {}));
        // THEN
        const template = assertions_1.Template.fromStack(pipelineStack);
        // There should be Prepare step in piepline
        template.hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Actions: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            Configuration: assertions_1.Match.objectLike({
                                ActionMode: 'CREATE_UPDATE',
                            }),
                            Name: 'Deploy',
                        }),
                    ]),
                    Name: 'App',
                }]),
        });
    });
});
test('action name is calculated properly if it has cross-stack dependencies', () => {
    // GIVEN
    const pipelineStack = new cdk.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
    const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
        crossAccountKeys: true,
    });
    // WHEN
    const s1step = new cdkp.ManualApprovalStep('S1');
    const s2step = new cdkp.ManualApprovalStep('S2');
    s1step.addStepDependency(s2step);
    // The issue we were diagnosing only manifests if the stacks don't have
    // a dependency on each other
    const stage = new testhelpers_1.TwoStackApp(app, 'TheApp', { withDependency: false });
    pipeline.addStage(stage, {
        stackSteps: [
            { stack: stage.stack1, post: [s1step] },
            { stack: stage.stack2, post: [s2step] },
        ],
    });
    // THEN
    const template = assertions_1.Template.fromStack(pipelineStack);
    template.hasResourceProperties('AWS::CodePipeline::Pipeline', {
        Stages: assertions_1.Match.arrayWith([{
                Name: 'TheApp',
                Actions: assertions_1.Match.arrayWith([
                    assertions_1.Match.objectLike({ Name: 'Stack2.S2', RunOrder: 3 }),
                    assertions_1.Match.objectLike({ Name: 'Stack1.S1', RunOrder: 4 }),
                ]),
            }]),
    });
});
test('synths with change set approvers', () => {
    // GIVEN
    const pipelineStack = new cdk.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
    const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
    // WHEN
    const csApproval = new cdkp.ManualApprovalStep('ChangeSetApproval');
    // The issue we were diagnosing only manifests if the stacks don't have
    // a dependency on each other
    const stage = new testhelpers_1.TwoStackApp(app, 'TheApp', { withDependency: false });
    pipeline.addStage(stage, {
        stackSteps: [
            { stack: stage.stack1, changeSet: [csApproval] },
            { stack: stage.stack2, changeSet: [csApproval] },
        ],
    });
    // THEN
    const template = assertions_1.Template.fromStack(pipelineStack);
    template.hasResourceProperties('AWS::CodePipeline::Pipeline', {
        Stages: assertions_1.Match.arrayWith([{
                Name: 'TheApp',
                Actions: assertions_1.Match.arrayWith([
                    assertions_1.Match.objectLike({ Name: 'Stack1.Prepare', RunOrder: 1 }),
                    assertions_1.Match.objectLike({ Name: 'Stack2.Prepare', RunOrder: 1 }),
                    assertions_1.Match.objectLike({ Name: 'Stack1.ChangeSetApproval', RunOrder: 2 }),
                    assertions_1.Match.objectLike({ Name: 'Stack1.Deploy', RunOrder: 3 }),
                    assertions_1.Match.objectLike({ Name: 'Stack2.Deploy', RunOrder: 3 }),
                ]),
            }]),
    });
});
test('selfMutationProject can be accessed after buildPipeline', () => {
    // GIVEN
    const pipelineStack = new cdk.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
    const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
    pipeline.addStage(new testhelpers_1.StageWithStackOutput(pipelineStack, 'Stage'));
    // WHEN
    pipeline.buildPipeline();
    // THEN
    expect(pipeline.selfMutationProject).toBeTruthy();
});
test('selfMutationProject is undefined if switched off', () => {
    // GIVEN
    const pipelineStack = new cdk.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
    const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
        selfMutation: false,
    });
    pipeline.addStage(new testhelpers_1.StageWithStackOutput(pipelineStack, 'Stage'));
    // WHEN
    pipeline.buildPipeline();
    // THEN
    expect(() => pipeline.selfMutationProject).toThrow(/No selfMutationProject/);
});
class ReuseCodePipelineStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        const repo = new ccommit.Repository(this, 'Repo', {
            repositoryName: 'MyRepo',
        });
        const cdkInput = cdkp.CodePipelineSource.codeCommit(repo, 'main');
        const synthStep = new cdkp.ShellStep('Synth', {
            input: cdkInput,
            installCommands: ['npm ci'],
            commands: [
                'npm run build',
                'npx cdk synth',
            ],
        });
        const pipeline = new cdkp.CodePipeline(this, 'Pipeline', {
            synth: synthStep,
            selfMutation: true,
            crossAccountKeys: true,
            reuseCrossRegionSupportStacks: props.reuseCrossRegionSupportStacks,
        });
        const stage = new ReuseStage(this, `SampleStage-${testStageEnv.account}-${testStageEnv.region}`, {
            env: testStageEnv,
        });
        pipeline.addStage(stage);
    }
}
class ReuseStage extends cdk.Stage {
    constructor(scope, id, props) {
        super(scope, id, props);
        new ReuseStack(this, 'SampleStack', {});
    }
}
class ReuseStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        new sqs.Queue(this, 'Queue');
    }
}
class CodePipelinePropsCheckTest extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        this.cProps = props;
    }
    create() {
        if (this.cProps.pipelineName !== undefined) {
            new cdkp.CodePipeline(this, 'CodePipeline1', {
                pipelineName: this.cProps.pipelineName,
                codePipeline: new aws_codepipeline_1.Pipeline(this, 'Pipeline1'),
                synth: new cdkp.ShellStep('Synth', { commands: ['ls'] }),
            }).buildPipeline();
        }
        if (this.cProps.crossAccountKeys !== undefined) {
            new cdkp.CodePipeline(this, 'CodePipeline2', {
                crossAccountKeys: this.cProps.crossAccountKeys,
                codePipeline: new aws_codepipeline_1.Pipeline(this, 'Pipeline2'),
                synth: new cdkp.ShellStep('Synth', { commands: ['ls'] }),
            }).buildPipeline();
        }
        if (this.cProps.enableKeyRotation !== undefined) {
            new cdkp.CodePipeline(this, 'CodePipeline3', {
                enableKeyRotation: this.cProps.enableKeyRotation,
                codePipeline: new aws_codepipeline_1.Pipeline(this, 'Pipeline3'),
                synth: new cdkp.ShellStep('Synth', { commands: ['ls'] }),
            }).buildPipeline();
        }
        if (this.cProps.reuseCrossRegionSupportStacks !== undefined) {
            new cdkp.CodePipeline(this, 'CodePipeline4', {
                reuseCrossRegionSupportStacks: this.cProps.reuseCrossRegionSupportStacks,
                codePipeline: new aws_codepipeline_1.Pipeline(this, 'Pipeline4'),
                synth: new cdkp.ShellStep('Synth', { commands: ['ls'] }),
            }).buildPipeline();
        }
        if (this.cProps.role !== undefined) {
            new cdkp.CodePipeline(this, 'CodePipeline5', {
                role: this.cProps.role,
                codePipeline: new aws_codepipeline_1.Pipeline(this, 'Pipeline5'),
                synth: new cdkp.ShellStep('Synth', { commands: ['ls'] }),
            }).buildPipeline();
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZXBpcGVsaW5lLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjb2RlcGlwZWxpbmUudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG9EQUFtRTtBQUNuRSxtREFBbUQ7QUFDbkQsZ0VBQXFEO0FBQ3JELHdDQUF3QztBQUN4Qyx3Q0FBd0M7QUFDeEMscUNBQXFDO0FBQ3JDLHdDQUFzQztBQUV0QyxrQ0FBa0M7QUFDbEMsbUNBQXlDO0FBQ3pDLGdEQUFxSTtBQUVySSxJQUFJLEdBQVksQ0FBQztBQUVqQixVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2QsR0FBRyxHQUFHLElBQUkscUJBQU8sRUFBRSxDQUFDO0FBQ3RCLENBQUMsQ0FBQyxDQUFDO0FBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtJQUNiLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUNoQixDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sWUFBWSxHQUE4QjtJQUM5QyxPQUFPLEVBQUUsY0FBYztJQUN2QixNQUFNLEVBQUUsV0FBVztDQUNwQixDQUFDO0FBRUYsUUFBUSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtJQUNoRCxJQUFJLENBQUMsMEpBQTBKLEVBQUUsR0FBRyxFQUFFO1FBQ3BLLElBQUksc0JBQXNCLENBQUMsR0FBRyxFQUFFLGdCQUFnQixFQUFFO1lBQ2hELEdBQUcsRUFBRSwwQkFBWTtTQUNsQixDQUFDLENBQUM7UUFDSCxJQUFJLHNCQUFzQixDQUFDLEdBQUcsRUFBRSxnQkFBZ0IsRUFBRTtZQUNoRCxHQUFHLEVBQUUsMEJBQVk7U0FDbEIsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzdCLGtFQUFrRTtRQUNsRSxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUMsUUFBUSxDQUFDLGNBQWMsQ0FB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QUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2FBQ3pELENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztTQUNwQjtRQUNELElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyw2QkFBNkIsS0FBSyxTQUFTLEVBQUU7WUFDM0QsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxlQUFlLEVBQUU7Z0JBQzNDLDZCQUE2QixFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsNkJBQTZCO2dCQUN4RSxZQUFZLEVBQUUsSUFBSSwyQkFBUSxDQUFDLElBQUksRUFBRSxXQUFXLENBQUM7Z0JBQzdDLEtBQUssRUFBRSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLEVBQUUsUUFBUSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQzthQUN6RCxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDcEI7UUFDRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLFNBQVMsRUFBRTtZQUNsQyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLGVBQWUsRUFBRTtnQkFDM0MsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSTtnQkFDdEIsWUFBWSxFQUFFLElBQUksMkJBQVEsQ0FBQyxJQUFJLEVBQUUsV0FBVyxDQUFDO2dCQUM3QyxLQUFLLEVBQUUsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxFQUFFLFFBQVEsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7YUFDekQsQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO1NBQ3BCO0tBQ0Y7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlbXBsYXRlLCBBbm5vdGF0aW9ucywgTWF0Y2ggfSBmcm9tICcuLi8uLi8uLi9hc3NlcnRpb25zJztcbmltcG9ydCAqIGFzIGNjb21taXQgZnJvbSAnLi4vLi4vLi4vYXdzLWNvZGVjb21taXQnO1xuaW1wb3J0IHsgUGlwZWxpbmUgfSBmcm9tICcuLi8uLi8uLi9hd3MtY29kZXBpcGVsaW5lJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICcuLi8uLi8uLi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIHNxcyBmcm9tICcuLi8uLi8uLi9hd3Mtc3FzJztcbmltcG9ydCAqIGFzIGNkayBmcm9tICcuLi8uLi8uLi9jb3JlJztcbmltcG9ydCB7IFN0YWNrIH0gZnJvbSAnLi4vLi4vLi4vY29yZSc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCAqIGFzIGNka3AgZnJvbSAnLi4vLi4vbGliJztcbmltcG9ydCB7IENvZGVQaXBlbGluZSB9IGZyb20gJy4uLy4uL2xpYic7XG5pbXBvcnQgeyBQSVBFTElORV9FTlYsIFRlc3RBcHAsIE1vZGVyblRlc3RHaXRIdWJOcG1QaXBlbGluZSwgRmlsZUFzc2V0QXBwLCBUd29TdGFja0FwcCwgU3RhZ2VXaXRoU3RhY2tPdXRwdXQgfSBmcm9tICcuLi90ZXN0aGVscGVycyc7XG5cbmxldCBhcHA6IFRlc3RBcHA7XG5cbmJlZm9yZUVhY2goKCkgPT4ge1xuICBhcHAgPSBuZXcgVGVzdEFwcCgpO1xufSk7XG5cbmFmdGVyRWFjaCgoKSA9PiB7XG4gIGFwcC5jbGVhbnVwKCk7XG59KTtcblxuY29uc3QgdGVzdFN0YWdlRW52OiBSZXF1aXJlZDxjZGsuRW52aXJvbm1lbnQ+ID0ge1xuICBhY2NvdW50OiAnMTIzNDU2Nzg5MDEyJyxcbiAgcmVnaW9uOiAndXMtZWFzdC0xJyxcbn07XG5cbmRlc2NyaWJlKCdDb2RlUGlwZWxpbmUgc3VwcG9ydCBzdGFjayByZXVzZScsICgpID0+IHtcbiAgdGVzdCgnQ29kZVBpcGVsaW5lIGdlbmVyYXRlcyB0aGUgc2FtZSBzdXBwb3J0IHN0YWNrIGNvbnRhaW5pbmcgdGhlIHJlcGxpY2F0aW9uIEJ1Y2tldCB3aXRob3V0IHRoZSBuZWVkIHRvIGJvb3RzdHJhcCBpbiB0aGF0IGVudmlyb25tZW50IGZvciBtdWx0aXBsZSBwaXBlbGluZXMnLCAoKSA9PiB7XG4gICAgbmV3IFJldXNlQ29kZVBpcGVsaW5lU3RhY2soYXBwLCAnUGlwZWxpbmVTdGFja0EnLCB7XG4gICAgICBlbnY6IFBJUEVMSU5FX0VOVixcbiAgICB9KTtcbiAgICBuZXcgUmV1c2VDb2RlUGlwZWxpbmVTdGFjayhhcHAsICdQaXBlbGluZVN0YWNrQicsIHtcbiAgICAgIGVudjogUElQRUxJTkVfRU5WLFxuICAgIH0pO1xuICAgIGNvbnN0IGFzc2VtYmx5ID0gYXBwLnN5bnRoKCk7XG4gICAgLy8gMiBQaXBlbGluZSBTdGFja3MgYW5kIDEgc3VwcG9ydCBzdGFjayBmb3IgYm90aCBwaXBlbGluZSBzdGFja3MuXG4gICAgZXhwZWN0KGFzc2VtYmx5LnN0YWNrcy5sZW5ndGgpLnRvRXF1YWwoMyk7XG4gICAgYXNzZW1ibHkuZ2V0U3RhY2tCeU5hbWUoYFBpcGVsaW5lU3RhY2tBLXN1cHBvcnQtJHt0ZXN0U3RhZ2VFbnYucmVnaW9ufWApO1xuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBhc3NlbWJseS5nZXRTdGFja0J5TmFtZShgUGlwZWxpbmVTdGFja0Itc3VwcG9ydC0ke3Rlc3RTdGFnZUVudi5yZWdpb259YCk7XG4gICAgfSkudG9UaHJvd0Vycm9yKC9VbmFibGUgdG8gZmluZCBzdGFjayB3aXRoIHN0YWNrIG5hbWUvKTtcbiAgfSk7XG5cbiAgdGVzdCgnQ29kZVBpcGVsaW5lIGdlbmVyYXRlcyB0aGUgdW5pcXVlIHN1cHBvcnQgc3RhY2sgY29udGFpbmluZyB0aGUgcmVwbGljYXRpb24gQnVja2V0IHdpdGhvdXQgdGhlIG5lZWQgdG8gYm9vdHN0cmFwIGluIHRoYXQgZW52aXJvbm1lbnQgZm9yIG11bHRpcGxlIHBpcGVsaW5lcycsICgpID0+IHtcbiAgICBuZXcgUmV1c2VDb2RlUGlwZWxpbmVTdGFjayhhcHAsICdQaXBlbGluZVN0YWNrQScsIHtcbiAgICAgIGVudjogUElQRUxJTkVfRU5WLFxuICAgICAgcmV1c2VDcm9zc1JlZ2lvblN1cHBvcnRTdGFja3M6IGZhbHNlLFxuICAgIH0pO1xuICAgIG5ldyBSZXVzZUNvZGVQaXBlbGluZVN0YWNrKGFwcCwgJ1BpcGVsaW5lU3RhY2tCJywge1xuICAgICAgZW52OiBQSVBFTElORV9FTlYsXG4gICAgICByZXVzZUNyb3NzUmVnaW9uU3VwcG9ydFN0YWNrczogZmFsc2UsXG4gICAgfSk7XG4gICAgY29uc3QgYXNzZW1ibHkgPSBhcHAuc3ludGgoKTtcbiAgICAvLyAyIFBpcGVsaW5lIFN0YWNrcyBhbmQgMSBzdXBwb3J0IHN0YWNrIGZvciBlYWNoIHBpcGVsaW5lIHN0YWNrLlxuICAgIGV4cGVjdChhc3NlbWJseS5zdGFja3MubGVuZ3RoKS50b0VxdWFsKDQpO1xuICAgIGNvbnN0IHN1cHBvcnRTdGFja0FBcnRpZmFjdCA9IGFzc2VtYmx5LmdldFN0YWNrQnlOYW1lKGBQaXBlbGluZVN0YWNrQS1zdXBwb3J0LSR7dGVzdFN0YWdlRW52LnJlZ2lvbn1gKTtcbiAgICBjb25zdCBzdXBwb3J0U3RhY2tCQXJ0aWZhY3QgPSBhc3NlbWJseS5nZXRTdGFja0J5TmFtZShgUGlwZWxpbmVTdGFja0Itc3VwcG9ydC0ke3Rlc3RTdGFnZUVudi5yZWdpb259YCk7XG5cbiAgICBjb25zdCBzdXBwb3J0U3RhY2tBVGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tSlNPTihzdXBwb3J0U3RhY2tBQXJ0aWZhY3QudGVtcGxhdGUpO1xuICAgIHN1cHBvcnRTdGFja0FUZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6UzM6OkJ1Y2tldCcsIHtcbiAgICAgIEJ1Y2tldE5hbWU6ICdwaXBlbGluZXN0YWNrYS1zdXBwb3J0LXVzZXBsaWNhdGlvbmJ1Y2tldDgwZGIzNzUzYTBlYmJmMDUyMjc5JyxcbiAgICB9KTtcbiAgICBzdXBwb3J0U3RhY2tBVGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OktNUzo6QWxpYXMnLCB7XG4gICAgICBBbGlhc05hbWU6ICdhbGlhcy9wcG9ydC11c3RlbmNyeXB0aW9uYWxpYXM1Y2FkNDU3NTRlMWZmMDg4NDc2YicsXG4gICAgfSk7XG5cbiAgICBjb25zdCBzdXBwb3J0U3RhY2tCVGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tSlNPTihzdXBwb3J0U3RhY2tCQXJ0aWZhY3QudGVtcGxhdGUpO1xuICAgIHN1cHBvcnRTdGFja0JUZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6UzM6OkJ1Y2tldCcsIHtcbiAgICAgIEJ1Y2tldE5hbWU6ICdwaXBlbGluZXN0YWNrYi1zdXBwb3J0LXVzZXBsaWNhdGlvbmJ1Y2tldDFkNTU2ZWM3Zjk1OWIzMzZhYmY4JyxcbiAgICB9KTtcbiAgICBzdXBwb3J0U3RhY2tCVGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OktNUzo6QWxpYXMnLCB7XG4gICAgICBBbGlhc05hbWU6ICdhbGlhcy9wcG9ydC11c3RlbmNyeXB0aW9uYWxpYXM2NjhjN2ZmZDBkZTE3Yzk4NjdiMCcsXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdQcm92aWRpbmcgY29kZVBpcGVsaW5lIHBhcmFtZXRlciBhbmQgcHJvcChzKSBvZiBjb2RlUGlwZWxpbmUgcGFyYW1ldGVyIHRvIENvZGVQaXBlbGluZSBjb25zdHJ1Y3RvciBzaG91bGQgdGhyb3cgZXJyb3InLCAoKSA9PiB7XG4gIHRlc3QoJ1Byb3ZpZGluZyBjb2RlUGlwZWxpbmUgcGFyYW1ldGVyIGFuZCBwaXBlbGluZU5hbWUgcGFyYW1ldGVyIHNob3VsZCB0aHJvdyBlcnJvcicsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4gbmV3IENvZGVQaXBlbGluZVByb3BzQ2hlY2tUZXN0KGFwcCwgJ0NvZGVQaXBlbGluZScsIHtcbiAgICAgIHBpcGVsaW5lTmFtZTogJ3JhbmRvbU5hbWUnLFxuICAgIH0pLmNyZWF0ZSgpKS50b1Rocm93RXJyb3IoJ0Nhbm5vdCBzZXQgXFwncGlwZWxpbmVOYW1lXFwnIGlmIGFuIGV4aXN0aW5nIENvZGVQaXBlbGluZSBpcyBnaXZlbiB1c2luZyBcXCdjb2RlUGlwZWxpbmVcXCcnKTtcbiAgfSk7XG4gIHRlc3QoJ1Byb3ZpZGluZyBjb2RlUGlwZWxpbmUgcGFyYW1ldGVyIGFuZCBlbmFibGVLZXlSb3RhdGlvbiBwYXJhbWV0ZXIgc2hvdWxkIHRocm93IGVycm9yJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgQ29kZVBpcGVsaW5lUHJvcHNDaGVja1Rlc3QoYXBwLCAnQ29kZVBpcGVsaW5lJywge1xuICAgICAgZW5hYmxlS2V5Um90YXRpb246IHRydWUsXG4gICAgfSkuY3JlYXRlKCkpLnRvVGhyb3dFcnJvcignQ2Fubm90IHNldCBcXCdlbmFibGVLZXlSb3RhdGlvblxcJyBpZiBhbiBleGlzdGluZyBDb2RlUGlwZWxpbmUgaXMgZ2l2ZW4gdXNpbmcgXFwnY29kZVBpcGVsaW5lXFwnJyk7XG4gIH0pO1xuICB0ZXN0KCdQcm92aWRpbmcgY29kZVBpcGVsaW5lIHBhcmFtZXRlciBhbmQgY3Jvc3NBY2NvdW50S2V5cyBwYXJhbWV0ZXIgc2hvdWxkIHRocm93IGVycm9yJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgQ29kZVBpcGVsaW5lUHJvcHNDaGVja1Rlc3QoYXBwLCAnQ29kZVBpcGVsaW5lJywge1xuICAgICAgY3Jvc3NBY2NvdW50S2V5czogdHJ1ZSxcbiAgICB9KS5jcmVhdGUoKSkudG9UaHJvd0Vycm9yKCdDYW5ub3Qgc2V0IFxcJ2Nyb3NzQWNjb3VudEtleXNcXCcgaWYgYW4gZXhpc3RpbmcgQ29kZVBpcGVsaW5lIGlzIGdpdmVuIHVzaW5nIFxcJ2NvZGVQaXBlbGluZVxcJycpO1xuICB9KTtcbiAgdGVzdCgnUHJvdmlkaW5nIGNvZGVQaXBlbGluZSBwYXJhbWV0ZXIgYW5kIHJldXNlQ3Jvc3NSZWdpb25TdXBwb3J0U3RhY2tzIHBhcmFtZXRlciBzaG91bGQgdGhyb3cgZXJyb3InLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IG5ldyBDb2RlUGlwZWxpbmVQcm9wc0NoZWNrVGVzdChhcHAsICdDb2RlUGlwZWxpbmUnLCB7XG4gICAgICByZXVzZUNyb3NzUmVnaW9uU3VwcG9ydFN0YWNrczogdHJ1ZSxcbiAgICB9KS5jcmVhdGUoKSkudG9UaHJvd0Vycm9yKCdDYW5ub3Qgc2V0IFxcJ3JldXNlQ3Jvc3NSZWdpb25TdXBwb3J0U3RhY2tzXFwnIGlmIGFuIGV4aXN0aW5nIENvZGVQaXBlbGluZSBpcyBnaXZlbiB1c2luZyBcXCdjb2RlUGlwZWxpbmVcXCcnKTtcbiAgfSk7XG4gIHRlc3QoJ1Byb3ZpZGluZyBjb2RlUGlwZWxpbmUgcGFyYW1ldGVyIGFuZCByb2xlIHBhcmFtZXRlciBzaG91bGQgdGhyb3cgZXJyb3InLCAoKSA9PiB7XG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnU3RhY2snKTtcblxuICAgIGV4cGVjdCgoKSA9PiBuZXcgQ29kZVBpcGVsaW5lUHJvcHNDaGVja1Rlc3Qoc3RhY2ssICdDb2RlUGlwZWxpbmUnLCB7XG4gICAgICByb2xlOiBuZXcgaWFtLlJvbGUoc3RhY2ssICdSb2xlJywge1xuICAgICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnY29kZWJ1aWxkLmFtYXpvbmF3cy5jb20nKSxcbiAgICAgIH0pLFxuICAgIH0pLmNyZWF0ZSgpKS50b1Rocm93RXJyb3IoJ0Nhbm5vdCBzZXQgXFwncm9sZVxcJyBpZiBhbiBleGlzdGluZyBDb2RlUGlwZWxpbmUgaXMgZ2l2ZW4gdXNpbmcgXFwnY29kZVBpcGVsaW5lXFwnJyk7XG4gIH0pO1xufSk7XG5cbnRlc3QoJ1BvbGljeSBzaXplcyBkbyBub3QgZXhjZWVkIHRoZSBtYXhpbXVtIHNpemUnLCAoKSA9PiB7XG4gIGNvbnN0IHBpcGVsaW5lU3RhY2sgPSBuZXcgY2RrLlN0YWNrKGFwcCwgJ1BpcGVsaW5lU3RhY2snLCB7IGVudjogUElQRUxJTkVfRU5WIH0pO1xuICBwaXBlbGluZVN0YWNrLm5vZGUuc2V0Q29udGV4dCgnQGF3cy1jZGsvYXdzLWlhbTptaW5pbWl6ZVBvbGljaWVzJywgdHJ1ZSk7XG4gIGNvbnN0IHBpcGVsaW5lID0gbmV3IE1vZGVyblRlc3RHaXRIdWJOcG1QaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ2RrJywge1xuICAgIGNyb3NzQWNjb3VudEtleXM6IHRydWUsXG4gIH0pO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgcmVnaW9ucyA9IFsndXMtZWFzdC0xJywgJ3VzLWVhc3QtMicsICdldS13ZXN0LTEnLCAnZXUtd2VzdC0yJywgJ3NvbWV0aGluZ2Vsc2UxJywgJ3NvbWV0aGluZ2Vsc2UtMicsICd5YXByZWdpb24nLCAnbW9yZS1yZWdpb24nXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCA3MDsgaSsrKSB7XG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UobmV3IEZpbGVBc3NldEFwcChwaXBlbGluZVN0YWNrLCBgQXBwJHtpfWAsIHtcbiAgICAgIGVudjoge1xuICAgICAgICBhY2NvdW50OiBgYWNjb3VudCR7aX1gLFxuICAgICAgICByZWdpb246IHJlZ2lvbnNbaSAlIHJlZ2lvbnMubGVuZ3RoXSxcbiAgICAgIH0sXG4gICAgfSksIHtcbiAgICAgIHBvc3Q6IFtcbiAgICAgICAgbmV3IGNka3AuU2hlbGxTdGVwKCdEb0FUaGluZycsIHsgY29tbWFuZHM6IFsndHJ1ZSddIH0pLFxuICAgICAgICBuZXcgY2RrcC5TaGVsbFN0ZXAoJ0RvQVNlY29uZFRoaW5nJywgeyBjb21tYW5kczogWydmYWxzZSddIH0pLFxuICAgICAgXSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFRIRU5cbiAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2socGlwZWxpbmVTdGFjayk7XG5cbiAgLy8gQ29sbGVjdCBwb2xpY2llcyBieSByb2xlXG4gIGNvbnN0IHJvbGVQb2xpY2llczogUmVjb3JkPHN0cmluZywgYW55W10+ID0ge307XG4gIGZvciAoY29uc3QgcG9sIG9mIE9iamVjdC52YWx1ZXModGVtcGxhdGUuZmluZFJlc291cmNlcygnQVdTOjpJQU06OlBvbGljeScpKSkge1xuICAgIGZvciAoY29uc3Qgcm9sZU5hbWUgb2YgcG9sLlByb3BlcnRpZXM/LlJvbGVzID8/IFtdKSB7XG4gICAgICBjb25zdCByb2xlTG9naWNhbElkID0gcm9sZU5hbWUuUmVmOyAvLyBSb2xlczogWyB7IFJlZjogTXlSb2xlIH0gXVxuICAgICAgaWYgKCFyb2xlTG9naWNhbElkKSB7IGNvbnRpbnVlOyB9XG5cbiAgICAgIGlmICghcm9sZVBvbGljaWVzW3JvbGVMb2dpY2FsSWRdKSB7XG4gICAgICAgIHJvbGVQb2xpY2llc1tyb2xlTG9naWNhbElkXSA9IFtdO1xuICAgICAgfVxuXG4gICAgICByb2xlUG9saWNpZXNbcm9sZUxvZ2ljYWxJZF0ucHVzaChwb2wuUHJvcGVydGllcy5Qb2xpY3lEb2N1bWVudCk7XG4gICAgfVxuICB9XG5cbiAgLy8gVmFsaWRhdGUgc2l6ZXNcbiAgLy9cbiAgLy8gTm90IGVudGlyZWx5IGFjY3VyYXRlLCBiZWNhdXNlIG91ciBcIlJlZlwicyBhbmQgXCJGbjo6R2V0QXR0XCJzIGFjdHVhbGx5IG5lZWQgdG8gYmUgZXZhbHVhdGVkXG4gIC8vIHRvIEFSTnMuLi4gYnV0IGl0IGdpdmVzIGFuIG9yZGVyLW9mLW1hZ25pdHVkZSBpbmRpY2F0aW9uLlxuICAvLyAxMCUgb2YgbWFyZ2luIGZvciBDRk4gaW50cmluc2ljcyBsaWtlIHsgRm46OkpvaW4gfSBhbmQgeyBSZWY6ICdBV1M6OlBhcnRpdGlvbicgfSB3aGljaCBkb24ndCBjb250cmlidXRlIHRvXG4gIC8vIHRoZSBBQ1RVQUwgc2l6ZSwgYnV0IGRvIGNvbnRyaWJ1dGUgdG8gdGhlIG1lYXN1cmVkIHNpemUgaGVyZS5cbiAgY29uc3QgY2ZuT3ZlcmhlYWRNYXJnaW4gPSAxLjEwO1xuXG4gIGZvciAoY29uc3QgW2xvZ0lkLCBwb2xkb2NdIG9mIE9iamVjdC5lbnRyaWVzKHJvbGVQb2xpY2llcykpIHtcbiAgICBjb25zdCB0b3RhbEpzb24gPSBKU09OLnN0cmluZ2lmeShwb2xkb2MpO1xuICAgIGlmICh0b3RhbEpzb24ubGVuZ3RoID4gMTAwMDAgKiBjZm5PdmVyaGVhZE1hcmdpbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBQb2xpY3kgZm9yIFJvbGUgJHtsb2dJZH0gaXMgdG9vIGxhcmdlICgke3RvdGFsSnNvbi5sZW5ndGh9IGJ5dGVzKTogJHtKU09OLnN0cmluZ2lmeShwb2xkb2MsIHVuZGVmaW5lZCwgMil9YCk7XG4gICAgfVxuICB9XG5cbiAgZm9yIChjb25zdCBbbG9nSWQsIHBvbGRvY10gb2YgT2JqZWN0LmVudHJpZXModGVtcGxhdGUuZmluZFJlc291cmNlcygnQVdTOjpJQU06Ok1hbmFnZWRQb2xpY3knKSkpIHtcbiAgICBjb25zdCB0b3RhbEpzb24gPSBKU09OLnN0cmluZ2lmeShwb2xkb2MpO1xuICAgIGlmICh0b3RhbEpzb24ubGVuZ3RoID4gNjAwMCAqIGNmbk92ZXJoZWFkTWFyZ2luKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE1hbmFnZWQgUG9saWN5ICR7bG9nSWR9IGlzIHRvbyBsYXJnZSAoJHt0b3RhbEpzb24ubGVuZ3RofSBieXRlcyk6ICR7SlNPTi5zdHJpbmdpZnkocG9sZG9jLCB1bmRlZmluZWQsIDIpfWApO1xuICAgIH1cbiAgfVxuXG4gIEFubm90YXRpb25zLmZyb21TdGFjayhwaXBlbGluZVN0YWNrKS5oYXNOb1dhcm5pbmcoJyonLCBNYXRjaC5hbnlWYWx1ZSgpKTtcbn0pO1xuXG50ZXN0KCdDb2RlQnVpbGQgYWN0aW9uIHJvbGUgaGFzIHRoZSByaWdodCBBc3N1bWVSb2xlUG9saWN5RG9jdW1lbnQnLCAoKSA9PiB7XG4gIGNvbnN0IHBpcGVsaW5lU3RhY2sgPSBuZXcgY2RrLlN0YWNrKGFwcCwgJ1BpcGVsaW5lU3RhY2snLCB7IGVudjogUElQRUxJTkVfRU5WIH0pO1xuICBuZXcgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnKTtcblxuICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhwaXBlbGluZVN0YWNrKTtcbiAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6Um9sZScsIHtcbiAgICBBc3N1bWVSb2xlUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgIFN0YXRlbWVudDogW1xuICAgICAgICB7XG4gICAgICAgICAgQWN0aW9uOiAnc3RzOkFzc3VtZVJvbGUnLFxuICAgICAgICAgIFByaW5jaXBhbDoge1xuICAgICAgICAgICAgQVdTOiB7ICdGbjo6Sm9pbic6IFsnJywgWydhcm46JywgeyBSZWY6ICdBV1M6OlBhcnRpdGlvbicgfSwgJzppYW06OjEyM3BpcGVsaW5lOnJvb3QnXV0gfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIENvbmRpdGlvbjoge1xuICAgICAgICAgICAgQm9vbDoge1xuICAgICAgICAgICAgICAnYXdzOlZpYUFXU1NlcnZpY2UnOiAnY29kZXBpcGVsaW5lLmFtYXpvbmF3cy5jb20nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCdDb2RlUGlwZWxpbmUgdGhyb3dzIHdoZW4ga2V5IHJvdGF0aW9uIGlzIGVuYWJsZWQgd2l0aG91dCBlbmFibGluZyBjcm9zcyBhY2NvdW50IGtleXMnLCAoKT0+e1xuICBjb25zdCBwaXBlbGluZVN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdQaXBlbGluZVN0YWNrJywgeyBlbnY6IFBJUEVMSU5FX0VOViB9KTtcbiAgY29uc3QgcmVwbyA9IG5ldyBjY29tbWl0LlJlcG9zaXRvcnkocGlwZWxpbmVTdGFjaywgJ1JlcG8nLCB7XG4gICAgcmVwb3NpdG9yeU5hbWU6ICdNeVJlcG8nLFxuICB9KTtcbiAgY29uc3QgY2RrSW5wdXQgPSBjZGtwLkNvZGVQaXBlbGluZVNvdXJjZS5jb2RlQ29tbWl0KFxuICAgIHJlcG8sXG4gICAgJ21haW4nLFxuICApO1xuXG4gIGV4cGVjdCgoKSA9PiBuZXcgQ29kZVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdQaXBlbGluZScsIHtcbiAgICBlbmFibGVLZXlSb3RhdGlvbjogdHJ1ZSxcbiAgICBzeW50aDogbmV3IGNka3AuU2hlbGxTdGVwKCdTeW50aCcsIHtcbiAgICAgIGlucHV0OiBjZGtJbnB1dCxcbiAgICAgIGluc3RhbGxDb21tYW5kczogWyducG0gY2knXSxcbiAgICAgIGNvbW1hbmRzOiBbXG4gICAgICAgICducG0gcnVuIGJ1aWxkJyxcbiAgICAgICAgJ25weCBjZGsgc3ludGgnLFxuICAgICAgXSxcbiAgICB9KSxcbiAgfSkuYnVpbGRQaXBlbGluZSgpKS50b1Rocm93RXJyb3IoJ1NldHRpbmcgXFwnZW5hYmxlS2V5Um90YXRpb25cXCcgdG8gdHJ1ZSBhbHNvIHJlcXVpcmVzIFxcJ2Nyb3NzQWNjb3VudEtleXNcXCcgdG8gYmUgZW5hYmxlZCcpO1xufSk7XG5cblxudGVzdCgnQ29kZVBpcGVsaW5lIGVuYWJsZXMga2V5IHJvdGF0aW9uIG9uIGNyb3NzIGFjY291bnQga2V5cycsICgpPT57XG4gIGNvbnN0IHBpcGVsaW5lU3RhY2sgPSBuZXcgY2RrLlN0YWNrKGFwcCwgJ1BpcGVsaW5lU3RhY2snLCB7IGVudjogUElQRUxJTkVfRU5WIH0pO1xuICBjb25zdCByZXBvID0gbmV3IGNjb21taXQuUmVwb3NpdG9yeShwaXBlbGluZVN0YWNrLCAnUmVwbycsIHtcbiAgICByZXBvc2l0b3J5TmFtZTogJ015UmVwbycsXG4gIH0pO1xuICBjb25zdCBjZGtJbnB1dCA9IGNka3AuQ29kZVBpcGVsaW5lU291cmNlLmNvZGVDb21taXQoXG4gICAgcmVwbyxcbiAgICAnbWFpbicsXG4gICk7XG5cbiAgbmV3IENvZGVQaXBlbGluZShwaXBlbGluZVN0YWNrLCAnUGlwZWxpbmUnLCB7XG4gICAgZW5hYmxlS2V5Um90YXRpb246IHRydWUsXG4gICAgY3Jvc3NBY2NvdW50S2V5czogdHJ1ZSwgLy8gcmVxdWlyZW1lbnQgb2Yga2V5IHJvdGF0aW9uXG4gICAgc3ludGg6IG5ldyBjZGtwLlNoZWxsU3RlcCgnU3ludGgnLCB7XG4gICAgICBpbnB1dDogY2RrSW5wdXQsXG4gICAgICBpbnN0YWxsQ29tbWFuZHM6IFsnbnBtIGNpJ10sXG4gICAgICBjb21tYW5kczogW1xuICAgICAgICAnbnBtIHJ1biBidWlsZCcsXG4gICAgICAgICducHggY2RrIHN5bnRoJyxcbiAgICAgIF0sXG4gICAgfSksXG4gIH0pO1xuXG4gIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spO1xuXG4gIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpLTVM6OktleScsIHtcbiAgICBFbmFibGVLZXlSb3RhdGlvbjogdHJ1ZSxcbiAgfSk7XG59KTtcblxudGVzdCgnQ29kZVBpcGVsaW5lIHN1cHBvcnRzIHVzZSBvZiBleGlzdGluZyByb2xlJywgKCkgPT4ge1xuICBjb25zdCBwaXBlbGluZVN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdQaXBlbGluZVN0YWNrJywgeyBlbnY6IFBJUEVMSU5FX0VOViB9KTtcbiAgY29uc3QgcmVwbyA9IG5ldyBjY29tbWl0LlJlcG9zaXRvcnkocGlwZWxpbmVTdGFjaywgJ1JlcG8nLCB7XG4gICAgcmVwb3NpdG9yeU5hbWU6ICdNeVJlcG8nLFxuICB9KTtcbiAgY29uc3QgY2RrSW5wdXQgPSBjZGtwLkNvZGVQaXBlbGluZVNvdXJjZS5jb2RlQ29tbWl0KFxuICAgIHJlcG8sXG4gICAgJ21haW4nLFxuICApO1xuXG4gIG5ldyBDb2RlUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ1BpcGVsaW5lJywge1xuICAgIHN5bnRoOiBuZXcgY2RrcC5TaGVsbFN0ZXAoJ1N5bnRoJywge1xuICAgICAgaW5wdXQ6IGNka0lucHV0LFxuICAgICAgaW5zdGFsbENvbW1hbmRzOiBbJ25wbSBjaSddLFxuICAgICAgY29tbWFuZHM6IFtcbiAgICAgICAgJ25wbSBydW4gYnVpbGQnLFxuICAgICAgICAnbnB4IGNkayBzeW50aCcsXG4gICAgICBdLFxuICAgIH0pLFxuICAgIHJvbGU6IG5ldyBpYW0uUm9sZShwaXBlbGluZVN0YWNrLCAnQ3VzdG9tUm9sZScsIHtcbiAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdjb2RlcGlwZWxpbmUuYW1hem9uYXdzLmNvbScpLFxuICAgICAgcm9sZU5hbWU6ICdNeUN1c3RvbVBpcGVsaW5lUm9sZScsXG4gICAgfSksXG4gIH0pO1xuXG4gIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spO1xuICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6SUFNOjpSb2xlJywge1xuICAgIEFzc3VtZVJvbGVQb2xpY3lEb2N1bWVudDoge1xuICAgICAgU3RhdGVtZW50OiBbXG4gICAgICAgIHtcbiAgICAgICAgICBBY3Rpb246ICdzdHM6QXNzdW1lUm9sZScsXG4gICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgIFByaW5jaXBhbDoge1xuICAgICAgICAgICAgU2VydmljZTogJ2NvZGVwaXBlbGluZS5hbWF6b25hd3MuY29tJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9LFxuICAgIFJvbGVOYW1lOiAnTXlDdXN0b21QaXBlbGluZVJvbGUnLFxuICB9KTtcbiAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNvZGVQaXBlbGluZTo6UGlwZWxpbmUnLCB7XG4gICAgUm9sZUFybjogeyAnRm46OkdldEF0dCc6IFsnQ3VzdG9tUm9sZTZEOEU2ODA5JywgJ0FybiddIH0sXG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdkZXBsb3ltZW50IG9mIHN0YWNrJywgKCkgPT4ge1xuICB0ZXN0KCdpcyBkb25lIHdpdGggUHJlcGFyZSBhbmQgRGVwbG95IHN0ZXAgYnkgZGVmYXVsdCcsICgpID0+IHtcbiAgICBjb25zdCBwaXBlbGluZVN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdQaXBlbGluZVN0YWNrJywgeyBlbnY6IFBJUEVMSU5FX0VOViB9KTtcbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBNb2Rlcm5UZXN0R2l0SHViTnBtUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycsIHtcbiAgICAgIGNyb3NzQWNjb3VudEtleXM6IHRydWUsXG4gICAgfSk7XG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UobmV3IEZpbGVBc3NldEFwcChwaXBlbGluZVN0YWNrLCAnQXBwJywge30pKTtcblxuICAgIC8vIFRIRU5cbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhwaXBlbGluZVN0YWNrKTtcblxuICAgIC8vIFRoZXJlIHNob3VsZCBiZSBQcmVwYXJlIHN0ZXAgaW4gcGllcGxpbmVcbiAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q29kZVBpcGVsaW5lOjpQaXBlbGluZScsIHtcbiAgICAgIFN0YWdlczogTWF0Y2guYXJyYXlXaXRoKFt7XG4gICAgICAgIEFjdGlvbnM6IE1hdGNoLmFycmF5V2l0aChbXG4gICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgICBDb25maWd1cmF0aW9uOiBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgICAgQWN0aW9uTW9kZTogJ0NIQU5HRV9TRVRfUkVQTEFDRScsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIE5hbWU6ICdQcmVwYXJlJyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgIENvbmZpZ3VyYXRpb246IE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgICBBY3Rpb25Nb2RlOiAnQ0hBTkdFX1NFVF9FWEVDVVRFJyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgTmFtZTogJ0RlcGxveScsXG4gICAgICAgICAgfSksXG4gICAgICAgIF0pLFxuICAgICAgICBOYW1lOiAnQXBwJyxcbiAgICAgIH1dKSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnY2FuIGJlIGRvbmUgd2l0aCBzaW5nbGUgc3RlcCcsICgpID0+IHtcbiAgICBjb25zdCBwaXBlbGluZVN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdQaXBlbGluZVN0YWNrJywgeyBlbnY6IFBJUEVMSU5FX0VOViB9KTtcbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBNb2Rlcm5UZXN0R2l0SHViTnBtUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycsIHtcbiAgICAgIGNyb3NzQWNjb3VudEtleXM6IHRydWUsXG4gICAgICB1c2VDaGFuZ2VTZXRzOiBmYWxzZSxcbiAgICB9KTtcbiAgICBwaXBlbGluZS5hZGRTdGFnZShuZXcgRmlsZUFzc2V0QXBwKHBpcGVsaW5lU3RhY2ssICdBcHAnLCB7fSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spO1xuXG4gICAgLy8gVGhlcmUgc2hvdWxkIGJlIFByZXBhcmUgc3RlcCBpbiBwaWVwbGluZVxuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb2RlUGlwZWxpbmU6OlBpcGVsaW5lJywge1xuICAgICAgU3RhZ2VzOiBNYXRjaC5hcnJheVdpdGgoW3tcbiAgICAgICAgQWN0aW9uczogTWF0Y2guYXJyYXlXaXRoKFtcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgIENvbmZpZ3VyYXRpb246IE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgICBBY3Rpb25Nb2RlOiAnQ1JFQVRFX1VQREFURScsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIE5hbWU6ICdEZXBsb3knLFxuICAgICAgICAgIH0pLFxuICAgICAgICBdKSxcbiAgICAgICAgTmFtZTogJ0FwcCcsXG4gICAgICB9XSksXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbnRlc3QoJ2FjdGlvbiBuYW1lIGlzIGNhbGN1bGF0ZWQgcHJvcGVybHkgaWYgaXQgaGFzIGNyb3NzLXN0YWNrIGRlcGVuZGVuY2llcycsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgcGlwZWxpbmVTdGFjayA9IG5ldyBjZGsuU3RhY2soYXBwLCAnUGlwZWxpbmVTdGFjaycsIHsgZW52OiBQSVBFTElORV9FTlYgfSk7XG4gIGNvbnN0IHBpcGVsaW5lID0gbmV3IE1vZGVyblRlc3RHaXRIdWJOcG1QaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ2RrJywge1xuICAgIGNyb3NzQWNjb3VudEtleXM6IHRydWUsXG4gIH0pO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgczFzdGVwID0gbmV3IGNka3AuTWFudWFsQXBwcm92YWxTdGVwKCdTMScpO1xuICBjb25zdCBzMnN0ZXAgPSBuZXcgY2RrcC5NYW51YWxBcHByb3ZhbFN0ZXAoJ1MyJyk7XG4gIHMxc3RlcC5hZGRTdGVwRGVwZW5kZW5jeShzMnN0ZXApO1xuXG4gIC8vIFRoZSBpc3N1ZSB3ZSB3ZXJlIGRpYWdub3Npbmcgb25seSBtYW5pZmVzdHMgaWYgdGhlIHN0YWNrcyBkb24ndCBoYXZlXG4gIC8vIGEgZGVwZW5kZW5jeSBvbiBlYWNoIG90aGVyXG4gIGNvbnN0IHN0YWdlID0gbmV3IFR3b1N0YWNrQXBwKGFwcCwgJ1RoZUFwcCcsIHsgd2l0aERlcGVuZGVuY3k6IGZhbHNlIH0pO1xuICBwaXBlbGluZS5hZGRTdGFnZShzdGFnZSwge1xuICAgIHN0YWNrU3RlcHM6IFtcbiAgICAgIHsgc3RhY2s6IHN0YWdlLnN0YWNrMSwgcG9zdDogW3Mxc3RlcF0gfSxcbiAgICAgIHsgc3RhY2s6IHN0YWdlLnN0YWNrMiwgcG9zdDogW3Myc3RlcF0gfSxcbiAgICBdLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spO1xuICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q29kZVBpcGVsaW5lOjpQaXBlbGluZScsIHtcbiAgICBTdGFnZXM6IE1hdGNoLmFycmF5V2l0aChbe1xuICAgICAgTmFtZTogJ1RoZUFwcCcsXG4gICAgICBBY3Rpb25zOiBNYXRjaC5hcnJheVdpdGgoW1xuICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHsgTmFtZTogJ1N0YWNrMi5TMicsIFJ1bk9yZGVyOiAzIH0pLFxuICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHsgTmFtZTogJ1N0YWNrMS5TMScsIFJ1bk9yZGVyOiA0IH0pLFxuICAgICAgXSksXG4gICAgfV0pLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdzeW50aHMgd2l0aCBjaGFuZ2Ugc2V0IGFwcHJvdmVycycsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3QgcGlwZWxpbmVTdGFjayA9IG5ldyBjZGsuU3RhY2soYXBwLCAnUGlwZWxpbmVTdGFjaycsIHsgZW52OiBQSVBFTElORV9FTlYgfSk7XG4gIGNvbnN0IHBpcGVsaW5lID0gbmV3IE1vZGVyblRlc3RHaXRIdWJOcG1QaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ2RrJyk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCBjc0FwcHJvdmFsID0gbmV3IGNka3AuTWFudWFsQXBwcm92YWxTdGVwKCdDaGFuZ2VTZXRBcHByb3ZhbCcpO1xuXG4gIC8vIFRoZSBpc3N1ZSB3ZSB3ZXJlIGRpYWdub3Npbmcgb25seSBtYW5pZmVzdHMgaWYgdGhlIHN0YWNrcyBkb24ndCBoYXZlXG4gIC8vIGEgZGVwZW5kZW5jeSBvbiBlYWNoIG90aGVyXG4gIGNvbnN0IHN0YWdlID0gbmV3IFR3b1N0YWNrQXBwKGFwcCwgJ1RoZUFwcCcsIHsgd2l0aERlcGVuZGVuY3k6IGZhbHNlIH0pO1xuICBwaXBlbGluZS5hZGRTdGFnZShzdGFnZSwge1xuICAgIHN0YWNrU3RlcHM6IFtcbiAgICAgIHsgc3RhY2s6IHN0YWdlLnN0YWNrMSwgY2hhbmdlU2V0OiBbY3NBcHByb3ZhbF0gfSxcbiAgICAgIHsgc3RhY2s6IHN0YWdlLnN0YWNrMiwgY2hhbmdlU2V0OiBbY3NBcHByb3ZhbF0gfSxcbiAgICBdLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spO1xuICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q29kZVBpcGVsaW5lOjpQaXBlbGluZScsIHtcbiAgICBTdGFnZXM6IE1hdGNoLmFycmF5V2l0aChbe1xuICAgICAgTmFtZTogJ1RoZUFwcCcsXG4gICAgICBBY3Rpb25zOiBNYXRjaC5hcnJheVdpdGgoW1xuICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHsgTmFtZTogJ1N0YWNrMS5QcmVwYXJlJywgUnVuT3JkZXI6IDEgfSksXG4gICAgICAgIE1hdGNoLm9iamVjdExpa2UoeyBOYW1lOiAnU3RhY2syLlByZXBhcmUnLCBSdW5PcmRlcjogMSB9KSxcbiAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7IE5hbWU6ICdTdGFjazEuQ2hhbmdlU2V0QXBwcm92YWwnLCBSdW5PcmRlcjogMiB9KSxcbiAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7IE5hbWU6ICdTdGFjazEuRGVwbG95JywgUnVuT3JkZXI6IDMgfSksXG4gICAgICAgIE1hdGNoLm9iamVjdExpa2UoeyBOYW1lOiAnU3RhY2syLkRlcGxveScsIFJ1bk9yZGVyOiAzIH0pLFxuICAgICAgXSksXG4gICAgfV0pLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdzZWxmTXV0YXRpb25Qcm9qZWN0IGNhbiBiZSBhY2Nlc3NlZCBhZnRlciBidWlsZFBpcGVsaW5lJywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBwaXBlbGluZVN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdQaXBlbGluZVN0YWNrJywgeyBlbnY6IFBJUEVMSU5FX0VOViB9KTtcbiAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnKTtcbiAgcGlwZWxpbmUuYWRkU3RhZ2UobmV3IFN0YWdlV2l0aFN0YWNrT3V0cHV0KHBpcGVsaW5lU3RhY2ssICdTdGFnZScpKTtcblxuICAvLyBXSEVOXG4gIHBpcGVsaW5lLmJ1aWxkUGlwZWxpbmUoKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChwaXBlbGluZS5zZWxmTXV0YXRpb25Qcm9qZWN0KS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnc2VsZk11dGF0aW9uUHJvamVjdCBpcyB1bmRlZmluZWQgaWYgc3dpdGNoZWQgb2ZmJywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBwaXBlbGluZVN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdQaXBlbGluZVN0YWNrJywgeyBlbnY6IFBJUEVMSU5FX0VOViB9KTtcbiAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnLCB7XG4gICAgc2VsZk11dGF0aW9uOiBmYWxzZSxcbiAgfSk7XG4gIHBpcGVsaW5lLmFkZFN0YWdlKG5ldyBTdGFnZVdpdGhTdGFja091dHB1dChwaXBlbGluZVN0YWNrLCAnU3RhZ2UnKSk7XG5cbiAgLy8gV0hFTlxuICBwaXBlbGluZS5idWlsZFBpcGVsaW5lKCk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QoKCkgPT4gcGlwZWxpbmUuc2VsZk11dGF0aW9uUHJvamVjdCkudG9UaHJvdygvTm8gc2VsZk11dGF0aW9uUHJvamVjdC8pO1xufSk7XG5cbmludGVyZmFjZSBSZXVzZUNvZGVQaXBlbGluZVN0YWNrUHJvcHMgZXh0ZW5kcyBjZGsuU3RhY2tQcm9wcyB7XG4gIHJldXNlQ3Jvc3NSZWdpb25TdXBwb3J0U3RhY2tzPzogYm9vbGVhbjtcbn1cbmNsYXNzIFJldXNlQ29kZVBpcGVsaW5lU3RhY2sgZXh0ZW5kcyBjZGsuU3RhY2sge1xuICBwdWJsaWMgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFJldXNlQ29kZVBpcGVsaW5lU3RhY2tQcm9wcyApIHtcbiAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcbiAgICBjb25zdCByZXBvID0gbmV3IGNjb21taXQuUmVwb3NpdG9yeSh0aGlzLCAnUmVwbycsIHtcbiAgICAgIHJlcG9zaXRvcnlOYW1lOiAnTXlSZXBvJyxcbiAgICB9KTtcblxuICAgIGNvbnN0IGNka0lucHV0ID0gY2RrcC5Db2RlUGlwZWxpbmVTb3VyY2UuY29kZUNvbW1pdChcbiAgICAgIHJlcG8sXG4gICAgICAnbWFpbicsXG4gICAgKTtcblxuICAgIGNvbnN0IHN5bnRoU3RlcCA9IG5ldyBjZGtwLlNoZWxsU3RlcCgnU3ludGgnLCB7XG4gICAgICBpbnB1dDogY2RrSW5wdXQsXG4gICAgICBpbnN0YWxsQ29tbWFuZHM6IFsnbnBtIGNpJ10sXG4gICAgICBjb21tYW5kczogW1xuICAgICAgICAnbnBtIHJ1biBidWlsZCcsXG4gICAgICAgICducHggY2RrIHN5bnRoJyxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBjZGtwLkNvZGVQaXBlbGluZSh0aGlzLCAnUGlwZWxpbmUnLCB7XG4gICAgICBzeW50aDogc3ludGhTdGVwLFxuICAgICAgc2VsZk11dGF0aW9uOiB0cnVlLFxuICAgICAgY3Jvc3NBY2NvdW50S2V5czogdHJ1ZSxcbiAgICAgIHJldXNlQ3Jvc3NSZWdpb25TdXBwb3J0U3RhY2tzOiBwcm9wcy5yZXVzZUNyb3NzUmVnaW9uU3VwcG9ydFN0YWNrcyxcbiAgICB9KTtcblxuICAgIGNvbnN0IHN0YWdlID0gbmV3IFJldXNlU3RhZ2UoXG4gICAgICB0aGlzLFxuICAgICAgYFNhbXBsZVN0YWdlLSR7dGVzdFN0YWdlRW52LmFjY291bnR9LSR7dGVzdFN0YWdlRW52LnJlZ2lvbn1gLFxuICAgICAge1xuICAgICAgICBlbnY6IHRlc3RTdGFnZUVudixcbiAgICAgIH0sXG4gICAgKTtcbiAgICBwaXBlbGluZS5hZGRTdGFnZShzdGFnZSk7XG5cbiAgfVxufVxuXG5jbGFzcyBSZXVzZVN0YWdlIGV4dGVuZHMgY2RrLlN0YWdlIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBjZGsuU3RhZ2VQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xuICAgIG5ldyBSZXVzZVN0YWNrKHRoaXMsICdTYW1wbGVTdGFjaycsIHt9KTtcbiAgfVxufVxuXG5jbGFzcyBSZXVzZVN0YWNrIGV4dGVuZHMgY2RrLlN0YWNrIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBjZGsuU3RhY2tQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xuICAgIG5ldyBzcXMuUXVldWUodGhpcywgJ1F1ZXVlJyk7XG4gIH1cbn1cblxuaW50ZXJmYWNlIENvZGVQaXBlbGluZVN0YWNrUHJvcHMgZXh0ZW5kcyBjZGsuU3RhY2tQcm9wcyB7XG4gIHBpcGVsaW5lTmFtZT86IHN0cmluZztcbiAgY3Jvc3NBY2NvdW50S2V5cz86IGJvb2xlYW47XG4gIGVuYWJsZUtleVJvdGF0aW9uPzogYm9vbGVhbjtcbiAgcmV1c2VDcm9zc1JlZ2lvblN1cHBvcnRTdGFja3M/OiBib29sZWFuO1xuICByb2xlPzogaWFtLklSb2xlO1xufVxuXG5jbGFzcyBDb2RlUGlwZWxpbmVQcm9wc0NoZWNrVGVzdCBleHRlbmRzIGNkay5TdGFjayB7XG4gIGNQcm9wczogQ29kZVBpcGVsaW5lU3RhY2tQcm9wcztcbiAgcHVibGljIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBDb2RlUGlwZWxpbmVTdGFja1Byb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XG4gICAgdGhpcy5jUHJvcHMgPSBwcm9wcztcbiAgfVxuICBwdWJsaWMgY3JlYXRlKCkge1xuICAgIGlmICh0aGlzLmNQcm9wcy5waXBlbGluZU5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbmV3IGNka3AuQ29kZVBpcGVsaW5lKHRoaXMsICdDb2RlUGlwZWxpbmUxJywge1xuICAgICAgICBwaXBlbGluZU5hbWU6IHRoaXMuY1Byb3BzLnBpcGVsaW5lTmFtZSxcbiAgICAgICAgY29kZVBpcGVsaW5lOiBuZXcgUGlwZWxpbmUodGhpcywgJ1BpcGVsaW5lMScpLFxuICAgICAgICBzeW50aDogbmV3IGNka3AuU2hlbGxTdGVwKCdTeW50aCcsIHsgY29tbWFuZHM6IFsnbHMnXSB9KSxcbiAgICAgIH0pLmJ1aWxkUGlwZWxpbmUoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY1Byb3BzLmNyb3NzQWNjb3VudEtleXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbmV3IGNka3AuQ29kZVBpcGVsaW5lKHRoaXMsICdDb2RlUGlwZWxpbmUyJywge1xuICAgICAgICBjcm9zc0FjY291bnRLZXlzOiB0aGlzLmNQcm9wcy5jcm9zc0FjY291bnRLZXlzLFxuICAgICAgICBjb2RlUGlwZWxpbmU6IG5ldyBQaXBlbGluZSh0aGlzLCAnUGlwZWxpbmUyJyksXG4gICAgICAgIHN5bnRoOiBuZXcgY2RrcC5TaGVsbFN0ZXAoJ1N5bnRoJywgeyBjb21tYW5kczogWydscyddIH0pLFxuICAgICAgfSkuYnVpbGRQaXBlbGluZSgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jUHJvcHMuZW5hYmxlS2V5Um90YXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgbmV3IGNka3AuQ29kZVBpcGVsaW5lKHRoaXMsICdDb2RlUGlwZWxpbmUzJywge1xuICAgICAgICBlbmFibGVLZXlSb3RhdGlvbjogdGhpcy5jUHJvcHMuZW5hYmxlS2V5Um90YXRpb24sXG4gICAgICAgIGNvZGVQaXBlbGluZTogbmV3IFBpcGVsaW5lKHRoaXMsICdQaXBlbGluZTMnKSxcbiAgICAgICAgc3ludGg6IG5ldyBjZGtwLlNoZWxsU3RlcCgnU3ludGgnLCB7IGNvbW1hbmRzOiBbJ2xzJ10gfSksXG4gICAgICB9KS5idWlsZFBpcGVsaW5lKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmNQcm9wcy5yZXVzZUNyb3NzUmVnaW9uU3VwcG9ydFN0YWNrcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBuZXcgY2RrcC5Db2RlUGlwZWxpbmUodGhpcywgJ0NvZGVQaXBlbGluZTQnLCB7XG4gICAgICAgIHJldXNlQ3Jvc3NSZWdpb25TdXBwb3J0U3RhY2tzOiB0aGlzLmNQcm9wcy5yZXVzZUNyb3NzUmVnaW9uU3VwcG9ydFN0YWNrcyxcbiAgICAgICAgY29kZVBpcGVsaW5lOiBuZXcgUGlwZWxpbmUodGhpcywgJ1BpcGVsaW5lNCcpLFxuICAgICAgICBzeW50aDogbmV3IGNka3AuU2hlbGxTdGVwKCdTeW50aCcsIHsgY29tbWFuZHM6IFsnbHMnXSB9KSxcbiAgICAgIH0pLmJ1aWxkUGlwZWxpbmUoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY1Byb3BzLnJvbGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbmV3IGNka3AuQ29kZVBpcGVsaW5lKHRoaXMsICdDb2RlUGlwZWxpbmU1Jywge1xuICAgICAgICByb2xlOiB0aGlzLmNQcm9wcy5yb2xlLFxuICAgICAgICBjb2RlUGlwZWxpbmU6IG5ldyBQaXBlbGluZSh0aGlzLCAnUGlwZWxpbmU1JyksXG4gICAgICAgIHN5bnRoOiBuZXcgY2RrcC5TaGVsbFN0ZXAoJ1N5bnRoJywgeyBjb21tYW5kczogWydscyddIH0pLFxuICAgICAgfSkuYnVpbGRQaXBlbGluZSgpO1xuICAgIH1cbiAgfVxufVxuIl19