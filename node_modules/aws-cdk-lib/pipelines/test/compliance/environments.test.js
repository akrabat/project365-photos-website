"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* eslint-disable import/no-extraneous-dependencies */
const assertions_1 = require("../../../assertions");
const core_1 = require("../../../core");
const testhelpers_1 = require("../testhelpers");
let app;
let pipelineStack;
beforeEach(() => {
    app = new testhelpers_1.TestApp();
    pipelineStack = new core_1.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
});
afterEach(() => {
    app.cleanup();
});
(0, testhelpers_1.behavior)('action has right settings for same-env deployment', (suite) => {
    suite.legacy(() => {
        const pipeline = new testhelpers_1.LegacyTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addApplicationStage(new testhelpers_1.OneStackApp(app, 'Same'));
        THEN_codePipelineExpection(agnosticRole);
    });
    suite.additional('legacy: even if env is specified but the same as the pipeline', () => {
        const pipeline = new testhelpers_1.LegacyTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addApplicationStage(new testhelpers_1.OneStackApp(app, 'Same', {
            env: testhelpers_1.PIPELINE_ENV,
        }));
        THEN_codePipelineExpection(pipelineEnvRole);
    });
    suite.modern(() => {
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addStage(new testhelpers_1.OneStackApp(app, 'Same'));
        THEN_codePipelineExpection(agnosticRole);
    });
    suite.additional('modern: even if env is specified but the same as the pipeline', () => {
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addStage(new testhelpers_1.OneStackApp(app, 'Same', {
            env: testhelpers_1.PIPELINE_ENV,
        }));
        THEN_codePipelineExpection(pipelineEnvRole);
    });
    function THEN_codePipelineExpection(roleArn) {
        // THEN: pipeline structure is correct
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'Same',
                    Actions: [
                        assertions_1.Match.objectLike({
                            Name: (0, testhelpers_1.stringLike)('*Prepare'),
                            RoleArn: roleArn('deploy-role'),
                            Configuration: assertions_1.Match.objectLike({
                                StackName: 'Same-Stack',
                                RoleArn: roleArn('cfn-exec-role'),
                            }),
                        }),
                        assertions_1.Match.objectLike({
                            Name: (0, testhelpers_1.stringLike)('*Deploy'),
                            RoleArn: roleArn('deploy-role'),
                            Configuration: assertions_1.Match.objectLike({
                                StackName: 'Same-Stack',
                            }),
                        }),
                    ],
                }]),
        });
        // THEN: artifact bucket can be read by deploy role
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::S3::BucketPolicy', {
            PolicyDocument: {
                Statement: assertions_1.Match.arrayWith([assertions_1.Match.objectLike({
                        Action: ['s3:GetObject*', 's3:GetBucket*', 's3:List*'],
                        Principal: {
                            AWS: roleArn('deploy-role'),
                        },
                    })]),
            },
        });
    }
});
(0, testhelpers_1.behavior)('action has right settings for cross-account deployment', (suite) => {
    suite.legacy(() => {
        // WHEN
        const pipeline = new testhelpers_1.LegacyTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addApplicationStage(new testhelpers_1.OneStackApp(app, 'CrossAccount', { env: { account: 'you' } }));
        THEN_codePipelineExpectation();
    });
    suite.modern(() => {
        // WHEN
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
            crossAccountKeys: true,
        });
        pipeline.addStage(new testhelpers_1.OneStackApp(app, 'CrossAccount', { env: { account: 'you' } }));
        THEN_codePipelineExpectation();
    });
    function THEN_codePipelineExpectation() {
        // THEN: Pipelien structure is correct
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'CrossAccount',
                    Actions: [
                        assertions_1.Match.objectLike({
                            Name: (0, testhelpers_1.stringLike)('*Prepare'),
                            RoleArn: {
                                'Fn::Join': ['', [
                                        'arn:',
                                        { Ref: 'AWS::Partition' },
                                        ':iam::you:role/cdk-hnb659fds-deploy-role-you-',
                                        { Ref: 'AWS::Region' },
                                    ]],
                            },
                            Configuration: assertions_1.Match.objectLike({
                                StackName: 'CrossAccount-Stack',
                                RoleArn: {
                                    'Fn::Join': ['', [
                                            'arn:',
                                            { Ref: 'AWS::Partition' },
                                            ':iam::you:role/cdk-hnb659fds-cfn-exec-role-you-',
                                            { Ref: 'AWS::Region' },
                                        ]],
                                },
                            }),
                        }),
                        assertions_1.Match.objectLike({
                            Name: (0, testhelpers_1.stringLike)('*Deploy'),
                            RoleArn: {
                                'Fn::Join': ['', [
                                        'arn:',
                                        { Ref: 'AWS::Partition' },
                                        ':iam::you:role/cdk-hnb659fds-deploy-role-you-',
                                        { Ref: 'AWS::Region' },
                                    ]],
                            },
                            Configuration: assertions_1.Match.objectLike({
                                StackName: 'CrossAccount-Stack',
                            }),
                        }),
                    ],
                }]),
        });
        // THEN: Artifact bucket can be read by deploy role
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::S3::BucketPolicy', {
            PolicyDocument: {
                Statement: assertions_1.Match.arrayWith([assertions_1.Match.objectLike({
                        Action: ['s3:GetObject*', 's3:GetBucket*', 's3:List*'],
                        Principal: {
                            AWS: {
                                'Fn::Join': ['', [
                                        'arn:',
                                        { Ref: 'AWS::Partition' },
                                        (0, testhelpers_1.stringLike)('*-deploy-role-*'),
                                        { Ref: 'AWS::Region' },
                                    ]],
                            },
                        },
                    })]),
            },
        });
    }
});
(0, testhelpers_1.behavior)('action has right settings for cross-region deployment', (suite) => {
    suite.legacy(() => {
        // WHEN
        const pipeline = new testhelpers_1.LegacyTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addApplicationStage(new testhelpers_1.OneStackApp(app, 'CrossRegion', { env: { region: 'elsewhere' } }));
        THEN_codePipelineExpectation();
    });
    suite.modern(() => {
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
            crossAccountKeys: true,
        });
        pipeline.addStage(new testhelpers_1.OneStackApp(app, 'CrossRegion', { env: { region: 'elsewhere' } }));
        THEN_codePipelineExpectation();
    });
    function THEN_codePipelineExpectation() {
        // THEN
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'CrossRegion',
                    Actions: [
                        assertions_1.Match.objectLike({
                            Name: (0, testhelpers_1.stringLike)('*Prepare'),
                            RoleArn: {
                                'Fn::Join': ['', [
                                        'arn:',
                                        { Ref: 'AWS::Partition' },
                                        ':iam::',
                                        { Ref: 'AWS::AccountId' },
                                        ':role/cdk-hnb659fds-deploy-role-',
                                        { Ref: 'AWS::AccountId' },
                                        '-elsewhere',
                                    ]],
                            },
                            Region: 'elsewhere',
                            Configuration: assertions_1.Match.objectLike({
                                StackName: 'CrossRegion-Stack',
                                RoleArn: {
                                    'Fn::Join': ['', [
                                            'arn:',
                                            { Ref: 'AWS::Partition' },
                                            ':iam::',
                                            { Ref: 'AWS::AccountId' },
                                            ':role/cdk-hnb659fds-cfn-exec-role-',
                                            { Ref: 'AWS::AccountId' },
                                            '-elsewhere',
                                        ]],
                                },
                            }),
                        }),
                        assertions_1.Match.objectLike({
                            Name: (0, testhelpers_1.stringLike)('*Deploy'),
                            RoleArn: {
                                'Fn::Join': ['', [
                                        'arn:',
                                        { Ref: 'AWS::Partition' },
                                        ':iam::',
                                        { Ref: 'AWS::AccountId' },
                                        ':role/cdk-hnb659fds-deploy-role-',
                                        { Ref: 'AWS::AccountId' },
                                        '-elsewhere',
                                    ]],
                            },
                            Region: 'elsewhere',
                            Configuration: assertions_1.Match.objectLike({
                                StackName: 'CrossRegion-Stack',
                            }),
                        }),
                    ],
                }]),
        });
    }
});
(0, testhelpers_1.behavior)('action has right settings for cross-account/cross-region deployment', (suite) => {
    suite.legacy(() => {
        // WHEN
        const pipeline = new testhelpers_1.LegacyTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addApplicationStage(new testhelpers_1.OneStackApp(app, 'CrossBoth', {
            env: {
                account: 'you',
                region: 'elsewhere',
            },
        }));
        THEN_codePipelineExpectations();
    });
    suite.modern(() => {
        // WHEN
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
            crossAccountKeys: true,
        });
        pipeline.addStage(new testhelpers_1.OneStackApp(app, 'CrossBoth', {
            env: {
                account: 'you',
                region: 'elsewhere',
            },
        }));
        THEN_codePipelineExpectations();
    });
    function THEN_codePipelineExpectations() {
        // THEN: pipeline structure must be correct
        const stack = app.stackArtifact(pipelineStack);
        expect(stack).toBeDefined();
        assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'CrossBoth',
                    Actions: [
                        assertions_1.Match.objectLike({
                            Name: (0, testhelpers_1.stringLike)('*Prepare'),
                            RoleArn: {
                                'Fn::Join': ['', [
                                        'arn:',
                                        { Ref: 'AWS::Partition' },
                                        ':iam::you:role/cdk-hnb659fds-deploy-role-you-elsewhere',
                                    ]],
                            },
                            Region: 'elsewhere',
                            Configuration: assertions_1.Match.objectLike({
                                StackName: 'CrossBoth-Stack',
                                RoleArn: {
                                    'Fn::Join': ['', [
                                            'arn:',
                                            { Ref: 'AWS::Partition' },
                                            ':iam::you:role/cdk-hnb659fds-cfn-exec-role-you-elsewhere',
                                        ]],
                                },
                            }),
                        }),
                        assertions_1.Match.objectLike({
                            Name: (0, testhelpers_1.stringLike)('*Deploy'),
                            RoleArn: {
                                'Fn::Join': ['', [
                                        'arn:',
                                        { Ref: 'AWS::Partition' },
                                        ':iam::you:role/cdk-hnb659fds-deploy-role-you-elsewhere',
                                    ]],
                            },
                            Region: 'elsewhere',
                            Configuration: assertions_1.Match.objectLike({
                                StackName: 'CrossBoth-Stack',
                            }),
                        }),
                    ],
                }]),
        });
        // THEN: artifact bucket can be read by deploy role
        const supportStack = app.stackArtifact('PipelineStack-support-elsewhere');
        expect(supportStack).toBeDefined();
        assertions_1.Template.fromStack(supportStack).hasResourceProperties('AWS::S3::BucketPolicy', {
            PolicyDocument: {
                Statement: assertions_1.Match.arrayWith([assertions_1.Match.objectLike({
                        Action: assertions_1.Match.arrayWith(['s3:GetObject*', 's3:GetBucket*', 's3:List*']),
                        Principal: {
                            AWS: {
                                'Fn::Join': ['', [
                                        'arn:',
                                        { Ref: 'AWS::Partition' },
                                        (0, testhelpers_1.stringLike)('*-deploy-role-*'),
                                    ]],
                            },
                        },
                    })]),
            },
        });
        // And the key to go along with it
        assertions_1.Template.fromStack(supportStack).hasResourceProperties('AWS::KMS::Key', {
            KeyPolicy: {
                Statement: assertions_1.Match.arrayWith([assertions_1.Match.objectLike({
                        Action: assertions_1.Match.arrayWith(['kms:Decrypt', 'kms:DescribeKey']),
                        Principal: {
                            AWS: {
                                'Fn::Join': ['', [
                                        'arn:',
                                        { Ref: 'AWS::Partition' },
                                        (0, testhelpers_1.stringLike)('*-deploy-role-*'),
                                    ]],
                            },
                        },
                    })]),
            },
        });
    }
});
function agnosticRole(roleName) {
    return {
        'Fn::Join': ['', [
                'arn:',
                { Ref: 'AWS::Partition' },
                ':iam::',
                { Ref: 'AWS::AccountId' },
                `:role/cdk-hnb659fds-${roleName}-`,
                { Ref: 'AWS::AccountId' },
                '-',
                { Ref: 'AWS::Region' },
            ]],
    };
}
function pipelineEnvRole(roleName) {
    return {
        'Fn::Join': ['', [
                'arn:',
                { Ref: 'AWS::Partition' },
                `:iam::${testhelpers_1.PIPELINE_ENV.account}:role/cdk-hnb659fds-${roleName}-${testhelpers_1.PIPELINE_ENV.account}-${testhelpers_1.PIPELINE_ENV.region}`,
            ]],
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW52aXJvbm1lbnRzLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJlbnZpcm9ubWVudHMudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNEQUFzRDtBQUN0RCxvREFBc0Q7QUFDdEQsd0NBQXNDO0FBQ3RDLGdEQUFvSjtBQUVwSixJQUFJLEdBQVksQ0FBQztBQUNqQixJQUFJLGFBQW9CLENBQUM7QUFFekIsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLEdBQUcsR0FBRyxJQUFJLHFCQUFPLEVBQUUsQ0FBQztJQUNwQixhQUFhLEdBQUcsSUFBSSxZQUFLLENBQUMsR0FBRyxFQUFFLGVBQWUsRUFBRSxFQUFFLEdBQUcsRUFBRSwwQkFBWSxFQUFFLENBQUMsQ0FBQztBQUN6RSxDQUFDLENBQUMsQ0FBQztBQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7SUFDYixHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDaEIsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFBLHNCQUFRLEVBQUMsbURBQW1ELEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRTtJQUN0RSxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRTtRQUNoQixNQUFNLFFBQVEsR0FBRyxJQUFJLHlDQUEyQixDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2RSxRQUFRLENBQUMsbUJBQW1CLENBQUMsSUFBSSx5QkFBVyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBRTNELDBCQUEwQixDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzNDLENBQUMsQ0FBQyxDQUFDO0lBRUgsS0FBSyxDQUFDLFVBQVUsQ0FBQywrREFBK0QsRUFBRSxHQUFHLEVBQUU7UUFDckYsTUFBTSxRQUFRLEdBQUcsSUFBSSx5Q0FBMkIsQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDdkUsUUFBUSxDQUFDLG1CQUFtQixDQUFDLElBQUkseUJBQVcsQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFO1lBQ3hELEdBQUcsRUFBRSwwQkFBWTtTQUNsQixDQUFDLENBQUMsQ0FBQztRQUVKLDBCQUEwQixDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQzlDLENBQUMsQ0FBQyxDQUFDO0lBRUgsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFDaEIsTUFBTSxRQUFRLEdBQUcsSUFBSSx5Q0FBMkIsQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDdkUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLHlCQUFXLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFFaEQsMEJBQTBCLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDM0MsQ0FBQyxDQUFDLENBQUM7SUFFSCxLQUFLLENBQUMsVUFBVSxDQUFDLCtEQUErRCxFQUFFLEdBQUcsRUFBRTtRQUNyRixNQUFNLFFBQVEsR0FBRyxJQUFJLHlDQUEyQixDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2RSxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUkseUJBQVcsQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFO1lBQzdDLEdBQUcsRUFBRSwwQkFBWTtTQUNsQixDQUFDLENBQUMsQ0FBQztRQUVKLDBCQUEwQixDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQzlDLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUywwQkFBMEIsQ0FBQyxPQUEyQjtRQUM3RCxzQ0FBc0M7UUFDdEMscUJBQVEsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUMscUJBQXFCLENBQUMsNkJBQTZCLEVBQUU7WUFDckYsTUFBTSxFQUFFLGtCQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7b0JBQ3ZCLElBQUksRUFBRSxNQUFNO29CQUNaLE9BQU8sRUFBRTt3QkFDUCxrQkFBSyxDQUFDLFVBQVUsQ0FBQzs0QkFDZixJQUFJLEVBQUUsSUFBQSx3QkFBVSxFQUFDLFVBQVUsQ0FBQzs0QkFDNUIsT0FBTyxFQUFFLE9BQU8sQ0FBQyxhQUFhLENBQUM7NEJBQy9CLGFBQWEsRUFBRSxrQkFBSyxDQUFDLFVBQVUsQ0FBQztnQ0FDOUIsU0FBUyxFQUFFLFlBQVk7Z0NBQ3ZCLE9BQU8sRUFBRSxPQUFPLENBQUMsZUFBZSxDQUFDOzZCQUNsQyxDQUFDO3lCQUNILENBQUM7d0JBQ0Ysa0JBQUssQ0FBQyxVQUFVLENBQUM7NEJBQ2YsSUFBSSxFQUFFLElBQUEsd0JBQVUsRUFBQyxTQUFTLENBQUM7NEJBQzNCLE9BQU8sRUFBRSxPQUFPLENBQUMsYUFBYSxDQUFDOzRCQUMvQixhQUFhLEVBQUUsa0JBQUssQ0FBQyxVQUFVLENBQUM7Z0NBQzlCLFNBQVMsRUFBRSxZQUFZOzZCQUN4QixDQUFDO3lCQUNILENBQUM7cUJBQ0g7aUJBQ0YsQ0FBQyxDQUFDO1NBQ0osQ0FBQyxDQUFDO1FBRUgsbURBQW1EO1FBQ25ELHFCQUFRLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHVCQUF1QixFQUFFO1lBQy9FLGNBQWMsRUFBRTtnQkFDZCxTQUFTLEVBQUUsa0JBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxrQkFBSyxDQUFDLFVBQVUsQ0FBQzt3QkFDM0MsTUFBTSxFQUFFLENBQUMsZUFBZSxFQUFFLGVBQWUsRUFBRSxVQUFVLENBQUM7d0JBQ3RELFNBQVMsRUFBRTs0QkFDVCxHQUFHLEVBQUUsT0FBTyxDQUFDLGFBQWEsQ0FBQzt5QkFDNUI7cUJBQ0YsQ0FBQyxDQUFDLENBQUM7YUFDTDtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUEsc0JBQVEsRUFBQyx3REFBd0QsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO0lBQzNFLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFO1FBQ2hCLE9BQU87UUFDUCxNQUFNLFFBQVEsR0FBRyxJQUFJLHlDQUEyQixDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2RSxRQUFRLENBQUMsbUJBQW1CLENBQUMsSUFBSSx5QkFBVyxDQUFDLEdBQUcsRUFBRSxjQUFjLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFaEcsNEJBQTRCLEVBQUUsQ0FBQztJQUNqQyxDQUFDLENBQUMsQ0FBQztJQUVILEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFO1FBQ2hCLE9BQU87UUFDUCxNQUFNLFFBQVEsR0FBRyxJQUFJLHlDQUEyQixDQUFDLGFBQWEsRUFBRSxLQUFLLEVBQUU7WUFDckUsZ0JBQWdCLEVBQUUsSUFBSTtTQUN2QixDQUFDLENBQUM7UUFDSCxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUkseUJBQVcsQ0FBQyxHQUFHLEVBQUUsY0FBYyxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRXJGLDRCQUE0QixFQUFFLENBQUM7SUFDakMsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLDRCQUE0QjtRQUNuQyxzQ0FBc0M7UUFDdEMscUJBQVEsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUMscUJBQXFCLENBQUMsNkJBQTZCLEVBQUU7WUFDckYsTUFBTSxFQUFFLGtCQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7b0JBQ3ZCLElBQUksRUFBRSxjQUFjO29CQUNwQixPQUFPLEVBQUU7d0JBQ1Asa0JBQUssQ0FBQyxVQUFVLENBQUM7NEJBQ2YsSUFBSSxFQUFFLElBQUEsd0JBQVUsRUFBQyxVQUFVLENBQUM7NEJBQzVCLE9BQU8sRUFBRTtnQ0FDUCxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUU7d0NBQ2YsTUFBTTt3Q0FDTixFQUFFLEdBQUcsRUFBRSxnQkFBZ0IsRUFBRTt3Q0FDekIsK0NBQStDO3dDQUMvQyxFQUFFLEdBQUcsRUFBRSxhQUFhLEVBQUU7cUNBQ3ZCLENBQUM7NkJBQ0g7NEJBQ0QsYUFBYSxFQUFFLGtCQUFLLENBQUMsVUFBVSxDQUFDO2dDQUM5QixTQUFTLEVBQUUsb0JBQW9CO2dDQUMvQixPQUFPLEVBQUU7b0NBQ1AsVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFOzRDQUNmLE1BQU07NENBQ04sRUFBRSxHQUFHLEVBQUUsZ0JBQWdCLEVBQUU7NENBQ3pCLGlEQUFpRDs0Q0FDakQsRUFBRSxHQUFHLEVBQUUsYUFBYSxFQUFFO3lDQUN2QixDQUFDO2lDQUNIOzZCQUNGLENBQUM7eUJBQ0gsQ0FBQzt3QkFDRixrQkFBSyxDQUFDLFVBQVUsQ0FBQzs0QkFDZixJQUFJLEVBQUUsSUFBQSx3QkFBVSxFQUFDLFNBQVMsQ0FBQzs0QkFDM0IsT0FBTyxFQUFFO2dDQUNQLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRTt3Q0FDZixNQUFNO3dDQUNOLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFO3dDQUN6QiwrQ0FBK0M7d0NBQy9DLEVBQUUsR0FBRyxFQUFFLGFBQWEsRUFBRTtxQ0FDdkIsQ0FBQzs2QkFDSDs0QkFDRCxhQUFhLEVBQUUsa0JBQUssQ0FBQyxVQUFVLENBQUM7Z0NBQzlCLFNBQVMsRUFBRSxvQkFBb0I7NkJBQ2hDLENBQUM7eUJBQ0gsQ0FBQztxQkFDSDtpQkFDRixDQUFDLENBQUM7U0FDSixDQUFDLENBQUM7UUFFSCxtREFBbUQ7UUFDbkQscUJBQVEsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUMscUJBQXFCLENBQUMsdUJBQXVCLEVBQUU7WUFDL0UsY0FBYyxFQUFFO2dCQUNkLFNBQVMsRUFBRSxrQkFBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGtCQUFLLENBQUMsVUFBVSxDQUFDO3dCQUMzQyxNQUFNLEVBQUUsQ0FBQyxlQUFlLEVBQUUsZUFBZSxFQUFFLFVBQVUsQ0FBQzt3QkFDdEQsU0FBUyxFQUFFOzRCQUNULEdBQUcsRUFBRTtnQ0FDSCxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUU7d0NBQ2YsTUFBTTt3Q0FDTixFQUFFLEdBQUcsRUFBRSxnQkFBZ0IsRUFBRTt3Q0FDekIsSUFBQSx3QkFBVSxFQUFDLGlCQUFpQixDQUFDO3dDQUM3QixFQUFFLEdBQUcsRUFBRSxhQUFhLEVBQUU7cUNBQ3ZCLENBQUM7NkJBQ0g7eUJBQ0Y7cUJBQ0YsQ0FBQyxDQUFDLENBQUM7YUFDTDtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUM7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUEsc0JBQVEsRUFBQyx1REFBdUQsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO0lBQzFFLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFO1FBQ2hCLE9BQU87UUFDUCxNQUFNLFFBQVEsR0FBRyxJQUFJLHlDQUEyQixDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2RSxRQUFRLENBQUMsbUJBQW1CLENBQUMsSUFBSSx5QkFBVyxDQUFDLEdBQUcsRUFBRSxhQUFhLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFcEcsNEJBQTRCLEVBQUUsQ0FBQztJQUNqQyxDQUFDLENBQUMsQ0FBQztJQUVILEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFO1FBQ2hCLE1BQU0sUUFBUSxHQUFHLElBQUkseUNBQTJCLENBQUMsYUFBYSxFQUFFLEtBQUssRUFBRTtZQUNyRSxnQkFBZ0IsRUFBRSxJQUFJO1NBQ3ZCLENBQUMsQ0FBQztRQUNILFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSx5QkFBVyxDQUFDLEdBQUcsRUFBRSxhQUFhLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFekYsNEJBQTRCLEVBQUUsQ0FBQztJQUNqQyxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsNEJBQTRCO1FBQ25DLE9BQU87UUFDUCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyw2QkFBNkIsRUFBRTtZQUNyRixNQUFNLEVBQUUsa0JBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztvQkFDdkIsSUFBSSxFQUFFLGFBQWE7b0JBQ25CLE9BQU8sRUFBRTt3QkFDUCxrQkFBSyxDQUFDLFVBQVUsQ0FBQzs0QkFDZixJQUFJLEVBQUUsSUFBQSx3QkFBVSxFQUFDLFVBQVUsQ0FBQzs0QkFDNUIsT0FBTyxFQUFFO2dDQUNQLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRTt3Q0FDZixNQUFNO3dDQUNOLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFO3dDQUN6QixRQUFRO3dDQUNSLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFO3dDQUN6QixrQ0FBa0M7d0NBQ2xDLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFO3dDQUN6QixZQUFZO3FDQUNiLENBQUM7NkJBQ0g7NEJBQ0QsTUFBTSxFQUFFLFdBQVc7NEJBQ25CLGFBQWEsRUFBRSxrQkFBSyxDQUFDLFVBQVUsQ0FBQztnQ0FDOUIsU0FBUyxFQUFFLG1CQUFtQjtnQ0FDOUIsT0FBTyxFQUFFO29DQUNQLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRTs0Q0FDZixNQUFNOzRDQUNOLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFOzRDQUN6QixRQUFROzRDQUNSLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFOzRDQUN6QixvQ0FBb0M7NENBQ3BDLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFOzRDQUN6QixZQUFZO3lDQUNiLENBQUM7aUNBQ0g7NkJBQ0YsQ0FBQzt5QkFDSCxDQUFDO3dCQUNGLGtCQUFLLENBQUMsVUFBVSxDQUFDOzRCQUNmLElBQUksRUFBRSxJQUFBLHdCQUFVLEVBQUMsU0FBUyxDQUFDOzRCQUMzQixPQUFPLEVBQUU7Z0NBQ1AsVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFO3dDQUNmLE1BQU07d0NBQ04sRUFBRSxHQUFHLEVBQUUsZ0JBQWdCLEVBQUU7d0NBQ3pCLFFBQVE7d0NBQ1IsRUFBRSxHQUFHLEVBQUUsZ0JBQWdCLEVBQUU7d0NBQ3pCLGtDQUFrQzt3Q0FDbEMsRUFBRSxHQUFHLEVBQUUsZ0JBQWdCLEVBQUU7d0NBQ3pCLFlBQVk7cUNBQ2IsQ0FBQzs2QkFDSDs0QkFDRCxNQUFNLEVBQUUsV0FBVzs0QkFDbkIsYUFBYSxFQUFFLGtCQUFLLENBQUMsVUFBVSxDQUFDO2dDQUM5QixTQUFTLEVBQUUsbUJBQW1COzZCQUMvQixDQUFDO3lCQUNILENBQUM7cUJBQ0g7aUJBQ0YsQ0FBQyxDQUFDO1NBQ0osQ0FBQyxDQUFDO0lBQ0wsQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBQSxzQkFBUSxFQUFDLHFFQUFxRSxFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUU7SUFDeEYsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFDaEIsT0FBTztRQUNQLE1BQU0sUUFBUSxHQUFHLElBQUkseUNBQTJCLENBQUMsYUFBYSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZFLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLHlCQUFXLENBQUMsR0FBRyxFQUFFLFdBQVcsRUFBRTtZQUM3RCxHQUFHLEVBQUU7Z0JBQ0gsT0FBTyxFQUFFLEtBQUs7Z0JBQ2QsTUFBTSxFQUFFLFdBQVc7YUFDcEI7U0FDRixDQUFDLENBQUMsQ0FBQztRQUVKLDZCQUE2QixFQUFFLENBQUM7SUFDbEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRTtRQUNoQixPQUFPO1FBQ1AsTUFBTSxRQUFRLEdBQUcsSUFBSSx5Q0FBMkIsQ0FBQyxhQUFhLEVBQUUsS0FBSyxFQUFFO1lBQ3JFLGdCQUFnQixFQUFFLElBQUk7U0FDdkIsQ0FBQyxDQUFDO1FBQ0gsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLHlCQUFXLENBQUMsR0FBRyxFQUFFLFdBQVcsRUFBRTtZQUNsRCxHQUFHLEVBQUU7Z0JBQ0gsT0FBTyxFQUFFLEtBQUs7Z0JBQ2QsTUFBTSxFQUFFLFdBQVc7YUFDcEI7U0FDRixDQUFDLENBQUMsQ0FBQztRQUVKLDZCQUE2QixFQUFFLENBQUM7SUFDbEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLDZCQUE2QjtRQUNwQywyQ0FBMkM7UUFDM0MsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUMvQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDNUIscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBTSxDQUFDLENBQUMscUJBQXFCLENBQUMsNkJBQTZCLEVBQUU7WUFDOUUsTUFBTSxFQUFFLGtCQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7b0JBQ3ZCLElBQUksRUFBRSxXQUFXO29CQUNqQixPQUFPLEVBQUU7d0JBQ1Asa0JBQUssQ0FBQyxVQUFVLENBQUM7NEJBQ2YsSUFBSSxFQUFFLElBQUEsd0JBQVUsRUFBQyxVQUFVLENBQUM7NEJBQzVCLE9BQU8sRUFBRTtnQ0FDUCxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUU7d0NBQ2YsTUFBTTt3Q0FDTixFQUFFLEdBQUcsRUFBRSxnQkFBZ0IsRUFBRTt3Q0FDekIsd0RBQXdEO3FDQUN6RCxDQUFDOzZCQUNIOzRCQUNELE1BQU0sRUFBRSxXQUFXOzRCQUNuQixhQUFhLEVBQUUsa0JBQUssQ0FBQyxVQUFVLENBQUM7Z0NBQzlCLFNBQVMsRUFBRSxpQkFBaUI7Z0NBQzVCLE9BQU8sRUFBRTtvQ0FDUCxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUU7NENBQ2YsTUFBTTs0Q0FDTixFQUFFLEdBQUcsRUFBRSxnQkFBZ0IsRUFBRTs0Q0FDekIsMERBQTBEO3lDQUMzRCxDQUFDO2lDQUNIOzZCQUNGLENBQUM7eUJBQ0gsQ0FBQzt3QkFDRixrQkFBSyxDQUFDLFVBQVUsQ0FBQzs0QkFDZixJQUFJLEVBQUUsSUFBQSx3QkFBVSxFQUFDLFNBQVMsQ0FBQzs0QkFDM0IsT0FBTyxFQUFFO2dDQUNQLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRTt3Q0FDZixNQUFNO3dDQUNOLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFO3dDQUN6Qix3REFBd0Q7cUNBQ3pELENBQUM7NkJBQ0g7NEJBQ0QsTUFBTSxFQUFFLFdBQVc7NEJBQ25CLGFBQWEsRUFBRSxrQkFBSyxDQUFDLFVBQVUsQ0FBQztnQ0FDOUIsU0FBUyxFQUFFLGlCQUFpQjs2QkFDN0IsQ0FBQzt5QkFDSCxDQUFDO3FCQUNIO2lCQUNGLENBQUMsQ0FBQztTQUNKLENBQUMsQ0FBQztRQUVILG1EQUFtRDtRQUNuRCxNQUFNLFlBQVksR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLGlDQUFpQyxDQUFDLENBQUM7UUFDMUUsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ25DLHFCQUFRLENBQUMsU0FBUyxDQUFDLFlBQWEsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHVCQUF1QixFQUFFO1lBQy9FLGNBQWMsRUFBRTtnQkFDZCxTQUFTLEVBQUUsa0JBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxrQkFBSyxDQUFDLFVBQVUsQ0FBQzt3QkFDM0MsTUFBTSxFQUFFLGtCQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsZUFBZSxFQUFFLGVBQWUsRUFBRSxVQUFVLENBQUMsQ0FBQzt3QkFDdkUsU0FBUyxFQUFFOzRCQUNULEdBQUcsRUFBRTtnQ0FDSCxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUU7d0NBQ2YsTUFBTTt3Q0FDTixFQUFFLEdBQUcsRUFBRSxnQkFBZ0IsRUFBRTt3Q0FDekIsSUFBQSx3QkFBVSxFQUFDLGlCQUFpQixDQUFDO3FDQUM5QixDQUFDOzZCQUNIO3lCQUNGO3FCQUNGLENBQUMsQ0FBQyxDQUFDO2FBQ0w7U0FDRixDQUFDLENBQUM7UUFFSCxrQ0FBa0M7UUFDbEMscUJBQVEsQ0FBQyxTQUFTLENBQUMsWUFBYSxDQUFDLENBQUMscUJBQXFCLENBQUMsZUFBZSxFQUFFO1lBQ3ZFLFNBQVMsRUFBRTtnQkFDVCxTQUFTLEVBQUUsa0JBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxrQkFBSyxDQUFDLFVBQVUsQ0FBQzt3QkFDM0MsTUFBTSxFQUFFLGtCQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsYUFBYSxFQUFFLGlCQUFpQixDQUFDLENBQUM7d0JBQzNELFNBQVMsRUFBRTs0QkFDVCxHQUFHLEVBQUU7Z0NBQ0gsVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFO3dDQUNmLE1BQU07d0NBQ04sRUFBRSxHQUFHLEVBQUUsZ0JBQWdCLEVBQUU7d0NBQ3pCLElBQUEsd0JBQVUsRUFBQyxpQkFBaUIsQ0FBQztxQ0FDOUIsQ0FBQzs2QkFDSDt5QkFDRjtxQkFDRixDQUFDLENBQUMsQ0FBQzthQUNMO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFDO0FBR0gsU0FBUyxZQUFZLENBQUMsUUFBZ0I7SUFDcEMsT0FBTztRQUNMLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDZixNQUFNO2dCQUNOLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFO2dCQUN6QixRQUFRO2dCQUNSLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFO2dCQUN6Qix1QkFBdUIsUUFBUSxHQUFHO2dCQUNsQyxFQUFFLEdBQUcsRUFBRSxnQkFBZ0IsRUFBRTtnQkFDekIsR0FBRztnQkFDSCxFQUFFLEdBQUcsRUFBRSxhQUFhLEVBQUU7YUFDdkIsQ0FBQztLQUNILENBQUM7QUFDSixDQUFDO0FBRUQsU0FBUyxlQUFlLENBQUMsUUFBZ0I7SUFDdkMsT0FBTztRQUNMLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDZixNQUFNO2dCQUNOLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFO2dCQUN6QixTQUFTLDBCQUFZLENBQUMsT0FBTyx1QkFBdUIsUUFBUSxJQUFJLDBCQUFZLENBQUMsT0FBTyxJQUFJLDBCQUFZLENBQUMsTUFBTSxFQUFFO2FBQzlHLENBQUM7S0FDSCxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9uby1leHRyYW5lb3VzLWRlcGVuZGVuY2llcyAqL1xuaW1wb3J0IHsgTWF0Y2gsIFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vLi4vYXNzZXJ0aW9ucyc7XG5pbXBvcnQgeyBTdGFjayB9IGZyb20gJy4uLy4uLy4uL2NvcmUnO1xuaW1wb3J0IHsgYmVoYXZpb3IsIExlZ2FjeVRlc3RHaXRIdWJOcG1QaXBlbGluZSwgT25lU3RhY2tBcHAsIFBJUEVMSU5FX0VOViwgVGVzdEFwcCwgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lLCBzdHJpbmdMaWtlIH0gZnJvbSAnLi4vdGVzdGhlbHBlcnMnO1xuXG5sZXQgYXBwOiBUZXN0QXBwO1xubGV0IHBpcGVsaW5lU3RhY2s6IFN0YWNrO1xuXG5iZWZvcmVFYWNoKCgpID0+IHtcbiAgYXBwID0gbmV3IFRlc3RBcHAoKTtcbiAgcGlwZWxpbmVTdGFjayA9IG5ldyBTdGFjayhhcHAsICdQaXBlbGluZVN0YWNrJywgeyBlbnY6IFBJUEVMSU5FX0VOViB9KTtcbn0pO1xuXG5hZnRlckVhY2goKCkgPT4ge1xuICBhcHAuY2xlYW51cCgpO1xufSk7XG5cbmJlaGF2aW9yKCdhY3Rpb24gaGFzIHJpZ2h0IHNldHRpbmdzIGZvciBzYW1lLWVudiBkZXBsb3ltZW50JywgKHN1aXRlKSA9PiB7XG4gIHN1aXRlLmxlZ2FjeSgoKSA9PiB7XG4gICAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTGVnYWN5VGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnKTtcbiAgICBwaXBlbGluZS5hZGRBcHBsaWNhdGlvblN0YWdlKG5ldyBPbmVTdGFja0FwcChhcHAsICdTYW1lJykpO1xuXG4gICAgVEhFTl9jb2RlUGlwZWxpbmVFeHBlY3Rpb24oYWdub3N0aWNSb2xlKTtcbiAgfSk7XG5cbiAgc3VpdGUuYWRkaXRpb25hbCgnbGVnYWN5OiBldmVuIGlmIGVudiBpcyBzcGVjaWZpZWQgYnV0IHRoZSBzYW1lIGFzIHRoZSBwaXBlbGluZScsICgpID0+IHtcbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBMZWdhY3lUZXN0R2l0SHViTnBtUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycpO1xuICAgIHBpcGVsaW5lLmFkZEFwcGxpY2F0aW9uU3RhZ2UobmV3IE9uZVN0YWNrQXBwKGFwcCwgJ1NhbWUnLCB7XG4gICAgICBlbnY6IFBJUEVMSU5FX0VOVixcbiAgICB9KSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGlvbihwaXBlbGluZUVudlJvbGUpO1xuICB9KTtcblxuICBzdWl0ZS5tb2Rlcm4oKCkgPT4ge1xuICAgIGNvbnN0IHBpcGVsaW5lID0gbmV3IE1vZGVyblRlc3RHaXRIdWJOcG1QaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ2RrJyk7XG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UobmV3IE9uZVN0YWNrQXBwKGFwcCwgJ1NhbWUnKSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGlvbihhZ25vc3RpY1JvbGUpO1xuICB9KTtcblxuICBzdWl0ZS5hZGRpdGlvbmFsKCdtb2Rlcm46IGV2ZW4gaWYgZW52IGlzIHNwZWNpZmllZCBidXQgdGhlIHNhbWUgYXMgdGhlIHBpcGVsaW5lJywgKCkgPT4ge1xuICAgIGNvbnN0IHBpcGVsaW5lID0gbmV3IE1vZGVyblRlc3RHaXRIdWJOcG1QaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ2RrJyk7XG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UobmV3IE9uZVN0YWNrQXBwKGFwcCwgJ1NhbWUnLCB7XG4gICAgICBlbnY6IFBJUEVMSU5FX0VOVixcbiAgICB9KSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGlvbihwaXBlbGluZUVudlJvbGUpO1xuICB9KTtcblxuICBmdW5jdGlvbiBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGlvbihyb2xlQXJuOiAoeDogc3RyaW5nKSA9PiBhbnkpIHtcbiAgICAvLyBUSEVOOiBwaXBlbGluZSBzdHJ1Y3R1cmUgaXMgY29ycmVjdFxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhwaXBlbGluZVN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q29kZVBpcGVsaW5lOjpQaXBlbGluZScsIHtcbiAgICAgIFN0YWdlczogTWF0Y2guYXJyYXlXaXRoKFt7XG4gICAgICAgIE5hbWU6ICdTYW1lJyxcbiAgICAgICAgQWN0aW9uczogW1xuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgTmFtZTogc3RyaW5nTGlrZSgnKlByZXBhcmUnKSxcbiAgICAgICAgICAgIFJvbGVBcm46IHJvbGVBcm4oJ2RlcGxveS1yb2xlJyksXG4gICAgICAgICAgICBDb25maWd1cmF0aW9uOiBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgICAgU3RhY2tOYW1lOiAnU2FtZS1TdGFjaycsXG4gICAgICAgICAgICAgIFJvbGVBcm46IHJvbGVBcm4oJ2Nmbi1leGVjLXJvbGUnKSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgTmFtZTogc3RyaW5nTGlrZSgnKkRlcGxveScpLFxuICAgICAgICAgICAgUm9sZUFybjogcm9sZUFybignZGVwbG95LXJvbGUnKSxcbiAgICAgICAgICAgIENvbmZpZ3VyYXRpb246IE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgICBTdGFja05hbWU6ICdTYW1lLVN0YWNrJyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pLFxuICAgICAgICBdLFxuICAgICAgfV0pLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTjogYXJ0aWZhY3QgYnVja2V0IGNhbiBiZSByZWFkIGJ5IGRlcGxveSByb2xlXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpTMzo6QnVja2V0UG9saWN5Jywge1xuICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgU3RhdGVtZW50OiBNYXRjaC5hcnJheVdpdGgoW01hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgIEFjdGlvbjogWydzMzpHZXRPYmplY3QqJywgJ3MzOkdldEJ1Y2tldConLCAnczM6TGlzdConXSxcbiAgICAgICAgICBQcmluY2lwYWw6IHtcbiAgICAgICAgICAgIEFXUzogcm9sZUFybignZGVwbG95LXJvbGUnKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KV0pLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxufSk7XG5cbmJlaGF2aW9yKCdhY3Rpb24gaGFzIHJpZ2h0IHNldHRpbmdzIGZvciBjcm9zcy1hY2NvdW50IGRlcGxveW1lbnQnLCAoc3VpdGUpID0+IHtcbiAgc3VpdGUubGVnYWN5KCgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTGVnYWN5VGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnKTtcbiAgICBwaXBlbGluZS5hZGRBcHBsaWNhdGlvblN0YWdlKG5ldyBPbmVTdGFja0FwcChhcHAsICdDcm9zc0FjY291bnQnLCB7IGVudjogeyBhY2NvdW50OiAneW91JyB9IH0pKTtcblxuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKTtcbiAgfSk7XG5cbiAgc3VpdGUubW9kZXJuKCgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnLCB7XG4gICAgICBjcm9zc0FjY291bnRLZXlzOiB0cnVlLFxuICAgIH0pO1xuICAgIHBpcGVsaW5lLmFkZFN0YWdlKG5ldyBPbmVTdGFja0FwcChhcHAsICdDcm9zc0FjY291bnQnLCB7IGVudjogeyBhY2NvdW50OiAneW91JyB9IH0pKTtcblxuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gVEhFTl9jb2RlUGlwZWxpbmVFeHBlY3RhdGlvbigpIHtcbiAgICAvLyBUSEVOOiBQaXBlbGllbiBzdHJ1Y3R1cmUgaXMgY29ycmVjdFxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhwaXBlbGluZVN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q29kZVBpcGVsaW5lOjpQaXBlbGluZScsIHtcbiAgICAgIFN0YWdlczogTWF0Y2guYXJyYXlXaXRoKFt7XG4gICAgICAgIE5hbWU6ICdDcm9zc0FjY291bnQnLFxuICAgICAgICBBY3Rpb25zOiBbXG4gICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgICBOYW1lOiBzdHJpbmdMaWtlKCcqUHJlcGFyZScpLFxuICAgICAgICAgICAgUm9sZUFybjoge1xuICAgICAgICAgICAgICAnRm46OkpvaW4nOiBbJycsIFtcbiAgICAgICAgICAgICAgICAnYXJuOicsXG4gICAgICAgICAgICAgICAgeyBSZWY6ICdBV1M6OlBhcnRpdGlvbicgfSxcbiAgICAgICAgICAgICAgICAnOmlhbTo6eW91OnJvbGUvY2RrLWhuYjY1OWZkcy1kZXBsb3ktcm9sZS15b3UtJyxcbiAgICAgICAgICAgICAgICB7IFJlZjogJ0FXUzo6UmVnaW9uJyB9LFxuICAgICAgICAgICAgICBdXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBDb25maWd1cmF0aW9uOiBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgICAgU3RhY2tOYW1lOiAnQ3Jvc3NBY2NvdW50LVN0YWNrJyxcbiAgICAgICAgICAgICAgUm9sZUFybjoge1xuICAgICAgICAgICAgICAgICdGbjo6Sm9pbic6IFsnJywgW1xuICAgICAgICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAgICAgICAgeyBSZWY6ICdBV1M6OlBhcnRpdGlvbicgfSxcbiAgICAgICAgICAgICAgICAgICc6aWFtOjp5b3U6cm9sZS9jZGstaG5iNjU5ZmRzLWNmbi1leGVjLXJvbGUteW91LScsXG4gICAgICAgICAgICAgICAgICB7IFJlZjogJ0FXUzo6UmVnaW9uJyB9LFxuICAgICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSksXG4gICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgICBOYW1lOiBzdHJpbmdMaWtlKCcqRGVwbG95JyksXG4gICAgICAgICAgICBSb2xlQXJuOiB7XG4gICAgICAgICAgICAgICdGbjo6Sm9pbic6IFsnJywgW1xuICAgICAgICAgICAgICAgICdhcm46JyxcbiAgICAgICAgICAgICAgICB7IFJlZjogJ0FXUzo6UGFydGl0aW9uJyB9LFxuICAgICAgICAgICAgICAgICc6aWFtOjp5b3U6cm9sZS9jZGstaG5iNjU5ZmRzLWRlcGxveS1yb2xlLXlvdS0nLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpSZWdpb24nIH0sXG4gICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIENvbmZpZ3VyYXRpb246IE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgICBTdGFja05hbWU6ICdDcm9zc0FjY291bnQtU3RhY2snLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSksXG4gICAgICAgIF0sXG4gICAgICB9XSksXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOOiBBcnRpZmFjdCBidWNrZXQgY2FuIGJlIHJlYWQgYnkgZGVwbG95IHJvbGVcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2socGlwZWxpbmVTdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlMzOjpCdWNrZXRQb2xpY3knLCB7XG4gICAgICBQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICBTdGF0ZW1lbnQ6IE1hdGNoLmFycmF5V2l0aChbTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgQWN0aW9uOiBbJ3MzOkdldE9iamVjdConLCAnczM6R2V0QnVja2V0KicsICdzMzpMaXN0KiddLFxuICAgICAgICAgIFByaW5jaXBhbDoge1xuICAgICAgICAgICAgQVdTOiB7XG4gICAgICAgICAgICAgICdGbjo6Sm9pbic6IFsnJywgW1xuICAgICAgICAgICAgICAgICdhcm46JyxcbiAgICAgICAgICAgICAgICB7IFJlZjogJ0FXUzo6UGFydGl0aW9uJyB9LFxuICAgICAgICAgICAgICAgIHN0cmluZ0xpa2UoJyotZGVwbG95LXJvbGUtKicpLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpSZWdpb24nIH0sXG4gICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KV0pLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxufSk7XG5cbmJlaGF2aW9yKCdhY3Rpb24gaGFzIHJpZ2h0IHNldHRpbmdzIGZvciBjcm9zcy1yZWdpb24gZGVwbG95bWVudCcsIChzdWl0ZSkgPT4ge1xuICBzdWl0ZS5sZWdhY3koKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBMZWdhY3lUZXN0R2l0SHViTnBtUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycpO1xuICAgIHBpcGVsaW5lLmFkZEFwcGxpY2F0aW9uU3RhZ2UobmV3IE9uZVN0YWNrQXBwKGFwcCwgJ0Nyb3NzUmVnaW9uJywgeyBlbnY6IHsgcmVnaW9uOiAnZWxzZXdoZXJlJyB9IH0pKTtcblxuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKTtcbiAgfSk7XG5cbiAgc3VpdGUubW9kZXJuKCgpID0+IHtcbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBNb2Rlcm5UZXN0R2l0SHViTnBtUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycsIHtcbiAgICAgIGNyb3NzQWNjb3VudEtleXM6IHRydWUsXG4gICAgfSk7XG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UobmV3IE9uZVN0YWNrQXBwKGFwcCwgJ0Nyb3NzUmVnaW9uJywgeyBlbnY6IHsgcmVnaW9uOiAnZWxzZXdoZXJlJyB9IH0pKTtcblxuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gVEhFTl9jb2RlUGlwZWxpbmVFeHBlY3RhdGlvbigpIHtcbiAgICAvLyBUSEVOXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb2RlUGlwZWxpbmU6OlBpcGVsaW5lJywge1xuICAgICAgU3RhZ2VzOiBNYXRjaC5hcnJheVdpdGgoW3tcbiAgICAgICAgTmFtZTogJ0Nyb3NzUmVnaW9uJyxcbiAgICAgICAgQWN0aW9uczogW1xuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgTmFtZTogc3RyaW5nTGlrZSgnKlByZXBhcmUnKSxcbiAgICAgICAgICAgIFJvbGVBcm46IHtcbiAgICAgICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpQYXJ0aXRpb24nIH0sXG4gICAgICAgICAgICAgICAgJzppYW06OicsXG4gICAgICAgICAgICAgICAgeyBSZWY6ICdBV1M6OkFjY291bnRJZCcgfSxcbiAgICAgICAgICAgICAgICAnOnJvbGUvY2RrLWhuYjY1OWZkcy1kZXBsb3ktcm9sZS0nLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpBY2NvdW50SWQnIH0sXG4gICAgICAgICAgICAgICAgJy1lbHNld2hlcmUnLFxuICAgICAgICAgICAgICBdXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBSZWdpb246ICdlbHNld2hlcmUnLFxuICAgICAgICAgICAgQ29uZmlndXJhdGlvbjogTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgICAgIFN0YWNrTmFtZTogJ0Nyb3NzUmVnaW9uLVN0YWNrJyxcbiAgICAgICAgICAgICAgUm9sZUFybjoge1xuICAgICAgICAgICAgICAgICdGbjo6Sm9pbic6IFsnJywgW1xuICAgICAgICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAgICAgICAgeyBSZWY6ICdBV1M6OlBhcnRpdGlvbicgfSxcbiAgICAgICAgICAgICAgICAgICc6aWFtOjonLFxuICAgICAgICAgICAgICAgICAgeyBSZWY6ICdBV1M6OkFjY291bnRJZCcgfSxcbiAgICAgICAgICAgICAgICAgICc6cm9sZS9jZGstaG5iNjU5ZmRzLWNmbi1leGVjLXJvbGUtJyxcbiAgICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpBY2NvdW50SWQnIH0sXG4gICAgICAgICAgICAgICAgICAnLWVsc2V3aGVyZScsXG4gICAgICAgICAgICAgICAgXV0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgIE5hbWU6IHN0cmluZ0xpa2UoJypEZXBsb3knKSxcbiAgICAgICAgICAgIFJvbGVBcm46IHtcbiAgICAgICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpQYXJ0aXRpb24nIH0sXG4gICAgICAgICAgICAgICAgJzppYW06OicsXG4gICAgICAgICAgICAgICAgeyBSZWY6ICdBV1M6OkFjY291bnRJZCcgfSxcbiAgICAgICAgICAgICAgICAnOnJvbGUvY2RrLWhuYjY1OWZkcy1kZXBsb3ktcm9sZS0nLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpBY2NvdW50SWQnIH0sXG4gICAgICAgICAgICAgICAgJy1lbHNld2hlcmUnLFxuICAgICAgICAgICAgICBdXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBSZWdpb246ICdlbHNld2hlcmUnLFxuICAgICAgICAgICAgQ29uZmlndXJhdGlvbjogTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgICAgIFN0YWNrTmFtZTogJ0Nyb3NzUmVnaW9uLVN0YWNrJyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pLFxuICAgICAgICBdLFxuICAgICAgfV0pLFxuICAgIH0pO1xuICB9XG59KTtcblxuYmVoYXZpb3IoJ2FjdGlvbiBoYXMgcmlnaHQgc2V0dGluZ3MgZm9yIGNyb3NzLWFjY291bnQvY3Jvc3MtcmVnaW9uIGRlcGxveW1lbnQnLCAoc3VpdGUpID0+IHtcbiAgc3VpdGUubGVnYWN5KCgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTGVnYWN5VGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnKTtcbiAgICBwaXBlbGluZS5hZGRBcHBsaWNhdGlvblN0YWdlKG5ldyBPbmVTdGFja0FwcChhcHAsICdDcm9zc0JvdGgnLCB7XG4gICAgICBlbnY6IHtcbiAgICAgICAgYWNjb3VudDogJ3lvdScsXG4gICAgICAgIHJlZ2lvbjogJ2Vsc2V3aGVyZScsXG4gICAgICB9LFxuICAgIH0pKTtcblxuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb25zKCk7XG4gIH0pO1xuXG4gIHN1aXRlLm1vZGVybigoKSA9PiB7XG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHBpcGVsaW5lID0gbmV3IE1vZGVyblRlc3RHaXRIdWJOcG1QaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ2RrJywge1xuICAgICAgY3Jvc3NBY2NvdW50S2V5czogdHJ1ZSxcbiAgICB9KTtcbiAgICBwaXBlbGluZS5hZGRTdGFnZShuZXcgT25lU3RhY2tBcHAoYXBwLCAnQ3Jvc3NCb3RoJywge1xuICAgICAgZW52OiB7XG4gICAgICAgIGFjY291bnQ6ICd5b3UnLFxuICAgICAgICByZWdpb246ICdlbHNld2hlcmUnLFxuICAgICAgfSxcbiAgICB9KSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9ucygpO1xuICB9KTtcblxuICBmdW5jdGlvbiBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9ucygpIHtcbiAgICAvLyBUSEVOOiBwaXBlbGluZSBzdHJ1Y3R1cmUgbXVzdCBiZSBjb3JyZWN0XG4gICAgY29uc3Qgc3RhY2sgPSBhcHAuc3RhY2tBcnRpZmFjdChwaXBlbGluZVN0YWNrKTtcbiAgICBleHBlY3Qoc3RhY2spLnRvQmVEZWZpbmVkKCk7XG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrISkuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNvZGVQaXBlbGluZTo6UGlwZWxpbmUnLCB7XG4gICAgICBTdGFnZXM6IE1hdGNoLmFycmF5V2l0aChbe1xuICAgICAgICBOYW1lOiAnQ3Jvc3NCb3RoJyxcbiAgICAgICAgQWN0aW9uczogW1xuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgTmFtZTogc3RyaW5nTGlrZSgnKlByZXBhcmUnKSxcbiAgICAgICAgICAgIFJvbGVBcm46IHtcbiAgICAgICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpQYXJ0aXRpb24nIH0sXG4gICAgICAgICAgICAgICAgJzppYW06OnlvdTpyb2xlL2Nkay1obmI2NTlmZHMtZGVwbG95LXJvbGUteW91LWVsc2V3aGVyZScsXG4gICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFJlZ2lvbjogJ2Vsc2V3aGVyZScsXG4gICAgICAgICAgICBDb25maWd1cmF0aW9uOiBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgICAgU3RhY2tOYW1lOiAnQ3Jvc3NCb3RoLVN0YWNrJyxcbiAgICAgICAgICAgICAgUm9sZUFybjoge1xuICAgICAgICAgICAgICAgICdGbjo6Sm9pbic6IFsnJywgW1xuICAgICAgICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAgICAgICAgeyBSZWY6ICdBV1M6OlBhcnRpdGlvbicgfSxcbiAgICAgICAgICAgICAgICAgICc6aWFtOjp5b3U6cm9sZS9jZGstaG5iNjU5ZmRzLWNmbi1leGVjLXJvbGUteW91LWVsc2V3aGVyZScsXG4gICAgICAgICAgICAgICAgXV0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgIE5hbWU6IHN0cmluZ0xpa2UoJypEZXBsb3knKSxcbiAgICAgICAgICAgIFJvbGVBcm46IHtcbiAgICAgICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAgICAgIHsgUmVmOiAnQVdTOjpQYXJ0aXRpb24nIH0sXG4gICAgICAgICAgICAgICAgJzppYW06OnlvdTpyb2xlL2Nkay1obmI2NTlmZHMtZGVwbG95LXJvbGUteW91LWVsc2V3aGVyZScsXG4gICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFJlZ2lvbjogJ2Vsc2V3aGVyZScsXG4gICAgICAgICAgICBDb25maWd1cmF0aW9uOiBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgICAgU3RhY2tOYW1lOiAnQ3Jvc3NCb3RoLVN0YWNrJyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pLFxuICAgICAgICBdLFxuICAgICAgfV0pLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTjogYXJ0aWZhY3QgYnVja2V0IGNhbiBiZSByZWFkIGJ5IGRlcGxveSByb2xlXG4gICAgY29uc3Qgc3VwcG9ydFN0YWNrID0gYXBwLnN0YWNrQXJ0aWZhY3QoJ1BpcGVsaW5lU3RhY2stc3VwcG9ydC1lbHNld2hlcmUnKTtcbiAgICBleHBlY3Qoc3VwcG9ydFN0YWNrKS50b0JlRGVmaW5lZCgpO1xuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdXBwb3J0U3RhY2shKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6UzM6OkJ1Y2tldFBvbGljeScsIHtcbiAgICAgIFBvbGljeURvY3VtZW50OiB7XG4gICAgICAgIFN0YXRlbWVudDogTWF0Y2guYXJyYXlXaXRoKFtNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICBBY3Rpb246IE1hdGNoLmFycmF5V2l0aChbJ3MzOkdldE9iamVjdConLCAnczM6R2V0QnVja2V0KicsICdzMzpMaXN0KiddKSxcbiAgICAgICAgICBQcmluY2lwYWw6IHtcbiAgICAgICAgICAgIEFXUzoge1xuICAgICAgICAgICAgICAnRm46OkpvaW4nOiBbJycsIFtcbiAgICAgICAgICAgICAgICAnYXJuOicsXG4gICAgICAgICAgICAgICAgeyBSZWY6ICdBV1M6OlBhcnRpdGlvbicgfSxcbiAgICAgICAgICAgICAgICBzdHJpbmdMaWtlKCcqLWRlcGxveS1yb2xlLSonKSxcbiAgICAgICAgICAgICAgXV0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXSksXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gQW5kIHRoZSBrZXkgdG8gZ28gYWxvbmcgd2l0aCBpdFxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdXBwb3J0U3RhY2shKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6S01TOjpLZXknLCB7XG4gICAgICBLZXlQb2xpY3k6IHtcbiAgICAgICAgU3RhdGVtZW50OiBNYXRjaC5hcnJheVdpdGgoW01hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgIEFjdGlvbjogTWF0Y2guYXJyYXlXaXRoKFsna21zOkRlY3J5cHQnLCAna21zOkRlc2NyaWJlS2V5J10pLFxuICAgICAgICAgIFByaW5jaXBhbDoge1xuICAgICAgICAgICAgQVdTOiB7XG4gICAgICAgICAgICAgICdGbjo6Sm9pbic6IFsnJywgW1xuICAgICAgICAgICAgICAgICdhcm46JyxcbiAgICAgICAgICAgICAgICB7IFJlZjogJ0FXUzo6UGFydGl0aW9uJyB9LFxuICAgICAgICAgICAgICAgIHN0cmluZ0xpa2UoJyotZGVwbG95LXJvbGUtKicpLFxuICAgICAgICAgICAgICBdXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSldKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5cbmZ1bmN0aW9uIGFnbm9zdGljUm9sZShyb2xlTmFtZTogc3RyaW5nKSB7XG4gIHJldHVybiB7XG4gICAgJ0ZuOjpKb2luJzogWycnLCBbXG4gICAgICAnYXJuOicsXG4gICAgICB7IFJlZjogJ0FXUzo6UGFydGl0aW9uJyB9LFxuICAgICAgJzppYW06OicsXG4gICAgICB7IFJlZjogJ0FXUzo6QWNjb3VudElkJyB9LFxuICAgICAgYDpyb2xlL2Nkay1obmI2NTlmZHMtJHtyb2xlTmFtZX0tYCxcbiAgICAgIHsgUmVmOiAnQVdTOjpBY2NvdW50SWQnIH0sXG4gICAgICAnLScsXG4gICAgICB7IFJlZjogJ0FXUzo6UmVnaW9uJyB9LFxuICAgIF1dLFxuICB9O1xufVxuXG5mdW5jdGlvbiBwaXBlbGluZUVudlJvbGUocm9sZU5hbWU6IHN0cmluZykge1xuICByZXR1cm4ge1xuICAgICdGbjo6Sm9pbic6IFsnJywgW1xuICAgICAgJ2FybjonLFxuICAgICAgeyBSZWY6ICdBV1M6OlBhcnRpdGlvbicgfSxcbiAgICAgIGA6aWFtOjoke1BJUEVMSU5FX0VOVi5hY2NvdW50fTpyb2xlL2Nkay1obmI2NTlmZHMtJHtyb2xlTmFtZX0tJHtQSVBFTElORV9FTlYuYWNjb3VudH0tJHtQSVBFTElORV9FTlYucmVnaW9ufWAsXG4gICAgXV0sXG4gIH07XG59Il19