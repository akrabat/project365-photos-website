"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* eslint-disable import/no-extraneous-dependencies */
const assertions_1 = require("../../../assertions");
const codebuild = require("../../../aws-codebuild");
const codepipeline = require("../../../aws-codepipeline");
const ec2 = require("../../../aws-ec2");
const iam = require("../../../aws-iam");
const s3 = require("../../../aws-s3");
const core_1 = require("../../../core");
const cdkp = require("../../lib");
const lib_1 = require("../../lib");
const default_codebuild_image_1 = require("../../lib/private/default-codebuild-image");
const testhelpers_1 = require("../testhelpers");
let app;
let pipelineStack;
beforeEach(() => {
    app = new testhelpers_1.TestApp();
    pipelineStack = new core_1.Stack(app, 'PipelineStack', { env: testhelpers_1.PIPELINE_ENV });
});
afterEach(() => {
    app.cleanup();
});
(0, testhelpers_1.behavior)('can add manual approval after app', (suite) => {
    // No need to be backwards compatible
    suite.doesNotApply.legacy();
    suite.modern(() => {
        // WHEN
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addStage(new testhelpers_1.TwoStackApp(app, 'MyApp'), {
            post: [
                new cdkp.ManualApprovalStep('Approve'),
            ],
        });
        // THEN
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'MyApp',
                    Actions: (0, testhelpers_1.sortByRunOrder)([
                        assertions_1.Match.objectLike({ Name: 'Stack1.Prepare' }),
                        assertions_1.Match.objectLike({ Name: 'Stack1.Deploy' }),
                        assertions_1.Match.objectLike({ Name: 'Stack2.Prepare' }),
                        assertions_1.Match.objectLike({ Name: 'Stack2.Deploy' }),
                        assertions_1.Match.objectLike({ Name: 'Approve' }),
                    ]),
                }]),
        });
    });
});
(0, testhelpers_1.behavior)('can add steps to wave', (suite) => {
    // No need to be backwards compatible
    suite.doesNotApply.legacy();
    suite.modern(() => {
        // WHEN
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        const wave = pipeline.addWave('MyWave', {
            post: [
                new cdkp.ManualApprovalStep('Approve'),
            ],
        });
        wave.addStage(new testhelpers_1.OneStackApp(pipelineStack, 'Stage1'));
        wave.addStage(new testhelpers_1.OneStackApp(pipelineStack, 'Stage2'));
        wave.addStage(new testhelpers_1.OneStackApp(pipelineStack, 'Stage3'));
        // THEN
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'MyWave',
                    Actions: (0, testhelpers_1.sortByRunOrder)([
                        assertions_1.Match.objectLike({ Name: 'Stage1.Stack.Prepare' }),
                        assertions_1.Match.objectLike({ Name: 'Stage2.Stack.Prepare' }),
                        assertions_1.Match.objectLike({ Name: 'Stage3.Stack.Prepare' }),
                        assertions_1.Match.objectLike({ Name: 'Stage1.Stack.Deploy' }),
                        assertions_1.Match.objectLike({ Name: 'Stage2.Stack.Deploy' }),
                        assertions_1.Match.objectLike({ Name: 'Stage3.Stack.Deploy' }),
                        assertions_1.Match.objectLike({ Name: 'Approve' }),
                    ]),
                }]),
        });
    });
});
(0, testhelpers_1.behavior)('script validation steps can use stack outputs as environment variables', (suite) => {
    suite.legacy(() => {
        // GIVEN
        const { pipeline } = legacySetup();
        const stage = new testhelpers_1.StageWithStackOutput(app, 'MyApp');
        // WHEN
        const pipeStage = pipeline.addApplicationStage(stage);
        pipeStage.addActions(new cdkp.ShellScriptAction({
            actionName: 'TestOutput',
            useOutputs: {
                BUCKET_NAME: pipeline.stackOutput(stage.output),
            },
            commands: ['echo $BUCKET_NAME'],
        }));
        // THEN
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'MyApp',
                    Actions: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            ActionTypeId: {
                                Provider: 'CodeBuild',
                            },
                            Configuration: {
                                ProjectName: assertions_1.Match.anyValue(),
                            },
                            InputArtifacts: [{ Name: assertions_1.Match.anyValue() }],
                            Name: 'TestOutput',
                        }),
                        assertions_1.Match.objectLike({
                            Name: 'Stack.Deploy',
                            OutputArtifacts: [{ Name: assertions_1.Match.anyValue() }],
                            Configuration: {
                                OutputFileName: 'outputs.json',
                            },
                        }),
                    ]),
                }]),
        });
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodeBuild::Project', {
            Environment: {
                Image: default_codebuild_image_1.CDKP_DEFAULT_CODEBUILD_IMAGE.imageId,
            },
            Source: {
                BuildSpec: assertions_1.Match.serializedJson(assertions_1.Match.objectLike({
                    phases: {
                        build: {
                            commands: [
                                'set -eu',
                                'export BUCKET_NAME="$(node -pe \'require(process.env.CODEBUILD_SRC_DIR + "/outputs.json")["BucketName"]\')"',
                                'echo $BUCKET_NAME',
                            ],
                        },
                    },
                })),
                Type: 'CODEPIPELINE',
            },
        });
    });
    suite.modern(() => {
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        const myApp = new testhelpers_1.AppWithOutput(app, 'Alpha');
        pipeline.addStage(myApp, {
            post: [
                new cdkp.ShellStep('Approve', {
                    commands: ['/bin/true'],
                    envFromCfnOutputs: {
                        THE_OUTPUT: myApp.theOutput,
                    },
                }),
            ],
        });
        // THEN
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'Alpha',
                    Actions: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            Name: 'Stack.Deploy',
                            Namespace: 'AlphaStack6B3389FA',
                        }),
                        assertions_1.Match.objectLike({
                            Name: 'Approve',
                            Configuration: assertions_1.Match.objectLike({
                                EnvironmentVariables: assertions_1.Match.serializedJson([
                                    { name: 'THE_OUTPUT', value: '#{AlphaStack6B3389FA.MyOutput}', type: 'PLAINTEXT' },
                                ]),
                            }),
                        }),
                    ]),
                }]),
        });
    });
});
(0, testhelpers_1.behavior)('stackOutput generates names limited to 100 characters', (suite) => {
    suite.legacy(() => {
        const { pipeline } = legacySetup();
        const stage = new testhelpers_1.StageWithStackOutput(app, 'APreposterouslyLongAndComplicatedNameMadeUpJustToMakeItExceedTheLimitDefinedByCodeBuild');
        const pipeStage = pipeline.addApplicationStage(stage);
        pipeStage.addActions(new cdkp.ShellScriptAction({
            actionName: 'TestOutput',
            useOutputs: {
                BUCKET_NAME: pipeline.stackOutput(stage.output),
            },
            commands: ['echo $BUCKET_NAME'],
        }));
        // THEN
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'APreposterouslyLongAndComplicatedNameMadeUpJustToMakeItExceedTheLimitDefinedByCodeBuild',
                    Actions: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            ActionTypeId: {
                                Provider: 'CodeBuild',
                            },
                            Configuration: {
                                ProjectName: assertions_1.Match.anyValue(),
                            },
                            InputArtifacts: [{ Name: (0, testhelpers_1.stringNoLongerThan)(100) }],
                            Name: 'TestOutput',
                        }),
                        assertions_1.Match.objectLike({
                            Name: 'Stack.Deploy',
                            OutputArtifacts: [{ Name: (0, testhelpers_1.stringNoLongerThan)(100) }],
                            Configuration: {
                                OutputFileName: 'outputs.json',
                            },
                        }),
                    ]),
                }]),
        });
    });
    suite.modern(() => {
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        const stage = new testhelpers_1.StageWithStackOutput(app, 'APreposterouslyLongAndComplicatedNameMadeUpJustToMakeItExceedTheLimitDefinedByCodeBuild');
        pipeline.addStage(stage, {
            post: [
                new cdkp.ShellStep('TestOutput', {
                    commands: ['echo $BUCKET_NAME'],
                    envFromCfnOutputs: {
                        BUCKET_NAME: stage.output,
                    },
                }),
            ],
        });
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'APreposterouslyLongAndComplicatedNameMadeUpJustToMakeItExceedTheLimitDefinedByCodeBuild',
                    Actions: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            Name: 'Stack.Deploy',
                            Namespace: (0, testhelpers_1.stringNoLongerThan)(100),
                        }),
                    ]),
                }]),
        });
    });
});
(0, testhelpers_1.behavior)('validation step can run from scripts in source', (suite) => {
    suite.legacy(() => {
        const { pipeline, sourceArtifact } = legacySetup();
        // WHEN
        pipeline.addStage('Test').addActions(new cdkp.ShellScriptAction({
            actionName: 'UseSources',
            additionalArtifacts: [sourceArtifact],
            commands: ['true'],
        }));
        THEN_codePipelineExpectation();
    });
    suite.modern(() => {
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addStage(new testhelpers_1.TwoStackApp(app, 'Test'), {
            post: [
                new cdkp.ShellStep('UseSources', {
                    input: pipeline.gitHubSource,
                    commands: ['set -eu', 'true'],
                }),
            ],
        });
        THEN_codePipelineExpectation();
    });
    function THEN_codePipelineExpectation() {
        const sourceArtifact = new assertions_1.Capture();
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'Source',
                    Actions: [
                        assertions_1.Match.objectLike({
                            OutputArtifacts: [{ Name: sourceArtifact }],
                        }),
                    ],
                }]),
        });
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'Test',
                    Actions: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            Name: 'UseSources',
                            InputArtifacts: [{ Name: sourceArtifact.asString() }],
                        }),
                    ]),
                }]),
        });
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodeBuild::Project', {
            Environment: {
                Image: default_codebuild_image_1.CDKP_DEFAULT_CODEBUILD_IMAGE.imageId,
            },
            Source: {
                BuildSpec: assertions_1.Match.serializedJson(assertions_1.Match.objectLike({
                    phases: {
                        build: {
                            commands: [
                                'set -eu',
                                'true',
                            ],
                        },
                    },
                })),
            },
        });
    }
});
(0, testhelpers_1.behavior)('can use additional output artifacts from build', (suite) => {
    suite.legacy(() => {
        // WHEN
        const { pipeline, integTestArtifact } = legacySetup();
        pipeline.addStage('Test').addActions(new cdkp.ShellScriptAction({
            actionName: 'UseBuildArtifact',
            additionalArtifacts: [integTestArtifact],
            commands: ['true'],
        }));
        THEN_codePipelineExpectation();
    });
    suite.modern(() => {
        const synth = new lib_1.ShellStep('Synth', {
            input: lib_1.CodePipelineSource.gitHub('test/test', 'main'),
            commands: ['synth'],
        });
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
            synth,
        });
        pipeline.addStage(new testhelpers_1.TwoStackApp(app, 'Test'), {
            post: [
                new cdkp.ShellStep('UseBuildArtifact', {
                    input: synth.addOutputDirectory('test'),
                    commands: ['set -eu', 'true'],
                }),
            ],
        });
        THEN_codePipelineExpectation();
    });
    function THEN_codePipelineExpectation() {
        const integArtifact = new assertions_1.Capture();
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'Build',
                    Actions: [
                        assertions_1.Match.objectLike({
                            Name: 'Synth',
                            OutputArtifacts: [
                                { Name: assertions_1.Match.anyValue() },
                                { Name: integArtifact },
                            ],
                        }),
                    ],
                }]),
        });
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'Test',
                    Actions: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            Name: 'UseBuildArtifact',
                            InputArtifacts: [{ Name: integArtifact.asString() }],
                        }),
                    ]),
                }]),
        });
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodeBuild::Project', {
            Environment: {
                Image: default_codebuild_image_1.CDKP_DEFAULT_CODEBUILD_IMAGE.imageId,
            },
            Source: {
                BuildSpec: assertions_1.Match.serializedJson(assertions_1.Match.objectLike({
                    phases: {
                        build: {
                            commands: [
                                'set -eu',
                                'true',
                            ],
                        },
                    },
                })),
            },
        });
    }
});
(0, testhelpers_1.behavior)('can add policy statements to shell script action', (suite) => {
    suite.legacy(() => {
        // WHEN
        const { pipeline, integTestArtifact } = legacySetup();
        pipeline.addStage('Test').addActions(new cdkp.ShellScriptAction({
            actionName: 'Boop',
            additionalArtifacts: [integTestArtifact],
            commands: ['true'],
            rolePolicyStatements: [
                new iam.PolicyStatement({
                    actions: ['s3:Banana'],
                    resources: ['*'],
                }),
            ],
        }));
        THEN_codePipelineExpectation();
    });
    suite.modern(() => {
        // WHEN
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addStage(new testhelpers_1.TwoStackApp(app, 'Test'), {
            post: [
                new cdkp.CodeBuildStep('Boop', {
                    commands: ['true'],
                    rolePolicyStatements: [
                        new iam.PolicyStatement({
                            actions: ['s3:Banana'],
                            resources: ['*'],
                        }),
                    ],
                }),
            ],
        });
        THEN_codePipelineExpectation();
    });
    function THEN_codePipelineExpectation() {
        // THEN
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::IAM::Policy', {
            PolicyDocument: {
                Statement: assertions_1.Match.arrayWith([assertions_1.Match.objectLike({
                        Action: 's3:Banana',
                        Resource: '*',
                    })]),
            },
        });
    }
});
(0, testhelpers_1.behavior)('can grant permissions to shell script action', (suite) => {
    let bucket;
    beforeEach(() => {
        bucket = s3.Bucket.fromBucketArn(pipelineStack, 'Bucket', 'arn:aws:s3:::this-particular-bucket');
    });
    suite.legacy(() => {
        const { pipeline, integTestArtifact } = legacySetup();
        const action = new cdkp.ShellScriptAction({
            actionName: 'Boop',
            additionalArtifacts: [integTestArtifact],
            commands: ['true'],
        });
        pipeline.addStage('Test').addActions(action);
        // WHEN
        bucket.grantRead(action);
        THEN_codePipelineExpectation();
    });
    suite.modern(() => {
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        const codeBuildStep = new cdkp.CodeBuildStep('Boop', {
            commands: ['true'],
        });
        pipeline.addStage(new testhelpers_1.TwoStackApp(app, 'Test'), {
            post: [codeBuildStep],
        });
        pipeline.buildPipeline();
        // WHEN
        bucket.grantRead(codeBuildStep.project);
        THEN_codePipelineExpectation();
    });
    function THEN_codePipelineExpectation() {
        // THEN
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::IAM::Policy', {
            PolicyDocument: {
                Statement: assertions_1.Match.arrayWith([assertions_1.Match.objectLike({
                        Action: ['s3:GetObject*', 's3:GetBucket*', 's3:List*'],
                        Resource: ['arn:aws:s3:::this-particular-bucket', 'arn:aws:s3:::this-particular-bucket/*'],
                    })]),
            },
        });
    }
});
(0, testhelpers_1.behavior)('can run shell script actions in a VPC', (suite) => {
    let vpc;
    beforeEach(() => {
        vpc = new ec2.Vpc(pipelineStack, 'VPC');
    });
    suite.legacy(() => {
        const { pipeline, integTestArtifact } = legacySetup();
        pipeline.addStage('Test').addActions(new cdkp.ShellScriptAction({
            vpc,
            actionName: 'VpcAction',
            additionalArtifacts: [integTestArtifact],
            commands: ['true'],
        }));
        THEN_codePipelineExpectation();
    });
    suite.modern(() => {
        // All CodeBuild jobs automatically go into the VPC
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
            codeBuildDefaults: { vpc },
        });
        pipeline.addStage(new testhelpers_1.TwoStackApp(app, 'MyApp'), {
            post: [new cdkp.ShellStep('VpcAction', {
                    commands: ['set -eu', 'true'],
                })],
        });
        THEN_codePipelineExpectation();
    });
    suite.additional('modern, alternate API', () => {
        // Can also explicitly specify a VPC when going to the "full config" class
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addStage(new testhelpers_1.TwoStackApp(app, 'MyApp'), {
            post: [new cdkp.CodeBuildStep('VpcAction', {
                    commands: ['set -eu', 'true'],
                    vpc,
                })],
        });
        THEN_codePipelineExpectation();
    });
    function THEN_codePipelineExpectation() {
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodeBuild::Project', {
            Environment: {
                Image: default_codebuild_image_1.CDKP_DEFAULT_CODEBUILD_IMAGE.imageId,
            },
            VpcConfig: {
                Subnets: [
                    {
                        Ref: 'VPCPrivateSubnet1Subnet8BCA10E0',
                    },
                    {
                        Ref: 'VPCPrivateSubnet2SubnetCFCDAA7A',
                    },
                    {
                        Ref: 'VPCPrivateSubnet3Subnet3EDCD457',
                    },
                ],
                VpcId: {
                    Ref: 'VPCB9E5F0B4',
                },
            },
            Source: {
                BuildSpec: assertions_1.Match.serializedJson(assertions_1.Match.objectLike({
                    phases: {
                        build: {
                            commands: [
                                'set -eu',
                                'true',
                            ],
                        },
                    },
                })),
            },
        });
    }
});
(0, testhelpers_1.behavior)('can run shell script actions with a specific SecurityGroup', (suite) => {
    let vpc;
    let sg;
    beforeEach(() => {
        vpc = new ec2.Vpc(pipelineStack, 'VPC');
        sg = new ec2.SecurityGroup(pipelineStack, 'SG', { vpc });
    });
    suite.legacy(() => {
        // WHEN
        const { pipeline, integTestArtifact } = legacySetup();
        pipeline.addStage('Test').addActions(new cdkp.ShellScriptAction({
            vpc,
            securityGroups: [sg],
            actionName: 'sgAction',
            additionalArtifacts: [integTestArtifact],
            commands: ['true'],
        }));
        THEN_codePipelineExpectation();
    });
    suite.modern(() => {
        // All CodeBuild jobs automatically go into the VPC
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addStage(new testhelpers_1.TwoStackApp(app, 'Test'), {
            post: [new cdkp.CodeBuildStep('sgAction', {
                    commands: ['set -eu', 'true'],
                    vpc,
                    securityGroups: [sg],
                })],
        });
        THEN_codePipelineExpectation();
    });
    function THEN_codePipelineExpectation() {
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'Test',
                    Actions: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            Name: 'sgAction',
                        }),
                    ]),
                }]),
        });
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodeBuild::Project', {
            VpcConfig: {
                SecurityGroupIds: [
                    {
                        'Fn::GetAtt': [
                            'SGADB53937',
                            'GroupId',
                        ],
                    },
                ],
                VpcId: {
                    Ref: 'VPCB9E5F0B4',
                },
            },
        });
    }
});
(0, testhelpers_1.behavior)('can run scripts with specified BuildEnvironment', (suite) => {
    suite.legacy(() => {
        let { pipeline, integTestArtifact } = legacySetup();
        // WHEN
        pipeline.addStage('Test').addActions(new cdkp.ShellScriptAction({
            actionName: 'imageAction',
            additionalArtifacts: [integTestArtifact],
            commands: ['true'],
            environment: { buildImage: codebuild.LinuxBuildImage.STANDARD_2_0 },
        }));
        THEN_codePipelineExpectation();
    });
    suite.modern(() => {
        // Run all Build jobs with the given image
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
            codeBuildDefaults: {
                buildEnvironment: {
                    buildImage: codebuild.LinuxBuildImage.STANDARD_2_0,
                },
            },
        });
        pipeline.addStage(new testhelpers_1.TwoStackApp(app, 'Test'), {
            post: [new cdkp.ShellStep('imageAction', {
                    commands: ['true'],
                })],
        });
        THEN_codePipelineExpectation();
    });
    suite.additional('modern, alternative API', () => {
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addStage(new testhelpers_1.TwoStackApp(app, 'Test'), {
            post: [new cdkp.CodeBuildStep('imageAction', {
                    commands: ['true'],
                    buildEnvironment: {
                        buildImage: codebuild.LinuxBuildImage.STANDARD_2_0,
                    },
                })],
        });
        THEN_codePipelineExpectation();
    });
    function THEN_codePipelineExpectation() {
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodeBuild::Project', {
            Environment: {
                Image: 'aws/codebuild/standard:2.0',
            },
        });
    }
});
(0, testhelpers_1.behavior)('can run scripts with magic environment variables', (suite) => {
    suite.legacy(() => {
        const { pipeline, integTestArtifact } = legacySetup();
        pipeline.addStage('Test').addActions(new cdkp.ShellScriptAction({
            actionName: 'imageAction',
            additionalArtifacts: [integTestArtifact],
            commands: ['true'],
            environmentVariables: {
                VERSION: { value: codepipeline.GlobalVariables.executionId },
            },
        }));
        THEN_codePipelineExpectation();
    });
    suite.modern(() => {
        // Run all Build jobs with the given image
        const pipeline = new testhelpers_1.ModernTestGitHubNpmPipeline(pipelineStack, 'Cdk');
        pipeline.addStage(new testhelpers_1.TwoStackApp(app, 'Test'), {
            post: [new cdkp.ShellStep('imageAction', {
                    commands: ['true'],
                    env: {
                        VERSION: codepipeline.GlobalVariables.executionId,
                    },
                })],
        });
        THEN_codePipelineExpectation();
    });
    function THEN_codePipelineExpectation() {
        // THEN
        assertions_1.Template.fromStack(pipelineStack).hasResourceProperties('AWS::CodePipeline::Pipeline', {
            Stages: assertions_1.Match.arrayWith([{
                    Name: 'Test',
                    Actions: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            Name: 'imageAction',
                            Configuration: assertions_1.Match.objectLike({
                                EnvironmentVariables: assertions_1.Match.serializedJson([
                                    {
                                        name: 'VERSION',
                                        type: 'PLAINTEXT',
                                        value: '#{codepipeline.PipelineExecutionId}',
                                    },
                                ]),
                            }),
                        }),
                    ]),
                }]),
        });
    }
});
/**
 * Some shared setup for legacy API tests
 */
function legacySetup() {
    const sourceArtifact = new codepipeline.Artifact();
    const cloudAssemblyArtifact = new codepipeline.Artifact('CloudAsm');
    const integTestArtifact = new codepipeline.Artifact('IntegTests');
    const pipeline = new testhelpers_1.LegacyTestGitHubNpmPipeline(pipelineStack, 'Cdk', {
        sourceArtifact,
        cloudAssemblyArtifact,
        synthAction: cdkp.SimpleSynthAction.standardNpmSynth({
            sourceArtifact,
            cloudAssemblyArtifact,
            additionalArtifacts: [{ directory: 'test', artifact: integTestArtifact }],
        }),
    });
    return { sourceArtifact, cloudAssemblyArtifact, integTestArtifact, pipeline };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGlvbnMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInZhbGlkYXRpb25zLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzREFBc0Q7QUFDdEQsb0RBQStEO0FBQy9ELG9EQUFvRDtBQUNwRCwwREFBMEQ7QUFDMUQsd0NBQXdDO0FBQ3hDLHdDQUF3QztBQUN4QyxzQ0FBc0M7QUFDdEMsd0NBQXNDO0FBQ3RDLGtDQUFrQztBQUNsQyxtQ0FBMEQ7QUFDMUQsdUZBQXlGO0FBQ3pGLGdEQUE4TjtBQUU5TixJQUFJLEdBQVksQ0FBQztBQUNqQixJQUFJLGFBQW9CLENBQUM7QUFFekIsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLEdBQUcsR0FBRyxJQUFJLHFCQUFPLEVBQUUsQ0FBQztJQUNwQixhQUFhLEdBQUcsSUFBSSxZQUFLLENBQUMsR0FBRyxFQUFFLGVBQWUsRUFBRSxFQUFFLEdBQUcsRUFBRSwwQkFBWSxFQUFFLENBQUMsQ0FBQztBQUN6RSxDQUFDLENBQUMsQ0FBQztBQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7SUFDYixHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDaEIsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFBLHNCQUFRLEVBQUMsbUNBQW1DLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRTtJQUN0RCxxQ0FBcUM7SUFDckMsS0FBSyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUU1QixLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRTtRQUNoQixPQUFPO1FBQ1AsTUFBTSxRQUFRLEdBQUcsSUFBSSx5Q0FBMkIsQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDdkUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLHlCQUFXLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxFQUFFO1lBQy9DLElBQUksRUFBRTtnQkFDSixJQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENB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Y0FBYyxHQUFHLElBQUksWUFBWSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ25ELE1BQU0scUJBQXFCLEdBQUcsSUFBSSxZQUFZLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3BFLE1BQU0saUJBQWlCLEdBQUcsSUFBSSxZQUFZLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ2xFLE1BQU0sUUFBUSxHQUFHLElBQUkseUNBQTJCLENBQUMsYUFBYSxFQUFFLEtBQUssRUFBRTtRQUNyRSxjQUFjO1FBQ2QscUJBQXFCO1FBQ3JCLFdBQVcsRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsZ0JBQWdCLENBQUM7WUFDbkQsY0FBYztZQUNkLHFCQUFxQjtZQUNyQixtQkFBbUIsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQztTQUMxRSxDQUFDO0tBQ0gsQ0FBQyxDQUFDO0lBRUgsT0FBTyxFQUFFLGNBQWMsRUFBRSxxQkFBcUIsRUFBRSxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsQ0FBQztBQUNoRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgaW1wb3J0L25vLWV4dHJhbmVvdXMtZGVwZW5kZW5jaWVzICovXG5pbXBvcnQgeyBDYXB0dXJlLCBNYXRjaCwgVGVtcGxhdGUgfSBmcm9tICcuLi8uLi8uLi9hc3NlcnRpb25zJztcbmltcG9ydCAqIGFzIGNvZGVidWlsZCBmcm9tICcuLi8uLi8uLi9hd3MtY29kZWJ1aWxkJztcbmltcG9ydCAqIGFzIGNvZGVwaXBlbGluZSBmcm9tICcuLi8uLi8uLi9hd3MtY29kZXBpcGVsaW5lJztcbmltcG9ydCAqIGFzIGVjMiBmcm9tICcuLi8uLi8uLi9hd3MtZWMyJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICcuLi8uLi8uLi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIHMzIGZyb20gJy4uLy4uLy4uL2F3cy1zMyc7XG5pbXBvcnQgeyBTdGFjayB9IGZyb20gJy4uLy4uLy4uL2NvcmUnO1xuaW1wb3J0ICogYXMgY2RrcCBmcm9tICcuLi8uLi9saWInO1xuaW1wb3J0IHsgQ29kZVBpcGVsaW5lU291cmNlLCBTaGVsbFN0ZXAgfSBmcm9tICcuLi8uLi9saWInO1xuaW1wb3J0IHsgQ0RLUF9ERUZBVUxUX0NPREVCVUlMRF9JTUFHRSB9IGZyb20gJy4uLy4uL2xpYi9wcml2YXRlL2RlZmF1bHQtY29kZWJ1aWxkLWltYWdlJztcbmltcG9ydCB7IEFwcFdpdGhPdXRwdXQsIGJlaGF2aW9yLCBMZWdhY3lUZXN0R2l0SHViTnBtUGlwZWxpbmUsIE1vZGVyblRlc3RHaXRIdWJOcG1QaXBlbGluZSwgT25lU3RhY2tBcHAsIFBJUEVMSU5FX0VOViwgc29ydEJ5UnVuT3JkZXIsIFN0YWdlV2l0aFN0YWNrT3V0cHV0LCBzdHJpbmdOb0xvbmdlclRoYW4sIFRlc3RBcHAsIFR3b1N0YWNrQXBwIH0gZnJvbSAnLi4vdGVzdGhlbHBlcnMnO1xuXG5sZXQgYXBwOiBUZXN0QXBwO1xubGV0IHBpcGVsaW5lU3RhY2s6IFN0YWNrO1xuXG5iZWZvcmVFYWNoKCgpID0+IHtcbiAgYXBwID0gbmV3IFRlc3RBcHAoKTtcbiAgcGlwZWxpbmVTdGFjayA9IG5ldyBTdGFjayhhcHAsICdQaXBlbGluZVN0YWNrJywgeyBlbnY6IFBJUEVMSU5FX0VOViB9KTtcbn0pO1xuXG5hZnRlckVhY2goKCkgPT4ge1xuICBhcHAuY2xlYW51cCgpO1xufSk7XG5cbmJlaGF2aW9yKCdjYW4gYWRkIG1hbnVhbCBhcHByb3ZhbCBhZnRlciBhcHAnLCAoc3VpdGUpID0+IHtcbiAgLy8gTm8gbmVlZCB0byBiZSBiYWNrd2FyZHMgY29tcGF0aWJsZVxuICBzdWl0ZS5kb2VzTm90QXBwbHkubGVnYWN5KCk7XG5cbiAgc3VpdGUubW9kZXJuKCgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnKTtcbiAgICBwaXBlbGluZS5hZGRTdGFnZShuZXcgVHdvU3RhY2tBcHAoYXBwLCAnTXlBcHAnKSwge1xuICAgICAgcG9zdDogW1xuICAgICAgICBuZXcgY2RrcC5NYW51YWxBcHByb3ZhbFN0ZXAoJ0FwcHJvdmUnKSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb2RlUGlwZWxpbmU6OlBpcGVsaW5lJywge1xuICAgICAgU3RhZ2VzOiBNYXRjaC5hcnJheVdpdGgoW3tcbiAgICAgICAgTmFtZTogJ015QXBwJyxcbiAgICAgICAgQWN0aW9uczogc29ydEJ5UnVuT3JkZXIoW1xuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2UoeyBOYW1lOiAnU3RhY2sxLlByZXBhcmUnIH0pLFxuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2UoeyBOYW1lOiAnU3RhY2sxLkRlcGxveScgfSksXG4gICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7IE5hbWU6ICdTdGFjazIuUHJlcGFyZScgfSksXG4gICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7IE5hbWU6ICdTdGFjazIuRGVwbG95JyB9KSxcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHsgTmFtZTogJ0FwcHJvdmUnIH0pLFxuICAgICAgICBdKSxcbiAgICAgIH1dKSxcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuYmVoYXZpb3IoJ2NhbiBhZGQgc3RlcHMgdG8gd2F2ZScsIChzdWl0ZSkgPT4ge1xuICAvLyBObyBuZWVkIHRvIGJlIGJhY2t3YXJkcyBjb21wYXRpYmxlXG4gIHN1aXRlLmRvZXNOb3RBcHBseS5sZWdhY3koKTtcblxuICBzdWl0ZS5tb2Rlcm4oKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBNb2Rlcm5UZXN0R2l0SHViTnBtUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycpO1xuICAgIGNvbnN0IHdhdmUgPSBwaXBlbGluZS5hZGRXYXZlKCdNeVdhdmUnLCB7XG4gICAgICBwb3N0OiBbXG4gICAgICAgIG5ldyBjZGtwLk1hbnVhbEFwcHJvdmFsU3RlcCgnQXBwcm92ZScpLFxuICAgICAgXSxcbiAgICB9KTtcbiAgICB3YXZlLmFkZFN0YWdlKG5ldyBPbmVTdGFja0FwcChwaXBlbGluZVN0YWNrLCAnU3RhZ2UxJykpO1xuICAgIHdhdmUuYWRkU3RhZ2UobmV3IE9uZVN0YWNrQXBwKHBpcGVsaW5lU3RhY2ssICdTdGFnZTInKSk7XG4gICAgd2F2ZS5hZGRTdGFnZShuZXcgT25lU3RhY2tBcHAocGlwZWxpbmVTdGFjaywgJ1N0YWdlMycpKTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2socGlwZWxpbmVTdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNvZGVQaXBlbGluZTo6UGlwZWxpbmUnLCB7XG4gICAgICBTdGFnZXM6IE1hdGNoLmFycmF5V2l0aChbe1xuICAgICAgICBOYW1lOiAnTXlXYXZlJyxcbiAgICAgICAgQWN0aW9uczogc29ydEJ5UnVuT3JkZXIoW1xuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2UoeyBOYW1lOiAnU3RhZ2UxLlN0YWNrLlByZXBhcmUnIH0pLFxuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2UoeyBOYW1lOiAnU3RhZ2UyLlN0YWNrLlByZXBhcmUnIH0pLFxuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2UoeyBOYW1lOiAnU3RhZ2UzLlN0YWNrLlByZXBhcmUnIH0pLFxuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2UoeyBOYW1lOiAnU3RhZ2UxLlN0YWNrLkRlcGxveScgfSksXG4gICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7IE5hbWU6ICdTdGFnZTIuU3RhY2suRGVwbG95JyB9KSxcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHsgTmFtZTogJ1N0YWdlMy5TdGFjay5EZXBsb3knIH0pLFxuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2UoeyBOYW1lOiAnQXBwcm92ZScgfSksXG4gICAgICAgIF0pLFxuICAgICAgfV0pLFxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5cbmJlaGF2aW9yKCdzY3JpcHQgdmFsaWRhdGlvbiBzdGVwcyBjYW4gdXNlIHN0YWNrIG91dHB1dHMgYXMgZW52aXJvbm1lbnQgdmFyaWFibGVzJywgKHN1aXRlKSA9PiB7XG4gIHN1aXRlLmxlZ2FjeSgoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCB7IHBpcGVsaW5lIH0gPSBsZWdhY3lTZXR1cCgpO1xuICAgIGNvbnN0IHN0YWdlID0gbmV3IFN0YWdlV2l0aFN0YWNrT3V0cHV0KGFwcCwgJ015QXBwJyk7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3QgcGlwZVN0YWdlID0gcGlwZWxpbmUuYWRkQXBwbGljYXRpb25TdGFnZShzdGFnZSk7XG4gICAgcGlwZVN0YWdlLmFkZEFjdGlvbnMobmV3IGNka3AuU2hlbGxTY3JpcHRBY3Rpb24oe1xuICAgICAgYWN0aW9uTmFtZTogJ1Rlc3RPdXRwdXQnLFxuICAgICAgdXNlT3V0cHV0czoge1xuICAgICAgICBCVUNLRVRfTkFNRTogcGlwZWxpbmUuc3RhY2tPdXRwdXQoc3RhZ2Uub3V0cHV0KSxcbiAgICAgIH0sXG4gICAgICBjb21tYW5kczogWydlY2hvICRCVUNLRVRfTkFNRSddLFxuICAgIH0pKTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2socGlwZWxpbmVTdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNvZGVQaXBlbGluZTo6UGlwZWxpbmUnLCB7XG4gICAgICBTdGFnZXM6IE1hdGNoLmFycmF5V2l0aChbe1xuICAgICAgICBOYW1lOiAnTXlBcHAnLFxuICAgICAgICBBY3Rpb25zOiBNYXRjaC5hcnJheVdpdGgoW1xuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgQWN0aW9uVHlwZUlkOiB7XG4gICAgICAgICAgICAgIFByb3ZpZGVyOiAnQ29kZUJ1aWxkJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICAgIFByb2plY3ROYW1lOiBNYXRjaC5hbnlWYWx1ZSgpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIElucHV0QXJ0aWZhY3RzOiBbeyBOYW1lOiBNYXRjaC5hbnlWYWx1ZSgpIH1dLFxuICAgICAgICAgICAgTmFtZTogJ1Rlc3RPdXRwdXQnLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgTmFtZTogJ1N0YWNrLkRlcGxveScsXG4gICAgICAgICAgICBPdXRwdXRBcnRpZmFjdHM6IFt7IE5hbWU6IE1hdGNoLmFueVZhbHVlKCkgfV0sXG4gICAgICAgICAgICBDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICAgIE91dHB1dEZpbGVOYW1lOiAnb3V0cHV0cy5qc29uJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgIF0pLFxuICAgICAgfV0pLFxuICAgIH0pO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb2RlQnVpbGQ6OlByb2plY3QnLCB7XG4gICAgICBFbnZpcm9ubWVudDoge1xuICAgICAgICBJbWFnZTogQ0RLUF9ERUZBVUxUX0NPREVCVUlMRF9JTUFHRS5pbWFnZUlkLFxuICAgICAgfSxcbiAgICAgIFNvdXJjZToge1xuICAgICAgICBCdWlsZFNwZWM6IE1hdGNoLnNlcmlhbGl6ZWRKc29uKE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgIHBoYXNlczoge1xuICAgICAgICAgICAgYnVpbGQ6IHtcbiAgICAgICAgICAgICAgY29tbWFuZHM6IFtcbiAgICAgICAgICAgICAgICAnc2V0IC1ldScsXG4gICAgICAgICAgICAgICAgJ2V4cG9ydCBCVUNLRVRfTkFNRT1cIiQobm9kZSAtcGUgXFwncmVxdWlyZShwcm9jZXNzLmVudi5DT0RFQlVJTERfU1JDX0RJUiArIFwiL291dHB1dHMuanNvblwiKVtcIkJ1Y2tldE5hbWVcIl1cXCcpXCInLFxuICAgICAgICAgICAgICAgICdlY2hvICRCVUNLRVRfTkFNRScsXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pKSxcbiAgICAgICAgVHlwZTogJ0NPREVQSVBFTElORScsXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcbiAgc3VpdGUubW9kZXJuKCgpID0+IHtcbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBNb2Rlcm5UZXN0R2l0SHViTnBtUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycpO1xuICAgIGNvbnN0IG15QXBwID0gbmV3IEFwcFdpdGhPdXRwdXQoYXBwLCAnQWxwaGEnKTtcbiAgICBwaXBlbGluZS5hZGRTdGFnZShteUFwcCwge1xuICAgICAgcG9zdDogW1xuICAgICAgICBuZXcgY2RrcC5TaGVsbFN0ZXAoJ0FwcHJvdmUnLCB7XG4gICAgICAgICAgY29tbWFuZHM6IFsnL2Jpbi90cnVlJ10sXG4gICAgICAgICAgZW52RnJvbUNmbk91dHB1dHM6IHtcbiAgICAgICAgICAgIFRIRV9PVVRQVVQ6IG15QXBwLnRoZU91dHB1dCxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb2RlUGlwZWxpbmU6OlBpcGVsaW5lJywge1xuICAgICAgU3RhZ2VzOiBNYXRjaC5hcnJheVdpdGgoW3tcbiAgICAgICAgTmFtZTogJ0FscGhhJyxcbiAgICAgICAgQWN0aW9uczogTWF0Y2guYXJyYXlXaXRoKFtcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgIE5hbWU6ICdTdGFjay5EZXBsb3knLFxuICAgICAgICAgICAgTmFtZXNwYWNlOiAnQWxwaGFTdGFjazZCMzM4OUZBJyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgIE5hbWU6ICdBcHByb3ZlJyxcbiAgICAgICAgICAgIENvbmZpZ3VyYXRpb246IE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgICBFbnZpcm9ubWVudFZhcmlhYmxlczogTWF0Y2guc2VyaWFsaXplZEpzb24oW1xuICAgICAgICAgICAgICAgIHsgbmFtZTogJ1RIRV9PVVRQVVQnLCB2YWx1ZTogJyN7QWxwaGFTdGFjazZCMzM4OUZBLk15T3V0cHV0fScsIHR5cGU6ICdQTEFJTlRFWFQnIH0sXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSksXG4gICAgICAgIF0pLFxuICAgICAgfV0pLFxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5iZWhhdmlvcignc3RhY2tPdXRwdXQgZ2VuZXJhdGVzIG5hbWVzIGxpbWl0ZWQgdG8gMTAwIGNoYXJhY3RlcnMnLCAoc3VpdGUpID0+IHtcbiAgc3VpdGUubGVnYWN5KCgpID0+IHtcbiAgICBjb25zdCB7IHBpcGVsaW5lIH0gPSBsZWdhY3lTZXR1cCgpO1xuICAgIGNvbnN0IHN0YWdlID0gbmV3IFN0YWdlV2l0aFN0YWNrT3V0cHV0KGFwcCwgJ0FQcmVwb3N0ZXJvdXNseUxvbmdBbmRDb21wbGljYXRlZE5hbWVNYWRlVXBKdXN0VG9NYWtlSXRFeGNlZWRUaGVMaW1pdERlZmluZWRCeUNvZGVCdWlsZCcpO1xuICAgIGNvbnN0IHBpcGVTdGFnZSA9IHBpcGVsaW5lLmFkZEFwcGxpY2F0aW9uU3RhZ2Uoc3RhZ2UpO1xuICAgIHBpcGVTdGFnZS5hZGRBY3Rpb25zKG5ldyBjZGtwLlNoZWxsU2NyaXB0QWN0aW9uKHtcbiAgICAgIGFjdGlvbk5hbWU6ICdUZXN0T3V0cHV0JyxcbiAgICAgIHVzZU91dHB1dHM6IHtcbiAgICAgICAgQlVDS0VUX05BTUU6IHBpcGVsaW5lLnN0YWNrT3V0cHV0KHN0YWdlLm91dHB1dCksXG4gICAgICB9LFxuICAgICAgY29tbWFuZHM6IFsnZWNobyAkQlVDS0VUX05BTUUnXSxcbiAgICB9KSk7XG5cbiAgICAvLyBUSEVOXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb2RlUGlwZWxpbmU6OlBpcGVsaW5lJywge1xuICAgICAgU3RhZ2VzOiBNYXRjaC5hcnJheVdpdGgoW3tcbiAgICAgICAgTmFtZTogJ0FQcmVwb3N0ZXJvdXNseUxvbmdBbmRDb21wbGljYXRlZE5hbWVNYWRlVXBKdXN0VG9NYWtlSXRFeGNlZWRUaGVMaW1pdERlZmluZWRCeUNvZGVCdWlsZCcsXG4gICAgICAgIEFjdGlvbnM6IE1hdGNoLmFycmF5V2l0aChbXG4gICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgICBBY3Rpb25UeXBlSWQ6IHtcbiAgICAgICAgICAgICAgUHJvdmlkZXI6ICdDb2RlQnVpbGQnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIENvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICAgICAgUHJvamVjdE5hbWU6IE1hdGNoLmFueVZhbHVlKCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgSW5wdXRBcnRpZmFjdHM6IFt7IE5hbWU6IHN0cmluZ05vTG9uZ2VyVGhhbigxMDApIH1dLFxuICAgICAgICAgICAgTmFtZTogJ1Rlc3RPdXRwdXQnLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgTmFtZTogJ1N0YWNrLkRlcGxveScsXG4gICAgICAgICAgICBPdXRwdXRBcnRpZmFjdHM6IFt7IE5hbWU6IHN0cmluZ05vTG9uZ2VyVGhhbigxMDApIH1dLFxuICAgICAgICAgICAgQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgICBPdXRwdXRGaWxlTmFtZTogJ291dHB1dHMuanNvbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pLFxuICAgICAgICBdKSxcbiAgICAgIH1dKSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgc3VpdGUubW9kZXJuKCgpID0+IHtcbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBNb2Rlcm5UZXN0R2l0SHViTnBtUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycpO1xuICAgIGNvbnN0IHN0YWdlID0gbmV3IFN0YWdlV2l0aFN0YWNrT3V0cHV0KGFwcCwgJ0FQcmVwb3N0ZXJvdXNseUxvbmdBbmRDb21wbGljYXRlZE5hbWVNYWRlVXBKdXN0VG9NYWtlSXRFeGNlZWRUaGVMaW1pdERlZmluZWRCeUNvZGVCdWlsZCcpO1xuICAgIHBpcGVsaW5lLmFkZFN0YWdlKHN0YWdlLCB7XG4gICAgICBwb3N0OiBbXG4gICAgICAgIG5ldyBjZGtwLlNoZWxsU3RlcCgnVGVzdE91dHB1dCcsIHtcbiAgICAgICAgICBjb21tYW5kczogWydlY2hvICRCVUNLRVRfTkFNRSddLFxuICAgICAgICAgIGVudkZyb21DZm5PdXRwdXRzOiB7XG4gICAgICAgICAgICBCVUNLRVRfTkFNRTogc3RhZ2Uub3V0cHV0LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhwaXBlbGluZVN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q29kZVBpcGVsaW5lOjpQaXBlbGluZScsIHtcbiAgICAgIFN0YWdlczogTWF0Y2guYXJyYXlXaXRoKFt7XG4gICAgICAgIE5hbWU6ICdBUHJlcG9zdGVyb3VzbHlMb25nQW5kQ29tcGxpY2F0ZWROYW1lTWFkZVVwSnVzdFRvTWFrZUl0RXhjZWVkVGhlTGltaXREZWZpbmVkQnlDb2RlQnVpbGQnLFxuICAgICAgICBBY3Rpb25zOiBNYXRjaC5hcnJheVdpdGgoW1xuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgTmFtZTogJ1N0YWNrLkRlcGxveScsXG4gICAgICAgICAgICBOYW1lc3BhY2U6IHN0cmluZ05vTG9uZ2VyVGhhbigxMDApLFxuICAgICAgICAgIH0pLFxuICAgICAgICBdKSxcbiAgICAgIH1dKSxcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuYmVoYXZpb3IoJ3ZhbGlkYXRpb24gc3RlcCBjYW4gcnVuIGZyb20gc2NyaXB0cyBpbiBzb3VyY2UnLCAoc3VpdGUpID0+IHtcbiAgc3VpdGUubGVnYWN5KCgpID0+IHtcbiAgICBjb25zdCB7IHBpcGVsaW5lLCBzb3VyY2VBcnRpZmFjdCB9ID0gbGVnYWN5U2V0dXAoKTtcblxuICAgIC8vIFdIRU5cbiAgICBwaXBlbGluZS5hZGRTdGFnZSgnVGVzdCcpLmFkZEFjdGlvbnMobmV3IGNka3AuU2hlbGxTY3JpcHRBY3Rpb24oe1xuICAgICAgYWN0aW9uTmFtZTogJ1VzZVNvdXJjZXMnLFxuICAgICAgYWRkaXRpb25hbEFydGlmYWN0czogW3NvdXJjZUFydGlmYWN0XSxcbiAgICAgIGNvbW1hbmRzOiBbJ3RydWUnXSxcbiAgICB9KSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9uKCk7XG4gIH0pO1xuXG4gIHN1aXRlLm1vZGVybigoKSA9PiB7XG4gICAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnKTtcbiAgICBwaXBlbGluZS5hZGRTdGFnZShuZXcgVHdvU3RhY2tBcHAoYXBwLCAnVGVzdCcpLCB7XG4gICAgICBwb3N0OiBbXG4gICAgICAgIG5ldyBjZGtwLlNoZWxsU3RlcCgnVXNlU291cmNlcycsIHtcbiAgICAgICAgICBpbnB1dDogcGlwZWxpbmUuZ2l0SHViU291cmNlLFxuICAgICAgICAgIGNvbW1hbmRzOiBbJ3NldCAtZXUnLCAndHJ1ZSddLFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9uKCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKSB7XG4gICAgY29uc3Qgc291cmNlQXJ0aWZhY3QgPSBuZXcgQ2FwdHVyZSgpO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb2RlUGlwZWxpbmU6OlBpcGVsaW5lJywge1xuICAgICAgU3RhZ2VzOiBNYXRjaC5hcnJheVdpdGgoW3tcbiAgICAgICAgTmFtZTogJ1NvdXJjZScsXG4gICAgICAgIEFjdGlvbnM6IFtcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgIE91dHB1dEFydGlmYWN0czogW3sgTmFtZTogc291cmNlQXJ0aWZhY3QgfV0sXG4gICAgICAgICAgfSksXG4gICAgICAgIF0sXG4gICAgICB9XSksXG4gICAgfSk7XG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb2RlUGlwZWxpbmU6OlBpcGVsaW5lJywge1xuICAgICAgU3RhZ2VzOiBNYXRjaC5hcnJheVdpdGgoW3tcbiAgICAgICAgTmFtZTogJ1Rlc3QnLFxuICAgICAgICBBY3Rpb25zOiBNYXRjaC5hcnJheVdpdGgoW1xuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgTmFtZTogJ1VzZVNvdXJjZXMnLFxuICAgICAgICAgICAgSW5wdXRBcnRpZmFjdHM6IFt7IE5hbWU6IHNvdXJjZUFydGlmYWN0LmFzU3RyaW5nKCkgfV0sXG4gICAgICAgICAgfSksXG4gICAgICAgIF0pLFxuICAgICAgfV0pLFxuICAgIH0pO1xuICAgIFRlbXBsYXRlLmZyb21TdGFjayhwaXBlbGluZVN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q29kZUJ1aWxkOjpQcm9qZWN0Jywge1xuICAgICAgRW52aXJvbm1lbnQ6IHtcbiAgICAgICAgSW1hZ2U6IENES1BfREVGQVVMVF9DT0RFQlVJTERfSU1BR0UuaW1hZ2VJZCxcbiAgICAgIH0sXG4gICAgICBTb3VyY2U6IHtcbiAgICAgICAgQnVpbGRTcGVjOiBNYXRjaC5zZXJpYWxpemVkSnNvbihNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICBwaGFzZXM6IHtcbiAgICAgICAgICAgIGJ1aWxkOiB7XG4gICAgICAgICAgICAgIGNvbW1hbmRzOiBbXG4gICAgICAgICAgICAgICAgJ3NldCAtZXUnLFxuICAgICAgICAgICAgICAgICd0cnVlJyxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSkpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxufSk7XG5cbmJlaGF2aW9yKCdjYW4gdXNlIGFkZGl0aW9uYWwgb3V0cHV0IGFydGlmYWN0cyBmcm9tIGJ1aWxkJywgKHN1aXRlKSA9PiB7XG4gIHN1aXRlLmxlZ2FjeSgoKSA9PiB7XG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHsgcGlwZWxpbmUsIGludGVnVGVzdEFydGlmYWN0IH0gPSBsZWdhY3lTZXR1cCgpO1xuICAgIHBpcGVsaW5lLmFkZFN0YWdlKCdUZXN0JykuYWRkQWN0aW9ucyhuZXcgY2RrcC5TaGVsbFNjcmlwdEFjdGlvbih7XG4gICAgICBhY3Rpb25OYW1lOiAnVXNlQnVpbGRBcnRpZmFjdCcsXG4gICAgICBhZGRpdGlvbmFsQXJ0aWZhY3RzOiBbaW50ZWdUZXN0QXJ0aWZhY3RdLFxuICAgICAgY29tbWFuZHM6IFsndHJ1ZSddLFxuICAgIH0pKTtcblxuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKTtcbiAgfSk7XG5cbiAgc3VpdGUubW9kZXJuKCgpID0+IHtcbiAgICBjb25zdCBzeW50aCA9IG5ldyBTaGVsbFN0ZXAoJ1N5bnRoJywge1xuICAgICAgaW5wdXQ6IENvZGVQaXBlbGluZVNvdXJjZS5naXRIdWIoJ3Rlc3QvdGVzdCcsICdtYWluJyksXG4gICAgICBjb21tYW5kczogWydzeW50aCddLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnLCB7XG4gICAgICBzeW50aCxcbiAgICB9KTtcbiAgICBwaXBlbGluZS5hZGRTdGFnZShuZXcgVHdvU3RhY2tBcHAoYXBwLCAnVGVzdCcpLCB7XG4gICAgICBwb3N0OiBbXG4gICAgICAgIG5ldyBjZGtwLlNoZWxsU3RlcCgnVXNlQnVpbGRBcnRpZmFjdCcsIHtcbiAgICAgICAgICBpbnB1dDogc3ludGguYWRkT3V0cHV0RGlyZWN0b3J5KCd0ZXN0JyksXG4gICAgICAgICAgY29tbWFuZHM6IFsnc2V0IC1ldScsICd0cnVlJ10sXG4gICAgICAgIH0pLFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gVEhFTl9jb2RlUGlwZWxpbmVFeHBlY3RhdGlvbigpIHtcbiAgICBjb25zdCBpbnRlZ0FydGlmYWN0ID0gbmV3IENhcHR1cmUoKTtcblxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhwaXBlbGluZVN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q29kZVBpcGVsaW5lOjpQaXBlbGluZScsIHtcbiAgICAgIFN0YWdlczogTWF0Y2guYXJyYXlXaXRoKFt7XG4gICAgICAgIE5hbWU6ICdCdWlsZCcsXG4gICAgICAgIEFjdGlvbnM6IFtcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgIE5hbWU6ICdTeW50aCcsXG4gICAgICAgICAgICBPdXRwdXRBcnRpZmFjdHM6IFtcbiAgICAgICAgICAgICAgeyBOYW1lOiBNYXRjaC5hbnlWYWx1ZSgpIH0sIC8vIEl0J3Mgbm90IHRoZSBmaXJzdCBvdXRwdXRcbiAgICAgICAgICAgICAgeyBOYW1lOiBpbnRlZ0FydGlmYWN0IH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0pLFxuICAgICAgICBdLFxuICAgICAgfV0pLFxuICAgIH0pO1xuXG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb2RlUGlwZWxpbmU6OlBpcGVsaW5lJywge1xuICAgICAgU3RhZ2VzOiBNYXRjaC5hcnJheVdpdGgoW3tcbiAgICAgICAgTmFtZTogJ1Rlc3QnLFxuICAgICAgICBBY3Rpb25zOiBNYXRjaC5hcnJheVdpdGgoW1xuICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgTmFtZTogJ1VzZUJ1aWxkQXJ0aWZhY3QnLFxuICAgICAgICAgICAgSW5wdXRBcnRpZmFjdHM6IFt7IE5hbWU6IGludGVnQXJ0aWZhY3QuYXNTdHJpbmcoKSB9XSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgXSksXG4gICAgICB9XSksXG4gICAgfSk7XG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb2RlQnVpbGQ6OlByb2plY3QnLCB7XG4gICAgICBFbnZpcm9ubWVudDoge1xuICAgICAgICBJbWFnZTogQ0RLUF9ERUZBVUxUX0NPREVCVUlMRF9JTUFHRS5pbWFnZUlkLFxuICAgICAgfSxcbiAgICAgIFNvdXJjZToge1xuICAgICAgICBCdWlsZFNwZWM6IE1hdGNoLnNlcmlhbGl6ZWRKc29uKE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgIHBoYXNlczoge1xuICAgICAgICAgICAgYnVpbGQ6IHtcbiAgICAgICAgICAgICAgY29tbWFuZHM6IFtcbiAgICAgICAgICAgICAgICAnc2V0IC1ldScsXG4gICAgICAgICAgICAgICAgJ3RydWUnLFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSksXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG59KTtcblxuYmVoYXZpb3IoJ2NhbiBhZGQgcG9saWN5IHN0YXRlbWVudHMgdG8gc2hlbGwgc2NyaXB0IGFjdGlvbicsIChzdWl0ZSkgPT4ge1xuICBzdWl0ZS5sZWdhY3koKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCB7IHBpcGVsaW5lLCBpbnRlZ1Rlc3RBcnRpZmFjdCB9ID0gbGVnYWN5U2V0dXAoKTtcbiAgICBwaXBlbGluZS5hZGRTdGFnZSgnVGVzdCcpLmFkZEFjdGlvbnMobmV3IGNka3AuU2hlbGxTY3JpcHRBY3Rpb24oe1xuICAgICAgYWN0aW9uTmFtZTogJ0Jvb3AnLFxuICAgICAgYWRkaXRpb25hbEFydGlmYWN0czogW2ludGVnVGVzdEFydGlmYWN0XSxcbiAgICAgIGNvbW1hbmRzOiBbJ3RydWUnXSxcbiAgICAgIHJvbGVQb2xpY3lTdGF0ZW1lbnRzOiBbXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ3MzOkJhbmFuYSddLFxuICAgICAgICAgIHJlc291cmNlczogWycqJ10sXG4gICAgICAgIH0pLFxuICAgICAgXSxcbiAgICB9KSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9uKCk7XG4gIH0pO1xuXG4gIHN1aXRlLm1vZGVybigoKSA9PiB7XG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHBpcGVsaW5lID0gbmV3IE1vZGVyblRlc3RHaXRIdWJOcG1QaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ2RrJyk7XG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UobmV3IFR3b1N0YWNrQXBwKGFwcCwgJ1Rlc3QnKSwge1xuICAgICAgcG9zdDogW1xuICAgICAgICBuZXcgY2RrcC5Db2RlQnVpbGRTdGVwKCdCb29wJywge1xuICAgICAgICAgIGNvbW1hbmRzOiBbJ3RydWUnXSxcbiAgICAgICAgICByb2xlUG9saWN5U3RhdGVtZW50czogW1xuICAgICAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgICAgICBhY3Rpb25zOiBbJ3MzOkJhbmFuYSddLFxuICAgICAgICAgICAgICByZXNvdXJjZXM6IFsnKiddLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgXSxcbiAgICAgICAgfSksXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgVEhFTl9jb2RlUGlwZWxpbmVFeHBlY3RhdGlvbigpO1xuICB9KTtcblxuICBmdW5jdGlvbiBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9uKCkge1xuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2socGlwZWxpbmVTdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgU3RhdGVtZW50OiBNYXRjaC5hcnJheVdpdGgoW01hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgIEFjdGlvbjogJ3MzOkJhbmFuYScsXG4gICAgICAgICAgUmVzb3VyY2U6ICcqJyxcbiAgICAgICAgfSldKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5iZWhhdmlvcignY2FuIGdyYW50IHBlcm1pc3Npb25zIHRvIHNoZWxsIHNjcmlwdCBhY3Rpb24nLCAoc3VpdGUpID0+IHtcbiAgbGV0IGJ1Y2tldDogczMuSUJ1Y2tldDtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgYnVja2V0ID0gczMuQnVja2V0LmZyb21CdWNrZXRBcm4ocGlwZWxpbmVTdGFjaywgJ0J1Y2tldCcsICdhcm46YXdzOnMzOjo6dGhpcy1wYXJ0aWN1bGFyLWJ1Y2tldCcpO1xuICB9KTtcblxuICBzdWl0ZS5sZWdhY3koKCkgPT4ge1xuICAgIGNvbnN0IHsgcGlwZWxpbmUsIGludGVnVGVzdEFydGlmYWN0IH0gPSBsZWdhY3lTZXR1cCgpO1xuICAgIGNvbnN0IGFjdGlvbiA9IG5ldyBjZGtwLlNoZWxsU2NyaXB0QWN0aW9uKHtcbiAgICAgIGFjdGlvbk5hbWU6ICdCb29wJyxcbiAgICAgIGFkZGl0aW9uYWxBcnRpZmFjdHM6IFtpbnRlZ1Rlc3RBcnRpZmFjdF0sXG4gICAgICBjb21tYW5kczogWyd0cnVlJ10sXG4gICAgfSk7XG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UoJ1Rlc3QnKS5hZGRBY3Rpb25zKGFjdGlvbik7XG5cbiAgICAvLyBXSEVOXG4gICAgYnVja2V0LmdyYW50UmVhZChhY3Rpb24pO1xuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKTtcbiAgfSk7XG5cbiAgc3VpdGUubW9kZXJuKCgpID0+IHtcbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBNb2Rlcm5UZXN0R2l0SHViTnBtUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycpO1xuXG4gICAgY29uc3QgY29kZUJ1aWxkU3RlcCA9IG5ldyBjZGtwLkNvZGVCdWlsZFN0ZXAoJ0Jvb3AnLCB7XG4gICAgICBjb21tYW5kczogWyd0cnVlJ10sXG4gICAgfSk7XG5cbiAgICBwaXBlbGluZS5hZGRTdGFnZShuZXcgVHdvU3RhY2tBcHAoYXBwLCAnVGVzdCcpLCB7XG4gICAgICBwb3N0OiBbY29kZUJ1aWxkU3RlcF0sXG4gICAgfSk7XG5cbiAgICBwaXBlbGluZS5idWlsZFBpcGVsaW5lKCk7XG5cbiAgICAvLyBXSEVOXG4gICAgYnVja2V0LmdyYW50UmVhZChjb2RlQnVpbGRTdGVwLnByb2plY3QpO1xuXG4gICAgVEhFTl9jb2RlUGlwZWxpbmVFeHBlY3RhdGlvbigpO1xuICB9KTtcblxuICBmdW5jdGlvbiBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9uKCkge1xuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2socGlwZWxpbmVTdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgU3RhdGVtZW50OiBNYXRjaC5hcnJheVdpdGgoW01hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgIEFjdGlvbjogWydzMzpHZXRPYmplY3QqJywgJ3MzOkdldEJ1Y2tldConLCAnczM6TGlzdConXSxcbiAgICAgICAgICBSZXNvdXJjZTogWydhcm46YXdzOnMzOjo6dGhpcy1wYXJ0aWN1bGFyLWJ1Y2tldCcsICdhcm46YXdzOnMzOjo6dGhpcy1wYXJ0aWN1bGFyLWJ1Y2tldC8qJ10sXG4gICAgICAgIH0pXSksXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG59KTtcblxuYmVoYXZpb3IoJ2NhbiBydW4gc2hlbGwgc2NyaXB0IGFjdGlvbnMgaW4gYSBWUEMnLCAoc3VpdGUpID0+IHtcbiAgbGV0IHZwYzogZWMyLlZwYztcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgdnBjID0gbmV3IGVjMi5WcGMocGlwZWxpbmVTdGFjaywgJ1ZQQycpO1xuICB9KTtcblxuICBzdWl0ZS5sZWdhY3koKCkgPT4ge1xuICAgIGNvbnN0IHsgcGlwZWxpbmUsIGludGVnVGVzdEFydGlmYWN0IH0gPSBsZWdhY3lTZXR1cCgpO1xuXG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UoJ1Rlc3QnKS5hZGRBY3Rpb25zKG5ldyBjZGtwLlNoZWxsU2NyaXB0QWN0aW9uKHtcbiAgICAgIHZwYyxcbiAgICAgIGFjdGlvbk5hbWU6ICdWcGNBY3Rpb24nLFxuICAgICAgYWRkaXRpb25hbEFydGlmYWN0czogW2ludGVnVGVzdEFydGlmYWN0XSxcbiAgICAgIGNvbW1hbmRzOiBbJ3RydWUnXSxcbiAgICB9KSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9uKCk7XG4gIH0pO1xuXG4gIHN1aXRlLm1vZGVybigoKSA9PiB7XG4gICAgLy8gQWxsIENvZGVCdWlsZCBqb2JzIGF1dG9tYXRpY2FsbHkgZ28gaW50byB0aGUgVlBDXG4gICAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnLCB7XG4gICAgICBjb2RlQnVpbGREZWZhdWx0czogeyB2cGMgfSxcbiAgICB9KTtcblxuICAgIHBpcGVsaW5lLmFkZFN0YWdlKG5ldyBUd29TdGFja0FwcChhcHAsICdNeUFwcCcpLCB7XG4gICAgICBwb3N0OiBbbmV3IGNka3AuU2hlbGxTdGVwKCdWcGNBY3Rpb24nLCB7XG4gICAgICAgIGNvbW1hbmRzOiBbJ3NldCAtZXUnLCAndHJ1ZSddLFxuICAgICAgfSldLFxuICAgIH0pO1xuXG4gICAgVEhFTl9jb2RlUGlwZWxpbmVFeHBlY3RhdGlvbigpO1xuICB9KTtcblxuICBzdWl0ZS5hZGRpdGlvbmFsKCdtb2Rlcm4sIGFsdGVybmF0ZSBBUEknLCAoKSA9PiB7XG4gICAgLy8gQ2FuIGFsc28gZXhwbGljaXRseSBzcGVjaWZ5IGEgVlBDIHdoZW4gZ29pbmcgdG8gdGhlIFwiZnVsbCBjb25maWdcIiBjbGFzc1xuICAgIGNvbnN0IHBpcGVsaW5lID0gbmV3IE1vZGVyblRlc3RHaXRIdWJOcG1QaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ2RrJyk7XG5cbiAgICBwaXBlbGluZS5hZGRTdGFnZShuZXcgVHdvU3RhY2tBcHAoYXBwLCAnTXlBcHAnKSwge1xuICAgICAgcG9zdDogW25ldyBjZGtwLkNvZGVCdWlsZFN0ZXAoJ1ZwY0FjdGlvbicsIHtcbiAgICAgICAgY29tbWFuZHM6IFsnc2V0IC1ldScsICd0cnVlJ10sXG4gICAgICAgIHZwYyxcbiAgICAgIH0pXSxcbiAgICB9KTtcblxuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gVEhFTl9jb2RlUGlwZWxpbmVFeHBlY3RhdGlvbigpIHtcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2socGlwZWxpbmVTdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNvZGVCdWlsZDo6UHJvamVjdCcsIHtcbiAgICAgIEVudmlyb25tZW50OiB7XG4gICAgICAgIEltYWdlOiBDREtQX0RFRkFVTFRfQ09ERUJVSUxEX0lNQUdFLmltYWdlSWQsXG4gICAgICB9LFxuICAgICAgVnBjQ29uZmlnOiB7XG4gICAgICAgIFN1Ym5ldHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBSZWY6ICdWUENQcml2YXRlU3VibmV0MVN1Ym5ldDhCQ0ExMEUwJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIFJlZjogJ1ZQQ1ByaXZhdGVTdWJuZXQyU3VibmV0Q0ZDREFBN0EnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgUmVmOiAnVlBDUHJpdmF0ZVN1Ym5ldDNTdWJuZXQzRURDRDQ1NycsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgVnBjSWQ6IHtcbiAgICAgICAgICBSZWY6ICdWUENCOUU1RjBCNCcsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgU291cmNlOiB7XG4gICAgICAgIEJ1aWxkU3BlYzogTWF0Y2guc2VyaWFsaXplZEpzb24oTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgcGhhc2VzOiB7XG4gICAgICAgICAgICBidWlsZDoge1xuICAgICAgICAgICAgICBjb21tYW5kczogW1xuICAgICAgICAgICAgICAgICdzZXQgLWV1JyxcbiAgICAgICAgICAgICAgICAndHJ1ZScsXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pKSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5iZWhhdmlvcignY2FuIHJ1biBzaGVsbCBzY3JpcHQgYWN0aW9ucyB3aXRoIGEgc3BlY2lmaWMgU2VjdXJpdHlHcm91cCcsIChzdWl0ZSkgPT4ge1xuICBsZXQgdnBjOiBlYzIuVnBjO1xuICBsZXQgc2c6IGVjMi5TZWN1cml0eUdyb3VwO1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB2cGMgPSBuZXcgZWMyLlZwYyhwaXBlbGluZVN0YWNrLCAnVlBDJyk7XG4gICAgc2cgPSBuZXcgZWMyLlNlY3VyaXR5R3JvdXAocGlwZWxpbmVTdGFjaywgJ1NHJywgeyB2cGMgfSk7XG4gIH0pO1xuXG4gIHN1aXRlLmxlZ2FjeSgoKSA9PiB7XG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IHsgcGlwZWxpbmUsIGludGVnVGVzdEFydGlmYWN0IH0gPSBsZWdhY3lTZXR1cCgpO1xuICAgIHBpcGVsaW5lLmFkZFN0YWdlKCdUZXN0JykuYWRkQWN0aW9ucyhuZXcgY2RrcC5TaGVsbFNjcmlwdEFjdGlvbih7XG4gICAgICB2cGMsXG4gICAgICBzZWN1cml0eUdyb3VwczogW3NnXSxcbiAgICAgIGFjdGlvbk5hbWU6ICdzZ0FjdGlvbicsXG4gICAgICBhZGRpdGlvbmFsQXJ0aWZhY3RzOiBbaW50ZWdUZXN0QXJ0aWZhY3RdLFxuICAgICAgY29tbWFuZHM6IFsndHJ1ZSddLFxuICAgIH0pKTtcblxuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKTtcbiAgfSk7XG5cbiAgc3VpdGUubW9kZXJuKCgpID0+IHtcbiAgICAvLyBBbGwgQ29kZUJ1aWxkIGpvYnMgYXV0b21hdGljYWxseSBnbyBpbnRvIHRoZSBWUENcbiAgICBjb25zdCBwaXBlbGluZSA9IG5ldyBNb2Rlcm5UZXN0R2l0SHViTnBtUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycpO1xuXG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UobmV3IFR3b1N0YWNrQXBwKGFwcCwgJ1Rlc3QnKSwge1xuICAgICAgcG9zdDogW25ldyBjZGtwLkNvZGVCdWlsZFN0ZXAoJ3NnQWN0aW9uJywge1xuICAgICAgICBjb21tYW5kczogWydzZXQgLWV1JywgJ3RydWUnXSxcbiAgICAgICAgdnBjLFxuICAgICAgICBzZWN1cml0eUdyb3VwczogW3NnXSxcbiAgICAgIH0pXSxcbiAgICB9KTtcblxuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gVEhFTl9jb2RlUGlwZWxpbmVFeHBlY3RhdGlvbigpIHtcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2socGlwZWxpbmVTdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNvZGVQaXBlbGluZTo6UGlwZWxpbmUnLCB7XG4gICAgICBTdGFnZXM6IE1hdGNoLmFycmF5V2l0aChbe1xuICAgICAgICBOYW1lOiAnVGVzdCcsXG4gICAgICAgIEFjdGlvbnM6IE1hdGNoLmFycmF5V2l0aChbXG4gICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgICBOYW1lOiAnc2dBY3Rpb24nLFxuICAgICAgICAgIH0pLFxuICAgICAgICBdKSxcbiAgICAgIH1dKSxcbiAgICB9KTtcbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2socGlwZWxpbmVTdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkNvZGVCdWlsZDo6UHJvamVjdCcsIHtcbiAgICAgIFZwY0NvbmZpZzoge1xuICAgICAgICBTZWN1cml0eUdyb3VwSWRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgICAgICdTR0FEQjUzOTM3JyxcbiAgICAgICAgICAgICAgJ0dyb3VwSWQnLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBWcGNJZDoge1xuICAgICAgICAgIFJlZjogJ1ZQQ0I5RTVGMEI0JyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5iZWhhdmlvcignY2FuIHJ1biBzY3JpcHRzIHdpdGggc3BlY2lmaWVkIEJ1aWxkRW52aXJvbm1lbnQnLCAoc3VpdGUpID0+IHtcbiAgc3VpdGUubGVnYWN5KCgpID0+IHtcbiAgICBsZXQgeyBwaXBlbGluZSwgaW50ZWdUZXN0QXJ0aWZhY3QgfSA9IGxlZ2FjeVNldHVwKCk7XG5cbiAgICAvLyBXSEVOXG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UoJ1Rlc3QnKS5hZGRBY3Rpb25zKG5ldyBjZGtwLlNoZWxsU2NyaXB0QWN0aW9uKHtcbiAgICAgIGFjdGlvbk5hbWU6ICdpbWFnZUFjdGlvbicsXG4gICAgICBhZGRpdGlvbmFsQXJ0aWZhY3RzOiBbaW50ZWdUZXN0QXJ0aWZhY3RdLFxuICAgICAgY29tbWFuZHM6IFsndHJ1ZSddLFxuICAgICAgZW52aXJvbm1lbnQ6IHsgYnVpbGRJbWFnZTogY29kZWJ1aWxkLkxpbnV4QnVpbGRJbWFnZS5TVEFOREFSRF8yXzAgfSxcbiAgICB9KSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9uKCk7XG4gIH0pO1xuXG4gIHN1aXRlLm1vZGVybigoKSA9PiB7XG4gICAgLy8gUnVuIGFsbCBCdWlsZCBqb2JzIHdpdGggdGhlIGdpdmVuIGltYWdlXG4gICAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnLCB7XG4gICAgICBjb2RlQnVpbGREZWZhdWx0czoge1xuICAgICAgICBidWlsZEVudmlyb25tZW50OiB7XG4gICAgICAgICAgYnVpbGRJbWFnZTogY29kZWJ1aWxkLkxpbnV4QnVpbGRJbWFnZS5TVEFOREFSRF8yXzAsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UobmV3IFR3b1N0YWNrQXBwKGFwcCwgJ1Rlc3QnKSwge1xuICAgICAgcG9zdDogW25ldyBjZGtwLlNoZWxsU3RlcCgnaW1hZ2VBY3Rpb24nLCB7XG4gICAgICAgIGNvbW1hbmRzOiBbJ3RydWUnXSxcbiAgICAgIH0pXSxcbiAgICB9KTtcblxuICAgIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKTtcbiAgfSk7XG5cbiAgc3VpdGUuYWRkaXRpb25hbCgnbW9kZXJuLCBhbHRlcm5hdGl2ZSBBUEknLCAoKSA9PiB7XG4gICAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnKTtcblxuICAgIHBpcGVsaW5lLmFkZFN0YWdlKG5ldyBUd29TdGFja0FwcChhcHAsICdUZXN0JyksIHtcbiAgICAgIHBvc3Q6IFtuZXcgY2RrcC5Db2RlQnVpbGRTdGVwKCdpbWFnZUFjdGlvbicsIHtcbiAgICAgICAgY29tbWFuZHM6IFsndHJ1ZSddLFxuICAgICAgICBidWlsZEVudmlyb25tZW50OiB7XG4gICAgICAgICAgYnVpbGRJbWFnZTogY29kZWJ1aWxkLkxpbnV4QnVpbGRJbWFnZS5TVEFOREFSRF8yXzAsXG4gICAgICAgIH0sXG4gICAgICB9KV0sXG4gICAgfSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9uKCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKSB7XG4gICAgVGVtcGxhdGUuZnJvbVN0YWNrKHBpcGVsaW5lU3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpDb2RlQnVpbGQ6OlByb2plY3QnLCB7XG4gICAgICBFbnZpcm9ubWVudDoge1xuICAgICAgICBJbWFnZTogJ2F3cy9jb2RlYnVpbGQvc3RhbmRhcmQ6Mi4wJyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5iZWhhdmlvcignY2FuIHJ1biBzY3JpcHRzIHdpdGggbWFnaWMgZW52aXJvbm1lbnQgdmFyaWFibGVzJywgKHN1aXRlKSA9PiB7XG4gIHN1aXRlLmxlZ2FjeSgoKSA9PiB7XG4gICAgY29uc3QgeyBwaXBlbGluZSwgaW50ZWdUZXN0QXJ0aWZhY3QgfSA9IGxlZ2FjeVNldHVwKCk7XG4gICAgcGlwZWxpbmUuYWRkU3RhZ2UoJ1Rlc3QnKS5hZGRBY3Rpb25zKG5ldyBjZGtwLlNoZWxsU2NyaXB0QWN0aW9uKHtcbiAgICAgIGFjdGlvbk5hbWU6ICdpbWFnZUFjdGlvbicsXG4gICAgICBhZGRpdGlvbmFsQXJ0aWZhY3RzOiBbaW50ZWdUZXN0QXJ0aWZhY3RdLFxuICAgICAgY29tbWFuZHM6IFsndHJ1ZSddLFxuICAgICAgZW52aXJvbm1lbnRWYXJpYWJsZXM6IHtcbiAgICAgICAgVkVSU0lPTjogeyB2YWx1ZTogY29kZXBpcGVsaW5lLkdsb2JhbFZhcmlhYmxlcy5leGVjdXRpb25JZCB9LFxuICAgICAgfSxcbiAgICB9KSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9uKCk7XG4gIH0pO1xuXG4gIHN1aXRlLm1vZGVybigoKSA9PiB7XG4gICAgLy8gUnVuIGFsbCBCdWlsZCBqb2JzIHdpdGggdGhlIGdpdmVuIGltYWdlXG4gICAgY29uc3QgcGlwZWxpbmUgPSBuZXcgTW9kZXJuVGVzdEdpdEh1Yk5wbVBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnKTtcblxuICAgIHBpcGVsaW5lLmFkZFN0YWdlKG5ldyBUd29TdGFja0FwcChhcHAsICdUZXN0JyksIHtcbiAgICAgIHBvc3Q6IFtuZXcgY2RrcC5TaGVsbFN0ZXAoJ2ltYWdlQWN0aW9uJywge1xuICAgICAgICBjb21tYW5kczogWyd0cnVlJ10sXG4gICAgICAgIGVudjoge1xuICAgICAgICAgIFZFUlNJT046IGNvZGVwaXBlbGluZS5HbG9iYWxWYXJpYWJsZXMuZXhlY3V0aW9uSWQsXG4gICAgICAgIH0sXG4gICAgICB9KV0sXG4gICAgfSk7XG5cbiAgICBUSEVOX2NvZGVQaXBlbGluZUV4cGVjdGF0aW9uKCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIFRIRU5fY29kZVBpcGVsaW5lRXhwZWN0YXRpb24oKSB7XG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhwaXBlbGluZVN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Q29kZVBpcGVsaW5lOjpQaXBlbGluZScsIHtcbiAgICAgIFN0YWdlczogTWF0Y2guYXJyYXlXaXRoKFt7XG4gICAgICAgIE5hbWU6ICdUZXN0JyxcbiAgICAgICAgQWN0aW9uczogTWF0Y2guYXJyYXlXaXRoKFtcbiAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgIE5hbWU6ICdpbWFnZUFjdGlvbicsXG4gICAgICAgICAgICBDb25maWd1cmF0aW9uOiBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgICAgRW52aXJvbm1lbnRWYXJpYWJsZXM6IE1hdGNoLnNlcmlhbGl6ZWRKc29uKFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBuYW1lOiAnVkVSU0lPTicsXG4gICAgICAgICAgICAgICAgICB0eXBlOiAnUExBSU5URVhUJyxcbiAgICAgICAgICAgICAgICAgIHZhbHVlOiAnI3tjb2RlcGlwZWxpbmUuUGlwZWxpbmVFeGVjdXRpb25JZH0nLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSksXG4gICAgICAgIF0pLFxuICAgICAgfV0pLFxuICAgIH0pO1xuICB9XG59KTtcblxuXG4vKipcbiAqIFNvbWUgc2hhcmVkIHNldHVwIGZvciBsZWdhY3kgQVBJIHRlc3RzXG4gKi9cbmZ1bmN0aW9uIGxlZ2FjeVNldHVwKCkge1xuICBjb25zdCBzb3VyY2VBcnRpZmFjdCA9IG5ldyBjb2RlcGlwZWxpbmUuQXJ0aWZhY3QoKTtcbiAgY29uc3QgY2xvdWRBc3NlbWJseUFydGlmYWN0ID0gbmV3IGNvZGVwaXBlbGluZS5BcnRpZmFjdCgnQ2xvdWRBc20nKTtcbiAgY29uc3QgaW50ZWdUZXN0QXJ0aWZhY3QgPSBuZXcgY29kZXBpcGVsaW5lLkFydGlmYWN0KCdJbnRlZ1Rlc3RzJyk7XG4gIGNvbnN0IHBpcGVsaW5lID0gbmV3IExlZ2FjeVRlc3RHaXRIdWJOcG1QaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ2RrJywge1xuICAgIHNvdXJjZUFydGlmYWN0LFxuICAgIGNsb3VkQXNzZW1ibHlBcnRpZmFjdCxcbiAgICBzeW50aEFjdGlvbjogY2RrcC5TaW1wbGVTeW50aEFjdGlvbi5zdGFuZGFyZE5wbVN5bnRoKHtcbiAgICAgIHNvdXJjZUFydGlmYWN0LFxuICAgICAgY2xvdWRBc3NlbWJseUFydGlmYWN0LFxuICAgICAgYWRkaXRpb25hbEFydGlmYWN0czogW3sgZGlyZWN0b3J5OiAndGVzdCcsIGFydGlmYWN0OiBpbnRlZ1Rlc3RBcnRpZmFjdCB9XSxcbiAgICB9KSxcbiAgfSk7XG5cbiAgcmV0dXJuIHsgc291cmNlQXJ0aWZhY3QsIGNsb3VkQXNzZW1ibHlBcnRpZmFjdCwgaW50ZWdUZXN0QXJ0aWZhY3QsIHBpcGVsaW5lIH07XG59Il19