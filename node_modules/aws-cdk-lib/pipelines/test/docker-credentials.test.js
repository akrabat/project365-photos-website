"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("../../assertions");
const ec2 = require("../../aws-ec2");
const ecr = require("../../aws-ecr");
const iam = require("../../aws-iam");
const secretsmanager = require("../../aws-secretsmanager");
const cdk = require("../../core");
const testhelpers_1 = require("./testhelpers");
const cdkp = require("../lib");
const lib_1 = require("../lib");
let app;
let stack;
beforeEach(() => {
    app = new testhelpers_1.TestApp();
    stack = new cdk.Stack(app, 'Stack', {
        env: { account: '0123456789012', region: 'eu-west-1' },
    });
});
describe('ExternalDockerCredential', () => {
    let secret;
    beforeEach(() => {
        secret = new secretsmanager.Secret(stack, 'Secret');
    });
    test('dockerHub defaults registry domain', () => {
        const creds = cdkp.DockerCredential.dockerHub(secret);
        expect(Object.keys(creds._renderCdkAssetsConfig())).toEqual(['https://index.docker.io/v1/']);
    });
    test('minimal example only renders secret', () => {
        const creds = cdkp.DockerCredential.customRegistry('example.com', secret);
        const config = creds._renderCdkAssetsConfig();
        expect(stack.resolve(config)).toEqual({
            'example.com': {
                secretsManagerSecretId: { Ref: 'SecretA720EF05' },
            },
        });
    });
    test('maximum example includes all expected properties', () => {
        const roleArn = 'arn:aws:iam::0123456789012:role/MyRole';
        const creds = cdkp.DockerCredential.customRegistry('example.com', secret, {
            secretUsernameField: 'login',
            secretPasswordField: 'pass',
            assumeRole: iam.Role.fromRoleArn(stack, 'Role', roleArn),
        });
        const config = creds._renderCdkAssetsConfig();
        expect(stack.resolve(config)).toEqual({
            'example.com': {
                secretsManagerSecretId: { Ref: 'SecretA720EF05' },
                secretsUsernameField: 'login',
                secretsPasswordField: 'pass',
                assumeRoleArn: roleArn,
            },
        });
    });
    describe('grantRead', () => {
        test('grants read access to the secret', () => {
            const creds = cdkp.DockerCredential.customRegistry('example.com', secret);
            const user = new iam.User(stack, 'User');
            creds.grantRead(user, cdkp.DockerCredentialUsage.ASSET_PUBLISHING);
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
                PolicyDocument: {
                    Statement: [
                        {
                            Action: ['secretsmanager:GetSecretValue', 'secretsmanager:DescribeSecret'],
                            Effect: 'Allow',
                            Resource: { Ref: 'SecretA720EF05' },
                        },
                    ],
                    Version: '2012-10-17',
                },
                Users: [{ Ref: 'User00B015A1' }],
            });
        });
        test('grants read access to the secret to the assumeRole if provided', () => {
            const assumeRole = iam.Role.fromRoleArn(stack, 'Role', 'arn:aws:iam::0123456789012:role/MyRole');
            const creds = cdkp.DockerCredential.customRegistry('example.com', secret, { assumeRole });
            const user = new iam.User(stack, 'User');
            creds.grantRead(user, cdkp.DockerCredentialUsage.ASSET_PUBLISHING);
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
                PolicyDocument: {
                    Statement: [{
                            Action: ['secretsmanager:GetSecretValue', 'secretsmanager:DescribeSecret'],
                            Effect: 'Allow',
                            Resource: { Ref: 'SecretA720EF05' },
                        }],
                    Version: '2012-10-17',
                },
                Roles: ['MyRole'],
            });
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
                PolicyDocument: {
                    Statement: [{
                            Action: 'sts:AssumeRole',
                            Effect: 'Allow',
                            Resource: 'arn:aws:iam::0123456789012:role/MyRole',
                        }],
                    Version: '2012-10-17',
                },
                Users: [{ Ref: 'User00B015A1' }],
            });
        });
        test('does not grant any access if the usage does not match', () => {
            const assumeRole = iam.Role.fromRoleArn(stack, 'Role', 'arn:aws:iam::0123456789012:role/MyRole');
            const creds = cdkp.DockerCredential.customRegistry('example.com', secret, {
                assumeRole,
                usages: [cdkp.DockerCredentialUsage.ASSET_PUBLISHING],
            });
            const user = new iam.User(stack, 'User');
            creds.grantRead(user, cdkp.DockerCredentialUsage.SELF_UPDATE);
            assertions_1.Template.fromStack(stack).resourceCountIs('AWS::IAM::Policy', 0);
        });
    });
});
describe('EcrDockerCredential', () => {
    let repo;
    beforeEach(() => {
        repo = ecr.Repository.fromRepositoryArn(stack, 'Repo', 'arn:aws:ecr:eu-west-1:0123456789012:repository/Repo');
    });
    test('minimal example only renders ecrRepository', () => {
        const creds = cdkp.DockerCredential.ecr([repo]);
        const config = creds._renderCdkAssetsConfig();
        expect(stack.resolve(Object.keys(config))).toEqual([{
                'Fn::Select': [
                    0, {
                        'Fn::Split': ['/', {
                                'Fn::Join': ['', ['0123456789012.dkr.ecr.eu-west-1.', { Ref: 'AWS::URLSuffix' }, '/Repo']],
                            }],
                    },
                ],
            }]);
        expect(Object.values(config)).toEqual([{
                ecrRepository: true,
            }]);
    });
    test('maximum example renders all fields', () => {
        const roleArn = 'arn:aws:iam::0123456789012:role/MyRole';
        const creds = cdkp.DockerCredential.ecr([repo], {
            assumeRole: iam.Role.fromRoleArn(stack, 'Role', roleArn),
            usages: [cdkp.DockerCredentialUsage.SYNTH],
        });
        const config = creds._renderCdkAssetsConfig();
        expect(stack.resolve(Object.keys(config))).toEqual([{
                'Fn::Select': [
                    0, {
                        'Fn::Split': ['/', {
                                'Fn::Join': ['', ['0123456789012.dkr.ecr.eu-west-1.', { Ref: 'AWS::URLSuffix' }, '/Repo']],
                            }],
                    },
                ],
            }]);
        expect(Object.values(config)).toEqual([{
                assumeRoleArn: roleArn,
                ecrRepository: true,
            }]);
    });
    describe('grantRead', () => {
        test('grants pull access to the repo', () => {
            const creds = cdkp.DockerCredential.ecr([repo]);
            const user = new iam.User(stack, 'User');
            creds.grantRead(user, cdkp.DockerCredentialUsage.ASSET_PUBLISHING);
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
                PolicyDocument: {
                    Statement: [{
                            Action: [
                                'ecr:BatchCheckLayerAvailability',
                                'ecr:GetDownloadUrlForLayer',
                                'ecr:BatchGetImage',
                            ],
                            Effect: 'Allow',
                            Resource: 'arn:aws:ecr:eu-west-1:0123456789012:repository/Repo',
                        },
                        {
                            Action: 'ecr:GetAuthorizationToken',
                            Effect: 'Allow',
                            Resource: '*',
                        }],
                    Version: '2012-10-17',
                },
                Users: [{ Ref: 'User00B015A1' }],
            });
        });
        test('grants pull access to the assumed role', () => {
            const assumeRole = iam.Role.fromRoleArn(stack, 'Role', 'arn:aws:iam::0123456789012:role/MyRole');
            const creds = cdkp.DockerCredential.ecr([repo], { assumeRole });
            const user = new iam.User(stack, 'User');
            creds.grantRead(user, cdkp.DockerCredentialUsage.ASSET_PUBLISHING);
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
                PolicyDocument: {
                    Statement: [{
                            Action: [
                                'ecr:BatchCheckLayerAvailability',
                                'ecr:GetDownloadUrlForLayer',
                                'ecr:BatchGetImage',
                            ],
                            Effect: 'Allow',
                            Resource: 'arn:aws:ecr:eu-west-1:0123456789012:repository/Repo',
                        },
                        {
                            Action: 'ecr:GetAuthorizationToken',
                            Effect: 'Allow',
                            Resource: '*',
                        }],
                    Version: '2012-10-17',
                },
                Roles: ['MyRole'],
            });
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
                PolicyDocument: {
                    Statement: [{
                            Action: 'sts:AssumeRole',
                            Effect: 'Allow',
                            Resource: 'arn:aws:iam::0123456789012:role/MyRole',
                        }],
                    Version: '2012-10-17',
                },
                Users: [{ Ref: 'User00B015A1' }],
            });
        });
        test('grants pull access to multiple repos if provided', () => {
            const repo2 = ecr.Repository.fromRepositoryArn(stack, 'Repo2', 'arn:aws:ecr:eu-west-1:0123456789012:repository/Repo2');
            const creds = cdkp.DockerCredential.ecr([repo, repo2]);
            const user = new iam.User(stack, 'User');
            creds.grantRead(user, cdkp.DockerCredentialUsage.ASSET_PUBLISHING);
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::IAM::Policy', {
                PolicyDocument: {
                    Statement: assertions_1.Match.arrayWith([{
                            Action: [
                                'ecr:BatchCheckLayerAvailability',
                                'ecr:GetDownloadUrlForLayer',
                                'ecr:BatchGetImage',
                            ],
                            Effect: 'Allow',
                            Resource: 'arn:aws:ecr:eu-west-1:0123456789012:repository/Repo',
                        },
                        {
                            Action: 'ecr:GetAuthorizationToken',
                            Effect: 'Allow',
                            Resource: '*',
                        },
                        {
                            Action: [
                                'ecr:BatchCheckLayerAvailability',
                                'ecr:GetDownloadUrlForLayer',
                                'ecr:BatchGetImage',
                            ],
                            Effect: 'Allow',
                            Resource: 'arn:aws:ecr:eu-west-1:0123456789012:repository/Repo2',
                        }]),
                    Version: '2012-10-17',
                },
                Users: [{ Ref: 'User00B015A1' }],
            });
        });
        test('does not grant any access if the usage does not match', () => {
            const creds = cdkp.DockerCredential.ecr([repo], { usages: [cdkp.DockerCredentialUsage.SYNTH] });
            const user = new iam.User(stack, 'User');
            creds.grantRead(user, cdkp.DockerCredentialUsage.ASSET_PUBLISHING);
            assertions_1.Template.fromStack(stack).resourceCountIs('AWS::IAM::Policy', 0);
        });
    });
    // This test doesn't actually work yet. See https://github.com/aws/aws-cdk/issues/16164
    // eslint-disable-next-line jest/no-disabled-tests
    test.skip('with non-parallel publishing', () => {
        const pipelines = new cdkp.CodePipeline(stack, 'Pipeline', {
            synth: new lib_1.ShellStep('Build', {
                input: cdkp.CodePipelineSource.gitHub('test/test', 'test'),
                commands: ['cdk synth'],
            }),
            publishAssetsInParallel: false,
            dockerCredentials: [
                cdkp.DockerCredential.ecr([repo]),
            ],
        });
        pipelines.addStage(new testhelpers_1.DockerAssetApp(stack, 'AssetApp'));
        // Should not throw
        app.synth();
    });
});
describe('dockerCredentialsInstallCommands', () => {
    const secretArn = 'arn:aws:secretsmanager:eu-west-1:0123456789012:secret:mySecret-012345';
    let secret;
    beforeEach(() => {
        secret = secretsmanager.Secret.fromSecretCompleteArn(stack, 'Secret', secretArn);
    });
    test('returns a blank array for empty inputs', () => {
        expect(cdkp.dockerCredentialsInstallCommands(cdkp.DockerCredentialUsage.SYNTH)).toEqual([]);
        expect(cdkp.dockerCredentialsInstallCommands(cdkp.DockerCredentialUsage.SYNTH, [])).toEqual([]);
    });
    test('returns only credentials relevant to the current usage', () => {
        const synthCreds = cdkp.DockerCredential.customRegistry('synth.example.com', secret, {
            usages: [cdkp.DockerCredentialUsage.SYNTH],
        });
        const selfUpdateCreds = cdkp.DockerCredential.customRegistry('selfupdate.example.com', secret, {
            usages: [cdkp.DockerCredentialUsage.SELF_UPDATE],
        });
        const assetPublishingCreds = cdkp.DockerCredential.customRegistry('assetpublishing.example.com', secret, {
            usages: [cdkp.DockerCredentialUsage.ASSET_PUBLISHING],
        });
        const commands = cdkp.dockerCredentialsInstallCommands(cdkp.DockerCredentialUsage.SYNTH, [synthCreds, selfUpdateCreds, assetPublishingCreds]).join('|');
        expect(commands.includes('synth')).toBeTruthy();
        expect(commands.includes('selfupdate')).toBeFalsy();
        expect(commands.includes('assetpublishing')).toBeFalsy();
    });
    test('defaults to Linux-style commands', () => {
        const creds = cdkp.DockerCredential.dockerHub(secret);
        const defaultCommands = cdkp.dockerCredentialsInstallCommands(cdkp.DockerCredentialUsage.SYNTH, [creds]);
        const linuxCommands = cdkp.dockerCredentialsInstallCommands(cdkp.DockerCredentialUsage.SYNTH, [creds], ec2.OperatingSystemType.LINUX);
        expect(defaultCommands).toEqual(linuxCommands);
    });
    test('Linux commands', () => {
        const creds = cdkp.DockerCredential.customRegistry('example.com', secret);
        const expectedCredsFile = JSON.stringify({
            version: '1.0',
            domainCredentials: {
                'example.com': { secretsManagerSecretId: secretArn },
            },
        });
        const commands = cdkp.dockerCredentialsInstallCommands(cdkp.DockerCredentialUsage.SYNTH, [creds], ec2.OperatingSystemType.LINUX);
        expect(commands).toEqual([
            'mkdir $HOME/.cdk',
            `echo '${expectedCredsFile}' > $HOME/.cdk/cdk-docker-creds.json`,
        ]);
    });
    test('Windows commands', () => {
        const creds = cdkp.DockerCredential.customRegistry('example.com', secret);
        const expectedCredsFile = JSON.stringify({
            version: '1.0',
            domainCredentials: {
                'example.com': { secretsManagerSecretId: secretArn },
            },
        });
        const commands = cdkp.dockerCredentialsInstallCommands(cdkp.DockerCredentialUsage.SYNTH, [creds], ec2.OperatingSystemType.WINDOWS);
        expect(commands).toEqual([
            'mkdir %USERPROFILE%\\.cdk',
            `echo '${expectedCredsFile}' > %USERPROFILE%\\.cdk\\cdk-docker-creds.json`,
        ]);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9ja2VyLWNyZWRlbnRpYWxzLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkb2NrZXItY3JlZGVudGlhbHMudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUFtRDtBQUNuRCxxQ0FBcUM7QUFDckMscUNBQXFDO0FBQ3JDLHFDQUFxQztBQUNyQywyREFBMkQ7QUFDM0Qsa0NBQWtDO0FBQ2xDLCtDQUF3RDtBQUN4RCwrQkFBK0I7QUFDL0IsZ0NBQW1DO0FBRW5DLElBQUksR0FBWSxDQUFDO0FBQ2pCLElBQUksS0FBZ0IsQ0FBQztBQUVyQixVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2QsR0FBRyxHQUFHLElBQUkscUJBQU8sRUFBRSxDQUFDO0lBQ3BCLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLE9BQU8sRUFBRTtRQUNsQyxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUU7S0FDdkQsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFO0lBRXhDLElBQUksTUFBOEIsQ0FBQztJQUVuQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsTUFBTSxHQUFHLElBQUksY0FBYyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDdEQsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO1FBQzlDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFdEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLHNCQUFzQixFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLDZCQUE2QixDQUFDLENBQUMsQ0FBQztJQUMv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QUFFLEtBQUs7WUFDZCxpQkFBaUIsRUFBRTtnQkFDakIsYUFBYSxFQUFFLEVBQUUsc0JBQXNCLEVBQUUsU0FBUyxFQUFFO2FBQ3JEO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGdDQUFnQyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFHLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFbkksTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUN2QiwyQkFBMkI7WUFDM0IsU0FBUyxpQkFBaUIsZ0RBQWdEO1NBQzNFLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNYXRjaCwgVGVtcGxhdGUgfSBmcm9tICcuLi8uLi9hc3NlcnRpb25zJztcbmltcG9ydCAqIGFzIGVjMiBmcm9tICcuLi8uLi9hd3MtZWMyJztcbmltcG9ydCAqIGFzIGVjciBmcm9tICcuLi8uLi9hd3MtZWNyJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICcuLi8uLi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIHNlY3JldHNtYW5hZ2VyIGZyb20gJy4uLy4uL2F3cy1zZWNyZXRzbWFuYWdlcic7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnLi4vLi4vY29yZSc7XG5pbXBvcnQgeyBEb2NrZXJBc3NldEFwcCwgVGVzdEFwcCB9IGZyb20gJy4vdGVzdGhlbHBlcnMnO1xuaW1wb3J0ICogYXMgY2RrcCBmcm9tICcuLi9saWInO1xuaW1wb3J0IHsgU2hlbGxTdGVwIH0gZnJvbSAnLi4vbGliJztcblxubGV0IGFwcDogY2RrLkFwcDtcbmxldCBzdGFjazogY2RrLlN0YWNrO1xuXG5iZWZvcmVFYWNoKCgpID0+IHtcbiAgYXBwID0gbmV3IFRlc3RBcHAoKTtcbiAgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKGFwcCwgJ1N0YWNrJywge1xuICAgIGVudjogeyBhY2NvdW50OiAnMDEyMzQ1Njc4OTAxMicsIHJlZ2lvbjogJ2V1LXdlc3QtMScgfSxcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ0V4dGVybmFsRG9ja2VyQ3JlZGVudGlhbCcsICgpID0+IHtcblxuICBsZXQgc2VjcmV0OiBzZWNyZXRzbWFuYWdlci5JU2VjcmV0O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHNlY3JldCA9IG5ldyBzZWNyZXRzbWFuYWdlci5TZWNyZXQoc3RhY2ssICdTZWNyZXQnKTtcbiAgfSk7XG5cbiAgdGVzdCgnZG9ja2VySHViIGRlZmF1bHRzIHJlZ2lzdHJ5IGRvbWFpbicsICgpID0+IHtcbiAgICBjb25zdCBjcmVkcyA9IGNka3AuRG9ja2VyQ3JlZGVudGlhbC5kb2NrZXJIdWIoc2VjcmV0KTtcblxuICAgIGV4cGVjdChPYmplY3Qua2V5cyhjcmVkcy5fcmVuZGVyQ2RrQXNzZXRzQ29uZmlnKCkpKS50b0VxdWFsKFsnaHR0cHM6Ly9pbmRleC5kb2NrZXIuaW8vdjEvJ10pO1xuICB9KTtcblxuICB0ZXN0KCdtaW5pbWFsIGV4YW1wbGUgb25seSByZW5kZXJzIHNlY3JldCcsICgpID0+IHtcbiAgICBjb25zdCBjcmVkcyA9IGNka3AuRG9ja2VyQ3JlZGVudGlhbC5jdXN0b21SZWdpc3RyeSgnZXhhbXBsZS5jb20nLCBzZWNyZXQpO1xuXG4gICAgY29uc3QgY29uZmlnID0gY3JlZHMuX3JlbmRlckNka0Fzc2V0c0NvbmZpZygpO1xuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGNvbmZpZykpLnRvRXF1YWwoe1xuICAgICAgJ2V4YW1wbGUuY29tJzoge1xuICAgICAgICBzZWNyZXRzTWFuYWdlclNlY3JldElkOiB7IFJlZjogJ1NlY3JldEE3MjBFRjA1JyB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnbWF4aW11bSBleGFtcGxlIGluY2x1ZGVzIGFsbCBleHBlY3RlZCBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgIGNvbnN0IHJvbGVBcm4gPSAnYXJuOmF3czppYW06OjAxMjM0NTY3ODkwMTI6cm9sZS9NeVJvbGUnO1xuICAgIGNvbnN0IGNyZWRzID0gY2RrcC5Eb2NrZXJDcmVkZW50aWFsLmN1c3RvbVJlZ2lzdHJ5KCdleGFtcGxlLmNvbScsIHNlY3JldCwge1xuICAgICAgc2VjcmV0VXNlcm5hbWVGaWVsZDogJ2xvZ2luJyxcbiAgICAgIHNlY3JldFBhc3N3b3JkRmllbGQ6ICdwYXNzJyxcbiAgICAgIGFzc3VtZVJvbGU6IGlhbS5Sb2xlLmZyb21Sb2xlQXJuKHN0YWNrLCAnUm9sZScsIHJvbGVBcm4pLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY29uZmlnID0gY3JlZHMuX3JlbmRlckNka0Fzc2V0c0NvbmZpZygpO1xuICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGNvbmZpZykpLnRvRXF1YWwoe1xuICAgICAgJ2V4YW1wbGUuY29tJzoge1xuICAgICAgICBzZWNyZXRzTWFuYWdlclNlY3JldElkOiB7IFJlZjogJ1NlY3JldEE3MjBFRjA1JyB9LFxuICAgICAgICBzZWNyZXRzVXNlcm5hbWVGaWVsZDogJ2xvZ2luJyxcbiAgICAgICAgc2VjcmV0c1Bhc3N3b3JkRmllbGQ6ICdwYXNzJyxcbiAgICAgICAgYXNzdW1lUm9sZUFybjogcm9sZUFybixcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdncmFudFJlYWQnLCAoKSA9PiB7XG5cbiAgICB0ZXN0KCdncmFudHMgcmVhZCBhY2Nlc3MgdG8gdGhlIHNlY3JldCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNyZWRzID0gY2RrcC5Eb2NrZXJDcmVkZW50aWFsLmN1c3RvbVJlZ2lzdHJ5KCdleGFtcGxlLmNvbScsIHNlY3JldCk7XG5cbiAgICAgIGNvbnN0IHVzZXIgPSBuZXcgaWFtLlVzZXIoc3RhY2ssICdVc2VyJyk7XG4gICAgICBjcmVkcy5ncmFudFJlYWQodXNlciwgY2RrcC5Eb2NrZXJDcmVkZW50aWFsVXNhZ2UuQVNTRVRfUFVCTElTSElORyk7XG5cbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgICAgICBQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICAgIFN0YXRlbWVudDogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBBY3Rpb246IFsnc2VjcmV0c21hbmFnZXI6R2V0U2VjcmV0VmFsdWUnLCAnc2VjcmV0c21hbmFnZXI6RGVzY3JpYmVTZWNyZXQnXSxcbiAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICBSZXNvdXJjZTogeyBSZWY6ICdTZWNyZXRBNzIwRUYwNScgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICBWZXJzaW9uOiAnMjAxMi0xMC0xNycsXG4gICAgICAgIH0sXG4gICAgICAgIFVzZXJzOiBbeyBSZWY6ICdVc2VyMDBCMDE1QTEnIH1dLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdncmFudHMgcmVhZCBhY2Nlc3MgdG8gdGhlIHNlY3JldCB0byB0aGUgYXNzdW1lUm9sZSBpZiBwcm92aWRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGFzc3VtZVJvbGUgPSBpYW0uUm9sZS5mcm9tUm9sZUFybihzdGFjaywgJ1JvbGUnLCAnYXJuOmF3czppYW06OjAxMjM0NTY3ODkwMTI6cm9sZS9NeVJvbGUnKTtcbiAgICAgIGNvbnN0IGNyZWRzID0gY2RrcC5Eb2NrZXJDcmVkZW50aWFsLmN1c3RvbVJlZ2lzdHJ5KCdleGFtcGxlLmNvbScsIHNlY3JldCwgeyBhc3N1bWVSb2xlIH0pO1xuXG4gICAgICBjb25zdCB1c2VyID0gbmV3IGlhbS5Vc2VyKHN0YWNrLCAnVXNlcicpO1xuICAgICAgY3JlZHMuZ3JhbnRSZWFkKHVzZXIsIGNka3AuRG9ja2VyQ3JlZGVudGlhbFVzYWdlLkFTU0VUX1BVQkxJU0hJTkcpO1xuXG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpJQU06OlBvbGljeScsIHtcbiAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgICBTdGF0ZW1lbnQ6IFt7XG4gICAgICAgICAgICBBY3Rpb246IFsnc2VjcmV0c21hbmFnZXI6R2V0U2VjcmV0VmFsdWUnLCAnc2VjcmV0c21hbmFnZXI6RGVzY3JpYmVTZWNyZXQnXSxcbiAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgIFJlc291cmNlOiB7IFJlZjogJ1NlY3JldEE3MjBFRjA1JyB9LFxuICAgICAgICAgIH1dLFxuICAgICAgICAgIFZlcnNpb246ICcyMDEyLTEwLTE3JyxcbiAgICAgICAgfSxcbiAgICAgICAgUm9sZXM6IFsnTXlSb2xlJ10sXG4gICAgICB9KTtcbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgICAgICBQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICAgIFN0YXRlbWVudDogW3tcbiAgICAgICAgICAgIEFjdGlvbjogJ3N0czpBc3N1bWVSb2xlJyxcbiAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgIFJlc291cmNlOiAnYXJuOmF3czppYW06OjAxMjM0NTY3ODkwMTI6cm9sZS9NeVJvbGUnLFxuICAgICAgICAgIH1dLFxuICAgICAgICAgIFZlcnNpb246ICcyMDEyLTEwLTE3JyxcbiAgICAgICAgfSxcbiAgICAgICAgVXNlcnM6IFt7IFJlZjogJ1VzZXIwMEIwMTVBMScgfV0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2RvZXMgbm90IGdyYW50IGFueSBhY2Nlc3MgaWYgdGhlIHVzYWdlIGRvZXMgbm90IG1hdGNoJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXNzdW1lUm9sZSA9IGlhbS5Sb2xlLmZyb21Sb2xlQXJuKHN0YWNrLCAnUm9sZScsICdhcm46YXdzOmlhbTo6MDEyMzQ1Njc4OTAxMjpyb2xlL015Um9sZScpO1xuICAgICAgY29uc3QgY3JlZHMgPSBjZGtwLkRvY2tlckNyZWRlbnRpYWwuY3VzdG9tUmVnaXN0cnkoJ2V4YW1wbGUuY29tJywgc2VjcmV0LCB7XG4gICAgICAgIGFzc3VtZVJvbGUsXG4gICAgICAgIHVzYWdlczogW2Nka3AuRG9ja2VyQ3JlZGVudGlhbFVzYWdlLkFTU0VUX1BVQkxJU0hJTkddLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHVzZXIgPSBuZXcgaWFtLlVzZXIoc3RhY2ssICdVc2VyJyk7XG4gICAgICBjcmVkcy5ncmFudFJlYWQodXNlciwgY2RrcC5Eb2NrZXJDcmVkZW50aWFsVXNhZ2UuU0VMRl9VUERBVEUpO1xuXG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLnJlc291cmNlQ291bnRJcygnQVdTOjpJQU06OlBvbGljeScsIDApO1xuICAgIH0pO1xuXG4gIH0pO1xuXG59KTtcblxuZGVzY3JpYmUoJ0VjckRvY2tlckNyZWRlbnRpYWwnLCAoKSA9PiB7XG5cbiAgbGV0IHJlcG86IGVjci5JUmVwb3NpdG9yeTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICByZXBvID0gZWNyLlJlcG9zaXRvcnkuZnJvbVJlcG9zaXRvcnlBcm4oc3RhY2ssICdSZXBvJywgJ2Fybjphd3M6ZWNyOmV1LXdlc3QtMTowMTIzNDU2Nzg5MDEyOnJlcG9zaXRvcnkvUmVwbycpO1xuICB9KTtcblxuICB0ZXN0KCdtaW5pbWFsIGV4YW1wbGUgb25seSByZW5kZXJzIGVjclJlcG9zaXRvcnknLCAoKSA9PiB7XG4gICAgY29uc3QgY3JlZHMgPSBjZGtwLkRvY2tlckNyZWRlbnRpYWwuZWNyKFtyZXBvXSk7XG5cbiAgICBjb25zdCBjb25maWcgPSBjcmVkcy5fcmVuZGVyQ2RrQXNzZXRzQ29uZmlnKCk7XG5cbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShPYmplY3Qua2V5cyhjb25maWcpKSkudG9FcXVhbChbe1xuICAgICAgJ0ZuOjpTZWxlY3QnOiBbXG4gICAgICAgIDAsIHtcbiAgICAgICAgICAnRm46OlNwbGl0JzogWycvJywge1xuICAgICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbJzAxMjM0NTY3ODkwMTIuZGtyLmVjci5ldS13ZXN0LTEuJywgeyBSZWY6ICdBV1M6OlVSTFN1ZmZpeCcgfSwgJy9SZXBvJ11dLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9XSk7XG4gICAgZXhwZWN0KE9iamVjdC52YWx1ZXMoY29uZmlnKSkudG9FcXVhbChbe1xuICAgICAgZWNyUmVwb3NpdG9yeTogdHJ1ZSxcbiAgICB9XSk7XG4gIH0pO1xuXG4gIHRlc3QoJ21heGltdW0gZXhhbXBsZSByZW5kZXJzIGFsbCBmaWVsZHMnLCAoKSA9PiB7XG4gICAgY29uc3Qgcm9sZUFybiA9ICdhcm46YXdzOmlhbTo6MDEyMzQ1Njc4OTAxMjpyb2xlL015Um9sZSc7XG4gICAgY29uc3QgY3JlZHMgPSBjZGtwLkRvY2tlckNyZWRlbnRpYWwuZWNyKFtyZXBvXSwge1xuICAgICAgYXNzdW1lUm9sZTogaWFtLlJvbGUuZnJvbVJvbGVBcm4oc3RhY2ssICdSb2xlJywgcm9sZUFybiksXG4gICAgICB1c2FnZXM6IFtjZGtwLkRvY2tlckNyZWRlbnRpYWxVc2FnZS5TWU5USF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBjb25maWcgPSBjcmVkcy5fcmVuZGVyQ2RrQXNzZXRzQ29uZmlnKCk7XG5cbiAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShPYmplY3Qua2V5cyhjb25maWcpKSkudG9FcXVhbChbe1xuICAgICAgJ0ZuOjpTZWxlY3QnOiBbXG4gICAgICAgIDAsIHtcbiAgICAgICAgICAnRm46OlNwbGl0JzogWycvJywge1xuICAgICAgICAgICAgJ0ZuOjpKb2luJzogWycnLCBbJzAxMjM0NTY3ODkwMTIuZGtyLmVjci5ldS13ZXN0LTEuJywgeyBSZWY6ICdBV1M6OlVSTFN1ZmZpeCcgfSwgJy9SZXBvJ11dLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9XSk7XG4gICAgZXhwZWN0KE9iamVjdC52YWx1ZXMoY29uZmlnKSkudG9FcXVhbChbe1xuICAgICAgYXNzdW1lUm9sZUFybjogcm9sZUFybixcbiAgICAgIGVjclJlcG9zaXRvcnk6IHRydWUsXG4gICAgfV0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ3JhbnRSZWFkJywgKCkgPT4ge1xuXG4gICAgdGVzdCgnZ3JhbnRzIHB1bGwgYWNjZXNzIHRvIHRoZSByZXBvJywgKCkgPT4ge1xuICAgICAgY29uc3QgY3JlZHMgPSBjZGtwLkRvY2tlckNyZWRlbnRpYWwuZWNyKFtyZXBvXSk7XG5cbiAgICAgIGNvbnN0IHVzZXIgPSBuZXcgaWFtLlVzZXIoc3RhY2ssICdVc2VyJyk7XG4gICAgICBjcmVkcy5ncmFudFJlYWQodXNlciwgY2RrcC5Eb2NrZXJDcmVkZW50aWFsVXNhZ2UuQVNTRVRfUFVCTElTSElORyk7XG5cbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgICAgICBQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICAgIFN0YXRlbWVudDogW3tcbiAgICAgICAgICAgIEFjdGlvbjogW1xuICAgICAgICAgICAgICAnZWNyOkJhdGNoQ2hlY2tMYXllckF2YWlsYWJpbGl0eScsXG4gICAgICAgICAgICAgICdlY3I6R2V0RG93bmxvYWRVcmxGb3JMYXllcicsXG4gICAgICAgICAgICAgICdlY3I6QmF0Y2hHZXRJbWFnZScsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgUmVzb3VyY2U6ICdhcm46YXdzOmVjcjpldS13ZXN0LTE6MDEyMzQ1Njc4OTAxMjpyZXBvc2l0b3J5L1JlcG8nLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgQWN0aW9uOiAnZWNyOkdldEF1dGhvcml6YXRpb25Ub2tlbicsXG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICAgIH1dLFxuICAgICAgICAgIFZlcnNpb246ICcyMDEyLTEwLTE3JyxcbiAgICAgICAgfSxcbiAgICAgICAgVXNlcnM6IFt7IFJlZjogJ1VzZXIwMEIwMTVBMScgfV0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2dyYW50cyBwdWxsIGFjY2VzcyB0byB0aGUgYXNzdW1lZCByb2xlJywgKCkgPT4ge1xuICAgICAgY29uc3QgYXNzdW1lUm9sZSA9IGlhbS5Sb2xlLmZyb21Sb2xlQXJuKHN0YWNrLCAnUm9sZScsICdhcm46YXdzOmlhbTo6MDEyMzQ1Njc4OTAxMjpyb2xlL015Um9sZScpO1xuICAgICAgY29uc3QgY3JlZHMgPSBjZGtwLkRvY2tlckNyZWRlbnRpYWwuZWNyKFtyZXBvXSwgeyBhc3N1bWVSb2xlIH0pO1xuXG4gICAgICBjb25zdCB1c2VyID0gbmV3IGlhbS5Vc2VyKHN0YWNrLCAnVXNlcicpO1xuICAgICAgY3JlZHMuZ3JhbnRSZWFkKHVzZXIsIGNka3AuRG9ja2VyQ3JlZGVudGlhbFVzYWdlLkFTU0VUX1BVQkxJU0hJTkcpO1xuXG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpJQU06OlBvbGljeScsIHtcbiAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgICBTdGF0ZW1lbnQ6IFt7XG4gICAgICAgICAgICBBY3Rpb246IFtcbiAgICAgICAgICAgICAgJ2VjcjpCYXRjaENoZWNrTGF5ZXJBdmFpbGFiaWxpdHknLFxuICAgICAgICAgICAgICAnZWNyOkdldERvd25sb2FkVXJsRm9yTGF5ZXInLFxuICAgICAgICAgICAgICAnZWNyOkJhdGNoR2V0SW1hZ2UnLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgIFJlc291cmNlOiAnYXJuOmF3czplY3I6ZXUtd2VzdC0xOjAxMjM0NTY3ODkwMTI6cmVwb3NpdG9yeS9SZXBvJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIEFjdGlvbjogJ2VjcjpHZXRBdXRob3JpemF0aW9uVG9rZW4nLFxuICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgUmVzb3VyY2U6ICcqJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgICBWZXJzaW9uOiAnMjAxMi0xMC0xNycsXG4gICAgICAgIH0sXG4gICAgICAgIFJvbGVzOiBbJ015Um9sZSddLFxuICAgICAgfSk7XG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpJQU06OlBvbGljeScsIHtcbiAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgICBTdGF0ZW1lbnQ6IFt7XG4gICAgICAgICAgICBBY3Rpb246ICdzdHM6QXNzdW1lUm9sZScsXG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICBSZXNvdXJjZTogJ2Fybjphd3M6aWFtOjowMTIzNDU2Nzg5MDEyOnJvbGUvTXlSb2xlJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgICBWZXJzaW9uOiAnMjAxMi0xMC0xNycsXG4gICAgICAgIH0sXG4gICAgICAgIFVzZXJzOiBbeyBSZWY6ICdVc2VyMDBCMDE1QTEnIH1dLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdncmFudHMgcHVsbCBhY2Nlc3MgdG8gbXVsdGlwbGUgcmVwb3MgaWYgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXBvMiA9IGVjci5SZXBvc2l0b3J5LmZyb21SZXBvc2l0b3J5QXJuKHN0YWNrLCAnUmVwbzInLCAnYXJuOmF3czplY3I6ZXUtd2VzdC0xOjAxMjM0NTY3ODkwMTI6cmVwb3NpdG9yeS9SZXBvMicpO1xuICAgICAgY29uc3QgY3JlZHMgPSBjZGtwLkRvY2tlckNyZWRlbnRpYWwuZWNyKFtyZXBvLCByZXBvMl0pO1xuXG4gICAgICBjb25zdCB1c2VyID0gbmV3IGlhbS5Vc2VyKHN0YWNrLCAnVXNlcicpO1xuICAgICAgY3JlZHMuZ3JhbnRSZWFkKHVzZXIsIGNka3AuRG9ja2VyQ3JlZGVudGlhbFVzYWdlLkFTU0VUX1BVQkxJU0hJTkcpO1xuXG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpJQU06OlBvbGljeScsIHtcbiAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgICBTdGF0ZW1lbnQ6IE1hdGNoLmFycmF5V2l0aChbe1xuICAgICAgICAgICAgQWN0aW9uOiBbXG4gICAgICAgICAgICAgICdlY3I6QmF0Y2hDaGVja0xheWVyQXZhaWxhYmlsaXR5JyxcbiAgICAgICAgICAgICAgJ2VjcjpHZXREb3dubG9hZFVybEZvckxheWVyJyxcbiAgICAgICAgICAgICAgJ2VjcjpCYXRjaEdldEltYWdlJyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICBSZXNvdXJjZTogJ2Fybjphd3M6ZWNyOmV1LXdlc3QtMTowMTIzNDU2Nzg5MDEyOnJlcG9zaXRvcnkvUmVwbycsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBBY3Rpb246ICdlY3I6R2V0QXV0aG9yaXphdGlvblRva2VuJyxcbiAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBBY3Rpb246IFtcbiAgICAgICAgICAgICAgJ2VjcjpCYXRjaENoZWNrTGF5ZXJBdmFpbGFiaWxpdHknLFxuICAgICAgICAgICAgICAnZWNyOkdldERvd25sb2FkVXJsRm9yTGF5ZXInLFxuICAgICAgICAgICAgICAnZWNyOkJhdGNoR2V0SW1hZ2UnLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgIFJlc291cmNlOiAnYXJuOmF3czplY3I6ZXUtd2VzdC0xOjAxMjM0NTY3ODkwMTI6cmVwb3NpdG9yeS9SZXBvMicsXG4gICAgICAgICAgfV0pLFxuICAgICAgICAgIFZlcnNpb246ICcyMDEyLTEwLTE3JyxcbiAgICAgICAgfSxcbiAgICAgICAgVXNlcnM6IFt7IFJlZjogJ1VzZXIwMEIwMTVBMScgfV0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2RvZXMgbm90IGdyYW50IGFueSBhY2Nlc3MgaWYgdGhlIHVzYWdlIGRvZXMgbm90IG1hdGNoJywgKCkgPT4ge1xuICAgICAgY29uc3QgY3JlZHMgPSBjZGtwLkRvY2tlckNyZWRlbnRpYWwuZWNyKFtyZXBvXSwgeyB1c2FnZXM6IFtjZGtwLkRvY2tlckNyZWRlbnRpYWxVc2FnZS5TWU5USF0gfSk7XG5cbiAgICAgIGNvbnN0IHVzZXIgPSBuZXcgaWFtLlVzZXIoc3RhY2ssICdVc2VyJyk7XG4gICAgICBjcmVkcy5ncmFudFJlYWQodXNlciwgY2RrcC5Eb2NrZXJDcmVkZW50aWFsVXNhZ2UuQVNTRVRfUFVCTElTSElORyk7XG5cbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykucmVzb3VyY2VDb3VudElzKCdBV1M6OklBTTo6UG9saWN5JywgMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIFRoaXMgdGVzdCBkb2Vzbid0IGFjdHVhbGx5IHdvcmsgeWV0LiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2F3cy9hd3MtY2RrL2lzc3Vlcy8xNjE2NFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgamVzdC9uby1kaXNhYmxlZC10ZXN0c1xuICB0ZXN0LnNraXAoJ3dpdGggbm9uLXBhcmFsbGVsIHB1Ymxpc2hpbmcnLCAoKSA9PiB7XG4gICAgY29uc3QgcGlwZWxpbmVzID0gbmV3IGNka3AuQ29kZVBpcGVsaW5lKHN0YWNrLCAnUGlwZWxpbmUnLCB7XG4gICAgICBzeW50aDogbmV3IFNoZWxsU3RlcCgnQnVpbGQnLCB7XG4gICAgICAgIGlucHV0OiBjZGtwLkNvZGVQaXBlbGluZVNvdXJjZS5naXRIdWIoJ3Rlc3QvdGVzdCcsICd0ZXN0JyksXG4gICAgICAgIGNvbW1hbmRzOiBbJ2NkayBzeW50aCddLFxuICAgICAgfSksXG5cbiAgICAgIHB1Ymxpc2hBc3NldHNJblBhcmFsbGVsOiBmYWxzZSxcbiAgICAgIGRvY2tlckNyZWRlbnRpYWxzOiBbXG4gICAgICAgIGNka3AuRG9ja2VyQ3JlZGVudGlhbC5lY3IoW3JlcG9dKSxcbiAgICAgIF0sXG4gICAgfSk7XG4gICAgcGlwZWxpbmVzLmFkZFN0YWdlKG5ldyBEb2NrZXJBc3NldEFwcChzdGFjaywgJ0Fzc2V0QXBwJykpO1xuXG4gICAgLy8gU2hvdWxkIG5vdCB0aHJvd1xuICAgIGFwcC5zeW50aCgpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnZG9ja2VyQ3JlZGVudGlhbHNJbnN0YWxsQ29tbWFuZHMnLCAoKSA9PiB7XG4gIGNvbnN0IHNlY3JldEFybiA9ICdhcm46YXdzOnNlY3JldHNtYW5hZ2VyOmV1LXdlc3QtMTowMTIzNDU2Nzg5MDEyOnNlY3JldDpteVNlY3JldC0wMTIzNDUnO1xuICBsZXQgc2VjcmV0OiBzZWNyZXRzbWFuYWdlci5JU2VjcmV0O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHNlY3JldCA9IHNlY3JldHNtYW5hZ2VyLlNlY3JldC5mcm9tU2VjcmV0Q29tcGxldGVBcm4oc3RhY2ssICdTZWNyZXQnLCBzZWNyZXRBcm4pO1xuICB9KTtcblxuICB0ZXN0KCdyZXR1cm5zIGEgYmxhbmsgYXJyYXkgZm9yIGVtcHR5IGlucHV0cycsICgpID0+IHtcbiAgICBleHBlY3QoY2RrcC5kb2NrZXJDcmVkZW50aWFsc0luc3RhbGxDb21tYW5kcyhjZGtwLkRvY2tlckNyZWRlbnRpYWxVc2FnZS5TWU5USCkpLnRvRXF1YWwoW10pO1xuICAgIGV4cGVjdChjZGtwLmRvY2tlckNyZWRlbnRpYWxzSW5zdGFsbENvbW1hbmRzKGNka3AuRG9ja2VyQ3JlZGVudGlhbFVzYWdlLlNZTlRILCBbXSkpLnRvRXF1YWwoW10pO1xuICB9KTtcblxuICB0ZXN0KCdyZXR1cm5zIG9ubHkgY3JlZGVudGlhbHMgcmVsZXZhbnQgdG8gdGhlIGN1cnJlbnQgdXNhZ2UnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3ludGhDcmVkcyA9IGNka3AuRG9ja2VyQ3JlZGVudGlhbC5jdXN0b21SZWdpc3RyeSgnc3ludGguZXhhbXBsZS5jb20nLCBzZWNyZXQsIHtcbiAgICAgIHVzYWdlczogW2Nka3AuRG9ja2VyQ3JlZGVudGlhbFVzYWdlLlNZTlRIXSxcbiAgICB9KTtcbiAgICBjb25zdCBzZWxmVXBkYXRlQ3JlZHMgPSBjZGtwLkRvY2tlckNyZWRlbnRpYWwuY3VzdG9tUmVnaXN0cnkoJ3NlbGZ1cGRhdGUuZXhhbXBsZS5jb20nLCBzZWNyZXQsIHtcbiAgICAgIHVzYWdlczogW2Nka3AuRG9ja2VyQ3JlZGVudGlhbFVzYWdlLlNFTEZfVVBEQVRFXSxcbiAgICB9KTtcbiAgICBjb25zdCBhc3NldFB1Ymxpc2hpbmdDcmVkcyA9IGNka3AuRG9ja2VyQ3JlZGVudGlhbC5jdXN0b21SZWdpc3RyeSgnYXNzZXRwdWJsaXNoaW5nLmV4YW1wbGUuY29tJywgc2VjcmV0LCB7XG4gICAgICB1c2FnZXM6IFtjZGtwLkRvY2tlckNyZWRlbnRpYWxVc2FnZS5BU1NFVF9QVUJMSVNISU5HXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvbW1hbmRzID0gY2RrcC5kb2NrZXJDcmVkZW50aWFsc0luc3RhbGxDb21tYW5kcyhjZGtwLkRvY2tlckNyZWRlbnRpYWxVc2FnZS5TWU5USCxcbiAgICAgIFtzeW50aENyZWRzLCBzZWxmVXBkYXRlQ3JlZHMsIGFzc2V0UHVibGlzaGluZ0NyZWRzXSkuam9pbignfCcpO1xuXG4gICAgZXhwZWN0KGNvbW1hbmRzLmluY2x1ZGVzKCdzeW50aCcpKS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGNvbW1hbmRzLmluY2x1ZGVzKCdzZWxmdXBkYXRlJykpLnRvQmVGYWxzeSgpO1xuICAgIGV4cGVjdChjb21tYW5kcy5pbmNsdWRlcygnYXNzZXRwdWJsaXNoaW5nJykpLnRvQmVGYWxzeSgpO1xuICB9KTtcblxuICB0ZXN0KCdkZWZhdWx0cyB0byBMaW51eC1zdHlsZSBjb21tYW5kcycsICgpID0+IHtcbiAgICBjb25zdCBjcmVkcyA9IGNka3AuRG9ja2VyQ3JlZGVudGlhbC5kb2NrZXJIdWIoc2VjcmV0KTtcblxuICAgIGNvbnN0IGRlZmF1bHRDb21tYW5kcyA9IGNka3AuZG9ja2VyQ3JlZGVudGlhbHNJbnN0YWxsQ29tbWFuZHMoY2RrcC5Eb2NrZXJDcmVkZW50aWFsVXNhZ2UuU1lOVEgsIFtjcmVkc10pO1xuICAgIGNvbnN0IGxpbnV4Q29tbWFuZHMgPSBjZGtwLmRvY2tlckNyZWRlbnRpYWxzSW5zdGFsbENvbW1hbmRzKGNka3AuRG9ja2VyQ3JlZGVudGlhbFVzYWdlLlNZTlRILCBbY3JlZHNdLCBlYzIuT3BlcmF0aW5nU3lzdGVtVHlwZS5MSU5VWCk7XG5cbiAgICBleHBlY3QoZGVmYXVsdENvbW1hbmRzKS50b0VxdWFsKGxpbnV4Q29tbWFuZHMpO1xuICB9KTtcblxuICB0ZXN0KCdMaW51eCBjb21tYW5kcycsICgpID0+IHtcbiAgICBjb25zdCBjcmVkcyA9IGNka3AuRG9ja2VyQ3JlZGVudGlhbC5jdXN0b21SZWdpc3RyeSgnZXhhbXBsZS5jb20nLCBzZWNyZXQpO1xuICAgIGNvbnN0IGV4cGVjdGVkQ3JlZHNGaWxlID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgdmVyc2lvbjogJzEuMCcsXG4gICAgICBkb21haW5DcmVkZW50aWFsczoge1xuICAgICAgICAnZXhhbXBsZS5jb20nOiB7IHNlY3JldHNNYW5hZ2VyU2VjcmV0SWQ6IHNlY3JldEFybiB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGNvbW1hbmRzID0gY2RrcC5kb2NrZXJDcmVkZW50aWFsc0luc3RhbGxDb21tYW5kcyhjZGtwLkRvY2tlckNyZWRlbnRpYWxVc2FnZS5TWU5USCwgW2NyZWRzXSwgZWMyLk9wZXJhdGluZ1N5c3RlbVR5cGUuTElOVVgpO1xuXG4gICAgZXhwZWN0KGNvbW1hbmRzKS50b0VxdWFsKFtcbiAgICAgICdta2RpciAkSE9NRS8uY2RrJyxcbiAgICAgIGBlY2hvICcke2V4cGVjdGVkQ3JlZHNGaWxlfScgPiAkSE9NRS8uY2RrL2Nkay1kb2NrZXItY3JlZHMuanNvbmAsXG4gICAgXSk7XG4gIH0pO1xuXG4gIHRlc3QoJ1dpbmRvd3MgY29tbWFuZHMnLCAoKSA9PiB7XG4gICAgY29uc3QgY3JlZHMgPSBjZGtwLkRvY2tlckNyZWRlbnRpYWwuY3VzdG9tUmVnaXN0cnkoJ2V4YW1wbGUuY29tJywgc2VjcmV0KTtcbiAgICBjb25zdCBleHBlY3RlZENyZWRzRmlsZSA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIHZlcnNpb246ICcxLjAnLFxuICAgICAgZG9tYWluQ3JlZGVudGlhbHM6IHtcbiAgICAgICAgJ2V4YW1wbGUuY29tJzogeyBzZWNyZXRzTWFuYWdlclNlY3JldElkOiBzZWNyZXRBcm4gfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBjb21tYW5kcyA9IGNka3AuZG9ja2VyQ3JlZGVudGlhbHNJbnN0YWxsQ29tbWFuZHMoY2RrcC5Eb2NrZXJDcmVkZW50aWFsVXNhZ2UuU1lOVEgsIFtjcmVkc10sIGVjMi5PcGVyYXRpbmdTeXN0ZW1UeXBlLldJTkRPV1MpO1xuXG4gICAgZXhwZWN0KGNvbW1hbmRzKS50b0VxdWFsKFtcbiAgICAgICdta2RpciAlVVNFUlBST0ZJTEUlXFxcXC5jZGsnLFxuICAgICAgYGVjaG8gJyR7ZXhwZWN0ZWRDcmVkc0ZpbGV9JyA+ICVVU0VSUFJPRklMRSVcXFxcLmNka1xcXFxjZGstZG9ja2VyLWNyZWRzLmpzb25gLFxuICAgIF0pO1xuICB9KTtcbn0pO1xuIl19