"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../lib");
const aws_entities_1 = require("../lib/aws-entities");
describe('find', () => {
    test('returns undefined for an unknown fact', () => {
        expect(lib_1.Fact.find(aws_entities_1.AWS_REGIONS[0], 'not:a:known:fact')).toBe(undefined);
    });
    test('returns undefined for an unknown region', () => {
        expect(lib_1.Fact.find('bermuda-triangle-42', lib_1.FactName.PARTITION)).toBe(undefined);
    });
});
describe('requireFact', () => {
    test('throws error for an unknown fact', () => {
        expect(() => lib_1.Fact.requireFact(aws_entities_1.AWS_REGIONS[0], 'not:a:known:fact')).toThrowError();
    });
    test('throws error for an unknown region', () => {
        expect(() => lib_1.Fact.requireFact('bermuda-triangle-42', lib_1.FactName.PARTITION)).toThrowError();
    });
});
describe('register', () => {
    test('allows registering an arbitrary fact', () => {
        // GIVEN
        const region = aws_entities_1.AWS_REGIONS[0];
        const name = 'my:custom:fact';
        const value = '1337';
        // WHEN
        expect(lib_1.Fact.find(region, name)).toBe(undefined);
        expect(() => lib_1.Fact.register({ region, name, value })).not.toThrowError();
        // THEN
        expect(lib_1.Fact.find(region, name)).toBe(value);
        // Cleanup
        lib_1.Fact.unregister(region, name);
    });
    test('allows re-registering a fact with the same value', () => {
        // GIVEN
        const region = aws_entities_1.AWS_REGIONS[0];
        const name = 'my:custom:fact';
        const value = '1337';
        // WHEN
        expect(lib_1.Fact.find(region, name)).toBe(undefined);
        expect(() => lib_1.Fact.register({ region, name, value })).not.toThrowError();
        // THEN
        expect(() => lib_1.Fact.register({ region, name, value })).not.toThrowError();
        expect(lib_1.Fact.find(region, name)).toBe(value);
        // Cleanup
        lib_1.Fact.unregister(region, name);
    });
    test('disallows re-registering a fact with a different value', () => {
        // GIVEN
        const region = aws_entities_1.AWS_REGIONS[0];
        const name = lib_1.FactName.PARTITION;
        const value = '1337';
        // WHEN
        expect(lib_1.Fact.find(region, name)).not.toBe(value);
        // THEN
        expect(() => lib_1.Fact.register({ region, name, value }))
            .toThrowError(/already has a fact/);
    });
    test('allows overriding an arbitrary fact', () => {
        // GIVEN
        const region = aws_entities_1.AWS_REGIONS[0];
        const name = 'my:custom:fact';
        const value = '1337';
        // WHEN
        expect(lib_1.Fact.find(region, name)).toBe(undefined);
        expect(() => lib_1.Fact.register({ region, name, value })).not.toThrowError();
        expect(lib_1.Fact.find(region, name)).toBe(value);
        // THEN
        expect(() => lib_1.Fact.register({ region, name, value: 'Foo' }, true)).not.toThrowError();
        expect(lib_1.Fact.find(region, name)).toBe('Foo');
        // Cleanup
        lib_1.Fact.unregister(region, name);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFjdC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZmFjdC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsZ0NBQXdDO0FBQ3hDLHNEQUFrRDtBQUVsRCxRQUFRLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRTtJQUNwQixJQUFJLENBQUMsdUNBQXVDLEVBQUUsR0FBRyxFQUFFO1FBQ2pELE1BQU0sQ0FBQyxVQUFJLENBQUMsSUFBSSxDQUFDLDBCQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN4RSxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7UUFDbkQsTUFBTSxDQUFDLFVBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsY0FBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQy9FLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtJQUMzQixJQUFJLENBQUMsa0NBQWtDLEVBQUUsR0FBRyxFQUFFO1FBQzVDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxVQUFJLENBQUMsV0FBVyxDQUFDLDBCQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3BGLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtRQUM5QyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsVUFBSSxDQUFDLFdBQVcsQ0FBQyxxQkFBcUIsRUFBRSxjQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUMzRixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FB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TUFBTSxHQUFHLDBCQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsTUFBTSxJQUFJLEdBQUcsZ0JBQWdCLENBQUM7UUFDOUIsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDO1FBRXJCLE9BQU87UUFDUCxNQUFNLENBQUMsVUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDaEQsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLFVBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDeEUsTUFBTSxDQUFDLFVBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRTVDLE9BQU87UUFDUCxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsVUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3JGLE1BQU0sQ0FBQyxVQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUU1QyxVQUFVO1FBQ1YsVUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZhY3QsIEZhY3ROYW1lIH0gZnJvbSAnLi4vbGliJztcbmltcG9ydCB7IEFXU19SRUdJT05TIH0gZnJvbSAnLi4vbGliL2F3cy1lbnRpdGllcyc7XG5cbmRlc2NyaWJlKCdmaW5kJywgKCkgPT4ge1xuICB0ZXN0KCdyZXR1cm5zIHVuZGVmaW5lZCBmb3IgYW4gdW5rbm93biBmYWN0JywgKCkgPT4ge1xuICAgIGV4cGVjdChGYWN0LmZpbmQoQVdTX1JFR0lPTlNbMF0sICdub3Q6YTprbm93bjpmYWN0JykpLnRvQmUodW5kZWZpbmVkKTtcbiAgfSk7XG5cbiAgdGVzdCgncmV0dXJucyB1bmRlZmluZWQgZm9yIGFuIHVua25vd24gcmVnaW9uJywgKCkgPT4ge1xuICAgIGV4cGVjdChGYWN0LmZpbmQoJ2Jlcm11ZGEtdHJpYW5nbGUtNDInLCBGYWN0TmFtZS5QQVJUSVRJT04pKS50b0JlKHVuZGVmaW5lZCk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdyZXF1aXJlRmFjdCcsICgpID0+IHtcbiAgdGVzdCgndGhyb3dzIGVycm9yIGZvciBhbiB1bmtub3duIGZhY3QnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IEZhY3QucmVxdWlyZUZhY3QoQVdTX1JFR0lPTlNbMF0sICdub3Q6YTprbm93bjpmYWN0JykpLnRvVGhyb3dFcnJvcigpO1xuICB9KTtcblxuICB0ZXN0KCd0aHJvd3MgZXJyb3IgZm9yIGFuIHVua25vd24gcmVnaW9uJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiBGYWN0LnJlcXVpcmVGYWN0KCdiZXJtdWRhLXRyaWFuZ2xlLTQyJywgRmFjdE5hbWUuUEFSVElUSU9OKSkudG9UaHJvd0Vycm9yKCk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdyZWdpc3RlcicsICgpID0+IHtcbiAgdGVzdCgnYWxsb3dzIHJlZ2lzdGVyaW5nIGFuIGFyYml0cmFyeSBmYWN0JywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgcmVnaW9uID0gQVdTX1JFR0lPTlNbMF07XG4gICAgY29uc3QgbmFtZSA9ICdteTpjdXN0b206ZmFjdCc7XG4gICAgY29uc3QgdmFsdWUgPSAnMTMzNyc7XG5cbiAgICAvLyBXSEVOXG4gICAgZXhwZWN0KEZhY3QuZmluZChyZWdpb24sIG5hbWUpKS50b0JlKHVuZGVmaW5lZCk7XG4gICAgZXhwZWN0KCgpID0+IEZhY3QucmVnaXN0ZXIoeyByZWdpb24sIG5hbWUsIHZhbHVlIH0pKS5ub3QudG9UaHJvd0Vycm9yKCk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KEZhY3QuZmluZChyZWdpb24sIG5hbWUpKS50b0JlKHZhbHVlKTtcblxuICAgIC8vIENsZWFudXBcbiAgICBGYWN0LnVucmVnaXN0ZXIocmVnaW9uLCBuYW1lKTtcbiAgfSk7XG5cbiAgdGVzdCgnYWxsb3dzIHJlLXJlZ2lzdGVyaW5nIGEgZmFjdCB3aXRoIHRoZSBzYW1lIHZhbHVlJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgcmVnaW9uID0gQVdTX1JFR0lPTlNbMF07XG4gICAgY29uc3QgbmFtZSA9ICdteTpjdXN0b206ZmFjdCc7XG4gICAgY29uc3QgdmFsdWUgPSAnMTMzNyc7XG5cbiAgICAvLyBXSEVOXG4gICAgZXhwZWN0KEZhY3QuZmluZChyZWdpb24sIG5hbWUpKS50b0JlKHVuZGVmaW5lZCk7XG4gICAgZXhwZWN0KCgpID0+IEZhY3QucmVnaXN0ZXIoeyByZWdpb24sIG5hbWUsIHZhbHVlIH0pKS5ub3QudG9UaHJvd0Vycm9yKCk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KCgpID0+IEZhY3QucmVnaXN0ZXIoeyByZWdpb24sIG5hbWUsIHZhbHVlIH0pKS5ub3QudG9UaHJvd0Vycm9yKCk7XG4gICAgZXhwZWN0KEZhY3QuZmluZChyZWdpb24sIG5hbWUpKS50b0JlKHZhbHVlKTtcblxuICAgIC8vIENsZWFudXBcbiAgICBGYWN0LnVucmVnaXN0ZXIocmVnaW9uLCBuYW1lKTtcbiAgfSk7XG5cbiAgdGVzdCgnZGlzYWxsb3dzIHJlLXJlZ2lzdGVyaW5nIGEgZmFjdCB3aXRoIGEgZGlmZmVyZW50IHZhbHVlJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3QgcmVnaW9uID0gQVdTX1JFR0lPTlNbMF07XG4gICAgY29uc3QgbmFtZSA9IEZhY3ROYW1lLlBBUlRJVElPTjtcbiAgICBjb25zdCB2YWx1ZSA9ICcxMzM3JztcblxuICAgIC8vIFdIRU5cbiAgICBleHBlY3QoRmFjdC5maW5kKHJlZ2lvbiwgbmFtZSkpLm5vdC50b0JlKHZhbHVlKTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoKCkgPT4gRmFjdC5yZWdpc3Rlcih7IHJlZ2lvbiwgbmFtZSwgdmFsdWUgfSkpXG4gICAgICAudG9UaHJvd0Vycm9yKC9hbHJlYWR5IGhhcyBhIGZhY3QvKTtcbiAgfSk7XG5cbiAgdGVzdCgnYWxsb3dzIG92ZXJyaWRpbmcgYW4gYXJiaXRyYXJ5IGZhY3QnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCByZWdpb24gPSBBV1NfUkVHSU9OU1swXTtcbiAgICBjb25zdCBuYW1lID0gJ215OmN1c3RvbTpmYWN0JztcbiAgICBjb25zdCB2YWx1ZSA9ICcxMzM3JztcblxuICAgIC8vIFdIRU5cbiAgICBleHBlY3QoRmFjdC5maW5kKHJlZ2lvbiwgbmFtZSkpLnRvQmUodW5kZWZpbmVkKTtcbiAgICBleHBlY3QoKCkgPT4gRmFjdC5yZWdpc3Rlcih7IHJlZ2lvbiwgbmFtZSwgdmFsdWUgfSkpLm5vdC50b1Rocm93RXJyb3IoKTtcbiAgICBleHBlY3QoRmFjdC5maW5kKHJlZ2lvbiwgbmFtZSkpLnRvQmUodmFsdWUpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdCgoKSA9PiBGYWN0LnJlZ2lzdGVyKHsgcmVnaW9uLCBuYW1lLCB2YWx1ZTogJ0ZvbycgfSwgdHJ1ZSkpLm5vdC50b1Rocm93RXJyb3IoKTtcbiAgICBleHBlY3QoRmFjdC5maW5kKHJlZ2lvbiwgbmFtZSkpLnRvQmUoJ0ZvbycpO1xuXG4gICAgLy8gQ2xlYW51cFxuICAgIEZhY3QudW5yZWdpc3RlcihyZWdpb24sIG5hbWUpO1xuICB9KTtcbn0pO1xuIl19