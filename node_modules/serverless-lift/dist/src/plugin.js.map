{
  "version": 3,
  "sources": ["../../src/plugin.ts"],
  "sourcesContent": ["import { flatten, get, has, merge } from \"lodash\";\nimport type { AwsIamPolicyStatements } from \"@serverless/typescript\";\nimport * as path from \"path\";\nimport { readFileSync } from \"fs\";\nimport { dump } from \"js-yaml\";\nimport { DefaultTokenResolver, Lazy, StringConcat, Tokenization } from \"aws-cdk-lib\";\nimport type { FromSchema } from \"json-schema-to-ts\";\nimport type { ProviderInterface, StaticProviderInterface } from \"@lift/providers\";\nimport { AwsProvider, StripeProvider } from \"@lift/providers\";\nimport type { ConstructInterface, StaticConstructInterface } from \"@lift/constructs\";\nimport chalk from \"chalk\";\nimport type {\n    CommandsDefinition,\n    DeprecatedVariableResolver,\n    Hook,\n    Serverless,\n    VariableResolver,\n} from \"./types/serverless\";\nimport type { ServerlessUtils } from \"./utils/logger\";\nimport { getUtils, setUtils } from \"./utils/logger\";\nimport ServerlessError from \"./utils/error\";\n\nconst PROVIDER_ID_PATTERN = \"^[a-zA-Z0-9-_]+$\";\n// This enables all existing constructs defined prior intoduction of \"providers\" property to work\nconst DEFAULT_PROVIDER = \"defaultAwsProvider\";\nconst PROVIDERS_DEFINITION = {\n    type: \"object\",\n    patternProperties: {\n        [PROVIDER_ID_PATTERN]: {\n            allOf: [\n                {\n                    type: \"object\",\n                    properties: {\n                        type: { type: \"string\" },\n                    },\n                    required: [\"type\"],\n                },\n            ] as Record<string, unknown>[],\n        },\n    },\n    additionalProperties: false,\n};\n\nconst CONSTRUCT_ID_PATTERN = \"^[a-zA-Z0-9-_]+$\";\nconst CONSTRUCTS_DEFINITION = {\n    type: \"object\",\n    patternProperties: {\n        [CONSTRUCT_ID_PATTERN]: {\n            allOf: [\n                {\n                    type: \"object\",\n                    properties: {\n                        type: { type: \"string\" },\n                        provider: { type: \"string\" },\n                        extensions: { type: \"object\" },\n                    },\n                    required: [\"type\"],\n                },\n            ],\n        },\n    },\n    additionalProperties: false,\n} as const;\n\nconst LIFT_CONFIG_SCHEMA = {\n    type: \"object\",\n    properties: {\n        automaticPermissions: { type: \"boolean\" },\n    },\n    additionalProperties: false,\n} as const;\ntype LiftConfig = FromSchema<typeof LIFT_CONFIG_SCHEMA>;\n\n/**\n * Serverless plugin\n */\nclass LiftPlugin {\n    private constructs?: Record<string, ConstructInterface>;\n    private providers: Record<string, ProviderInterface>;\n    private readonly serverless: Serverless;\n    private static readonly providerClasses: Record<string, StaticProviderInterface> = {};\n    private readonly providersSchema = PROVIDERS_DEFINITION;\n    private readonly constructsSchema = CONSTRUCTS_DEFINITION;\n    public readonly hooks: Record<string, Hook>;\n    public readonly commands: CommandsDefinition = {};\n    public readonly configurationVariablesSources: Record<string, VariableResolver>;\n    public readonly variableResolvers: Record<string, DeprecatedVariableResolver>;\n    private readonly cliOptions: Record<string, string>;\n\n    constructor(serverless: Serverless, cliOptions: Record<string, string>, utils?: ServerlessUtils) {\n        this.serverless = serverless;\n        setUtils(utils);\n\n        // This method is exposed for Lift tests only, it is not a public API\n        Object.assign(this.serverless, { getLiftProviderById: this.getLiftProviderById.bind(this) });\n        this.cliOptions = cliOptions;\n\n        this.commands.lift = {\n            commands: {\n                eject: {\n                    usage: \"Eject Lift constructs to raw CloudFormation\",\n                    lifecycleEvents: [\"eject\"],\n                },\n            },\n        };\n\n        this.hooks = {\n            initialize: () => {\n                this.loadConstructs();\n                this.appendPermissions();\n                this.resolveLazyVariables();\n            },\n            \"before:aws:info:displayStackOutputs\": this.info.bind(this),\n            \"after:package:compileEvents\": this.appendCloudformationResources.bind(this),\n            \"after:deploy:deploy\": this.postDeploy.bind(this),\n            \"before:remove:remove\": this.preRemove.bind(this),\n            \"lift:eject:eject\": this.eject.bind(this),\n        };\n\n        this.configurationVariablesSources = {\n            construct: {\n                resolve: this.resolveReference.bind(this),\n            },\n        };\n        this.variableResolvers = {\n            construct: (fullVariable) => {\n                const address = fullVariable.split(\":\")[1];\n\n                return Promise.resolve(this.resolveReference({ address }).value);\n            },\n        };\n\n        this.providers = { [DEFAULT_PROVIDER]: new AwsProvider(this.serverless) };\n        this.loadProviders();\n        this.registerConstructsSchema();\n        this.registerProvidersSchema();\n        this.registerConfigSchema();\n        this.registerCommands();\n    }\n\n    private registerConstructsSchema() {\n        (\n            this.constructsSchema.patternProperties[CONSTRUCT_ID_PATTERN].allOf as unknown as Record<string, unknown>[]\n        ).push({\n            oneOf: this.getAllConstructClasses().map((Construct) => {\n                return merge(this.defineSchemaWithType(Construct.type, Construct.schema), {\n                    properties: { extensions: { type: \"object\" } },\n                });\n            }),\n        });\n    }\n\n    private registerProvidersSchema() {\n        this.providersSchema.patternProperties[PROVIDER_ID_PATTERN].allOf.push({\n            oneOf: LiftPlugin.getAllProviderClasses().map((Provider) => {\n                return this.defineSchemaWithType(Provider.type, Provider.schema);\n            }),\n        });\n    }\n\n    private defineSchemaWithType(type: string, configSchema: Record<string, unknown>): Record<string, unknown> {\n        return merge({}, configSchema, { properties: { type: { const: type } } });\n    }\n\n    private registerConfigSchema() {\n        this.serverless.configSchemaHandler.defineTopLevelProperty(\"lift\", LIFT_CONFIG_SCHEMA);\n        this.serverless.configSchemaHandler.defineTopLevelProperty(\"constructs\", this.constructsSchema);\n        this.serverless.configSchemaHandler.defineTopLevelProperty(\"providers\", this.providersSchema);\n    }\n\n    static registerProviders(...providerClasses: StaticProviderInterface[]): void {\n        for (const providerClass of providerClasses) {\n            if (providerClass.type in this.providerClasses) {\n                throw new ServerlessError(\n                    `The provider type '${providerClass.type}' was registered twice`,\n                    \"LIFT_PROVIDER_TYPE_CONFLICT\"\n                );\n            }\n            this.providerClasses[providerClass.type] = providerClass;\n        }\n    }\n\n    static getProviderClass(type: string): StaticProviderInterface | undefined {\n        return this.providerClasses[type];\n    }\n\n    static getAllProviderClasses(): StaticProviderInterface[] {\n        return Object.values(this.providerClasses);\n    }\n\n    private loadProviders() {\n        const providersInputConfiguration = get(this.serverless.configurationInput, \"providers\", {});\n        for (const [id, { type }] of Object.entries(providersInputConfiguration)) {\n            this.providers[id] = this.createProvider(type, id);\n        }\n    }\n\n    private createProvider(type: string, id: string): ProviderInterface {\n        if (type === AwsProvider.type) {\n            throw new ServerlessError(\n                \"AwsProvider is not configurable via providers\",\n                \"LIFT_AWS_PROVIDER_CONFIGURATION\"\n            );\n        }\n        const Provider = LiftPlugin.getProviderClass(type);\n        if (Provider === undefined) {\n            throw new ServerlessError(\n                `The provider '${id}' has an unknown type '${type}'`,\n                \"LIFT_UNKNOWN_PROVIDER_TYPE\"\n            );\n        }\n        const configuration = get(this.serverless.configurationInput.providers, id, {});\n\n        return Provider.create(this.serverless, id, configuration);\n    }\n\n    private loadConstructs(): void {\n        if (this.constructs !== undefined) {\n            // Safeguard\n            throw new Error(\"Constructs are already initialized: this should not happen\");\n        }\n        this.constructs = {};\n        const constructsInputConfiguration = get(this.serverless.configurationInput, \"constructs\", {});\n        for (const [id, { type, provider: providerId }] of Object.entries(constructsInputConfiguration)) {\n            // Legacy behavior -> defaults to Serverless framework AWS provider\n            if (providerId === undefined) {\n                this.constructs[id] = this.providers[DEFAULT_PROVIDER].createConstruct(type, id);\n                continue;\n            }\n            const provider = this.getLiftProviderById(providerId);\n            if (!provider) {\n                throw new ServerlessError(\n                    `No provider ${providerId} was found for construct ${id}. Available providers are ${Object.keys(\n                        this.providers\n                    ).join(\", \")}`,\n                    \"LIFT_UNKNOWN_PROVIDER_ID\"\n                );\n            }\n            this.constructs[id] = provider.createConstruct(type, id);\n        }\n    }\n\n    private getConstructs(): Record<string, ConstructInterface> {\n        if (this.constructs === undefined) {\n            // Safeguard\n            throw new Error(\"Constructs are not initialized: this should not happen\");\n        }\n\n        return this.constructs;\n    }\n\n    getLiftProviderById(id: string): ProviderInterface | undefined {\n        return this.providers[id];\n    }\n\n    resolveReference({ address }: { address: string }): { value: string } {\n        return {\n            /**\n             * Construct variables are resolved lazily using the CDK's \"Token\" system.\n             * CDK Lazy values generate a unique `${Token[TOKEN.63]}` string. These strings\n             * can later be resolved to the real value (which we do in `initialize()`).\n             * Problem:\n             * - Lift variables need constructs to be resolved\n             * - Constructs can be created when Serverless variables are resolved\n             * - Serverless variables must resolve Lift variables\n             * This is a chicken and egg problem.\n             * Solution:\n             * - Serverless boots, plugins are created\n             * - variables are resolved\n             *   - Lift variables are resolved to CDK tokens (`${Token[TOKEN.63]}`) via `Lazy.any(...)`\n             *     (we can't resolve the actual values since we don't have the constructs yet)\n             * - `initialize` hook\n             *   - Lift builds the constructs\n             *   - CDK tokens are resolved into real value: we can now do that using the CDK \"token resolver\"\n             */\n            value: Lazy.any({\n                produce: () => {\n                    const constructs = this.getConstructs();\n                    const [id, property] = address.split(\".\", 2);\n                    if (!has(this.constructs, id)) {\n                        throw new ServerlessError(\n                            `No construct named '${id}' was found, the \\${construct:${id}.${property}} variable is invalid.`,\n                            \"LIFT_VARIABLE_UNKNOWN_CONSTRUCT\"\n                        );\n                    }\n                    const construct = constructs[id];\n\n                    const properties = construct.variables ? construct.variables() : {};\n                    if (!has(properties, property)) {\n                        if (Object.keys(properties).length === 0) {\n                            throw new ServerlessError(\n                                `\\${construct:${id}.${property}} does not exist. The construct '${id}' does not expose any property`,\n                                \"LIFT_VARIABLE_UNKNOWN_PROPERTY\"\n                            );\n                        }\n                        throw new ServerlessError(\n                            `\\${construct:${id}.${property}} does not exist. Properties available on \\${construct:${id}} are: ${Object.keys(\n                                properties\n                            ).join(\", \")}`,\n                            \"LIFT_VARIABLE_UNKNOWN_PROPERTY\"\n                        );\n                    }\n\n                    return properties[property];\n                },\n            }).toString(),\n        };\n    }\n\n    async info(): Promise<void> {\n        const constructs = this.getConstructs();\n        for (const [id, construct] of Object.entries(constructs)) {\n            if (typeof construct.outputs !== \"function\") {\n                continue;\n            }\n            const outputs = construct.outputs();\n            if (Object.keys(outputs).length === 1) {\n                const resolver = Object.values(outputs)[0];\n                const output = await resolver();\n                if (output !== undefined) {\n                    if (this.serverless.addServiceOutputSection) {\n                        this.serverless.addServiceOutputSection(id, output);\n                    } else {\n                        console.log(`${chalk.yellow(`${id}:`)} ${output}`);\n                    }\n                }\n            }\n            if (Object.keys(outputs).length > 1) {\n                const content: string[] = [];\n                for (const [name, resolver] of Object.entries(outputs)) {\n                    const output = await resolver();\n                    if (output !== undefined) {\n                        content.push(`${name}: ${output}`);\n                    }\n                }\n                if (this.serverless.addServiceOutputSection) {\n                    this.serverless.addServiceOutputSection(id, content);\n                } else {\n                    console.log(chalk.yellow(`${id}:`));\n                    console.log(content.map((line) => `  ${line}`).join(`\\n`));\n                }\n            }\n        }\n    }\n\n    private registerCommands() {\n        const constructsConfiguration = get(this.serverless.configurationInput, \"constructs\", {}) as Record<\n            string,\n            { type?: string }\n        >;\n        // For each construct\n        for (const [id, constructConfig] of Object.entries(constructsConfiguration)) {\n            if (constructConfig.type === undefined) {\n                throw new ServerlessError(\n                    `The construct '${id}' has no 'type' defined.\\n` +\n                        \"Find all construct types available here: https://github.com/getlift/lift#constructs\",\n                    \"LIFT_MISSING_CONSTRUCT_TYPE\"\n                );\n            }\n            const constructClass = this.getConstructClass(constructConfig.type);\n            if (constructClass === undefined) {\n                throw new ServerlessError(\n                    `The construct '${id}' has an unknown type '${constructConfig.type}'\\n` +\n                        \"Find all construct types available here: https://github.com/getlift/lift#constructs\",\n                    \"LIFT_UNKNOWN_CONSTRUCT_TYPE\"\n                );\n            }\n            if (constructClass.commands === undefined) {\n                continue;\n            }\n            // For each command of the construct\n            for (const [command, commandDefinition] of Object.entries(constructClass.commands)) {\n                this.commands[`${id}:${command}`] = {\n                    lifecycleEvents: [command],\n                    usage: commandDefinition.usage,\n                    options: commandDefinition.options,\n                };\n                // Register the command handler\n                this.hooks[`${id}:${command}:${command}`] = () => {\n                    // We resolve the construct instance on the fly\n                    const construct = this.getConstructs()[id];\n\n                    return commandDefinition.handler.call(construct, this.cliOptions);\n                };\n            }\n        }\n    }\n\n    private async postDeploy(): Promise<void> {\n        const constructs = this.getConstructs();\n        for (const [, construct] of Object.entries(constructs)) {\n            if (construct.postDeploy !== undefined) {\n                await construct.postDeploy();\n            }\n        }\n    }\n\n    private async preRemove(): Promise<void> {\n        const constructs = this.getConstructs();\n        for (const [, construct] of Object.entries(constructs)) {\n            if (construct.preRemove !== undefined) {\n                await construct.preRemove();\n            }\n        }\n    }\n\n    private resolveLazyVariables() {\n        // Use the CDK token resolver to resolve all lazy variables in the template\n        const tokenResolver = new DefaultTokenResolver(new StringConcat());\n        const resolveTokens = <T>(input: T): T => {\n            if (input === undefined) {\n                return input;\n            }\n\n            return Tokenization.resolve(input, {\n                resolver: tokenResolver,\n                scope: (this.providers[DEFAULT_PROVIDER] as AwsProvider).stack,\n            }) as T;\n        };\n        this.serverless.service.provider = resolveTokens(this.serverless.service.provider);\n        this.serverless.service.package = resolveTokens(this.serverless.service.package);\n        this.serverless.service.custom = resolveTokens(this.serverless.service.custom);\n        this.serverless.service.resources = resolveTokens(this.serverless.service.resources);\n        this.serverless.service.functions = resolveTokens(this.serverless.service.functions);\n        this.serverless.service.layers = resolveTokens(this.serverless.service.layers);\n        this.serverless.service.outputs = resolveTokens(this.serverless.service.outputs);\n        // Also resolve tokens in `configurationInput` because they also appear in there\n        this.serverless.configurationInput = resolveTokens(this.serverless.configurationInput);\n    }\n\n    // This is only required for AwsProvider in order to bundle resources together with existing SLS framework resources\n    private appendCloudformationResources() {\n        (this.providers[DEFAULT_PROVIDER] as AwsProvider).appendCloudformationResources();\n    }\n\n    private appendPermissions(): void {\n        // Automatic permissions can be disabled via a `lift.automaticPermissions` flag in serverless.yml\n        const liftConfiguration = get(this.serverless.configurationInput, \"lift\", {}) as LiftConfig;\n        if (liftConfiguration.automaticPermissions === false) {\n            return;\n        }\n\n        const constructs = this.getConstructs();\n        const statements = flatten(\n            Object.entries(constructs).map(([, construct]) => {\n                return (construct.permissions ? construct.permissions() : []) as unknown as AwsIamPolicyStatements;\n            })\n        );\n        if (statements.length === 0) {\n            return;\n        }\n\n        const role = this.serverless.service.provider.iam?.role;\n\n        if (typeof role === \"object\" && \"statements\" in role) {\n            role.statements?.push(...statements);\n\n            return;\n        }\n\n        this.serverless.service.provider.iamRoleStatements = this.serverless.service.provider.iamRoleStatements ?? [];\n        this.serverless.service.provider.iamRoleStatements.push(...statements);\n    }\n\n    private async eject() {\n        getUtils().log(\"Ejecting from Lift to CloudFormation\");\n        getUtils().log();\n        await this.serverless.pluginManager.spawn(\"package\");\n        const legacyProvider = this.serverless.getProvider(\"aws\");\n        const compiledTemplateFileName = legacyProvider.naming.getCompiledTemplateFileName();\n        const compiledTemplateFilePath = path.join(this.serverless.serviceDir, \".serverless\", compiledTemplateFileName);\n        const cfTemplate = readFileSync(compiledTemplateFilePath);\n        const formattedYaml = dump(JSON.parse(cfTemplate.toString()));\n        getUtils().writeText(formattedYaml);\n        getUtils().log(\"You can also find that CloudFormation template in the following file:\");\n        getUtils().log(compiledTemplateFilePath);\n    }\n\n    private getAllConstructClasses(): StaticConstructInterface[] {\n        const result = flatten(\n            LiftPlugin.getAllProviderClasses().map((providerClass) => providerClass.getAllConstructClasses())\n        );\n\n        return result;\n    }\n\n    private getConstructClass(constructType: string): StaticConstructInterface | undefined {\n        for (const providerClass of LiftPlugin.getAllProviderClasses()) {\n            const constructClass = providerClass.getConstructClass(constructType);\n            if (constructClass !== undefined) {\n                return constructClass;\n            }\n        }\n\n        return undefined;\n    }\n}\n\nexport type Lift = Partial<{\n    constructs: FromSchema<typeof CONSTRUCTS_DEFINITION>;\n    lift: FromSchema<typeof LIFT_CONFIG_SCHEMA>;\n}>;\n\nLiftPlugin.registerProviders(AwsProvider, StripeProvider);\n\nmodule.exports = LiftPlugin;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA,oBAAyC;AAEzC,WAAsB;AACtB,gBAA6B;AAC7B,qBAAqB;AACrB,yBAAuE;AAGvE,uBAA4C;AAE5C,mBAAkB;AASlB,oBAAmC;AACnC,mBAA4B;AAE5B,MAAM,sBAAsB;AAE5B,MAAM,mBAAmB;AACzB,MAAM,uBAAuB;AAAA,EACzB,MAAM;AAAA,EACN,mBAAmB;AAAA,IACf,CAAC,mBAAmB,GAAG;AAAA,MACnB,OAAO;AAAA,QACH;AAAA,UACI,MAAM;AAAA,UACN,YAAY;AAAA,YACR,MAAM,EAAE,MAAM,SAAS;AAAA,UAC3B;AAAA,UACA,UAAU,CAAC,MAAM;AAAA,QACrB;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA,EACA,sBAAsB;AAC1B;AAEA,MAAM,uBAAuB;AAC7B,MAAM,wBAAwB;AAAA,EAC1B,MAAM;AAAA,EACN,mBAAmB;AAAA,IACf,CAAC,oBAAoB,GAAG;AAAA,MACpB,OAAO;AAAA,QACH;AAAA,UACI,MAAM;AAAA,UACN,YAAY;AAAA,YACR,MAAM,EAAE,MAAM,SAAS;AAAA,YACvB,UAAU,EAAE,MAAM,SAAS;AAAA,YAC3B,YAAY,EAAE,MAAM,SAAS;AAAA,UACjC;AAAA,UACA,UAAU,CAAC,MAAM;AAAA,QACrB;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA,EACA,sBAAsB;AAC1B;AAEA,MAAM,qBAAqB;AAAA,EACvB,MAAM;AAAA,EACN,YAAY;AAAA,IACR,sBAAsB,EAAE,MAAM,UAAU;AAAA,EAC5C;AAAA,EACA,sBAAsB;AAC1B;AAMA,MAAM,cAAN,MAAiB;AAAA,EAab,YAAY,YAAwB,YAAoC,OAAyB;AARjG,SAAiB,kBAAkB;AACnC,SAAiB,mBAAmB;AAEpC,SAAgB,WAA+B,CAAC;AAM5C,SAAK,aAAa;AAClB,gCAAS,KAAK;AAGd,WAAO,OAAO,KAAK,YAAY,EAAE,qBAAqB,KAAK,oBAAoB,KAAK,IAAI,EAAE,CAAC;AAC3F,SAAK,aAAa;AAElB,SAAK,SAAS,OAAO;AAAA,MACjB,UAAU;AAAA,QACN,OAAO;AAAA,UACH,OAAO;AAAA,UACP,iBAAiB,CAAC,OAAO;AAAA,QAC7B;AAAA,MACJ;AAAA,IACJ;AAEA,SAAK,QAAQ;AAAA,MACT,YAAY,MAAM;AACd,aAAK,eAAe;AACpB,aAAK,kBAAkB;AACvB,aAAK,qBAAqB;AAAA,MAC9B;AAAA,MACA,uCAAuC,KAAK,KAAK,KAAK,IAAI;AAAA,MAC1D,+BAA+B,KAAK,8BAA8B,KAAK,IAAI;AAAA,MAC3E,uBAAuB,KAAK,WAAW,KAAK,IAAI;AAAA,MAChD,wBAAwB,KAAK,UAAU,KAAK,IAAI;AAAA,MAChD,oBAAoB,KAAK,MAAM,KAAK,IAAI;AAAA,IAC5C;AAEA,SAAK,gCAAgC;AAAA,MACjC,WAAW;AAAA,QACP,SAAS,KAAK,iBAAiB,KAAK,IAAI;AAAA,MAC5C;AAAA,IACJ;AACA,SAAK,oBAAoB;AAAA,MACrB,WAAW,CAAC,iBAAiB;AACzB,cAAM,UAAU,aAAa,MAAM,GAAG,EAAE,CAAC;AAEzC,eAAO,QAAQ,QAAQ,KAAK,iBAAiB,EAAE,QAAQ,CAAC,EAAE,KAAK;AAAA,MACnE;AAAA,IACJ;AAEA,SAAK,YAAY,EAAE,CAAC,gBAAgB,GAAG,IAAI,6BAAY,KAAK,UAAU,EAAE;AACxE,SAAK,cAAc;AACnB,SAAK,yBAAyB;AAC9B,SAAK,wBAAwB;AAC7B,SAAK,qBAAqB;AAC1B,SAAK,iBAAiB;AAAA,EAC1B;AAAA,EAEQ,2BAA2B;AAC/B,IACI,KAAK,iBAAiB,kBAAkB,oBAAoB,EAAE,MAChE,KAAK;AAAA,MACH,OAAO,KAAK,uBAAuB,EAAE,IAAI,CAAC,cAAc;AACpD,mBAAO,qBAAM,KAAK,qBAAqB,UAAU,MAAM,UAAU,MAAM,GAAG;AAAA,UACtE,YAAY,EAAE,YAAY,EAAE,MAAM,SAAS,EAAE;AAAA,QACjD,CAAC;AAAA,MACL,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AAAA,EAEQ,0BAA0B;AAC9B,SAAK,gBAAgB,kBAAkB,mBAAmB,EAAE,MAAM,KAAK;AAAA,MACnE,OAAO,YAAW,sBAAsB,EAAE,IAAI,CAAC,aAAa;AACxD,eAAO,KAAK,qBAAqB,SAAS,MAAM,SAAS,MAAM;AAAA,MACnE,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AAAA,EAEQ,qBAAqB,MAAc,cAAgE;AACvG,eAAO,qBAAM,CAAC,GAAG,cAAc,EAAE,YAAY,EAAE,MAAM,EAAE,OAAO,KAAK,EAAE,EAAE,CAAC;AAAA,EAC5E;AAAA,EAEQ,uBAAuB;AAC3B,SAAK,WAAW,oBAAoB,uBAAuB,QAAQ,kBAAkB;AACrF,SAAK,WAAW,oBAAoB,uBAAuB,cAAc,KAAK,gBAAgB;AAC9F,SAAK,WAAW,oBAAoB,uBAAuB,aAAa,KAAK,eAAe;AAAA,EAChG;AAAA,EAEA,OAAO,qBAAqB,iBAAkD;AAC1E,eAAW,iBAAiB,iBAAiB;AACzC,UAAI,cAAc,QAAQ,KAAK,iBAAiB;AAC5C,cAAM,IAAI,aAAAA;AAAA,UACN,sBAAsB,cAAc;AAAA,UACpC;AAAA,QACJ;AAAA,MACJ;AACA,WAAK,gBAAgB,cAAc,IAAI,IAAI;AAAA,IAC/C;AAAA,EACJ;AAAA,EAEA,OAAO,iBAAiB,MAAmD;AACvE,WAAO,KAAK,gBAAgB,IAAI;AAAA,EACpC;AAAA,EAEA,OAAO,wBAAmD;AACtD,WAAO,OAAO,OAAO,KAAK,eAAe;AAAA,EAC7C;AAAA,EAEQ,gBAAgB;AACpB,UAAM,kCAA8B,mBAAI,KAAK,WAAW,oBAAoB,aAAa,CAAC,CAAC;AAC3F,eAAW,CAAC,IAAI,EAAE,KAAK,CAAC,KAAK,OAAO,QAAQ,2BAA2B,GAAG;AACtE,WAAK,UAAU,EAAE,IAAI,KAAK,eAAe,MAAM,EAAE;AAAA,IACrD;AAAA,EACJ;AAAA,EAEQ,eAAe,MAAc,IAA+B;AAChE,QAAI,SAAS,6BAAY,MAAM;AAC3B,YAAM,IAAI,aAAAA;AAAA,QACN;AAAA,QACA;AAAA,MACJ;AAAA,IACJ;AACA,UAAM,WAAW,YAAW,iBAAiB,IAAI;AACjD,QAAI,aAAa,QAAW;AACxB,YAAM,IAAI,aAAAA;AAAA,QACN,iBAAiB,4BAA4B;AAAA,QAC7C;AAAA,MACJ;AAAA,IACJ;AACA,UAAM,oBAAgB,mBAAI,KAAK,WAAW,mBAAmB,WAAW,IAAI,CAAC,CAAC;AAE9E,WAAO,SAAS,OAAO,KAAK,YAAY,IAAI,aAAa;AAAA,EAC7D;AAAA,EAEQ,iBAAuB;AAC3B,QAAI,KAAK,eAAe,QAAW;AAE/B,YAAM,IAAI,MAAM,4DAA4D;AAAA,IAChF;AACA,SAAK,aAAa,CAAC;AACnB,UAAM,mCAA+B,mBAAI,KAAK,WAAW,oBAAoB,cAAc,CAAC,CAAC;AAC7F,eAAW,CAAC,IAAI,EAAE,MAAM,UAAU,WAAW,CAAC,KAAK,OAAO,QAAQ,4BAA4B,GAAG;AAE7F,UAAI,eAAe,QAAW;AAC1B,aAAK,WAAW,EAAE,IAAI,KAAK,UAAU,gBAAgB,EAAE,gBAAgB,MAAM,EAAE;AAC/E;AAAA,MACJ;AACA,YAAM,WAAW,KAAK,oBAAoB,UAAU;AACpD,UAAI,CAAC,UAAU;AACX,cAAM,IAAI,aAAAA;AAAA,UACN,eAAe,sCAAsC,+BAA+B,OAAO;AAAA,YACvF,KAAK;AAAA,UACT,EAAE,KAAK,IAAI;AAAA,UACX;AAAA,QACJ;AAAA,MACJ;AACA,WAAK,WAAW,EAAE,IAAI,SAAS,gBAAgB,MAAM,EAAE;AAAA,IAC3D;AAAA,EACJ;AAAA,EAEQ,gBAAoD;AACxD,QAAI,KAAK,eAAe,QAAW;AAE/B,YAAM,IAAI,MAAM,wDAAwD;AAAA,IAC5E;AAEA,WAAO,KAAK;AAAA,EAChB;AAAA,EAEA,oBAAoB,IAA2C;AAC3D,WAAO,KAAK,UAAU,EAAE;AAAA,EAC5B;AAAA,EAEA,iBAAiB,EAAE,QAAQ,GAA2C;AAClE,WAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAmBH,OAAO,wBAAK,IAAI;AAAA,QACZ,SAAS,MAAM;AACX,gBAAM,aAAa,KAAK,cAAc;AACtC,gBAAM,CAAC,IAAI,QAAQ,IAAI,QAAQ,MAAM,KAAK,CAAC;AAC3C,cAAI,KAAC,mBAAI,KAAK,YAAY,EAAE,GAAG;AAC3B,kBAAM,IAAI,aAAAA;AAAA,cACN,uBAAuB,mCAAmC,MAAM;AAAA,cAChE;AAAA,YACJ;AAAA,UACJ;AACA,gBAAM,YAAY,WAAW,EAAE;AAE/B,gBAAM,aAAa,UAAU,YAAY,UAAU,UAAU,IAAI,CAAC;AAClE,cAAI,KAAC,mBAAI,YAAY,QAAQ,GAAG;AAC5B,gBAAI,OAAO,KAAK,UAAU,EAAE,WAAW,GAAG;AACtC,oBAAM,IAAI,aAAAA;AAAA,gBACN,gBAAgB,MAAM,4CAA4C;AAAA,gBAClE;AAAA,cACJ;AAAA,YACJ;AACA,kBAAM,IAAI,aAAAA;AAAA,cACN,gBAAgB,MAAM,kEAAkE,YAAY,OAAO;AAAA,gBACvG;AAAA,cACJ,EAAE,KAAK,IAAI;AAAA,cACX;AAAA,YACJ;AAAA,UACJ;AAEA,iBAAO,WAAW,QAAQ;AAAA,QAC9B;AAAA,MACJ,CAAC,EAAE,SAAS;AAAA,IAChB;AAAA,EACJ;AAAA,EAEA,MAAM,OAAsB;AACxB,UAAM,aAAa,KAAK,cAAc;AACtC,eAAW,CAAC,IAAI,SAAS,KAAK,OAAO,QAAQ,UAAU,GAAG;AACtD,UAAI,OAAO,UAAU,YAAY,YAAY;AACzC;AAAA,MACJ;AACA,YAAM,UAAU,UAAU,QAAQ;AAClC,UAAI,OAAO,KAAK,OAAO,EAAE,WAAW,GAAG;AACnC,cAAM,WAAW,OAAO,OAAO,OAAO,EAAE,CAAC;AACzC,cAAM,SAAS,MAAM,SAAS;AAC9B,YAAI,WAAW,QAAW;AACtB,cAAI,KAAK,WAAW,yBAAyB;AACzC,iBAAK,WAAW,wBAAwB,IAAI,MAAM;AAAA,UACtD,OAAO;AACH,oBAAQ,IAAI,GAAG,aAAAC,QAAM,OAAO,GAAG,KAAK,KAAK,QAAQ;AAAA,UACrD;AAAA,QACJ;AAAA,MACJ;AACA,UAAI,OAAO,KAAK,OAAO,EAAE,SAAS,GAAG;AACjC,cAAM,UAAoB,CAAC;AAC3B,mBAAW,CAAC,MAAM,QAAQ,KAAK,OAAO,QAAQ,OAAO,GAAG;AACpD,gBAAM,SAAS,MAAM,SAAS;AAC9B,cAAI,WAAW,QAAW;AACtB,oBAAQ,KAAK,GAAG,SAAS,QAAQ;AAAA,UACrC;AAAA,QACJ;AACA,YAAI,KAAK,WAAW,yBAAyB;AACzC,eAAK,WAAW,wBAAwB,IAAI,OAAO;AAAA,QACvD,OAAO;AACH,kBAAQ,IAAI,aAAAA,QAAM,OAAO,GAAG,KAAK,CAAC;AAClC,kBAAQ,IAAI,QAAQ,IAAI,CAAC,SAAS,KAAK,MAAM,EAAE,KAAK;AAAA,CAAI,CAAC;AAAA,QAC7D;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA,EAEQ,mBAAmB;AACvB,UAAM,8BAA0B,mBAAI,KAAK,WAAW,oBAAoB,cAAc,CAAC,CAAC;AAKxF,eAAW,CAAC,IAAI,eAAe,KAAK,OAAO,QAAQ,uBAAuB,GAAG;AACzE,UAAI,gBAAgB,SAAS,QAAW;AACpC,cAAM,IAAI,aAAAD;AAAA,UACN,kBAAkB;AAAA;AAAA,UAElB;AAAA,QACJ;AAAA,MACJ;AACA,YAAM,iBAAiB,KAAK,kBAAkB,gBAAgB,IAAI;AAClE,UAAI,mBAAmB,QAAW;AAC9B,cAAM,IAAI,aAAAA;AAAA,UACN,kBAAkB,4BAA4B,gBAAgB;AAAA;AAAA,UAE9D;AAAA,QACJ;AAAA,MACJ;AACA,UAAI,eAAe,aAAa,QAAW;AACvC;AAAA,MACJ;AAEA,iBAAW,CAAC,SAAS,iBAAiB,KAAK,OAAO,QAAQ,eAAe,QAAQ,GAAG;AAChF,aAAK,SAAS,GAAG,MAAM,SAAS,IAAI;AAAA,UAChC,iBAAiB,CAAC,OAAO;AAAA,UACzB,OAAO,kBAAkB;AAAA,UACzB,SAAS,kBAAkB;AAAA,QAC/B;AAEA,aAAK,MAAM,GAAG,MAAM,WAAW,SAAS,IAAI,MAAM;AAE9C,gBAAM,YAAY,KAAK,cAAc,EAAE,EAAE;AAEzC,iBAAO,kBAAkB,QAAQ,KAAK,WAAW,KAAK,UAAU;AAAA,QACpE;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA,EAEA,MAAc,aAA4B;AACtC,UAAM,aAAa,KAAK,cAAc;AACtC,eAAW,CAAC,EAAE,SAAS,KAAK,OAAO,QAAQ,UAAU,GAAG;AACpD,UAAI,UAAU,eAAe,QAAW;AACpC,cAAM,UAAU,WAAW;AAAA,MAC/B;AAAA,IACJ;AAAA,EACJ;AAAA,EAEA,MAAc,YAA2B;AACrC,UAAM,aAAa,KAAK,cAAc;AACtC,eAAW,CAAC,EAAE,SAAS,KAAK,OAAO,QAAQ,UAAU,GAAG;AACpD,UAAI,UAAU,cAAc,QAAW;AACnC,cAAM,UAAU,UAAU;AAAA,MAC9B;AAAA,IACJ;AAAA,EACJ;AAAA,EAEQ,uBAAuB;AAE3B,UAAM,gBAAgB,IAAI,wCAAqB,IAAI,gCAAa,CAAC;AACjE,UAAM,gBAAgB,CAAI,UAAgB;AACtC,UAAI,UAAU,QAAW;AACrB,eAAO;AAAA,MACX;AAEA,aAAO,gCAAa,QAAQ,OAAO;AAAA,QAC/B,UAAU;AAAA,QACV,OAAQ,KAAK,UAAU,gBAAgB,EAAkB;AAAA,MAC7D,CAAC;AAAA,IACL;AACA,SAAK,WAAW,QAAQ,WAAW,cAAc,KAAK,WAAW,QAAQ,QAAQ;AACjF,SAAK,WAAW,QAAQ,UAAU,cAAc,KAAK,WAAW,QAAQ,OAAO;AAC/E,SAAK,WAAW,QAAQ,SAAS,cAAc,KAAK,WAAW,QAAQ,MAAM;AAC7E,SAAK,WAAW,QAAQ,YAAY,cAAc,KAAK,WAAW,QAAQ,SAAS;AACnF,SAAK,WAAW,QAAQ,YAAY,cAAc,KAAK,WAAW,QAAQ,SAAS;AACnF,SAAK,WAAW,QAAQ,SAAS,cAAc,KAAK,WAAW,QAAQ,MAAM;AAC7E,SAAK,WAAW,QAAQ,UAAU,cAAc,KAAK,WAAW,QAAQ,OAAO;AAE/E,SAAK,WAAW,qBAAqB,cAAc,KAAK,WAAW,kBAAkB;AAAA,EACzF;AAAA;AAAA,EAGQ,gCAAgC;AACpC,IAAC,KAAK,UAAU,gBAAgB,EAAkB,8BAA8B;AAAA,EACpF;AAAA,EAEQ,oBAA0B;AAnbtC;AAqbQ,UAAM,wBAAoB,mBAAI,KAAK,WAAW,oBAAoB,QAAQ,CAAC,CAAC;AAC5E,QAAI,kBAAkB,yBAAyB,OAAO;AAClD;AAAA,IACJ;AAEA,UAAM,aAAa,KAAK,cAAc;AACtC,UAAM,iBAAa;AAAA,MACf,OAAO,QAAQ,UAAU,EAAE,IAAI,CAAC,CAAC,EAAE,SAAS,MAAM;AAC9C,eAAQ,UAAU,cAAc,UAAU,YAAY,IAAI,CAAC;AAAA,MAC/D,CAAC;AAAA,IACL;AACA,QAAI,WAAW,WAAW,GAAG;AACzB;AAAA,IACJ;AAEA,UAAM,QAAO,UAAK,WAAW,QAAQ,SAAS,QAAjC,mBAAsC;AAEnD,QAAI,OAAO,SAAS,YAAY,gBAAgB,MAAM;AAClD,iBAAK,eAAL,mBAAiB,KAAK,GAAG;AAEzB;AAAA,IACJ;AAEA,SAAK,WAAW,QAAQ,SAAS,qBAAoB,UAAK,WAAW,QAAQ,SAAS,sBAAjC,YAAsD,CAAC;AAC5G,SAAK,WAAW,QAAQ,SAAS,kBAAkB,KAAK,GAAG,UAAU;AAAA,EACzE;AAAA,EAEA,MAAc,QAAQ;AAClB,gCAAS,EAAE,IAAI,sCAAsC;AACrD,gCAAS,EAAE,IAAI;AACf,UAAM,KAAK,WAAW,cAAc,MAAM,SAAS;AACnD,UAAM,iBAAiB,KAAK,WAAW,YAAY,KAAK;AACxD,UAAM,2BAA2B,eAAe,OAAO,4BAA4B;AACnF,UAAM,2BAA2B,KAAK,KAAK,KAAK,WAAW,YAAY,eAAe,wBAAwB;AAC9G,UAAM,iBAAa,wBAAa,wBAAwB;AACxD,UAAM,oBAAgB,qBAAK,KAAK,MAAM,WAAW,SAAS,CAAC,CAAC;AAC5D,gCAAS,EAAE,UAAU,aAAa;AAClC,gCAAS,EAAE,IAAI,uEAAuE;AACtF,gCAAS,EAAE,IAAI,wBAAwB;AAAA,EAC3C;AAAA,EAEQ,yBAAqD;AACzD,UAAM,aAAS;AAAA,MACX,YAAW,sBAAsB,EAAE,IAAI,CAAC,kBAAkB,cAAc,uBAAuB,CAAC;AAAA,IACpG;AAEA,WAAO;AAAA,EACX;AAAA,EAEQ,kBAAkB,eAA6D;AACnF,eAAW,iBAAiB,YAAW,sBAAsB,GAAG;AAC5D,YAAM,iBAAiB,cAAc,kBAAkB,aAAa;AACpE,UAAI,mBAAmB,QAAW;AAC9B,eAAO;AAAA,MACX;AAAA,IACJ;AAEA,WAAO;AAAA,EACX;AACJ;AApaA,IAAM,aAAN;AAAM,WAIsB,kBAA2D,CAAC;AAuaxF,WAAW,kBAAkB,8BAAa,+BAAc;AAExD,OAAO,UAAU;",
  "names": ["ServerlessError", "chalk"]
}
